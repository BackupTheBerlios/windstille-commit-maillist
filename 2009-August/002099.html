<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r3102 - in trunk/windstille/src: display	objects particles scenegraph sprite3d tile
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3102%20-%20in%20trunk/windstille/src%3A%20display%0A%09objects%20particles%20scenegraph%20sprite3d%20tile&In-Reply-To=%3C200908281542.n7SFgRn5027704%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002098.html">
   <LINK REL="Next"  HREF="002100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r3102 - in trunk/windstille/src: display	objects particles scenegraph sprite3d tile</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3102%20-%20in%20trunk/windstille/src%3A%20display%0A%09objects%20particles%20scenegraph%20sprite3d%20tile&In-Reply-To=%3C200908281542.n7SFgRn5027704%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r3102 - in trunk/windstille/src: display	objects particles scenegraph sprite3d tile">grumbel at mail.berlios.de
       </A><BR>
    <I>Fri Aug 28 17:42:27 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002098.html">[Windstille-commit] r3101 - in trunk/windstille/src: display objects
</A></li>
        <LI>Next message: <A HREF="002100.html">[Windstille-commit] r3103 - in trunk/windstille/src: display engine	objects particles scenegraph sprite3d tile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2099">[ date ]</a>
              <a href="thread.html#2099">[ thread ]</a>
              <a href="subject.html#2099">[ subject ]</a>
              <a href="author.html#2099">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-08-28 17:42:24 +0200 (Fri, 28 Aug 2009)
New Revision: 3102

Added:
   trunk/windstille/src/scenegraph/control_drawing_request.hpp
   trunk/windstille/src/scenegraph/drawing_request.hpp
   trunk/windstille/src/scenegraph/fill_screen_drawing_request.hpp
   trunk/windstille/src/scenegraph/fill_screen_pattern_drawing_request.hpp
   trunk/windstille/src/scenegraph/sprite3d_drawing_request.hpp
   trunk/windstille/src/scenegraph/surface_drawing_request.hpp
   trunk/windstille/src/scenegraph/surface_quad_drawing_request.hpp
   trunk/windstille/src/scenegraph/text_drawing_request.hpp
   trunk/windstille/src/scenegraph/vertex_array_drawing_request.cpp
   trunk/windstille/src/scenegraph/vertex_array_drawing_request.hpp
Removed:
   trunk/windstille/src/display/control_drawing_request.hpp
   trunk/windstille/src/display/drawing_request.hpp
   trunk/windstille/src/display/fill_screen_drawing_request.hpp
   trunk/windstille/src/display/fill_screen_pattern_drawing_request.hpp
   trunk/windstille/src/display/surface_drawing_request.hpp
   trunk/windstille/src/display/surface_quad_drawing_request.hpp
   trunk/windstille/src/display/text_drawing_request.hpp
   trunk/windstille/src/display/vertex_array_drawing_request.cpp
   trunk/windstille/src/display/vertex_array_drawing_request.hpp
   trunk/windstille/src/sprite3d/sprite3d_drawing_request.hpp
Modified:
   trunk/windstille/src/display/compositor.cpp
   trunk/windstille/src/display/drawing_context.cpp
   trunk/windstille/src/display/drawing_context.hpp
   trunk/windstille/src/objects/background_gradient.cpp
   trunk/windstille/src/objects/decal.cpp
   trunk/windstille/src/objects/laser_pointer.cpp
   trunk/windstille/src/objects/liquid.cpp
   trunk/windstille/src/objects/nightvision.cpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/objects/swarm.cpp
   trunk/windstille/src/particles/spark_drawer.cpp
   trunk/windstille/src/particles/surface_drawer.cpp
   trunk/windstille/src/scenegraph/scene_graph.cpp
   trunk/windstille/src/sprite3d/sprite3d.cpp
   trunk/windstille/src/tile/tile_map.cpp
Log:
Moved all DrawingRequests to scenegraph/

Modified: trunk/windstille/src/display/compositor.cpp
===================================================================
--- trunk/windstille/src/display/compositor.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/compositor.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -21,7 +21,7 @@
 #include &lt;GL/glew.h&gt;
 
 #include &quot;display/display.hpp&quot;
-#include &quot;display/drawing_request.hpp&quot;
+#include &quot;scenegraph/drawing_request.hpp&quot;
 #include &quot;display/graphic_context_state.hpp&quot;
 #include &quot;display/framebuffer.hpp&quot;
 #include &quot;display/opengl_state.hpp&quot;

Deleted: trunk/windstille/src/display/control_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/control_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/control_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,60 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_CONTROL_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_CONTROL_DRAWING_REQUEST_HPP
-
-class ControlDrawingRequest : public DrawingRequest
-{
-private:
-  Surface surface;
-  float angle;
-
-public:
-  ControlDrawingRequest(Surface surface_, const Vector2f&amp; pos_, float angle_, float z_pos_,
-                        const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, z_pos_, modelview_), 
-      surface(surface_), 
-      angle(angle_)
-  {}
-
-  virtual ~ControlDrawingRequest() {}
-
-  void draw(const Texture&amp; /*tmp_texture*/)
-  {
-    glPushMatrix();
-
-    // FIXME: This looks badly broken, should modelview.multiply() be enough?
-    glTranslatef(modelview.matrix[12],
-                 modelview.matrix[13],
-                 modelview.matrix[14]);
-
-    Vector3 p = modelview.multiply(Vector3(pos.x, pos.y, 0.0f));
-
-    surface.draw(SurfaceDrawingParameters()
-                 .set_angle(angle)
-                 .set_pos(Vector2f(p.x - surface.get_width()/2,
-                                   p.y - surface.get_height()/2)));
-
-    glPopMatrix();
-  }
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/display/drawing_context.cpp
===================================================================
--- trunk/windstille/src/display/drawing_context.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/drawing_context.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -30,14 +30,14 @@
 #include &quot;math/vector3.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 
-#include &quot;display/control_drawing_request.hpp&quot;
-#include &quot;display/fill_screen_drawing_request.hpp&quot;
-#include &quot;display/fill_screen_pattern_drawing_request.hpp&quot;
-#include &quot;display/surface_drawing_request.hpp&quot;
-#include &quot;display/surface_quad_drawing_request.hpp&quot;
-#include &quot;display/text_drawing_request.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/control_drawing_request.hpp&quot;
+#include &quot;scenegraph/fill_screen_drawing_request.hpp&quot;
+#include &quot;scenegraph/fill_screen_pattern_drawing_request.hpp&quot;
+#include &quot;scenegraph/surface_drawing_request.hpp&quot;
+#include &quot;scenegraph/surface_quad_drawing_request.hpp&quot;
+#include &quot;scenegraph/text_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 
 struct DrawingRequestsSorter
 {

Modified: trunk/windstille/src/display/drawing_context.hpp
===================================================================
--- trunk/windstille/src/display/drawing_context.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/drawing_context.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -21,7 +21,7 @@
 
 #include &lt;vector&gt;
 
-#include &quot;display/drawing_request.hpp&quot;
+#include &quot;scenegraph/drawing_request.hpp&quot;
 
 class Texture;
 class Surface;

Deleted: trunk/windstille/src/display/drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,85 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_DRAWING_REQUEST_HPP
-
-#include &quot;math/vector2f.hpp&quot;
-#include &quot;math/rect.hpp&quot;
-#include &quot;math/matrix.hpp&quot;
-#include &quot;display/texture.hpp&quot;
-
-class DrawingRequest
-{
-protected:
-  Vector2f pos;
-  float    z_pos;
-  Matrix   modelview;
-  unsigned int render_mask;
-
-public:
-  DrawingRequest(const Vector2f&amp; pos_, float z_pos_ = 0,  const Matrix&amp; modelview_ = Matrix::identity())
-    : pos(pos_), 
-      z_pos(z_pos_), 
-      modelview(modelview_),
-      render_mask(0)
-  {}
-  virtual ~DrawingRequest() {}
-  
-  /**
-   * The draw() method does the important work in DrawingRequest,
-   * ie. it is the place where you can access the screen with raw
-   * OpenGL methods. The \a tmp_texture provides a texture of the
-   * current framebuffer, you have to copy the \a screen_texture to it
-   * to contain usefull content
-   */
-  virtual void draw(const Texture&amp; tmp_texture) = 0;
-
-  /**
-   * This method is called before draw() to allow the DrawingRequest
-   * to copy content from \a screen_texture, which is the current
-   * framebuffer to a temporary buffer which can then be used in
-   * draw() for deformation effects
-   */
-  virtual void prepare(const Texture&amp; screen_texture) {
-      (void) screen_texture;
-  }
-
-  /**
-   * Override this and let it return true if you need to prepare()
-   * function call
-   */
-  virtual bool needs_prepare() { return false; }
-  
-  /** Returns the position at which the request should be drawn */
-  float get_z_pos() const { return z_pos; }
-
-  Matrix get_modelview() const
-  { return modelview; }
-
-  void set_render_mask(unsigned int mask) { render_mask = mask; }
-  unsigned int get_render_mask() const { return render_mask; }
-
-private:
-  DrawingRequest (const DrawingRequest&amp;);
-  DrawingRequest&amp; operator= (const DrawingRequest&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/display/fill_screen_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/fill_screen_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/fill_screen_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,47 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_FILL_SCREEN_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_FILL_SCREEN_DRAWING_REQUEST_HPP
-
-
-
-class FillScreenDrawingRequest : public DrawingRequest
-{
-private:
-  Color color;
-
-public:
-  FillScreenDrawingRequest(const Color&amp; color_) 
-    : DrawingRequest(Vector2f(0, 0), -1000.0f), color(color_)
-  {
-  }
-  virtual ~FillScreenDrawingRequest() {}
-
-  void draw(const Texture&amp; /*tmp_texture*/) {
-    OpenGLState state;
-    // FIXME: move clear color to opengl_state
-    state.activate();
-    glClearColor(color.r, color.g, color.b, color.a);
-    glClear(GL_COLOR_BUFFER_BIT);
-  }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/display/fill_screen_pattern_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/fill_screen_pattern_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/fill_screen_pattern_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,74 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_FILL_SCREEN_PATTERN_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_FILL_SCREEN_PATTERN_DRAWING_REQUEST_HPP
-
-
-class FillScreenPatternDrawingRequest : public DrawingRequest
-{
-private:
-  Texture  texture;
-  Vector2f offset;
-public:
-  FillScreenPatternDrawingRequest(const Texture&amp; texture_, const Vector2f&amp; offset_)
-    : DrawingRequest(Vector2f(0, 0), -1000.0f), 
-      texture(texture_),
-      offset(offset_)
-  {}
-
-  virtual ~FillScreenPatternDrawingRequest() {}
-
-  void draw(const Texture&amp; /*tmp_texture*/) 
-  {
-    OpenGLState state;
-    state.enable(GL_BLEND);
-    state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-    state.bind_texture(texture);
-    state.activate();
-
-    float u = static_cast&lt;float&gt;(Display::get_width())  / static_cast&lt;float&gt;(texture.get_width());
-    float v = static_cast&lt;float&gt;(Display::get_height()) / static_cast&lt;float&gt;(texture.get_height());
-
-    float u_start = -offset.x / static_cast&lt;float&gt;(texture.get_width());
-    float v_start = -offset.y / static_cast&lt;float&gt;(texture.get_height());
-
-    u -= offset.x / static_cast&lt;float&gt;(texture.get_width());
-    v -= offset.y / static_cast&lt;float&gt;(texture.get_height());
-
-    glBegin(GL_QUADS);
-    {
-      glTexCoord2f(u_start, v_start);
-      glVertex2f(0, 0);
-    
-      glTexCoord2f(u, v_start);
-      glVertex2f(static_cast&lt;float&gt;(Display::get_width()), 0);
-
-      glTexCoord2f(u, v);
-      glVertex2f(static_cast&lt;float&gt;(Display::get_width()), static_cast&lt;float&gt;(Display::get_height()));
-
-      glTexCoord2f(u_start, v);
-      glVertex2f(0,  static_cast&lt;float&gt;(Display::get_height()));
-    }
-    glEnd();
-  }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/display/surface_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/surface_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/surface_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,59 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_SURFACE_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_SURFACE_DRAWING_REQUEST_HPP
-
-#include &quot;display/surface_drawing_request.hpp&quot;
-#include &quot;display/surface_drawing_parameters.hpp&quot;
-
-class SurfaceDrawingRequest : public DrawingRequest
-{
-private:
-  Surface surface;
-  SurfaceDrawingParameters params;
-
-public:
-  SurfaceDrawingRequest(Surface surface_, const SurfaceDrawingParameters&amp; params_,
-                        float z_pos_,
-                        const Matrix&amp; modelview_)
-    : DrawingRequest(pos, z_pos_, modelview_), 
-      surface(surface_), 
-      params(params_)
-  {}
-
-  virtual ~SurfaceDrawingRequest()
-  {}
-  
-  Surface get_surface() const { return surface; }
-  SurfaceDrawingParameters&amp; get_params() { return params; }
-
-  void draw(const Texture&amp; /*tmp_texture*/) 
-  {
-    glPushMatrix();
-    glMultMatrixf(modelview.matrix);
-
-    surface.draw(params);
-
-    glPopMatrix();
-  }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/display/surface_quad_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/surface_quad_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/surface_quad_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,77 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_SURFACE_QUAD_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_SURFACE_QUAD_DRAWING_REQUEST_HPP
-
-#include &quot;math/vector2f.hpp&quot;
-#include &quot;math/quad.hpp&quot;
-#include &quot;display/drawing_request.hpp&quot;
-
-class SurfaceQuadDrawingRequest : public DrawingRequest
-{
-private:
-  Surface surface;
-  Quad quad;
-  DrawingParameters params;
-
-public:
-  SurfaceQuadDrawingRequest(Surface surface_, const Vector2f&amp; pos_, const Quad&amp; quad_, 
-                            const DrawingParameters&amp; params_, float z_pos_,
-                            const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, z_pos_, modelview_),
-      surface(surface_),
-      quad(quad_),
-      params(params_)
-  {
-  }
-
-  void draw(const Texture&amp; /*tmp_texture*/) 
-  {
-    OpenGLState state;
-    state.enable(GL_BLEND);
-    state.set_blend_func(params.blendfunc_src, params.blendfunc_dst);
-    state.bind_texture(surface.get_texture());
-    state.activate();
-
-    glPushMatrix();
-    glMultMatrixf(modelview.matrix);
-
-    glBegin(GL_QUADS);
-    {
-      glTexCoord2f(surface.get_uv().left, surface.get_uv().top);
-      glVertex2f(pos.x + quad.p1.x, pos.y + quad.p1.y);
-    
-      glTexCoord2f(surface.get_uv().right, surface.get_uv().top);
-      glVertex2f(pos.x + quad.p2.x, pos.y + quad.p2.y);
-
-      glTexCoord2f(surface.get_uv().right, surface.get_uv().bottom);
-      glVertex2f(pos.x + quad.p3.x, pos.y + quad.p3.y);
-
-      glTexCoord2f(surface.get_uv().left, surface.get_uv().bottom);
-      glVertex2f(pos.x + quad.p4.x, pos.y + quad.p4.y);
-    }
-    glEnd();
-
-    glPopMatrix();    
-  }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/display/text_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/text_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/text_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,43 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_TEXT_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_TEXT_DRAWING_REQUEST_HPP
-
-class TextDrawingRequest : public DrawingRequest
-{
-private:
-  std::string text;
-public:
-  TextDrawingRequest(const std::string&amp; text_, const Vector2f&amp; pos_, float z_pos_, const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, z_pos_, modelview_),
-      text(text_)
-  {}
-  virtual ~TextDrawingRequest() {}
-
-  void draw(const Texture&amp; /*tmp_texture*/) {
-    glPushMatrix();
-    glMultMatrixf(modelview.matrix);
-    Fonts::current()-&gt;ttffont-&gt;draw(pos, text);
-    glPopMatrix();
-  }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/display/vertex_array_drawing_request.cpp
===================================================================
--- trunk/windstille/src/display/vertex_array_drawing_request.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/vertex_array_drawing_request.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,183 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;display/opengl_state.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
-
-VertexArrayDrawingRequest::VertexArrayDrawingRequest(const Vector2f&amp; pos_, float z_pos_, 
-                                                     const Matrix&amp; modelview_)
-  : DrawingRequest(pos_, z_pos_, modelview_),
-    mode(GL_QUADS),
-    blend_sfactor(GL_SRC_ALPHA),
-    blend_dfactor(GL_ONE_MINUS_SRC_ALPHA),
-    texture(),
-    colors(),
-    texcoords(),
-    vertices()
-{
-}
-
-int
-VertexArrayDrawingRequest::num_vertices() const
-{
-  return vertices.size()/3;
-}
-
-void
-VertexArrayDrawingRequest::clear()
-{
-  colors.clear();
-  texcoords.clear();
-  vertices.clear();
-}
-
-void
-VertexArrayDrawingRequest::draw(const Texture&amp; /*tmp_texture*/)
-{
-  draw(0, num_vertices());
-}
-
-void
-VertexArrayDrawingRequest::draw(int start, int end)
-{
-  assert(!vertices.empty());
-  assert(texcoords.empty() || int(texcoords.size()/2) == num_vertices());
-  assert(colors.empty() || int(colors.size()/4) == num_vertices());
-
-  OpenGLState state;
-
-  glClear(GL_DEPTH_BUFFER_BIT);
-  state.disable(GL_DEPTH_TEST);
-  state.enable(GL_BLEND);
-  state.set_blend_func(blend_sfactor, blend_dfactor);
-  
-  if (texture)
-    {
-      state.bind_texture(texture);
-    }
-
-  if (!colors.empty())
-    {
-      state.enable_client_state(GL_COLOR_ARRAY);
-      glColorPointer(4, GL_UNSIGNED_BYTE, 0, &amp;*colors.begin());
-    }
-  else
-    {
-      state.disable_client_state(GL_COLOR_ARRAY);
-      state.color(Color(1.0f, 1.0f, 1.0f));
-    }
-
-  if (!texcoords.empty())
-    {
-      state.enable_client_state(GL_TEXTURE_COORD_ARRAY);
-      glTexCoordPointer(2, GL_FLOAT, 0, &amp;*texcoords.begin());
-    }
-  else
-    {
-      state.disable_client_state(GL_TEXTURE_COORD_ARRAY);
-    }
-
-  // FIXME: Might be worth to not use VertexArrays when we have a pretty small number of vertices
-  state.disable_client_state(GL_NORMAL_ARRAY);
-  state.enable_client_state(GL_VERTEX_ARRAY);
-
-  glVertexPointer(3, GL_FLOAT, 0, &amp;*vertices.begin());
-
-  state.activate();
-
-  glPushMatrix();
-  glMultMatrixf(modelview.matrix);
-
-  glDrawArrays(mode, start, end);
-
-  glPopMatrix();
-}
-
-void
-VertexArrayDrawingRequest::vertex(const Vector2f&amp; vec, float z)
-{
-  vertex(vec.x, vec.y, z);
-}
-
-void
-VertexArrayDrawingRequest::vertex(float x, float y, float z)
-{
-  vertices.push_back(x + pos.x);
-  vertices.push_back(y + pos.y);
-  vertices.push_back(z);
-}
-
-void
-VertexArrayDrawingRequest::texcoord(float u, float v)
-{
-  texcoords.push_back(u);
-  texcoords.push_back(v);
-}
-
-void
-VertexArrayDrawingRequest::add_texcoords(const Rectf&amp; rect)
-{
-  texcoords.push_back(rect.left);
-  texcoords.push_back(rect.top);
-  texcoords.push_back(rect.right);
-  texcoords.push_back(rect.top);
-  texcoords.push_back(rect.right);
-  texcoords.push_back(rect.bottom);
-  texcoords.push_back(rect.left);
-  texcoords.push_back(rect.bottom);
-}
-
-void
-VertexArrayDrawingRequest::add_texcoords(const float* coords, size_t n)
-{
-  assert(n % 2 == 0);
-  for(size_t i = 0; i &lt; n; ++i)
-  {
-    texcoords.push_back(coords[i]);
-  }
-}
-
-void
-VertexArrayDrawingRequest::color(const Color&amp; color_)
-{
-  colors.push_back(static_cast&lt;unsigned char&gt;(color_.r * 255));
-  colors.push_back(static_cast&lt;unsigned char&gt;(color_.g * 255));
-  colors.push_back(static_cast&lt;unsigned char&gt;(color_.b * 255));
-  colors.push_back(static_cast&lt;unsigned char&gt;(color_.a * 255));
-}
-
-void
-VertexArrayDrawingRequest::set_texture(Texture texture_)
-{
-  texture = texture_;
-}
-
-void
-VertexArrayDrawingRequest::set_blend_func(GLenum sfactor, GLenum dfactor)
-{
-  blend_sfactor = sfactor;
-  blend_dfactor = dfactor;
-}
-
-void
-VertexArrayDrawingRequest::set_mode(GLenum mode_)
-{
-  mode = mode_;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/display/vertex_array_drawing_request.hpp
===================================================================
--- trunk/windstille/src/display/vertex_array_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/display/vertex_array_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,71 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DISPLAY_VERTEX_ARRAY_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_DISPLAY_VERTEX_ARRAY_DRAWING_REQUEST_HPP
-
-#include &lt;vector&gt;
-
-#include &quot;display/color.hpp&quot;
-#include &quot;display/drawing_request.hpp&quot;
-
-/** */
-class VertexArrayDrawingRequest : public DrawingRequest
-{
-private:
-  GLenum mode;
-
-  GLenum blend_sfactor;
-  GLenum blend_dfactor;
-
-  Texture texture;
-  std::vector&lt;unsigned char&gt; colors;
-  std::vector&lt;float&gt; texcoords;
-  std::vector&lt;float&gt; vertices;
-
-public:
-  VertexArrayDrawingRequest(const Vector2f&amp; pos_, float z_pos_, const Matrix&amp; modelview_);
-
-  void draw(const Texture&amp; tmp_texture);
-  void draw(int start, int end);
-
-  void vertex(float x, float y, float z = 0.0f);
-  void vertex(const Vector2f&amp; vec, float z = 0.0f);
-
-  void texcoord(float u, float v);
-  void color(const Color&amp; color);
-  void add_texcoords(const float* coords, size_t n);
-  /**
-   * Add eight texcoords for use with a quad from a given rect. The
-   * coords are clockwise around the rect, ie:
-   * left, top, right, top, right, bottom, left, bottom,
-   */
-  void add_texcoords(const Rectf&amp; coords);
-
-  int num_vertices() const;
-
-  void clear();
-
-  void set_mode(GLenum mode_);
-  void set_texture(Texture texture);
-  void set_blend_func(GLenum sfactor, GLenum dfactor);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/objects/background_gradient.cpp
===================================================================
--- trunk/windstille/src/objects/background_gradient.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/background_gradient.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -18,7 +18,7 @@
 
 #include &quot;objects/background_gradient.hpp&quot;
 
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;display/display.hpp&quot;
 
 BackgroundGradient::BackgroundGradient(FileReader&amp; props)

Modified: trunk/windstille/src/objects/decal.cpp
===================================================================
--- trunk/windstille/src/objects/decal.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/decal.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -20,7 +20,7 @@
 
 #include &quot;engine/sector.hpp&quot;
 #include &quot;scenegraph/scene_graph.hpp&quot;
-#include &quot;display/surface_drawing_request.hpp&quot;
+#include &quot;scenegraph/surface_drawing_request.hpp&quot;
 #include &quot;display/surface_drawing_parameters.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 

Modified: trunk/windstille/src/objects/laser_pointer.cpp
===================================================================
--- trunk/windstille/src/objects/laser_pointer.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/laser_pointer.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;

Modified: trunk/windstille/src/objects/liquid.cpp
===================================================================
--- trunk/windstille/src/objects/liquid.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/liquid.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;objects/liquid.hpp&quot;
 
 #define SAMPLES 5

Modified: trunk/windstille/src/objects/nightvision.cpp
===================================================================
--- trunk/windstille/src/objects/nightvision.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/nightvision.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -19,7 +19,7 @@
 #include &quot;objects/nightvision.hpp&quot;
 
 #include &quot;display/display.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;math/random.hpp&quot;
 
 Nightvision::Nightvision(FileReader&amp; /*props*/)

Modified: trunk/windstille/src/objects/player.cpp
===================================================================
--- trunk/windstille/src/objects/player.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/player.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -30,7 +30,7 @@
 #include &quot;tile/tile.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 #include &quot;scenegraph/scene_graph.hpp&quot;
-#include &quot;sprite3d/sprite3d_drawing_request.hpp&quot;
+#include &quot;scenegraph/sprite3d_drawing_request.hpp&quot;
 
 static const int MAX_ENERGY = 16;
 static const float WALK_SPEED = 100.0;

Modified: trunk/windstille/src/objects/swarm.cpp
===================================================================
--- trunk/windstille/src/objects/swarm.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/objects/swarm.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;math/random.hpp&quot;
 #include &quot;screen/game_session.hpp&quot;
 #include &quot;screen/view.hpp&quot;

Modified: trunk/windstille/src/particles/spark_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/spark_drawer.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/particles/spark_drawer.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -18,7 +18,7 @@
 
 #include &quot;display/drawing_context.hpp&quot;
 #include &quot;util/file_reader.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;particles/particle_system.hpp&quot;
 #include &quot;particles/spark_drawer.hpp&quot;
 

Modified: trunk/windstille/src/particles/surface_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/surface_drawer.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/particles/surface_drawer.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -17,7 +17,7 @@
 */
 
 #include &quot;util/file_reader.cpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 #include &quot;particles/particle_system.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
 #include &quot;display/drawing_context.hpp&quot;

Copied: trunk/windstille/src/scenegraph/control_drawing_request.hpp (from rev 3087, trunk/windstille/src/display/control_drawing_request.hpp)


Property changes on: trunk/windstille/src/scenegraph/control_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/drawing_request.hpp (from rev 3097, trunk/windstille/src/display/drawing_request.hpp)


Property changes on: trunk/windstille/src/scenegraph/drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/fill_screen_drawing_request.hpp (from rev 3092, trunk/windstille/src/display/fill_screen_drawing_request.hpp)


Property changes on: trunk/windstille/src/scenegraph/fill_screen_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/fill_screen_pattern_drawing_request.hpp (from rev 3092, trunk/windstille/src/display/fill_screen_pattern_drawing_request.hpp)


Property changes on: trunk/windstille/src/scenegraph/fill_screen_pattern_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Modified: trunk/windstille/src/scenegraph/scene_graph.cpp
===================================================================
--- trunk/windstille/src/scenegraph/scene_graph.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/scenegraph/scene_graph.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -18,7 +18,7 @@
 
 #include &quot;scenegraph/scene_graph.hpp&quot;
 
-#include &quot;display/drawing_request.hpp&quot;
+#include &quot;scenegraph/drawing_request.hpp&quot;
 
 SceneGraph::SceneGraph()
   : m_drawing_requests()

Copied: trunk/windstille/src/scenegraph/sprite3d_drawing_request.hpp (from rev 3087, trunk/windstille/src/sprite3d/sprite3d_drawing_request.hpp)
===================================================================
--- trunk/windstille/src/sprite3d/sprite3d_drawing_request.hpp	2009-08-27 00:00:22 UTC (rev 3087)
+++ trunk/windstille/src/scenegraph/sprite3d_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -0,0 +1,53 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_SPRITE3D_SPRITE3D_DRAWING_REQUEST_HPP
+#define HEADER_WINDSTILLE_SPRITE3D_SPRITE3D_DRAWING_REQUEST_HPP
+
+#include &quot;sprite3d/sprite3d.hpp&quot;
+#include &quot;scenegraph/drawing_request.hpp&quot;
+
+class Sprite3DDrawingRequest : public DrawingRequest
+{
+private:
+  const Sprite3D* sprite;
+
+public:
+  Sprite3DDrawingRequest(const Sprite3D* sprite_, 
+                         const Vector2f&amp; pos_, float z_pos_, const Matrix&amp; modelview_)
+    : DrawingRequest(pos_, z_pos_, modelview_), sprite(sprite_)
+  {}
+
+  void draw(const Texture&amp; /*tmp_texture*/)
+  {
+    sprite-&gt;draw(pos, modelview);
+  }
+
+  void set_pos(const Vector2f&amp; pos_)
+  {
+    pos = pos_;
+  }
+
+private:
+  Sprite3DDrawingRequest(const Sprite3DDrawingRequest&amp;);
+  Sprite3DDrawingRequest&amp; operator=(const Sprite3DDrawingRequest&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/scenegraph/sprite3d_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/surface_drawing_request.hpp (from rev 3101, trunk/windstille/src/display/surface_drawing_request.hpp)
===================================================================
--- trunk/windstille/src/display/surface_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/scenegraph/surface_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -0,0 +1,59 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_DISPLAY_SURFACE_DRAWING_REQUEST_HPP
+#define HEADER_WINDSTILLE_DISPLAY_SURFACE_DRAWING_REQUEST_HPP
+
+#include &quot;scenegraph/surface_drawing_request.hpp&quot;
+#include &quot;display/surface_drawing_parameters.hpp&quot;
+
+class SurfaceDrawingRequest : public DrawingRequest
+{
+private:
+  Surface surface;
+  SurfaceDrawingParameters params;
+
+public:
+  SurfaceDrawingRequest(Surface surface_, const SurfaceDrawingParameters&amp; params_,
+                        float z_pos_,
+                        const Matrix&amp; modelview_)
+    : DrawingRequest(pos, z_pos_, modelview_), 
+      surface(surface_), 
+      params(params_)
+  {}
+
+  virtual ~SurfaceDrawingRequest()
+  {}
+  
+  Surface get_surface() const { return surface; }
+  SurfaceDrawingParameters&amp; get_params() { return params; }
+
+  void draw(const Texture&amp; /*tmp_texture*/) 
+  {
+    glPushMatrix();
+    glMultMatrixf(modelview.matrix);
+
+    surface.draw(params);
+
+    glPopMatrix();
+  }
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/scenegraph/surface_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/surface_quad_drawing_request.hpp (from rev 3087, trunk/windstille/src/display/surface_quad_drawing_request.hpp)
===================================================================
--- trunk/windstille/src/display/surface_quad_drawing_request.hpp	2009-08-27 00:00:22 UTC (rev 3087)
+++ trunk/windstille/src/scenegraph/surface_quad_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -0,0 +1,77 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_DISPLAY_SURFACE_QUAD_DRAWING_REQUEST_HPP
+#define HEADER_WINDSTILLE_DISPLAY_SURFACE_QUAD_DRAWING_REQUEST_HPP
+
+#include &quot;math/vector2f.hpp&quot;
+#include &quot;math/quad.hpp&quot;
+#include &quot;scenegraph/drawing_request.hpp&quot;
+
+class SurfaceQuadDrawingRequest : public DrawingRequest
+{
+private:
+  Surface surface;
+  Quad quad;
+  DrawingParameters params;
+
+public:
+  SurfaceQuadDrawingRequest(Surface surface_, const Vector2f&amp; pos_, const Quad&amp; quad_, 
+                            const DrawingParameters&amp; params_, float z_pos_,
+                            const Matrix&amp; modelview_)
+    : DrawingRequest(pos_, z_pos_, modelview_),
+      surface(surface_),
+      quad(quad_),
+      params(params_)
+  {
+  }
+
+  void draw(const Texture&amp; /*tmp_texture*/) 
+  {
+    OpenGLState state;
+    state.enable(GL_BLEND);
+    state.set_blend_func(params.blendfunc_src, params.blendfunc_dst);
+    state.bind_texture(surface.get_texture());
+    state.activate();
+
+    glPushMatrix();
+    glMultMatrixf(modelview.matrix);
+
+    glBegin(GL_QUADS);
+    {
+      glTexCoord2f(surface.get_uv().left, surface.get_uv().top);
+      glVertex2f(pos.x + quad.p1.x, pos.y + quad.p1.y);
+    
+      glTexCoord2f(surface.get_uv().right, surface.get_uv().top);
+      glVertex2f(pos.x + quad.p2.x, pos.y + quad.p2.y);
+
+      glTexCoord2f(surface.get_uv().right, surface.get_uv().bottom);
+      glVertex2f(pos.x + quad.p3.x, pos.y + quad.p3.y);
+
+      glTexCoord2f(surface.get_uv().left, surface.get_uv().bottom);
+      glVertex2f(pos.x + quad.p4.x, pos.y + quad.p4.y);
+    }
+    glEnd();
+
+    glPopMatrix();    
+  }
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/scenegraph/surface_quad_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/text_drawing_request.hpp (from rev 3087, trunk/windstille/src/display/text_drawing_request.hpp)


Property changes on: trunk/windstille/src/scenegraph/text_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/scenegraph/vertex_array_drawing_request.cpp (from rev 3087, trunk/windstille/src/display/vertex_array_drawing_request.cpp)
===================================================================
--- trunk/windstille/src/display/vertex_array_drawing_request.cpp	2009-08-27 00:00:22 UTC (rev 3087)
+++ trunk/windstille/src/scenegraph/vertex_array_drawing_request.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -0,0 +1,183 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;display/opengl_state.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
+
+VertexArrayDrawingRequest::VertexArrayDrawingRequest(const Vector2f&amp; pos_, float z_pos_, 
+                                                     const Matrix&amp; modelview_)
+  : DrawingRequest(pos_, z_pos_, modelview_),
+    mode(GL_QUADS),
+    blend_sfactor(GL_SRC_ALPHA),
+    blend_dfactor(GL_ONE_MINUS_SRC_ALPHA),
+    texture(),
+    colors(),
+    texcoords(),
+    vertices()
+{
+}
+
+int
+VertexArrayDrawingRequest::num_vertices() const
+{
+  return vertices.size()/3;
+}
+
+void
+VertexArrayDrawingRequest::clear()
+{
+  colors.clear();
+  texcoords.clear();
+  vertices.clear();
+}
+
+void
+VertexArrayDrawingRequest::draw(const Texture&amp; /*tmp_texture*/)
+{
+  draw(0, num_vertices());
+}
+
+void
+VertexArrayDrawingRequest::draw(int start, int end)
+{
+  assert(!vertices.empty());
+  assert(texcoords.empty() || int(texcoords.size()/2) == num_vertices());
+  assert(colors.empty() || int(colors.size()/4) == num_vertices());
+
+  OpenGLState state;
+
+  glClear(GL_DEPTH_BUFFER_BIT);
+  state.disable(GL_DEPTH_TEST);
+  state.enable(GL_BLEND);
+  state.set_blend_func(blend_sfactor, blend_dfactor);
+  
+  if (texture)
+    {
+      state.bind_texture(texture);
+    }
+
+  if (!colors.empty())
+    {
+      state.enable_client_state(GL_COLOR_ARRAY);
+      glColorPointer(4, GL_UNSIGNED_BYTE, 0, &amp;*colors.begin());
+    }
+  else
+    {
+      state.disable_client_state(GL_COLOR_ARRAY);
+      state.color(Color(1.0f, 1.0f, 1.0f));
+    }
+
+  if (!texcoords.empty())
+    {
+      state.enable_client_state(GL_TEXTURE_COORD_ARRAY);
+      glTexCoordPointer(2, GL_FLOAT, 0, &amp;*texcoords.begin());
+    }
+  else
+    {
+      state.disable_client_state(GL_TEXTURE_COORD_ARRAY);
+    }
+
+  // FIXME: Might be worth to not use VertexArrays when we have a pretty small number of vertices
+  state.disable_client_state(GL_NORMAL_ARRAY);
+  state.enable_client_state(GL_VERTEX_ARRAY);
+
+  glVertexPointer(3, GL_FLOAT, 0, &amp;*vertices.begin());
+
+  state.activate();
+
+  glPushMatrix();
+  glMultMatrixf(modelview.matrix);
+
+  glDrawArrays(mode, start, end);
+
+  glPopMatrix();
+}
+
+void
+VertexArrayDrawingRequest::vertex(const Vector2f&amp; vec, float z)
+{
+  vertex(vec.x, vec.y, z);
+}
+
+void
+VertexArrayDrawingRequest::vertex(float x, float y, float z)
+{
+  vertices.push_back(x + pos.x);
+  vertices.push_back(y + pos.y);
+  vertices.push_back(z);
+}
+
+void
+VertexArrayDrawingRequest::texcoord(float u, float v)
+{
+  texcoords.push_back(u);
+  texcoords.push_back(v);
+}
+
+void
+VertexArrayDrawingRequest::add_texcoords(const Rectf&amp; rect)
+{
+  texcoords.push_back(rect.left);
+  texcoords.push_back(rect.top);
+  texcoords.push_back(rect.right);
+  texcoords.push_back(rect.top);
+  texcoords.push_back(rect.right);
+  texcoords.push_back(rect.bottom);
+  texcoords.push_back(rect.left);
+  texcoords.push_back(rect.bottom);
+}
+
+void
+VertexArrayDrawingRequest::add_texcoords(const float* coords, size_t n)
+{
+  assert(n % 2 == 0);
+  for(size_t i = 0; i &lt; n; ++i)
+  {
+    texcoords.push_back(coords[i]);
+  }
+}
+
+void
+VertexArrayDrawingRequest::color(const Color&amp; color_)
+{
+  colors.push_back(static_cast&lt;unsigned char&gt;(color_.r * 255));
+  colors.push_back(static_cast&lt;unsigned char&gt;(color_.g * 255));
+  colors.push_back(static_cast&lt;unsigned char&gt;(color_.b * 255));
+  colors.push_back(static_cast&lt;unsigned char&gt;(color_.a * 255));
+}
+
+void
+VertexArrayDrawingRequest::set_texture(Texture texture_)
+{
+  texture = texture_;
+}
+
+void
+VertexArrayDrawingRequest::set_blend_func(GLenum sfactor, GLenum dfactor)
+{
+  blend_sfactor = sfactor;
+  blend_dfactor = dfactor;
+}
+
+void
+VertexArrayDrawingRequest::set_mode(GLenum mode_)
+{
+  mode = mode_;
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/scenegraph/vertex_array_drawing_request.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/scenegraph/vertex_array_drawing_request.hpp (from rev 3087, trunk/windstille/src/display/vertex_array_drawing_request.hpp)
===================================================================
--- trunk/windstille/src/display/vertex_array_drawing_request.hpp	2009-08-27 00:00:22 UTC (rev 3087)
+++ trunk/windstille/src/scenegraph/vertex_array_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -0,0 +1,71 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_DISPLAY_VERTEX_ARRAY_DRAWING_REQUEST_HPP
+#define HEADER_WINDSTILLE_DISPLAY_VERTEX_ARRAY_DRAWING_REQUEST_HPP
+
+#include &lt;vector&gt;
+
+#include &quot;display/color.hpp&quot;
+#include &quot;scenegraph/drawing_request.hpp&quot;
+
+/** */
+class VertexArrayDrawingRequest : public DrawingRequest
+{
+private:
+  GLenum mode;
+
+  GLenum blend_sfactor;
+  GLenum blend_dfactor;
+
+  Texture texture;
+  std::vector&lt;unsigned char&gt; colors;
+  std::vector&lt;float&gt; texcoords;
+  std::vector&lt;float&gt; vertices;
+
+public:
+  VertexArrayDrawingRequest(const Vector2f&amp; pos_, float z_pos_, const Matrix&amp; modelview_);
+
+  void draw(const Texture&amp; tmp_texture);
+  void draw(int start, int end);
+
+  void vertex(float x, float y, float z = 0.0f);
+  void vertex(const Vector2f&amp; vec, float z = 0.0f);
+
+  void texcoord(float u, float v);
+  void color(const Color&amp; color);
+  void add_texcoords(const float* coords, size_t n);
+  /**
+   * Add eight texcoords for use with a quad from a given rect. The
+   * coords are clockwise around the rect, ie:
+   * left, top, right, top, right, bottom, left, bottom,
+   */
+  void add_texcoords(const Rectf&amp; coords);
+
+  int num_vertices() const;
+
+  void clear();
+
+  void set_mode(GLenum mode_);
+  void set_texture(Texture texture);
+  void set_blend_func(GLenum sfactor, GLenum dfactor);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/scenegraph/vertex_array_drawing_request.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/windstille/src/sprite3d/sprite3d.cpp
===================================================================
--- trunk/windstille/src/sprite3d/sprite3d.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/sprite3d/sprite3d.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -23,7 +23,7 @@
 #include &quot;util/util.hpp&quot;
 #include &quot;display/opengl_state.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
-#include &quot;sprite3d/sprite3d_drawing_request.hpp&quot;
+#include &quot;scenegraph/sprite3d_drawing_request.hpp&quot;
 
 using namespace sprite3d;
 

Deleted: trunk/windstille/src/sprite3d/sprite3d_drawing_request.hpp
===================================================================
--- trunk/windstille/src/sprite3d/sprite3d_drawing_request.hpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/sprite3d/sprite3d_drawing_request.hpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -1,53 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SPRITE3D_SPRITE3D_DRAWING_REQUEST_HPP
-#define HEADER_WINDSTILLE_SPRITE3D_SPRITE3D_DRAWING_REQUEST_HPP
-
-#include &quot;sprite3d/sprite3d.hpp&quot;
-#include &quot;display/drawing_request.hpp&quot;
-
-class Sprite3DDrawingRequest : public DrawingRequest
-{
-private:
-  const Sprite3D* sprite;
-
-public:
-  Sprite3DDrawingRequest(const Sprite3D* sprite_, 
-                         const Vector2f&amp; pos_, float z_pos_, const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, z_pos_, modelview_), sprite(sprite_)
-  {}
-
-  void draw(const Texture&amp; /*tmp_texture*/)
-  {
-    sprite-&gt;draw(pos, modelview);
-  }
-
-  void set_pos(const Vector2f&amp; pos_)
-  {
-    pos = pos_;
-  }
-
-private:
-  Sprite3DDrawingRequest(const Sprite3DDrawingRequest&amp;);
-  Sprite3DDrawingRequest&amp; operator=(const Sprite3DDrawingRequest&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/tile/tile_map.cpp
===================================================================
--- trunk/windstille/src/tile/tile_map.cpp	2009-08-28 15:24:20 UTC (rev 3101)
+++ trunk/windstille/src/tile/tile_map.cpp	2009-08-28 15:42:24 UTC (rev 3102)
@@ -26,7 +26,7 @@
 #include &quot;tile/tile.hpp&quot;
 #include &quot;tile/tile_factory.hpp&quot;
 #include &quot;screen/view.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;scenegraph/vertex_array_drawing_request.hpp&quot;
 
 TileMap::TileMap(FileReader&amp; props)
   : field(),


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002098.html">[Windstille-commit] r3101 - in trunk/windstille/src: display objects
</A></li>
	<LI>Next message: <A HREF="002100.html">[Windstille-commit] r3103 - in trunk/windstille/src: display engine	objects particles scenegraph sprite3d tile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2099">[ date ]</a>
              <a href="thread.html#2099">[ thread ]</a>
              <a href="subject.html#2099">[ subject ]</a>
              <a href="author.html#2099">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
