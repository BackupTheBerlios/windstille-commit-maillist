<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r3006 - in trunk/windstille/src: app editor	engine hud objects screen sprite2d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3006%20-%20in%20trunk/windstille/src%3A%20app%20editor%0A%09engine%20hud%20objects%20screen%20sprite2d&In-Reply-To=%3C200908221527.n7MFRMAL008942%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002002.html">
   <LINK REL="Next"  HREF="002004.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r3006 - in trunk/windstille/src: app editor	engine hud objects screen sprite2d</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3006%20-%20in%20trunk/windstille/src%3A%20app%20editor%0A%09engine%20hud%20objects%20screen%20sprite2d&In-Reply-To=%3C200908221527.n7MFRMAL008942%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r3006 - in trunk/windstille/src: app editor	engine hud objects screen sprite2d">grumbel at mail.berlios.de
       </A><BR>
    <I>Sat Aug 22 17:27:22 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002002.html">[Windstille-commit] r3005 - in trunk/windstille/src: app engine	screen scripting
</A></li>
        <LI>Next message: <A HREF="002004.html">[Windstille-commit] r3007 - trunk/windstille/src/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2003">[ date ]</a>
              <a href="thread.html#2003">[ thread ]</a>
              <a href="subject.html#2003">[ subject ]</a>
              <a href="author.html#2003">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-08-22 17:27:18 +0200 (Sat, 22 Aug 2009)
New Revision: 3006

Modified:
   trunk/windstille/src/app/menu_manager.cpp
   trunk/windstille/src/app/menu_manager.hpp
   trunk/windstille/src/app/windstille_main.cpp
   trunk/windstille/src/editor/sprite_object_model.cpp
   trunk/windstille/src/engine/sector.cpp
   trunk/windstille/src/hud/dialog_manager.cpp
   trunk/windstille/src/hud/inventory.cpp
   trunk/windstille/src/hud/pda.cpp
   trunk/windstille/src/objects/bomb.cpp
   trunk/windstille/src/objects/box.cpp
   trunk/windstille/src/objects/elevator.cpp
   trunk/windstille/src/objects/hedgehog.cpp
   trunk/windstille/src/objects/laser_pointer.cpp
   trunk/windstille/src/objects/nightvision.cpp
   trunk/windstille/src/objects/scriptable_object.cpp
   trunk/windstille/src/objects/spider_mine.cpp
   trunk/windstille/src/objects/vrdummy.cpp
   trunk/windstille/src/screen/particle_viewer.cpp
   trunk/windstille/src/screen/particle_viewer.hpp
   trunk/windstille/src/screen/sprite2dview.cpp
   trunk/windstille/src/screen/sprite2dview.hpp
   trunk/windstille/src/screen/sprite3dview.cpp
   trunk/windstille/src/screen/sprite3dview.hpp
   trunk/windstille/src/screen/title_screen.cpp
   trunk/windstille/src/sprite2d/data.cpp
   trunk/windstille/src/sprite2d/data.hpp
   trunk/windstille/src/sprite2d/manager.cpp
   trunk/windstille/src/sprite2d/manager.hpp
   trunk/windstille/src/sprite2d/sprite.cpp
   trunk/windstille/src/sprite2d/sprite.hpp
Log:
Integrated Pathname() some more

Modified: trunk/windstille/src/app/menu_manager.cpp
===================================================================
--- trunk/windstille/src/app/menu_manager.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/app/menu_manager.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -165,23 +165,23 @@
 {
   gui::Menu menu(&quot;Select Model&quot;, create_centered_rect(550, 376));
   
-  std::vector&lt;std::string&gt; models;
-  models.push_back(&quot;models/characters/bob/bob.wsprite&quot;);
-  models.push_back(&quot;models/characters/jane/jane.wsprite&quot;);
-  models.push_back(&quot;models/characters/monster/monster.wsprite&quot;);
-  models.push_back(&quot;models/characters/powersuit/powersuit.wsprite&quot;);
-  models.push_back(&quot;models/characters/sophie/sophie.wsprite&quot;);
-  models.push_back(&quot;models/characters/spider/spider.wsprite&quot;);
-  models.push_back(&quot;models/characters/vrdummy/vrdummy.wsprite&quot;);
-  models.push_back(&quot;models/characters/yagor/yagor.wsprite&quot;);
-  models.push_back(&quot;models/objects/grenade/grenade.wsprite&quot;);
-  models.push_back(&quot;models/objects/pistol/pistol.wsprite&quot;);
-  models.push_back(&quot;models/vehicles/shuttle/shuttle.wsprite&quot;);
-  models.push_back(&quot;models/vehicles/train/train.wsprite&quot;); 
+  std::vector&lt;Pathname&gt; models;
+  models.push_back(Pathname(&quot;models/characters/bob/bob.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/jane/jane.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/monster/monster.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/powersuit/powersuit.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/sophie/sophie.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/spider/spider.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/vrdummy/vrdummy.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/characters/yagor/yagor.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/objects/grenade/grenade.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/objects/pistol/pistol.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/vehicles/shuttle/shuttle.wsprite&quot;));
+  models.push_back(Pathname(&quot;models/vehicles/train/train.wsprite&quot;)); 
 
-  for(std::vector&lt;std::string&gt;::iterator i = models.begin(); i != models.end(); ++i)
+  for(std::vector&lt;Pathname&gt;::const_iterator i = models.begin(); i != models.end(); ++i)
     {
-      menu.add_button(*i, boost::bind(&amp;MenuManager::menu_show_model, std::string(*i)));
+      menu.add_button(i-&gt;get_raw_path(), boost::bind(&amp;MenuManager::menu_show_model, *i));
     }
   
   menu.show();
@@ -192,14 +192,14 @@
 {
   gui::Menu menu(&quot;Particle Systems&quot;, create_centered_rect(400, 340));
 
-  std::vector&lt;std::string&gt; scenarios;
-  scenarios.push_back(&quot;particlesystems/fire.particles&quot;);
-  scenarios.push_back(&quot;particlesystems/water.particles&quot;);
+  std::vector&lt;Pathname&gt; scenarios;
+  scenarios.push_back(Pathname(&quot;particlesystems/fire.particles&quot;));
+  scenarios.push_back(Pathname(&quot;particlesystems/water.particles&quot;));
   
-  for(std::vector&lt;std::string&gt;::iterator i = scenarios.begin(); i != scenarios.end(); ++i)
-    {
-      menu.add_button(*i, boost::bind(&amp;MenuManager::menu_show_particle_system, *i));
-    }
+  for(std::vector&lt;Pathname&gt;::const_iterator i = scenarios.begin(); i != scenarios.end(); ++i)
+  {
+    menu.add_button(i-&gt;get_raw_path(), boost::bind(&amp;MenuManager::menu_show_particle_system, *i));
+  }
 
   menu.show();
 }
@@ -385,11 +385,11 @@
 // Callbacks
 
 void
-MenuManager::menu_show_model(const std::string&amp; model)
+MenuManager::menu_show_model(const Pathname&amp; filename)
 {
   std::auto_ptr&lt;Sprite3DView&gt; sprite3dview(new Sprite3DView());
 
-  sprite3dview-&gt;set_model(model);
+  sprite3dview-&gt;set_model(filename);
 
   // Launching Sprite3DView instead of game
   screen_manager.push_screen(sprite3dview.release());
@@ -397,10 +397,10 @@
 }
 
 void
-MenuManager::menu_show_particle_system(const std::string&amp; file)
+MenuManager::menu_show_particle_system(const Pathname&amp; filename)
 {
   std::auto_ptr&lt;ParticleViewer&gt; particle_viewer(new ParticleViewer());
-  particle_viewer-&gt;load(file);
+  particle_viewer-&gt;load(filename);
 
   screen_manager.push_screen(particle_viewer.release());
   screen_manager.clear_overlay();

Modified: trunk/windstille/src/app/menu_manager.hpp
===================================================================
--- trunk/windstille/src/app/menu_manager.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/app/menu_manager.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -68,12 +68,12 @@
   static void menu_music_volume(int i);
 
   static void menu_ambient_light(int i, int component);
-  static void menu_start_scenario(const Pathname&amp; scenario);
-  static void menu_show_model(const std::string&amp; scenario);
+  static void menu_start_scenario(const Pathname&amp; filename);
+  static void menu_show_model(const Pathname&amp; filename);
   static void menu_show_geometry_test();
   static void menu_show_armature_test();
   static void menu_show_navigation_test();
-  static void menu_show_particle_system(const std::string&amp; file);
+  static void menu_show_particle_system(const Pathname&amp; filename);
   static void menu_gamma(int i);
   static void menu_wiimote();
 };

Modified: trunk/windstille/src/app/windstille_main.cpp
===================================================================
--- trunk/windstille/src/app/windstille_main.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/app/windstille_main.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -118,27 +118,24 @@
 
 void
 WindstilleMain::run()
-{
-  if (debug) 
-    std::cout &lt;&lt; &quot;Starting file: '&quot; &lt;&lt; config.get_string(&quot;levelfile&quot;) &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-    
+{  
   if (config.get&lt;std::string&gt;(&quot;levelfile&quot;).is_set())
   {
-    // FIXME: Looks a little hacky, doesn't it?
-    std::string leveldir = dirname(config.get_string(&quot;levelfile&quot;));
-    PHYSFS_addToSearchPath(leveldir.c_str(), true);
-    std::string levelfile = basename(config.get_string(&quot;levelfile&quot;));
+    Pathname filename(config.get_string(&quot;levelfile&quot;), Pathname::kSysPath);
 
+    if (debug) 
+      std::cout &lt;&lt; &quot;Starting file: &quot; &lt;&lt; filename &lt;&lt; std::endl;
+
     // FIXME: file-type &quot;detection&quot; is pretty basic, only works
     // with s-expr and nothing else
-    std::string file_type = FileReader::parse(levelfile).get_name();
+    std::string file_type = FileReader::parse(filename).get_name();
 
     if (file_type == &quot;sprite3d&quot;) // FIXME: sprite3d isn't actually a sexpr file
     {
       std::auto_ptr&lt;Sprite3DView&gt; sprite3dview(new Sprite3DView());
 
-      if (!levelfile.empty())
-        sprite3dview-&gt;set_model(levelfile);
+      if (!filename.empty())
+        sprite3dview-&gt;set_model(filename);
 
       // Launching Sprite3DView instead of game
       screen_manager.push_screen(sprite3dview.release());
@@ -147,8 +144,8 @@
     {
       std::auto_ptr&lt;Sprite2DView&gt; sprite2dview(new Sprite2DView());
 
-      if (!levelfile.empty())
-        sprite2dview-&gt;set_sprite(levelfile);
+      if (!filename.empty())
+        sprite2dview-&gt;set_sprite(filename);
 
       // Launching Sprite2DView instead of game
       screen_manager.push_screen(sprite2dview.release());
@@ -156,13 +153,13 @@
     else if (file_type == &quot;particle-systems&quot;)
     {
       ParticleViewer* particle_viewer = new ParticleViewer();
-      if (!levelfile.empty())
-        particle_viewer-&gt;load(levelfile);
+      if (!filename.empty())
+        particle_viewer-&gt;load(filename);
       screen_manager.push_screen(particle_viewer);
     }
     else if (file_type == &quot;windstille-sector&quot;)
     {
-      screen_manager.push_screen(new GameSession(Pathname(levelfile)));
+      screen_manager.push_screen(new GameSession(filename));
     }
     else
     {

Modified: trunk/windstille/src/editor/sprite_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/sprite_object_model.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/editor/sprite_object_model.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -16,6 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
+#include &quot;util/pathname.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;sprite_object_model.hpp&quot;
 
@@ -23,7 +24,7 @@
                                      const std::string&amp; path_)
   : ObjectModel(name_, rel_pos_),
     path(path_),
-    sprite(path_)
+    sprite(Pathname(path_))
 {
 }
 

Modified: trunk/windstille/src/engine/sector.cpp
===================================================================
--- trunk/windstille/src/engine/sector.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/engine/sector.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -310,7 +310,7 @@
 Sector::get_directory() const
 {
   // FIXME: Not pretty
-  std::string directory = filename.get_sys_path();
+  std::string directory = filename.get_physfs_path();
   directory.erase(directory.rfind('/')+1);
   return directory;
 }

Modified: trunk/windstille/src/hud/dialog_manager.cpp
===================================================================
--- trunk/windstille/src/hud/dialog_manager.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/hud/dialog_manager.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -16,15 +16,18 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
+#include &quot;hud/dialog_manager.hpp&quot;
+
 #include &lt;iostream&gt;
+
 #include &quot;font/fonts.hpp&quot;
 #include &quot;screen/game_session.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
-#include &quot;dialog_manager.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;display/text_area.hpp&quot;
 #include &quot;display/display.hpp&quot;
+#include &quot;util/pathname.hpp&quot;
 #include &quot;app/config.hpp&quot;
 
 DialogManager* DialogManager::current_ = 0;
@@ -43,7 +46,7 @@
 { 
   delay     = 0.0;
   alignment = alignment_;
-  portrait  = Sprite(portrait_);
+  portrait  = Sprite(Pathname(portrait_));
   portrait.set_scale(0.65f);
   text      = text_;
   caption = false;

Modified: trunk/windstille/src/hud/inventory.cpp
===================================================================
--- trunk/windstille/src/hud/inventory.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/hud/inventory.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -16,14 +16,17 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
+#include &quot;hud/inventory.hpp&quot;
+
 #include &lt;iostream&gt;
 #include &lt;vector&gt;
+
+#include &quot;font/fonts.hpp&quot;
+#include &quot;input/controller.hpp&quot;
+#include &quot;input/input_manager.hpp&quot;
 #include &quot;screen/game_session.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;inventory.hpp&quot;
+#include &quot;util/pathname.hpp&quot;
 
 class InventoryItem
 {
@@ -32,7 +35,7 @@
   Sprite sprite;
   
   InventoryItem(const std::string&amp; name, const std::string&amp; filename)
-    : name(name), sprite(filename)
+    : name(name), sprite(Pathname(filename))
   {
   }
 };
@@ -69,8 +72,8 @@
 Inventory::Inventory()
   : impl(new InventoryImpl())
 {
-  impl-&gt;slot = Sprite(&quot;images/inventory/slot.sprite&quot;);
-  impl-&gt;slothighlight = Sprite(&quot;images/inventory/slothighlight.sprite&quot;);
+  impl-&gt;slot = Sprite(Pathname(&quot;images/inventory/slot.sprite&quot;));
+  impl-&gt;slothighlight = Sprite(Pathname(&quot;images/inventory/slothighlight.sprite&quot;));
   impl-&gt;moving = false;
   impl-&gt;add_angle = 0.0f;
   impl-&gt;current_item = 0;

Modified: trunk/windstille/src/hud/pda.cpp
===================================================================
--- trunk/windstille/src/hud/pda.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/hud/pda.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -41,7 +41,7 @@
     state(PDA_OBJECTIVES),
     old_state(PDA_NONE)
 { 
-  background = Sprite(&quot;images/pda/pda.sprite&quot;);
+  background = Sprite(Pathname(&quot;images/pda/pda.sprite&quot;));
 
   ui_area.reset(new TextArea(Rectf(pos + Vector2f(40.0f, 50.0f), 
                                    Sizef(315.0f, 435.0f)).grow(-12.0f), false));

Modified: trunk/windstille/src/objects/bomb.cpp
===================================================================
--- trunk/windstille/src/objects/bomb.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/bomb.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -21,11 +21,11 @@
 #include &quot;bomb.hpp&quot;
 
 Bomb::Bomb(int x, int y)
-  : sprite(&quot;images/bomb.sprite&quot;),
-    explo(&quot;images/explo.sprite&quot;),
-    light(&quot;images/bomblight.sprite&quot;),
-    highlight(&quot;images/bombhighlight.sprite&quot;),
-    explolight(&quot;images/explolight.sprite&quot;),
+  : sprite(Pathname(&quot;images/bomb.sprite&quot;)),
+    explo(Pathname(&quot;images/explo.sprite&quot;)),
+    light(Pathname(&quot;images/bomblight.sprite&quot;)),
+    highlight(Pathname(&quot;images/bombhighlight.sprite&quot;)),
+    explolight(Pathname(&quot;images/explolight.sprite&quot;)),
     pos(x, int(y/TILE_SIZE+1)*TILE_SIZE),
     count(2.0f),
     state(COUNTDOWN),

Modified: trunk/windstille/src/objects/box.cpp
===================================================================
--- trunk/windstille/src/objects/box.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/box.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -45,7 +45,7 @@
   if(spritename == &quot;&quot;)
     throw std::runtime_error(&quot;No sprite name specified in Box&quot;);
   
-  sprite = Sprite(spritename);
+  sprite = Sprite(Pathname(spritename));
   
   colobj = new CollisionObject(this, Rectf(0, 0, width, height));
   colobj-&gt;set_velocity(vel);

Modified: trunk/windstille/src/objects/elevator.cpp
===================================================================
--- trunk/windstille/src/objects/elevator.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/elevator.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -33,7 +33,7 @@
   if(spritename == &quot;&quot;)
     throw std::runtime_error(&quot;No sprite name specified in Elevator&quot;);
 
-  sprite = Sprite(spritename);
+  sprite = Sprite(Pathname(spritename));
   size  = Size(128, 64);
   colobject = new CollisionObject(this, Rectf(Vector2f(0,0), size));
   Sector::current()-&gt;get_collision_engine()-&gt;add(colobject);

Modified: trunk/windstille/src/objects/hedgehog.cpp
===================================================================
--- trunk/windstille/src/objects/hedgehog.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/hedgehog.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -22,10 +22,10 @@
 #include &quot;hedgehog.hpp&quot;
 
 Hedgehog::Hedgehog(FileReader&amp; props)
-  : sprite(&quot;images/hedgehog.sprite&quot;),
-    die_sprite(&quot;images/hedgehog_die1.sprite&quot;),
-    light(&quot;images/hedgehog_light.sprite&quot;),
-    highlight(&quot;images/hedgehog_highlight.sprite&quot;)
+  : sprite(Pathname(&quot;images/hedgehog.sprite&quot;)),
+    die_sprite(Pathname(&quot;images/hedgehog_die1.sprite&quot;)),
+    light(Pathname(&quot;images/hedgehog_light.sprite&quot;)),
+    highlight(Pathname(&quot;images/hedgehog_highlight.sprite&quot;))
 {
   props.get(&quot;name&quot;, name);
   props.get(&quot;pos&quot;,  pos);

Modified: trunk/windstille/src/objects/laser_pointer.cpp
===================================================================
--- trunk/windstille/src/objects/laser_pointer.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/laser_pointer.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -26,8 +26,8 @@
 LaserPointer::LaserPointer()
 {
   noise = Texture(&quot;images/noise2.png&quot;);
-  laserpointer = Sprite(&quot;images/laserpointer.sprite&quot;);
-  laserpointer_light = Sprite(&quot;images/laserpointer_light.sprite&quot;);
+  laserpointer = Sprite(Pathname(&quot;images/laserpointer.sprite&quot;));
+  laserpointer_light = Sprite(Pathname(&quot;images/laserpointer_light.sprite&quot;));
   laserpointer_light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
   noise.set_wrap(GL_REPEAT);
   noise.set_filter(GL_LINEAR);

Modified: trunk/windstille/src/objects/nightvision.cpp
===================================================================
--- trunk/windstille/src/objects/nightvision.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/nightvision.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -25,7 +25,7 @@
 #include &quot;nightvision.hpp&quot;
 
 Nightvision::Nightvision(FileReader&amp; /*props*/)
-  : nightvision(&quot;images/nightvision.sprite&quot;)
+  : nightvision(Pathname(&quot;images/nightvision.sprite&quot;))
 {
   name = &quot;nightvision&quot;;
   noise = Texture(&quot;images/noise.png&quot;);

Modified: trunk/windstille/src/objects/scriptable_object.cpp
===================================================================
--- trunk/windstille/src/objects/scriptable_object.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/scriptable_object.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -48,17 +48,17 @@
     set_useable(true);
   
   if(spritename != &quot;&quot;)
-    sprite = Sprite(spritename);
+    sprite = Sprite(Pathname(spritename));
   
   if (highlightname != &quot;&quot;)
     {
-      highlight = Sprite(highlightname);
+      highlight = Sprite(Pathname(highlightname));
       highlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
     }
 
   if (lightname != &quot;&quot;)
     {
-      light = Sprite(lightname);
+      light = Sprite(Pathname(lightname));
       light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
     }
     

Modified: trunk/windstille/src/objects/spider_mine.cpp
===================================================================
--- trunk/windstille/src/objects/spider_mine.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/spider_mine.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -21,13 +21,13 @@
 #include &quot;sprite2d/manager.hpp&quot;
 
 SpiderMine::SpiderMine(FileReader&amp; props)
-  : explode(&quot;images/explosion.sprite&quot;),
-    explode_light(&quot;images/explolight.sprite&quot;)
+  : explode(Pathname(&quot;images/explosion.sprite&quot;)),
+    explode_light(Pathname(&quot;images/explolight.sprite&quot;))
 {
   props.get(&quot;name&quot;, name);
   props.get(&quot;pos&quot;,  pos);
     
-  sprite = Sprite(&quot;images/spider_mine.sprite&quot;);
+  sprite = Sprite(Pathname(&quot;images/spider_mine.sprite&quot;));
   //sprite.set_scale(.5, .5);
   initial_position = pos;
   walk_speed = 160;

Modified: trunk/windstille/src/objects/vrdummy.cpp
===================================================================
--- trunk/windstille/src/objects/vrdummy.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/objects/vrdummy.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -27,7 +27,7 @@
   sprite = Sprite3D(Pathname(&quot;models/characters/vrdummy/vrdummy.wsprite&quot;));
   rotation = 0;
 
-  highlight = Sprite(&quot;images/hedgehog_highlight.sprite&quot;);
+  highlight = Sprite(Pathname(&quot;images/hedgehog_highlight.sprite&quot;));
   highlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
   
   jump_time = 0;

Modified: trunk/windstille/src/screen/particle_viewer.cpp
===================================================================
--- trunk/windstille/src/screen/particle_viewer.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/particle_viewer.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -37,7 +37,7 @@
 
 ParticleViewer::ParticleViewer()
 {
-  background = Sprite(&quot;images/greychess.sprite&quot;);
+  background = Sprite(Pathname(&quot;images/greychess.sprite&quot;));
 }
 
 ParticleViewer::~ParticleViewer()
@@ -45,7 +45,7 @@
 }
 
 void
-ParticleViewer::load(const std::string&amp; filename)
+ParticleViewer::load(const Pathname&amp; filename)
 {
   std::cout &lt;&lt; &quot;ParticleViewer: loading &quot; &lt;&lt; filename &lt;&lt; std::endl;
 

Modified: trunk/windstille/src/screen/particle_viewer.hpp
===================================================================
--- trunk/windstille/src/screen/particle_viewer.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/particle_viewer.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -51,7 +51,7 @@
   
   void draw();
   void update(float delta, const Controller&amp; controller);
-  void load(const std::string&amp; filename);
+  void load(const Pathname&amp; filename);
 
 private:
   ParticleViewer (const ParticleViewer&amp;);

Modified: trunk/windstille/src/screen/sprite2dview.cpp
===================================================================
--- trunk/windstille/src/screen/sprite2dview.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/sprite2dview.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -251,7 +251,7 @@
 
       do {
         try {
-          new_sprite = Sprite(dir[index]);
+          new_sprite = Sprite(Pathname(dir[index]));
           retry = false;
         } catch(std::exception&amp; e) {
           // FIXME: won't work in combination with shuffle
@@ -389,7 +389,7 @@
 }
 
 void
-Sprite2DView::set_sprite(const std::string&amp; filename)
+Sprite2DView::set_sprite(const Pathname&amp; filename)
 {
   sprite = Sprite(filename);
   ignore_delta = true;

Modified: trunk/windstille/src/screen/sprite2dview.hpp
===================================================================
--- trunk/windstille/src/screen/sprite2dview.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/sprite2dview.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -77,7 +77,7 @@
   void next_image(int i = 1);
   void prev_image(int i = 1) { next_image(-i); }
 
-  void set_sprite(const std::string&amp; filename);
+  void set_sprite(const Pathname&amp; filename);
   void prepare_sprite(Sprite&amp; sprite);
 
 private:

Modified: trunk/windstille/src/screen/sprite3dview.cpp
===================================================================
--- trunk/windstille/src/screen/sprite3dview.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/sprite3dview.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -46,9 +46,9 @@
 }
 
 void
-Sprite3DView::set_model(const std::string&amp; filename)
+Sprite3DView::set_model(const Pathname&amp; filename)
 {
-  sprite  = Sprite3D(Pathname(filename));
+  sprite  = Sprite3D(filename);
   actions = sprite.get_actions();
 }
 

Modified: trunk/windstille/src/screen/sprite3dview.hpp
===================================================================
--- trunk/windstille/src/screen/sprite3dview.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/sprite3dview.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -45,7 +45,7 @@
   void draw();
   void update(float delta, const Controller&amp; controller);
 
-  void set_model(const std::string&amp; filename);
+  void set_model(const Pathname&amp; filename);
   
   void handle_event(const SDL_Event&amp; );
 

Modified: trunk/windstille/src/screen/title_screen.cpp
===================================================================
--- trunk/windstille/src/screen/title_screen.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/screen/title_screen.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -16,14 +16,16 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
+#include &quot;screen/title_screen.hpp&quot;
+
 #include &lt;iostream&gt;
+
 #include &quot;display/display.hpp&quot;
 #include &quot;app/menu_manager.hpp&quot;
-#include &quot;title_screen.hpp&quot;
 
 TitleScreen::TitleScreen()
 {
-  background = Sprite(&quot;images/titlescreen.sprite&quot;);
+  background = Sprite(Pathname(&quot;images/titlescreen.sprite&quot;));
   background.set_scale(std::max(float(Display::get_width())  / background.get_width(),
                                 float(Display::get_height()) / background.get_height()));
 }

Modified: trunk/windstille/src/sprite2d/data.cpp
===================================================================
--- trunk/windstille/src/sprite2d/data.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/sprite2d/data.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -28,9 +28,10 @@
 #include &quot;display/surface.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
 
-SpriteData::SpriteData(const std::string&amp; filename)
+SpriteData::SpriteData(const Pathname&amp; pathname)
 {
-  if (PHYSFS_exists(filename.c_str()))
+  std::string filename = pathname.get_physfs_path();
+  if (pathname.exists())
     {
       if (has_suffix(filename, &quot;.sprite&quot;))
         {

Modified: trunk/windstille/src/sprite2d/data.hpp
===================================================================
--- trunk/windstille/src/sprite2d/data.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/sprite2d/data.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -47,7 +47,7 @@
   SpriteAction* parse_action(const std::string&amp; dir, FileReader&amp; reader);
 
 public:
-  SpriteData(const std::string&amp; filename);
+  SpriteData(const Pathname&amp; filename);
   virtual ~SpriteData();
 
   typedef std::vector&lt;SpriteAction*&gt; Actions;

Modified: trunk/windstille/src/sprite2d/manager.cpp
===================================================================
--- trunk/windstille/src/sprite2d/manager.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/sprite2d/manager.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -22,6 +22,7 @@
 #include &lt;iostream&gt;
 #include &lt;assert.h&gt;
 
+#include &quot;util/pathname.hpp&quot;
 #include &quot;sprite2d/data.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 
@@ -38,7 +39,7 @@
 }
 
 SpriteDataPtr
-SpriteManager::create_data(const std::string&amp; filename)
+SpriteManager::create_data(const Pathname&amp; filename)
 {
   Datas::iterator i = datas.find(filename);
   if(i != datas.end())

Modified: trunk/windstille/src/sprite2d/manager.hpp
===================================================================
--- trunk/windstille/src/sprite2d/manager.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/sprite2d/manager.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -24,7 +24,9 @@
 #include &lt;map&gt;
 #include &lt;boost/shared_ptr.hpp&gt;
 
+class Pathname;
 class SpriteData;
+
 typedef boost::shared_ptr&lt;SpriteData&gt; SpriteDataPtr;
 
 class SpriteManager
@@ -38,12 +40,12 @@
   SpriteManager();
   ~SpriteManager();
 
-  SpriteDataPtr create_data(const std::string&amp; filename);
+  SpriteDataPtr create_data(const Pathname&amp; filename);
   
   /** Removes all cached Sprites that are no longer in use */
   void cleanup();
 private:
-  typedef std::map&lt;std::string, SpriteDataPtr&gt; Datas;
+  typedef std::map&lt;Pathname, SpriteDataPtr&gt; Datas;
   Datas datas;
 };
 

Modified: trunk/windstille/src/sprite2d/sprite.cpp
===================================================================
--- trunk/windstille/src/sprite2d/sprite.cpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/sprite2d/sprite.cpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -33,7 +33,7 @@
 {  
 }
 
-Sprite::Sprite(const std::string&amp; filename)
+Sprite::Sprite(const Pathname&amp; filename)
 {
   data = SpriteManager::current()-&gt;create_data(filename);
 

Modified: trunk/windstille/src/sprite2d/sprite.hpp
===================================================================
--- trunk/windstille/src/sprite2d/sprite.hpp	2009-08-22 15:03:41 UTC (rev 3005)
+++ trunk/windstille/src/sprite2d/sprite.hpp	2009-08-22 15:27:18 UTC (rev 3006)
@@ -23,6 +23,8 @@
 #include &lt;string&gt;
 #include &lt;GL/glew.h&gt;
 #include &lt;GL/gl.h&gt;
+
+#include &quot;util/pathname.hpp&quot;
 #include &quot;display/color.hpp&quot;
 #include &quot;display/surface.hpp&quot;
 #include &quot;math/vector2f.hpp&quot;
@@ -60,7 +62,7 @@
   /** Load a sprite from file or in-case the .sprite file isn't found
       search for a .png with the same name and use that as a simple
       one-file sprite */
-  Sprite(const std::string&amp; filename);
+  Sprite(const Pathname&amp; filename);
   Sprite(const SpriteDataPtr data);
   ~Sprite();
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002002.html">[Windstille-commit] r3005 - in trunk/windstille/src: app engine	screen scripting
</A></li>
	<LI>Next message: <A HREF="002004.html">[Windstille-commit] r3007 - trunk/windstille/src/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2003">[ date ]</a>
              <a href="thread.html#2003">[ thread ]</a>
              <a href="subject.html#2003">[ subject ]</a>
              <a href="author.html#2003">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
