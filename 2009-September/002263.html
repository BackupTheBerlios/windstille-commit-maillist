<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r3266 - in tags/windstille-0.2.0/src: . input
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3266%20-%20in%20tags/windstille-0.2.0/src%3A%20.%20input&In-Reply-To=%3C200909271138.n8RBcgTN025341%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002262.html">
   <LINK REL="Next"  HREF="002264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r3266 - in tags/windstille-0.2.0/src: . input</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3266%20-%20in%20tags/windstille-0.2.0/src%3A%20.%20input&In-Reply-To=%3C200909271138.n8RBcgTN025341%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r3266 - in tags/windstille-0.2.0/src: . input">grumbel at mail.berlios.de
       </A><BR>
    <I>Sun Sep 27 13:38:42 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002262.html">[Windstille-commit] r3265 - trunk/windstille/src/editor
</A></li>
        <LI>Next message: <A HREF="002264.html">[Windstille-commit] r3267 - in tags/windstille-0.2.0: . src	src/collision src/editor src/input
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2263">[ date ]</a>
              <a href="thread.html#2263">[ thread ]</a>
              <a href="subject.html#2263">[ subject ]</a>
              <a href="author.html#2263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-09-27 13:38:37 +0200 (Sun, 27 Sep 2009)
New Revision: 3266

Added:
   tags/windstille-0.2.0/src/input/
   tags/windstille-0.2.0/src/input/Makefile.am
   tags/windstille-0.2.0/src/input/axis_button.cxx
   tags/windstille-0.2.0/src/input/axis_button.hxx
   tags/windstille-0.2.0/src/input/axis_factory.cxx
   tags/windstille-0.2.0/src/input/axis_factory.hxx
   tags/windstille-0.2.0/src/input/button_axis.cxx
   tags/windstille-0.2.0/src/input/button_axis.hxx
   tags/windstille-0.2.0/src/input/button_factory.cxx
   tags/windstille-0.2.0/src/input/button_factory.hxx
   tags/windstille-0.2.0/src/input/controller.cxx
   tags/windstille-0.2.0/src/input/controller.hxx
   tags/windstille-0.2.0/src/input/input_axis.hxx
   tags/windstille-0.2.0/src/input/input_axis_input_device.cxx
   tags/windstille-0.2.0/src/input/input_axis_input_device.hxx
   tags/windstille-0.2.0/src/input/input_button.hxx
   tags/windstille-0.2.0/src/input/input_button_input_device.cxx
   tags/windstille-0.2.0/src/input/input_button_input_device.hxx
   tags/windstille-0.2.0/src/input/input_event.hxx
   tags/windstille-0.2.0/src/input/input_manager.cxx
   tags/windstille-0.2.0/src/input/input_manager.hxx
   tags/windstille-0.2.0/src/input/input_manager_custom.cxx
   tags/windstille-0.2.0/src/input/input_manager_custom.hxx
   tags/windstille-0.2.0/src/input/input_manager_impl.cxx
   tags/windstille-0.2.0/src/input/input_manager_impl.hxx
   tags/windstille-0.2.0/src/input/input_manager_player.cxx
   tags/windstille-0.2.0/src/input/input_manager_player.hxx
   tags/windstille-0.2.0/src/input/input_recorder.cxx
   tags/windstille-0.2.0/src/input/input_recorder.hxx
   tags/windstille-0.2.0/src/input/multi_button.cxx
   tags/windstille-0.2.0/src/input/multi_button.hxx
Log:
Made external input directory local (from feuerkraft rev 342)

Added: tags/windstille-0.2.0/src/input/Makefile.am
===================================================================
--- tags/windstille-0.2.0/src/input/Makefile.am	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/Makefile.am	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,37 @@
+noinst_LIBRARIES = libwindstille_input.a
+
+libwindstille_input_a_CPPFLAGS = \
+  @WINDSTILLE_CFLAGS@
+
+libwindstille_input_a_SOURCES = \
+  controller.hxx \
+  controller.cxx \
+  input_event.hxx \
+  input_manager.hxx \
+  input_manager.cxx \
+  input_manager_impl.hxx \
+  input_manager_impl.cxx \
+  input_manager_custom.hxx \
+  input_manager_custom.cxx \
+  input_manager_player.hxx \
+  input_manager_player.cxx \
+  input_button.hxx \
+  input_axis.hxx \
+  input_button_input_device.hxx \
+  input_button_input_device.cxx \
+  input_axis_input_device.hxx \
+  input_axis_input_device.cxx \
+  axis_button.hxx \
+  axis_button.cxx \
+  button_axis.hxx \
+  button_axis.cxx \
+  button_factory.hxx \
+  button_factory.cxx \
+  axis_factory.hxx \
+  axis_factory.cxx \
+  input_recorder.hxx \
+  input_recorder.cxx \
+  multi_button.hxx \
+  multi_button.cxx
+
+# EOF #

Added: tags/windstille-0.2.0/src/input/axis_button.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/axis_button.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/axis_button.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,72 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &quot;input_axis.hxx&quot;
+#include &quot;axis_button.hxx&quot;
+
+AxisButton::AxisButton(InputAxis* axis, bool top)
+  : axis(axis),
+    down(false),
+    top(top)
+{
+  on_axis_move_slot = axis-&gt;on_move().connect(this, &amp;AxisButton::on_axis_move);
+}
+
+AxisButton::~AxisButton()
+{
+}
+
+void
+AxisButton::update(float delta)
+{
+}
+
+void
+AxisButton::on_axis_move(float pos)
+{
+  if (top)
+    {
+      if (down &amp;&amp; pos &lt; 0.5f)
+        {
+          down = false;
+          button_up();
+        }
+      else if (!down &amp;&amp; pos &gt; 0.5f)
+        {
+          down = true;
+          button_down();
+        }
+    }
+  else
+    {
+      if (down &amp;&amp; pos &gt; -0.5f)
+        {
+          down = false;
+          button_up();
+        }
+      else if (!down &amp;&amp; pos &lt; -0.5f)
+        {
+          down = true;
+          button_down();
+        }
+    }
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/axis_button.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/axis_button.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/axis_button.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/axis_button.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,53 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_AXIS_BUTTON_HXX
+#define HEADER_AXIS_BUTTON_HXX
+
+#include &quot;input_button.hxx&quot;
+
+class InputAxis;
+
+/** */
+class AxisButton : public InputButton
+{
+private:
+  CL_Slot on_axis_move_slot;
+  InputAxis* axis;
+  bool down;
+
+  /** true if the range 0..1 should be used to trigger, false if -1..0
+      should be used */
+  bool top;
+public:
+  AxisButton(InputAxis* axis, bool top);
+  ~AxisButton();
+
+  void update(float delta);
+  
+private:
+  void on_axis_move(float pos);
+
+  AxisButton (const AxisButton&amp;);
+  AxisButton&amp; operator= (const AxisButton&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/axis_button.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/axis_factory.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/axis_factory.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/axis_factory.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,79 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;ClanLib/Display/joystick.h&gt;
+#include &quot;input_axis_input_device.hxx&quot;
+#include &quot;../feuerkraft_error.hxx&quot;
+#include &quot;../guile.hxx&quot;
+#include &quot;button_factory.hxx&quot;
+#include &quot;button_axis.hxx&quot;
+#include &quot;axis_factory.hxx&quot;
+
+InputAxis* 
+AxisFactory::create(SCM lst)
+{
+  while(gh_pair_p(lst))
+    {
+      SCM sym  = gh_car(lst);
+      SCM data = gh_cdr(lst);
+      
+      if (gh_equal_p(sym, gh_symbol2scm(&quot;joystick-axis&quot;)))
+        {
+          return create_joystick_axis(data);
+        }
+      if (gh_equal_p(sym, gh_symbol2scm(&quot;button-axis&quot;)))
+        {
+          return create_button_axis(data);
+        }
+      else
+        {
+          throw FeuerkraftError(&quot;AxisFactory::create: parse error&quot;);
+        }
+
+      lst = gh_cdr(lst);
+    }
+  return 0;
+}
+
+InputAxis*
+AxisFactory::create_joystick_axis(SCM lst)
+{
+  int device_num = gh_scm2int(gh_car(lst));
+  int axis_num   = gh_scm2int(gh_cadr(lst));
+
+  if (device_num &gt;= 0 &amp;&amp; device_num &lt; CL_Joystick::get_device_count())
+    return new InputAxisInputDevice(CL_Joystick::get_device(device_num), axis_num);
+  else
+    {
+      throw FeuerkraftError(&quot;Error: AxisFactory::create_joystick_axis: &quot; 
+                            + Guile::scm2string(lst));
+      return 0;
+    }
+}
+
+InputAxis*
+AxisFactory::create_button_axis(SCM lst)
+{
+  InputButton* left  = ButtonFactory::create(gh_car(lst));
+  InputButton* right = ButtonFactory::create(gh_cadr(lst));
+
+  return new ButtonAxis(left, right);
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/axis_factory.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/axis_factory.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/axis_factory.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/axis_factory.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,38 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_AXIS_FACTORY_HXX
+#define HEADER_AXIS_FACTORY_HXX
+
+#include &lt;guile/gh.h&gt;
+#include &quot;input_axis.hxx&quot;
+
+/** */
+class AxisFactory
+{
+public:
+  static InputAxis* create(SCM lst);
+private:
+  static InputAxis* create_joystick_axis(SCM lst);
+  static InputAxis* create_button_axis(SCM lst);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/axis_factory.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/button_axis.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/button_axis.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/button_axis.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,87 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &quot;input_button.hxx&quot;
+#include &quot;button_axis.hxx&quot;
+
+ButtonAxis::ButtonAxis(InputButton* left, InputButton* right)
+  : left(left), right(right)
+{
+  slots.push_back(left-&gt;on_key_down().connect(this, &amp;ButtonAxis::on_left_down));
+  slots.push_back(left-&gt;on_key_up().connect  (this, &amp;ButtonAxis::on_left_up));
+
+  slots.push_back(right-&gt;on_key_down().connect(this, &amp;ButtonAxis::on_right_down));
+  slots.push_back(right-&gt;on_key_up().connect  (this, &amp;ButtonAxis::on_right_up));
+
+  left_state  = false;
+  right_state = false;
+  
+  pos = 0.0f;
+}
+
+void
+ButtonAxis::update(float delta)
+{
+  left-&gt;update(delta);
+  right-&gt;update(delta);
+
+  float new_pos = 0.0f;
+  if (left_state)
+    {
+      new_pos -= 1.0f;
+    }
+  
+  if (right_state)
+    {
+      new_pos += 1.0f;
+    }
+
+  if (new_pos != pos)
+    {
+      pos = new_pos;
+      move(pos);
+    }
+}
+
+void
+ButtonAxis::on_left_up()
+{
+  left_state = false;
+}
+
+void
+ButtonAxis::on_left_down()
+{
+  left_state = true;
+}
+
+void
+ButtonAxis::on_right_up()
+{
+  right_state = false;
+}
+
+void
+ButtonAxis::on_right_down()
+{
+  right_state = true;
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/button_axis.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/button_axis.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/button_axis.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/button_axis.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,50 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_BUTTON_AXIS_HXX
+#define HEADER_BUTTON_AXIS_HXX
+
+#include &quot;input_axis.hxx&quot;
+
+class InputButton;
+
+class ButtonAxis : public InputAxis
+{
+private:
+  InputButton* left;
+  InputButton* right;
+
+  bool left_state;
+  bool right_state;
+  
+  float pos;
+private:
+  void on_left_up();
+  void on_left_down();
+
+  void on_right_up();
+  void on_right_down();
+public:
+  ButtonAxis(InputButton* left, InputButton* right);
+  void update(float delta);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/button_axis.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/button_factory.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/button_factory.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/button_factory.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,111 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;ClanLib/Display/joystick.h&gt;
+#include &lt;ClanLib/Display/keyboard.h&gt;
+#include &lt;ClanLib/Core/System/clanstring.h&gt;
+#include &quot;../guile.hxx&quot;
+#include &quot;../feuerkraft_error.hxx&quot;
+#include &quot;input_button.hxx&quot;
+#include &quot;input_axis.hxx&quot;
+#include &quot;input_button_input_device.hxx&quot;
+#include &quot;axis_factory.hxx&quot;
+#include &quot;axis_button.hxx&quot;
+#include &quot;multi_button.hxx&quot;
+#include &quot;button_factory.hxx&quot;
+
+InputButton* 
+ButtonFactory::create(SCM lst)
+{
+  SCM sym = gh_car(lst);
+
+  if (gh_equal_p(sym, gh_symbol2scm(&quot;joystick-button&quot;)))
+    {
+      return create_joystick_button(gh_cdr(lst));
+    }
+  else if (gh_equal_p(sym, gh_symbol2scm(&quot;keyboard-button&quot;)))
+    {
+      return create_keyboard_button(gh_cdr(lst));
+    }
+  else if (gh_equal_p(sym, gh_symbol2scm(&quot;axis-button&quot;)))
+    {
+      return create_axis_button(gh_cdr(lst));
+    }
+  else if (gh_equal_p(sym, gh_symbol2scm(&quot;multi-button&quot;)))
+    {
+      return create_multi_button(gh_cdr(lst));
+    }
+  else
+    {
+      throw FeuerkraftError(&quot;ButtonFactory::create: parse error: '&quot;
+                            + Guile::scm2string(lst) + &quot;'&quot;);
+    }
+      
+  return 0;
+}
+
+InputButton*
+ButtonFactory::create_axis_button(SCM lst)
+{
+  InputAxis* axis = AxisFactory::create(gh_car(lst));
+  bool top = gh_scm2bool(gh_cadr(lst));
+  
+  return new AxisButton(axis, top);
+}
+
+InputButton*
+ButtonFactory::create_joystick_button(SCM lst)
+{
+  int device_num = gh_scm2int(gh_car(lst));
+  int button_num = gh_scm2int(gh_cadr(lst));
+  
+  if (device_num &gt;= 0 &amp;&amp; device_num &lt; CL_Joystick::get_device_count())
+    return new InputButtonInputDevice(CL_Joystick::get_device(device_num), button_num);
+  else
+    {
+      throw FeuerkraftError(&quot;Error: ButtonFactory::create_joystick_button: device out of range&quot;
+                            + CL_String::to(device_num) + &quot; &quot; + Guile::scm2string(lst));
+    }
+}
+
+InputButton*
+ButtonFactory::create_keyboard_button(SCM lst)
+{
+  std::string key_str = Guile::scm2string(gh_car(lst));
+  int key_num         = CL_Keyboard::get_device().string_to_keyid(key_str);
+
+  // FIXME: No error checking
+  return new InputButtonInputDevice(CL_Keyboard::get_device(), key_num);
+}
+
+InputButton*
+ButtonFactory::create_multi_button(SCM lst)
+{
+  MultiButton* button = new MultiButton();
+  
+  while (!gh_null_p(lst))
+    {
+      button-&gt;add(create(gh_car(lst)));
+      lst = gh_cdr(lst);
+    }
+  
+  return button;
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/button_factory.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/button_factory.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/button_factory.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/button_factory.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,46 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_BUTTON_FACTORY_HXX
+#define HEADER_BUTTON_FACTORY_HXX
+
+#include &lt;guile/gh.h&gt;
+
+class InputButton;
+
+/** */
+class ButtonFactory
+{
+private:
+public:
+  static InputButton* create(SCM lst);
+
+private:
+  static InputButton* create_joystick_button(SCM lst);
+  static InputButton* create_keyboard_button(SCM lst);
+  static InputButton* create_axis_button(SCM lst);
+  static InputButton* create_multi_button(SCM lst);
+
+  ButtonFactory (const ButtonFactory&amp;);
+  ButtonFactory&amp; operator= (const ButtonFactory&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/button_factory.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/controller.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/controller.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/controller.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,90 @@
+//  $Id: controller.cxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &quot;../assert.hxx&quot;
+#include &quot;controller.hxx&quot;
+
+Controller::Controller()
+{
+  buttons.resize(ControllerDef::get_button_count());
+  axes.resize(ControllerDef::get_axis_count());
+}
+
+float
+Controller::get_axis_state(int name) const
+{
+  AssertMsg(name &lt; int(axes.size()), &quot;Controllor: Unknown AxisName&quot;);  
+  return axes[name];
+}
+        
+
+bool
+Controller::get_button_state(int name) const
+{
+  AssertMsg(name &lt; int(buttons.size()), &quot;Controllor: Unknown ButtonName&quot;);  
+  return buttons[name];
+}
+
+void
+Controller::set_axis_state(int name, float pos)
+{
+  AssertMsg(name &lt; static_cast&lt;int&gt;(axes.size()), &quot;Controllor: Unknown AxisName&quot;);
+  axes[name] = pos;
+}
+
+void
+Controller::set_button_state(int name, bool down)
+{
+  AssertMsg(name &lt; static_cast&lt;int&gt;(buttons.size()), &quot;Controller: Unknown ButtonName&quot;);
+  buttons[name] = down;
+}
+
+void
+Controller::add_axis_event(int name, float pos)
+{
+  InputEvent event;
+  event.type = AXIS_EVENT;
+  event.axis.name = name;
+  event.axis.pos  = pos;
+  events.push_back(event);
+}
+
+void
+Controller::add_button_event(int name, bool down)
+{
+  InputEvent event;
+  event.type = BUTTON_EVENT;
+  event.button.name = name;
+  event.button.down = down;
+  events.push_back(event);
+}
+
+InputEventLst
+Controller::get_events() const
+{
+  return events;
+}
+
+void
+Controller::set_events(const InputEventLst&amp; lst)
+{
+  events = lst;
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/controller.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/controller.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/controller.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/controller.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,59 @@
+//  $Id: controller.hxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_CONTROLLER_HXX
+#define HEADER_CONTROLLER_HXX
+
+#include &lt;vector&gt;
+#include &quot;../controller_def.hxx&quot;
+#include &quot;input_event.hxx&quot;
+
+/** The Controller class presents the current state of the controller
+    and the input events that occurred on the controller since the
+    last update */
+class Controller
+{
+private:
+  /** State of all buttons, indexed by ButtonName */
+  std::vector&lt;bool&gt; buttons;
+  
+  /** State of all axis, indexed by AxisName */
+  std::vector&lt;float&gt; axes;
+
+  InputEventLst events;
+
+public:
+  Controller();
+
+  float get_axis_state  (int name) const;
+  bool  get_button_state(int name) const;
+
+  void  set_axis_state  (int name, float pos);
+  void  set_button_state(int name, bool down);
+
+  void add_axis_event  (int name, float pos);
+  void add_button_event(int name, bool down);
+
+  InputEventLst get_events() const;
+  void set_events(const InputEventLst&amp; lst);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/controller.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_axis.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_axis.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_axis.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,42 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_AXIS_HXX
+#define HEADER_INPUT_AXIS_HXX
+
+#include &lt;vector&gt;
+#include &lt;ClanLib/Signals/slot.h&gt;
+#include &lt;ClanLib/Signals/signal_v1.h&gt;
+
+class InputAxis
+{
+protected:
+  std::vector&lt;CL_Slot&gt; slots;
+  CL_Signal_v1&lt;float&gt; move;  
+public:
+  InputAxis() {}
+  virtual ~InputAxis() {}
+
+  virtual void update(float delta) {}
+  CL_Signal_v1&lt;float&gt;&amp; on_move() { return move; }
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_axis.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_axis_input_device.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_axis_input_device.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_axis_input_device.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,38 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;ClanLib/Display/input_event.h&gt;
+#include &quot;input_axis_input_device.hxx&quot;
+
+InputAxisInputDevice::InputAxisInputDevice(CL_InputDevice&amp; dev, int num)
+  : dev(dev), axis_num(num)
+{
+  slots.push_back(dev.sig_axis_move().connect(this, &amp;InputAxisInputDevice::on_axis_move));
+}
+
+void
+InputAxisInputDevice::on_axis_move(const CL_InputEvent&amp; event)
+{
+  if (event.id == axis_num)
+    {
+      move(event.axis_pos);
+    }
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_axis_input_device.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_axis_input_device.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_axis_input_device.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_axis_input_device.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,41 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_AXIS_INPUT_DEVICE_HXX
+#define HEADER_INPUT_AXIS_INPUT_DEVICE_HXX
+
+#include &lt;ClanLib/Display/input_device.h&gt;
+#include &quot;input_axis.hxx&quot;
+
+class InputAxisInputDevice : public InputAxis
+{
+private:
+  CL_InputDevice dev;
+  int axis_num;
+
+  void on_axis_move(const CL_InputEvent&amp; event); 
+
+public:
+  InputAxisInputDevice(CL_InputDevice&amp; dev, int num);
+  void update(float delta) {}
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_axis_input_device.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_button.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_button.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_button.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,46 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_BOTTON_HXX
+#define HEADER_INPUT_BOTTON_HXX
+
+#include &lt;vector&gt;
+#include &lt;ClanLib/Signals/slot.h&gt;
+#include &lt;ClanLib/Signals/signal_v0.h&gt;
+
+class InputButton
+{
+protected:
+  std::vector&lt;CL_Slot&gt; slots;
+  CL_Signal_v0 button_down;
+  CL_Signal_v0 button_up;
+
+public:
+  InputButton() {}
+  virtual ~InputButton() {}
+  
+  virtual void update(float delta) {}
+
+  CL_Signal_v0&amp; on_key_down() { return button_down; }
+  CL_Signal_v0&amp; on_key_up()   { return button_up; }
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_button.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_button_input_device.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_button_input_device.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_button_input_device.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,49 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &lt;ClanLib/Display/input_event.h&gt;
+#include &quot;input_button_input_device.hxx&quot;
+
+InputButtonInputDevice::InputButtonInputDevice(CL_InputDevice&amp; dev_, int keycode_)
+  : dev(dev_), keycode(keycode_)
+{
+  slots.push_back(dev.sig_key_down().connect(this, &amp;InputButtonInputDevice::on_key_down));
+  slots.push_back(dev.sig_key_up().connect(this, &amp;InputButtonInputDevice::on_key_up));
+}
+
+void
+InputButtonInputDevice::on_key_down(const CL_InputEvent&amp; event)
+{
+  if (keycode == event.id)
+    {
+      button_down();
+    }
+}
+
+void
+InputButtonInputDevice::on_key_up(const CL_InputEvent&amp; event)
+{
+  if (keycode == event.id)
+    {
+      button_up();
+    }
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_button_input_device.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_button_input_device.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_button_input_device.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_button_input_device.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,43 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_BOTTON_INPUT_DEVICE_HXX
+#define HEADER_INPUT_BOTTON_INPUT_DEVICE_HXX
+
+#include &lt;ClanLib/Display/input_device.h&gt;
+#include &quot;input_button.hxx&quot;
+
+class InputButtonInputDevice : public InputButton
+{
+private:
+  CL_InputDevice dev;
+  int keycode;
+
+  void on_key_down(const CL_InputEvent&amp; event);
+  void on_key_up(const CL_InputEvent&amp; event);
+
+public:
+  InputButtonInputDevice(CL_InputDevice&amp; dev, int keycode);
+  
+  void update(float delta) {}
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_button_input_device.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_event.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_event.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_event.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,63 @@
+//  $Id: input_event.hxx,v 1.4 2003/10/31 23:24:41 grumbel Exp $
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_EVENT_HXX
+#define HEADER_INPUT_EVENT_HXX
+
+#include &lt;vector&gt;
+
+enum InputEventType { BUTTON_EVENT, AXIS_EVENT };
+
+struct ButtonEvent
+{
+  int name;
+
+  /** true if down, false if up */
+  bool down;
+
+  bool is_down() const { return down; }
+  bool is_up()   const { return !down; }
+};
+
+struct AxisEvent
+{
+  int name;
+
+  /** Pos can be in range from [-1.0, 1.0], some axis will only use [0,1.0] */
+  float pos;
+
+  float get_pos() { return pos; }
+};
+
+struct InputEvent 
+{
+  InputEventType type;
+    
+  union 
+  {
+    struct ButtonEvent button;
+    struct AxisEvent   axis;
+  };
+};
+
+typedef std::vector&lt;InputEvent&gt; InputEventLst;
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_event.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,98 @@
+//  $Id: input_manager.cxx,v 1.4 2003/08/20 00:15:10 grumbel Exp $
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &lt;assert.h&gt;
+#include &lt;stdexcept&gt;
+#include &lt;sstream&gt;
+#include &lt;ClanLib/Display/joystick.h&gt;
+
+#include &quot;../feuerkraft_error.hxx&quot;
+#include &quot;input_manager_custom.hxx&quot;
+#include &quot;input_manager_player.hxx&quot;
+#include &quot;input_manager_impl.hxx&quot;
+#include &quot;input_recorder.hxx&quot;
+#include &quot;input_manager.hxx&quot;
+
+InputManagerImpl* InputManager::impl = 0;
+InputRecorder* InputManager::recorder = 0;
+
+void
+InputManager::init_playback(const std::string&amp; filename)
+{
+  impl = new InputManagerPlayer(filename);
+}
+
+void
+InputManager::init(const std::string&amp; filename)
+{
+  std::cout &lt;&lt; &quot;InputManager::init(&quot; &lt;&lt; filename &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
+  SCM port = scm_open_file(gh_str02scm(filename.c_str()),
+                           gh_str02scm(&quot;r&quot;));
+  SCM lst  = scm_read(port);
+
+  if (gh_equal_p(gh_symbol2scm(&quot;feuerkraft-controller&quot;), gh_car(lst)))
+    {
+      impl = new InputManagerCustom(gh_cdr(lst));
+    }
+  else
+    {
+      throw FeuerkraftError(&quot;Error: not a valid controller file: &quot; + filename);
+    }
+  scm_close_port(port);
+}
+
+void
+InputManager::setup_recorder(const std::string&amp; filename)
+{
+  if (recorder)
+    delete recorder;
+
+  recorder = new InputRecorder(filename);
+}
+
+void 
+InputManager::deinit()
+{
+  delete impl;
+}
+
+void
+InputManager::update(float delta)
+{
+  assert(impl);
+  impl-&gt;update(delta);
+  if (recorder)
+    recorder-&gt;record(get_controller());
+}
+
+Controller
+InputManager::get_controller()
+{
+  assert(impl);
+  return impl-&gt;get_controller();
+}
+
+void
+InputManager::clear()
+{
+  impl-&gt;clear();
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,57 @@
+//  $Id: input_manager.hxx,v 1.3 2003/06/06 18:36:24 grumbel Exp $
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_MANAGER_HXX
+#define HEADER_INPUT_MANAGER_HXX
+
+#include &lt;vector&gt;
+#include &quot;controller.hxx&quot;
+#include &quot;input_event.hxx&quot;
+
+class InputRecorder;
+class InputManagerImpl;
+
+/** */
+class InputManager
+{
+private:
+  static InputManagerImpl* impl;
+  static InputRecorder* recorder;
+public:
+  /** Init the InputManager with the data found in \a filename */
+  static void init(const std::string&amp; filename = std::string());
+
+  /** Init the playback of a previously recorded file */
+  static void init_playback(const std::string&amp; filenam);
+  static void deinit();
+
+  /** Record all input events to \a filename */
+  static void setup_recorder(const std::string&amp; filename);
+
+  static void update(float delta);
+  static Controller get_controller();
+  static void clear();
+private:
+  InputManager(const InputManager&amp;);
+  InputManager&amp; operator=(const InputManager&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager_custom.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager_custom.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager_custom.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,141 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &lt;ClanLib/Display/keyboard.h&gt;
+#include &lt;ClanLib/Display/joystick.h&gt;
+#include &lt;ClanLib/Display/display_iostream.h&gt;
+#include &lt;ClanLib/Display/keys.h&gt;
+
+#include &quot;../guile.hxx&quot;
+#include &quot;../assert.hxx&quot;
+#include &quot;../controller_def.hxx&quot;
+#include &quot;input_button_input_device.hxx&quot;
+#include &quot;input_axis_input_device.hxx&quot;
+#include &quot;button_factory.hxx&quot;
+#include &quot;axis_factory.hxx&quot;
+
+#include &quot;input_manager_custom.hxx&quot;
+
+InputManagerCustom::InputManagerCustom(SCM lst)
+{
+  init(lst);
+
+  for (int i = 0; i &lt; (int)buttons.size(); ++i)
+    {
+      if (buttons[i])
+        {
+          slots.push_back(buttons[i]-&gt;on_key_down().connect(this, &amp;InputManagerCustom::on_button_down, i));
+          slots.push_back(buttons[i]-&gt;on_key_up().connect  (this, &amp;InputManagerCustom::on_button_up,   i));
+        }
+      else
+        {
+          std::cout &lt;&lt; &quot;# Warrning: Button '&quot; &lt;&lt; ControllerDef::button_id2name(i)
+                    &lt;&lt; &quot;' not configured and will not be usable&quot; &lt;&lt; std::endl;
+        }
+    }
+
+  for (int i = 0; i &lt; (int)axes.size(); ++i)
+    {
+      if (axes[i])
+        {
+          slots.push_back(axes[i]-&gt;on_move().connect(this, &amp;InputManagerCustom::on_axis_move, i));
+        }
+      else
+        {
+          std::cout &lt;&lt; &quot;# Warrning: Axis '&quot; &lt;&lt; ControllerDef::axis_id2name(i)
+                    &lt;&lt; &quot;' not configured and will not be usable&quot; &lt;&lt; std::endl;
+        }
+    }
+}
+
+void 
+InputManagerCustom::init(SCM lst)
+{
+  buttons.resize(ControllerDef::get_button_count());
+  axes.resize(ControllerDef::get_axis_count());
+  
+  while (gh_pair_p(lst))
+    {
+      SCM sym  = gh_caar(lst);
+      SCM data = gh_cadar(lst);
+
+      std::string name = Guile::symbol2string(sym);
+
+      int id = ControllerDef::button_name2id(name);
+      if (id != -1)
+        {
+          buttons[id] = ButtonFactory::create(data);
+        }
+      else
+        {
+          id = ControllerDef::axis_name2id(name);
+          if (id != -1)
+            {
+              axes[id] = AxisFactory::create(data);
+            }
+          else
+            {
+              std::cout &lt;&lt; &quot;# Warning: InputManagerCustom::init: Error unknown tag: &quot; 
+                        &lt;&lt; Guile::scm2string(sym) &lt;&lt; std::endl;
+            }
+        }
+
+      lst = gh_cdr(lst);
+    }
+}  
+
+void
+InputManagerCustom::on_axis_move(float pos, int name)
+{
+  add_axis_event(name, pos);
+  controller.set_axis_state(name, pos);
+}
+
+void
+InputManagerCustom::on_button_up(int name)
+{
+  add_button_event(name, false);
+  controller.set_button_state(name, false);
+}
+
+void
+InputManagerCustom::on_button_down(int name)
+{
+  add_button_event(name, true);
+  controller.set_button_state(name, true);
+}
+
+void
+InputManagerCustom::update(float delta)
+{
+  for (int i = 0; i &lt; (int)buttons.size(); ++i)
+    {
+      if (buttons[i])
+        buttons[i]-&gt;update(delta);
+    }
+
+  for (int i = 0; i &lt; (int)axes.size(); ++i)
+    {
+      if (axes[i])
+        axes[i]-&gt;update(delta);
+    }
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager_custom.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager_custom.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager_custom.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager_custom.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,60 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_MANAGER_CUSTOM_HXX
+#define HEADER_INPUT_MANAGER_CUSTOM_HXX
+
+#include &lt;guile/gh.h&gt;
+#include &lt;ClanLib/Display/input_device.h&gt;
+#include &lt;ClanLib/Display/input_event.h&gt;
+#include &quot;input_event.hxx&quot;
+#include &quot;input_button.hxx&quot;
+#include &quot;input_axis.hxx&quot;
+#include &quot;input_manager_impl.hxx&quot;
+
+/** */
+class InputManagerCustom : public InputManagerImpl
+{
+private:
+  std::vector&lt;CL_Slot&gt; slots;
+
+  typedef std::vector&lt;InputAxis*&gt;   Axes;
+  typedef std::vector&lt;InputButton*&gt; Buttons;
+  
+  Axes    axes;
+  Buttons buttons;
+
+public:
+  InputManagerCustom(SCM lst);
+  
+  void update(float delta);
+
+  void on_button_up(int name);
+  void on_button_down(int name);
+  void on_axis_move(float pos, int name);
+private:
+  void init(SCM lst);
+
+  InputManagerCustom (const InputManagerCustom&amp;);
+  InputManagerCustom&amp; operator= (const InputManagerCustom&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager_custom.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager_impl.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager_impl.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager_impl.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,61 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &quot;input_manager_impl.hxx&quot;
+
+InputEventLst
+InputManagerImpl::get_events()
+{
+  return events;
+}
+
+Controller
+InputManagerImpl::get_controller()
+{
+  controller.set_events(events);
+  return controller;
+}
+
+void
+InputManagerImpl::add_axis_event(int name, float pos)
+{
+  InputEvent event;
+  event.type = AXIS_EVENT;
+  event.axis.name = name;
+  event.axis.pos  = pos;
+  events.push_back(event);
+}
+
+void
+InputManagerImpl::add_button_event(int name, bool down)
+{
+  InputEvent event;
+  event.type = BUTTON_EVENT;
+  event.button.name = name;
+  event.button.down = down;
+  events.push_back(event);
+}
+
+void
+InputManagerImpl::clear()
+{
+  events.clear();
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager_impl.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager_impl.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager_impl.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager_impl.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,53 @@
+//  $Id: input_manager_impl.hxx,v 1.3 2003/06/06 18:36:24 grumbel Exp $
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_MANAGER_IMPL_HXX
+#define HEADER_INPUT_MANAGER_IMPL_HXX
+
+#include &quot;controller.hxx&quot;
+#include &quot;input_event.hxx&quot;
+
+/** */
+class InputManagerImpl
+{
+protected:
+  Controller controller;
+  InputEventLst events;
+
+public:
+  InputManagerImpl() {}
+  virtual ~InputManagerImpl() {}
+
+  virtual void update(float delta) =0;
+  
+  InputEventLst get_events();
+
+  Controller get_controller();
+  void clear();
+
+  void add_axis_event  (int name, float pos);
+  void add_button_event(int name, bool down);
+private:
+  InputManagerImpl(const InputManagerImpl&amp;);
+  InputManagerImpl&amp; operator=(const InputManagerImpl&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager_impl.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager_player.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager_player.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager_player.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,93 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &quot;../guile.hxx&quot;
+#include &quot;input_manager_player.hxx&quot;
+
+InputManagerPlayer::InputManagerPlayer(const std::string&amp; filename)
+{
+  std::cout &lt;&lt; &quot;InputManagerPlayer::InputManagerPlayer(&quot; &lt;&lt; filename &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
+  entry_counter = 0;
+  SCM port = scm_open_file(gh_str02scm(filename.c_str()),
+                           gh_str02scm(&quot;r&quot;));
+  SCM entry;
+  while(scm_eof_object_p(entry = scm_read(port)) == SCM_BOOL_F)
+    {
+      InputEventLst lst;
+      int entry_num = gh_scm2int(gh_cadr(entry));
+      entry = gh_cddr(entry);
+      
+      while(gh_pair_p(entry))
+        {
+          lst.push_back(scm2event(gh_car(entry)));
+          entry = gh_cdr(entry);
+        }
+      entries.push(Entry(entry_num, lst));
+    }
+  scm_close_port(port);
+}
+
+InputEvent
+InputManagerPlayer::scm2event(SCM entry)
+{
+  InputEvent event;
+  SCM sym  = gh_car(entry);
+  SCM data = gh_cdr(entry);
+
+  if (gh_equal_p(gh_symbol2scm(&quot;axis&quot;), sym)) 
+    {
+      event.type = AXIS_EVENT;
+      event.axis.name = gh_scm2int(gh_car(data));
+      event.axis.pos  = gh_scm2double(gh_cadr(data));
+    } 
+  else if (gh_equal_p(gh_symbol2scm(&quot;button&quot;), sym))
+    {
+      event.type = BUTTON_EVENT;
+      event.button.name = gh_scm2int(gh_car(data));
+      event.button.down = gh_scm2int(gh_cadr(data));
+    } 
+  else 
+    {
+      std::cout &lt;&lt; &quot;scm2event: Unknown sym: &quot; &lt;&lt; Guile::scm2string(sym) &lt;&lt; std::endl;
+    }
+  return event;
+}
+  
+void
+InputManagerPlayer::update(float delta)
+{
+  if (entries.front().entry_num == entry_counter)
+    {
+      events = entries.front().events;
+      
+      for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
+        {
+          if (i-&gt;type == AXIS_EVENT)
+            controller.set_axis_state(i-&gt;axis.name, i-&gt;axis.pos);
+          else if  (i-&gt;type == BUTTON_EVENT)
+            controller.set_button_state(i-&gt;button.name, i-&gt;button.down);
+        }
+      entries.pop();
+    }
+
+  entry_counter += 1;
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager_player.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_manager_player.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_manager_player.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_manager_player.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,55 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_MANAGER_PLAYER_HXX
+#define HEADER_INPUT_MANAGER_PLAYER_HXX
+
+#include &lt;queue&gt;
+#include &lt;string&gt;
+#include &lt;guile/gh.h&gt;
+#include &quot;input_manager_impl.hxx&quot;
+
+/** Playback class for events recorded my the InputRecorder */
+class InputManagerPlayer : public InputManagerImpl
+{
+private:
+  struct Entry {
+    Entry(int num, const InputEventLst&amp; lst) 
+      : entry_num(num), events(lst)
+    {}
+    int entry_num;
+    InputEventLst events;
+  };
+
+  int entry_counter;
+  std::queue&lt;Entry&gt; entries;
+public:
+  InputManagerPlayer(const std::string&amp; filename);
+  
+  void update(float delta);
+private:
+  InputEvent scm2event(SCM lst);
+
+  InputManagerPlayer (const InputManagerPlayer&amp;);
+  InputManagerPlayer&amp; operator= (const InputManagerPlayer&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_manager_player.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_recorder.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_recorder.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_recorder.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,61 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &quot;input_recorder.hxx&quot;
+
+InputRecorder::InputRecorder(const std::string&amp; filename)
+  : out(filename.c_str())
+{
+  entry_counter = 0;
+}
+
+InputRecorder::~InputRecorder()
+{
+  out.close();
+}
+
+void
+InputRecorder::record(const Controller&amp; controller)
+{
+  InputEventLst lst = controller.get_events();
+
+  if (!lst.empty())
+    {
+      out &lt;&lt; &quot;(entry &quot; &lt;&lt; entry_counter &lt;&lt; std::endl;
+ 
+      for (InputEventLst::iterator i = lst.begin(); i != lst.end(); ++i)
+        {
+          switch(i-&gt;type)
+            {
+            case AXIS_EVENT:
+              out &lt;&lt; &quot;  (axis &quot; &lt;&lt; i-&gt;axis.name &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;axis.get_pos() &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
+              break;
+          
+            case BUTTON_EVENT:
+              out &lt;&lt; &quot;  (button &quot; &lt;&lt; i-&gt;button.name &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;button.down &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
+              break;
+            }
+        }
+      out &lt;&lt; &quot;)\n&quot; &lt;&lt; std::endl;
+    }
+
+  entry_counter += 1;
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_recorder.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/input_recorder.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/input_recorder.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/input_recorder.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,46 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_INPUT_RECORDER_HXX
+#define HEADER_INPUT_RECORDER_HXX
+
+#include &lt;fstream&gt;
+#include &quot;controller.hxx&quot;
+
+/** The InputRecorder hooks into the InputManager and records all
+    input events to a file, thus allowing the later playback of the
+    events. */
+class InputRecorder
+{
+private:
+  std::ofstream out;
+  int entry_counter;
+public:
+  InputRecorder(const std::string&amp; filename);
+  ~InputRecorder();
+
+  void record(const Controller&amp; controller);
+private:
+  InputRecorder (const InputRecorder&amp;);
+  InputRecorder&amp; operator= (const InputRecorder&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/input_recorder.hxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/multi_button.cxx
===================================================================
--- tags/windstille-0.2.0/src/input/multi_button.cxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/multi_button.cxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,65 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;iostream&gt;
+#include &quot;multi_button.hxx&quot;
+
+MultiButton::MultiButton()
+{
+  press_count = 0;
+}
+
+void
+MultiButton::add(InputButton* button)
+{
+  buttons.push_back(button);
+  slots.push_back(button-&gt;on_key_down().connect(this, &amp;MultiButton::pressed));
+  slots.push_back(button-&gt;on_key_up().connect(this, &amp;MultiButton::released));
+}
+
+void
+MultiButton::update(float delta)
+{
+  for (Buttons::iterator i = buttons.begin(); i != buttons.end(); ++i)
+    (*i)-&gt;update(delta);
+}
+
+void
+MultiButton::released()
+{
+  press_count -= 1;
+
+  if (press_count == 0)
+    button_up();
+
+  // FIXME: Workaround
+  if (press_count &lt; 0)
+    press_count = 0;
+}
+
+void
+MultiButton::pressed()
+{
+  press_count += 1;
+
+  if (press_count == 1)
+    button_down();
+}
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/multi_button.cxx
___________________________________________________________________
Name: svn:eol-style
   + native

Added: tags/windstille-0.2.0/src/input/multi_button.hxx
===================================================================
--- tags/windstille-0.2.0/src/input/multi_button.hxx	2009-09-26 14:24:37 UTC (rev 3265)
+++ tags/windstille-0.2.0/src/input/multi_button.hxx	2009-09-27 11:38:37 UTC (rev 3266)
@@ -0,0 +1,46 @@
+//  $Id$
+// 
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+// 
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#ifndef HEADER_MULTI_BUTTON_HXX
+#define HEADER_MULTI_BUTTON_HXX
+
+#include &lt;vector&gt;
+#include &quot;input_button.hxx&quot;
+
+/** */
+class MultiButton : public InputButton
+{
+private:
+  typedef std::vector&lt;InputButton*&gt; Buttons;
+  Buttons buttons;
+  std::vector&lt;CL_Slot&gt; slots;  
+  int press_count;
+public:
+  MultiButton();
+  
+  void add(InputButton*);
+  void update(float delta);
+private:
+  void released();
+  void pressed();
+};
+
+#endif
+
+/* EOF */


Property changes on: tags/windstille-0.2.0/src/input/multi_button.hxx
___________________________________________________________________
Name: svn:eol-style
   + native


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002262.html">[Windstille-commit] r3265 - trunk/windstille/src/editor
</A></li>
	<LI>Next message: <A HREF="002264.html">[Windstille-commit] r3267 - in tags/windstille-0.2.0: . src	src/collision src/editor src/input
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2263">[ date ]</a>
              <a href="thread.html#2263">[ thread ]</a>
              <a href="subject.html#2263">[ subject ]</a>
              <a href="author.html#2263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
