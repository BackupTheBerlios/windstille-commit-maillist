<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r3218 - trunk/windstille/src/editor
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3218%20-%20trunk/windstille/src/editor&In-Reply-To=%3C200909101448.n8AEmCBR025835%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002214.html">
   <LINK REL="Next"  HREF="002216.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r3218 - trunk/windstille/src/editor</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3218%20-%20trunk/windstille/src/editor&In-Reply-To=%3C200909101448.n8AEmCBR025835%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r3218 - trunk/windstille/src/editor">grumbel at mail.berlios.de
       </A><BR>
    <I>Thu Sep 10 16:48:12 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002214.html">[Windstille-commit] r3217 - trunk/windstille/src/editor
</A></li>
        <LI>Next message: <A HREF="002216.html">[Windstille-commit] r3219 - trunk/windstille/src/editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2215">[ date ]</a>
              <a href="thread.html#2215">[ thread ]</a>
              <a href="subject.html#2215">[ subject ]</a>
              <a href="author.html#2215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-09-10 16:48:10 +0200 (Thu, 10 Sep 2009)
New Revision: 3218

Modified:
   trunk/windstille/src/editor/decal_object_model.cpp
   trunk/windstille/src/editor/decal_rotate_control_point.cpp
   trunk/windstille/src/editor/decal_scale_control_point.cpp
   trunk/windstille/src/editor/document.cpp
   trunk/windstille/src/editor/editor_window.cpp
   trunk/windstille/src/editor/layer.cpp
   trunk/windstille/src/editor/layer_manager.cpp
   trunk/windstille/src/editor/layer_widget.cpp
   trunk/windstille/src/editor/minimap_widget.cpp
   trunk/windstille/src/editor/navgraph_edge_object_model.cpp
   trunk/windstille/src/editor/navgraph_insert_tool.cpp
   trunk/windstille/src/editor/object_model.cpp
   trunk/windstille/src/editor/object_model_factory.cpp
   trunk/windstille/src/editor/object_selector.cpp
   trunk/windstille/src/editor/property_dialog.cpp
   trunk/windstille/src/editor/scroll_tool.cpp
   trunk/windstille/src/editor/sector_model.cpp
   trunk/windstille/src/editor/select_mask.hpp
   trunk/windstille/src/editor/select_tool.cpp
   trunk/windstille/src/editor/selection.cpp
   trunk/windstille/src/editor/selection.hpp
   trunk/windstille/src/editor/snap_data.hpp
   trunk/windstille/src/editor/undo_manager.cpp
   trunk/windstille/src/editor/windstille_widget.cpp
   trunk/windstille/src/editor/zoom_tool.cpp
Log:
Auto reindented everything with emacs

Modified: trunk/windstille/src/editor/decal_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/decal_object_model.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/decal_object_model.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -215,20 +215,20 @@
 
   if (fabsf(p.x) &lt; surface.get_width()/2 &amp;&amp;
       fabsf(p.y) &lt; surface.get_height()/2)
-    {
-      if (hflip)
-        p.x = -p.x;
+  {
+    if (hflip)
+      p.x = -p.x;
 
-      if (vflip)
-        p.y = -p.y;
+    if (vflip)
+      p.y = -p.y;
 
-      return software_surface.is_at(static_cast&lt;int&gt;(p.x + surface.get_width()/2),
-                                    static_cast&lt;int&gt;(p.y + surface.get_height()/2));
-    }
+    return software_surface.is_at(static_cast&lt;int&gt;(p.x + surface.get_width()/2),
+				  static_cast&lt;int&gt;(p.y + surface.get_height()/2));
+  }
   else
-    {
-      return false;
-    }
+  {
+    return false;
+  }
 }
 
 void

Modified: trunk/windstille/src/editor/decal_rotate_control_point.cpp
===================================================================
--- trunk/windstille/src/editor/decal_rotate_control_point.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/decal_rotate_control_point.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -47,10 +47,10 @@
   float new_angle = orig_angle + current_angle - base_angle;
 
   if (event-&gt;state &amp; GDK_CONTROL_MASK)
-    {
-      float steps = 16.0f;
-      new_angle = roundf((new_angle / (2.0f * math::pi)) * steps) / steps * 2.0f * math::pi;
-    }
+  {
+    float steps = 16.0f;
+    new_angle = roundf((new_angle / (2.0f * math::pi)) * steps) / steps * 2.0f * math::pi;
+  }
 
   object-&gt;set_angle(new_angle);
 }

Modified: trunk/windstille/src/editor/decal_scale_control_point.cpp
===================================================================
--- trunk/windstille/src/editor/decal_scale_control_point.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/decal_scale_control_point.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -48,16 +48,16 @@
   Vector2f new_scale = orig_scale;
 
   if (x_scale)
-    {
-      new_scale.x = current.x / start.x;
-      new_scale.x *= orig_scale.x;
-    }
+  {
+    new_scale.x = current.x / start.x;
+    new_scale.x *= orig_scale.x;
+  }
 
   if (y_scale)
-    {
-      new_scale.y = current.y / start.y;
-      new_scale.y *= orig_scale.y;
-    }
+  {
+    new_scale.y = current.y / start.y;
+    new_scale.y *= orig_scale.y;
+  }
 
   object-&gt;set_scale(new_scale);
 }

Modified: trunk/windstille/src/editor/document.cpp
===================================================================
--- trunk/windstille/src/editor/document.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/document.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -177,9 +177,9 @@
 Document::selection_raise()
 {
   for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-    {
-      m_sector_model-&gt;raise(*i);
-    }
+  {
+    m_sector_model-&gt;raise(*i);
+  }
 
   m_sig_on_change();
 }
@@ -188,9 +188,9 @@
 Document::selection_lower()
 {
   for(Selection::reverse_iterator i = m_selection-&gt;rbegin(); i != m_selection-&gt;rend(); ++i)
-    {
-      m_sector_model-&gt;lower(*i);
-    }
+  {
+    m_sector_model-&gt;lower(*i);
+  }
 
   m_sig_on_change();
 }
@@ -199,9 +199,9 @@
 Document::selection_raise_to_top()
 {
   for(Selection::reverse_iterator i = m_selection-&gt;rbegin(); i != m_selection-&gt;rend(); ++i)
-    {
-      m_sector_model-&gt;raise_to_top(*i);
-    }
+  {
+    m_sector_model-&gt;raise_to_top(*i);
+  }
 
   m_sig_on_change();
 }
@@ -210,9 +210,9 @@
 Document::selection_lower_to_bottom()
 {
   for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-    {
-      m_sector_model-&gt;lower_to_bottom(*i);
-    }
+  {
+    m_sector_model-&gt;lower_to_bottom(*i);
+  }
 
   m_sig_on_change();
 }
@@ -221,88 +221,88 @@
 Document::selection_vflip()
 {
   if (!m_selection-&gt;empty())
+  {
+    boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
+
+    if (m_selection-&gt;size() &gt; 1)
     {
-      boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
-
-      if (m_selection-&gt;size() &gt; 1)
-        {
-          const Vector2f&amp; center = m_selection-&gt;get_bounding_box().get_center();
-          for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-            {
-              Vector2f pos = (*i)-&gt;get_world_pos();
+      const Vector2f&amp; center = m_selection-&gt;get_bounding_box().get_center();
+      for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+      {
+	Vector2f pos = (*i)-&gt;get_world_pos();
           
-              pos.y = center.y + (center.y - pos.y);
+	pos.y = center.y + (center.y - pos.y);
           
-              //(*i)-&gt;set_world_pos(pos);
-              group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_world_pos, *i, (*i)-&gt;get_world_pos()),
-                                                                  boost::bind(&amp;ObjectModel::set_world_pos, *i, pos))));
-            }
-        }
+	//(*i)-&gt;set_world_pos(pos);
+	group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_world_pos, *i, (*i)-&gt;get_world_pos()),
+							    boost::bind(&amp;ObjectModel::set_world_pos, *i, pos))));
+      }
+    }
 
-      for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-        {
-          //(*i)-&gt;set_vflip(!(*i)-&gt;get_vflip());
-          group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_vflip, *i,  (*i)-&gt;get_vflip()),
-                                                              boost::bind(&amp;ObjectModel::set_vflip, *i, !(*i)-&gt;get_vflip()))));
-        }
+    for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+    {
+      //(*i)-&gt;set_vflip(!(*i)-&gt;get_vflip());
+      group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_vflip, *i,  (*i)-&gt;get_vflip()),
+							  boost::bind(&amp;ObjectModel::set_vflip, *i, !(*i)-&gt;get_vflip()))));
+    }
 
-      execute(group_command);
-    }
+    execute(group_command);
+  }
 }
 
 void
 Document::selection_hflip()
 {
   if (!m_selection-&gt;empty())
+  {
+    boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
+
+    if (m_selection-&gt;size() &gt; 1)
     {
-      boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
-
-      if (m_selection-&gt;size() &gt; 1)
-        {
-          const Vector2f&amp; center = m_selection-&gt;get_bounding_box().get_center();
-          for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-            {
-              Vector2f pos = (*i)-&gt;get_world_pos();
+      const Vector2f&amp; center = m_selection-&gt;get_bounding_box().get_center();
+      for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+      {
+	Vector2f pos = (*i)-&gt;get_world_pos();
           
-              pos.x = center.x + (center.x - pos.x);
+	pos.x = center.x + (center.x - pos.x);
           
-              //(*i)-&gt;set_world_pos(pos);
-              group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_world_pos, *i, (*i)-&gt;get_world_pos()),
-                                                                  boost::bind(&amp;ObjectModel::set_world_pos, *i, pos))));
-            }
-        }
+	//(*i)-&gt;set_world_pos(pos);
+	group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_world_pos, *i, (*i)-&gt;get_world_pos()),
+							    boost::bind(&amp;ObjectModel::set_world_pos, *i, pos))));
+      }
+    }
 
-      for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-        {
-          //(*i)-&gt;set_hflip(!(*i)-&gt;get_hflip());
-          group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_hflip, *i,  (*i)-&gt;get_hflip()),
-                                                              boost::bind(&amp;ObjectModel::set_hflip, *i, !(*i)-&gt;get_hflip()))));
-        }
+    for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+    {
+      //(*i)-&gt;set_hflip(!(*i)-&gt;get_hflip());
+      group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_hflip, *i,  (*i)-&gt;get_hflip()),
+							  boost::bind(&amp;ObjectModel::set_hflip, *i, !(*i)-&gt;get_hflip()))));
+    }
 
-      execute(group_command);
-    }
+    execute(group_command);
+  }
 }
 
 void
 Document::selection_connect_parent()
 {
   if (m_selection-&gt;size() &gt;= 2)
-    {
-      boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
+  {
+    boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
 
-      ObjectModelHandle parent = *m_selection-&gt;begin();
+    ObjectModelHandle parent = *m_selection-&gt;begin();
 
-      Selection::iterator i = m_selection-&gt;begin();
-      ++i;
-      for(; i != m_selection-&gt;end(); ++i)
-        {
-          //(*i)-&gt;set_parent(parent);
-          group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_parent, *i, (*i)-&gt;get_parent(), true),
-                                                              boost::bind(&amp;ObjectModel::set_parent, *i, parent, true))));
-        }
+    Selection::iterator i = m_selection-&gt;begin();
+    ++i;
+    for(; i != m_selection-&gt;end(); ++i)
+    {
+      //(*i)-&gt;set_parent(parent);
+      group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_parent, *i, (*i)-&gt;get_parent(), true),
+							  boost::bind(&amp;ObjectModel::set_parent, *i, parent, true))));
+    }
 
-      execute(group_command);
-    }
+    execute(group_command);
+  }
 }
 
 void
@@ -311,11 +311,11 @@
   boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
 
   for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-    {
-      //(*i)-&gt;set_parent(ObjectModelHandle());
-      group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_parent, *i, (*i)-&gt;get_parent(), true),
-                                                          boost::bind(&amp;ObjectModel::set_parent, *i, ObjectModelHandle(), true))));
-    }
+  {
+    //(*i)-&gt;set_parent(ObjectModelHandle());
+    group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;ObjectModel::set_parent, *i, (*i)-&gt;get_parent(), true),
+							boost::bind(&amp;ObjectModel::set_parent, *i, ObjectModelHandle(), true))));
+  }
 
   execute(group_command);
 }
@@ -328,45 +328,45 @@
 
   SelectionHandle new_selection = Selection::create();
   for(Selection::reverse_iterator i = m_selection-&gt;rbegin(); i != m_selection-&gt;rend(); ++i)
-    {
-      LayerHandle layer = m_sector_model-&gt;get_layer(*i);
-      ObjectModelHandle obj = (*i)-&gt;clone();
+  {
+    LayerHandle layer = m_sector_model-&gt;get_layer(*i);
+    ObjectModelHandle obj = (*i)-&gt;clone();
 
-      parent_map[*i] = obj;
+    parent_map[*i] = obj;
 
-      if (!layer)
-        {
-          EditorWindow::current()-&gt;print(&quot;Couldn't find parent layer while duplicating&quot;);
-        }
-      else
-        {
-          // Move clone a litte to make it more obvious that something happened
-          obj-&gt;set_rel_pos(obj-&gt;get_rel_pos() + Vector2f(32.0f, 32.0f));
-          new_selection-&gt;add(obj);
+    if (!layer)
+    {
+      EditorWindow::current()-&gt;print(&quot;Couldn't find parent layer while duplicating&quot;);
+    }
+    else
+    {
+      // Move clone a litte to make it more obvious that something happened
+      obj-&gt;set_rel_pos(obj-&gt;get_rel_pos() + Vector2f(32.0f, 32.0f));
+      new_selection-&gt;add(obj);
 
-          //layer-&gt;add(obj);
-          group_command-&gt;add(CommandHandle(new ObjectAddCommand(layer, obj)));
-        }
+      //layer-&gt;add(obj);
+      group_command-&gt;add(CommandHandle(new ObjectAddCommand(layer, obj)));
     }
+  }
 
   // Second pass to set the parents to the cloned objects
   for(Selection::iterator i = new_selection-&gt;begin(); i != new_selection-&gt;end(); ++i)
+  {
+    if ((*i)-&gt;get_parent())
     {
-      if ((*i)-&gt;get_parent())
-        {
-          std::map&lt;ObjectModelHandle, ObjectModelHandle&gt;::iterator it = parent_map.find((*i)-&gt;get_parent());
+      std::map&lt;ObjectModelHandle, ObjectModelHandle&gt;::iterator it = parent_map.find((*i)-&gt;get_parent());
           
-          if (it == parent_map.end())
-            {
-              // When the parent wasn't part of the selection, leave
-              // the parent untouched
-            }
-          else
-            {
-              (*i)-&gt;set_parent(it-&gt;second);
-            }
-        }
+      if (it == parent_map.end())
+      {
+	// When the parent wasn't part of the selection, leave
+	// the parent untouched
+      }
+      else
+      {
+	(*i)-&gt;set_parent(it-&gt;second);
+      }
     }
+  }
 
   execute(group_command);
   set_selection(new_selection);
@@ -378,16 +378,16 @@
   boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
 
   for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+  {
+    DecalObjectModel* decal = dynamic_cast&lt;DecalObjectModel*&gt;(i-&gt;get());
+
+    if (decal)
     {
-      DecalObjectModel* decal = dynamic_cast&lt;DecalObjectModel*&gt;(i-&gt;get());
-
-      if (decal)
-        {
-          //decal-&gt;set_angle(0.0f);
-          group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;DecalObjectModel::set_angle, decal, decal-&gt;get_angle()),
-                                                              boost::bind(&amp;DecalObjectModel::set_angle, decal, 0.0f))));
-        }
+      //decal-&gt;set_angle(0.0f);
+      group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;DecalObjectModel::set_angle, decal, decal-&gt;get_angle()),
+							  boost::bind(&amp;DecalObjectModel::set_angle, decal, 0.0f))));
     }
+  }
 
   on_selection_change();
   execute(group_command);
@@ -404,19 +404,19 @@
 {
   boost::shared_ptr&lt;GroupCommand&gt; group_command(new GroupCommand());
 
- for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+  for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
+  {
+    DecalObjectModel* decal = dynamic_cast&lt;DecalObjectModel*&gt;(i-&gt;get());
+    if (decal)
     {
-      DecalObjectModel* decal = dynamic_cast&lt;DecalObjectModel*&gt;(i-&gt;get());
-      if (decal)
-        {
-          //decal-&gt;set_scale(Vector2f(1.0f, 1.0f));
-          group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;DecalObjectModel::set_scale, decal, decal-&gt;get_scale()),
-                                                              boost::bind(&amp;DecalObjectModel::set_scale, decal, Vector2f(1.0f, 1.0f)))));
-        }
+      //decal-&gt;set_scale(Vector2f(1.0f, 1.0f));
+      group_command-&gt;add(CommandHandle(new FunctorCommand(boost::bind(&amp;DecalObjectModel::set_scale, decal, decal-&gt;get_scale()),
+							  boost::bind(&amp;DecalObjectModel::set_scale, decal, Vector2f(1.0f, 1.0f)))));
     }
+  }
 
- on_selection_change();
- execute(group_command);
+  on_selection_change();
+  execute(group_command);
 }
 
 void
@@ -424,9 +424,9 @@
 {
   boost::shared_ptr&lt;GroupCommand&gt; group_cmd(new GroupCommand());
   for(Selection::iterator i = m_selection-&gt;begin(); i != m_selection-&gt;end(); ++i)
-    {
-      group_cmd-&gt;add(CommandHandle(new ObjectRemoveCommand(*m_sector_model, *i)));
-    }
+  {
+    group_cmd-&gt;add(CommandHandle(new ObjectRemoveCommand(*m_sector_model, *i)));
+  }
   execute(group_cmd);
   m_selection-&gt;clear();
 }
@@ -445,9 +445,9 @@
   m_control_points.clear();
 
   if (!m_selection-&gt;is_moving())
-    {
-      m_selection-&gt;add_control_points(m_control_points);
-    }
+  {
+    m_selection-&gt;add_control_points(m_control_points);
+  }
 }
 
 ControlPointHandle
@@ -455,10 +455,10 @@
 {
   for(std::vector&lt;ControlPointHandle&gt;::const_iterator i = m_control_points.begin();  
       i != m_control_points.end(); ++i)
-    {
-      if ((*i)-&gt;get_bounding_box().is_inside(pos))
-        return *i;
-    }
+  {
+    if ((*i)-&gt;get_bounding_box().is_inside(pos))
+      return *i;
+  }
   return ControlPointHandle();
 }
 

Modified: trunk/windstille/src/editor/editor_window.cpp
===================================================================
--- trunk/windstille/src/editor/editor_window.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/editor_window.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -460,21 +460,21 @@
 EditorWindow::load_file(const std::string&amp; filename)
 {
   try 
-    {
-      on_new();
-      WindstilleWidget* wst = get_windstille_widget();
-      wst-&gt;load_file(filename);
-      wst-&gt;set_filename(filename);
-      notebook.set_tab_label_text(*notebook.get_nth_page(notebook.get_current_page()), Glib::path_get_basename(filename));
+  {
+    on_new();
+    WindstilleWidget* wst = get_windstille_widget();
+    wst-&gt;load_file(filename);
+    wst-&gt;set_filename(filename);
+    notebook.set_tab_label_text(*notebook.get_nth_page(notebook.get_current_page()), Glib::path_get_basename(filename));
 
-      print(&quot;Loaded: &quot; + filename);
-    }
+    print(&quot;Loaded: &quot; + filename);
+  }
   catch(std::exception&amp; err)
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;EditorWindow::load_file: &quot; &lt;&lt; err.what();
-      print(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;EditorWindow::load_file: &quot; &lt;&lt; err.what();
+    print(str.str());
+  }
 }
 
 void
@@ -489,44 +489,44 @@
   dialog.set_current_folder(&quot;data/sectors/&quot;);
 
   switch(dialog.run())
+  {
+    case(Gtk::RESPONSE_OK):
     {
-      case(Gtk::RESPONSE_OK):
-        {
-          //std::cout &lt;&lt; &quot;Select clicked.&quot; &lt;&lt; std::endl;
-          //std::cout &lt;&lt; &quot;Folder selected: &quot; &lt;&lt; dialog.get_filename()
-          //          &lt;&lt; std::endl;
+      //std::cout &lt;&lt; &quot;Select clicked.&quot; &lt;&lt; std::endl;
+      //std::cout &lt;&lt; &quot;Folder selected: &quot; &lt;&lt; dialog.get_filename()
+      //          &lt;&lt; std::endl;
           
-          add_recent_file(dialog.get_filename());
+      add_recent_file(dialog.get_filename());
 
-          load_file(dialog.get_filename());
-          break;
-        }
+      load_file(dialog.get_filename());
+      break;
+    }
 
-      case(Gtk::RESPONSE_CANCEL):
-        {
-          //std::cout &lt;&lt; &quot;Cancel clicked.&quot; &lt;&lt; std::endl;
-          break;
-        }
+    case(Gtk::RESPONSE_CANCEL):
+    {
+      //std::cout &lt;&lt; &quot;Cancel clicked.&quot; &lt;&lt; std::endl;
+      break;
     }
+  }
 }
 
 void
 EditorWindow::on_save()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
+  {
+    if (wst-&gt;get_filename().empty())
     {
-      if (wst-&gt;get_filename().empty())
-        {
-          on_save_as();
-        }
-      else
-        {
-          std::ofstream out(wst-&gt;get_filename().c_str());
-          FileWriter writer(out);
-          wst-&gt;get_document().get_sector_model().write(writer);
-          print(&quot;Wrote: &quot; + wst-&gt;get_filename());
-        }
+      on_save_as();
     }
+    else
+    {
+      std::ofstream out(wst-&gt;get_filename().c_str());
+      FileWriter writer(out);
+      wst-&gt;get_document().get_sector_model().write(writer);
+      print(&quot;Wrote: &quot; + wst-&gt;get_filename());
+    }
+  }
 }
 
 void
@@ -534,54 +534,54 @@
 {
   int page = notebook.get_current_page();
   if (page == -1)
-    {
-      // do nothing;
-    }
+  {
+    // do nothing;
+  }
   else
-    {
-      Gtk::FileChooserDialog dialog(&quot;Save File&quot;,
-                                    Gtk::FILE_CHOOSER_ACTION_SAVE);
-      dialog.set_transient_for(*this);
-      dialog.set_do_overwrite_confirmation(true);
+  {
+    Gtk::FileChooserDialog dialog(&quot;Save File&quot;,
+				  Gtk::FILE_CHOOSER_ACTION_SAVE);
+    dialog.set_transient_for(*this);
+    dialog.set_do_overwrite_confirmation(true);
 
-      dialog.add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
-      dialog.add_button(Gtk::Stock::SAVE,   Gtk::RESPONSE_OK);
+    dialog.add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
+    dialog.add_button(Gtk::Stock::SAVE,   Gtk::RESPONSE_OK);
 
-      WindstilleWidget* wst = static_cast&lt;WindstilleWidget*&gt;(notebook.get_nth_page(page));
+    WindstilleWidget* wst = static_cast&lt;WindstilleWidget*&gt;(notebook.get_nth_page(page));
  
-      if (wst-&gt;get_filename().empty())
-        dialog.set_current_folder(&quot;data/sectors/&quot;);
-      else
-        dialog.set_current_folder(Glib::path_get_dirname(wst-&gt;get_filename()));
+    if (wst-&gt;get_filename().empty())
+      dialog.set_current_folder(&quot;data/sectors/&quot;);
+    else
+      dialog.set_current_folder(Glib::path_get_dirname(wst-&gt;get_filename()));
 
-      switch(dialog.run())
-        {
-          case(Gtk::RESPONSE_OK):
-            {
-              //std::cout &lt;&lt; &quot;Select clicked.&quot; &lt;&lt; std::endl;
-              //std::cout &lt;&lt; &quot;Folder selected: &quot; &lt;&lt; dialog.get_filename()
-              //          &lt;&lt; std::endl;
+    switch(dialog.run())
+    {
+      case(Gtk::RESPONSE_OK):
+      {
+	//std::cout &lt;&lt; &quot;Select clicked.&quot; &lt;&lt; std::endl;
+	//std::cout &lt;&lt; &quot;Folder selected: &quot; &lt;&lt; dialog.get_filename()
+	//          &lt;&lt; std::endl;
 
-              std::string filename = dialog.get_filename();
-              std::ofstream out(filename.c_str());
-              FileWriter writer(out);
+	std::string filename = dialog.get_filename();
+	std::ofstream out(filename.c_str());
+	FileWriter writer(out);
 
-              wst-&gt;get_document().get_sector_model().write(writer);
-              wst-&gt;set_filename(filename);
+	wst-&gt;get_document().get_sector_model().write(writer);
+	wst-&gt;set_filename(filename);
 
-              notebook.set_tab_label_text(*notebook.get_nth_page(page), Glib::path_get_basename(filename));
-              add_recent_file(filename);
-              print(&quot;Wrote: &quot; + filename);
-              break;
-            }
+	notebook.set_tab_label_text(*notebook.get_nth_page(page), Glib::path_get_basename(filename));
+	add_recent_file(filename);
+	print(&quot;Wrote: &quot; + filename);
+	break;
+      }
 
-          case(Gtk::RESPONSE_CANCEL):
-            {
-              //std::cout &lt;&lt; &quot;Cancel clicked.&quot; &lt;&lt; std::endl;
-              break;
-            }
-        }
+      case(Gtk::RESPONSE_CANCEL):
+      {
+	//std::cout &lt;&lt; &quot;Cancel clicked.&quot; &lt;&lt; std::endl;
+	break;
+      }
     }
+  }
 }
 
 void
@@ -589,42 +589,42 @@
 {
   int page = notebook.get_current_page();
   if (page == -1)
-    {
-      // do nothing;
-    }
+  {
+    // do nothing;
+  }
   else
+  {
+    if (WindstilleWidget* wst = static_cast&lt;WindstilleWidget*&gt;(notebook.get_nth_page(page)))
     {
-      if (WindstilleWidget* wst = static_cast&lt;WindstilleWidget*&gt;(notebook.get_nth_page(page)))
-        {
-          Gtk::FileChooserDialog dialog(&quot;Save Screenshot&quot;,
-                                        Gtk::FILE_CHOOSER_ACTION_SAVE);
-          dialog.set_transient_for(*this);
-          dialog.set_do_overwrite_confirmation(true);
+      Gtk::FileChooserDialog dialog(&quot;Save Screenshot&quot;,
+				    Gtk::FILE_CHOOSER_ACTION_SAVE);
+      dialog.set_transient_for(*this);
+      dialog.set_do_overwrite_confirmation(true);
 
-          dialog.add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
-          dialog.add_button(Gtk::Stock::SAVE,   Gtk::RESPONSE_OK);
+      dialog.add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
+      dialog.add_button(Gtk::Stock::SAVE,   Gtk::RESPONSE_OK);
 
  
-          dialog.set_current_folder(&quot;/tmp/&quot;);
+      dialog.set_current_folder(&quot;/tmp/&quot;);
 
-          switch(dialog.run())
-            {
-              case(Gtk::RESPONSE_OK):
-                {
-                  std::string filename = dialog.get_filename();
-                  std::cout &lt;&lt; &quot;unimplemented screenshot: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-                  wst-&gt;save_screenshot(filename);
-                  break;
-                }
+      switch(dialog.run())
+      {
+	case(Gtk::RESPONSE_OK):
+	{
+	  std::string filename = dialog.get_filename();
+	  std::cout &lt;&lt; &quot;unimplemented screenshot: &quot; &lt;&lt; filename &lt;&lt; std::endl;
+	  wst-&gt;save_screenshot(filename);
+	  break;
+	}
 
-              case(Gtk::RESPONSE_CANCEL):
-                {
-                  //std::cout &lt;&lt; &quot;Cancel clicked.&quot; &lt;&lt; std::endl;
-                  break;
-                }
-            }
-        }
+	case(Gtk::RESPONSE_CANCEL):
+	{
+	  //std::cout &lt;&lt; &quot;Cancel clicked.&quot; &lt;&lt; std::endl;
+	  break;
+	}
+      }
     }
+  }
 }
 
 void
@@ -632,25 +632,25 @@
 {
   int page = notebook.get_current_page();
   if (page != -1)
-    {
-      notebook.remove_page(page);
+  {
+    notebook.remove_page(page);
 
-      if (!get_windstille_widget())
-        layer_manager.set_model(0);
-    }
+    if (!get_windstille_widget())
+      layer_manager.set_model(0);
+  }
 }
 
 void
 EditorWindow::show_minimap(bool v)
 {
   if (v)
-    {
-      minimap_widget.show();
-    }
+  {
+    minimap_widget.show();
+  }
   else
-    {
-      minimap_widget.hide();
-    }
+  {
+    minimap_widget.hide();
+  }
 }
 
 void
@@ -681,32 +681,32 @@
 EditorWindow::update_undo_state()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      action_group-&gt;get_action(&quot;Undo&quot;)-&gt;set_sensitive(wst-&gt;get_document().has_undo());
-      action_group-&gt;get_action(&quot;Redo&quot;)-&gt;set_sensitive(wst-&gt;get_document().has_redo());
-    }
+  {
+    action_group-&gt;get_action(&quot;Undo&quot;)-&gt;set_sensitive(wst-&gt;get_document().has_undo());
+    action_group-&gt;get_action(&quot;Redo&quot;)-&gt;set_sensitive(wst-&gt;get_document().has_redo());
+  }
 }
 
 void
 EditorWindow::on_undo()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().undo();
-      update_undo_state();
-      queue_draw();
-    }
+  {
+    wst-&gt;get_document().undo();
+    update_undo_state();
+    queue_draw();
+  }
 }
 
 void
 EditorWindow::on_redo()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().redo();
-      update_undo_state();
-      queue_draw();
-    }
+  {
+    wst-&gt;get_document().redo();
+    update_undo_state();
+    queue_draw();
+  }
 }
 
 void
@@ -714,62 +714,62 @@
 {
   //std::cout &lt;&lt; &quot;on_tool_select()&quot; &lt;&lt; action-&gt;get_active() &lt;&lt; std::endl;
   if (action-&gt;get_active())
-    {
-      current_tool = tool;
-      if (WindstilleWidget* wst = get_windstille_widget())
-        wst-&gt;queue_draw();
-    }
+  {
+    current_tool = tool;
+    if (WindstilleWidget* wst = get_windstille_widget())
+      wst-&gt;queue_draw();
+  }
 }
 
 void
 EditorWindow::toggle_render_layer(Glib::RefPtr&lt;Gtk::ToggleAction&gt; action, unsigned int mask)
 {
   if (WindstilleWidget* wst = get_windstille_widget())
+  {
+    SceneContext&amp; sc = *wst-&gt;get_sc();
+
+    if (action-&gt;get_active())
     {
-      SceneContext&amp; sc = *wst-&gt;get_sc();
+      sc.set_render_mask(sc.get_render_mask() | mask);
+    }
+    else
+    {
+      sc.set_render_mask(sc.get_render_mask() &amp; (~mask));
+    }
 
-      if (action-&gt;get_active())
-        {
-          sc.set_render_mask(sc.get_render_mask() | mask);
-        }
-      else
-        {
-          sc.set_render_mask(sc.get_render_mask() &amp; (~mask));
-        }
-
-      //std::cout &lt;&lt; &quot;mask: &quot; &lt;&lt; sc.get_render_mask() &lt;&lt; std::endl;
-      wst-&gt;queue_draw();
-    }
+    //std::cout &lt;&lt; &quot;mask: &quot; &lt;&lt; sc.get_render_mask() &lt;&lt; std::endl;
+    wst-&gt;queue_draw();
+  }
 }
 
 void
 EditorWindow::toggle_draw_only_active_layer(Glib::RefPtr&lt;Gtk::ToggleAction&gt; action)
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;set_draw_only_active_layer(action-&gt;get_active());
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;set_draw_only_active_layer(action-&gt;get_active());
+    wst-&gt;queue_draw();
+  }
 }
 
 void
 EditorWindow::toggle_background_layer(Glib::RefPtr&lt;Gtk::ToggleAction&gt; action)
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;set_draw_background_pattern(action-&gt;get_active());
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;set_draw_background_pattern(action-&gt;get_active());
+    wst-&gt;queue_draw();
+  }
 }
 
 void
 EditorWindow::toggle_grid_layer(Glib::RefPtr&lt;Gtk::ToggleAction&gt; action)
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;enable_grid(action-&gt;get_active());
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;enable_grid(action-&gt;get_active());
+    wst-&gt;queue_draw();
+  }
 }
 
 Tool*
@@ -783,13 +783,13 @@
 {
   int page = notebook.get_current_page();
   if (page == -1)
-    {
-      return 0;
-    }
+  {
+    return 0;
+  }
   else
-    {
-      return static_cast&lt;WindstilleWidget*&gt;(notebook.get_nth_page(page));
-    }
+  {
+    return static_cast&lt;WindstilleWidget*&gt;(notebook.get_nth_page(page));
+  }
 }
 
 void
@@ -798,25 +798,25 @@
   //std::cout &lt;&lt; &quot;on_switch_page(&quot; &lt;&lt; page &lt;&lt; &quot;, &quot; &lt;&lt; page_num &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
 
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      layer_manager.set_model(&amp;wst-&gt;get_document().get_sector_model());
-      layer_widget-&gt;update(wst-&gt;get_select_mask());
+  {
+    layer_manager.set_model(&amp;wst-&gt;get_document().get_sector_model());
+    layer_widget-&gt;update(wst-&gt;get_select_mask());
 
-      toggle_color_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::COLORMAP);
-      toggle_light_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::LIGHTMAP);
-      toggle_highlight_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::HIGHLIGHTMAP);
-      toggle_control_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::CONTROLMAP);
+    toggle_color_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::COLORMAP);
+    toggle_light_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::LIGHTMAP);
+    toggle_highlight_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::HIGHLIGHTMAP);
+    toggle_control_layer-&gt;set_active(wst-&gt;get_sc()-&gt;get_render_mask() &amp; SceneContext::CONTROLMAP);
 
-      background_layer-&gt;set_active(wst-&gt;get_draw_background_pattern());
-      visible_layer-&gt;set_active(wst-&gt;get_draw_only_active_layer());
-      grid_layer-&gt;set_active(wst-&gt;get_enable_grid());
+    background_layer-&gt;set_active(wst-&gt;get_draw_background_pattern());
+    visible_layer-&gt;set_active(wst-&gt;get_draw_only_active_layer());
+    grid_layer-&gt;set_active(wst-&gt;get_enable_grid());
 
-      update_undo_state();
-    }
+    update_undo_state();
+  }
   else
-    {
-      layer_manager.set_model(0);
-    }
+  {
+    layer_manager.set_model(0);
+  }
 }
 
 void
@@ -824,18 +824,18 @@
 {
   WindstilleWidget* wst = get_windstille_widget();
   if (wst)
-    {
-      (wst-&gt;get_document().*func)();
-    }
+  {
+    (wst-&gt;get_document().*func)();
+  }
 }
 
 bool
 EditorWindow::on_timeout()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;update(0.050f);
-    }
+  {
+    wst-&gt;update(0.050f);
+  }
   return true;
 }
 
@@ -845,96 +845,96 @@
   //std::cout &lt;&lt; &quot;EditorWindow::on_layer_toggle(&quot; &lt;&lt; layer &lt;&lt; &quot;, &quot; &lt;&lt; status &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;
 
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_select_mask().set(layer, status_);
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;get_select_mask().set(layer, status_);
+    wst-&gt;queue_draw();
+  }
 }
 
 void
 EditorWindow::on_play()
 {
   if (play_action-&gt;get_active())
-    {
-      //std::cout &lt;&lt; &quot;Play&quot; &lt;&lt; std::endl;
-      timeout_connection = Glib::signal_timeout().connect(sigc::mem_fun(*this, &amp;EditorWindow::on_timeout),
-                                                          50,
-                                                          Glib::PRIORITY_DEFAULT);
-    }
+  {
+    //std::cout &lt;&lt; &quot;Play&quot; &lt;&lt; std::endl;
+    timeout_connection = Glib::signal_timeout().connect(sigc::mem_fun(*this, &amp;EditorWindow::on_timeout),
+							50,
+							Glib::PRIORITY_DEFAULT);
+  }
   else
-    {
-      //std::cout &lt;&lt; &quot;Stop&quot; &lt;&lt; std::endl;
-      timeout_connection.disconnect();
-    }
+  {
+    //std::cout &lt;&lt; &quot;Stop&quot; &lt;&lt; std::endl;
+    timeout_connection.disconnect();
+  }
 }
 
 void
 EditorWindow::on_cut()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      clipboard = wst-&gt;get_document().get_selection()-&gt;clone();
-      wst-&gt;get_document().selection_delete();
-      queue_draw();
-    }
+  {
+    clipboard = wst-&gt;get_document().get_selection()-&gt;clone();
+    wst-&gt;get_document().selection_delete();
+    queue_draw();
+  }
 }
 
 void
 EditorWindow::on_copy()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      clipboard = wst-&gt;get_document().get_selection()-&gt;clone();
-    }
+  {
+    clipboard = wst-&gt;get_document().get_selection()-&gt;clone();
+  }
 }
 
 void
 EditorWindow::on_delete_layer()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().layer_remove(wst-&gt;get_current_layer_path());
-      queue_draw();
-    }
+  {
+    wst-&gt;get_document().layer_remove(wst-&gt;get_current_layer_path());
+    queue_draw();
+  }
 }
 
 void
 EditorWindow::on_reverse_layers()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().get_sector_model().reverse_layers();
-    }
+  {
+    wst-&gt;get_document().get_sector_model().reverse_layers();
+  }
 }
 
 void
 EditorWindow::on_new_layer()
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().layer_add(wst-&gt;get_current_layer_path());
-      layer_manager.get_treeview().expand_all();
-    }
+  {
+    wst-&gt;get_document().layer_add(wst-&gt;get_current_layer_path());
+    layer_manager.get_treeview().expand_all();
+  }
 }
 
 void
 EditorWindow::on_paste()
 {
   if (clipboard.get())
+  {
+    if (WindstilleWidget* wst = get_windstille_widget())
     {
-      if (WindstilleWidget* wst = get_windstille_widget())
-        {
-          LayerHandle layer = wst-&gt;get_current_layer();
-          for(Selection::reverse_iterator i = clipboard-&gt;rbegin(); i != clipboard-&gt;rend(); ++i)
-            {
-              layer-&gt;add(*i);
-            }
+      LayerHandle layer = wst-&gt;get_current_layer();
+      for(Selection::reverse_iterator i = clipboard-&gt;rbegin(); i != clipboard-&gt;rend(); ++i)
+      {
+	layer-&gt;add(*i);
+      }
 
-          wst-&gt;get_document().set_selection(clipboard);
-          clipboard = clipboard-&gt;clone();
-          queue_draw();
-        }
+      wst-&gt;get_document().set_selection(clipboard);
+      clipboard = clipboard-&gt;clone();
+      queue_draw();
     }
+  }
 }
 
 void
@@ -942,32 +942,32 @@
 {
   // Select all on current layer
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      LayerHandle layer = wst-&gt;get_current_layer();
-      SelectionHandle selection = Selection::create();
-      selection-&gt;add(layer-&gt;begin(), layer-&gt;end());
-      wst-&gt;get_document().set_selection(selection);
-    }
+  {
+    LayerHandle layer = wst-&gt;get_current_layer();
+    SelectionHandle selection = Selection::create();
+    selection-&gt;add(layer-&gt;begin(), layer-&gt;end());
+    wst-&gt;get_document().set_selection(selection);
+  }
 }
 
 void
 EditorWindow::on_show_all(bool v)
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().get_sector_model().set_all_visible(v);
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;get_document().get_sector_model().set_all_visible(v);
+    wst-&gt;queue_draw();
+  }
 }
 
 void
 EditorWindow::on_lock_all(bool v)
 {
   if (WindstilleWidget* wst = get_windstille_widget())
-    {
-      wst-&gt;get_document().get_sector_model().set_all_locked(v);
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;get_document().get_sector_model().set_all_locked(v);
+    wst-&gt;queue_draw();
+  }
 }
 
 void

Modified: trunk/windstille/src/editor/layer.cpp
===================================================================
--- trunk/windstille/src/editor/layer.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/layer.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -66,10 +66,10 @@
 Layer::draw(SceneContext&amp; sc, const SelectMask&amp; select_mask)
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      if (select_mask.match((*i)-&gt;get_select_mask()))
-        (*i)-&gt;draw(sc);
-    }
+  {
+    if (select_mask.match((*i)-&gt;get_select_mask()))
+      (*i)-&gt;draw(sc);
+  }
 }
 
 void
@@ -84,38 +84,38 @@
 Layer::update(float delta)
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      (*i)-&gt;update(delta);
-    }
+  {
+    (*i)-&gt;update(delta);
+  }
 }
 
 ObjectModelHandle
 Layer::get_object_at(const Vector2f&amp; pos, const SelectMask&amp; select_mask) const
 {
   for(Objects::const_reverse_iterator i = objects.rbegin(); i != objects.rend(); ++i)
+  {
+    if (select_mask.match((*i)-&gt;get_select_mask()) &amp;&amp;
+	(*i)-&gt;is_at(pos))
     {
-      if (select_mask.match((*i)-&gt;get_select_mask()) &amp;&amp;
-          (*i)-&gt;is_at(pos))
-        {
-          return *i;
-        }
+      return *i;
     }
+  }
   return ObjectModelHandle();
 }
 
 SelectionHandle
 Layer::get_selection(const Rectf&amp; rect, const SelectMask&amp; select_mask) const
 {
- SelectionHandle selection = Selection::create();
+  SelectionHandle selection = Selection::create();
 
   for(Objects::const_reverse_iterator i = objects.rbegin(); i != objects.rend(); ++i)
+  {
+    if (select_mask.match((*i)-&gt;get_select_mask()) &amp;&amp;
+	rect.contains((*i)-&gt;get_bounding_box()))
     {
-      if (select_mask.match((*i)-&gt;get_select_mask()) &amp;&amp;
-          rect.contains((*i)-&gt;get_bounding_box()))
-        {
-          selection-&gt;add(*i);
-        }
+      selection-&gt;add(*i);
     }
+  }
 
   return selection;
 }
@@ -159,16 +159,16 @@
   j = std::find_if(j, objects.end(), OverlapsWith(object-&gt;get_bounding_box()));
 
   if (j == objects.end())
-    {
-      // object overlaps with no other object, no point in raising it
-    }
+  {
+    // object overlaps with no other object, no point in raising it
+  }
   else
-    {
-      objects.erase(i);
-      objects.insert(++j, object);
+  {
+    objects.erase(i);
+    objects.insert(++j, object);
       
-      m_sector.rebuild_scene_graph();
-    }
+    m_sector.rebuild_scene_graph();
+  }
 }
 
 void
@@ -182,19 +182,19 @@
   j = std::find_if(j, objects.rend(), OverlapsWith(object-&gt;get_bounding_box()));
 
   if (j == objects.rend())
-    {
-      // object overlaps with no other object, no point in lowering it
-    }
+  {
+    // object overlaps with no other object, no point in lowering it
+  }
   else
-    {
-      // the base() of base in one further then where the reverse
-      // iterator was, so we have to move back to get the same
-      // position
-      objects.erase(--(i.base()));
-      objects.insert(--(j.base()), object);
+  {
+    // the base() of base in one further then where the reverse
+    // iterator was, so we have to move back to get the same
+    // position
+    objects.erase(--(i.base()));
+    objects.insert(--(j.base()), object);
 
-      m_sector.rebuild_scene_graph();
-    }
+    m_sector.rebuild_scene_graph();
+  }
 }
 
 SnapData
@@ -206,15 +206,15 @@
 
   // Find the smallest snap offset
   for(Objects::const_reverse_iterator i = objects.rbegin(); i != objects.rend(); ++i)
+  {
+    // object is not in the list of objects to ignore
+    if ((*i)-&gt;is_snappable() &amp;&amp;
+	ignore_objects.find(*i) == ignore_objects.end())
     {
-      // object is not in the list of objects to ignore
-      if ((*i)-&gt;is_snappable() &amp;&amp;
-          ignore_objects.find(*i) == ignore_objects.end())
-        {
-          SnapData snap = (*i)-&gt;snap_object(rect);
-          best_snap.merge(snap);
-        }
+      SnapData snap = (*i)-&gt;snap_object(rect);
+      best_snap.merge(snap);
     }
+  }
 
   return best_snap;
 }
@@ -223,9 +223,9 @@
 Layer::write(FileWriter&amp; writer) const
 {
   for(Objects::const_iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      (*i)-&gt;write(writer);
-    }
+  {
+    (*i)-&gt;write(writer);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/layer_manager.cpp
===================================================================
--- trunk/windstille/src/editor/layer_manager.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/layer_manager.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -65,7 +65,7 @@
   auto_lock = Gtk::ToggleAction::create_with_icon_name(&quot;AutoLockLayer&quot;, &quot;auto_lock&quot;, &quot;Auto Lock All&quot;, &quot;All layers except the current ones are treated as locked&quot;);
   action_group-&gt;add(auto_lock,
                     sigc::bind(sigc::mem_fun(*this, &amp;LayerManager::on_auto_lock), auto_lock));
-                    //sigc::bind(sigc::mem_fun(editor, &amp;EditorWindow::on_auto_lock), auto_lock));
+  //sigc::bind(sigc::mem_fun(editor, &amp;EditorWindow::on_auto_lock), auto_lock));
 
   ui_manager-&gt;insert_action_group(action_group);
 
@@ -108,51 +108,51 @@
 LayerManager::set_model(SectorModel* model)
 {
   if (model)
-    {
-      treeview.set_model(model-&gt;get_layer_tree());
+  {
+    treeview.set_model(model-&gt;get_layer_tree());
 
-      // Recreate all the columns, since if we don't do that, we lose
-      // editability for some reason
-      treeview.remove_all_columns();
-      treeview.append_column(&quot;Type&quot;, LayerManagerColumns::instance().type_icon);
-      treeview.append_column_editable(&quot;Name&quot;, LayerManagerColumns::instance().name);
-      treeview.append_column_editable(&quot;Visible&quot;, LayerManagerColumns::instance().visible);
-      treeview.append_column_editable(&quot;Locked&quot;, LayerManagerColumns::instance().locked);
-
-      treeview.expand_all();
-      treeview.set_cursor(Gtk::TreeModel::Path(&quot;0&quot;));
-    }
+    // Recreate all the columns, since if we don't do that, we lose
+    // editability for some reason
+    treeview.remove_all_columns();
+    treeview.append_column(&quot;Type&quot;, LayerManagerColumns::instance().type_icon);
+    treeview.append_column_editable(&quot;Name&quot;, LayerManagerColumns::instance().name);
+    treeview.append_column_editable(&quot;Visible&quot;, LayerManagerColumns::instance().visible);
+    treeview.append_column_editable(&quot;Locked&quot;, LayerManagerColumns::instance().locked);
+    
+    treeview.expand_all();
+    treeview.set_cursor(Gtk::TreeModel::Path(&quot;0&quot;));
+  }
   else
-    {
-      treeview.set_model(Glib::RefPtr&lt;Gtk::ListStore&gt;());
-    }
+  {
+    treeview.set_model(Glib::RefPtr&lt;Gtk::ListStore&gt;());
+  }
 }
 
 void
 LayerManager::on_cursor_changed()
 {
   if (auto_lock-&gt;get_active())
+  {
+    Gtk::TreeModel::Path path_;
+    Gtk::TreeViewColumn* focus_column;
+    treeview.get_cursor(path_, focus_column);
+      
+    if (!path_.gobj())
     {
-      Gtk::TreeModel::Path path_;
-      Gtk::TreeViewColumn* focus_column;
-      treeview.get_cursor(path_, focus_column);
-      
-      if (!path_.gobj())
-        {
-          std::cout &lt;&lt; &quot;LayerManager::on_cursor_changed(): Error: Couldn't get path&quot; &lt;&lt; std::endl;
-        }
-      else
-        {
-          //std::cout &lt;&lt; &quot;on_cursor_changed: &quot; &lt;&lt; path.to_string() &lt;&lt; std::endl;
-          Gtk::TreeModel::iterator it = treeview.get_model()-&gt;get_iter(path_);
-          if (it)
-            {
-              EditorWindow::current()-&gt;on_lock_all(true);
-              (*it)[LayerManagerColumns::instance().locked] = false;
-              ((LayerHandle)(*it)[LayerManagerColumns::instance().layer])-&gt;sync(*it);
-            }
-        }
+      std::cout &lt;&lt; &quot;LayerManager::on_cursor_changed(): Error: Couldn't get path&quot; &lt;&lt; std::endl;
     }
+    else
+    {
+      //std::cout &lt;&lt; &quot;on_cursor_changed: &quot; &lt;&lt; path.to_string() &lt;&lt; std::endl;
+      Gtk::TreeModel::iterator it = treeview.get_model()-&gt;get_iter(path_);
+      if (it)
+      {
+	EditorWindow::current()-&gt;on_lock_all(true);
+	(*it)[LayerManagerColumns::instance().locked] = false;
+	((LayerHandle)(*it)[LayerManagerColumns::instance().layer])-&gt;sync(*it);
+      }
+    }
+  }
 }
 
 void

Modified: trunk/windstille/src/editor/layer_widget.cpp
===================================================================
--- trunk/windstille/src/editor/layer_widget.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/layer_widget.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -31,29 +31,29 @@
   int layer_number = 0;
   for(int y = 0; y &lt; 2; ++y)
     for(int x = 0; x &lt; 9; ++x)
+    {
+      if ((x+1) % 5)
       {
-        if ((x+1) % 5)
-          {
-            Gtk::ToggleButton* button = Gtk::manage(new Gtk::ToggleButton());
-            button-&gt;set_size_request(16, 16);
-            table.attach(*button, x, x+1, y, y+1);
+	Gtk::ToggleButton* button = Gtk::manage(new Gtk::ToggleButton());
+	button-&gt;set_size_request(16, 16);
+	table.attach(*button, x, x+1, y, y+1);
 
-            button-&gt;signal_toggled().connect(sigc::bind(sigc::mem_fun(*this, &amp;LayerWidget::on_layer_toggle), 
-                                                        button, layer_number));
-            buttons.push_back(button);
-            layer_number += 1;
-          }
-        else
-          {
-            if (y == 0)
-              {
-                Gtk::VSeparator* separator = Gtk::manage(new Gtk::VSeparator());
-                //Gtk::Widget* separator = Gtk::manage(new Gtk::Widget());
-                separator-&gt;set_size_request(12, -1);
-                table.attach(*separator, x, x+1, 0, 2);
-              }
-          }
+	button-&gt;signal_toggled().connect(sigc::bind(sigc::mem_fun(*this, &amp;LayerWidget::on_layer_toggle), 
+						    button, layer_number));
+	buttons.push_back(button);
+	layer_number += 1;
       }
+      else
+      {
+	if (y == 0)
+	{
+	  Gtk::VSeparator* separator = Gtk::manage(new Gtk::VSeparator());
+	  //Gtk::Widget* separator = Gtk::manage(new Gtk::Widget());
+	  separator-&gt;set_size_request(12, -1);
+	  table.attach(*separator, x, x+1, 0, 2);
+	}
+      }
+    }
 
   add(table);
 }
@@ -72,9 +72,9 @@
 LayerWidget::update(const SelectMask&amp; layers)
 {
   for(int i = 0; i &lt; layers.size(); ++i)
-    {
-      buttons[i]-&gt;set_active(layers.get(i));
-    }
+  {
+    buttons[i]-&gt;set_active(layers.get(i));
+  }
 }
 
 SelectMask
@@ -82,9 +82,9 @@
 {
   SelectMask select_mask;
   for(int i = 0; i &lt; select_mask.size(); ++i)
-    {
-      select_mask.set(i, buttons[i]-&gt;get_active());
-    }
+  {
+    select_mask.set(i, buttons[i]-&gt;get_active());
+  }
   return select_mask;
 }
 

Modified: trunk/windstille/src/editor/minimap_widget.cpp
===================================================================
--- trunk/windstille/src/editor/minimap_widget.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/minimap_widget.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -54,17 +54,17 @@
   Glib::RefPtr&lt;Gdk::GL::Window&gt; glwindow = get_gl_window();
 
   if (!glwindow-&gt;gl_begin(get_gl_context()))
-    {
-      return false;
-    }
+  {
+    return false;
+  }
   else
-    {
-      //glClear(GL_COLOR_BUFFER_BIT);
-      //glwindow-&gt;swap_buffers();
-      glwindow-&gt;gl_end();
+  {
+    //glClear(GL_COLOR_BUFFER_BIT);
+    //glwindow-&gt;swap_buffers();
+    glwindow-&gt;gl_end();
 
-      return true;
-    }
+    return true;
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/navgraph_edge_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/navgraph_edge_object_model.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/navgraph_edge_object_model.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -25,7 +25,7 @@
 
 NavGraphEdgeObjectModel::NavGraphEdgeObjectModel(boost::shared_ptr&lt;NavGraphNodeObjectModel&gt; lhs,
                                                  boost::shared_ptr&lt;NavGraphNodeObjectModel&gt; rhs)
-                                                 //SectorModel&amp; sector)
+  //SectorModel&amp; sector)
   : ObjectModel(&quot;NavGraphEdgeObjectModel&quot;, Vector2f()),
     m_lhs(lhs),
     m_rhs(rhs),
@@ -44,14 +44,14 @@
 {
   if (m_drawable)
   {
-      m_drawable-&gt;clear();
-      m_drawable-&gt;set_mode(GL_LINES);
+    m_drawable-&gt;clear();
+    m_drawable-&gt;set_mode(GL_LINES);
 
-      m_drawable-&gt;color(Color(0.0f, 1.0f, 1.0f));
-      m_drawable-&gt;vertex(m_lhs-&gt;get_world_pos());
+    m_drawable-&gt;color(Color(0.0f, 1.0f, 1.0f));
+    m_drawable-&gt;vertex(m_lhs-&gt;get_world_pos());
 
-      m_drawable-&gt;color(Color(0.0f, 1.0f, 1.0f));
-      m_drawable-&gt;vertex(m_rhs-&gt;get_world_pos());
+    m_drawable-&gt;color(Color(0.0f, 1.0f, 1.0f));
+    m_drawable-&gt;vertex(m_rhs-&gt;get_world_pos());
   }
 }
 

Modified: trunk/windstille/src/editor/navgraph_insert_tool.cpp
===================================================================
--- trunk/windstille/src/editor/navgraph_insert_tool.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/navgraph_insert_tool.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -112,24 +112,24 @@
 
     if (new_mouse_over_node != mouse_over_node ||
         new_mouse_over_edge != mouse_over_edge)
-      {
-        mouse_over_node = new_mouse_over_node; 
-        mouse_over_edge = new_mouse_over_edge; 
+    {
+      mouse_over_node = new_mouse_over_node; 
+      mouse_over_edge = new_mouse_over_edge; 
 
-        wst.queue_draw();
-      }
+      wst.queue_draw();
+    }
   }
 
   switch(mode)
-    {
-      case EDGE_MODE:
-        connection_node = navgraph.find_closest_node(mouse_pos, 16.0f); // FIXME: Radius should scale with zoom
-        wst.queue_draw();
-        break;
+  {
+    case EDGE_MODE:
+      connection_node = navgraph.find_closest_node(mouse_pos, 16.0f); // FIXME: Radius should scale with zoom
+      wst.queue_draw();
+      break;
 
-      case NO_MODE:
-        break;
-    }
+    case NO_MODE:
+      break;
+  }
 }
 
 void
@@ -139,15 +139,15 @@
   //NavigationGraphModel&amp; navgraph = *wst.get_sector_model().get_nav_graph();
 
   switch(mode)
-    {
-      case EDGE_MODE:
-        connection_node = boost::shared_ptr&lt;NavGraphNodeObjectModel&gt;();
-        wst.queue_draw();
-        break;
+  {
+    case EDGE_MODE:
+      connection_node = boost::shared_ptr&lt;NavGraphNodeObjectModel&gt;();
+      wst.queue_draw();
+      break;
 
-      case NO_MODE:
-        break;
-    }
+    case NO_MODE:
+      break;
+  }
 }
 
 void
@@ -160,58 +160,58 @@
   boost::shared_ptr&lt;NavGraphEdgeObjectModel&gt; edge = navgraph.find_closest_edge(mouse_pos, 16.0f);
 
   if (node)
-    {
-      //navgraph.remove_node(node);
-      wst.get_document().object_remove(node);
+  {
+    //navgraph.remove_node(node);
+    wst.get_document().object_remove(node);
 
-      mouse_over_edge = boost::shared_ptr&lt;NavGraphEdgeObjectModel&gt;();
-      mouse_over_node = boost::shared_ptr&lt;NavGraphNodeObjectModel&gt;();
+    mouse_over_edge = boost::shared_ptr&lt;NavGraphEdgeObjectModel&gt;();
+    mouse_over_node = boost::shared_ptr&lt;NavGraphNodeObjectModel&gt;();
 
-      wst.queue_draw();
-    }
+    wst.queue_draw();
+  }
   else if (edge)
-    {
-      //navgraph.remove_edge(edge);
-      wst.get_document().object_remove(edge);
+  {
+    //navgraph.remove_edge(edge);
+    wst.get_document().object_remove(edge);
 
-      mouse_over_edge = boost::shared_ptr&lt;NavGraphEdgeObjectModel&gt;();
-      mouse_over_node = boost::shared_ptr&lt;NavGraphNodeObjectModel&gt;();
+    mouse_over_edge = boost::shared_ptr&lt;NavGraphEdgeObjectModel&gt;();
+    mouse_over_node = boost::shared_ptr&lt;NavGraphNodeObjectModel&gt;();
 
-      wst.queue_draw();
-    }
+    wst.queue_draw();
+  }
   else
-    {
+  {
       
-    }
+  }
 }
   
 void
 NavgraphInsertTool::draw(SceneContext&amp; sc)
 {
   if (last_node)
+  {
+    if (connection_node)
     {
-      if (connection_node)
-        {
-          sc.control().draw_line(last_node-&gt;get_world_pos(), connection_node-&gt;get_world_pos(), Color(1,1,1));
-          sc.control().draw_rect(Rectf(connection_node-&gt;get_world_pos() - Vector2f(16,16), Sizef(32,32)), Color(1.0f, 1.0f, 1.0f));
-        }
-      else
-        {
-          sc.control().draw_line(last_node-&gt;get_world_pos(), mouse_pos, Color(1,1,1));
-        }
-
-      sc.control().draw_rect(Rectf(last_node-&gt;get_world_pos() - Vector2f(16,16), Sizef(32,32)), Color(1.0f, 1.0f, 1.0f));
+      sc.control().draw_line(last_node-&gt;get_world_pos(), connection_node-&gt;get_world_pos(), Color(1,1,1));
+      sc.control().draw_rect(Rectf(connection_node-&gt;get_world_pos() - Vector2f(16,16), Sizef(32,32)), Color(1.0f, 1.0f, 1.0f));
     }
+    else
+    {
+      sc.control().draw_line(last_node-&gt;get_world_pos(), mouse_pos, Color(1,1,1));
+    }
 
+    sc.control().draw_rect(Rectf(last_node-&gt;get_world_pos() - Vector2f(16,16), Sizef(32,32)), Color(1.0f, 1.0f, 1.0f));
+  }
+
   if (mouse_over_node)
-    {
-      sc.control().draw_rect(Rectf(mouse_over_node-&gt;get_world_pos() - Vector2f(16,16), Sizef(32,32)), Color(1.0f, 1.0f, 1.0f));      
-    }
+  {
+    sc.control().draw_rect(Rectf(mouse_over_node-&gt;get_world_pos() - Vector2f(16,16), Sizef(32,32)), Color(1.0f, 1.0f, 1.0f));      
+  }
   else if (mouse_over_edge)
-    {
-      sc.control().draw_line(mouse_over_edge-&gt;get_lhs()-&gt;get_world_pos(), 
-                             mouse_over_edge-&gt;get_rhs()-&gt;get_world_pos(), Color(1,1,1));
-    }
+  {
+    sc.control().draw_line(mouse_over_edge-&gt;get_lhs()-&gt;get_world_pos(), 
+			   mouse_over_edge-&gt;get_rhs()-&gt;get_world_pos(), Color(1,1,1));
+  }
 }
   
 /* EOF */

Modified: trunk/windstille/src/editor/object_model.cpp
===================================================================
--- trunk/windstille/src/editor/object_model.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/object_model.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -84,31 +84,31 @@
   { // Remove the old parent
     ObjectModelHandle parent = parent_ptr.lock();
     if (parent)
-      { 
-        rel_pos += parent-&gt;get_world_pos();
-        parent_ptr = ObjectModelPtr();
-      }
+    { 
+      rel_pos += parent-&gt;get_world_pos();
+      parent_ptr = ObjectModelPtr();
+    }
   }
 
   // Check that we don't create a loop to 'this' by parenting
   ObjectModelHandle pptr = parent_;
   while(pptr.get())
+  {
+    if (pptr.get() == this)
     {
-      if (pptr.get() == this)
-        {
-          EditorWindow::current()-&gt;print(&quot;Error: Trying to create parent loop&quot;);
+      EditorWindow::current()-&gt;print(&quot;Error: Trying to create parent loop&quot;);
 
-          parent_ptr = ObjectModelPtr();
-          return;
-        }
-      pptr = pptr-&gt;get_parent();
+      parent_ptr = ObjectModelPtr();
+      return;
     }
+    pptr = pptr-&gt;get_parent();
+  }
 
   // Set new parent
   if (parent_.get() &amp;&amp; recalc_pos)
-    {
-      rel_pos -= parent_-&gt;get_world_pos();
-    }
+  {
+    rel_pos -= parent_-&gt;get_world_pos();
+  }
 
   parent_ptr = parent_;
 }
@@ -118,13 +118,13 @@
 {
   ObjectModelHandle parent = parent_ptr.lock();
   if (parent.get())
-    {
-      return rel_pos + parent-&gt;get_world_pos();
-    }
+  {
+    return rel_pos + parent-&gt;get_world_pos();
+  }
   else
-    {
-      return rel_pos;
-    }
+  {
+    return rel_pos;
+  }
 }
 
 void
@@ -159,9 +159,9 @@
   Vector2f wo_pos = get_world_pos();
 
   if (ObjectModelHandle parent = parent_ptr.lock())
-    {
-      sc.control().draw_line(wo_pos, parent-&gt;get_world_pos(), Color(0,0,1, 0.5f));
-    }
+  {
+    sc.control().draw_line(wo_pos, parent-&gt;get_world_pos(), Color(0,0,1, 0.5f));
+  }
 
   //sc.control().fill_rect(Rectf(wo_pos - Vector2f(8, 8), Sizef(16, 16)), Color(1,0,0));
 }
@@ -205,81 +205,81 @@
   float y_dist = std::min(top_dist, bottom_dist);
 
   if (x_dist &lt; y_dist)
-    { // closer on the X axis
-      if (overlap(rect.top, rect.bottom,  in.top, in.bottom))
-        {
-          float y_snap = 0.0f;
+  { // closer on the X axis
+    if (overlap(rect.top, rect.bottom,  in.top, in.bottom))
+    {
+      float y_snap = 0.0f;
 
-          if (fabs(rect.top - in.top) &lt; snap_threshold)
-            {
-              y_snap = rect.top - in.top;
-              snap.y_set = true;
-            }
+      if (fabs(rect.top - in.top) &lt; snap_threshold)
+      {
+	y_snap = rect.top - in.top;
+	snap.y_set = true;
+      }
 
-          if (fabs(rect.bottom - in.bottom) &lt; snap_threshold)
-            {
-              y_snap = rect.bottom - in.bottom;
-              snap.y_set = true;
-            }
+      if (fabs(rect.bottom - in.bottom) &lt; snap_threshold)
+      {
+	y_snap = rect.bottom - in.bottom;
+	snap.y_set = true;
+      }
 
-          if (left_dist &lt; right_dist)
-            { // snap to left edge
-              if (left_dist &lt; snap_threshold)
-                {
-                  snap.offset.x = rect.left - in.right;
-                  snap.offset.y = y_snap;
-                  snap.x_set = true;
-                }
-            }
-          else
-            { // snap to right edge
-              if (right_dist &lt; snap_threshold)
-                {
-                  snap.offset.x = rect.right - in.left;
-                  snap.offset.y = y_snap;
-                  snap.x_set = true;
-                }
-            }
-        }
+      if (left_dist &lt; right_dist)
+      { // snap to left edge
+	if (left_dist &lt; snap_threshold)
+	{
+	  snap.offset.x = rect.left - in.right;
+	  snap.offset.y = y_snap;
+	  snap.x_set = true;
+	}
+      }
+      else
+      { // snap to right edge
+	if (right_dist &lt; snap_threshold)
+	{
+	  snap.offset.x = rect.right - in.left;
+	  snap.offset.y = y_snap;
+	  snap.x_set = true;
+	}
+      }
     }
+  }
   else
-    { // closer on the Y axis
-      if (overlap(rect.left, rect.right,  in.left, in.right))
-        {
-          float x_snap = 0.0f;
+  { // closer on the Y axis
+    if (overlap(rect.left, rect.right,  in.left, in.right))
+    {
+      float x_snap = 0.0f;
 
-          if (fabs(rect.left - in.left) &lt; snap_threshold)
-            {
-              x_snap = rect.left - in.left;
-              snap.x_set = true;
-            }
+      if (fabs(rect.left - in.left) &lt; snap_threshold)
+      {
+	x_snap = rect.left - in.left;
+	snap.x_set = true;
+      }
 
-          if (fabs(rect.right - in.right) &lt; snap_threshold)
-            {
-              x_snap = rect.right - in.right;
-              snap.x_set = true;
-            }
+      if (fabs(rect.right - in.right) &lt; snap_threshold)
+      {
+	x_snap = rect.right - in.right;
+	snap.x_set = true;
+      }
 
-          if (top_dist &lt; bottom_dist)
-            { // snap to top edge
-              if (top_dist &lt; snap_threshold)
-                {
-                  snap.offset.x = x_snap;
-                  snap.offset.y = rect.top - in.bottom;
-                  snap.y_set = true;
-                }
-            }
-          else
-            { // snap to bottom edge
-              if (bottom_dist &lt; snap_threshold)
-                {
-                  snap.offset.x = x_snap;
-                  snap.offset.y = rect.bottom - in.top;
-                  snap.y_set = true;
-                }
-            }
-        }      
-    }
+      if (top_dist &lt; bottom_dist)
+      { // snap to top edge
+	if (top_dist &lt; snap_threshold)
+	{
+	  snap.offset.x = x_snap;
+	  snap.offset.y = rect.top - in.bottom;
+	  snap.y_set = true;
+	}
+      }
+      else
+      { // snap to bottom edge
+	if (bottom_dist &lt; snap_threshold)
+	{
+	  snap.offset.x = x_snap;
+	  snap.offset.y = rect.bottom - in.top;
+	  snap.y_set = true;
+	}
+      }
+    }      
+  }
 
   return snap;
 }

Modified: trunk/windstille/src/editor/object_model_factory.cpp
===================================================================
--- trunk/windstille/src/editor/object_model_factory.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/object_model_factory.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -26,14 +26,14 @@
 ObjectModelFactory::create(const FileReader&amp; reader)
 {
   if (reader.get_name() == &quot;decal&quot;)
-    {
-      return ObjectModelHandle(new DecalObjectModel(reader));
-    }
+  {
+    return ObjectModelHandle(new DecalObjectModel(reader));
+  }
   else
-    {
-      throw std::runtime_error(&quot;Unknown object type '&quot; + reader.get_name() + &quot;'&quot;);
-      return ObjectModelHandle();
-    }
+  {
+    throw std::runtime_error(&quot;Unknown object type '&quot; + reader.get_name() + &quot;'&quot;);
+    return ObjectModelHandle();
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/object_selector.cpp
===================================================================
--- trunk/windstille/src/editor/object_selector.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/object_selector.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -192,69 +192,69 @@
 
   Glib::Dir dir(pathname);
   for(Glib::Dir::iterator i = dir.begin(); i != dir.end(); ++i)
+  {
+    if (has_suffix(*i, &quot;.png&quot;))
     {
-      if (has_suffix(*i, &quot;.png&quot;))
-        {
-          Glib::ustring path_ = pathname;
-          path_ += *i;
-          images.push_back(path_);
-        }
+      Glib::ustring path_ = pathname;
+      path_ += *i;
+      images.push_back(path_);
     }
+  }
 
   std::sort(images.begin(), images.end());
 
   for(std::vector&lt;Glib::ustring&gt;::iterator i = images.begin(); i != images.end(); ++i)    
-    {
-      Glib::RefPtr&lt;Gdk::Pixbuf&gt; pixbuf = Gdk::Pixbuf::create_from_file(*i);
-      Glib::RefPtr&lt;Gdk::Pixbuf&gt; icon;
+  {
+    Glib::RefPtr&lt;Gdk::Pixbuf&gt; pixbuf = Gdk::Pixbuf::create_from_file(*i);
+    Glib::RefPtr&lt;Gdk::Pixbuf&gt; icon;
 
-      { // Create an icon, by scaling it down, keeping aspect
-        // intact and adding a background (important to make drag&amp;drop easier)
-        int size     = 48; // size of the icon
-        int min_size = 16; // minimum width/height of the icon after scaling
+    { // Create an icon, by scaling it down, keeping aspect
+      // intact and adding a background (important to make drag&amp;drop easier)
+      int size     = 48; // size of the icon
+      int min_size = 16; // minimum width/height of the icon after scaling
 
-        if (1)
-          {
-            icon = Gdk::Pixbuf::create_from_file(&quot;data/editor/icon_bg.png&quot;);
-            size = std::max(icon-&gt;get_width(), icon-&gt;get_height());
-          }
-        else
-          {
-            icon = Gdk::Pixbuf::create(Gdk::COLORSPACE_RGB, true, 8, size, size);
-            icon-&gt;fill(0x444444ff);
-          }
+      if (1)
+      {
+	icon = Gdk::Pixbuf::create_from_file(&quot;data/editor/icon_bg.png&quot;);
+	size = std::max(icon-&gt;get_width(), icon-&gt;get_height());
+      }
+      else
+      {
+	icon = Gdk::Pixbuf::create(Gdk::COLORSPACE_RGB, true, 8, size, size);
+	icon-&gt;fill(0x444444ff);
+      }
 
-        // Scale pixbuf to icon size while keeping aspect ratio intact
-        double x_scale = (double)size / pixbuf-&gt;get_width();
-        double y_scale = (double)size / pixbuf-&gt;get_height();
+      // Scale pixbuf to icon size while keeping aspect ratio intact
+      double x_scale = (double)size / pixbuf-&gt;get_width();
+      double y_scale = (double)size / pixbuf-&gt;get_height();
 
-        if (x_scale * pixbuf-&gt;get_width() &lt; min_size)
-          x_scale = min_size / pixbuf-&gt;get_width();
+      if (x_scale * pixbuf-&gt;get_width() &lt; min_size)
+	x_scale = min_size / pixbuf-&gt;get_width();
 
-        if (y_scale * pixbuf-&gt;get_height() &lt; min_size)
-          y_scale = min_size / pixbuf-&gt;get_height();
+      if (y_scale * pixbuf-&gt;get_height() &lt; min_size)
+	y_scale = min_size / pixbuf-&gt;get_height();
 
-        if (pixbuf-&gt;get_width() &gt; pixbuf-&gt;get_height())              
-          y_scale = x_scale;
-        else
-          x_scale = y_scale;
+      if (pixbuf-&gt;get_width() &gt; pixbuf-&gt;get_height())              
+	y_scale = x_scale;
+      else
+	x_scale = y_scale;
 
-        int r_w = int(pixbuf-&gt;get_width() * x_scale);
-        int r_h = int(pixbuf-&gt;get_height() * y_scale);
+      int r_w = int(pixbuf-&gt;get_width() * x_scale);
+      int r_h = int(pixbuf-&gt;get_height() * y_scale);
 
-        pixbuf-&gt;composite(icon, 
-                          (size - r_w)/2, (size - r_h)/2,
-                          r_w, r_h,
-                          (size - r_w)/2, (size - r_h)/2,
-                          x_scale, y_scale,
-                          Gdk::INTERP_TILES, 
-                          255);
-      }
+      pixbuf-&gt;composite(icon, 
+			(size - r_w)/2, (size - r_h)/2,
+			r_w, r_h,
+			(size - r_w)/2, (size - r_h)/2,
+			x_scale, y_scale,
+			Gdk::INTERP_TILES, 
+			255);
+    }
 
-      add_decal(icon, *i, 
-                &quot;<A HREF="file:///home/ingo/projects/windstille/trunk/windstille/">file:///home/ingo/projects/windstille/trunk/windstille/</A>&quot; + *i, 
-                filter_);
-    }
+    add_decal(icon, *i, 
+	      &quot;<A HREF="file:///home/ingo/projects/windstille/trunk/windstille/">file:///home/ingo/projects/windstille/trunk/windstille/</A>&quot; + *i, 
+	      filter_);
+  }
 }
 
 void
@@ -290,28 +290,28 @@
   for(Gtk::IconView::ArrayHandle_TreePaths::iterator i = selection.begin();
       i != selection.end();
       ++i)
-    {
-      Gtk::TreeModel::Path path_ = list_filter-&gt;convert_path_to_child_path(*i);
-      Gtk::ListStore::iterator it = list_store-&gt;get_iter(path_);
+  {
+    Gtk::TreeModel::Path path_ = list_filter-&gt;convert_path_to_child_path(*i);
+    Gtk::ListStore::iterator it = list_store-&gt;get_iter(path_);
 
-      iconpath = (*it)[Columns::instance().pathname];
-    }
+    iconpath = (*it)[Columns::instance().pathname];
+  }
 
   if (iconpath.empty())
-    {
-      // refuse drag: how?
-    }
+  {
+    // refuse drag: how?
+  }
   else
+  {
+    Glib::RefPtr&lt;Gdk::Pixbuf&gt; pixbuf = Gdk::Pixbuf::create_from_file(iconpath);
+    if (WindstilleWidget* wst = EditorWindow::current()-&gt;get_windstille_widget())
     {
-      Glib::RefPtr&lt;Gdk::Pixbuf&gt; pixbuf = Gdk::Pixbuf::create_from_file(iconpath);
-      if (WindstilleWidget* wst = EditorWindow::current()-&gt;get_windstille_widget())
-        {
-          pixbuf = pixbuf-&gt;scale_simple(std::max(4, int(static_cast&lt;float&gt;(pixbuf-&gt;get_width())  * wst-&gt;get_state().get_zoom())),
-                                        std::max(4, int(static_cast&lt;float&gt;(pixbuf-&gt;get_height()) * wst-&gt;get_state().get_zoom())),
-                                        Gdk::INTERP_TILES);
-        }
-      context-&gt;set_icon(pixbuf, pixbuf-&gt;get_width()/2, pixbuf-&gt;get_height()/2);
+      pixbuf = pixbuf-&gt;scale_simple(std::max(4, int(static_cast&lt;float&gt;(pixbuf-&gt;get_width())  * wst-&gt;get_state().get_zoom())),
+				    std::max(4, int(static_cast&lt;float&gt;(pixbuf-&gt;get_height()) * wst-&gt;get_state().get_zoom())),
+				    Gdk::INTERP_TILES);
     }
+    context-&gt;set_icon(pixbuf, pixbuf-&gt;get_width()/2, pixbuf-&gt;get_height()/2);
+  }
 }
 
 void
@@ -326,21 +326,21 @@
   for(Gtk::IconView::ArrayHandle_TreePaths::const_iterator i = selection.begin();
       i != selection.end();
       ++i)
+  {
+    Gtk::TreeModel::Path path_ = list_filter-&gt;convert_path_to_child_path(*i);
+    Gtk::ListStore::iterator it = list_store-&gt;get_iter(path_);
+
+    if (selection_data.get_target() == &quot;application/x-windstille-decal&quot;)
     {
-      Gtk::TreeModel::Path path_ = list_filter-&gt;convert_path_to_child_path(*i);
-      Gtk::ListStore::iterator it = list_store-&gt;get_iter(path_);
-
-      if (selection_data.get_target() == &quot;application/x-windstille-decal&quot;)
-        {
-          const std::string&amp; str = (*it)[Columns::instance().pathname];
-          selection_data.set(8, reinterpret_cast&lt;const guint8*&gt;(str.c_str()), str.length());
-        }
-      else
-        {
-          const std::string&amp; str = (*it)[Columns::instance().url];
-          selection_data.set(8, reinterpret_cast&lt;const guint8*&gt;(str.c_str()), str.length());
-        }
+      const std::string&amp; str = (*it)[Columns::instance().pathname];
+      selection_data.set(8, reinterpret_cast&lt;const guint8*&gt;(str.c_str()), str.length());
     }
+    else
+    {
+      const std::string&amp; str = (*it)[Columns::instance().url];
+      selection_data.set(8, reinterpret_cast&lt;const guint8*&gt;(str.c_str()), str.length());
+    }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/property_dialog.cpp
===================================================================
--- trunk/windstille/src/editor/property_dialog.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/property_dialog.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -23,17 +23,17 @@
 #if 0
   std::vector&lt;std::string&gt; props = properties.get_properties();
   for(std::vector&lt;std::string&gt;::iterator i = props.begin(); i != props.end(); ++i)
+  {
+    Property&amp; prop = properties.get_property(*i);
+    if (prop.get_type() == &quot;int&quot;)
     {
-      Property&amp; prop = properties.get_property(*i);
-      if (prop.get_type() == &quot;int&quot;)
-        {
-          new Gtk::Label(*i);
-          new Gtk::TextEntry();
-        }
-      else if (prop.get_type() == &quot;float&quot;)
-        {
-        }
+      new Gtk::Label(*i);
+      new Gtk::TextEntry();
     }
+    else if (prop.get_type() == &quot;float&quot;)
+    {
+    }
+  }
 #endif 
 }
 

Modified: trunk/windstille/src/editor/scroll_tool.cpp
===================================================================
--- trunk/windstille/src/editor/scroll_tool.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/scroll_tool.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -40,23 +40,23 @@
 ScrollTool::mouse_move(GdkEventMotion* event, WindstilleWidget&amp; wst)
 {
   if (mode == SCROLLING)
-    {
-      Vector2f offset = orig_click - orig_state.screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
-      wst.get_state().set_pos(orig_state.get_pos() + offset);
-      wst.queue_draw();
-    }
+  {
+    Vector2f offset = orig_click - orig_state.screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
+    wst.get_state().set_pos(orig_state.get_pos() + offset);
+    wst.queue_draw();
+  }
 }
 
 void
 ScrollTool::mouse_up(GdkEventButton* event, WindstilleWidget&amp; wst)
 {
   if (mode == SCROLLING)
-    {
-      Vector2f offset = orig_click - orig_state.screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
-      wst.get_state().set_pos(orig_state.get_pos() + offset);
-      mode = NO_MODE;
-      wst.queue_draw();
-    }
+  {
+    Vector2f offset = orig_click - orig_state.screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
+    wst.get_state().set_pos(orig_state.get_pos() + offset);
+    mode = NO_MODE;
+    wst.queue_draw();
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/sector_model.cpp
===================================================================
--- trunk/windstille/src/editor/sector_model.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/sector_model.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -87,7 +87,7 @@
 void
 SectorModel::add_layer(LayerHandle layer, const Gtk::TreeModel::Path&amp; path)
 {
- Gtk::ListStore::iterator it;
+  Gtk::ListStore::iterator it;
 
   if (path.empty())
     it = layer_tree-&gt;append();
@@ -124,13 +124,13 @@
 SectorModel::delete_layer(const Gtk::TreeModel::Path&amp; path)
 {
   if (path.empty())
-    {
-      EditorWindow::current()-&gt;print(&quot;SectorModel::delete_layer(): invalid empty path&quot;);
-    }
+  {
+    EditorWindow::current()-&gt;print(&quot;SectorModel::delete_layer(): invalid empty path&quot;);
+  }
   else
-    {
-      layer_tree-&gt;erase(layer_tree-&gt;get_iter(path));
-    }
+  {
+    layer_tree-&gt;erase(layer_tree-&gt;get_iter(path));
+  }
 }
 
 void
@@ -149,15 +149,15 @@
 SectorModel::add(const ObjectModelHandle&amp; object, const Gtk::TreeModel::Path&amp; path)
 {
   if (path.empty())
-    {
-      EditorWindow::current()-&gt;print(&quot;SectorModel::add(): invalid empty path&quot;);
-    }
+  {
+    EditorWindow::current()-&gt;print(&quot;SectorModel::add(): invalid empty path&quot;);
+  }
   else
-    { 
-      Gtk::ListStore::iterator it = layer_tree-&gt;get_iter(path);
-      ((LayerHandle)(*it)[LayerManagerColumns::instance().layer])-&gt;add(object);
-      rebuild_scene_graph();
-    }
+  { 
+    Gtk::ListStore::iterator it = layer_tree-&gt;get_iter(path);
+    ((LayerHandle)(*it)[LayerManagerColumns::instance().layer])-&gt;add(object);
+    rebuild_scene_graph();
+  }
 }
 
 void
@@ -166,9 +166,9 @@
   const Layers&amp; layers = get_layers();
  
   for(Layers::const_reverse_iterator i = layers.rbegin(); i != layers.rend(); ++i)
-    {
-      (*i)-&gt;remove(object);
-    }
+  {
+    (*i)-&gt;remove(object);
+  }
   rebuild_scene_graph();
 }
 
@@ -200,21 +200,21 @@
 SectorModel::get_layer(const Gtk::TreeModel::Path&amp; path) const
 {
   if (!path.empty())
+  {
+    Gtk::TreeModel::iterator it = layer_tree-&gt;get_iter(path);
+    if (it)
     {
-      Gtk::TreeModel::iterator it = layer_tree-&gt;get_iter(path);
-      if (it)
-        {
-          return (*it)[LayerManagerColumns::instance().layer];
-        }
-      else
-        {
-          return LayerHandle();
-        }
+      return (*it)[LayerManagerColumns::instance().layer];
     }
-  else
+    else
     {
       return LayerHandle();
     }
+  }
+  else
+  {
+    return LayerHandle();
+  }
 }
 
 LayerHandle
@@ -223,12 +223,12 @@
   const Layers&amp; layers = get_layers();
  
   for(Layers::const_reverse_iterator i = layers.rbegin(); i != layers.rend(); ++i)
+  {
+    if ((*i)-&gt;has_object(object))
     {
-      if ((*i)-&gt;has_object(object))
-        {
-          return *i;
-        }
-    }  
+      return *i;
+    }
+  }  
   
   return LayerHandle();
 }
@@ -240,10 +240,10 @@
   const Layers&amp; layers = get_layers();
  
   for(Layers::const_iterator i = layers.begin(); i != layers.end(); ++i)
-    {
-      if ((*i)-&gt;is_visible())
-        (*i)-&gt;draw(sc, layermask);
-    }
+  {
+    if ((*i)-&gt;is_visible())
+      (*i)-&gt;draw(sc, layermask);
+  }
 }
 
 void
@@ -252,10 +252,10 @@
   const Layers&amp; layers = get_layers();
 
   for(Layers::const_iterator i = layers.begin(); i != layers.end(); ++i)
-    {
-      if ((*i)-&gt;is_visible())
-        (*i)-&gt;update(delta);
-    }
+  {
+    if ((*i)-&gt;is_visible())
+      (*i)-&gt;update(delta);
+  }
 }
 
 ObjectModelHandle
@@ -311,10 +311,10 @@
 {
   const Layers&amp; layers = get_layers();
   for(Layers::const_reverse_iterator i = layers.rbegin(); i != layers.rend(); ++i)
-    {
-      if ((*i)-&gt;has_object(object))
-        return *i;
-    }
+  {
+    if ((*i)-&gt;has_object(object))
+      return *i;
+  }
   return LayerHandle();
 }
 
@@ -349,12 +349,12 @@
 
   SnapData snap_data;
   for(Layers::const_iterator i = layers.begin(); i != layers.end(); ++i)
+  {
+    if ((*i)-&gt;is_visible())
     {
-      if ((*i)-&gt;is_visible())
-        {
-          snap_data.merge((*i)-&gt;snap_object(rect, ignore_objects));
-        }
+      snap_data.merge((*i)-&gt;snap_object(rect, ignore_objects));
     }
+  }
   return snap_data;
 }
 
@@ -492,20 +492,20 @@
 
   writer.start_section(&quot;layers&quot;);
   for(Gtk::ListStore::Children::iterator i = layer_tree-&gt;children().begin(); i != layer_tree-&gt;children().end(); ++i)
-    {
-      const Gtk::TreeRow&amp; row = *i;
+  {
+    const Gtk::TreeRow&amp; row = *i;
 
-      writer.start_section(&quot;layer&quot;);
-      writer.write(&quot;name&quot;,    (Glib::ustring)(row[LayerManagerColumns::instance().name]));
-      writer.write(&quot;visible&quot;, (bool)row[LayerManagerColumns::instance().visible]);
-      writer.write(&quot;locked&quot;,  (bool)row[LayerManagerColumns::instance().locked]);
+    writer.start_section(&quot;layer&quot;);
+    writer.write(&quot;name&quot;,    (Glib::ustring)(row[LayerManagerColumns::instance().name]));
+    writer.write(&quot;visible&quot;, (bool)row[LayerManagerColumns::instance().visible]);
+    writer.write(&quot;locked&quot;,  (bool)row[LayerManagerColumns::instance().locked]);
 
-      writer.start_section(&quot;objects&quot;);
-      ((LayerHandle)row[LayerManagerColumns::instance().layer])-&gt;write(writer);
-      writer.end_section();
+    writer.start_section(&quot;objects&quot;);
+    ((LayerHandle)row[LayerManagerColumns::instance().layer])-&gt;write(writer);
+    writer.end_section();
 
-      writer.end_section();
-    }
+    writer.end_section();
+  }
   writer.end_section();
 
   writer.end_section();
@@ -582,9 +582,9 @@
 SectorModel::queue_draw()
 {
   if (WindstilleWidget* wst = EditorWindow::current()-&gt;get_windstille_widget())
-    {
-      wst-&gt;queue_draw();
-    }
+  {
+    wst-&gt;queue_draw();
+  }
 }
 
 void
@@ -593,14 +593,14 @@
   //std::cout &lt;&lt; &quot;LayerManager:on_row_changed&quot; &lt;&lt; std::endl;
 
   if (iter)
+  {
+    // Update the Layer object with data from the tree
+    LayerHandle layer = (*iter)[LayerManagerColumns::instance().layer];
+    if (layer)
     {
-      // Update the Layer object with data from the tree
-      LayerHandle layer = (*iter)[LayerManagerColumns::instance().layer];
-      if (layer)
-        {
-          layer-&gt;sync(*iter);
-        }
+      layer-&gt;sync(*iter);
     }
+  }
   rebuild_scene_graph();
 }
 
@@ -646,11 +646,11 @@
         if (edge)
         {
           /*
-          if (edge.get_lhs().get() == &amp;node ||
-              edge.get_rhs().get() == &amp;node)
-          {
+	    if (edge.get_lhs().get() == &amp;node ||
+	    edge.get_rhs().get() == &amp;node)
+	    {
 
-          }
+	    }
           */
         }
       }

Modified: trunk/windstille/src/editor/select_mask.hpp
===================================================================
--- trunk/windstille/src/editor/select_mask.hpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/select_mask.hpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -41,13 +41,13 @@
   void set(unsigned int layer, bool enable)
   {
     if (enable)
-      {
-        mask = mask | (1u&lt;&lt;layer);
-      }
+    {
+      mask = mask | (1u&lt;&lt;layer);
+    }
     else
-      {
-        mask = mask &amp; (~(1u&lt;&lt;layer));
-      }
+    {
+      mask = mask &amp; (~(1u&lt;&lt;layer));
+    }
   }
 
   int size() const 

Modified: trunk/windstille/src/editor/select_tool.cpp
===================================================================
--- trunk/windstille/src/editor/select_tool.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/select_tool.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -28,12 +28,12 @@
 static const int MOVE_THRESHOLD = 16;
 
 SelectTool::SelectTool()
- : click_pos(),
-   rect(),
-   selection(),
-   ctrl_point(),
-   start_time(),
-   mode(NO_MODE)    
+  : click_pos(),
+    rect(),
+    selection(),
+    ctrl_point(),
+    start_time(),
+    mode(NO_MODE)    
 {
 }
 
@@ -45,55 +45,55 @@
 
   ctrl_point = wst.get_document().get_control_point(click_pos);
   if (ctrl_point)
+  {
+    mode = CONTROL_DRAG_MODE;
+    wst.get_document().clear_control_points();
+    ctrl_point-&gt;on_move_start(event);
+  }
+  else
+  {  
+    ObjectModelHandle object = wst.get_document().get_sector_model().get_object_at(click_pos, wst.get_select_mask());
+    if (object.get())
     {
-      mode = CONTROL_DRAG_MODE;
-      wst.get_document().clear_control_points();
-      ctrl_point-&gt;on_move_start(event);
-    }
-  else
-    {  
-      ObjectModelHandle object = wst.get_document().get_sector_model().get_object_at(click_pos, wst.get_select_mask());
-      if (object.get())
-        {
-          if (wst.get_document().get_selection()-&gt;has_object(object))
-            {
-              selection = wst.get_document().get_selection();
-              if (event-&gt;state &amp; GDK_SHIFT_MASK)
-                {
-                  selection-&gt;remove(object);
-                }
-              else
-                {
-                  selection = wst.get_document().get_selection();
-                }
-            }
-          else
-            {
-              if (event-&gt;state &amp; GDK_SHIFT_MASK)
-                {
-                  selection = wst.get_document().get_selection();
-                  selection-&gt;add(object);
-                }
-              else
-                {
-                  selection = Selection::create();
-                  selection-&gt;add(object);
-                  wst.get_document().set_selection(selection);
-                }
-            }
-      
-          mode = OBJECT_DRAG_MODE;
-        }
+      if (wst.get_document().get_selection()-&gt;has_object(object))
+      {
+	selection = wst.get_document().get_selection();
+	if (event-&gt;state &amp; GDK_SHIFT_MASK)
+	{
+	  selection-&gt;remove(object);
+	}
+	else
+	{
+	  selection = wst.get_document().get_selection();
+	}
+      }
       else
-        {
-          rect.left   = click_pos.x;
-          rect.top    = click_pos.y;
-          rect.right  = click_pos.x;
-          rect.bottom = click_pos.y;
+      {
+	if (event-&gt;state &amp; GDK_SHIFT_MASK)
+	{
+	  selection = wst.get_document().get_selection();
+	  selection-&gt;add(object);
+	}
+	else
+	{
+	  selection = Selection::create();
+	  selection-&gt;add(object);
+	  wst.get_document().set_selection(selection);
+	}
+      }
       
-          mode = SELECT_MODE;
-        }
+      mode = OBJECT_DRAG_MODE;
     }
+    else
+    {
+      rect.left   = click_pos.x;
+      rect.top    = click_pos.y;
+      rect.right  = click_pos.x;
+      rect.bottom = click_pos.y;
+      
+      mode = SELECT_MODE;
+    }
+  }
 
   wst.queue_draw();
 }
@@ -105,22 +105,22 @@
   std::set&lt;ObjectModelHandle&gt; ignore_objects(selection-&gt;begin(), selection-&gt;end());
 
   if (!wst.get_draw_only_active_layer())
-    {
-      // ignore all objects not on the current active layer
-      for(Layer::iterator i = wst.get_current_layer()-&gt;begin(); i != wst.get_current_layer()-&gt;end(); ++i)
-        { // FIXME: Should iterate over all objects, not just objects in the current layer
-          if (!wst.get_select_mask().match((*i)-&gt;get_select_mask()))
-            ignore_objects.insert(*i);
-        }
+  {
+    // ignore all objects not on the current active layer
+    for(Layer::iterator i = wst.get_current_layer()-&gt;begin(); i != wst.get_current_layer()-&gt;end(); ++i)
+    { // FIXME: Should iterate over all objects, not just objects in the current layer
+      if (!wst.get_select_mask().match((*i)-&gt;get_select_mask()))
+	ignore_objects.insert(*i);
     }
+  }
 
   SnapData best_snap;
 
   for(Selection::iterator i = selection-&gt;begin(); i != selection-&gt;end(); ++i)
-    {
-      SnapData snap = wst.get_document().get_sector_model().snap_object((*i)-&gt;get_bounding_box(), ignore_objects);
-      best_snap.merge(snap);
-    }
+  {
+    SnapData snap = wst.get_document().get_sector_model().snap_object((*i)-&gt;get_bounding_box(), ignore_objects);
+    best_snap.merge(snap);
+  }
               
   return best_snap.offset;
 }
@@ -131,39 +131,39 @@
   Vector2f pos = wst.get_state().screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
 
   if (mode == CONTROL_DRAG_MODE)
-    {
-      ctrl_point-&gt;on_move_update(event, pos - click_pos);
-      wst.queue_draw();
-    }
+  {
+    ctrl_point-&gt;on_move_update(event, pos - click_pos);
+    wst.queue_draw();
+  }
   else if (mode == OBJECT_DRAG_MODE)
+  {
+    Vector2f offset = pos - click_pos;
+          
+    if ((event-&gt;time - start_time) &gt; MOVE_TIMEOUT ||
+	offset.length() &gt; MOVE_THRESHOLD)
     {
-      Vector2f offset = pos - click_pos;
-          
-      if ((event-&gt;time - start_time) &gt; MOVE_TIMEOUT ||
-          offset.length() &gt; MOVE_THRESHOLD)
-        {
-          if (!selection-&gt;is_moving())
-            selection-&gt;on_move_start();
+      if (!selection-&gt;is_moving())
+	selection-&gt;on_move_start();
 
-          selection-&gt;on_move_update(offset);
+      selection-&gt;on_move_update(offset);
       
-          if (event-&gt;state &amp; GDK_CONTROL_MASK)
-            {
-              selection-&gt;on_move_update(offset + process_snap(wst));
-            }
+      if (event-&gt;state &amp; GDK_CONTROL_MASK)
+      {
+	selection-&gt;on_move_update(offset + process_snap(wst));
+      }
 
-          wst.queue_draw();
-        }
+      wst.queue_draw();
     }
+  }
   else if (mode == SELECT_MODE)
-    {
-      rect.left   = click_pos.x;
-      rect.top    = click_pos.y;
-      rect.right  = pos.x;
-      rect.bottom = pos.y;
+  {
+    rect.left   = click_pos.x;
+    rect.top    = click_pos.y;
+    rect.right  = pos.x;
+    rect.bottom = pos.y;
 
-      wst.queue_draw();
-    }
+    wst.queue_draw();
+  }
 }
 
 void
@@ -173,46 +173,46 @@
 
   // Select objects
   if (mode == CONTROL_DRAG_MODE)
-    {
-      ctrl_point-&gt;on_move_end(event, pos - click_pos);
-      wst.get_document().create_control_points();
-      wst.queue_draw();
-    }
+  {
+    ctrl_point-&gt;on_move_end(event, pos - click_pos);
+    wst.get_document().create_control_points();
+    wst.queue_draw();
+  }
   else if (mode == OBJECT_DRAG_MODE)
+  {
+    Vector2f offset = pos - click_pos;
+
+    if (event-&gt;time - start_time &gt; MOVE_TIMEOUT ||
+	offset.length() &gt; MOVE_THRESHOLD)
     {
-      Vector2f offset = pos - click_pos;
-
-      if (event-&gt;time - start_time &gt; MOVE_TIMEOUT ||
-          offset.length() &gt; MOVE_THRESHOLD)
-        {
-          selection-&gt;on_move_update(offset);
+      selection-&gt;on_move_update(offset);
       
-          if (event-&gt;state &amp; GDK_CONTROL_MASK)
-            {
-              selection-&gt;on_move_end(wst, offset + process_snap(wst));
-            }
-          else
-            {
-              selection-&gt;on_move_end(wst, offset);
-            }
-          wst.queue_draw();
-        }
+      if (event-&gt;state &amp; GDK_CONTROL_MASK)
+      {
+	selection-&gt;on_move_end(wst, offset + process_snap(wst));
+      }
+      else
+      {
+	selection-&gt;on_move_end(wst, offset);
+      }
+      wst.queue_draw();
     }
+  }
   else if (mode == SELECT_MODE)
+  {
+    mode = NO_MODE;
+    rect.normalize();
+    if (event-&gt;state &amp; GDK_SHIFT_MASK)
     {
-      mode = NO_MODE;
-      rect.normalize();
-      if (event-&gt;state &amp; GDK_SHIFT_MASK)
-        {
-          SelectionHandle new_selection = wst.get_document().get_sector_model().get_selection(rect, wst.get_select_mask());
-          wst.get_document().get_selection()-&gt;add(new_selection-&gt;begin(), new_selection-&gt;end());
-        }
-      else
-        {
-          wst.get_document().set_selection(wst.get_document().get_sector_model().get_selection(rect, wst.get_select_mask()));
-        }
-      wst.queue_draw();
+      SelectionHandle new_selection = wst.get_document().get_sector_model().get_selection(rect, wst.get_select_mask());
+      wst.get_document().get_selection()-&gt;add(new_selection-&gt;begin(), new_selection-&gt;end());
     }
+    else
+    {
+      wst.get_document().set_selection(wst.get_document().get_sector_model().get_selection(rect, wst.get_select_mask()));
+    }
+    wst.queue_draw();
+  }
 
   mode = NO_MODE;
 }
@@ -228,10 +228,10 @@
 SelectTool::draw(SceneContext&amp; sc)
 {
   if (mode == SELECT_MODE)
-    {
-      sc.control().fill_rect(rect, Color(0.5f, 0.5f, 1.0f, 0.25));
-      sc.control().draw_rect(rect, Color(0.5f, 0.5f, 1.0f)); 
-    }
+  {
+    sc.control().fill_rect(rect, Color(0.5f, 0.5f, 1.0f, 0.25));
+    sc.control().draw_rect(rect, Color(0.5f, 0.5f, 1.0f)); 
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/selection.cpp
===================================================================
--- trunk/windstille/src/editor/selection.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/selection.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -48,14 +48,14 @@
 {
   Objects::iterator it = std::find(objects.begin(), objects.end(), object);
   if (it != objects.end())
-    {
-      objects.erase(it);
-      signal_changed();
-    }
+  {
+    objects.erase(it);
+    signal_changed();
+  }
   else
-    {
-      EditorWindow::current()-&gt;print(&quot;Selection:remove(): object not in selection&quot;);
-    }
+  {
+    EditorWindow::current()-&gt;print(&quot;Selection:remove(): object not in selection&quot;);
+  }
 }
 
 bool
@@ -83,12 +83,12 @@
 {
   ObjectModelHandle parent = object-&gt;get_parent();
   while (parent)
-    {
-      if (has_object(parent))
-        return true;
+  {
+    if (has_object(parent))
+      return true;
 
-      parent = parent-&gt;get_parent();
-    }
+    parent = parent-&gt;get_parent();
+  }
 
   return false;
 }
@@ -99,23 +99,23 @@
   moving = true;
 
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
+  {
+    if (contains_parent(*i))
     {
-      if (contains_parent(*i))
-        {
-          non_moveable_objects.insert(*i);
-        }
+      non_moveable_objects.insert(*i);
     }
+  }
 
   object_orig_poss.clear();
 
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
+  {
+    if (non_moveable_objects.find(*i) == non_moveable_objects.end())
     {
-      if (non_moveable_objects.find(*i) == non_moveable_objects.end())
-        {
-          //(*i)-&gt;on_move_start();
-          object_orig_poss.push_back((*i)-&gt;get_rel_pos());
-        }
+      //(*i)-&gt;on_move_start();
+      object_orig_poss.push_back((*i)-&gt;get_rel_pos());
     }
+  }
 
   signal_changed();
 }
@@ -124,12 +124,12 @@
 Selection::on_move_update(const Vector2f&amp; offset)
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
+  {
+    if (non_moveable_objects.find(*i) == non_moveable_objects.end())
     {
-      if (non_moveable_objects.find(*i) == non_moveable_objects.end())
-        {
-          (*i)-&gt;set_rel_pos(object_orig_poss[i - objects.begin()] + offset);
-        }
+      (*i)-&gt;set_rel_pos(object_orig_poss[i - objects.begin()] + offset);
     }
+  }
 }
 
 void
@@ -158,30 +158,30 @@
   SelectionHandle selection = Selection::create();
   std::map&lt;ObjectModelHandle, ObjectModelHandle&gt; parent_map;
   for(Objects::const_iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      ObjectModelHandle obj = (*i)-&gt;clone();
-      parent_map[*i] = obj;
-      selection-&gt;add(obj);
-    }
+  {
+    ObjectModelHandle obj = (*i)-&gt;clone();
+    parent_map[*i] = obj;
+    selection-&gt;add(obj);
+  }
 
   // Second pass to set the parents to the cloned objects
   for(Selection::iterator i = selection-&gt;begin(); i != selection-&gt;end(); ++i)
+  {
+    if ((*i)-&gt;get_parent())
     {
-      if ((*i)-&gt;get_parent())
-        {
-          std::map&lt;ObjectModelHandle, ObjectModelHandle&gt;::iterator it = parent_map.find((*i)-&gt;get_parent());
+      std::map&lt;ObjectModelHandle, ObjectModelHandle&gt;::iterator it = parent_map.find((*i)-&gt;get_parent());
           
-          if (it == parent_map.end())
-            {
-              // When the parent wasn't part of the selection, leave
-              // the parent untouched
-            }
-          else
-            {
-              (*i)-&gt;set_parent(it-&gt;second);
-            }
-        }
+      if (it == parent_map.end())
+      {
+	// When the parent wasn't part of the selection, leave
+	// the parent untouched
+      }
+      else
+      {
+	(*i)-&gt;set_parent(it-&gt;second);
+      }
     }
+  }
 
   return selection;
 }
@@ -190,47 +190,47 @@
 Selection::get_bounding_box() const
 {
   if (empty())
-    {
-      return Rectf();
-    }
+  {
+    return Rectf();
+  }
   else
+  {
+    Rectf rect = objects.front()-&gt;get_bounding_box();
+    for(Objects::const_iterator i = objects.begin()+1; i != objects.end(); ++i)
     {
-      Rectf rect = objects.front()-&gt;get_bounding_box();
-      for(Objects::const_iterator i = objects.begin()+1; i != objects.end(); ++i)
-        {
-          rect = rect.grow((*i)-&gt;get_bounding_box());
-        }
-      return rect;
+      rect = rect.grow((*i)-&gt;get_bounding_box());
     }
+    return rect;
+  }
 }
 
 void
 Selection::reset()
 {
   for(Objects::const_iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      (*i)-&gt;reset();
-    }
+  {
+    (*i)-&gt;reset();
+  }
 }
 
 void
 Selection::add_control_points(std::vector&lt;ControlPointHandle&gt;&amp; control_points)
 {
   if (!empty())
+  {
+    if (size() == 1)
     {
-      if (size() == 1)
-        {
-          objects[0]-&gt;add_control_points(control_points);
-        }
-      else
-        {
-          const Rectf&amp; rect = get_bounding_box();
-          control_points.push_back(ControlPoint::create(Vector2f(rect.left, rect.top)));
-          control_points.push_back(ControlPoint::create(Vector2f(rect.right, rect.top)));
-          control_points.push_back(ControlPoint::create(Vector2f(rect.left, rect.bottom)));
-          control_points.push_back(ControlPoint::create(Vector2f(rect.right, rect.bottom)));
-        }
+      objects[0]-&gt;add_control_points(control_points);
     }
+    else
+    {
+      const Rectf&amp; rect = get_bounding_box();
+      control_points.push_back(ControlPoint::create(Vector2f(rect.left, rect.top)));
+      control_points.push_back(ControlPoint::create(Vector2f(rect.right, rect.top)));
+      control_points.push_back(ControlPoint::create(Vector2f(rect.left, rect.bottom)));
+      control_points.push_back(ControlPoint::create(Vector2f(rect.right, rect.bottom)));
+    }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/selection.hpp
===================================================================
--- trunk/windstille/src/editor/selection.hpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/selection.hpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -57,9 +57,9 @@
   template&lt;class Iter&gt;
   void add(Iter begin_, Iter end_) {
     for(Iter i = begin_; i != end_; ++i)
-      {
-        add(*i);
-      }
+    {
+      add(*i);
+    }
     signal_changed();
   }
 

Modified: trunk/windstille/src/editor/snap_data.hpp
===================================================================
--- trunk/windstille/src/editor/snap_data.hpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/snap_data.hpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -36,17 +36,17 @@
   {
     if (((x_set &amp;&amp; rhs.x_set) &amp;&amp; (rhs.offset.x &lt; offset.x)) ||
         (!x_set &amp;&amp; rhs.x_set))
-      {
-        offset.x = rhs.offset.x;
-        x_set = true;
-      }
+    {
+      offset.x = rhs.offset.x;
+      x_set = true;
+    }
 
     if (((y_set &amp;&amp; rhs.y_set) &amp;&amp; (rhs.offset.y &lt; offset.y)) ||
         (!y_set &amp;&amp; rhs.y_set))
-      {
-        offset.y = rhs.offset.y;
-        y_set = true;
-      }
+    {
+      offset.y = rhs.offset.y;
+      y_set = true;
+    }
   }
 };
 

Modified: trunk/windstille/src/editor/undo_manager.cpp
===================================================================
--- trunk/windstille/src/editor/undo_manager.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/undo_manager.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -39,24 +39,24 @@
 UndoManager::undo()
 {
   if (!undo_stack.empty())
-    {
-      CommandHandle cmd = undo_stack.back();
-      undo_stack.pop_back();
-      cmd-&gt;undo();
-      redo_stack.push_back(cmd);
-    }
+  {
+    CommandHandle cmd = undo_stack.back();
+    undo_stack.pop_back();
+    cmd-&gt;undo();
+    redo_stack.push_back(cmd);
+  }
 }
 
 void
 UndoManager::redo()
 {
   if (!redo_stack.empty())
-    {
-      CommandHandle cmd = redo_stack.back();
-      redo_stack.pop_back();
-      cmd-&gt;redo();
-      undo_stack.push_back(cmd);
-    }
+  {
+    CommandHandle cmd = redo_stack.back();
+    redo_stack.pop_back();
+    cmd-&gt;redo();
+    undo_stack.push_back(cmd);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/windstille_widget.cpp
===================================================================
--- trunk/windstille/src/editor/windstille_widget.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/windstille_widget.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -144,41 +144,41 @@
   Glib::RefPtr&lt;Gdk::GL::Window&gt; glwindow = get_gl_window();
 
   if (glwindow-&gt;gl_begin(get_gl_context()))
+  {
+    if (!lib_init)
     {
-      if (!lib_init)
-        {
-          lib_init = true;
-          GLenum err = glewInit();
-          if(err != GLEW_OK) {
-            std::ostringstream msg;
-            msg &lt;&lt; &quot;Display:: Couldn't initialize glew: &quot; &lt;&lt; glewGetString(err);
-            throw std::runtime_error(msg.str());
-          }
+      lib_init = true;
+      GLenum err = glewInit();
+      if(err != GLEW_OK) {
+	std::ostringstream msg;
+	msg &lt;&lt; &quot;Display:: Couldn't initialize glew: &quot; &lt;&lt; glewGetString(err);
+	throw std::runtime_error(msg.str());
+      }
 
-          OpenGLState::init();
-        }
+      OpenGLState::init();
+    }
       
-      if (!sc.get())
-        {
-          sc.reset(new SceneContext());
-          compositor.reset(new Compositor(Size(get_width(), get_height()),
-                                          Size(get_width(), get_height())));
-          sc-&gt;set_render_mask(sc-&gt;get_render_mask() &amp; ~SceneContext::LIGHTMAP);
-        }
+    if (!sc.get())
+    {
+      sc.reset(new SceneContext());
+      compositor.reset(new Compositor(Size(get_width(), get_height()),
+				      Size(get_width(), get_height())));
+      sc-&gt;set_render_mask(sc-&gt;get_render_mask() &amp; ~SceneContext::LIGHTMAP);
+    }
       
-      background_pattern = Texture(Pathname(&quot;editor/background_layer.png&quot;));
-      background_pattern.set_wrap(GL_REPEAT);
+    background_pattern = Texture(Pathname(&quot;editor/background_layer.png&quot;));
+    background_pattern.set_wrap(GL_REPEAT);
 
-      glViewport(0, 0, get_width(), get_height());
-      glMatrixMode(GL_PROJECTION);
-      glLoadIdentity();
-      glOrtho(0.0, get_width(), get_height(), 0.0, 1000.0, -1000.0);
+    glViewport(0, 0, get_width(), get_height());
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    glOrtho(0.0, get_width(), get_height(), 0.0, 1000.0, -1000.0);
 
-      glMatrixMode(GL_MODELVIEW);
-      glLoadIdentity();
+    glMatrixMode(GL_MODELVIEW);
+    glLoadIdentity();
   
-      glwindow-&gt;gl_end();
-    }
+    glwindow-&gt;gl_end();
+  }
 }
 
 bool
@@ -190,29 +190,29 @@
   Glib::RefPtr&lt;Gdk::GL::Window&gt; glwindow = get_gl_window();
 
   if (!glwindow-&gt;gl_begin(get_gl_context()))
+  {
+    return false;
+  }
+  else
+  {
+    if (compositor.get())
     {
-      return false;
+      compositor.reset(new Compositor(Size(ev-&gt;width, ev-&gt;height),
+				      Size(ev-&gt;width, ev-&gt;height)));
     }
-  else
-    {
-      if (compositor.get())
-      {
-        compositor.reset(new Compositor(Size(ev-&gt;width, ev-&gt;height),
-                                        Size(ev-&gt;width, ev-&gt;height)));
-      }
 
-      glViewport(0, 0, get_width(), get_height());
-      glMatrixMode(GL_PROJECTION);
-      glLoadIdentity();
-      glOrtho(0.0, get_width(), get_height(), 0.0, 1000.0, -1000.0);
+    glViewport(0, 0, get_width(), get_height());
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    glOrtho(0.0, get_width(), get_height(), 0.0, 1000.0, -1000.0);
 
-      glMatrixMode(GL_MODELVIEW);
-      glLoadIdentity();
+    glMatrixMode(GL_MODELVIEW);
+    glLoadIdentity();
   
-      glwindow-&gt;gl_end();
+    glwindow-&gt;gl_end();
 
-      return true;
-    }
+    return true;
+  }
 }
 
 bool
@@ -221,23 +221,23 @@
   Glib::RefPtr&lt;Gdk::GL::Window&gt; glwindow = get_gl_window();
 
   if (!glwindow-&gt;gl_begin(get_gl_context()))
-    {
-      return false;
-    }
+  {
+    return false;
+  }
   else
-    {
-      draw();
+  {
+    draw();
 
-      // Swap buffers.
-      if (glwindow-&gt;is_double_buffered())
-        glwindow-&gt;swap_buffers();
-      else
-        glFlush();
+    // Swap buffers.
+    if (glwindow-&gt;is_double_buffered())
+      glwindow-&gt;swap_buffers();
+    else
+      glFlush();
 
-      glwindow-&gt;gl_end();
+    glwindow-&gt;gl_end();
 
-      return true;
-    }
+    return true;
+  }
 }
 
 void
@@ -252,70 +252,70 @@
 WindstilleWidget::draw()
 {
   if (sc.get())
-    {
-      state.push(*sc);
+  {
+    state.push(*sc);
       
-      sc-&gt;light().fill_screen(m_document-&gt;get_sector_model().get_ambient_color());
+    sc-&gt;light().fill_screen(m_document-&gt;get_sector_model().get_ambient_color());
 
-      if (draw_background_pattern)
-        {
-          sc-&gt;color().fill_pattern(background_pattern, 
-                                   state.get_offset() * state.get_zoom());
-        }
-      else
-        {
-          sc-&gt;color().fill_screen(Color());
-        }
+    if (draw_background_pattern)
+    {
+      sc-&gt;color().fill_pattern(background_pattern, 
+			       state.get_offset() * state.get_zoom());
+    }
+    else
+    {
+      sc-&gt;color().fill_screen(Color());
+    }
 
-      if (draw_only_active_layers)
-        m_document-&gt;get_sector_model().draw(*sc, SelectMask());
-      else
-        m_document-&gt;get_sector_model().draw(*sc, select_mask);
+    if (draw_only_active_layers)
+      m_document-&gt;get_sector_model().draw(*sc, SelectMask());
+    else
+      m_document-&gt;get_sector_model().draw(*sc, select_mask);
 
-      if (!m_document-&gt;get_selection()-&gt;empty())
-        {
-          for(Selection::iterator i = m_document-&gt;get_selection()-&gt;begin(); i != m_document-&gt;get_selection()-&gt;end(); ++i)
-            {
-              (*i)-&gt;draw_select(*sc, i == m_document-&gt;get_selection()-&gt;begin());
-            }
+    if (!m_document-&gt;get_selection()-&gt;empty())
+    {
+      for(Selection::iterator i = m_document-&gt;get_selection()-&gt;begin(); i != m_document-&gt;get_selection()-&gt;end(); ++i)
+      {
+	(*i)-&gt;draw_select(*sc, i == m_document-&gt;get_selection()-&gt;begin());
+      }
 
-          //sc-&gt;control().draw_rect(selection-&gt;get_bounding_box(), Color(1.0f, 1.0f, 1.0f, 1.0f));
-        }
+      //sc-&gt;control().draw_rect(selection-&gt;get_bounding_box(), Color(1.0f, 1.0f, 1.0f, 1.0f));
+    }
 
-      for(std::vector&lt;ControlPointHandle&gt;::const_iterator i = m_document-&gt;get_control_points().begin();
-          i != m_document-&gt;get_control_points().end(); ++i)
-        {
-          (*i)-&gt;draw(*sc);
-        }
+    for(std::vector&lt;ControlPointHandle&gt;::const_iterator i = m_document-&gt;get_control_points().begin();
+	i != m_document-&gt;get_control_points().end(); ++i)
+    {
+      (*i)-&gt;draw(*sc);
+    }
 
-      if (EditorWindow::current()-&gt;get_current_tool())
-        {
-          EditorWindow::current()-&gt;get_current_tool()-&gt;draw(*sc);
-        }
+    if (EditorWindow::current()-&gt;get_current_tool())
+    {
+      EditorWindow::current()-&gt;get_current_tool()-&gt;draw(*sc);
+    }
 
-      compositor-&gt;render(*sc, &amp;m_document-&gt;get_sector_model().get_scene_graph(), state);
+    compositor-&gt;render(*sc, &amp;m_document-&gt;get_sector_model().get_scene_graph(), state);
 
-      state.pop(*sc);
+    state.pop(*sc);
 
-      if (grid_enabled)
-        {
-          Display::draw_grid(state.get_offset() * state.get_zoom(),
-                             Sizef(128.0f * state.get_zoom(), 128.0f * state.get_zoom()), Color(1,1,1,0.5f));
-        }
+    if (grid_enabled)
+    {
+      Display::draw_grid(state.get_offset() * state.get_zoom(),
+			 Sizef(128.0f * state.get_zoom(), 128.0f * state.get_zoom()), Color(1,1,1,0.5f));
     }
+  }
 }
 
 bool
 WindstilleWidget::scroll(GdkEventScroll* ev)
 {
   if (ev-&gt;direction == GDK_SCROLL_UP)
-    {
-      //viewer-&gt;get_state().zoom(1.1f, Vector2i(event-&gt;x, event-&gt;y));
-    }
+  {
+    //viewer-&gt;get_state().zoom(1.1f, Vector2i(event-&gt;x, event-&gt;y));
+  }
   else if (ev-&gt;direction == GDK_SCROLL_DOWN)
-    {
-      //viewer-&gt;get_state().zoom(1.0f/1.1f, Vector2i(event-&gt;x, event-&gt;y));
-    }
+  {
+    //viewer-&gt;get_state().zoom(1.0f/1.1f, Vector2i(event-&gt;x, event-&gt;y));
+  }
   return false;
 }
 
@@ -327,24 +327,24 @@
   //std::cout &lt;&lt; &quot;Button Press: &quot; &lt;&lt; ev-&gt;x &lt;&lt; &quot;, &quot; &lt;&lt; ev-&gt;y &lt;&lt; &quot; - &quot; &lt;&lt; ev-&gt;button &lt;&lt; std::endl;
 
   if (ev-&gt;button == 1)
-    { // Tool
-      EditorWindow::current()-&gt;get_current_tool()-&gt;mouse_down(ev, *this);
-      return true;
-    }
+  { // Tool
+    EditorWindow::current()-&gt;get_current_tool()-&gt;mouse_down(ev, *this);
+    return true;
+  }
   else if (ev-&gt;button == 2)
-    { // Scroll
-      scroll_tool-&gt;mouse_down(ev, *this);
-      return true;
-    }
+  { // Scroll
+    scroll_tool-&gt;mouse_down(ev, *this);
+    return true;
+  }
   else if (ev-&gt;button == 3)
-    { // Context Menu
-      EditorWindow::current()-&gt;get_current_tool()-&gt;mouse_right_down(ev, *this);
-      return true;
-    }
+  { // Context Menu
+    EditorWindow::current()-&gt;get_current_tool()-&gt;mouse_right_down(ev, *this);
+    return true;
+  }
   else
-    {
-      return false;
-    }
+  {
+    return false;
+  }
 }
 
 bool
@@ -364,15 +364,15 @@
   //std::cout &lt;&lt; &quot;Button Release: &quot; &lt;&lt; ev-&gt;x &lt;&lt; &quot;, &quot; &lt;&lt; ev-&gt;y &lt;&lt; &quot; - &quot; &lt;&lt; ev-&gt;button &lt;&lt; std::endl;
   //viewer-&gt;on_mouse_button_up(Vector2i(ev-&gt;x, ev-&gt;y), ev-&gt;button);
   if (ev-&gt;button == 1)
-    {
-      EditorWindow::current()-&gt;get_current_tool()-&gt;mouse_up(ev, *this);
-      queue_draw();
-    }
+  {
+    EditorWindow::current()-&gt;get_current_tool()-&gt;mouse_up(ev, *this);
+    queue_draw();
+  }
   else if (ev-&gt;button == 2)
-    {
-      scroll_tool-&gt;mouse_up(ev, *this);
-      queue_draw();
-    }
+  {
+    scroll_tool-&gt;mouse_up(ev, *this);
+    queue_draw();
+  }
 
   return false;
 }
@@ -383,57 +383,57 @@
   //std::cout &lt;&lt; ev-&gt;keyval &lt;&lt; &quot; keypress &quot; &lt;&lt; state.get_pos() &lt;&lt; std::endl;
 
   switch(ev-&gt;keyval)
-    {
-      case GDK_1:
-        map_type = DecalObjectModel::COLORMAP;
-        EditorWindow::current()-&gt;print(&quot;COLORMAP&quot;);
-        break;
+  {
+    case GDK_1:
+      map_type = DecalObjectModel::COLORMAP;
+      EditorWindow::current()-&gt;print(&quot;COLORMAP&quot;);
+      break;
 
-      case GDK_2:
-        map_type = DecalObjectModel::LIGHTMAP;
-        EditorWindow::current()-&gt;print(&quot;LIGHTMAP&quot;);
-        break;
+    case GDK_2:
+      map_type = DecalObjectModel::LIGHTMAP;
+      EditorWindow::current()-&gt;print(&quot;LIGHTMAP&quot;);
+      break;
 
-      case GDK_3:
-        map_type = DecalObjectModel::HIGHLIGHTMAP;
-        EditorWindow::current()-&gt;print(&quot;HIGHLIGHT&quot;);
-        break;
+    case GDK_3:
+      map_type = DecalObjectModel::HIGHLIGHTMAP;
+      EditorWindow::current()-&gt;print(&quot;HIGHLIGHT&quot;);
+      break;
 
-      case GDK_a:
-        EditorWindow::current()-&gt;on_select_all();
-        break;
+    case GDK_a:
+      EditorWindow::current()-&gt;on_select_all();
+      break;
 
-      case GDK_d:
-        m_document-&gt;selection_duplicate();
-        break;
+    case GDK_d:
+      m_document-&gt;selection_duplicate();
+      break;
 
-      case GDK_s:
-        SurfaceManager::current()-&gt;save_all_as_png();
-        break;
+    case GDK_s:
+      SurfaceManager::current()-&gt;save_all_as_png();
+      break;
 
-      case GDK_Delete:
-        m_document-&gt;selection_delete();
-        break;
+    case GDK_Delete:
+      m_document-&gt;selection_delete();
+      break;
 
-      case GDK_Left:
-        state.set_pos(state.get_pos() + Vector2f(-100.0f, 0.0f));
-        break;
+    case GDK_Left:
+      state.set_pos(state.get_pos() + Vector2f(-100.0f, 0.0f));
+      break;
 
-      case GDK_Right:
-        state.set_pos(state.get_pos() + Vector2f(100.0f, 0.0f));
-        queue_draw();
-        break;
+    case GDK_Right:
+      state.set_pos(state.get_pos() + Vector2f(100.0f, 0.0f));
+      queue_draw();
+      break;
 
-      case GDK_Up:
-        state.set_pos(state.get_pos() + Vector2f(0.0f, -100.0f));
-        queue_draw();
-        break;
+    case GDK_Up:
+      state.set_pos(state.get_pos() + Vector2f(0.0f, -100.0f));
+      queue_draw();
+      break;
 
-      case GDK_Down:
-        state.set_pos(state.get_pos() + Vector2f(0.0f, 100.0f));
-        queue_draw();
-        break;
-    }
+    case GDK_Down:
+      state.set_pos(state.get_pos() + Vector2f(0.0f, 100.0f));
+      queue_draw();
+      break;
+  }
 
   return true;
 }
@@ -478,13 +478,13 @@
   EditorWindow::current()-&gt;get_layer_manager().get_treeview().get_cursor(path_, focus_column);
 
   if (!path_.gobj())
-    {
-      std::cout &lt;&lt; &quot;WindstilleWidget::on_drag_data_received(): Error: Couldn't get path&quot; &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;WindstilleWidget::on_drag_data_received(): Error: Couldn't get path&quot; &lt;&lt; std::endl;
+  }
   else
-    {
-      get_document().object_add(m_document-&gt;get_sector_model().get_layer(path_), object);
-    }
+  {
+    get_document().object_add(m_document-&gt;get_sector_model().get_layer(path_), object);
+  }
 }
 
 void
@@ -524,14 +524,14 @@
   EditorWindow::current()-&gt;get_layer_manager().get_treeview().get_cursor(path_, focus_column);
 
   if (!path_.gobj())
-    {
-      std::cout &lt;&lt; &quot;WindstilleWidget::get_current_layer(): Error: Couldn't get path&quot; &lt;&lt; std::endl;
-      return LayerHandle();
-    }
+  {
+    std::cout &lt;&lt; &quot;WindstilleWidget::get_current_layer(): Error: Couldn't get path&quot; &lt;&lt; std::endl;
+    return LayerHandle();
+  }
   else
-    {
-      return m_document-&gt;get_sector_model().get_layer(path_);  
-    }
+  {
+    return m_document-&gt;get_sector_model().get_layer(path_);  
+  }
 }
 
 Gtk::TreeModel::Path
@@ -566,10 +566,10 @@
   Glib::RefPtr&lt;Gdk::GL::Window&gt; glwindow = get_gl_window();
 
   if (glwindow-&gt;gl_begin(get_gl_context()))
-    {
-      Display::save_screenshot(Pathname(filename_, Pathname::kSysPath));
-      glwindow-&gt;gl_end();
-    }
+  {
+    Display::save_screenshot(Pathname(filename_, Pathname::kSysPath));
+    glwindow-&gt;gl_end();
+  }
 }
 
 void

Modified: trunk/windstille/src/editor/zoom_tool.cpp
===================================================================
--- trunk/windstille/src/editor/zoom_tool.cpp	2009-09-10 14:43:49 UTC (rev 3217)
+++ trunk/windstille/src/editor/zoom_tool.cpp	2009-09-10 14:48:10 UTC (rev 3218)
@@ -33,38 +33,38 @@
 ZoomTool::mouse_down (GdkEventButton* event, WindstilleWidget&amp; wst)
 {
   if (mode == NO_MODE)
-    {
-      mouse_pos = click_pos = wst.get_state().screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
+  {
+    mouse_pos = click_pos = wst.get_state().screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
 
-      mode = RECT_MODE;
+    mode = RECT_MODE;
 
-      wst.queue_draw();
-    }
+    wst.queue_draw();
+  }
 }
 
 void
 ZoomTool::mouse_move(GdkEventMotion* event, WindstilleWidget&amp; wst)
 {
   if (mode == RECT_MODE)
-    {
-      mouse_pos = wst.get_state().screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
-      wst.queue_draw();
-    }
+  {
+    mouse_pos = wst.get_state().screen_to_world(Vector2f(static_cast&lt;float&gt;(event-&gt;x), static_cast&lt;float&gt;(event-&gt;y)));
+    wst.queue_draw();
+  }
 }
 
 void
 ZoomTool::mouse_up(GdkEventButton* /*event*/, WindstilleWidget&amp; wst)
 {
   if (mode == RECT_MODE)
-    {
-      Rectf rect(click_pos, mouse_pos);
-      rect.normalize();
-      wst.get_state().zoom_to(rect);
+  {
+    Rectf rect(click_pos, mouse_pos);
+    rect.normalize();
+    wst.get_state().zoom_to(rect);
 
-      mode = NO_MODE;
+    mode = NO_MODE;
 
-      wst.queue_draw();
-    }
+    wst.queue_draw();
+  }
 }
 
 void
@@ -77,13 +77,13 @@
 ZoomTool::draw(SceneContext&amp; sc)
 {
   if (mode == RECT_MODE)
-    {
-      Rectf rect(click_pos, mouse_pos);
-      rect.normalize();
+  {
+    Rectf rect(click_pos, mouse_pos);
+    rect.normalize();
 
-      sc.control().fill_rect(rect, Color(1.0f, 1.0f, 0.0f, 0.25));
-      sc.control().draw_rect(rect, Color(1.0f, 1.0f, 0.0f)); 
-    }
+    sc.control().fill_rect(rect, Color(1.0f, 1.0f, 0.0f, 0.25));
+    sc.control().draw_rect(rect, Color(1.0f, 1.0f, 0.0f)); 
+  }
 }
 
 /* EOF */


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002214.html">[Windstille-commit] r3217 - trunk/windstille/src/editor
</A></li>
	<LI>Next message: <A HREF="002216.html">[Windstille-commit] r3219 - trunk/windstille/src/editor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2215">[ date ]</a>
              <a href="thread.html#2215">[ thread ]</a>
              <a href="subject.html#2215">[ subject ]</a>
              <a href="author.html#2215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
