<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r878 - in trunk: data/images data/levels src src/display src/scripting
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-August/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r878%20-%20in%20trunk%3A%20data/images%20data/levels%20src%20src/display%20src/scripting&In-Reply-To=%3C200508011930.j71JUkEM016042%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000530.html">
   <LINK REL="Next"  HREF="000532.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r878 - in trunk: data/images data/levels src src/display src/scripting</H1>
    <B>Ingo Ruhnke at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r878%20-%20in%20trunk%3A%20data/images%20data/levels%20src%20src/display%20src/scripting&In-Reply-To=%3C200508011930.j71JUkEM016042%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r878 - in trunk: data/images data/levels src src/display src/scripting">grumbel at berlios.de
       </A><BR>
    <I>Mon Aug  1 21:30:46 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000530.html">[Windstille-commit] r877 - in trunk/data: levels scripts/newformat2
</A></li>
        <LI>Next message: <A HREF="000532.html">[Windstille-commit] r879 - trunk/src/sprite3d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#531">[ date ]</a>
              <a href="thread.html#531">[ thread ]</a>
              <a href="subject.html#531">[ subject ]</a>
              <a href="author.html#531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-08-01 21:30:42 +0200 (Mon, 01 Aug 2005)
New Revision: 878

Added:
   trunk/data/images/streetlamp-highlight.png
   trunk/data/images/streetlamp-highlight.sprite
   trunk/data/images/streetlamp-light.png
   trunk/data/images/streetlamp-light.sprite
   trunk/data/images/streetlamp.png
   trunk/data/images/streetlamp.sprite
   trunk/data/images/streetlamp.xcf
Modified:
   trunk/data/levels/industrial.wst
   trunk/src/dialog_manager.cpp
   trunk/src/display/display.cpp
   trunk/src/player.cpp
   trunk/src/scriptable_object.cpp
   trunk/src/scriptable_object.hpp
   trunk/src/scripting/wrapper.cpp
   trunk/src/scripting/wrapper.hpp
   trunk/src/sector.cpp
   trunk/src/sector.hpp
Log:
- added some lamps

Added: trunk/data/images/streetlamp-highlight.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/streetlamp-highlight.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/images/streetlamp-highlight.sprite
===================================================================
--- trunk/data/images/streetlamp-highlight.sprite	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/data/images/streetlamp-highlight.sprite	2005-08-01 19:30:42 UTC (rev 878)
@@ -0,0 +1,7 @@
+(sprite
+  (action
+    (name &quot;default&quot;)
+    (images &quot;streetlamp-highlight.png&quot;)
+    (offset -111 -215)
+  )
+)

Added: trunk/data/images/streetlamp-light.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/streetlamp-light.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/images/streetlamp-light.sprite
===================================================================
--- trunk/data/images/streetlamp-light.sprite	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/data/images/streetlamp-light.sprite	2005-08-01 19:30:42 UTC (rev 878)
@@ -0,0 +1,7 @@
+(sprite
+  (action
+    (name &quot;default&quot;)
+    (images &quot;streetlamp-light.png&quot;)
+    (offset -249 -264)
+  )
+)

Added: trunk/data/images/streetlamp.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/streetlamp.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/images/streetlamp.sprite
===================================================================
--- trunk/data/images/streetlamp.sprite	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/data/images/streetlamp.sprite	2005-08-01 19:30:42 UTC (rev 878)
@@ -0,0 +1,7 @@
+(sprite
+  (action
+    (name &quot;default&quot;)
+    (images &quot;streetlamp.png&quot;)
+    (offset -18 -220)
+  )
+)

Added: trunk/data/images/streetlamp.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/streetlamp.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/levels/industrial.wst
===================================================================
--- trunk/data/levels/industrial.wst	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/data/levels/industrial.wst	2005-08-01 19:30:42 UTC (rev 878)
@@ -3,8 +3,34 @@
   (version 2)
   (name   &quot;&quot;)
   (music  &quot;&quot;)
-  (ambient-color .666 .666 .666)
+  (ambient-color .4 .4 .4)
   (objects
+    (scriptable-object
+      (name &quot;Lamp&quot;)
+      (pos 256 736)
+      (sprite &quot;images/streetlamp.sprite&quot;)
+      (highlight &quot;images/streetlamp-highlight.sprite&quot;)
+      (light &quot;images/streetlamp-light.sprite&quot;)
+      (active #t))
+
+    (scriptable-object
+      (name &quot;Lamp&quot;)
+      (pos 768 736)
+      (sprite &quot;images/streetlamp.sprite&quot;)
+      (highlight &quot;images/streetlamp-highlight.sprite&quot;)
+      (light &quot;images/streetlamp-light.sprite&quot;)
+      (active #t))
+
+
+    (scriptable-object
+      (name &quot;Lamp&quot;)
+      (pos 1024 736)
+      (sprite &quot;images/streetlamp.sprite&quot;)
+      (highlight &quot;images/streetlamp-highlight.sprite&quot;)
+      (light &quot;images/streetlamp-light.sprite&quot;)
+      (active #t))
+
+
   (tilemap (name &quot;background&quot;) (width 100) (height 30) (z-pos 0)
     (data
       0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 

Modified: trunk/src/dialog_manager.cpp
===================================================================
--- trunk/src/dialog_manager.cpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/dialog_manager.cpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -139,9 +139,9 @@
              pos.x + dialog_width,
              pos.y + 200);
 
-  VDisplay::fill_rounded_rect(rect, 32.0f,
-                              Color(0, 0, 0.4f, 0.8f));
-  VDisplay::draw_rounded_rect(rect, 32.0f,
+  VDisplay::fill_rounded_rect(rect, 16.0f,
+                              Color(0, 0, 0.3f, 0.5f));
+  VDisplay::draw_rounded_rect(rect, 16.0f,
                               Color(0.6f, 1.0f, 1.0f, 0.8f));
 
   portrait.draw(Vector(pos.x + portrait_border_x,

Modified: trunk/src/display/display.cpp
===================================================================
--- trunk/src/display/display.cpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/display/display.cpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -148,7 +148,6 @@
   glColor4f(color.r, color.g, color.b, color.a);
 
   int n = 4;
-  glLineWidth(4.0f);
   glBegin(GL_LINE_STRIP);
   for(int i = 0; i &lt;= n; ++i)
     {
@@ -184,7 +183,6 @@
   glVertex2f(irect.left, irect.top - radius);
 
   glEnd();
-  glLineWidth(1.0f);
 }
 
 int

Modified: trunk/src/player.cpp
===================================================================
--- trunk/src/player.cpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/player.cpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -75,7 +75,7 @@
   light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
   light.set_scale(4.0f);
 
-  sc.light().draw(light, pos, 100.0f);
+  //sc.light().draw(light, pos, 100.0f);
   sprite.draw(sc, pos, 100);
 
   Entity* obj = find_useable_entity();

Modified: trunk/src/scriptable_object.cpp
===================================================================
--- trunk/src/scriptable_object.cpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/scriptable_object.cpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -39,15 +39,18 @@
 { 
   std::string spritename;
   std::string highlightname;
+  std::string lightname;
   
   lisp::Properties props(lisp);
   props.get(&quot;name&quot;, name);
   props.get(&quot;sprite&quot;, spritename);
   props.get(&quot;highlight&quot;, highlightname);
+  props.get(&quot;light&quot;,   lightname);
   props.get(&quot;pos&quot;, pos);
   props.get(&quot;script&quot;, use_script);
   props.get(&quot;use-verb&quot;, use_verb);
   props.get(&quot;active&quot;, active);
+  props.get(&quot;flash-speed&quot;, flash_speed);
   props.print_unused_warnings(&quot;scriptable-object&quot;);
   
   if (use_verb != &quot;&quot;)
@@ -59,6 +62,12 @@
   
   if (highlightname != &quot;&quot;)
     highlight = Sprite(highlightname);
+
+  if (lightname != &quot;&quot;)
+    light = Sprite(lightname);
+
+  highlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
+  light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
     
   flash_delta = game_time;
   target_x = pos.x;
@@ -74,13 +83,17 @@
 {
   if (flash_speed != 0)
     flash();
- 
-  sc.color().draw(sprite, pos, 1);
+
+  if (sprite)
+    sc.color().draw(sprite, pos, 50);
   
-  if (highlight) {
-    sc.color().draw(highlight, pos, 2);
-    sc.light().draw(highlight, pos, 1);
-  }
+  if (highlight) 
+    sc.highlight().draw(highlight, pos, 50);
+
+  if (light) 
+    {
+      sc.light().draw(light, pos, 50);
+    }
 }
 
 void
@@ -89,6 +102,9 @@
   sprite.update(delta);
   if (highlight)
     highlight.update(delta);
+
+  if (light)
+    light.update(delta);
     
   if (target_speed &gt; 0)
     move(delta);
@@ -186,11 +202,13 @@
   if(static_cast&lt;int&gt;(time/flash_speed) % 2 == 0) {    
     float alpha = fmodf(time, flash_speed) / flash_speed;
     // fade on
-    sprite.set_alpha(alpha);
+    highlight.set_alpha(alpha);
+    light.set_alpha(alpha);
   } else {
     float alpha = 1.0 - (fmodf(time, flash_speed) / flash_speed);
     // fade off
-    sprite.set_alpha(alpha);
+    highlight.set_alpha(alpha);
+    light.set_alpha(alpha);
   }
 }
 

Modified: trunk/src/scriptable_object.hpp
===================================================================
--- trunk/src/scriptable_object.hpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/scriptable_object.hpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -44,6 +44,7 @@
 {
 private:
   Sprite sprite;
+  Sprite light;
   Sprite highlight;
   
   //useable stuff

Modified: trunk/src/scripting/wrapper.cpp
===================================================================
--- trunk/src/scripting/wrapper.cpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/scripting/wrapper.cpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -1,6 +1,6 @@
 /**
  * WARNING: This file is automatically generated from:
- *  'src/scripting/wrapper.interface.hpp'
+ *  'scripting/wrapper.interface.hpp'
  * DO NOT CHANGE
  */
 #include &lt;config.h&gt;

Modified: trunk/src/scripting/wrapper.hpp
===================================================================
--- trunk/src/scripting/wrapper.hpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/scripting/wrapper.hpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -1,6 +1,6 @@
 /**
  * WARNING: This file is automatically generated from:
- *  'src/scripting/wrapper.interface.hpp'
+ *  'scripting/wrapper.interface.hpp'
  * DO NOT CHANGE
  */
 #ifndef __windstille_WRAPPER_H__

Modified: trunk/src/sector.cpp
===================================================================
--- trunk/src/sector.cpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/sector.cpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -332,4 +332,16 @@
   interactive_tilemap = t;
 }
 
+void
+Sector::set_ambient_light(const Color&amp; color)
+{
+  ambient_light = color;
+}
+
+Color
+Sector::get_ambient_light() const
+{
+  return ambient_light;
+}
+
 /* EOF */

Modified: trunk/src/sector.hpp
===================================================================
--- trunk/src/sector.hpp	2005-08-01 15:08:31 UTC (rev 877)
+++ trunk/src/sector.hpp	2005-08-01 19:30:42 UTC (rev 878)
@@ -90,6 +90,9 @@
   int get_width () const;
   int get_height () const;
 
+  void set_ambient_light(const Color&amp; color);
+  Color get_ambient_light() const;
+
   void add(GameObject*);
   void add_object(const std::string&amp; name, const lisp::Lisp* lisp);
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000530.html">[Windstille-commit] r877 - in trunk/data: levels scripts/newformat2
</A></li>
	<LI>Next message: <A HREF="000532.html">[Windstille-commit] r879 - trunk/src/sprite3d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#531">[ date ]</a>
              <a href="thread.html#531">[ thread ]</a>
              <a href="subject.html#531">[ subject ]</a>
              <a href="author.html#531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
