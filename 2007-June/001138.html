<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1486 - in trunk/windstille: data src	src/armature tools
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2007-June/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1486%20-%20in%20trunk/windstille%3A%20data%20src%0A%09src/armature%20tools&In-Reply-To=%3C200706210645.l5L6j1Gk013729%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001137.html">
   <LINK REL="Next"  HREF="001139.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1486 - in trunk/windstille: data src	src/armature tools</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1486%20-%20in%20trunk/windstille%3A%20data%20src%0A%09src/armature%20tools&In-Reply-To=%3C200706210645.l5L6j1Gk013729%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1486 - in trunk/windstille: data src	src/armature tools">grumbel at mail.berlios.de
       </A><BR>
    <I>Thu Jun 21 08:45:01 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001137.html">[Windstille-commit] r1485 - in trunk/windstille: data src	src/armature src/math tools
</A></li>
        <LI>Next message: <A HREF="001139.html">[Windstille-commit] r1487 - in trunk/windstille: data src/armature
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1138">[ date ]</a>
              <a href="thread.html#1138">[ thread ]</a>
              <a href="subject.html#1138">[ subject ]</a>
              <a href="author.html#1138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2007-06-21 08:45:00 +0200 (Thu, 21 Jun 2007)
New Revision: 1486

Modified:
   trunk/windstille/data/armature.arm
   trunk/windstille/src/armature/armature.cpp
   trunk/windstille/src/armature_test.cpp
   trunk/windstille/tools/bone_export.py
Log:
- some more bug fixing, now works a little bit better

Modified: trunk/windstille/data/armature.arm
===================================================================
--- trunk/windstille/data/armature.arm	2007-06-21 05:25:03 UTC (rev 1485)
+++ trunk/windstille/data/armature.arm	2007-06-21 06:45:00 UTC (rev 1486)
@@ -1,62 +1,532 @@
 ;; -*- scheme -*-
 (armature
-  (name &quot;Armature.001&quot;)
+  (name &quot;Armature&quot;)
   (bones
     (bone
-      (name      &quot;Base.001&quot;)
-      (children  &quot;Base.002&quot;)
+      (name      &quot;LegNull.L&quot;)
+      (children )
+      (parent    &quot;Lower Leg.L&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.304411500692)
+      (matrix    0.999972 -0.007122 -0.002196  0.000000
+                 0.005368  0.892687 -0.450645  0.000000
+                 0.005170  0.450621  0.892701  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.231616 -0.001893 0.003210 0.972800)
+      (euler     26.783901 -0.296208 0.307588)
+     )
+
+    (bone
+      (name      &quot;Hip.R&quot;)
+      (children  &quot;Upper Leg.R&quot;)
       (parent    &quot;Base&quot;)
+      (head      0.040620 -0.025407 0.039311)
+      (length    0.431728333235)
+      (matrix    0.464597  0.637705  0.614396  0.000000
+                 0.621588 -0.729017  0.286639  0.000000
+                 0.630696  0.248730 -0.735089  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.855673 -0.367926 -0.363775 0.011075)
+      (euler     161.305908 -39.101479 53.224243)
+     )
+
+    (bone
+      (name      &quot;Foot.L&quot;)
+      (children  &quot;Toes.L&quot;)
+      (parent    &quot;Lower Leg.L&quot;)
       (head      0.000000 0.000000 0.000000)
-      (length    49.66381073)
-      (matrix    0.653362  0.757046  0.000013  0.000000
-                -0.757046  0.653362  0.000028  0.000000
-                 0.000013 -0.000028  1.000000  0.000000
+      (length    0.404503166676)
+      (matrix    0.906031 -0.132580 -0.401908  0.000000
+                 0.404751  0.548869  0.731382  0.000000
+                 0.123628 -0.825328  0.550954  0.000000
                  0.000000  0.000000  0.000000  1.000000)
-      (quat      0.000016 -0.000000 0.416316 0.909220)
-      (euler     0.001619 -0.000743 49.204468)
+      (quat      -0.448946 -0.151561 0.154963 0.866870)
+      (euler     -56.274590 -7.101517 24.071728)
      )
 
     (bone
-      (name      &quot;Base.002&quot;)
-      (children  &quot;Base.003&quot;)
-      (parent    &quot;Base.001&quot;)
+      (name      &quot;Upper Arm.L&quot;)
+      (children  &quot;Forearm.L&quot;)
+      (parent    &quot;Shoulder.L&quot;)
+      (head      0.000000 -0.000000 -0.000000)
+      (length    0.532597243786)
+      (matrix    0.910775  0.149810 -0.384767  0.000000
+                -0.272327  0.918392 -0.287044  0.000000
+                 0.310365  0.366215  0.877246  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.169659 -0.180534 -0.109634 0.962602)
+      (euler     22.658560 -18.081207 -16.646976)
+     )
+
+    (bone
+      (name      &quot;Belly&quot;)
+      (children )
+      (parent    &quot;Base&quot;)
+      (head      0.000000 -0.023287 0.366125)
+      (length    0.353247851133)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000 -0.210548 -0.977584  0.000000
+                 0.000000  0.977584 -0.210548  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.777994 0.000000 0.000000 0.628272)
+      (euler     102.154457 -0.000000 0.000000)
+     )
+
+    (bone
+      (name      &quot;Upper Arm.R&quot;)
+      (children  &quot;Forearm.R&quot;)
+      (parent    &quot;Shoulder.R&quot;)
+      (head      0.000000 -0.000000 -0.000000)
+      (length    0.532600045204)
+      (matrix    0.910775 -0.149812  0.384766  0.000000
+                 0.272329  0.918392 -0.287043  0.000000
+                -0.310364  0.366214  0.877246  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.169659 0.180534 0.109635 0.962602)
+      (euler     22.658524 18.081169 16.647068)
+     )
+
+    (bone
+      (name      &quot;Foot.R&quot;)
+      (children  &quot;Toes.R&quot;)
+      (parent    &quot;Lower Leg.R&quot;)
       (head      0.000000 0.000000 0.000000)
-      (length    54.4462547302)
-      (matrix    0.000000  1.000000  0.000000  0.000000
-                -1.000000  0.000000 -0.000000  0.000000
-                -0.000000 -0.000000  1.000000  0.000000
+      (length    0.40450361371)
+      (matrix    0.906031  0.132580  0.401908  0.000000
+                -0.404752  0.548868  0.731382  0.000000
+                -0.123628 -0.825328  0.550954  0.000000
                  0.000000  0.000000  0.000000  1.000000)
-      (quat      -0.000000 -0.000000 0.707107 0.707107)
-      (euler     -0.000003 -0.000000 90.000000)
+      (quat      -0.448946 0.151562 -0.154963 0.866870)
+      (euler     -56.274628 7.101544 -24.071772)
      )
 
     (bone
-      (name      &quot;Base.003&quot;)
+      (name      &quot;Hip.L&quot;)
+      (children  &quot;Upper Leg.L&quot;)
+      (parent    &quot;Base&quot;)
+      (head      -0.039261 -0.025407 0.039311)
+      (length    0.431728303432)
+      (matrix    0.464598 -0.637705 -0.614396  0.000000
+                -0.621588 -0.729017  0.286638  0.000000
+                -0.630696  0.248730 -0.735089  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.855673 0.367926 0.363775 0.011075)
+      (euler     161.305908 39.101467 -53.224239)
+     )
+
+    (bone
+      (name      &quot;LegNull.R&quot;)
       (children )
-      (parent    &quot;Base.002&quot;)
+      (parent    &quot;Lower Leg.R&quot;)
       (head      0.000000 0.000000 0.000000)
-      (length    66.5862960815)
-      (matrix    0.000000 -1.000000 -0.000000  0.000000
-                -0.000000 -0.000000  1.000000  0.000000
-                -1.000000 -0.000000 -0.000000  0.000000
+      (length    0.304411649704)
+      (matrix    0.999972  0.007122  0.002196  0.000000
+                -0.005368  0.892687 -0.450646  0.000000
+                -0.005170  0.450622  0.892700  0.000000
                  0.000000  0.000000  0.000000  1.000000)
-      (quat      0.500000 -0.500000 -0.500000 0.500000)
-      (euler     90.000008 0.000000 -90.000000)
+      (quat      0.231617 0.001893 -0.003210 0.972800)
+      (euler     26.783953 0.296216 -0.307581)
      )
 
+    (bone
+      (name      &quot;Neck&quot;)
+      (children  &quot;Head&quot;)
+      (parent    &quot;Shoulders&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.265078783035)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000  0.779716 -0.626133  0.000000
+                 0.000000  0.626133  0.779716  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.331876 0.000000 0.000000 0.943323)
+      (euler     38.765373 -0.000000 0.000000)
+     )
+
+    (bone
+      (name      &quot;Hip&quot;)
+      (children  &quot;Body&quot;)
+      (parent    &quot;Base&quot;)
+      (head      0.000000 0.003058 0.001977)
+      (length    0.369722664356)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000  0.997063 -0.076591  0.000000
+                 0.000000  0.076591  0.997063  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.038324 0.000000 0.000000 0.999265)
+      (euler     4.392666 -0.000000 0.000000)
+     )
+
+    (bone
+      (name      &quot;Shoulders&quot;)
+      (children  &quot;Shoulder.R&quot; &quot;Neck&quot; &quot;Shoulder.L&quot;)
+      (parent    &quot;Body&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.273266792297)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000  0.999747 -0.022513  0.000000
+                 0.000000  0.022513  0.999747  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.011257 0.000000 0.000000 0.999937)
+      (euler     1.290010 -0.000000 0.000000)
+     )
+
+    (bone
+      (name      &quot;Shoulder.L&quot;)
+      (children  &quot;Upper Arm.L&quot;)
+      (parent    &quot;Shoulders&quot;)
+      (head      -0.133504 0.016665 -0.103217)
+      (length    0.469278693199)
+      (matrix   -0.211033 -0.881235 -0.422954  0.000000
+                -0.390487 -0.320669  0.862955  0.000000
+                -0.896094  0.347270 -0.276438  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.588658 0.540093 0.560193 0.219009)
+      (euler     -51.479076 116.350647 61.611572)
+     )
+
+    (bone
+      (name      &quot;FingerTips.L&quot;)
+      (children )
+      (parent    &quot;Fingers.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.108158022165)
+      (matrix    0.972665  0.118983  0.199413  0.000000
+                -0.148899  0.978544  0.142414  0.000000
+                -0.178189 -0.168213  0.969512  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.078438 0.095350 -0.067644 0.990040)
+      (euler     -9.842998 10.264305 -8.703465)
+     )
+
     (bone ;; a root bone
       (name      &quot;Base&quot;)
-      (children  &quot;Base.001&quot;)
+      (children  &quot;Belly&quot; &quot;Hip.R&quot; &quot;Hip.L&quot; &quot;Hip&quot;)
       (parent )
-      (head      0.247892 6.338192 0.331998)
-      (length    67.0597305298)
-      (matrix    0.653362 -0.757046  0.000013  0.000000
-                 0.757046  0.653362 -0.000028  0.000000
-                 0.000013  0.000028  1.000000  0.000000
+      (head      -0.134862 -0.098326 -1.250145)
+      (length    0.226376548409)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000 -0.011341 -0.999936  0.000000
+                 0.000000  0.999936 -0.011341  0.000000
                  0.000000  0.000000  0.000000  1.000000)
-      (quat      -0.000016 0.000000 -0.416316 0.909220)
-      (euler     -0.001622 -0.000743 -49.204472)
+      (quat      0.711105 0.000000 0.000000 0.703086)
+      (euler     90.649788 -0.000000 0.000000)
      )
 
+    (bone
+      (name      &quot;FingerTips.R&quot;)
+      (children )
+      (parent    &quot;Fingers.R&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.115987345576)
+      (matrix    0.983139 -0.114041 -0.142942  0.000000
+                 0.129104  0.986481  0.100931  0.000000
+                 0.129499 -0.117684  0.984571  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.054969 -0.068504 0.061137 0.994257)
+      (euler     -6.816106 -7.440639 7.481158)
+     )
+
+    (bone
+      (name      &quot;Shoulder.R&quot;)
+      (children  &quot;Upper Arm.R&quot;)
+      (parent    &quot;Shoulders&quot;)
+      (head      0.134862 0.016665 -0.103217)
+      (length    0.469281166792)
+      (matrix   -0.211033  0.881236  0.422952  0.000000
+                 0.390486 -0.320668  0.862956  0.000000
+                 0.896095  0.347269 -0.276439  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.588658 -0.540093 -0.560192 0.219009)
+      (euler     -51.478897 -116.350609 -61.611641)
+     )
+
+    (bone
+      (name      &quot;Body&quot;)
+      (children  &quot;Shoulders&quot;)
+      (parent    &quot;Hip&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.367126226425)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000  0.989207  0.146523  0.000000
+                 0.000000 -0.146523  0.989207  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.073460 0.000000 0.000000 0.997298)
+      (euler     -8.425457 -0.000000 0.000000)
+     )
+
+    (bone
+      (name      &quot;Toes.R&quot;)
+      (children )
+      (parent    &quot;Foot.R&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.225673496723)
+      (matrix   -0.908818  0.133896  0.395123  0.000000
+                -0.133897  0.803379 -0.580218  0.000000
+                -0.395123 -0.580219 -0.712197  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.000000 0.925256 -0.313545 0.213521)
+      (euler     39.169296 156.726379 8.381133)
+     )
+
+    ;; ignoring bone: IK_Foot.R
+
+    (bone
+      (name      &quot;Hand.L&quot;)
+      (children  &quot;Fingers.L&quot; &quot;LowerThumb.L&quot;)
+      (parent    &quot;Forearm.L&quot;)
+      (head      0.006394 0.036836 -0.005415)
+      (length    0.252678871155)
+      (matrix    0.997139  0.068329  0.032331  0.000000
+                -0.069244  0.997204  0.028089  0.000000
+                -0.030322 -0.030247  0.999082  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.014596 0.015676 -0.034421 0.999178)
+      (euler     -1.734116 1.737575 -3.972393)
+     )
+
+    (bone
+      (name      &quot;Fingers.R&quot;)
+      (children  &quot;FingerTips.R&quot;)
+      (parent    &quot;Hand.R&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.121155895293)
+      (matrix    0.991391  0.094134 -0.091006  0.000000
+                -0.084731  0.991150  0.102183  0.000000
+                 0.099819 -0.093592  0.990594  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.049109 -0.047867 -0.044867 0.996636)
+      (euler     -5.397348 -5.728770 -4.885022)
+     )
+
+    (bone
+      (name      &quot;Head&quot;)
+      (children )
+      (parent    &quot;Neck&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.266009747982)
+      (matrix    1.000000  0.000000  0.000000  0.000000
+                 0.000000  0.612928 -0.790139  0.000000
+                 0.000000  0.790139  0.612928  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.439927 0.000000 0.000000 0.898033)
+      (euler     52.198490 -0.000000 0.000000)
+     )
+
+    (bone
+      (name      &quot;Fingers.L&quot;)
+      (children  &quot;FingerTips.L&quot;)
+      (parent    &quot;Hand.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.123009525239)
+      (matrix    0.990993 -0.092455  0.096872  0.000000
+                 0.081849  0.990746  0.108271  0.000000
+                -0.105986 -0.099367  0.989390  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.052098 0.050899 0.043734 0.996385)
+      (euler     -5.735141 6.083977 4.721482)
+     )
+
+    ;; ignoring bone: IK_Foot.L
+
+    (bone
+      (name      &quot;Hand.R&quot;)
+      (children  &quot;Fingers.R&quot; &quot;LowerThumb.R&quot;)
+      (parent    &quot;Forearm.R&quot;)
+      (head      -0.006394 0.036837 -0.005415)
+      (length    0.252679914236)
+      (matrix    0.997139 -0.068329 -0.032331  0.000000
+                 0.069244  0.997204  0.028089  0.000000
+                 0.030321 -0.030247  0.999082  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.014596 -0.015676 0.034422 0.999178)
+      (euler     -1.734102 -1.737553 3.972412)
+     )
+
+    (bone
+      (name      &quot;Toes.L&quot;)
+      (children )
+      (parent    &quot;Foot.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.225673496723)
+      (matrix   -0.908818 -0.133896 -0.395122  0.000000
+                 0.133897  0.803379 -0.580219  0.000000
+                 0.395121 -0.580219 -0.712197  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.000000 -0.925256 0.313545 0.213520)
+      (euler     39.169323 -156.726471 -8.381129)
+     )
+
+    (bone
+      (name      &quot;Thumb.R&quot;)
+      (children )
+      (parent    &quot;LowerThumb.R&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.124690048397)
+      (matrix    0.802272 -0.568549  0.181966  0.000000
+                 0.596654  0.753975 -0.274820  0.000000
+                 0.019050  0.329051  0.944120  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.161383 0.043539 0.311397 0.935463)
+      (euler     19.214825 -1.091575 36.638378)
+     )
+
+    (bone
+      (name      &quot;Lower Leg.L&quot;)
+      (children  &quot;Foot.L&quot; &quot;LegNull.L&quot;)
+      (parent    &quot;Upper Leg.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.840111851692)
+      (matrix    0.999287  0.028426  0.024856  0.000000
+                -0.025254  0.992486 -0.119725  0.000000
+                -0.028072  0.119011  0.992496  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.059802 0.013258 -0.013447 0.998032)
+      (euler     6.837760 1.608639 -1.447701)
+     )
+
+    (bone
+      (name      &quot;Upper Leg.R&quot;)
+      (children  &quot;Lower Leg.R&quot;)
+      (parent    &quot;Hip.R&quot;)
+      (head      -0.000384 0.012505 -0.020905)
+      (length    0.878771483898)
+      (matrix    0.491190 -0.550237 -0.675257  0.000000
+                 0.626030  0.762022 -0.165557  0.000000
+                 0.605656 -0.341411  0.718762  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.051004 -0.371507 0.341156 0.861971)
+      (euler     -25.407673 -37.276039 51.881908)
+     )
+
+    (bone
+      (name      &quot;ArmNull.R&quot;)
+      (children )
+      (parent    &quot;Forearm.R&quot;)
+      (head      -0.000000 0.000000 0.000000)
+      (length    0.225655779243)
+      (matrix   -0.071245  0.000001  0.997459  0.000000
+                 0.997459 -0.000002  0.071245  0.000000
+                 0.000002  1.000000 -0.000000  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.481860 0.517504 0.517505 0.481859)
+      (euler     90.000023 -0.000106 94.085487)
+     )
+
+    (bone
+      (name      &quot;LowerThumb.R&quot;)
+      (children  &quot;Thumb.R&quot;)
+      (parent    &quot;Hand.R&quot;)
+      (head      0.018833 -0.247973 -0.030859)
+      (length    0.186533346772)
+      (matrix    0.641058  0.720677 -0.263949  0.000000
+                -0.448956  0.631054  0.632621  0.000000
+                 0.622481 -0.287045  0.728095  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.265475 -0.255881 -0.337633 0.866055)
+      (euler     -21.516403 -38.497559 -35.004967)
+     )
+
+    ;; ignoring bone: IK_Arm.L
+
+    (bone
+      (name      &quot;Thumb.L&quot;)
+      (children )
+      (parent    &quot;LowerThumb.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.124689467251)
+      (matrix    0.802273  0.568549 -0.181960  0.000000
+                -0.596653  0.753976 -0.274820  0.000000
+                -0.019055  0.329048  0.944121  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.161382 -0.043536 -0.311397 0.935464)
+      (euler     19.214617 1.091853 -36.638290)
+     )
+
+    (bone
+      (name      &quot;Forearm.L&quot;)
+      (children  &quot;ArmNull.L&quot; &quot;Hand.L&quot;)
+      (parent    &quot;Upper Arm.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.527911424637)
+      (matrix    0.999244  0.012327 -0.036882  0.000000
+                -0.013579  0.999333 -0.033897  0.000000
+                 0.036439  0.034372  0.998745  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.017073 -0.018336 -0.006479 0.999665)
+      (euler     1.971079 -2.088269 -0.778568)
+     )
+
+    (bone
+      (name      &quot;Forearm.R&quot;)
+      (children  &quot;ArmNull.R&quot; &quot;Hand.R&quot;)
+      (parent    &quot;Upper Arm.R&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.527913451195)
+      (matrix    0.999244 -0.012328  0.036881  0.000000
+                 0.013580  0.999333 -0.033897  0.000000
+                -0.036439  0.034372  0.998745  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.017073 0.018336 0.006479 0.999665)
+      (euler     1.971067 2.088262 0.778603)
+     )
+
+    ;; ignoring bone: IK_Arm.R
+
+    (bone
+      (name      &quot;LowerThumb.L&quot;)
+      (children  &quot;Thumb.L&quot;)
+      (parent    &quot;Hand.L&quot;)
+      (head      -0.018833 -0.247972 -0.030859)
+      (length    0.186534196138)
+      (matrix    0.641059 -0.720677  0.263946  0.000000
+                 0.448958  0.631054  0.632620  0.000000
+                -0.622479 -0.287046  0.728096  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.265475 0.255880 0.337633 0.866056)
+      (euler     -21.516415 38.497402 35.005032)
+     )
+
+    (bone
+      (name      &quot;ArmNull.L&quot;)
+      (children )
+      (parent    &quot;Forearm.L&quot;)
+      (head      0.000000 -0.000000 0.000000)
+      (length    0.225656166673)
+      (matrix   -0.071247 -0.000001 -0.997459  0.000000
+                -0.997459 -0.000002  0.071247  0.000000
+                -0.000002  1.000000 -0.000001  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.481860 -0.517505 -0.517506 0.481859)
+      (euler     90.000038 0.000113 -94.085594)
+     )
+
+    (bone
+      (name      &quot;Lower Leg.R&quot;)
+      (children  &quot;Foot.R&quot; &quot;LegNull.R&quot;)
+      (parent    &quot;Upper Leg.R&quot;)
+      (head      0.000000 0.000000 0.000000)
+      (length    0.840111613274)
+      (matrix    0.999287 -0.028426 -0.024860  0.000000
+                 0.025254  0.992486 -0.119725  0.000000
+                 0.028076  0.119011  0.992496  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      0.059802 -0.013260 0.013447 0.998032)
+      (euler     6.837764 -1.608874 1.447679)
+     )
+
+    (bone
+      (name      &quot;Upper Leg.L&quot;)
+      (children  &quot;Lower Leg.L&quot;)
+      (parent    &quot;Hip.L&quot;)
+      (head      0.000384 0.012505 -0.020905)
+      (length    0.878771066666)
+      (matrix    0.491187  0.550237  0.675259  0.000000
+                -0.626029  0.762022 -0.165560  0.000000
+                -0.605659 -0.341411  0.718760  0.000000
+                 0.000000  0.000000  0.000000  1.000000)
+      (quat      -0.051003 0.371509 -0.341157 0.861970)
+      (euler     -25.407726 37.276268 -51.882030)
+     )
+
   ) ;; bones
  ) ;; armature

Modified: trunk/windstille/src/armature/armature.cpp
===================================================================
--- trunk/windstille/src/armature/armature.cpp	2007-06-21 05:25:03 UTC (rev 1485)
+++ trunk/windstille/src/armature/armature.cpp	2007-06-21 06:45:00 UTC (rev 1486)
@@ -122,36 +122,37 @@
 void
 Armature::draw()
 {
+  // For some reason OpenGL sometimes doesn't draw the lines properly,
+  // going to NavigationTester and then back fixes the issue
   OpenGLState state;
   state.color(Color(1.0f, 0.0f, 0.0f));
   state.activate();
 
+  //std::cout &lt;&lt; &quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-&quot; &lt;&lt; std::endl;
   glBegin(GL_LINES);
   draw_bone(root_bone, Vector3(0,0, 0), Matrix::identity());
   glEnd();
-
 }
 
 void
 Armature::draw_bone(Bone* bone, Vector3 p, Matrix cur)
 {
-  Vector3 vec = Vector3(bone-&gt;length, 0.0f, 0.0f);
+  Vector3 vec = Vector3(0.0f, bone-&gt;length, 0.0f); // Where shall we apply bone length to?
   Matrix  mat = bone-&gt;matrix.multiply(cur);
   
-  //std::cout &lt;&lt; &quot;draw_bone&quot; &lt;&lt; std::endl;
-  //std::cout &lt;&lt; &quot;matrix: \n&quot; &lt;&lt; mat &lt;&lt; std::endl;
-  //std::cout &lt;&lt; &quot;before: &quot; &lt;&lt; vec &lt;&lt; std::endl;
-  vec = mat.multiply(vec);
-  //std::cout &lt;&lt; &quot;after: &quot; &lt;&lt; vec &lt;&lt; std::endl;
-
-  
+  // std::cout &lt;&lt; &quot;--------------------------------------------------------------&quot; &lt;&lt; std::endl;
+  // std::cout &lt;&lt; &quot;draw_bone: &quot; &lt;&lt; bone-&gt;name &lt;&lt; std::endl;
+  // std::cout &lt;&lt; &quot;bone matrix: \n&quot; &lt;&lt; bone-&gt;matrix &lt;&lt; std::endl;
+  // std::cout &lt;&lt; &quot;matrix: \n&quot; &lt;&lt; mat &lt;&lt; std::endl;
+  // std::cout &lt;&lt; &quot;before: &quot; &lt;&lt; vec &lt;&lt; std::endl;
+  vec = bone-&gt;matrix.multiply(vec) + p;
+  // std::cout &lt;&lt; &quot;after: &quot; &lt;&lt; vec &lt;&lt; std::endl;
+ 
   glVertex3f(  p.x,   p.y,   p.z);
   glVertex3f(vec.x, vec.y, vec.z);
 
   for(std::vector&lt;Bone*&gt;::iterator i = bone-&gt;children.begin(); i != bone-&gt;children.end(); ++i)  
-    {
-      draw_bone(*i, vec, mat);
-    }
+    draw_bone(*i, vec, mat);
 }
 
 /* EOF */

Modified: trunk/windstille/src/armature_test.cpp
===================================================================
--- trunk/windstille/src/armature_test.cpp	2007-06-21 05:25:03 UTC (rev 1485)
+++ trunk/windstille/src/armature_test.cpp	2007-06-21 06:45:00 UTC (rev 1486)
@@ -43,13 +43,13 @@
 void
 ArmatureTest::draw()
 {
-  SDL_Delay(30);
   glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-  
+
   glPushMatrix();
 
   glTranslatef(400.0f, 300.0f, 0.0f);
+  glScalef(128.0f, 128.0f, 128.0f);
  
   glRotatef(xrot, 1.0f, 0.0f, 0.0f);
   glRotatef(yrot, 0.0f, 1.0f, 0.0f);

Modified: trunk/windstille/tools/bone_export.py
===================================================================
--- trunk/windstille/tools/bone_export.py	2007-06-21 05:25:03 UTC (rev 1485)
+++ trunk/windstille/tools/bone_export.py	2007-06-21 06:45:00 UTC (rev 1486)
@@ -48,12 +48,12 @@
             # else in local bonespace
             if bone.parent:
                 out.write(&quot;      (parent    \&quot;%s\&quot;)\n&quot; % bone.parent.name)
-                out.write(&quot;      (head      %s)\n&quot; % (vec2str(64*bone.head['BONESPACE']),))
+                out.write(&quot;      (head      %s)\n&quot; % (vec2str(bone.head['BONESPACE']),))
             else:
                 out.write(&quot;      (parent )\n&quot;)
-                out.write(&quot;      (head      %s)\n&quot; % (vec2str(64*bone.head['ARMATURESPACE'])))
+                out.write(&quot;      (head      %s)\n&quot; % (vec2str(bone.head['ARMATURESPACE'])))
 
-            out.write(&quot;      (length    %s)\n&quot; % (bone.length*64))
+            out.write(&quot;      (length    %s)\n&quot; % (bone.length))
             out.write(&quot;      (matrix   %s)\n&quot; % matrix2str(&quot; &quot;*16, bone.matrix['BONESPACE']))
             out.write(&quot;      (quat      %s)\n&quot; % quat2str(bone.matrix['BONESPACE'].toQuat()))
             out.write(&quot;      (euler     %s)\n&quot; % euler2str(bone.matrix['BONESPACE'].toEuler()))


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001137.html">[Windstille-commit] r1485 - in trunk/windstille: data src	src/armature src/math tools
</A></li>
	<LI>Next message: <A HREF="001139.html">[Windstille-commit] r1487 - in trunk/windstille: data src/armature
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1138">[ date ]</a>
              <a href="thread.html#1138">[ thread ]</a>
              <a href="subject.html#1138">[ subject ]</a>
              <a href="author.html#1138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
