<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1383 - in trunk/windstille: . data/images	data/scripts src src/font src/gui
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2007-June/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1383%20-%20in%20trunk/windstille%3A%20.%20data/images%0A%09data/scripts%20src%20src/font%20src/gui&In-Reply-To=%3C200706102304.l5AN4pcw009673%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001035.html">
   <LINK REL="Next"  HREF="001037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1383 - in trunk/windstille: . data/images	data/scripts src src/font src/gui</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1383%20-%20in%20trunk/windstille%3A%20.%20data/images%0A%09data/scripts%20src%20src/font%20src/gui&In-Reply-To=%3C200706102304.l5AN4pcw009673%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1383 - in trunk/windstille: . data/images	data/scripts src src/font src/gui">grumbel at mail.berlios.de
       </A><BR>
    <I>Mon Jun 11 01:04:51 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001035.html">[Windstille-commit] r1382 - in trunk/windstille/src: . gui
</A></li>
        <LI>Next message: <A HREF="001037.html">[Windstille-commit] r1384 - in trunk/windstille/data: . models	models/characters models/characters/bob	models/characters/jane models/characters/yagor models/objects	models/objects/barrobot models/objects/pistol models/vehicles	models/vehicles/train scripts scripts/apartment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1036">[ date ]</a>
              <a href="thread.html#1036">[ thread ]</a>
              <a href="subject.html#1036">[ subject ]</a>
              <a href="author.html#1036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2007-06-11 01:04:41 +0200 (Mon, 11 Jun 2007)
New Revision: 1383

Added:
   trunk/windstille/data/images/titlescreen.png
   trunk/windstille/data/scripts/init.nut
Modified:
   trunk/windstille/
   trunk/windstille/src/SConscript
   trunk/windstille/src/conversation.cpp
   trunk/windstille/src/dialog_manager.cpp
   trunk/windstille/src/font/fonts.cpp
   trunk/windstille/src/font/fonts.hpp
   trunk/windstille/src/game_session.cpp
   trunk/windstille/src/gui/button.cpp
   trunk/windstille/src/gui/list_view.cpp
   trunk/windstille/src/gui/menu_component.cpp
   trunk/windstille/src/gui/menu_component.hpp
   trunk/windstille/src/gui/tab_component.cpp
   trunk/windstille/src/inventory.cpp
   trunk/windstille/src/screen_manager.cpp
   trunk/windstille/src/screen_manager.hpp
   trunk/windstille/src/text_area.cpp
   trunk/windstille/src/windstille_main.cpp
Log:
- added simple title screen


Property changes on: trunk/windstille
___________________________________________________________________
Name: svn:ignore
   + windstille


Added: trunk/windstille/data/images/titlescreen.png
===================================================================
(Binary files differ)


Property changes on: trunk/windstille/data/images/titlescreen.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Added: trunk/windstille/data/scripts/init.nut
===================================================================
--- trunk/windstille/data/scripts/init.nut	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/data/scripts/init.nut	2007-06-10 23:04:41 UTC (rev 1383)
@@ -0,0 +1,34 @@
+/* -*- c++ -*-
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+/*
+ * This script is automatically executed on Windstille startup, use
+ * windstille.nut for function definitions, use this for things that
+ * should get executed (console messages displayed on start up and such).
+ */
+
+// FIXME: println does a 'inspect', print a to_s, unintuitive
+
+/* EOF */

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/SConscript	2007-06-10 23:04:41 UTC (rev 1383)
@@ -83,6 +83,7 @@
 'tile_description.cpp',
 'timer.cpp',
 'trigger.cpp',
+'title_screen.cpp',
 'util.cpp',
 'view.cpp',
 'lisp_getters.cpp',

Modified: trunk/windstille/src/conversation.cpp
===================================================================
--- trunk/windstille/src/conversation.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/conversation.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -72,11 +72,11 @@
   for(int i = 0; i &lt; int(choices.size()); ++i)
     {
       if (i == selection)
-        Fonts::ttfdialog-&gt;draw(x, y, choices[i]);
+        Fonts::vera20-&gt;draw(x, y, choices[i]);
       else
-        Fonts::ttfdialog-&gt;draw(x, y, choices[i], Color(0.5f, 0.5f, 0.5f));
+        Fonts::vera20-&gt;draw(x, y, choices[i], Color(0.5f, 0.5f, 0.5f));
   
-      y += Fonts::ttfdialog-&gt;get_height() + 10;
+      y += Fonts::vera20-&gt;get_height() + 10;
     }
 }
 

Modified: trunk/windstille/src/dialog_manager.cpp
===================================================================
--- trunk/windstille/src/dialog_manager.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/dialog_manager.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -190,9 +190,9 @@
 
 
   delete text_area;
-  text_area = new TextArea(Rect(Point(text_rect.left, text_rect.top + Fonts::ttfdialog-&gt;get_height()),
+  text_area = new TextArea(Rect(Point(text_rect.left, text_rect.top + Fonts::vera20-&gt;get_height()),
                                 Size(text_width, 200)), true);
-  text_area-&gt;set_font(Fonts::ttfdialog);
+  text_area-&gt;set_font(Fonts::vera20);
   text_area-&gt;set_text(text);
 }
 

Modified: trunk/windstille/src/font/fonts.cpp
===================================================================
--- trunk/windstille/src/font/fonts.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/font/fonts.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -27,20 +27,22 @@
 #include &quot;border_font_effect.hpp&quot;
 #include &quot;fonts.hpp&quot;
 
-TTFFont* Fonts::ttffont   = 0;
-TTFFont* Fonts::vera12    = 0;
-TTFFont* Fonts::vera16    = 0;
-TTFFont* Fonts::ttfdialog = 0;
+TTFFont* Fonts::ttffont = 0;
+TTFFont* Fonts::vera12  = 0;
+TTFFont* Fonts::vera16  = 0;
+TTFFont* Fonts::vera20  = 0;
+TTFFont* Fonts::vera28  = 0;
 
 void
 Fonts::init()
 {
   BorderFontEffect* border_effect = new BorderFontEffect(1);
 
-  ttffont   = new TTFFont(&quot;fonts/VeraMono.ttf&quot;, 12);
-  vera12    = new TTFFont(&quot;fonts/Vera.ttf&quot;, 12);
-  vera16    = new TTFFont(&quot;fonts/Vera.ttf&quot;, 16);
-  ttfdialog = new TTFFont(&quot;fonts/Vera.ttf&quot;, 20);
+  ttffont = new TTFFont(&quot;fonts/VeraMono.ttf&quot;, 12);
+  vera12  = new TTFFont(&quot;fonts/Vera.ttf&quot;, 12);
+  vera16  = new TTFFont(&quot;fonts/Vera.ttf&quot;, 16);
+  vera20  = new TTFFont(&quot;fonts/Vera.ttf&quot;, 20);
+  vera28  = new TTFFont(&quot;fonts/Vera.ttf&quot;, 28);
 
   delete border_effect;
 }
@@ -51,7 +53,8 @@
   delete ttffont;
   delete vera12;
   delete vera16;
-  delete ttfdialog;
+  delete vera20;
+  delete vera28;
 }
 
 /* EOF */

Modified: trunk/windstille/src/font/fonts.hpp
===================================================================
--- trunk/windstille/src/font/fonts.hpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/font/fonts.hpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -33,7 +33,8 @@
 extern TTFFont* ttffont;
 extern TTFFont* vera12;
 extern TTFFont* vera16;
-extern TTFFont* ttfdialog;
+extern TTFFont* vera20;
+extern TTFFont* vera28;
 
 void init();
 void deinit();

Modified: trunk/windstille/src/game_session.cpp
===================================================================
--- trunk/windstille/src/game_session.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/game_session.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -180,7 +180,7 @@
   if (pause)
     {
       if ((SDL_GetTicks() / 1000) % 2)
-        Fonts::ttfdialog-&gt;draw(Display::get_width()/2, Display::get_height()/2, &quot;Pause&quot;);
+        Fonts::vera20-&gt;draw(Display::get_width()/2, Display::get_height()/2, &quot;Pause&quot;);
     }
 }
 

Modified: trunk/windstille/src/gui/button.cpp
===================================================================
--- trunk/windstille/src/gui/button.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/gui/button.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -51,7 +51,7 @@
 {
   Display::fill_rect(rect, Color(0.0f, 0.0f, 0.0f, 0.5f));
   Display::draw_rect(rect, Color(1.0f, 1.0f, 1.0f, 0.5f));
-  Fonts::ttfdialog-&gt;draw_center(rect.left + rect.get_width()/2, rect.top + rect.get_height()/2,
+  Fonts::vera20-&gt;draw_center(rect.left + rect.get_width()/2, rect.top + rect.get_height()/2,
                                 label,
                                 is_active()
                                 ? Color(1.0f, 1.0f, 1.0f, 1.0f) 

Modified: trunk/windstille/src/gui/list_view.cpp
===================================================================
--- trunk/windstille/src/gui/list_view.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/gui/list_view.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -43,7 +43,7 @@
 void
 ListView::draw()
 {
-  TTFFont* font = Fonts::ttfdialog;
+  TTFFont* font = Fonts::vera20;
 
   float x = rect.left;
   float y = rect.top + font-&gt;get_height();

Modified: trunk/windstille/src/gui/menu_component.cpp
===================================================================
--- trunk/windstille/src/gui/menu_component.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/gui/menu_component.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -26,6 +26,7 @@
 #include &lt;iostream&gt;
 #include &quot;input/controller.hpp&quot;
 #include &quot;menu_component.hpp&quot;
+#include &quot;gui/root_component.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;math.hpp&quot;
 
@@ -40,7 +41,7 @@
 MenuItem::draw(const Rectf&amp; rect, bool is_active)
 {
   Color font_color;
-  TTFFont* font = Fonts::vera16;
+  TTFFont* font = parent-&gt;get_font();
   
   if (is_active) {
     Display::fill_rounded_rect(rect, 5.0f, Color(0.5f, 0.5f, 0.5f, 0.75f));
@@ -100,7 +101,7 @@
 EnumMenuItem::draw(const Rectf&amp; rect, bool is_active)
 {
   MenuItem::draw(rect, is_active);
-  TTFFont* font = Fonts::vera16;
+  TTFFont* font = parent-&gt;get_font();
   Color font_color;
   if (is_active)
     {
@@ -111,9 +112,9 @@
       font_color = Color(0.75f, 0.75f, 0.75f, 1.0f);
     }
 
-  font-&gt;draw(rect.right - font-&gt;get_height() - font-&gt;get_width(&quot;&lt; &quot; + labels[index].label + &quot; &gt;&quot;),
+  font-&gt;draw(rect.right - font-&gt;get_height() - font-&gt;get_width(labels[index].label),
              rect.top + font-&gt;get_height()/2.0f + rect.get_height()/2.0f - 2.0f,
-             &quot;&lt; &quot; + labels[index].label + &quot; &gt;&quot;,
+             labels[index].label,
              font_color);
 }
 
@@ -187,9 +188,32 @@
   MenuItem::update(delta);
 }
 
+ButtonMenuItem::ButtonMenuItem(MenuComponent* parent_, const std::string&amp; label_)
+  : MenuItem(parent_, label_)
+{
+}
+
+void
+ButtonMenuItem::click()
+{
+  on_click();
+}
+
+void
+ButtonMenuItem::draw(const Rectf&amp; rect, bool is_active)
+{
+  MenuItem::draw(rect, is_active);
+}
+
+void
+ButtonMenuItem::update(float)
+{
+}
+
 MenuComponent::MenuComponent(const Rectf&amp; rect, Component* parent)
   : Component(rect, parent),
-    current_item(0)
+    current_item(0),
+    font(Fonts::vera16)
 {
 }
 
@@ -211,7 +235,7 @@
 MenuComponent::draw()
 {
   float spacing = 10.0f;
-  float step = Fonts::vera16-&gt;get_height() + spacing*2.0f;
+  float step = font-&gt;get_height() + spacing*2.0f;
 
   for(Items::size_type i = 0; i &lt; items.size(); ++i)
     {
@@ -232,7 +256,7 @@
         {
           if (i-&gt;button.name == OK_BUTTON)
             {
-              
+              items[current_item]-&gt;click();
             }
           else if (i-&gt;button.name == CANCEL_BUTTON)
             {
@@ -246,12 +270,10 @@
               if (i-&gt;axis.pos &lt; 0)
                 {
                   items[current_item]-&gt;incr();
-                  // insert callback here
                 }
               else if (i-&gt;axis.pos &gt; 0)
                 {
                   items[current_item]-&gt;decr();
-                  // insert callback here
                 }
             }
           else if (i-&gt;axis.name == Y_AXIS)
@@ -261,19 +283,49 @@
                   current_item = current_item - 1;
                   if (current_item &lt; 0)
                     {
-                      current_item = 0;
-                      set_active(false);
+                      if (dynamic_cast&lt;RootComponent*&gt;(parent))
+                        {
+                          current_item = static_cast&lt;int&gt;(items.size())-1; 
+                        }
+                      else
+                        { // FIXME: This only works good with TabComponent
+                          current_item = 0;
+                          set_active(false);
+                        }
                     }
                 }
               else if (i-&gt;axis.pos &gt; 0)
                 {
-                  current_item = Math::mid(0, current_item + 1, static_cast&lt;int&gt;(items.size()-1)); 
+                  if (dynamic_cast&lt;RootComponent*&gt;(parent))
+                    {
+                      current_item += 1;
+                      if (current_item &gt;= static_cast&lt;int&gt;(items.size()))
+                        {
+                          current_item = 0;
+                        }
+                    }
+                  else
+                    {
+                      current_item = Math::mid(0, current_item + 1, static_cast&lt;int&gt;(items.size()-1)); 
+                    }
                 }
             }
         }
     }
 }
 
+void
+MenuComponent::set_font(TTFFont* font_)
+{
+  font = font_;
+}
+
+TTFFont*
+MenuComponent::get_font()
+{
+  return font;
+}
+
 } // namespace GUI
 
 /* EOF */

Modified: trunk/windstille/src/gui/menu_component.hpp
===================================================================
--- trunk/windstille/src/gui/menu_component.hpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/gui/menu_component.hpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -29,9 +29,12 @@
 #include &lt;string&gt;
 #include &lt;vector&gt;
 #include &quot;signals/signal_v1.hpp&quot;
+#include &quot;signals/signal_v0.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;component.hpp&quot;
 
+class TTFFont;
+
 namespace GUI {
 
 class MenuComponent;
@@ -45,6 +48,7 @@
   virtual ~MenuItem() {}
   virtual void incr() =0;
   virtual void decr() =0;
+  virtual void click() =0;
   virtual void draw(const Rectf&amp; rect, bool is_active);
   virtual void update(float delta);
 };
@@ -67,6 +71,7 @@
 
   void incr();
   void decr();
+  void click() {}
   void draw(const Rectf&amp; rect, bool is_active);
   void update(float);
   Signal_v1&lt;int&gt;&amp; sig_change() { return on_change; }
@@ -86,11 +91,25 @@
                  const std::string&amp; label_, int value_, int mix_value_ = 0, int max_value_ = 100, int step = 10);
   void incr();
   void decr();
+  void click() {}
   void draw(const Rectf&amp; rect, bool is_active);
   void update(float);
   Signal_v1&lt;int&gt;&amp; sig_change() { return on_change; }
 };
 
+class ButtonMenuItem : public MenuItem {
+public:
+  Signal_v0 on_click;
+public:  
+  ButtonMenuItem(MenuComponent* parent_, const std::string&amp; label_);
+  void incr() {}
+  void decr() {}
+  void click();
+  void draw(const Rectf&amp; rect, bool is_active);
+  void update(float);
+  Signal_v0&amp; sig_click() { return on_click; }
+};
+
 /** */
 class MenuComponent : public Component
 {
@@ -98,7 +117,7 @@
   typedef std::vector&lt;MenuItem* &gt; Items;
   Items items;
   int   current_item;
-  
+  TTFFont* font;
 public:
   MenuComponent(const Rectf&amp; rect, Component* parent);
   virtual ~MenuComponent();
@@ -107,6 +126,8 @@
   void draw();
   void update(float delta, const Controller&amp; controller);
 
+  void     set_font(TTFFont* font_);
+  TTFFont* get_font();
 private:
   MenuComponent (const MenuComponent&amp;);
   MenuComponent&amp; operator= (const MenuComponent&amp;);

Modified: trunk/windstille/src/gui/tab_component.cpp
===================================================================
--- trunk/windstille/src/gui/tab_component.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/gui/tab_component.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -56,7 +56,7 @@
     {
       Rectf tab_rect(Vector(rect.left + tab_width * i + 10,
                             rect.top),
-                     Sizef(tab_width - 20, Fonts::ttfdialog-&gt;get_height() + 6));
+                     Sizef(tab_width - 20, Fonts::vera20-&gt;get_height() + 6));
 
       if (i == current_tab)
         Display::fill_rounded_rect(tab_rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
@@ -65,8 +65,8 @@
 
       Display::draw_rounded_rect(tab_rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
 
-      Fonts::ttfdialog-&gt;draw_center(rect.left + tab_width * i + tab_width/2,
-                                    rect.top + Fonts::ttfdialog-&gt;get_height(),
+      Fonts::vera20-&gt;draw_center(rect.left + tab_width * i + tab_width/2,
+                                    rect.top + Fonts::vera20-&gt;get_height(),
                                     tabs[i].label,
                                     tabs[current_tab].component-&gt;is_active()
                                     ? Color(1.0f, 1.0f, 1.0f, 0.5f) 
@@ -144,7 +144,7 @@
 
   int padding = 6;
   component-&gt;set_screen_rect(Rectf(rect.left + padding,
-                                   rect.top  + padding + Fonts::ttfdialog-&gt;get_height() + 10,
+                                   rect.top  + padding + Fonts::vera20-&gt;get_height() + 10,
                                    rect.right  - padding,
                                    rect.bottom - padding
                                    ));

Modified: trunk/windstille/src/inventory.cpp
===================================================================
--- trunk/windstille/src/inventory.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/inventory.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -109,7 +109,7 @@
       if (i == 0 &amp;&amp; moving == 0)
         {
           slothighlight.draw(draw_pos);
-          Fonts::ttfdialog-&gt;draw_center(draw_pos.x, draw_pos.y - 64, item.name);
+          Fonts::vera20-&gt;draw_center(draw_pos.x, draw_pos.y - 64, item.name);
         }
       else
         {

Modified: trunk/windstille/src/screen_manager.cpp
===================================================================
--- trunk/windstille/src/screen_manager.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/screen_manager.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -178,7 +178,7 @@
           if (event.key.state)
             {    
               switch (event.key.keysym.sym)
-                {       
+                {
                 case SDLK_F6:
                   SDL_ShowCursor(SDL_ENABLE);   // SDL_ENABLE to show the mouse cursor (default)
                   SDL_WM_GrabInput(SDL_GRAB_OFF); // SDL_GRAB_OFF to not grab input (default)
@@ -189,88 +189,6 @@
                   SDL_WM_GrabInput(SDL_GRAB_ON); // SDL_GRAB_OFF to not grab input (default)
                   break;
       
-                case SDLK_F8:
-                  {
-                    using namespace GUI;
-                    GUIManager* manager = new GUIManager();
-
-                    TabComponent* tab = new TabComponent(Rectf(100, 100, 700, 500), manager-&gt;get_root());
-
-                    GridComponent* grid = new GridComponent(Rectf(100, 130, 700, 500), 3, 4, tab);
-
-                    grid-&gt;pack(new Button(&quot;1&quot;, grid), 0, 0);
-                    grid-&gt;pack(new Button(&quot;2&quot;, grid), 1, 0);
-                    grid-&gt;pack(new Button(&quot;3&quot;, grid), 2, 0);
-
-                    grid-&gt;pack(new Slider(grid), 0, 1);
-                    //grid-&gt;pack(new Button(&quot;5&quot;, grid), 1, 1, 2, 2);
-                    TextView* text_view = new TextView(Rectf(), grid);
-                    grid-&gt;pack(text_view, 1, 1, 2, 2);
-
-                    //grid-&gt;pack(new Button(&quot;6&quot;, grid), 2, 1);
-
-                    grid-&gt;pack(new Button(&quot;7&quot;, grid), 0, 2, 1, 2);
-                    //grid-&gt;pack(new Button(&quot;8&quot;, grid), 1, 2);
-                    //grid-&gt;pack(new Button(&quot;9&quot;, grid), 2, 2);
-
-                    //grid-&gt;pack(new Button(&quot;Cl&quot;, grid), 0, 3);
-                    grid-&gt;pack(new Button(&quot;0&quot;,  grid), 1, 3);
-                    grid-&gt;pack(new Button(&quot;Ok&quot;, grid), 2, 3);
-
-                    // Begin Option Menu
-                    MenuComponent* menu = new MenuComponent(Rectf(100, 130, 700, 500), tab);
-
-                    SliderMenuItem* music_volume_item = new SliderMenuItem(menu, &quot;Music Volume&quot;, 100, 0, 100, 10);
-                    menu-&gt;add_item(music_volume_item);
-
-                    SliderMenuItem* sfx_volume_item = new SliderMenuItem(menu, &quot;Sound FX Volume&quot;, 100, 0, 100, 10);
-                    menu-&gt;add_item(sfx_volume_item);
-
-                    EnumMenuItem* fullscreen_item = new EnumMenuItem(menu, &quot;Fullscreen&quot;, 0);
-                    fullscreen_item-&gt;add_pair(1, &quot;on&quot;);
-                    fullscreen_item-&gt;add_pair(0, &quot;off&quot;);
-                    menu-&gt;add_item(fullscreen_item);
-
-                    EnumMenuItem* fps_item = new EnumMenuItem(menu, &quot;Display Frames per Second&quot;, 0);
-                    fps_item-&gt;add_pair(1, &quot;on&quot;);
-                    fps_item-&gt;add_pair(0, &quot;off&quot;);
-                    slots.push_back(fps_item-&gt;sig_change().connect(this, &amp;ScreenManager::show_fps));
-                    menu-&gt;add_item(fps_item);
-
-                    EnumMenuItem* aspect_item = new EnumMenuItem(menu, &quot;Aspect Ratio&quot;);
-                    aspect_item-&gt;add_pair(0, &quot;4:3&quot;);
-                    aspect_item-&gt;add_pair(1, &quot;16:9&quot;);
-                    aspect_item-&gt;add_pair(3, &quot;16:10&quot;);
-                    aspect_item-&gt;add_pair(2, &quot;letterbox&quot;);
-                    menu-&gt;add_item(aspect_item);
-
-                    tab-&gt;pack(&quot;Options&quot;, menu);
-                    // End: Option Menu
-
-                    tab-&gt;pack(&quot;Auto Map&quot;,  new Automap(Rectf(100, 130, 700, 500), tab));
-                    tab-&gt;pack(&quot;Grid Test&quot;, grid);
-
-                    ListView* list_view = new ListView(Rectf(), tab);
-                    list_view-&gt;add_column(&quot;Date&quot;);
-                    list_view-&gt;add_column(&quot;Name&quot;);
-                    list_view-&gt;add_column(&quot;Subject&quot;);
-
-                    list_view-&gt;add_item(ListView::Item(&quot;2005-10-08&quot;, &quot;John Doh&quot;, &quot;Re: Buying a goldmine&quot;));
-                    list_view-&gt;add_item(ListView::Item(&quot;2005-13-08&quot;, &quot;Jane Doh&quot;, &quot;Re: What the f***&quot;));
-                    list_view-&gt;add_item(ListView::Item(&quot;2005-13-09&quot;, &quot;Testo Test&quot;, &quot;Testing Email&quot;));
-
-                    tab-&gt;pack(&quot;ListView&quot;, list_view);
-
-                    manager-&gt;get_root()-&gt;set_child(tab);
-                    text_view-&gt;set_text(&quot;Hello World\n&lt;large&gt;Blabla&lt;/large&gt; more textt and more and&quot;
-                                        &quot;more for testing all for testing even more and more blabla blabla&quot;
-                                        &quot;more for testing all for testing even more and more blabla blabla&quot;
-                                        &quot;blabla blabla blabltest ende.&quot;);
-
-                    set_overlay(manager);
-                  }
-                  break;
-
                 case SDLK_F9:
                   set_overlay(new InputConfigurator());
                   break;
@@ -373,11 +291,24 @@
 void
 ScreenManager::set_overlay(Screen* s)
 {
+  // FIXME: need to delete overlay
   next_overlay_screen = s;
   has_next_overlay_screen = true;
 }
 
 void
+ScreenManager::push_overlay(Screen* s)
+{
+  assert(!&quot;Implement me&quot;);
+}
+
+void
+ScreenManager::pop_overlay()
+{
+  assert(!&quot;Implement me&quot;);
+}
+
+void
 ScreenManager::quit()
 {
   do_quit = true;
@@ -390,4 +321,29 @@
   config.set_bool(&quot;show-fps&quot;, i);
 }
 
+void
+ScreenManager::menu_start_game()
+{
+  set_overlay(0);
+}
+
+void
+ScreenManager::menu_options()
+{
+  console &lt;&lt; &quot;Options cliked&quot; &lt;&lt; std::endl;
+}
+
+void
+ScreenManager::menu_credits()
+{
+  console &lt;&lt; &quot;Credits clicked&quot; &lt;&lt; std::endl;
+}
+
+void
+ScreenManager::menu_quit()
+{
+  GameSession::current()-&gt;quit();
+  set_overlay(0);
+}
+
 /* EOF */

Modified: trunk/windstille/src/screen_manager.hpp
===================================================================
--- trunk/windstille/src/screen_manager.hpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/screen_manager.hpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -31,7 +31,10 @@
 
 class Screen;
 
-/** */
+/**
+ *  The ScreenManager handles overlays like Option Menus, Main Menus
+ *  and such
+ */
 class ScreenManager
 {
 private:
@@ -69,8 +72,19 @@
       the current overlay */
   void set_overlay(Screen* s);
   
-  // Callbacks
+  /** Replace the current overlay with a new one */
+  void push_overlay(Screen* s);
+
+  void pop_overlay();
+
+  // Callbacks, FIXME: Could be moved to a seperate class
   void show_fps(int i);
+
+  void menu_start_game();
+  void menu_options();
+  void menu_credits();
+  void menu_quit();
+
 private:
   void poll_events();
   void draw_fps();

Modified: trunk/windstille/src/text_area.cpp
===================================================================
--- trunk/windstille/src/text_area.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/text_area.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -60,7 +60,7 @@
 TextArea::TextArea(const Rectf&amp; rect, bool letter_by_letter)
   : impl(new TextAreaImpl)
 {
-  impl-&gt;font = Fonts::ttfdialog;
+  impl-&gt;font = Fonts::vera20;
   impl-&gt;rect    = rect;
   // FIXME: freetype might provide info for vspacing, not sure
   impl-&gt;v_space = 2;

Modified: trunk/windstille/src/windstille_main.cpp
===================================================================
--- trunk/windstille/src/windstille_main.cpp	2007-06-10 04:20:04 UTC (rev 1382)
+++ trunk/windstille/src/windstille_main.cpp	2007-06-10 23:04:41 UTC (rev 1383)
@@ -32,6 +32,7 @@
 #include &quot;windstille_main.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;game_session.hpp&quot;
+#include &quot;title_screen.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;
@@ -155,7 +156,8 @@
       {
         if (levelfile.empty())
           {
-            screen_manager.set_screen(new GameSession(&quot;levels/newformat2.wst&quot;));
+            //screen_manager.set_screen(new GameSession(&quot;levels/newformat2.wst&quot;));
+            screen_manager.set_screen(new TitleScreen());
           }
         else
           {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001035.html">[Windstille-commit] r1382 - in trunk/windstille/src: . gui
</A></li>
	<LI>Next message: <A HREF="001037.html">[Windstille-commit] r1384 - in trunk/windstille/data: . models	models/characters models/characters/bob	models/characters/jane models/characters/yagor models/objects	models/objects/barrobot models/objects/pistol models/vehicles	models/vehicles/train scripts scripts/apartment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1036">[ date ]</a>
              <a href="thread.html#1036">[ thread ]</a>
              <a href="subject.html#1036">[ subject ]</a>
              <a href="author.html#1036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
