<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1478 - in trunk/windstille: . src src/gui	src/input src/objects src/particles src/scripting src/sprite2d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2007-June/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1478%20-%20in%20trunk/windstille%3A%20.%20src%20src/gui%0A%09src/input%20src/objects%20src/particles%20src/scripting%20src/sprite2d&In-Reply-To=%3C200706200844.l5K8iiwO019917%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001129.html">
   <LINK REL="Next"  HREF="001131.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1478 - in trunk/windstille: . src src/gui	src/input src/objects src/particles src/scripting src/sprite2d</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1478%20-%20in%20trunk/windstille%3A%20.%20src%20src/gui%0A%09src/input%20src/objects%20src/particles%20src/scripting%20src/sprite2d&In-Reply-To=%3C200706200844.l5K8iiwO019917%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1478 - in trunk/windstille: . src src/gui	src/input src/objects src/particles src/scripting src/sprite2d">grumbel at mail.berlios.de
       </A><BR>
    <I>Wed Jun 20 10:44:44 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001129.html">[Windstille-commit] r1477 - in trunk/windstille: . data src	src/navigation
</A></li>
        <LI>Next message: <A HREF="001131.html">[Windstille-commit] r1479 - trunk/windstille/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1130">[ date ]</a>
              <a href="thread.html#1130">[ thread ]</a>
              <a href="subject.html#1130">[ subject ]</a>
              <a href="author.html#1130">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2007-06-20 10:44:42 +0200 (Wed, 20 Jun 2007)
New Revision: 1478

Removed:
   trunk/windstille/src/lisp_getters.cpp
   trunk/windstille/src/lisp_getters.hpp
Modified:
   trunk/windstille/TODO
   trunk/windstille/src/SConscript
   trunk/windstille/src/box.cpp
   trunk/windstille/src/box.hpp
   trunk/windstille/src/character.cpp
   trunk/windstille/src/character.hpp
   trunk/windstille/src/config.cpp
   trunk/windstille/src/elevator.cpp
   trunk/windstille/src/elevator.hpp
   trunk/windstille/src/file_reader.cpp
   trunk/windstille/src/file_reader.hpp
   trunk/windstille/src/file_reader_impl.hpp
   trunk/windstille/src/gui/automap.cpp
   trunk/windstille/src/gui/automap.hpp
   trunk/windstille/src/gui/button.cpp
   trunk/windstille/src/gui/button.hpp
   trunk/windstille/src/gui/component.hpp
   trunk/windstille/src/gui/component_factory.cpp
   trunk/windstille/src/gui/component_factory.hpp
   trunk/windstille/src/gui/grid_component.cpp
   trunk/windstille/src/gui/grid_component.hpp
   trunk/windstille/src/gui/tab_component.cpp
   trunk/windstille/src/gui/tab_component.hpp
   trunk/windstille/src/input/controller_description.cpp
   trunk/windstille/src/input/input_configurator.cpp
   trunk/windstille/src/input/input_configurator.hpp
   trunk/windstille/src/input/input_manager_sdl.cpp
   trunk/windstille/src/input/input_manager_sdl.hpp
   trunk/windstille/src/liquid.cpp
   trunk/windstille/src/liquid.hpp
   trunk/windstille/src/navigation_test.cpp
   trunk/windstille/src/objects/background_gradient.cpp
   trunk/windstille/src/objects/background_gradient.hpp
   trunk/windstille/src/objects/nightvision.hpp
   trunk/windstille/src/objects/test_object.cpp
   trunk/windstille/src/objects/test_object.hpp
   trunk/windstille/src/particle_viewer.cpp
   trunk/windstille/src/particles/particle_system.cpp
   trunk/windstille/src/particles/particle_system.hpp
   trunk/windstille/src/particles/spark_drawer.cpp
   trunk/windstille/src/particles/surface_drawer.cpp
   trunk/windstille/src/scriptable_object.cpp
   trunk/windstille/src/scriptable_object.hpp
   trunk/windstille/src/scripting/util.hpp
   trunk/windstille/src/sector.cpp
   trunk/windstille/src/sexpr_file_reader.cpp
   trunk/windstille/src/sprite2d/data.cpp
   trunk/windstille/src/sprite2d/data.hpp
   trunk/windstille/src/sprite2d/manager.cpp
   trunk/windstille/src/sprite2d/manager.hpp
   trunk/windstille/src/sprite2d/sprite.cpp
   trunk/windstille/src/sprite2d/sprite.hpp
   trunk/windstille/src/tile_description.cpp
   trunk/windstille/src/tile_factory.cpp
   trunk/windstille/src/tile_factory.hpp
   trunk/windstille/src/tile_map.cpp
   trunk/windstille/src/tile_map.hpp
   trunk/windstille/src/trigger.cpp
Log:
- replaced some more lisp::Lisp with FileReader

Modified: trunk/windstille/TODO
===================================================================
--- trunk/windstille/TODO	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/TODO	2007-06-20 08:44:42 UTC (rev 1478)
@@ -47,5 +47,6 @@
   and config done via option menu, i.e. command line settings
   shouldn't be persistent unless told so
 - add line numbers to error messages from lisp
+- fix memory leak in SExprFileReader
 
 # EOF #

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/SConscript	2007-06-20 08:44:42 UTC (rev 1478)
@@ -95,7 +95,6 @@
 'title_screen.cpp',
 'util.cpp',
 'view.cpp',
-'lisp_getters.cpp',
 'windstille_main.cpp',
 'objects/shockwave.cpp',
 'objects/test_object.cpp',

Modified: trunk/windstille/src/box.cpp
===================================================================
--- trunk/windstille/src/box.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/box.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -17,11 +17,9 @@
 //  along with this program; if not, write to the Free Software
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 
+#include &lt;stdexcept&gt;
 #include &quot;box.hpp&quot;
 #include &quot;globals.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 #include &quot;tile_map.hpp&quot;

Modified: trunk/windstille/src/box.hpp
===================================================================
--- trunk/windstille/src/box.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/box.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -21,7 +21,6 @@
 #define HEADER_WINDSTILLE_BOX_HXX
 
 #include &quot;entity.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;collision/collision_object.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;particles/particle_system.hpp&quot;

Modified: trunk/windstille/src/character.cpp
===================================================================
--- trunk/windstille/src/character.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/character.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,9 +26,7 @@
 #include &quot;physfs/physfs_stream.hpp&quot;
 #include &quot;console.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
 #include &quot;util.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 
 #include &lt;exception&gt;
 

Modified: trunk/windstille/src/character.hpp
===================================================================
--- trunk/windstille/src/character.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/character.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -22,7 +22,6 @@
 
 #include &quot;entity.hpp&quot;
 #include &quot;sprite3d/sprite3d.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 
 class Character : public Entity
 {

Modified: trunk/windstille/src/config.cpp
===================================================================
--- trunk/windstille/src/config.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/config.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -314,8 +314,7 @@
 Config::load()
 {
   try {
-    SExprFileReader reader(&quot;config&quot;);
-
+    FileReader reader = FileReader::parse(&quot;config&quot;);
     if(reader.get_name() != &quot;windstille-config&quot;) {
       std::cerr &lt;&lt; &quot;Warning: Config file is not a windstille-config file.\n&quot;;
       return;

Modified: trunk/windstille/src/elevator.cpp
===================================================================
--- trunk/windstille/src/elevator.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/elevator.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -22,12 +22,11 @@
 **  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 */
 
+#include &lt;stdexcept&gt;
 #include &quot;elevator.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 
 Elevator::Elevator(FileReader&amp; props)
 {

Modified: trunk/windstille/src/elevator.hpp
===================================================================
--- trunk/windstille/src/elevator.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/elevator.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -25,7 +25,6 @@
 #ifndef HEADER_ELEVATOR_HXX
 #define HEADER_ELEVATOR_HXX
 
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;entity.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 

Modified: trunk/windstille/src/file_reader.cpp
===================================================================
--- trunk/windstille/src/file_reader.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/file_reader.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -18,11 +18,15 @@
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 
 #include &quot;sexpr_file_reader.hpp&quot;
-#include &quot;lisp/parser.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;file_reader.hpp&quot;
 #include &quot;file_reader_impl.hpp&quot;
 
+FileReader
+FileReader::parse(const std::string&amp; filename)
+{
+  return SExprFileReader(filename);
+}
+
 FileReader::FileReader(SharedPtr&lt;FileReaderImpl&gt; impl_)
   : impl(impl_)
 {
@@ -115,6 +119,15 @@
 }
 
 bool
+FileReader::get(const char* name, std::vector&lt;std::string&gt;&amp; value) const
+{
+  if (impl.get())
+    return impl-&gt;get(name, value);
+  else
+    return false;
+}
+
+bool
 FileReader::get(const char* name, std::vector&lt;float&gt;&amp; value) const
 {
   if (impl.get())
@@ -167,21 +180,6 @@
   return reader;
 }
 
-FileReader
-FileReader::parse(const std::string&amp; filename)
-{
-  // FIXME: memory leak, somebody must delete the lisp::Lisp
-  lisp::Lisp* sexpr = lisp::Parser::parse(filename);
-  if (sexpr)
-    {
-      return SExprFileReader(sexpr-&gt;get_list_elem(0));
-    }
-  else
-    {
-      return FileReader();
-    }
-}
-
 void
 FileReader::print_unused_warnings(const std::string&amp; title)
 {

Modified: trunk/windstille/src/file_reader.hpp
===================================================================
--- trunk/windstille/src/file_reader.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/file_reader.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -37,6 +37,8 @@
 class FileReader
 {
 public:
+  static FileReader parse(const std::string&amp; filename);
+
   FileReader(SharedPtr&lt;FileReaderImpl&gt; impl_);
   FileReader();
 
@@ -70,6 +72,7 @@
 
   bool get(const char* name, std::vector&lt;int&gt;&amp;   v) const;
   bool get(const char* name, std::vector&lt;float&gt;&amp; v) const;
+  bool get(const char* name, std::vector&lt;std::string&gt;&amp; v) const;
 
   bool get(const char* name, FileReader&amp; v) { return read_section(name, v); }
   bool get(const char* name, int&amp;   v) { return read_int(name, v); }
@@ -84,8 +87,6 @@
   std::vector&lt;std::string&gt; get_section_names() const;
   std::vector&lt;FileReader&gt;  get_sections() const;
 
-  static FileReader parse(const std::string&amp; filename);
-
   void print_unused_warnings(const std::string&amp; title);
 
 private:

Modified: trunk/windstille/src/file_reader_impl.hpp
===================================================================
--- trunk/windstille/src/file_reader_impl.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/file_reader_impl.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -50,7 +50,7 @@
 
   virtual bool get(const char* name, std::vector&lt;int&gt;&amp;   v) const =0;
   virtual bool get(const char* name, std::vector&lt;float&gt;&amp; v) const =0;
-
+  virtual bool get(const char* name, std::vector&lt;std::string&gt;&amp; v) const =0;
   virtual bool read_section(const char* name, FileReader&amp;)   const =0;
   virtual std::vector&lt;FileReader&gt; get_sections() const =0;
   virtual std::vector&lt;std::string&gt; get_section_names() const =0;

Modified: trunk/windstille/src/gui/automap.cpp
===================================================================
--- trunk/windstille/src/gui/automap.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/automap.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -32,7 +32,7 @@
 
 namespace gui {
 
-Automap::Automap(const lisp::Lisp* lisp, Component* parent)
+Automap::Automap(FileReader&amp; reader, Component* parent)
   : Component(parent)
 {
   assert(0);

Modified: trunk/windstille/src/gui/automap.hpp
===================================================================
--- trunk/windstille/src/gui/automap.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/automap.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -40,7 +40,7 @@
   float   zoom;
 
 public:
-  Automap(const lisp::Lisp* lisp, Component* parent);
+  Automap(FileReader&amp; reader, Component* parent);
   Automap(const Rectf&amp; rect, Component* parent);
   ~Automap();
 

Modified: trunk/windstille/src/gui/button.cpp
===================================================================
--- trunk/windstille/src/gui/button.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/button.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,6 +23,7 @@
 **  02111-1307, USA.
 */
 
+#include &lt;assert.h&gt;
 #include &quot;display/display.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;input/controller.hpp&quot;
@@ -30,7 +31,7 @@
 
 namespace gui {
 
-Button::Button(const lisp::Lisp* lisp, Component* parent)
+Button::Button(FileReader&amp; reader, Component* parent)
   : Component(parent)
 {
   assert(0);

Modified: trunk/windstille/src/gui/button.hpp
===================================================================
--- trunk/windstille/src/gui/button.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/button.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -27,7 +27,6 @@
 #define HEADER_WINDSTILLE_GUI_BUTTON_HPP
 
 #include &lt;string&gt;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;component.hpp&quot;
 
 namespace gui {
@@ -39,7 +38,7 @@
   std::string label;
 
 public:
-  Button(const lisp::Lisp* lisp, Component* parent);
+  Button(FileReader&amp; reader, Component* parent);
   Button(const std::string&amp; label, Component* parent);
   ~Button();
 

Modified: trunk/windstille/src/gui/component.hpp
===================================================================
--- trunk/windstille/src/gui/component.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/component.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -28,6 +28,7 @@
 
 #include &quot;math/rect.hpp&quot;
 
+class FileReader;
 class Controller;
 
 namespace gui {

Modified: trunk/windstille/src/gui/component_factory.cpp
===================================================================
--- trunk/windstille/src/gui/component_factory.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/component_factory.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -41,23 +41,23 @@
 }
 
 Component*
-ComponentFactory::create(const std::string&amp; name, const lisp::Lisp* lisp, Component* parent)
+ComponentFactory::create(const std::string&amp; name, FileReader&amp; reader, Component* parent)
 {
   if (name == &quot;tab&quot;)
     {
-      return new TabComponent(lisp, parent);
+      return new TabComponent(reader, parent);
     }
   else if (name == &quot;automap&quot;)
     {
-      return new Automap(lisp, parent);
+      return new Automap(reader, parent);
     }
   else if (name == &quot;grid&quot;)
     {
-      return new GridComponent(lisp, parent);
+      return new GridComponent(reader, parent);
     }
   else if (name == &quot;button&quot;)
     {
-      return new Button(lisp, parent);
+      return new Button(reader, parent);
     }
   else
     {

Modified: trunk/windstille/src/gui/component_factory.hpp
===================================================================
--- trunk/windstille/src/gui/component_factory.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/component_factory.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -27,7 +27,6 @@
 #define HEADER_COMPONENT_FACTORY_HPP
 
 #include &lt;string&gt;
-#include &quot;lisp/lisp.hpp&quot;
 
 namespace gui {
 
@@ -41,7 +40,7 @@
   ComponentFactory();
   ~ComponentFactory();
 
-  Component* create(const std::string&amp; name, const lisp::Lisp* lisp, Component* parent);
+  Component* create(const std::string&amp; name, FileReader&amp; reader, Component* parent);
   
 private:
   ComponentFactory (const ComponentFactory&amp;);

Modified: trunk/windstille/src/gui/grid_component.cpp
===================================================================
--- trunk/windstille/src/gui/grid_component.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/grid_component.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -30,7 +30,7 @@
 
 namespace gui {
 
-GridComponent::GridComponent(const lisp::Lisp* lisp, Component* parent)
+GridComponent::GridComponent(FileReader&amp; reader, Component* parent)
   : Component(parent)
 {
   assert(0);  

Modified: trunk/windstille/src/gui/grid_component.hpp
===================================================================
--- trunk/windstille/src/gui/grid_component.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/grid_component.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,7 +26,6 @@
 #ifndef HEADER_WINDSTILLE_GUI_GRID_COMPONENT_HPP
 #define HEADER_WINDSTILLE_GUI_GRID_COMPONENT_HPP
 
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;field.hpp&quot;
 #include &quot;component.hpp&quot;
 
@@ -61,7 +60,7 @@
   float padding;
 
 public:
-  GridComponent(const lisp::Lisp* lisp, Component* parent);
+  GridComponent(FileReader&amp; reader, Component* parent);
   GridComponent(const Rectf&amp; rect, int weight, int height, Component* parent);
   ~GridComponent();
   

Modified: trunk/windstille/src/gui/tab_component.cpp
===================================================================
--- trunk/windstille/src/gui/tab_component.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/tab_component.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,6 +23,7 @@
 **  02111-1307, USA.
 */
 
+#include &lt;assert.h&gt;
 #include &quot;input/controller.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;display/display.hpp&quot;
@@ -30,7 +31,7 @@
 
 namespace gui {
 
-TabComponent::TabComponent(const lisp::Lisp* lisp, Component* parent)
+TabComponent::TabComponent(FileReader&amp; reader, Component* parent)
   : Component(parent)
 {
   assert(0);

Modified: trunk/windstille/src/gui/tab_component.hpp
===================================================================
--- trunk/windstille/src/gui/tab_component.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/gui/tab_component.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -28,7 +28,6 @@
 
 #include &lt;string&gt;
 #include &lt;vector&gt;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;component.hpp&quot;
 
 namespace gui {
@@ -54,7 +53,7 @@
   int current_tab;
 
 public:
-  TabComponent(const lisp::Lisp* lisp, Component* parent);
+  TabComponent(FileReader&amp; reader, Component* parent);
   TabComponent(const Rectf&amp; rect, Component* parent);
   ~TabComponent();
 

Modified: trunk/windstille/src/input/controller_description.cpp
===================================================================
--- trunk/windstille/src/input/controller_description.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/input/controller_description.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -89,7 +89,7 @@
 {
   std::map&lt;std::string, InputEventDefinition&gt;::const_iterator i = str_to_event.find(name);
   if (i == str_to_event.end())
-    throw std::runtime_error(&quot;Unknown event str&quot;);
+    throw std::runtime_error(&quot;Unknown event str: &quot; + name);
 
   return i-&gt;second;
 }

Modified: trunk/windstille/src/input/input_configurator.cpp
===================================================================
--- trunk/windstille/src/input/input_configurator.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/input/input_configurator.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,6 +23,8 @@
 **  02111-1307, USA.
 */
 
+#include &lt;iostream&gt;
+#include &lt;stdexcept&gt;
 #include &quot;display/display.hpp&quot;
 #include &quot;math/rect.hpp&quot;
 #include &quot;controller_def.hpp&quot;

Modified: trunk/windstille/src/input/input_configurator.hpp
===================================================================
--- trunk/windstille/src/input/input_configurator.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/input/input_configurator.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,6 +26,7 @@
 #ifndef HEADER_INPUT_CONFIGURATOR_HPP
 #define HEADER_INPUT_CONFIGURATOR_HPP
 
+#include &lt;sstream&gt;
 #include &quot;screen.hpp&quot;
 #include &quot;text_area.hpp&quot;
 

Modified: trunk/windstille/src/input/input_manager_sdl.cpp
===================================================================
--- trunk/windstille/src/input/input_manager_sdl.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/input/input_manager_sdl.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -5,7 +5,7 @@
 **   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
 **    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
 **         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**  Copyright (C) 2005,2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
 **
 **  This program is free software; you can redistribute it and/or
 **  modify it under the terms of the GNU General Public License
@@ -24,11 +24,10 @@
 */
 
 #include &lt;iostream&gt;
+#include &lt;sstream&gt;
+#include &lt;stdexcept&gt;
 #include &lt;vector&gt;
-#include &quot;lisp/parser.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp/property_iterator.hpp&quot;
+#include &quot;file_reader.hpp&quot;
 #include &quot;controller_def.hpp&quot;
 #include &quot;input_manager_sdl.hpp&quot;
 
@@ -96,105 +95,94 @@
 void
 InputManagerSDL::load(const std::string&amp; filename)
 {
-  std::auto_ptr&lt;lisp::Lisp&gt; root (lisp::Parser::parse(filename));
-  lisp::Properties rootp(root.get());
+  FileReader reader = FileReader::parse(filename);
 
   std::cout &lt;&lt; &quot;InputManager: &quot; &lt;&lt; filename &lt;&lt; std::endl;
 
-  const lisp::Lisp* controller = 0;
-  if(rootp.get(&quot;windstille-controller&quot;, controller) == false) {
+  if (reader.get_name() != &quot;windstille-controller&quot;) {
     std::ostringstream msg;
     msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille-controller file&quot;;
     throw std::runtime_error(msg.str());
   }
   
-  parse_config(controller);
+  parse_config(reader);
 }
 
 void
-InputManagerSDL::parse_config(const lisp::Lisp* lisp)
+InputManagerSDL::parse_config(FileReader&amp; reader)
 {
-  lisp::Properties cur(lisp);
-  lisp::PropertyIterator&lt;const lisp::Lisp*&gt; iter = cur.get_iter();
-
-  while(iter.next()) 
+  std::vector&lt;FileReader&gt; sections = reader.get_sections();
+  
+  for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
     {
-      if (has_suffix(iter.item(), &quot;-button&quot;))
+      if (has_suffix(i-&gt;get_name(), &quot;-button&quot;))
         {
-          lisp::Properties dev_prop(*iter);
-          lisp::PropertyIterator&lt;const lisp::Lisp*&gt; dev_iter = dev_prop.get_iter();
-          while(dev_iter.next())
+          std::vector&lt;FileReader&gt; dev_sections = i-&gt;get_sections();
+          for(std::vector&lt;FileReader&gt;::iterator j = dev_sections.begin(); j != dev_sections.end(); ++j)
             {
-              if (dev_iter.item() == &quot;joystick-button&quot;)
+              if (j-&gt;get_name() == &quot;joystick-button&quot;)
                 {
                   int device = 0;
                   int button = 0;
 
-                  lisp::Properties props(*dev_iter);
-                  props.get(&quot;device&quot;, device);
-                  props.get(&quot;button&quot;, button);
+                  j-&gt;get(&quot;device&quot;, device);
+                  j-&gt;get(&quot;button&quot;, button);
 
-                  bind_joystick_button(controller_description.get_definition(iter.item()).id,
+                  bind_joystick_button(controller_description.get_definition(i-&gt;get_name()).id,
                                        device, button);
                 }
-              else if (dev_iter.item() == &quot;keyboard-button&quot;)
+              else if (j-&gt;get_name() == &quot;keyboard-button&quot;)
                 {
                   std::string key;
 
-                  lisp::Properties props(*dev_iter);
-                  props.get(&quot;key&quot;, key);
+                  j-&gt;get(&quot;key&quot;, key);
 
-                  bind_keyboard_button(controller_description.get_definition(iter.item()).id,
+                  bind_keyboard_button(controller_description.get_definition(i-&gt;get_name()).id,
                                        string_to_keyid(key));
                 }
               else
                 {
-                  std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; dev_iter.item() &lt;&lt; std::endl;
+                  std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; j-&gt;get_name() &lt;&lt; std::endl;
                 }
             }
         }
-      else if (has_suffix(iter.item(), &quot;-axis&quot;))
+      else if (has_suffix(i-&gt;get_name(), &quot;-axis&quot;))
         {
-          lisp::Properties dev_prop(*iter);
-          lisp::PropertyIterator&lt;const lisp::Lisp*&gt; dev_iter = dev_prop.get_iter();
-
-          while(dev_iter.next())
+          std::vector&lt;FileReader&gt; dev_sections = i-&gt;get_sections();
+          for(std::vector&lt;FileReader&gt;::iterator j = dev_sections.begin(); j != dev_sections.end(); ++j)
             {
-              if (dev_iter.item() == &quot;joystick-axis&quot;)
+              if (j-&gt;get_name() == &quot;joystick-axis&quot;)
                 {
-                  int device = 0;
-                  int axis   = 0;
+                  int  device = 0;
+                  int  axis   = 0;
                   bool invert = false;
 
-                  lisp::Properties props(*dev_iter);
-                  props.get(&quot;device&quot;, device);
-                  props.get(&quot;axis&quot;,   axis);
-                  props.get(&quot;invert&quot;, invert);
+                  j-&gt;get(&quot;device&quot;, device);
+                  j-&gt;get(&quot;axis&quot;,   axis);
+                  j-&gt;get(&quot;invert&quot;, invert);
 
-                  bind_joystick_axis(controller_description.get_definition(iter.item()).id,
+                  bind_joystick_axis(controller_description.get_definition(i-&gt;get_name()).id,
                                      device, axis, invert);
                 }
-              else if (dev_iter.item() == &quot;keyboard-axis&quot;)
+              else if (j-&gt;get_name() == &quot;keyboard-axis&quot;)
                 {
                   std::string minus;
                   std::string plus;
 
-                  lisp::Properties props(*dev_iter);
-                  props.get(&quot;minus&quot;, minus);
-                  props.get(&quot;plus&quot;,  plus);
+                  j-&gt;get(&quot;minus&quot;, minus);
+                  j-&gt;get(&quot;plus&quot;,  plus);
 
-                  bind_keyboard_axis(controller_description.get_definition(iter.item()).id, 
+                  bind_keyboard_axis(controller_description.get_definition(i-&gt;get_name()).id, 
                                      string_to_keyid(minus), string_to_keyid(plus));
                 }
               else
                 {
-                  std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; dev_iter.item() &lt;&lt; std::endl;
+                  std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; j-&gt;get_name() &lt;&lt; std::endl;
                 }
             }
 
         }
     }
-
 }
 
 InputManagerSDL::InputManagerSDL()

Modified: trunk/windstille/src/input/input_manager_sdl.hpp
===================================================================
--- trunk/windstille/src/input/input_manager_sdl.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/input/input_manager_sdl.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -5,7 +5,7 @@
 **   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
 **    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
 **         \/          \/      \/    \/                         \/
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**  Copyright (C) 2005,2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
 **
 **  This program is free software; you can redistribute it and/or
 **  modify it under the terms of the GNU General Public License
@@ -28,8 +28,8 @@
 
 #include &lt;SDL.h&gt;
 #include &quot;input_manager_impl.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 
+class FileReader;
 class InputManagerSDLImpl;
 
 struct JoystickButtonBinding
@@ -126,7 +126,7 @@
   /** Ensure that the joystick device \a device is open */
   void ensure_open_joystick(int device);
 
-  void parse_config(const lisp::Lisp* lisp);
+  void parse_config(FileReader&amp; reader);
 
   std::auto_ptr&lt;InputManagerSDLImpl&gt; impl;
 

Modified: trunk/windstille/src/liquid.cpp
===================================================================
--- trunk/windstille/src/liquid.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/liquid.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,8 +23,6 @@
 **  02111-1307, USA.
 */
 
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;random.hpp&quot;
 #include &quot;liquid.hpp&quot;

Modified: trunk/windstille/src/liquid.hpp
===================================================================
--- trunk/windstille/src/liquid.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/liquid.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -27,7 +27,6 @@
 #define HEADER_WINDSTILLE_LIQUID_HPP
 
 #include &lt;vector&gt;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;entity.hpp&quot;
 
 /** */

Deleted: trunk/windstille/src/lisp_getters.cpp
===================================================================
--- trunk/windstille/src/lisp_getters.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/lisp_getters.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,65 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2000,2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-
-#include &quot;lisp/lisp.hpp&quot;
-#include &quot;lisp/getters.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
-#include &quot;math/vector.hpp&quot;
-#include &quot;color.hpp&quot;
-
-namespace lisp
-{
-
-bool property_get(const lisp::Lisp* lisp, Color&amp; color)
-{
-  std::vector&lt;float&gt; col;
-  if(property_get(lisp, col) == false)
-    return false;
-  if(col.size() == 3)
-    color = Color(col[0], col[1], col[2]);
-  else if(col.size() == 4)
-    color = Color(col[0], col[1], col[2], col[3]);
-  else
-    return false;
-  
-  return true;
-}
-
-bool property_get(const lisp::Lisp* lisp, Vector&amp; vec)
-{
-  size_t size = lisp-&gt;get_list_size();
-  if(size != 4 &amp;&amp; size != 3)
-    return false;
-  if(get(lisp-&gt;get_list_elem(1), vec.x) == false)
-    return false;
-  if(get(lisp-&gt;get_list_elem(2), vec.y) == false)
-    return false;
-  return true;
-}
-
-}
-
-/* EOF */

Deleted: trunk/windstille/src/lisp_getters.hpp
===================================================================
--- trunk/windstille/src/lisp_getters.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/lisp_getters.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,42 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2000,2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef __WINDSTILLE_GETTERS_HPP__
-#define __WINDSTILLE_GETTERS_HPP__
-
-#include &quot;math/vector.hpp&quot;
-
-class Color;
-
-namespace lisp
-{
-
-bool property_get(const lisp::Lisp* lisp, Color&amp; col);
-bool property_get(const lisp::Lisp* lisp, Vector&amp; vec);
-
-}
-
-#endif
-

Modified: trunk/windstille/src/navigation_test.cpp
===================================================================
--- trunk/windstille/src/navigation_test.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/navigation_test.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -49,7 +49,7 @@
   graph = new NavigationGraph();
 
   try {
-    SExprFileReader reader(&quot;navigation.nav&quot;);
+    FileReader reader = FileReader::parse(&quot;navigation.nav&quot;);
     graph-&gt;load(reader);
   } catch(std::exception&amp; err) {
     std::cout &lt;&lt; &quot;NavigationTest: &quot; &lt;&lt; err.what() &lt;&lt; std::endl;

Modified: trunk/windstille/src/objects/background_gradient.cpp
===================================================================
--- trunk/windstille/src/objects/background_gradient.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/objects/background_gradient.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,6 +23,7 @@
 **  02111-1307, USA.
 */
 
+#include &lt;iostream&gt;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;background_gradient.hpp&quot;
 

Modified: trunk/windstille/src/objects/background_gradient.hpp
===================================================================
--- trunk/windstille/src/objects/background_gradient.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/objects/background_gradient.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,7 +26,6 @@
 #ifndef HEADER_BACKGROUND_GRADIENT_HPP
 #define HEADER_BACKGROUND_GRADIENT_HPP
 
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;game_object.hpp&quot;
 
 /** */

Modified: trunk/windstille/src/objects/nightvision.hpp
===================================================================
--- trunk/windstille/src/objects/nightvision.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/objects/nightvision.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,7 +26,6 @@
 #ifndef HEADER_NIGHTVISION_HPP
 #define HEADER_NIGHTVISION_HPP
 
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;display/texture.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 #include &quot;game_object.hpp&quot;

Modified: trunk/windstille/src/objects/test_object.cpp
===================================================================
--- trunk/windstille/src/objects/test_object.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/objects/test_object.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,5 @@
+#include &lt;iostream&gt;
+#include &lt;stdexcept&gt;
 #include &lt;config.h&gt;
 
 #include &quot;test_object.hpp&quot;
@@ -2,8 +4,5 @@
 #include &quot;sprite3d/manager.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 
 TestObject::TestObject(FileReader&amp; props)
 {
-  using namespace lisp;
   pos = Vector(0, 0);

Modified: trunk/windstille/src/objects/test_object.hpp
===================================================================
--- trunk/windstille/src/objects/test_object.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/objects/test_object.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -5,7 +5,6 @@
 #include &quot;game_object.hpp&quot;
 #include &quot;sprite3d/sprite3d.hpp&quot;
 #include &quot;math/vector.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 
 class TestObject : public GameObject
 {

Modified: trunk/windstille/src/particle_viewer.cpp
===================================================================
--- trunk/windstille/src/particle_viewer.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/particle_viewer.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,8 +23,6 @@
 **  02111-1307, USA.
 */
 
-#include &quot;lisp/lisp.hpp&quot;
-#include &quot;lisp/parser.hpp&quot;
 #include &quot;sexpr_file_reader.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
@@ -117,7 +115,7 @@
     delete *i;
   systems.clear();
   
-  SExprFileReader root_reader(filename);
+  FileReader root_reader = FileReader::parse(filename);
   if(root_reader.get_name() != &quot;particle-systems&quot;) {
     std::ostringstream msg;
     msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a particle-system file&quot;;

Modified: trunk/windstille/src/particles/particle_system.cpp
===================================================================
--- trunk/windstille/src/particles/particle_system.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/particles/particle_system.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -29,9 +29,6 @@
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 #include &quot;color.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp/property_iterator.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;file_reader.hpp&quot;
 #include &quot;spark_drawer.hpp&quot;
 #include &quot;deform_drawer.hpp&quot;

Modified: trunk/windstille/src/particles/particle_system.hpp
===================================================================
--- trunk/windstille/src/particles/particle_system.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/particles/particle_system.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -30,7 +30,6 @@
 
 #include &quot;color.hpp&quot;
 #include &quot;drawer.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;entity.hpp&quot;
 
 class SceneContext;

Modified: trunk/windstille/src/particles/spark_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/spark_drawer.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/particles/spark_drawer.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,8 +26,6 @@
 #include &quot;display/drawing_request.hpp&quot;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;particle_system.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;color.hpp&quot;
 #include &quot;spark_drawer.hpp&quot;
 

Modified: trunk/windstille/src/particles/surface_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/surface_drawer.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/particles/surface_drawer.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,7 +26,6 @@
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;particle_system.hpp&quot;
 #include &quot;../console.hpp&quot; 
-#include &quot;lisp/properties.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
 #include &quot;surface_drawer.hpp&quot;
 

Modified: trunk/windstille/src/scriptable_object.cpp
===================================================================
--- trunk/windstille/src/scriptable_object.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/scriptable_object.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -26,8 +26,6 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;scriptable_object.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 #include &quot;script_manager.hpp&quot;
 

Modified: trunk/windstille/src/scriptable_object.hpp
===================================================================
--- trunk/windstille/src/scriptable_object.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/scriptable_object.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -29,7 +29,6 @@
 
 #include &lt;string&gt;
 #include &quot;entity.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 
 /** Can represent any generic object that the player may see or interact with that

Modified: trunk/windstille/src/scripting/util.hpp
===================================================================
--- trunk/windstille/src/scripting/util.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/scripting/util.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -31,6 +31,7 @@
 
 namespace lisp {
 class Writer;
+class Lisp;
 };
 
 namespace Scripting {

Modified: trunk/windstille/src/sector.cpp
===================================================================
--- trunk/windstille/src/sector.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sector.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -20,9 +20,6 @@
 #include &lt;iostream&gt;
 #include &lt;sstream&gt;
 #include &lt;stdexcept&gt;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp/parser.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;sexpr_file_reader.hpp&quot;
 #include &quot;globals.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
@@ -106,9 +103,8 @@
 Sector::parse_file(const std::string&amp; filename)
 {
   if (debug) std::cout &lt;&lt; &quot;Sector:parse_file '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-  using namespace lisp;
   
-  SExprFileReader reader(filename);
+  FileReader reader = FileReader::parse(filename);
   if(reader.get_name() != &quot;windstille-sector&quot;) {
     std::ostringstream msg;
     msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille-sector file&quot;;

Modified: trunk/windstille/src/sexpr_file_reader.cpp
===================================================================
--- trunk/windstille/src/sexpr_file_reader.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sexpr_file_reader.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -46,12 +46,6 @@
     assert(sexpr &amp;&amp; 
            sexpr-&gt;get_type() == lisp::Lisp::TYPE_LIST &amp;&amp;
            sexpr-&gt;get_list_size() &gt;= 1);
-    
-    // FIXME: I don't think this is good for anything
-    // for(size_t i = 1; i &lt; sexpr-&gt;get_list_size(); ++i)
-    // { // iterate over subsections
-    //  sexpr-&gt;get_list_elem(i);
-    // }
   }
 
   ~SExprFileReaderImpl()
@@ -210,6 +204,15 @@
       return false;
   }
 
+  bool get(const char* name, std::vector&lt;std::string&gt;&amp;   v) const
+  {
+    lisp::Lisp* sub = get_subsection(name);
+    if (sub)
+      return property_get(sub, v);
+    else 
+      return false;
+  }
+
   bool get(const char* name, std::vector&lt;float&gt;&amp; v) const
   {
     lisp::Lisp* sub = get_subsection(name);
@@ -293,6 +296,7 @@
     }
   else if (sexpr &amp;&amp; sexpr-&gt;get_type() == lisp::Lisp::TYPE_LIST &amp;&amp; sexpr-&gt;get_list_size() &gt;= 1)
     {
+      // FIXME: Memory leak! We are only cleaning up a subset of the whole lisp objects
       return sexpr-&gt;get_list_elem(0);
     }
   else

Modified: trunk/windstille/src/sprite2d/data.cpp
===================================================================
--- trunk/windstille/src/sprite2d/data.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sprite2d/data.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,29 @@
+/*  $Id: windstille.hpp 1460 2007-06-18 04:03:31Z grumbel $
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005,2007 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;,
+**                          Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
 #include &lt;config.h&gt;
 
 #include &quot;sprite2d/data.hpp&quot;
@@ -8,10 +34,6 @@
 #include &lt;sstream&gt;
 #include &lt;stdexcept&gt;
 #include &quot;util.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
-#include &quot;lisp/parser.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
-#include &quot;lisp_getters.hpp&quot;
 #include &quot;display/surface.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
 
@@ -39,17 +61,16 @@
     {
       if (has_suffix(filename, &quot;.sprite&quot;))
         {
-          std::auto_ptr&lt;lisp::Lisp&gt; root (lisp::Parser::parse(filename));
-          lisp::Properties rootp(root.get());
-          const lisp::Lisp* sprite = 0;
-          if(rootp.get(&quot;sprite&quot;, sprite) == false) {
+          FileReader reader = FileReader::parse(filename);
+
+          if(reader.get_name() != &quot;sprite&quot;) {
             std::ostringstream msg;
             msg &lt;&lt; &quot;File '&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille sprite&quot;;
             throw std::runtime_error(msg.str());
           }
     
           std::string dir = dirname(filename);
-          parse(dir, sprite);
+          parse(dir, reader);
         }
       else if (has_suffix(tolowercase(filename), &quot;.png&quot;) || has_suffix(tolowercase(filename), &quot;.jpg&quot;))
         {
@@ -106,41 +127,59 @@
 }
 
 void
-Data::parse(const std::string&amp; dir, const lisp::Lisp* lisp)
+Data::parse(const std::string&amp; dir, FileReader&amp; reader)
 {
-  lisp::Properties props(lisp);
-  lisp::PropertyIterator&lt;const lisp::Lisp*&gt; iter;
-  props.get_iter(&quot;action&quot;, iter);
-  while(iter.next()) {
-    actions.push_back(parse_action(dir, *iter));
-  }
-  props.print_unused_warnings(&quot;sprite&quot;);
-
+  std::vector&lt;FileReader&gt; sections = reader.get_sections();
+  for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+    actions.push_back(parse_action(dir, *i));
+  
   if(actions.size() == 0)
     throw std::runtime_error(&quot;Sprite contains no actions&quot;);
 }
 
 Action*
-Data::parse_action(const std::string&amp; dir, const lisp::Lisp* lisp)
+Data::parse_action(const std::string&amp; dir, FileReader&amp; reader)
 {
   std::auto_ptr&lt;Action&gt; action (new Action);
   action-&gt;speed = 1.0;
   action-&gt;scale = 1.0f;
   action-&gt;offset = Vector(0, 0);
  
-  lisp::Properties props(lisp);
-  props.get(&quot;name&quot;, action-&gt;name);
-  props.get(&quot;speed&quot;, action-&gt;speed);
-  props.get(&quot;scale&quot;, action-&gt;scale);
-  props.get(&quot;offset&quot;, action-&gt;offset);
+  reader.get(&quot;name&quot;, action-&gt;name);
+  reader.get(&quot;speed&quot;, action-&gt;speed);
+  reader.get(&quot;scale&quot;, action-&gt;scale);
+  reader.get(&quot;offset&quot;, action-&gt;offset);
   
-  const lisp::Lisp* ilisp = 0;
-  if(props.get(&quot;images&quot;, ilisp)) {
-    parse_images(action.get(), dir, ilisp);
-  } else if(props.get(&quot;image-grid&quot;, ilisp)) {
-    parse_image_grid(action.get(), dir, ilisp);
-  }
-  props.print_unused_warnings(&quot;sprite action&quot;);
+  FileReader grid_reader;
+  std::vector&lt;std::string&gt; image_files;
+  if(reader.get(&quot;images&quot;, image_files))
+    {
+      //parse_images(action.get(), dir, images);
+
+      for(std::vector&lt;std::string&gt;::iterator file = image_files.begin(); file != image_files.end(); ++file)
+        {
+          action-&gt;surfaces.push_back(surface_manager-&gt;get(dir + &quot;/&quot; + *file));
+        }
+    }
+  else if(reader.get(&quot;image-grid&quot;, grid_reader)) 
+    {
+      std::string filename;
+      int x_size = -1;
+      int y_size = -1;
+      
+      grid_reader.get(&quot;file&quot;, filename);
+      grid_reader.get(&quot;x-size&quot;, x_size);
+      grid_reader.get(&quot;y-size&quot;, y_size);
+
+      grid_reader.print_unused_warnings(&quot;action image-grid&quot;);
+
+      if(filename == &quot;&quot; || x_size &lt;= 0 || y_size &lt;= 0)
+        throw std::runtime_error(&quot;Invalid or too few data in image-grid&quot;);
+      
+      surface_manager-&gt;load_grid(dir + &quot;/&quot; + filename,
+                                 action-&gt;surfaces, x_size, y_size);
+    }
+  reader.print_unused_warnings(&quot;sprite action&quot;);
   
   if(action-&gt;name == &quot;&quot;)
     throw std::runtime_error(&quot;No Name defined for action&quot;);
@@ -154,36 +193,16 @@
 
 void
 Data::parse_images(Action* action, const std::string&amp; dir,
-                   const lisp::Lisp* lisp)
+                   FileReader&amp; reader)
 {
-  for(size_t n = 1; n &lt; lisp-&gt;get_list_size(); ++n) {
-    std::string file = lisp-&gt;get_list_elem(n)-&gt;get_string();
-    Surface surface = surface_manager-&gt;get(dir + &quot;/&quot; + file);
-    action-&gt;surfaces.push_back(surface);
-  }
+
 }
 
 void
 Data::parse_image_grid(Action* action, const std::string&amp; dir,
-                       const lisp::Lisp* lisp)
+                       FileReader&amp; reader)
 {
-  std::string filename;
-  int x_size = -1;
-  int y_size = -1;
- 
-  lisp::Properties props(lisp);
 
-  props.get(&quot;file&quot;, filename);
-  props.get(&quot;x-size&quot;, x_size);
-  props.get(&quot;y-size&quot;, y_size);
-
-  props.print_unused_warnings(&quot;action image-grid&quot;);
-
-  if(filename == &quot;&quot; || x_size &lt;= 0 || y_size &lt;= 0)
-    throw std::runtime_error(&quot;Invalid or too few data in image-grid&quot;);
-
-  surface_manager-&gt;load_grid(dir + &quot;/&quot; + filename,
-                             action-&gt;surfaces, x_size, y_size);
 }
  
 } // namespace sprite2d

Modified: trunk/windstille/src/sprite2d/data.hpp
===================================================================
--- trunk/windstille/src/sprite2d/data.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sprite2d/data.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,29 @@
+/*  $Id: windstille.hpp 1460 2007-06-18 04:03:31Z grumbel $
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005,2007 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;,
+**                          Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
 #ifndef __SPRITE_DATA_HPP__
 #define __SPRITE_DATA_HPP__
 
@@ -5,9 +31,9 @@
 #include &lt;vector&gt;
 #include &lt;GL/glew.h&gt;
 #include &lt;GL/gl.h&gt;
+#include &quot;file_reader.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 #include &quot;display/surface.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;ref.hpp&quot;
 
 namespace sprite2d
@@ -16,21 +42,21 @@
 
 class Data
 {
+private:
+  void parse(const std::string&amp; dir, FileReader&amp; lisp);
+  
+  Action* parse_action(const std::string&amp; dir, FileReader&amp; reader);
+  void parse_images(Action* action, const std::string&amp; dir, 
+                    FileReader&amp; reader);
+  void parse_image_grid(Action* action, const std::string&amp; dir,
+                        FileReader&amp; reader); 
+
 public:
   Data(const std::string&amp; filename);
   virtual ~Data();
 
   typedef std::vector&lt;Action*&gt; Actions;
   Actions actions;
-
-private:
-  void parse(const std::string&amp; dir, const lisp::Lisp* lisp);
-  
-  Action* parse_action(const std::string&amp; dir, const lisp::Lisp* lisp);
-  void parse_images(Action* action, const std::string&amp; dir, 
-                    const lisp::Lisp* lisp);
-  void parse_image_grid(Action* action, const std::string&amp; dir,
-                        const lisp::Lisp* lisp); 
 };
 
 struct Action

Modified: trunk/windstille/src/sprite2d/manager.cpp
===================================================================
--- trunk/windstille/src/sprite2d/manager.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sprite2d/manager.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,29 @@
+/*  $Id: windstille.hpp 1460 2007-06-18 04:03:31Z grumbel $
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005,2007 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;,
+**                          Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
 #include &lt;config.h&gt;
 
 #include &quot;sprite2d/manager.hpp&quot;

Modified: trunk/windstille/src/sprite2d/manager.hpp
===================================================================
--- trunk/windstille/src/sprite2d/manager.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sprite2d/manager.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,29 @@
+/*  $Id: windstille.hpp 1460 2007-06-18 04:03:31Z grumbel $
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005,2007 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;,
+**                          Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
 #ifndef __SPRITE2D_MANAGER_HPP__
 #define __SPRITE2D_MANAGER_HPP__
 

Modified: trunk/windstille/src/sprite2d/sprite.cpp
===================================================================
--- trunk/windstille/src/sprite2d/sprite.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sprite2d/sprite.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,28 @@
+/*  $Id: windstille.hpp 1460 2007-06-18 04:03:31Z grumbel $
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005,2007 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;,
+**                          Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
 
 #include &quot;sprite2d/sprite.hpp&quot;
 

Modified: trunk/windstille/src/sprite2d/sprite.hpp
===================================================================
--- trunk/windstille/src/sprite2d/sprite.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/sprite2d/sprite.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -1,3 +1,29 @@
+/*  $Id: windstille.hpp 1460 2007-06-18 04:03:31Z grumbel $
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005,2007 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;,
+**                          Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
 #ifndef __SPRITE2D_SPRITE_HPP__
 #define __SPRITE2D_SPRITE_HPP__
 
@@ -19,6 +45,24 @@
 
 class Sprite
 {
+private:
+  /** Pointer to the Sprites data which is shared among all sprites
+      with are loaded from the same file */
+  sprite2d::DataPtr data;
+  const sprite2d::Action* current_action;
+
+  float frame;
+  float speed;
+  float alpha;
+
+  bool   pingpong;
+  bool   reverse;
+  bool   vflip;
+  GLenum blend_sfactor;
+  GLenum blend_dfactor;
+  float  scale;
+  Color  color;
+
 public:
   Sprite();
 
@@ -49,7 +93,7 @@
   
   bool is_finished() const;
 
-  void set_blend_func(GLenum sfactor, GLenum dfactor);
+  void   set_blend_func(GLenum sfactor, GLenum dfactor);
   GLenum get_blend_sfactor() const;
   GLenum get_blend_dfactor() const;
 
@@ -68,24 +112,6 @@
 
   /** true if the Sprite is valid and usable, false if not */
   operator bool() const;
-
-private:
-  /** Pointer to the Sprites data which is shared among all sprites
-      with are loaded from the same file */
-  sprite2d::DataPtr data;
-  const sprite2d::Action* current_action;
-
-  float frame;
-  float speed;
-  float alpha;
-
-  bool pingpong;
-  bool reverse;
-  bool vflip;
-  GLenum blend_sfactor;
-  GLenum blend_dfactor;
-  float scale;
-  Color color;
 };
 
 #endif

Modified: trunk/windstille/src/tile_description.cpp
===================================================================
--- trunk/windstille/src/tile_description.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/tile_description.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -23,6 +23,9 @@
 **  02111-1307, USA.
 */
 
+#include &lt;iostream&gt;
+#include &lt;sstream&gt;
+#include &lt;stdexcept&gt;
 #include &lt;SDL.h&gt;
 #include &lt;SDL_image.h&gt;
 #include &quot;physfs/physfs_sdl.hpp&quot;

Modified: trunk/windstille/src/tile_factory.cpp
===================================================================
--- trunk/windstille/src/tile_factory.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/tile_factory.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -66,7 +66,7 @@
   packers.push_back(new TilePacker(1024, 1024));
   color_packer     = 0;
 
-  SExprFileReader reader(filename);
+  FileReader reader = FileReader::parse(filename);
   if(reader.get_name() != &quot;windstille-tiles&quot;)
     {
       std::ostringstream msg;

Modified: trunk/windstille/src/tile_factory.hpp
===================================================================
--- trunk/windstille/src/tile_factory.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/tile_factory.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -22,7 +22,6 @@
 
 #include &lt;map&gt;
 #include &lt;string&gt;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;tile_description.hpp&quot;
 
 class Tile;

Modified: trunk/windstille/src/tile_map.cpp
===================================================================
--- trunk/windstille/src/tile_map.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/tile_map.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -18,6 +18,7 @@
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 
 #include &lt;sstream&gt;
+#include &lt;stdexcept&gt;
 #include &lt;physfs.h&gt;
 #include &quot;tile_map.hpp&quot;
 #include &quot;tile.hpp&quot;
@@ -26,12 +27,10 @@
 #include &quot;view.hpp&quot;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
 #include &lt;inttypes.h&gt;
 
 TileMap::TileMap(FileReader&amp; props)
 {
-  using namespace lisp;
   int width = -1;
   int height = -1;
   z_pos = 0;

Modified: trunk/windstille/src/tile_map.hpp
===================================================================
--- trunk/windstille/src/tile_map.hpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/tile_map.hpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -24,7 +24,6 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;field.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
 #include &quot;game_object.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 

Modified: trunk/windstille/src/trigger.cpp
===================================================================
--- trunk/windstille/src/trigger.cpp	2007-06-20 05:08:24 UTC (rev 1477)
+++ trunk/windstille/src/trigger.cpp	2007-06-20 08:44:42 UTC (rev 1478)
@@ -17,13 +17,12 @@
 //  along with this program; if not, write to the Free Software
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 
+#include &lt;stdexcept&gt;
 #include &lt;list&gt;
 #include &quot;sector.hpp&quot;
 #include &quot;trigger.hpp&quot;
 #include &quot;player.hpp&quot;
 #include &quot;script_manager.hpp&quot;
-#include &quot;lisp/lisp.hpp&quot;
-#include &quot;lisp/properties.hpp&quot;
 
 Trigger::Trigger(FileReader&amp; props)
   : triggered(false), one_time_trigger(false)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001129.html">[Windstille-commit] r1477 - in trunk/windstille: . data src	src/navigation
</A></li>
	<LI>Next message: <A HREF="001131.html">[Windstille-commit] r1479 - trunk/windstille/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1130">[ date ]</a>
              <a href="thread.html#1130">[ thread ]</a>
              <a href="subject.html#1130">[ subject ]</a>
              <a href="author.html#1130">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
