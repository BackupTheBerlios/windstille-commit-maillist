<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1434 - in trunk/windstille: . data/controller	src src/math src/navigation
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2007-June/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1434%20-%20in%20trunk/windstille%3A%20.%20data/controller%0A%09src%20src/math%20src/navigation&In-Reply-To=%3C200706150631.l5F6VoNR001197%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001085.html">
   <LINK REL="Next"  HREF="001087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1434 - in trunk/windstille: . data/controller	src src/math src/navigation</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1434%20-%20in%20trunk/windstille%3A%20.%20data/controller%0A%09src%20src/math%20src/navigation&In-Reply-To=%3C200706150631.l5F6VoNR001197%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1434 - in trunk/windstille: . data/controller	src src/math src/navigation">grumbel at mail.berlios.de
       </A><BR>
    <I>Fri Jun 15 08:31:50 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001085.html">[Windstille-commit] r1433 - trunk/windstille/src/input
</A></li>
        <LI>Next message: <A HREF="001087.html">[Windstille-commit] r1435 - in trunk/media: . images/artwork	images/artwork/misc images/misc images/objects	models/characters/jane models/objects/surveillancerobot	models/vehicles models/vehicles/artillery	models/vehicles/battleship models/vehicles/cleansweep	models/vehicles/jeep models/vehicles/mech	models/vehicles/rocketlauncher models/vehicles/troopshuttle	models/vehicles/truck2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1086">[ date ]</a>
              <a href="thread.html#1086">[ thread ]</a>
              <a href="subject.html#1086">[ subject ]</a>
              <a href="author.html#1086">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2007-06-15 08:31:49 +0200 (Fri, 15 Jun 2007)
New Revision: 1434

Added:
   trunk/windstille/src/math/line.cpp
   trunk/windstille/src/math/line.hpp
   trunk/windstille/src/navigation/
   trunk/windstille/src/navigation/connection.cpp
   trunk/windstille/src/navigation/connection.hpp
   trunk/windstille/src/navigation/navigation_graph.cpp
   trunk/windstille/src/navigation/navigation_graph.hpp
   trunk/windstille/src/navigation/node.cpp
   trunk/windstille/src/navigation/node.hpp
   trunk/windstille/src/navigation/properties.cpp
   trunk/windstille/src/navigation/properties.hpp
   trunk/windstille/src/navigation/segment.cpp
   trunk/windstille/src/navigation/segment.hpp
Modified:
   trunk/windstille/INSTALL
   trunk/windstille/NEWS
   trunk/windstille/TODO
   trunk/windstille/data/controller/keyboard.scm
   trunk/windstille/src/SConscript
   trunk/windstille/src/controller_def.hpp
   trunk/windstille/src/conversation.cpp
   trunk/windstille/src/game_session.cpp
   trunk/windstille/src/sprite3dview.cpp
   trunk/windstille/src/view.cpp
   trunk/windstille/src/view.hpp
   trunk/windstille/src/windstille_main.cpp
Log:
- some framework for new collision/naviagtion stuff
- more xbox360 pad mappings

Modified: trunk/windstille/INSTALL
===================================================================
--- trunk/windstille/INSTALL	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/INSTALL	2007-06-15 06:31:49 UTC (rev 1434)
@@ -23,4 +23,8 @@
 
  $ ./windstille
 
+Compile on FreeBSD:
+
+&lt;AnMaster&gt; CPPFLAGS=&quot;-I/usr/local/include -D_SQ64&quot; CXXFLAGS=&quot;-DICONV_CONST=const&quot; LDFLAGS=&quot;-lpng -L/usr/local/lib&quot; ./configure --prefix=$HOME/test --with-ogg=/usr/local --with-libOpenAL=/usr/local --with-libphysfs=/usr/local
+
 # EOF #

Modified: trunk/windstille/NEWS
===================================================================
--- trunk/windstille/NEWS	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/NEWS	2007-06-15 06:31:49 UTC (rev 1434)
@@ -1,3 +1,8 @@
+Windstille 0.3.1
+================
+ - fixed crash when sound is disabled
+ - more solid gamepad support
+
 Windstille 0.3.0
 ================
  - near complete rewrite of the engine

Modified: trunk/windstille/TODO
===================================================================
--- trunk/windstille/TODO	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/TODO	2007-06-15 06:31:49 UTC (rev 1434)
@@ -1,3 +1,4 @@
+- implement proper dead-zone in input handling
 - shrink textures: a lot!
 - collision detection
 - virtual tiles in the editor

Modified: trunk/windstille/data/controller/keyboard.scm
===================================================================
--- trunk/windstille/data/controller/keyboard.scm	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/data/controller/keyboard.scm	2007-06-15 06:31:49 UTC (rev 1434)
@@ -9,39 +9,56 @@
   (joystick-axis (device 0)  (axis 1)))
  
  (x2-axis
-  (keyboard-axis (minus &quot;left&quot;) (plus &quot;right&quot;))
-  (joystick-axis (device 0)  (axis 3)))
+  (keyboard-axis (minus &quot;[4]&quot;) (plus &quot;[6]&quot;))
+  (joystick-axis (device 0)  (axis 4)))
 
  (y2-axis
-  (keyboard-axis (minus &quot;c&quot;) (plus &quot;t&quot;))
-  (joystick-axis (device 0)  (axis 4)))
+  (keyboard-axis (minus &quot;[2]&quot;) (plus &quot;[8]&quot;))
+  (joystick-axis (device 0)  (axis 3)))
 
+ (view-center-button
+  (keyboard-button (key &quot;[5]&quot;))
+  (joystick-button (device 0)  (button 9)))
+
  (primary-button
   (keyboard-button (key &quot;s&quot;))
-  (joystick-button (device 0)  (button 2)))
+  (joystick-button (device 0)  (button 0)))
 
  (secondary-button
   (keyboard-button (key &quot;d&quot;))
-  (joystick-button (device 0)  (button 3)))
+  (joystick-button (device 0)  (button 1)))
 
  (tertiary-button
   (keyboard-button (key &quot;a&quot;))
-  (joystick-button (device 0)  (button 1)))
+  (joystick-button (device 0)  (button 3)))
 
  (pda-button
   (keyboard-button (key &quot;w&quot;))
-  (joystick-button (device 0)  (button 0)))
+  (joystick-button (device 0)  (button 2)))
 
  (aim-button
   (keyboard-button (key &quot;k&quot;))
-  (joystick-button (device 0)  (button 7)))
+  (joystick-button (device 0)  (button 5)))
  
  (pause-button
   (keyboard-button (key &quot;p&quot;))
-  (joystick-button (device 0)  (button 9)))
+  (joystick-button (device 0)  (button 6)))
 
  (inventory-button
-  (keyboard-button (key &quot;e&quot;)))
+  (keyboard-button (key &quot;e&quot;))
+  (joystick-button (device 0)  (button 14)))
+
+ (menu-up-button
+  (joystick-button (device 0)  (button 10)))
+
+ (menu-down-button
+  (joystick-button (device 0)  (button 11)))
+
+ (menu-left-button
+  (joystick-button (device 0)  (button 12)))
+
+ (menu-right-button
+  (joystick-button (device 0)  (button 13)))
  )
 
 ;; EOF ;;

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/SConscript	2007-06-15 06:31:49 UTC (rev 1434)
@@ -150,11 +150,17 @@
 'lisp/parser.cpp',
 'lisp/properties.cpp',
 'lisp/writer.cpp',
+'navigation/connection.cpp',
+'navigation/navigation_graph.cpp',
+'navigation/node.cpp',
+'navigation/segment.cpp',
+'navigation/properties.cpp',
 'math/matrix.cpp',
 'math/origin.cpp',
 'math/quaternion.cpp',
 'math/rect.cpp',
 'math/vector.cpp',
+'math/line.cpp',
 'menu_manager.cpp',
 'particle_viewer.cpp',
 'particles/particle_system.cpp',

Modified: trunk/windstille/src/controller_def.hpp
===================================================================
--- trunk/windstille/src/controller_def.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/controller_def.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -41,6 +41,8 @@
 
     X2_AXIS,
     Y2_AXIS, 
+    
+    VIEW_CENTER_BUTTON,
 
     PRIMARY_BUTTON,   // used to ok a dialog or for running
     SECONDARY_BUTTON, // used to cancel a dialog or for jumping

Modified: trunk/windstille/src/conversation.cpp
===================================================================
--- trunk/windstille/src/conversation.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/conversation.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -87,40 +87,27 @@
   if (!active)
     return;
 
-  const InputEventLst&amp; events = controller.get_events();
-
-  for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i)
+  if (controller.button_was_pressed(MENU_UP_BUTTON))
     {
-      if (i-&gt;type == AXIS_EVENT &amp;&amp; i-&gt;axis.name == Y_AXIS)
-        {
-          if (i-&gt;axis.pos &gt; 0)
-            {
-              selection -= 1;
-              if (selection &lt; 0)
-                selection = choices.size() - 1;
-            }
-          else if (i-&gt;axis.pos &lt; 0)
-            {        
-              selection += 1;
-              if (selection &gt;= int(choices.size()))
-                selection = 0;
-            }
-        }
-      else if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
-        {
-          switch (i-&gt;button.name)
-            {
-            case OK_BUTTON:
-              active = false;
-              GameSession::current()-&gt;get_pda().add_dialog(&quot;Jane&quot;, choices[selection]);
-              choices.clear();
-              GameSession::current()-&gt;set_control_state(GameSession::GAME);
-              script_manager-&gt;fire_wakeup_event(ScriptManager::CONVERSATION_CLOSED);
-              return;
-              break;
-            }
-        }
+      selection -= 1;
+      if (selection &lt; 0)
+        selection = choices.size() - 1;
     }
+  else if (controller.button_was_pressed(MENU_DOWN_BUTTON))
+    {
+      selection += 1;
+      if (selection &gt;= int(choices.size()))
+        selection = 0;
+    }
+  
+  if (controller.button_was_pressed(OK_BUTTON))
+    {
+      active = false;
+      GameSession::current()-&gt;get_pda().add_dialog(&quot;Jane&quot;, choices[selection]);
+      choices.clear();
+      GameSession::current()-&gt;set_control_state(GameSession::GAME);
+      script_manager-&gt;fire_wakeup_event(ScriptManager::CONVERSATION_CLOSED);
+    }
 }
 
 int

Modified: trunk/windstille/src/game_session.cpp
===================================================================
--- trunk/windstille/src/game_session.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/game_session.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -217,7 +217,7 @@
       game_time += delta;
       script_manager-&gt;update();
       
-      view.update(delta);
+      view.update(delta, controller);
       sector-&gt;update(delta);
   
       switch (fade_state)

Added: trunk/windstille/src/math/line.cpp
===================================================================
--- trunk/windstille/src/math/line.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/math/line.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,40 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &quot;line.hpp&quot;
+
+Line::Line(const Vector&amp; p1_,
+           const Vector&amp; p2_)
+  : p1(p1_), p2(p2_)
+{
+}
+
+float
+Line::length() const
+{
+  return (p2 - p1).length();
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/math/line.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/math/line.hpp
===================================================================
--- trunk/windstille/src/math/line.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/math/line.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,57 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_LINE_HPP
+#define HEADER_LINE_HPP
+
+#include &quot;math/vector.hpp&quot;
+
+/** */
+class Line
+{
+private:
+public:
+  Vector p1;
+  Vector p2;
+
+  Line(const Vector&amp; p1,
+       const Vector&amp; p2);  
+  
+  float length() const;
+
+  /** Calculate if and where two lines collide */
+  bool collide(const Line&amp; line, float&amp; a, float&amp; b);
+
+  /** Calculate if and where two lines collide */
+  bool collide(const Line&amp; line, Vector&amp; colpos);
+
+private:
+  Line (const Line&amp;);
+  Line&amp; operator= (const Line&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/math/line.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/connection.cpp
===================================================================
--- trunk/windstille/src/navigation/connection.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/connection.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,30 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &quot;connection.hpp&quot;
+
+
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/connection.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/connection.hpp
===================================================================
--- trunk/windstille/src/navigation/connection.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/connection.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,67 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_CONNECTION_HPP
+#define HEADER_CONNECTION_HPP
+
+class Segment;
+class Node;
+
+/** 
+ */
+class Connection
+{
+public:
+  Segment* segment;
+
+  /** Position on the segment, stored with range [0,1], not
+      world-co */
+  float pos;
+
+  /** Move forward \a adv of units in world-co 
+   *  @return The amount of units left when hitting the end of the segment or 0.0f 
+   */
+  float advance_this_segment(float adv);
+
+public:
+  /** Move forward \a adv of units in world-co, automatically jump
+   * across segments, unless a end node is hit
+   *
+   * @param adv in: the amount of advancment to be done, out: the
+   * amount of units that wheren't use on the given segment
+   * @param next_segment out: the next segment get written into this
+   *
+   *  @return The amount of units left when hitting the end of the segment or 0.0f 
+   */
+  float advance(float&amp; adv, Node** next_node);
+  
+private:
+  Connection (const Connection&amp;);
+  Connection&amp; operator= (const Connection&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/connection.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/navigation_graph.cpp
===================================================================
--- trunk/windstille/src/navigation/navigation_graph.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/navigation_graph.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,30 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &quot;navigation_graph.hpp&quot;
+
+
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/navigation_graph.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/navigation_graph.hpp
===================================================================
--- trunk/windstille/src/navigation/navigation_graph.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/navigation_graph.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,64 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_NAVIGATION_GRAPH_HPP
+#define HEADER_NAVIGATION_GRAPH_HPP
+
+#include &lt;vector&gt;
+#include &quot;math/line.hpp&quot;
+
+class Node;
+class Segment;
+
+/** */
+class NavigationGraph
+{
+private:
+  std::vector&lt;Node*&gt;    nodes;
+  std::vector&lt;Segment*&gt; segments;
+
+  // insert some spartial thingy here
+
+public:
+  NavigationGraph();
+  ~NavigationGraph();
+
+  /** Find segments that collide with the given line */
+  std::vector&lt;Segment*&gt; find_segments(const Line&amp; line);
+
+  /** Find nodes that are near the given point */
+  std::vector&lt;Node*&gt; find_nodes(const Vector&amp; pos, float radius);
+
+  /** Find segments that are near the given point */
+  std::vector&lt;Segment*&gt; find_segments(const Vector&amp; pos, float radius);
+
+private:
+  NavigationGraph (const NavigationGraph&amp;);
+  NavigationGraph&amp; operator= (const NavigationGraph&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/navigation_graph.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/node.cpp
===================================================================
--- trunk/windstille/src/navigation/node.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/node.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,30 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &quot;node.hpp&quot;
+
+
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/node.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/node.hpp
===================================================================
--- trunk/windstille/src/navigation/node.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/node.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,54 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_NAVIGATION_NODE_HPP
+#define HEADER_NAVIGATION_NODE_HPP
+
+#include &lt;vector&gt;
+#include &quot;math/vector.hpp&quot;
+
+class Segment;
+
+/** */
+class Node
+{
+private:
+  int    id;
+  Vector pos;
+  
+  /** Segments connected to this node */
+  std::vector&lt;Segment*&gt; segments;
+
+public:
+  Node();
+
+private:
+  Node(const Node&amp;);
+  Node&amp; operator=(const Node&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/node.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/properties.cpp
===================================================================
--- trunk/windstille/src/navigation/properties.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/properties.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,30 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &quot;properties.hpp&quot;
+
+
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/properties.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/properties.hpp
===================================================================
--- trunk/windstille/src/navigation/properties.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/properties.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,42 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_COLLISION_PROPERTIES_HPP
+#define HEADER_COLLISION_PROPERTIES_HPP
+
+#include &lt;inttypes.h&gt;
+
+enum {
+  WALKABLE = (1&lt;&lt;0),
+  WALL     = (1&lt;&lt;1),
+  LADDER   = (1&lt;&lt;2),
+  STAIRS   = (1&lt;&lt;2),
+};
+
+typedef uint32_t Properties;
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/properties.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/segment.cpp
===================================================================
--- trunk/windstille/src/navigation/segment.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/segment.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,30 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &quot;segment.hpp&quot;
+
+
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/segment.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Added: trunk/windstille/src/navigation/segment.hpp
===================================================================
--- trunk/windstille/src/navigation/segment.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/navigation/segment.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -0,0 +1,54 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_SEGMENT_HPP
+#define HEADER_SEGMENT_HPP
+
+class Node;
+
+#include &quot;properties.hpp&quot;
+
+/** */
+class Segment
+{
+private:
+  Node* node1;
+  Node* node2;
+  
+  Properties props;
+
+public:
+
+  /** Calculate the angle between two segments */
+  float angle(Segment* seg);
+  
+private:
+  Segment (const Segment&amp;);
+  Segment&amp; operator= (const Segment&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/navigation/segment.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:eol-style
   + native

Modified: trunk/windstille/src/sprite3dview.cpp
===================================================================
--- trunk/windstille/src/sprite3dview.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/sprite3dview.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -141,8 +141,8 @@
       sprite.set_action(actions[current_action]);
     }
 
-  rotx += controller.get_axis_state(X2_AXIS) * 50.0f * delta;
-  roty += controller.get_axis_state(Y2_AXIS) * 50.0f * delta;
+  rotx += controller.get_axis_state(Y2_AXIS) * 50.0f * delta;
+  roty += controller.get_axis_state(X2_AXIS) * 50.0f * delta;
 
   if (controller.button_was_pressed(ESCAPE_BUTTON) ||
       controller.button_was_pressed(CANCEL_BUTTON))

Modified: trunk/windstille/src/view.cpp
===================================================================
--- trunk/windstille/src/view.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/view.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -62,7 +62,7 @@
 }
 
 void
-View::update (float delta)
+View::update (float delta, const Controller&amp; controller)
 {
   camera.update(delta);
 
@@ -73,18 +73,13 @@
   if (keystate[SDLK_KP_MINUS])
     zoom *= 1.0 - delta;
 
-  if(keystate[SDLK_KP2])
-    transform.y += delta * 200 / zoom;
-  if(keystate[SDLK_KP8])
-    transform.y -= delta * 200 / zoom;
-  if(keystate[SDLK_KP4])
-    transform.x -= delta * 200 / zoom;
-  if(keystate[SDLK_KP6])
-    transform.x += delta * 200 / zoom;
-  if(keystate[SDLK_KP5]){
-    transform = Vector(0, 0);
-    zoom = 1.0;
+  if(controller.get_button_state(VIEW_CENTER_BUTTON)) {
+      transform = Vector(0, 0);
+      zoom = 1.0;
   }
+
+  transform.x += 0.5f * controller.get_axis_state(X2_AXIS) / zoom;
+  transform.y -= 0.5f * controller.get_axis_state(Y2_AXIS) / zoom;
 }
 
 Rectf

Modified: trunk/windstille/src/view.hpp
===================================================================
--- trunk/windstille/src/view.hpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/view.hpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -30,6 +30,7 @@
 #include &quot;graphic_context_state.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 
+class Controller;
 class SceneContext;
 
 /** This class is the gui component which renders the world to the
@@ -55,7 +56,7 @@
   Vector screen_to_world(const Vector&amp; point);
 
   void draw(SceneContext&amp; gc);
-  void update(float delta);
+  void update(float delta, const Controller&amp; controller);
 
   static View* current() { return current_; }
 

Modified: trunk/windstille/src/windstille_main.cpp
===================================================================
--- trunk/windstille/src/windstille_main.cpp	2007-06-15 06:30:45 UTC (rev 1433)
+++ trunk/windstille/src/windstille_main.cpp	2007-06-15 06:31:49 UTC (rev 1434)
@@ -90,6 +90,8 @@
       controller_description.add_button(&quot;menu-left-button&quot;,  MENU_LEFT_BUTTON);
       controller_description.add_button(&quot;menu-right-button&quot;,  MENU_RIGHT_BUTTON);
   
+      controller_description.add_button(&quot;view-center-button&quot;, VIEW_CENTER_BUTTON);
+
       controller_description.add_button(&quot;pda-button&quot;, PDA_BUTTON);
       controller_description.add_button(&quot;inventory-button&quot;, INVENTORY_BUTTON);
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001085.html">[Windstille-commit] r1433 - trunk/windstille/src/input
</A></li>
	<LI>Next message: <A HREF="001087.html">[Windstille-commit] r1435 - in trunk/media: . images/artwork	images/artwork/misc images/misc images/objects	models/characters/jane models/objects/surveillancerobot	models/vehicles models/vehicles/artillery	models/vehicles/battleship models/vehicles/cleansweep	models/vehicles/jeep models/vehicles/mech	models/vehicles/rocketlauncher models/vehicles/troopshuttle	models/vehicles/truck2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1086">[ date ]</a>
              <a href="thread.html#1086">[ thread ]</a>
              <a href="subject.html#1086">[ subject ]</a>
              <a href="author.html#1086">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
