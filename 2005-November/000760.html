<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1103 - in trunk/src: . scripting sprite3d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1103%20-%20in%20trunk/src%3A%20.%20scripting%20sprite3d&In-Reply-To=%3C200511011716.jA1HGwix023283%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1103 - in trunk/src: . scripting sprite3d</H1>
    <B>Ingo Ruhnke at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1103%20-%20in%20trunk/src%3A%20.%20scripting%20sprite3d&In-Reply-To=%3C200511011716.jA1HGwix023283%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1103 - in trunk/src: . scripting sprite3d">grumbel at berlios.de
       </A><BR>
    <I>Tue Nov  1 18:16:58 CET 2005</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000761.html">[Windstille-commit] r1104 - trunk/data/images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#760">[ date ]</a>
              <a href="thread.html#760">[ thread ]</a>
              <a href="subject.html#760">[ subject ]</a>
              <a href="author.html#760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-11-01 18:16:56 +0100 (Tue, 01 Nov 2005)
New Revision: 1103

Added:
   trunk/src/sprite3dview.cpp
   trunk/src/sprite3dview.hpp
Modified:
   trunk/src/Jamfile
   trunk/src/globals.cpp
   trunk/src/globals.hpp
   trunk/src/scripting/wrapper.cpp
   trunk/src/scripting/wrapper.hpp
   trunk/src/sprite3d/data.hpp
   trunk/src/sprite3d/sprite3d.cpp
   trunk/src/sprite3d/sprite3d.hpp
   trunk/src/windstille_main.cpp
Log:
- added a simple viewer for 3d sprites

Modified: trunk/src/Jamfile
===================================================================
--- trunk/src/Jamfile	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/Jamfile	2005-11-01 17:16:56 UTC (rev 1103)
@@ -96,6 +96,8 @@
         sector.hpp
         spawnpoint.cpp
         spawnpoint.hpp
+        sprite3dview.hpp
+        sprite3dview.cpp
         sharedptr.hpp
         test_object.cpp
         test_object.hpp

Modified: trunk/src/globals.cpp
===================================================================
--- trunk/src/globals.cpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/globals.cpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -31,6 +31,7 @@
 bool debug = false;
 #endif
 bool collision_debug = false;
-bool sound_disabled = false;
+bool sound_disabled  = false;
+bool sprite3dview    = false;
 
 /* EOF */

Modified: trunk/src/globals.hpp
===================================================================
--- trunk/src/globals.hpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/globals.hpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -36,6 +36,7 @@
 
 extern bool debug;
 extern bool collision_debug;
+extern bool sprite3dview;
 
 enum GameMainState { RUN_GAME, LOAD_MENU, LOAD_GAME_SESSION, QUIT_GAME };
 

Modified: trunk/src/scripting/wrapper.cpp
===================================================================
--- trunk/src/scripting/wrapper.cpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/scripting/wrapper.cpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -1,6 +1,6 @@
 /**
  * WARNING: This file is automatically generated from:
- *  'src/scripting/wrapper.interface.hpp'
+ *  'scripting/wrapper.interface.hpp'
  * DO NOT CHANGE
  */
 #include &lt;config.h&gt;

Modified: trunk/src/scripting/wrapper.hpp
===================================================================
--- trunk/src/scripting/wrapper.hpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/scripting/wrapper.hpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -1,6 +1,6 @@
 /**
  * WARNING: This file is automatically generated from:
- *  'src/scripting/wrapper.interface.hpp'
+ *  'scripting/wrapper.interface.hpp'
  * DO NOT CHANGE
  */
 #ifndef __windstille_WRAPPER_H__

Modified: trunk/src/sprite3d/data.hpp
===================================================================
--- trunk/src/sprite3d/data.hpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/sprite3d/data.hpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -15,6 +15,7 @@
 //  You should have received a copy of the GNU General Public License
 //  along with this program; if not, write to the Free Software
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
 #ifndef HEADER_SPRITE3D_DATA_HPP
 #define HEADER_SPRITE3D_DATA_HPP
 

Modified: trunk/src/sprite3d/sprite3d.cpp
===================================================================
--- trunk/src/sprite3d/sprite3d.cpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/sprite3d/sprite3d.cpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -87,6 +87,17 @@
   return frame2.action-&gt;name;
 }
 
+std::vector&lt;std::string&gt;
+Sprite3D::get_actions() const
+{
+  std::vector&lt;std::string&gt; actions;
+  for(int i = 0; i &lt; data-&gt;action_count; ++i)
+    {
+      actions.push_back(data-&gt;actions[i].name);
+    }
+  return actions;
+}
+
 void
 Sprite3D::set_next_action(const std::string&amp; name, float speed)
 {

Modified: trunk/src/sprite3d/sprite3d.hpp
===================================================================
--- trunk/src/sprite3d/sprite3d.hpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/sprite3d/sprite3d.hpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -66,6 +66,11 @@
    */
   const std::string&amp; get_action() const;
 
+  /** 
+   * Return a list of all available actions
+   */
+  std::vector&lt;std::string&gt; get_actions() const;
+
   /**
    * Set the next action and vflip value to be played after the current action
    * has finished (or reached the point to be defined by abort_at_marker)

Added: trunk/src/sprite3dview.cpp
===================================================================
--- trunk/src/sprite3dview.cpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/sprite3dview.cpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -0,0 +1,93 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include &lt;iostream&gt;
+#include &quot;gameconfig.hpp&quot;
+#include &quot;input/controller.hpp&quot;
+#include &quot;sprite3dview.hpp&quot;
+
+Sprite3DView::Sprite3DView()
+{
+  current_action = 0;
+  //sprite = Sprite3D(&quot;models/characters/bob/bob.wsprite&quot;);
+  sprite = Sprite3D(&quot;models/characters/jane/jane.wsprite&quot;);
+  actions = sprite.get_actions();
+
+  for(std::vector&lt;std::string&gt;::iterator i = actions.begin(); i != actions.end(); ++i)
+    {
+      std::cout &lt;&lt; &quot;Action: &quot; &lt;&lt; *i &lt;&lt; std::endl;
+    }
+  
+  sprite.set_action(actions[current_action]);
+}
+
+Sprite3DView::~Sprite3DView()
+{
+}
+
+void
+Sprite3DView::draw()
+{
+  sc.reset_modelview();
+  sc.translate(-config-&gt;screen_width/2, -config-&gt;screen_height/2 + 150);
+  sc.scale(2.0f, 2.0f);
+  
+  sc.color().fill_screen(Color(0.5, 0.0, 0.5));
+  sprite.draw(sc.color(), Vector(config-&gt;screen_width/2, config-&gt;screen_height/2), 0); 
+  sc.light().fill_screen(Color(1.0, 1.0, 1.0));
+  //sc.color().draw(&quot;Hello World&quot;, 100, 100);
+  sc.render();
+}
+
+void
+Sprite3DView::update(float delta, const Controller&amp; controller)
+{
+  sprite.update(delta);
+  //std::cout &lt;&lt; &quot;Delta: &quot; &lt;&lt; delta &lt;&lt; std::endl;
+
+  int last_action = current_action;
+  if (controller.axis_was_pressed_up(Y_AXIS))
+    {
+      if (current_action == int(actions.size())-1)
+        current_action = 0;
+      else
+        current_action += 1;
+    }
+  else if (controller.axis_was_pressed_down(Y_AXIS))
+    {
+      if (current_action == 0)
+        current_action = actions.size()-1;
+      else
+        current_action -= 1;
+    }
+
+  if (last_action != current_action)
+    {
+      std::cout &lt;&lt; &quot;Setting actions: &quot; &lt;&lt; actions[current_action] &lt;&lt; std::endl;
+      sprite.set_action(actions[current_action]);
+    }
+}
+
+/* EOF */

Added: trunk/src/sprite3dview.hpp
===================================================================
--- trunk/src/sprite3dview.hpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/sprite3dview.hpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -0,0 +1,56 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  &gt; |__| |__|____/____/\___  &gt;
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#ifndef HEADER_SPRITE3DVIEW_HPP
+#define HEADER_SPRITE3DVIEW_HPP
+
+#include &quot;display/scene_context.hpp&quot;
+#include &quot;sprite3d/sprite3d.hpp&quot;
+#include &quot;screen.hpp&quot;
+
+/** */
+class Sprite3DView : public Screen
+{
+private:
+  SceneContext sc;
+  Sprite3D sprite;
+  std::vector&lt;std::string&gt; actions;
+  int current_action;
+
+public:
+  Sprite3DView();
+  ~Sprite3DView();
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+
+private:
+  Sprite3DView (const Sprite3DView&amp;);
+  Sprite3DView&amp; operator= (const Sprite3DView&amp;);
+};
+
+#endif
+
+/* EOF */

Modified: trunk/src/windstille_main.cpp
===================================================================
--- trunk/src/windstille_main.cpp	2005-09-28 22:01:03 UTC (rev 1102)
+++ trunk/src/windstille_main.cpp	2005-11-01 17:16:56 UTC (rev 1103)
@@ -47,6 +47,7 @@
 #include &quot;sprite3d/manager.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
 #include &quot;command_line.hpp&quot;
+#include &quot;sprite3dview.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 
 WindstilleMain::WindstilleMain()
@@ -63,11 +64,15 @@
   CommandLine argp;
 
   const int debug_flag = 256;
+  const int sprite3dview_flag = 257;
     
   argp.set_help_indent(24);
   argp.add_usage (&quot;[LEVELFILE]&quot;);
   argp.add_doc   (&quot;Windstille is a classic Jump'n Run game.&quot;);
 
+  argp.add_group(&quot;Mode Options:&quot;);
+  argp.add_option(sprite3dview_flag, &quot;sprite3dview&quot;, &quot;&quot;, &quot;Launch Sprite3DView instead of the game&quot;);
+
   argp.add_group(&quot;Display Options:&quot;);
   argp.add_option('g', &quot;geometry&quot;,   &quot;WxH&quot;, &quot;Change window size to WIDTH and HEIGHT&quot;);
   argp.add_option('f', &quot;fullscreen&quot;, &quot;&quot;, &quot;Launch the game in fullscreen&quot;);
@@ -124,6 +129,10 @@
           debug = 1;
           break;
 
+        case sprite3dview_flag:
+          sprite3dview = true;
+          break;
+
         case 'f':
           config-&gt;use_fullscreen = true;
           break;
@@ -208,15 +217,23 @@
     if (debug) std::cout &lt;&lt; &quot;Initialising TileFactory&quot; &lt;&lt; std::endl;
     TileFactory::init();
 
-    if (levelfile.empty())
+    if (sprite3dview)
       {
-        screen_manager.set_screen(new GameSession(&quot;levels/newformat2.wst&quot;));
+        // Launching Sprite3DView instead of game
+        screen_manager.set_screen(new Sprite3DView());
       }
     else
       {
-        std::string leveldir = dirname(levelfile);
-        PHYSFS_addToSearchPath(leveldir.c_str(), true);
-        screen_manager.set_screen(new GameSession(basename(levelfile)));
+        if (levelfile.empty())
+          {
+            screen_manager.set_screen(new GameSession(&quot;levels/newformat2.wst&quot;));
+          }
+        else
+          {
+            std::string leveldir = dirname(levelfile);
+            PHYSFS_addToSearchPath(leveldir.c_str(), true);
+            screen_manager.set_screen(new GameSession(basename(levelfile)));
+          }
       }
         
     console &lt;&lt; &quot;Press F1 to open the console&quot; &lt;&lt; std::endl;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000761.html">[Windstille-commit] r1104 - trunk/data/images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#760">[ date ]</a>
              <a href="thread.html#760">[ thread ]</a>
              <a href="subject.html#760">[ subject ]</a>
              <a href="author.html#760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
