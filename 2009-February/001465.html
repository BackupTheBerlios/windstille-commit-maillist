<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r2468 - in trunk/windstille/src: . display font	gui hud input objects screen scripting tile
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2468%20-%20in%20trunk/windstille/src%3A%20.%20display%20font%0A%09gui%20hud%20input%20objects%20screen%20scripting%20tile&In-Reply-To=%3C200902120817.n1C8HNFu005980%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001464.html">
   <LINK REL="Next"  HREF="001466.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r2468 - in trunk/windstille/src: . display font	gui hud input objects screen scripting tile</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2468%20-%20in%20trunk/windstille/src%3A%20.%20display%20font%0A%09gui%20hud%20input%20objects%20screen%20scripting%20tile&In-Reply-To=%3C200902120817.n1C8HNFu005980%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r2468 - in trunk/windstille/src: . display font	gui hud input objects screen scripting tile">grumbel at mail.berlios.de
       </A><BR>
    <I>Thu Feb 12 09:17:23 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001464.html">[Windstille-commit] r2467 - trunk/windstille/data/scripts
</A></li>
        <LI>Next message: <A HREF="001466.html">[Windstille-commit] r2469 - in trunk/windstille/src: . engine	screen sprite3d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1465">[ date ]</a>
              <a href="thread.html#1465">[ thread ]</a>
              <a href="subject.html#1465">[ subject ]</a>
              <a href="author.html#1465">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-02-12 09:17:19 +0100 (Thu, 12 Feb 2009)
New Revision: 2468

Added:
   trunk/windstille/src/display/blitter.cpp
   trunk/windstille/src/display/blitter.hpp
   trunk/windstille/src/display/graphic_context_state.cpp
   trunk/windstille/src/display/graphic_context_state.hpp
   trunk/windstille/src/display/text_area.cpp
   trunk/windstille/src/display/text_area.hpp
   trunk/windstille/src/hud/
   trunk/windstille/src/hud/controller_help_window.cpp
   trunk/windstille/src/hud/controller_help_window.hpp
   trunk/windstille/src/hud/conversation.cpp
   trunk/windstille/src/hud/conversation.hpp
   trunk/windstille/src/hud/dialog_manager.cpp
   trunk/windstille/src/hud/dialog_manager.hpp
   trunk/windstille/src/hud/energy_bar.cpp
   trunk/windstille/src/hud/energy_bar.hpp
   trunk/windstille/src/hud/inventory.cpp
   trunk/windstille/src/hud/inventory.hpp
   trunk/windstille/src/hud/pda.cpp
   trunk/windstille/src/hud/pda.hpp
   trunk/windstille/src/screen/
   trunk/windstille/src/screen/armature_test.cpp
   trunk/windstille/src/screen/armature_test.hpp
   trunk/windstille/src/screen/game_session.cpp
   trunk/windstille/src/screen/game_session.hpp
   trunk/windstille/src/screen/geometry_test.cpp
   trunk/windstille/src/screen/geometry_test.hpp
   trunk/windstille/src/screen/navigation_test.cpp
   trunk/windstille/src/screen/navigation_test.hpp
   trunk/windstille/src/screen/particle_viewer.cpp
   trunk/windstille/src/screen/particle_viewer.hpp
   trunk/windstille/src/screen/screen.cpp
   trunk/windstille/src/screen/screen.hpp
   trunk/windstille/src/screen/screen_manager.cpp
   trunk/windstille/src/screen/screen_manager.hpp
   trunk/windstille/src/screen/sprite2dview.cpp
   trunk/windstille/src/screen/sprite2dview.hpp
   trunk/windstille/src/screen/sprite3dview.cpp
   trunk/windstille/src/screen/sprite3dview.hpp
   trunk/windstille/src/screen/title_screen.cpp
   trunk/windstille/src/screen/title_screen.hpp
Removed:
   trunk/windstille/src/armature_test.cpp
   trunk/windstille/src/armature_test.hpp
   trunk/windstille/src/blitter.cpp
   trunk/windstille/src/blitter.hpp
   trunk/windstille/src/controller_help_window.cpp
   trunk/windstille/src/controller_help_window.hpp
   trunk/windstille/src/conversation.cpp
   trunk/windstille/src/conversation.hpp
   trunk/windstille/src/dialog_manager.cpp
   trunk/windstille/src/dialog_manager.hpp
   trunk/windstille/src/energy_bar.cpp
   trunk/windstille/src/energy_bar.hpp
   trunk/windstille/src/game_session.cpp
   trunk/windstille/src/game_session.hpp
   trunk/windstille/src/geometry_test.cpp
   trunk/windstille/src/geometry_test.hpp
   trunk/windstille/src/graphic_context_state.cpp
   trunk/windstille/src/graphic_context_state.hpp
   trunk/windstille/src/inventory.cpp
   trunk/windstille/src/inventory.hpp
   trunk/windstille/src/navigation_test.cpp
   trunk/windstille/src/navigation_test.hpp
   trunk/windstille/src/particle_viewer.cpp
   trunk/windstille/src/particle_viewer.hpp
   trunk/windstille/src/pda.cpp
   trunk/windstille/src/pda.hpp
   trunk/windstille/src/screen.cpp
   trunk/windstille/src/screen.hpp
   trunk/windstille/src/screen_manager.cpp
   trunk/windstille/src/screen_manager.hpp
   trunk/windstille/src/sprite2dview.cpp
   trunk/windstille/src/sprite2dview.hpp
   trunk/windstille/src/sprite3dview.cpp
   trunk/windstille/src/sprite3dview.hpp
   trunk/windstille/src/text_area.cpp
   trunk/windstille/src/text_area.hpp
   trunk/windstille/src/title_screen.cpp
   trunk/windstille/src/title_screen.hpp
Modified:
   trunk/windstille/src/SConscript
   trunk/windstille/src/console.cpp
   trunk/windstille/src/font/ttf_font.cpp
   trunk/windstille/src/gui/gui_manager.cpp
   trunk/windstille/src/gui/gui_manager.hpp
   trunk/windstille/src/gui/text_view.hpp
   trunk/windstille/src/input/input_configurator.cpp
   trunk/windstille/src/input/input_configurator.hpp
   trunk/windstille/src/menu_manager.cpp
   trunk/windstille/src/objects/character.cpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/objects/swarm.cpp
   trunk/windstille/src/scripting/interface.cpp
   trunk/windstille/src/tile/tile_packer.cpp
   trunk/windstille/src/view.hpp
   trunk/windstille/src/windstille_main.cpp
   trunk/windstille/src/windstille_main.hpp
Log:
Reorganised some files into screen/ and hud/

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/SConscript	2009-02-12 08:17:19 UTC (rev 2468)
@@ -45,8 +45,6 @@
 'armature/mesh.cpp',
 'armature/model.cpp',
 'armature/pose.cpp',
-'armature_test.cpp',
-'blitter.cpp',
 'collision/collision_data.cpp',
 'collision/collision_engine.cpp',
 'collision/collision_object.cpp',
@@ -56,12 +54,11 @@
 'config.cpp',
 'console.cpp',
 'controller_def.cpp',
-'controller_help_window.cpp',
-'conversation.cpp',
-'dialog_manager.cpp',
+'display/blitter.cpp',
 'display/display.cpp',
 'display/drawing_context.cpp',
 'display/framebuffer.cpp',
+'display/graphic_context_state.cpp',
 'display/opengl_state.cpp',
 'display/render_buffer.cpp',
 'display/scene_context.cpp',
@@ -69,10 +66,10 @@
 'display/shader_program.cpp',
 'display/surface.cpp',
 'display/surface_manager.cpp',
+'display/text_area.cpp',
 'display/texture.cpp',
 'display/texture_manager.cpp',
 'display/vertex_array_drawing_request.cpp',
-'energy_bar.cpp',
 'engine/camera.cpp',
 'engine/entity.cpp',
 'engine/game_object.cpp',
@@ -82,10 +79,7 @@
 'font/border_font_effect.cpp',
 'font/fonts.cpp',
 'font/ttf_font.cpp',
-'game_session.cpp',
-'geometry_test.cpp',
 'globals.cpp',
-'graphic_context_state.cpp',
 'gui/automap.cpp',
 'gui/button.cpp',
 'gui/component.cpp',
@@ -101,6 +95,12 @@
 'gui/slider.cpp',
 'gui/tab_component.cpp',
 'gui/text_view.cpp',
+'hud/controller_help_window.cpp',
+'hud/conversation.cpp',
+'hud/dialog_manager.cpp',
+'hud/energy_bar.cpp',
+'hud/inventory.cpp',
+'hud/pda.cpp',
 'input/controller.cpp',
 'input/controller_description.cpp',
 'input/input_configurator.cpp',
@@ -108,7 +108,6 @@
 'input/input_manager_impl.cpp',
 'input/input_manager_sdl.cpp',
 'input/wiimote.cpp',
-'inventory.cpp',
 'lisp/getters.cpp',
 'lisp/lexer.cpp',
 'lisp/lisp.cpp',
@@ -128,7 +127,6 @@
 'navigation/properties.cpp',
 'navigation/segment.cpp',
 'navigation/segment_position.cpp',
-'navigation_test.cpp',
 'objects/background_gradient.cpp',
 'objects/bomb.cpp',
 'objects/box.cpp',
@@ -148,16 +146,22 @@
 'objects/test_object.cpp',
 'objects/trigger.cpp',
 'objects/vrdummy.cpp',
-'particle_viewer.cpp',
+'screen/particle_viewer.cpp',
 'particles/deform_drawer.cpp',
 'particles/particle_system.cpp',
 'particles/spark_drawer.cpp',
 'particles/surface_drawer.cpp',
-'pda.cpp',
 'physfs/physfs_sdl.cpp',
 'physfs/physfs_stream.cpp',
-'screen.cpp',
-'screen_manager.cpp',
+'screen/screen.cpp',
+'screen/armature_test.cpp',
+'screen/game_session.cpp',
+'screen/geometry_test.cpp',
+'screen/navigation_test.cpp',
+'screen/sprite2dview.cpp',
+'screen/sprite3dview.cpp',
+'screen/title_screen.cpp',
+'screen/screen_manager.cpp',
 'scripting/game_objects.cpp',
 'scripting/interface.cpp',
 'scripting/squirrel_error.cpp',
@@ -170,20 +174,15 @@
 'sprite2d/data.cpp',
 'sprite2d/manager.cpp',
 'sprite2d/sprite.cpp',
-'sprite2dview.cpp',
 'sprite3d/data.cpp',
 'sprite3d/manager.cpp',
 'sprite3d/sprite3d.cpp',
-'sprite3dview.cpp',
-'text_area.cpp',
 'tile/tile.cpp',
 'tile/tile_description.cpp',
 'tile/tile_factory.cpp',
 'tile/tile_map.cpp',
 'tile/tile_packer.cpp',
 'timer.cpp',
-'title_screen.cpp',
-'util/util.cpp',
 'util/baby_xml.cpp',
 'util/command_line.cpp',
 'util/command_line_generic.cpp',
@@ -191,6 +190,7 @@
 'util/getter.cpp',
 'util/response_curve.cpp',
 'util/sexpr_file_reader.cpp',
+'util/util.cpp',
 'view.cpp',
 'windstille_main.cpp',
 ])

Deleted: trunk/windstille/src/armature_test.cpp
===================================================================
--- trunk/windstille/src/armature_test.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/armature_test.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,130 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &lt;physfs.h&gt;
-
-#include &quot;input/controller.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;armature/pose.hpp&quot;
-#include &quot;armature/model.hpp&quot;
-#include &quot;armature_test.hpp&quot;
-
-ArmatureTest::ArmatureTest()
-{
-  FileReader model_reader = FileReader::parse(&quot;armature/mesh.mesh&quot;);
-  model = new Model(model_reader, &quot;armature/&quot;);
-
-  FileReader armature_reader = FileReader::parse(&quot;armature/armature.arm&quot;);
-  armature = new Armature(armature_reader);
-
-  std::vector&lt;std::string&gt; file_lst;
-  {
-    char** dirlist = PHYSFS_enumerateFiles(&quot;armature/pose/&quot;);
-    for (char **i = dirlist; *i != NULL; ++i)
-      if (!PHYSFS_isDirectory((std::string(&quot;armature/pose/&quot;) + *i).c_str())) {
-        std::cout &lt;&lt; &quot;PoseFile: &quot; &lt;&lt; *i &lt;&lt; std::endl;
-        FileReader pose_reader = FileReader::parse(std::string(&quot;armature/pose/&quot;) + *i);
-        poses.push_back(new Pose(pose_reader));       
-      }
-    PHYSFS_freeList(dirlist);
-  }
-
-  pose_idx = 0;
-
-  armature-&gt;apply(*poses[pose_idx]);
-
-  xrot = 0;
-  yrot = 0;
-  zrot = 0;
-  
-  time = 0.0f;
-}
-
-void
-ArmatureTest::draw()
-{
-  glClearColor(0.5f, 0.0f, 0.5f, 1.0f);
-  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-
-  glPushMatrix();
-
-  glTranslatef(400.0f, 300.0f, 0.0f);
-  glScalef(64.0f, 64.0f, 64.0f);
- 
-  glRotatef(xrot, 1.0f, 0.0f, 0.0f);
-  glRotatef(yrot, 0.0f, 1.0f, 0.0f);
-  glRotatef(zrot, 0.0f, 0.0f, 1.0f);
-
-  model-&gt;draw();
-  armature-&gt;draw();
-
-  glPopMatrix();
-
-  // std::cout &lt;&lt; xrot &lt;&lt; &quot; &quot; &lt;&lt; yrot &lt;&lt; std::endl;
-}
-
-void
-ArmatureTest::update(float delta, const Controller&amp; controller)
-{
-  time += delta;
-
-  pose_idx = int(time * 5.0f) % poses.size();
-  armature-&gt;apply(*poses[pose_idx]);
-  model-&gt;apply(armature);
-
-  if (controller.button_was_pressed(ESCAPE_BUTTON) ||
-      controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      screen_manager.pop_screen();
-    }
-
-  if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      xrot = 90;
-      yrot = 0;
-      zrot = 0;
-    }
-  else if (controller.button_was_pressed(SECONDARY_BUTTON))
-      {
-      xrot = 0;
-      yrot = 90;
-      zrot = 0;
-      }
-  else if (controller.button_was_pressed(TERTIARY_BUTTON))
-    {
-      xrot = 0;
-      yrot = 0;
-      zrot = 90;
-    }
-  else
-    { 
-      yrot += controller.get_axis_state(X_AXIS) * 90 * delta;
-      xrot += controller.get_axis_state(Y_AXIS) * 90 * delta;
-      zrot += controller.get_axis_state(X2_AXIS) * 90 * delta;
-    }
-
-  if (controller.button_was_pressed(AIM_BUTTON))
-    {
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/armature_test.hpp
===================================================================
--- trunk/windstille/src/armature_test.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/armature_test.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,54 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_ARMATURE_TEST_HPP
-#define HEADER_WINDSTILLE_ARMATURE_TEST_HPP
-
-#include &quot;armature/armature.hpp&quot;
-#include &quot;armature/model.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-/** */
-class ArmatureTest : public Screen
-{
-private:
-  Model* model;
-  Armature* armature;
-  std::vector&lt;Pose*&gt; poses;
-  
-  int pose_idx;
-  float time;
-
-  float xrot;
-  float yrot;
-  float zrot;
-
-public:
-  ArmatureTest();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-private:
-  ArmatureTest (const ArmatureTest&amp;);
-  ArmatureTest&amp; operator= (const ArmatureTest&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/blitter.cpp
===================================================================
--- trunk/windstille/src/blitter.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/blitter.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,86 +0,0 @@
-//
-//
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &lt;iostream&gt;
-#include &lt;algorithm&gt;
-#include &lt;stdint.h&gt;
-#include &quot;blitter.hpp&quot;
-
-void generate_border(SDL_Surface* surface,
-                     int x_pos, int y_pos, int width, int height)
-{
-  assert(surface-&gt;format-&gt;BitsPerPixel == 32);
-  SDL_LockSurface(surface);
- 
-  uint8_t* data = static_cast&lt;uint8_t*&gt;(surface-&gt;pixels);
-  int pitch = surface-&gt;pitch;
-
-  // duplicate the top line
-  memcpy(data + (y_pos-1)*pitch + 4*x_pos, 
-         data + (y_pos)*pitch + 4*x_pos,
-         4*width);
-  // duplicate the bottom line
-  memcpy(data + (y_pos+height)*pitch + 4*x_pos, 
-         data + (y_pos+height-1)*pitch + 4*x_pos,  
-         4*width);
-
-  // duplicate left and right borders
-  for(int y = y_pos-1; y &lt; y_pos + height+1; ++y)
-    {
-      uint32_t* p = reinterpret_cast&lt;uint32_t*&gt; (data + (y*pitch + 4*(x_pos-1)));
-      *p = *(p+1);
-      p = reinterpret_cast&lt;uint32_t*&gt; (data + (y*pitch + 4*(x_pos + width)));
-      *p = *(p-1);
-    }
-
-  SDL_UnlockSurface(surface);
-}
-
-void 
-blit_ftbitmap(SDL_Surface* target, const FT_Bitmap&amp; brush, int x_pos, int y_pos)
-{
-  SDL_LockSurface(target);
-  
-  int start_x = std::max(0, -x_pos);
-  int start_y = std::max(0, -y_pos);
-  
-  int end_x = std::min(brush.width, target-&gt;w  - x_pos);
-  int end_y = std::min(brush.rows,  target-&gt;h - y_pos);
-
-  unsigned char* target_buf = static_cast&lt;unsigned char*&gt;(target-&gt;pixels);
-
-  int target_pitch = target-&gt;pitch;
-
-  for (int y = start_y; y &lt; end_y; ++y)
-    for (int x = start_x; x &lt; end_x; ++x)
-      {
-        int target_pos = (y + y_pos) * target_pitch + 4*(x + x_pos);
-        int brush_pos  = y * brush.pitch + x;
-            
-        target_buf[target_pos + 0] = 255;
-        target_buf[target_pos + 1] = 255;
-        target_buf[target_pos + 2] = 255;
-        target_buf[target_pos + 3] = brush.buffer[brush_pos];
-      }
-    
-  SDL_UnlockSurface(target);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/blitter.hpp
===================================================================
--- trunk/windstille/src/blitter.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/blitter.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,42 +0,0 @@
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef HEADER_BLITTER_HPP
-#define HEADER_BLITTER_HPP
-
-#include &lt;SDL.h&gt;
-
-#include &lt;ft2build.h&gt;
-#include FT_FREETYPE_H
-#include FT_GLYPH_H
-
-/** Duplicate all the edge pixel of the given rectangle to the outside
-    of the rectangle, thus creating a border around the given
-    rectangle, this is needed for OpenGL textures to avoid filtering
-    artefacts:
-
-    X X X X X    1 1 2 3 3
-    X 1 2 3 X _\ 1 1 2 3 3
-    X 4 5 6 X  / 4 4 5 6 6
-    X X X X X    4 4 5 6 6
-*/
-void generate_border(SDL_Surface* surface, int x_pos, int y_pos, int width, int height);
-void blit_ftbitmap(SDL_Surface* target, const FT_Bitmap&amp; brush, int x_pos, int y_pos);
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/console.cpp
===================================================================
--- trunk/windstille/src/console.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/console.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -19,7 +19,7 @@
 #include &lt;assert.h&gt;
 #include &quot;math/rect.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;game_session.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;display/display.hpp&quot;

Deleted: trunk/windstille/src/controller_help_window.cpp
===================================================================
--- trunk/windstille/src/controller_help_window.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/controller_help_window.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,114 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;text_area.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;controller_help_window.hpp&quot;
-
-ControllerHelpWindow* ControllerHelpWindow::current_ = 0;
-
-class ControllerHelpWindowImpl
-{
-public:
-  TextArea* text_area;
-  bool active;
-};
-
-ControllerHelpWindow::ControllerHelpWindow()
-  : impl(new ControllerHelpWindowImpl)
-{
-  current_ = this;
-  int width  = 200;
-  int height = 120;
-  
-  impl-&gt;active = false;
-  impl-&gt;text_area = new TextArea(Rect(Point(Display::get_width() - width - 16,
-                                            Display::get_height() - height - 16),
-                                      Size(width, height)), false);
-  impl-&gt;text_area-&gt;set_font(Fonts::ttffont);
-  impl-&gt;text_area-&gt;set_text(&quot;Control Help\n&quot;
-                            &quot;------------\n&quot;
-                            &quot;walk: left/right\n&quot;
-                            &quot;duck: down\n\n&quot;
-                            &quot;primary/run:    s\n&quot;
-                            &quot;secondary/jump: d\n&quot;
-                            &quot;tertiary:       a\n&quot;
-                            &quot;pda:            w\n&quot;
-                            );
-}
-
-void
-ControllerHelpWindow::draw()
-{
-  if (!impl-&gt;active)
-    return;
-    
-  const Rectf&amp; rect = impl-&gt;text_area-&gt;get_rect().grow(8.0f);
-
-  Display::fill_rounded_rect(rect, 16.0f, Color(0.3f, 0.3f, 0.5f, 0.5f));
-  Display::draw_rounded_rect(rect, 16.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-  impl-&gt;text_area-&gt;draw();
-
-  Controller controller = InputManager::get_controller();
-  
-  Rectf crect(Vector(rect.right - 100, rect.top - 100 - 8.0f),
-              Size(100, 100));
-
-  Display::fill_rounded_rect(crect, 10.0f, Color(1.0f, 1.0f, 1.0f, 0.2f));
-  Display::draw_rounded_rect(crect, 10.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-
-  Vector pos(crect.left + crect.get_width()/2  + controller.get_axis_state(X_AXIS) * (crect.get_width()-16.0f)/2,
-             crect.top  + crect.get_height()/2 + controller.get_axis_state(Y_AXIS)   * (crect.get_width()-16.0f)/2);
-
-  Display::fill_circle(pos, 10.0f, Color(0.8f, 0, 0));
-  Display::draw_circle(pos, 10.0f, Color(1.0f, 0, 0));
-
-  for(int i = 0; i &lt; 6; ++i)
-    {
-      if (controller.get_button_state(i))
-        {
-          Display::fill_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
-                               10.0f, Color(0.8f, 0, 0));
-          Display::draw_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
-                               10.0f, Color(1.0f, 0.0f, 0.0f));
-        }
-      else
-        {
-          Display::fill_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
-                               10.0f, Color(1.0f, 1.0f, 1.0f, 0.2f));
-          Display::draw_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
-                               10.0f,  Color(1.0f, 1.0f, 1.0f, 0.5f));
-        }
-    }
-}
-
-void
-ControllerHelpWindow::update(float delta, const Controller&amp; )
-{
-  impl-&gt;text_area-&gt;update(delta);
-}
-
-void
-ControllerHelpWindow::set_active(bool active)
-{
-  impl-&gt;active = active;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/controller_help_window.hpp
===================================================================
--- trunk/windstille/src/controller_help_window.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/controller_help_window.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,45 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CONTROLLER_HELP_WINDOW_HPP
-#define HEADER_WINDSTILLE_CONTROLLER_HELP_WINDOW_HPP
-
-#include &quot;screen.hpp&quot;
-#include &lt;boost/shared_ptr.hpp&gt;
-
-class ControllerHelpWindowImpl;
-
-/** */
-class ControllerHelpWindow : public Screen
-{
-public:
-  ControllerHelpWindow();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-  void set_active(bool active);
-  static ControllerHelpWindow* current() { return current_; }
-
-private:
-  boost::shared_ptr&lt;ControllerHelpWindowImpl&gt; impl;
-  static ControllerHelpWindow* current_;
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/conversation.cpp
===================================================================
--- trunk/windstille/src/conversation.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/conversation.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,181 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;math/math.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;math/rect.hpp&quot;
-#include &quot;engine/script_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;conversation.hpp&quot;
-#include &quot;pda.hpp&quot;
-#include &quot;game_session.hpp&quot;
-
-Conversation* Conversation::current_ = 0;
-
-Conversation::Conversation()
-  : pos(400, 300),
-    time(0)
-{
-  current_ = this;
-  active = false;
-  selection = 0;
-}
-
-void
-Conversation::add(const std::string&amp; text)
-{
-  if (!active)
-    {
-      choices.push_back(Choice(text, &quot;&quot;));
-      if (selection &gt;= int(choices.size()))
-        selection = 0;
-    }
-}
-
-void
-Conversation::add(const std::string&amp; topic, const std::string&amp; text)
-{
-  if (!active)
-    {
-      choices.push_back(Choice(topic, text));
-      if (selection &gt;= int(choices.size()))
-        selection = 0;
-    }
-}
-
-void
-Conversation::draw()
-{
-  if (!active)
-    return;
-  
-  Display::fill_circle(pos, 42.0f, Color(0.5f, 0.5f, 0.5f, 0.75f), 24);
-
-  float segment = 360.0f / choices.size();
-
-  for(int i = 0; i &lt; choices.size(); ++i)
-    { // FIXME:
-      Vector offset(0.0f, 1.0f);
-      offset = offset.rotate(math::deg2rad(segment*i) - M_PI/2);
-
-      float start = -segment/2 - 90.0f + segment*i;
-      float end   = -segment/2 - 90.0f + segment*(i+1);
-      
-      float distance = 160.0f;
-
-      Vector textpos = pos + Vector(0, 16.0f);
-      // FIXME: Doesn't handle multi line text
-      Sizef size(Fonts::vera20-&gt;get_width(choices[i].topic) + 50,
-                 Fonts::vera20-&gt;get_height() + 30);
-      Rectf  rect(textpos + distance * offset - Vector(size.width/2, size.height - 15), size);
-
-      if (i == selection)
-        {
-          rect = rect.grow(grow);
-          
-          Display::fill_arc(pos, 42.0f, start, end, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
-          Display::fill_rounded_rect(rect, 5.0f, Color(0.5f, 0.5f, 0.5f, 0.75f));
-          Fonts::vera20-&gt;draw_center(textpos.x + distance * offset.x,
-                                     textpos.y + distance * offset.y, 
-                                     choices[i].topic, Color(1.0f, 1.0f, 1.0f));
-
-          Fonts::vera20-&gt;draw_center(400, 600 - 64,
-                                     choices[i].text, Color(1.0f, 1.0f, 1.0f));
-        }
-      else
-        {
-          Display::fill_rounded_rect(rect, 5.0f, Color(0.25f, 0.25f, 0.25f, 0.75f));
-          Fonts::vera20-&gt;draw_center(textpos.x + distance * offset.x,
-                                     textpos.y + distance * offset.y,
-                                     choices[i].topic, Color(0.5f, 0.5f, 0.5f));
-        }
-
-      Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 1.0f));
-
-      //Display::draw_arc(pos + 5.0f * offset, 32.0f,
-      //                  start, end,
-      //                  Color(1.0f, 1.0f, 1.0f, 1.0f), 24);
-
-    }
-  Display::draw_circle(pos, 42.0f, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
-
-  Display::fill_circle(pos + direction * 34.0f, 8.0f, Color(1.0f, 1.0f, 1.0f));
-  //Display::draw_line(pos, pos + direction*32.0f, Color(0.0f, 0.0f, 0.0f));
-}
-
-void
-Conversation::update(float delta, const Controller&amp; controller)
-{
-  time += delta;
-
-  if (!active)
-    return;
-
-  grow = fabs(sinf(time * 3.0f)) * 4.0f;
-
-  direction = Vector(controller.get_axis_state(X_AXIS),
-                     controller.get_axis_state(Y_AXIS));
-
-  if (fabs(controller.get_axis_state(X_AXIS)) &gt; 0.3f ||
-      fabs(controller.get_axis_state(Y_AXIS)) &gt; 0.3f)
-    {
-      float segment = 360.0f / choices.size();
-      float angle = math::rad2deg(math::normalize_angle(atan2f(direction.y, direction.x) + M_PI/2 + math::deg2rad(segment/2.0f)));
-
-      int new_selection = int(angle / segment);
-      new_selection = math::mid(0, new_selection, int(choices.size()));
-
-      if (new_selection != selection) {
-        selection = new_selection;
-        // FIXME: Might be a good idea to do the woople-size per button, not globaly
-        grow = 0.0f;
-        time = 0;
-      }
-    }
-  else
-    {
-      selection = -1;
-    }
-  
-  if (controller.button_was_pressed(OK_BUTTON) &amp;&amp; selection != -1)
-    {
-      active = false;
-      GameSession::current()-&gt;get_pda().add_dialog(&quot;Jane&quot;,
-                                                   choices[selection].topic + &quot; - &quot; +
-                                                   choices[selection].text);
-      choices.clear();
-      GameSession::current()-&gt;set_control_state(GameSession::GAME);
-      script_manager-&gt;fire_wakeup_event(ScriptManager::CONVERSATION_CLOSED);
-    }
-}
-
-int
-Conversation::get_selection() const
-{
-  return selection;
-}
-
-void
-Conversation::show()
-{
-  active = true;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/conversation.hpp
===================================================================
--- trunk/windstille/src/conversation.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/conversation.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,68 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CONVERSATION_HPP
-#define HEADER_WINDSTILLE_CONVERSATION_HPP
-
-#include &lt;vector&gt;
-#include &lt;string&gt;
-#include &quot;screen.hpp&quot;
-
-/** Displays a list of text strings from which the user can select
-    one, used to form multiple-choice dialogs */
-class Conversation : public Screen
-{
-private:
-  Vector pos;
-  Vector direction;
-  bool   active;
-  int    selection;
-  float  grow;
-  float  time;
-
-  struct Choice {
-    Choice(const std::string topic_,
-           const std::string text_)
-      : topic(topic_), 
-        text(text_) 
-    {}
-    std::string topic;
-    std::string text;
-  };
-
-  typedef std::vector&lt;Choice&gt; Choices;
-  Choices choices;
-  
-  static Conversation* current_;
-public:
-  static Conversation* current() { assert(current_); return current_; }
-  
-  Conversation();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-  void add(const std::string&amp; text);
-  void add(const std::string&amp; topic, const std::string&amp; text);
-  int  get_selection() const;
-  void show();
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/dialog_manager.cpp
===================================================================
--- trunk/windstille/src/dialog_manager.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/dialog_manager.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,192 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;game_session.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;dialog_manager.hpp&quot;
-#include &quot;engine/script_manager.hpp&quot;
-#include &quot;text_area.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;config.hpp&quot;
-
-DialogManager* DialogManager::current_ = 0;
-
-DialogManager::DialogManager()
-{
-  current_ = this;
-  text_area = 0;
-}
-
-DialogManager::~DialogManager()
-{
-  delete text_area;
-}
-
-void
-DialogManager::add_dialog(int alignment_, const std::string&amp; portrait_, const std::string&amp; text_)
-{ 
-  delay     = 0.0;
-  alignment = alignment_;
-  portrait  = Sprite(portrait_);
-  portrait.set_scale(0.65f);
-  text      = text_;
-  caption = false;
-  
-  create_text();
-}
-
-void
-DialogManager::add_caption(int alignment_, const std::string&amp; text_)
-{
-  delay     = 0.0;
-  alignment = alignment_;
-  text      = text_;
-  caption = true;
-  
-  create_text();
-}
-
-void
-DialogManager::draw()
-{
-  int dialog_height = std::max(portrait_height + portrait_border_y*2,
-                               int(text_area-&gt;get_rect().get_height()
-                                   + text_border_y * 2.0f));
-
-  Point pos(0,0);
-  if(alignment &amp; LEFT) {
-    pos.x = outer_border_x;
-  } else if(alignment &amp; RIGHT) {
-    pos.x = Display::get_width() - dialog_width - outer_border_x;
-  } else {
-    pos.x = (Display::get_width() - dialog_width) / 2;
-  }
-
-  if(alignment &amp; TOP) {
-    pos.y = outer_border_y;
-  } else if(alignment &amp; BOTTOM) {
-    pos.y = Display::get_height() - dialog_height - outer_border_y;
-  } else {
-    pos.y = (Display::get_height() - dialog_height) / 2;
-  }
-
-  if (!caption) {
-    Rectf rect(pos.x,
-               pos.y,
-               pos.x + dialog_width,
-               pos.y + 200);
-    
-    Display::fill_rounded_rect(rect, 16.0f,
-                               Color(0, 0, 0.3f, 0.5f));
-    Display::draw_rounded_rect(rect, 16.0f,
-                               Color(0.6f, 1.0f, 1.0f, 0.8f));
-  
-    portrait.draw(Vector(pos.x + portrait_border_x,
-                         pos.y + portrait_border_y));
-  }
-  
-  text_area-&gt;draw();
-
-  if (text_area-&gt;is_progress_complete())
-    {
-      const Vector&amp; pos = text_area-&gt;get_cursor_pos();
-      Rectf cursor(pos.x + 8, pos.y + 8, pos.x + 24, pos.y + 24);
-      Display::fill_rect(cursor, Color(1.0, 1.0, 1.0, fabs(sin(SDL_GetTicks() / 1000.0f * M_PI * 3.0f))));
-    }
-}
-
-void
-DialogManager::update(float delta, const Controller&amp; controller)
-{
-  text_area-&gt;update(delta);
-
-  delay += delta;
-
-  InputEventLst events = controller.get_events();
-	
-  for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
-    {
-      if ((*i).type == BUTTON_EVENT)
-        {
-          if ((*i).button.name == OK_BUTTON &amp;&amp; (*i).button.down == true)
-            {
-              if (text_area-&gt;is_progress_complete())
-                {
-                  GameSession::current()-&gt;set_control_state(GameSession::GAME);
-                  script_manager-&gt;fire_wakeup_event(ScriptManager::DIALOG_CLOSED);
-                }
-              else if (delay &gt; 0.2)
-                text_area-&gt;set_progress_complete();
-            } 
-        }
-    }
-}
-
-void
-DialogManager::create_text()
-{
-  if (caption)
-    outer_border_y = 0;
-  else
-    outer_border_y = 20;
-    
-  Point pos(0,0);
-  if(alignment &amp; LEFT) {
-    pos.x = outer_border_x;
-  } else if(alignment &amp; RIGHT) {
-    pos.x = Display::get_width() - dialog_width - outer_border_x;
-  } else {
-    pos.x = (Display::get_width() - dialog_width) / 2;
-  }
-      
-  int text_width
-    = dialog_width - portrait_height - portrait_border_x*2 - text_border_x;
-  Rect text_rect = Rect(Point(pos.x + portrait_width + portrait_border_x*2, 0),
-                        Size(500, 200)); // FIXME: use real bounding box calc
-  
-  text_rect.bottom = text_rect.top + text_rect.get_height();
-  text_rect.top    = pos.y + text_border_y;
-
-  int dialog_height = std::max(portrait_height + portrait_border_y*2,
-                               text_rect.get_height() + text_border_y*2);
-
-  if(alignment &amp; TOP) {
-    pos.y = outer_border_y;
-  } else if(alignment &amp; BOTTOM) {
-    pos.y = Display::get_height() - dialog_height - outer_border_y;
-  } else {
-    pos.y = (Display::get_height() - dialog_height) / 2;
-  }
-
-  text_rect.bottom = text_rect.top + text_rect.get_height();
-  text_rect.top = pos.y + text_border_y;
-
-  Size dialog_size(dialog_width, dialog_height);
-
-
-  delete text_area;
-  text_area = new TextArea(Rect(Point(text_rect.left, text_rect.top + Fonts::vera20-&gt;get_height()),
-                                Size(text_width, 200)), true);
-  text_area-&gt;set_font(Fonts::vera20);
-  text_area-&gt;set_text(text);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/dialog_manager.hpp
===================================================================
--- trunk/windstille/src/dialog_manager.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/dialog_manager.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,78 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_DIALOG_MANAGER_HPP
-#define HEADER_WINDSTILLE_DIALOG_MANAGER_HPP
-
-#include &lt;vector&gt;
-#include &lt;string&gt;
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-class TextArea;
-
-/** */
-class DialogManager : public Screen
-{
-private:
-  void create_text();
-  
-  Sprite portrait;
-  std::string text;
-  float delay;
-  TextArea* text_area;
-
-  enum Alignment {
-    VCENTER = 0x00,
-    LEFT    = 0x01,
-    RIGHT   = 0x02,
-    HCENTER = 0x00,
-    TOP     = 0x10,
-    BOTTOM  = 0x20
-  };
-  int alignment;
-  bool caption;
-  
-  static const int dialog_width = 600;
-  static const int portrait_border_x = 10;
-  static const int portrait_border_y = 10;
-  static const int text_border_x = 10;
-  static const int text_border_y = 10;
-  static const int portrait_width = 180;
-  static const int portrait_height = 192;
-  static const int outer_border_x = 20;
-  int outer_border_y;
-
-  static DialogManager* current_;
-public:
-  static DialogManager* current() { return current_; }
-
-  DialogManager();
-  ~DialogManager();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-  void add_dialog(int alignment, const std::string&amp; portrait, const std::string&amp; text);
-  void add_caption(int alignment, const std::string&amp; text);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/windstille/src/display/blitter.cpp (from rev 2466, trunk/windstille/src/blitter.cpp)


Property changes on: trunk/windstille/src/display/blitter.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/display/blitter.hpp (from rev 2466, trunk/windstille/src/blitter.hpp)


Property changes on: trunk/windstille/src/display/blitter.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/display/graphic_context_state.cpp (from rev 2466, trunk/windstille/src/graphic_context_state.cpp)


Property changes on: trunk/windstille/src/display/graphic_context_state.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/display/graphic_context_state.hpp (from rev 2466, trunk/windstille/src/graphic_context_state.hpp)


Property changes on: trunk/windstille/src/display/graphic_context_state.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/display/text_area.cpp (from rev 2466, trunk/windstille/src/text_area.cpp)


Property changes on: trunk/windstille/src/display/text_area.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/display/text_area.hpp (from rev 2466, trunk/windstille/src/text_area.hpp)


Property changes on: trunk/windstille/src/display/text_area.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Deleted: trunk/windstille/src/energy_bar.cpp
===================================================================
--- trunk/windstille/src/energy_bar.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/energy_bar.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,60 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;globals.hpp&quot;
-#include &quot;objects/player.hpp&quot;
-#include &quot;energy_bar.hpp&quot;
-
-EnergyBar::EnergyBar()
-  : bar(&quot;images/energy_bar.sprite&quot;)
-{
-}
-
-EnergyBar::~EnergyBar()
-{
-}
-  
-void
-EnergyBar::draw()
-{
-  int energy     = Player::current()-&gt;get_energy();
-  int max_energy = Player::current()-&gt;get_max_energy();
-
-  for(int i = 0; i &lt; energy; ++i)
-    {
-      float red   = 1.0f;
-      float green = (i/float(max_energy));
-      Sprite sprite = bar;
-      sprite.set_color(Color(red, green, 0, 1.0f));
-      sprite.draw(Vector(15 + (i * 10), 15));
-    }
-
-  for(int i = energy; i &lt; max_energy; ++i)
-    {
-      bar.set_color(Color(.5f, .5f, .5f, .5f));
-      bar.draw(Vector(15 + (i * 10), 15));
-    }
-}
-
-void
-EnergyBar::update(float delta, const Controller&amp; )
-{
-  bar.update(delta);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/energy_bar.hpp
===================================================================
--- trunk/windstille/src/energy_bar.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/energy_bar.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,43 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_ENERGY_BAR_HPP
-#define HEADER_WINDSTILLE_ENERGY_BAR_HPP
-
-#include &quot;screen.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-
-/** */
-class EnergyBar : public Screen
-{
-private:
-  Sprite bar;
-public:
-  EnergyBar();
-  ~EnergyBar();
-  
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-private:
-  EnergyBar (const EnergyBar&amp;);
-  EnergyBar&amp; operator= (const EnergyBar&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/font/ttf_font.cpp
===================================================================
--- trunk/windstille/src/font/ttf_font.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/font/ttf_font.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -28,7 +28,7 @@
 #include &quot;display/opengl_state.hpp&quot;
 #include &quot;physfs/physfs_stream.hpp&quot;
 #include &quot;display/texture_manager.hpp&quot;
-#include &quot;blitter.hpp&quot;
+#include &quot;display/blitter.hpp&quot;
 #include &quot;ttf_font.hpp&quot;
 #include &quot;font_effect.hpp&quot;
 #include &quot;util/util.hpp&quot;

Deleted: trunk/windstille/src/game_session.cpp
===================================================================
--- trunk/windstille/src/game_session.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/game_session.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,496 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;math.h&gt;
-#include &lt;sstream&gt;
-#include &lt;stdarg.h&gt;
-
-#include &lt;squirrel.h&gt; 
-#include &lt;sqstdio.h&gt; 
-#include &lt;sqstdaux.h&gt; 
-
-#include &quot;menu_manager.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;engine/sector.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;engine/game_object.hpp&quot;
-#include &quot;objects/player.hpp&quot;
-#include &quot;tile/tile_map.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;view.hpp&quot;
-#include &quot;timer.hpp&quot;
-#include &quot;energy_bar.hpp&quot;
-#include &quot;dialog_manager.hpp&quot;
-#include &quot;windstille_main.hpp&quot;
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;scripting/util.hpp&quot;
-#include &quot;scripting/wrapper.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;particles/particle_system.hpp&quot;
-#include &quot;particles/spark_drawer.hpp&quot;
-#include &quot;particles/surface_drawer.hpp&quot;
-#include &quot;engine/script_manager.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-#include &quot;conversation.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &quot;objects/test_object.hpp&quot;
-#include &quot;inventory.hpp&quot;
-#include &quot;display/surface_manager.hpp&quot;
-#include &quot;display/surface.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;pda.hpp&quot;
-
-#include &quot;game_session.hpp&quot;
-
-GameSession* GameSession::current_ = 0; 
-
-class GameSessionImpl
-{
-public:
-  SceneContext sc;
-
-  float fadeout_value;
-  float fade_time;
-  Sector* sector;
-  View    view;
-
-  std::string filename;
-
-  bool pause;
-  
-  /** Amount of how far the cutscene bars are visible, 0.0 means not
-      visible, 1.0 fully visible. */
-  float cutscene_value;
-
-  /** True if cutscene is active, false otherwhise */
-  bool  cutscene_mode;
-
-  enum { NO_ACTION, QUIT_ACTION, CHANGE_SECTOR_ACTION } next_action;
-  
-  enum { FADEIN, RUNNING, FADEOUT } fade_state;
-
-  Color fade_color;
-
-  // GUI Elements
-  ControllerHelpWindow controller_help_window;
-  EnergyBar     energy_bar;
-
-  // Active GUI Elements
-  DialogManager dialog_manager;
-  Conversation  conversation;
-  Inventory     inventory;
-  PDA           pda;
-
-  Screen* current_gui;
-
-  GameSessionImpl() {
-    sector         = 0;
-    current_gui    = 0;
-    cutscene_mode  = false;
-    cutscene_value = 0.0f;
-    fade_color     = Color(0.0f, 0.0f, 0.0f, 1.0f);
-    fade_state     = RUNNING;
-    fadeout_value  = 0.0f;
-    fade_time      = 1.0f;
-  }
-  ~GameSessionImpl() {
-    delete sector;
-  }
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-  void handle_event(const SDL_Event&amp; event);
-};
-
-GameSession::GameSession(const std::string&amp; arg_filename)
-  : impl(new GameSessionImpl())
-{
-  impl-&gt;filename = arg_filename;
-
-  if (debug) std::cout &lt;&lt; &quot;Creating new GameSession&quot; &lt;&lt; std::endl;
-  current_ = this;
-
-  impl-&gt;pause = false;
-  
-  if (1)
-    script_manager-&gt;run_script_file(&quot;scripts/init_script_vars.nut&quot;);
-    
-  set_sector(impl-&gt;filename);
-}
-
-GameSession::~GameSession()
-{
-}
-
-void
-GameSessionImpl::draw()
-{
-  view.draw(sc);
-
-  // Render the scene to the screen
-  sc.render();
-
-  if (!cutscene_mode)
-    {
-      // Draw HUD
-      energy_bar.draw();
-      controller_help_window.draw();
-    }
-
-  if (cutscene_mode || cutscene_value &gt; 0.0f)
-    {
-      int border_size = static_cast&lt;int&gt;(75 * cutscene_value);
-      Display::fill_rect(Rect(Point(0, 0), Size(Display::get_width(), border_size)), 
-                         Color(0.0f, 0.0f, 0.0f, cutscene_value));
-      Display::fill_rect(Rect(Point(0, Display::get_height() - border_size), Size(Display::get_width(), border_size)), 
-                         Color(0.0f, 0.0f, 0.0f, cutscene_value));
-    }
-
-  if (current_gui)
-    current_gui-&gt;draw();
-
-  if (fade_state == FADEOUT || fade_state == FADEIN)
-    {
-      Display::fill_rect(Rect(0, 0, 
-                               Display::get_width(), Display::get_height()),
-                         Color(fade_color.r, fade_color.g, fade_color.b, fadeout_value));
-    }
-
-  if (pause)
-    {
-      if ((SDL_GetTicks() / 1000) % 2)
-        Fonts::vera20-&gt;draw(Display::get_width()/2, Display::get_height()/2, &quot;Pause&quot;);
-    }
-}
-
-void
-GameSessionImpl::update(float delta, const Controller&amp; controller)
-{  
-  if (cutscene_mode)
-    cutscene_value += delta * 0.75f;
-  else
-    cutscene_value -= delta * 0.75f;
-
-  if (cutscene_value &gt; 1.0f)
-    cutscene_value = 1.0f;
-  else if (cutscene_value &lt; 0.0f)
-    cutscene_value = 0.0f;
-
-  // if (controller.button_was_pressed(PAUSE_BUTTON))
-  // pause = !pause;
-
-  Uint8 *keystate = SDL_GetKeyState(NULL);
-
-  if(keystate[SDLK_KP1])
-    game_speed *= 1.0 - delta;
-  if(keystate[SDLK_KP3])
-    game_speed *= 1.0 + delta;
-  if(keystate[SDLK_KP5])
-    game_speed = 1.0;
- 
-  delta *= game_speed;
-
-  if (!pause)
-    {
-      game_time += delta;
-      script_manager-&gt;update();
-      
-      view.update(delta, controller);
-      sector-&gt;update(delta);
-  
-      switch (fade_state)
-        {
-        case FADEIN:
-          if (fadeout_value &lt;= 0.0f)
-            {
-              fade_state = RUNNING;
-              fadeout_value = 0.0f;
-              script_manager-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
-            }
-          else
-            {
-              fadeout_value -= delta * fade_time;
-            }
-          break;
-
-        case FADEOUT:
-          if (fadeout_value &gt;= 1.0f)
-            { 
-              fadeout_value = 1.0f;
-              script_manager-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
-
-              switch(next_action)
-                {
-                case CHANGE_SECTOR_ACTION:
-                  GameSession::current()-&gt;set_sector(filename);
-                  break;
-
-                case QUIT_ACTION:
-                  screen_manager.quit();
-                  break;
-
-                default:
-                  break;
-                }
-            }
-          else
-            {
-              fadeout_value += delta * fade_time;
-            }
-          break;
-
-        case RUNNING:
-          energy_bar.update(delta, controller);
-          if (current_gui)
-            current_gui-&gt;update(delta, controller);
-          break;
-        }
-      
-      controller_help_window.update(delta, controller);
-    }
-
-  if (controller.button_was_pressed(PDA_BUTTON))
-    {
-      if (current_gui == &amp;pda)
-        current_gui = 0;
-      else
-        current_gui = &pda;
-    }
-  else if (controller.button_was_pressed(INVENTORY_BUTTON))
-    {
-      if (current_gui == &amp;inventory)
-        current_gui = 0;
-      else
-        current_gui = &inventory;
-    }
-  else if (controller.button_was_pressed(ESCAPE_BUTTON) ||
-           controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      menu_manager.display_pause_menu();
-    }
-}
-
-void
-GameSession::change_sector(const std::string&amp; arg_filename)
-{
-  impl-&gt;filename = arg_filename;
- 
-  sound_manager-&gt;stop_music();
-
-  if (impl-&gt;fade_state == GameSessionImpl::FADEOUT)
-    {
-      GameSession::current()-&gt;set_sector(impl-&gt;filename);
-    }
-  else
-    {
-      impl-&gt;fade_time     = 1.0f;
-      impl-&gt;fade_state    = GameSessionImpl::FADEOUT;
-      impl-&gt;next_action   = GameSessionImpl::CHANGE_SECTOR_ACTION;
-    }
-}
-
-void
-GameSession::set_sector(const std::string&amp; )
-{
-  delete impl-&gt;sector;
-  impl-&gt;sector = new Sector(impl-&gt;filename);
- 
-  GameObject::set_world(impl-&gt;sector);
-
-  //FIXME: does the TestObject class still need to exist?
-  //sector-&gt;add(new TestObject());
-  
-  impl-&gt;sector-&gt;activate();
-  
-  if (debug) std::cout &lt;&lt; &quot;Finished changing sector&quot; &lt;&lt; std::endl;
-}
-
-void
-GameSessionImpl::handle_event(const SDL_Event&amp; event)
-{
-  switch(event.type)
-  {
-    case SDL_KEYDOWN:
-    case SDL_KEYUP:
-      if (event.key.state)
-        {    
-          switch (event.key.keysym.sym)
-            {
-            case SDLK_1:
-              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::COLORMAP);
-              console &lt;&lt; &quot;Toggled COLORMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::COLORMAP) &gt; 0) &lt;&lt; std::endl;
-              break;
-
-            case SDLK_2:
-              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAP);
-              console &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAP) &gt; 0) &lt;&lt; std::endl;
-              break;
-      
-            case SDLK_3:
-              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::HIGHLIGHTMAP);
-              console &lt;&lt; &quot;Toggled HIGHLIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::HIGHLIGHTMAP) &gt; 0) &lt;&lt; std::endl;
-              break;      
-  
-            case SDLK_4:
-              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAPSCREEN);
-              console &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAPSCREEN) &gt; 0) &lt;&lt; std::endl;
-              break;
-
-            case SDLK_5:
-              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::BLURMAP);
-              console &lt;&lt; &quot;Toggled blurmap: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::BLURMAP) &gt; 0) &lt;&lt; std::endl;
-              break;
-
-
-            case SDLK_c:
-              if (debug) {
-                collision_debug = !collision_debug;
-                console &lt;&lt; &quot;Collision Debugging &quot; &lt;&lt; (collision_debug ? &quot;enabled&quot; : &quot;disabled&quot;) &lt;&lt; std::endl;
-              }
-              break;
-
-            case SDLK_F2:
-              menu_manager.display_debug_menu();
-              break;
-        
-            default:
-              break;
-            }
-        }
-      break;
-        
-    case SDL_MOUSEBUTTONDOWN:
-      {
-        Vector real_pos = GameSession::current()-&gt;get_view()-&gt;screen_to_world(Vector(event.button.x,
-                                                                                  event.button.y));      
-        console &lt;&lt; &quot;Click at: &quot; &lt;&lt; int(real_pos.x) &lt;&lt; &quot;, &quot; &lt;&lt; int(real_pos.y) &lt;&lt; std::endl;
-      }
-      break;
-  }
-}
-
-void
-GameSession::quit()
-{
-  if (impl-&gt;fade_state != GameSessionImpl::FADEOUT)
-    {
-      sound_manager-&gt;stop_music();
-      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
-      impl-&gt;fade_time   = 1.0f;
-      impl-&gt;next_action = GameSessionImpl::QUIT_ACTION;
-    }
-}
-
-PDA&amp;
-GameSession::get_pda()
-{
-  return impl-&gt;pda;
-}
-
-void
-GameSession::draw()
-{
-  impl-&gt;draw();
-}
-
-void
-GameSession::update(float delta, const Controller&amp; controller)
-{
-  impl-&gt;update(delta, controller);
-}
-
-void
-GameSession::handle_event(const SDL_Event&amp; event)
-{
-  impl-&gt;handle_event(event);
-}
-
-View*
-GameSession::get_view() 
-{
-  return &amp;impl-&gt;view; 
-}
-
-void
-GameSession::set_control_state(ControlState state) 
-{
-  switch(state)
-    {
-    case DIALOG:
-      impl-&gt;current_gui = &amp;impl-&gt;dialog_manager;
-      break;
-
-    case CONVERSATION:
-      impl-&gt;current_gui = &amp;impl-&gt;conversation;
-      break;
-
-    case GAME:
-      impl-&gt;current_gui = 0;
-      break;
-    }
-}
-
-bool
-GameSession::is_active() const
-{
-  return (impl-&gt;current_gui == 0);
-}
-
-void
-GameSession::set_cutscene_mode(bool t)
-{
-  if (t != impl-&gt;cutscene_mode)
-    {
-      impl-&gt;cutscene_mode  = t;
-    }
-}
-
-void
-GameSession::fadeout(float time, const Color&amp; color)
-{
-  if (time == 0.0)
-    { // directly go to a state of solid color, no fading
-      impl-&gt;fadeout_value  = 1.0f;
-      impl-&gt;fade_color  = color;
-      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
-      impl-&gt;next_action = GameSessionImpl::NO_ACTION;
-    }
-  else
-    {
-      impl-&gt;fade_time   = 1.0f/time;
-      impl-&gt;fade_color  = color;
-      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
-      impl-&gt;next_action = GameSessionImpl::NO_ACTION;
-    }
-}
-
-void
-GameSession::fadein(float time)
-{
-  impl-&gt;fade_time   = 1.0f/time;
-  impl-&gt;fade_state  = GameSessionImpl::FADEIN;
-  impl-&gt;next_action = GameSessionImpl::NO_ACTION;
-}
-
-SceneContext*
-GameSession::get_scene_context()
-{
-  return &amp;(impl-&gt;sc);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/game_session.hpp
===================================================================
--- trunk/windstille/src/game_session.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/game_session.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,93 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_GAME_SESSION_HPP
-#define HEADER_WINDSTILLE_GAME_SESSION_HPP
-
-#include &lt;string&gt;
-#include &lt;squirrel.h&gt;
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;screen.hpp&quot;
-#include &quot;controller_help_window.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;globals.hpp&quot;
-
-class PDA;
-class EnergyBar;
-class View;
-class Sector;
-class Player;
-class DialogManager;
-class Conversation;
-class Inventory;
-
-class GameSessionImpl;
-
-class GameSession : public Screen
-{
-public:
-  enum ControlState { DIALOG, GAME, CONVERSATION };
-private:
-  static GameSession* current_; 
-public:
-  static GameSession* current() { return current_; } 
-
-  GameSession (const std::string&amp; arg_filename);
-  ~GameSession ();
-
-  View* get_view();
-
-  /** Return true when the gameplay is currently active, return false
-      if PDA, Conversation or other things are active */
-  bool is_active() const;
-
-  void set_control_state(ControlState state);
-
-  /** Switches the sector instantly without fadeout */
-  void set_sector(const std::string&amp; filename);
-
-  /** Fades out then switches sectors and fades in again */
-  void change_sector(const std::string&amp; filename);
-
-  /** Set the GameSession into a mode for cutscenes, this means for
-      most part to switch into a 16:9 viewmode with black borders */
-  void set_cutscene_mode(bool t);
-
-  /** \a time Time in seconds till the fade is complete 
-      \a color Color to which the screen should fade */
-  void fadeout(float time, const Color&amp; color);
-  void fadein(float time);
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-  void handle_event(const SDL_Event&amp; event);
-
-  PDA&amp; get_pda();
-
-  void quit();
-
-  SceneContext* get_scene_context();
-
-private:
-  boost::shared_ptr&lt;GameSessionImpl&gt; impl;
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/geometry_test.cpp
===================================================================
--- trunk/windstille/src/geometry_test.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/geometry_test.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,130 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &quot;geometry_test.hpp&quot;
-#include &quot;math/rect.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;math/size.hpp&quot;
-#include &quot;controller_def.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-
-GeometryTest::GeometryTest()
-{
-  point_count = 0;
-  had_prev_collision = true;
-
-  line1 = Line(Vector(300, 300),
-               Vector(500, 300));
-
-  line2 = Line(Vector(400, 200),
-               Vector(400, 400));
-
-  cursor  = line1.p1;
-  cursor2 = line1.p2;
-}
-
-void
-GeometryTest::draw()
-{
-  glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
-  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-
-  Display::draw_line(line1, Color(0.0f, 1.0f, 0.0f));
-  Display::draw_line(line2, Color(0.0f, 1.0f, 0.0f));
-
-  Display::fill_rect(Rectf(cursor - Vector(2,2), Sizef(5,5)),  Color(1.0f, 0.0f, 1.0f));
-  Display::fill_rect(Rectf(cursor2 - Vector(2,2), Sizef(5,5)), Color(1.0f, 1.0f, 0.0f));
-
-  Display::fill_rect(Rectf(collision_point - Vector(3,3), Sizef(7,7)), Color(1.0f, 1.0f, 1.0f));
-
-  // Try vector projection
-  Vector a(line1.p2 - line1.p1);
-  Vector b(line2.p2 - line2.p1);
-  Vector c(a.project(b));
-  
-  Display::draw_line(line1.p1, line1.p1 + c, Color(1.0f, 1.0f, 1.0f, 0.5f));
-
-  int segments = std::max(0, int(cursor.y / 10));
-
-  Display::fill_arc(Vector(200, 200), 100.0f, cursor.x, cursor2.x, Color(1.0f, 1.0f, 1.0f, 0.5f), segments);
-  Display::draw_arc(Vector(200, 200), 100.0f, cursor.x, cursor2.x, Color(1.0f, 1.0f, 1.0f), segments);
-  Display::draw_circle(Vector(200, 200), 128.0f, Color(1.0f, 1.0f, 1.0f), segments);
-}
-
-void
-GeometryTest::update(float delta, const Controller&amp; controller)
-{
-  if (controller.button_was_pressed(ESCAPE_BUTTON) ||
-      controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      screen_manager.pop_screen();
-    }
-
-  cursor.x += controller.get_axis_state(X_AXIS) * 500.0f * delta;
-  cursor.y += controller.get_axis_state(Y_AXIS) * 500.0f * delta;
-
-  cursor2.x += controller.get_axis_state(X2_AXIS) * 500.0f * delta;
-  cursor2.y += controller.get_axis_state(Y2_AXIS) * 500.0f * delta;
-
-  if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      if (point_count == 0) {
-        cursor  = line2.p1;
-        cursor2 = line2.p2;
-      } else {
-        cursor  = line1.p1;
-        cursor2 = line1.p2;
-      }
-
-      point_count += 1;
-      if (point_count &gt; 1)
-        point_count = 0;
-    }
-
-
-  if (point_count == 0)
-    {
-      line1.p1 = cursor;
-      line1.p2 = cursor2;
-    }
-  else if (point_count == 1)
-    {
-      line2.p1 = cursor;
-      line2.p2 = cursor2;
-    }
-
-  if (line1.intersect(line2, collision_point))
-    {
-      if (!had_prev_collision)
-        console &lt;&lt; &quot;Collision&quot; &lt;&lt; std::endl;
-      had_prev_collision = true;
-    }
-  else
-    {
-      if (had_prev_collision)
-        console &lt;&lt; &quot;No Collision&quot; &lt;&lt; std::endl;
-      had_prev_collision = false;
-      collision_point = Vector(32, 32);
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/geometry_test.hpp
===================================================================
--- trunk/windstille/src/geometry_test.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/geometry_test.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,53 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_GEOMETRY_TEST_HPP
-#define HEADER_WINDSTILLE_GEOMETRY_TEST_HPP
-
-#include &quot;screen.hpp&quot;
-#include &quot;math/vector.hpp&quot;
-#include &quot;math/line.hpp&quot;
-
-/** */
-class GeometryTest : public Screen
-{
-private:
-  Vector cursor;
-  Vector cursor2;
-  Vector collision_point;
-
-  int point_count;
-
-  Line line1;
-  Line line2;
-  bool had_prev_collision;
-
-public:
-  GeometryTest();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-private:
-  GeometryTest (const GeometryTest&amp;);
-  GeometryTest&amp; operator= (const GeometryTest&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/graphic_context_state.cpp
===================================================================
--- trunk/windstille/src/graphic_context_state.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/graphic_context_state.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,193 +0,0 @@
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;math.h&gt;
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;graphic_context_state.hpp&quot;
-
-class GraphicContextStateImpl
-{
-public:
-  int width;
-  int height;
-  
-  Vector offset;
-  float zoom;
-  float rotation;
-};
-
-GraphicContextState::GraphicContextState()
-  : impl(new GraphicContextStateImpl())
-{
-  impl-&gt;width  = 1;
-  impl-&gt;height = 1; 
-  impl-&gt;offset = Vector(0,0);
-  impl-&gt;zoom   = 1.0f;
-  impl-&gt;rotation = 0;
-}
-
-GraphicContextState::GraphicContextState(int w, int h)
-  : impl(new GraphicContextStateImpl())
-{  
-  impl-&gt;width  = w;
-  impl-&gt;height = h;
-  impl-&gt;offset = Vector(0,0); 
-  impl-&gt;zoom   = 1.0f;
-  impl-&gt;rotation = 0;
-}
-
-void
-GraphicContextState::set_size(int w, int h)
-{
-  impl-&gt;width  = w;
-  impl-&gt;height = h;
-}
-
-void
-GraphicContextState::push(SceneContext&amp; sc)
-{
-  sc.push_modelview();
-
-  sc.translate(impl-&gt;width/2, impl-&gt;height/2);
-  sc.rotate(impl-&gt;rotation);
-  sc.translate(-impl-&gt;width/2, -impl-&gt;height/2);
-
-  sc.scale(get_zoom(), get_zoom());
-  sc.translate(impl-&gt;offset.x, impl-&gt;offset.y);
-}
-
-void
-GraphicContextState::pop(SceneContext&amp; sc)
-{
-  sc.pop_modelview();
-}
-
-Rectf
-GraphicContextState::get_clip_rect()
-{
-  return Rectf(Vector(-impl-&gt;offset.x,
-                         -impl-&gt;offset.y),
-               Sizef(get_width()  / impl-&gt;zoom,
-                     get_height() / impl-&gt;zoom));
-}
-
-void
-GraphicContextState::set_pos(const Vector&amp; pos)
-{
-  impl-&gt;offset.x = -pos.x + (get_width()/2  / impl-&gt;zoom);
-  impl-&gt;offset.y = -pos.y + (get_height()/2 / impl-&gt;zoom);
-}
-
-Vector
-GraphicContextState::get_pos() const
-{
-  return Vector(-impl-&gt;offset.x + (get_width()/2  / impl-&gt;zoom),
-                   -impl-&gt;offset.y + (get_height()/2  / impl-&gt;zoom));
-}
-
-void
-GraphicContextState::set_zoom(const Vector&amp; pos, float z)
-{
-  float old_zoom = impl-&gt;zoom;
-  set_zoom(z);
-  impl-&gt;offset.x = pos.x/impl-&gt;zoom - pos.x/old_zoom + impl-&gt;offset.x;
-  impl-&gt;offset.y = pos.y/impl-&gt;zoom - pos.y/old_zoom + impl-&gt;offset.y;
-}
-
-void
-GraphicContextState::set_zoom(float z)
-{
-  impl-&gt;zoom = z;
-}
-
-float
-GraphicContextState::get_zoom()
-{
-  return impl-&gt;zoom;
-}
-
-void
-GraphicContextState::zoom_to (const Rectf&amp; rect)
-{
-  float center_x = (rect.left + rect.right) / 2.0f;
-  float center_y = (rect.top + rect.bottom) / 2.0f;
-
-  float width  = rect.right - rect.left;
-  float height = rect.bottom - rect.top;
-  float screen_relation = float(get_height())/float(get_width ());
-  float rect_relation   = height/width; 
-  
-  //std::cout &lt;&lt; &quot;Screen: &quot; &lt;&lt; screen_relation &lt;&lt; &quot; Zoom: &quot; &lt;&lt; rect_relation &lt;&lt; std::endl;
-  if (rect_relation &lt; screen_relation) // take width, ignore height
-    {
-      impl-&gt;zoom = get_width()/width; 
-    }
-  else // take height, ignore width
-    {
-      impl-&gt;zoom = get_height()/height;
-    }
-
-  impl-&gt;offset.x = (get_width()  / (2*impl-&gt;zoom)) - center_x;
-  impl-&gt;offset.y = (get_height() / (2*impl-&gt;zoom)) - center_y;
-}
-
-Vector
-GraphicContextState::screen_to_world(const Vector&amp; pos_)
-{
-  Vector pos(pos_.x, pos_.y);
-  float sa = sin(-impl-&gt;rotation/180.0f*M_PI);
-  float ca = cos(-impl-&gt;rotation/180.0f*M_PI);
-
-  float dx = pos.x - impl-&gt;width/2;
-  float dy = pos.y - impl-&gt;height/2;
-
-  pos.x = impl-&gt;width/2  + (ca * dx - sa * dy);
-  pos.y = impl-&gt;height/2 + (sa * dx + ca * dy);
-
-  Vector p((float(pos.x) / impl-&gt;zoom) - impl-&gt;offset.x, 
-              (float(pos.y) / impl-&gt;zoom) - impl-&gt;offset.y);
-
-  return p;
-}
-
-void
-GraphicContextState::set_rotation(float angle)
-{
-  impl-&gt;rotation = angle;
-}
-
-float
-GraphicContextState::get_rotation()
-{
-  return impl-&gt;rotation;
-}
-
-int
-GraphicContextState::get_width()  const 
-{
-  return impl-&gt;width; 
-}
-
-int
-GraphicContextState::get_height() const 
-{ 
-  return impl-&gt;height; 
-}
-
-/* EOF */

Deleted: trunk/windstille/src/graphic_context_state.hpp
===================================================================
--- trunk/windstille/src/graphic_context_state.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/graphic_context_state.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,77 +0,0 @@
-//  Flexlay - A Generic 2D Game Editor
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef HEADER_WINDSTILLE_GRAPHIC_CONTEXT_STATE_HPP
-#define HEADER_WINDSTILLE_GRAPHIC_CONTEXT_STATE_HPP
-
-#include &quot;math/rect.hpp&quot;
-#include &quot;math/vector.hpp&quot;
-#include &lt;boost/shared_ptr.hpp&gt;
-
-class SceneContext;
-
-class GraphicContextStateImpl;
-
-/** Helper class for capturing the state of a GraphicContext, with
-    additional convenience functions to make handling GraphicContexts
-    easier */
-class GraphicContextState
-{
-public:
-  GraphicContextState();
-  GraphicContextState(int w, int h);
-
-  void set_size(int w, int h);
-
-  void push(SceneContext&amp; sc);
-  void pop(SceneContext&amp; sc);
-
-  /** Return a rectangle in world coordinates that represents the area
-      visible on the screen */
-  Rectf get_clip_rect();
-
-  int get_width()  const;
-  int get_height() const;
-
-  /** Set the current rotation angel */
-  void  set_rotation(float angle);
-
-  /** Return the current rotation angel */
-  float get_rotation();
-
-  /** Move the center of the visible area to pos */
-  void      set_pos(const Vector&amp; pos);
-  Vector get_pos() const;
-
-  /** Set zoom to z, while ensuring that the screen position \a pos
-      (normaly the position of the mouse pointer) stays in the same
-      position even after zoomed in/out */
-  void  set_zoom(const Vector&amp; pos, float z);
-  void  set_zoom(float z);
-  float get_zoom(); 
-
-  void zoom_to (const Rectf&amp; rect);
-
-  Vector screen_to_world(const Vector&amp; pos);
-
-private:
-  boost::shared_ptr&lt;GraphicContextStateImpl&gt; impl;
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/gui/gui_manager.cpp
===================================================================
--- trunk/windstille/src/gui/gui_manager.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/gui/gui_manager.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -20,7 +20,7 @@
 #include &quot;button.hpp&quot;
 #include &quot;slider.hpp&quot;
 #include &quot;root_component.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
+#include &quot;screen/screen_manager.hpp&quot;
 #include &quot;grid_component.hpp&quot;
 #include &quot;tab_component.hpp&quot;
 #include &quot;list_view.hpp&quot;

Modified: trunk/windstille/src/gui/gui_manager.hpp
===================================================================
--- trunk/windstille/src/gui/gui_manager.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/gui/gui_manager.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_GUI_GUI_MANAGER_HPP
 #define HEADER_WINDSTILLE_GUI_GUI_MANAGER_HPP
 
-#include &quot;screen.hpp&quot;
+#include &quot;screen/screen.hpp&quot;
 
 namespace gui {
 

Modified: trunk/windstille/src/gui/text_view.hpp
===================================================================
--- trunk/windstille/src/gui/text_view.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/gui/text_view.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_GUI_TEXT_VIEW_HPP
 #define HEADER_WINDSTILLE_GUI_TEXT_VIEW_HPP
 
-#include &quot;text_area.hpp&quot;
+#include &quot;display/text_area.hpp&quot;
 #include &quot;component.hpp&quot;
 
 namespace gui {

Copied: trunk/windstille/src/hud/controller_help_window.cpp (from rev 2466, trunk/windstille/src/controller_help_window.cpp)
===================================================================
--- trunk/windstille/src/controller_help_window.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/controller_help_window.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,114 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;input/input_manager.hpp&quot;
+#include &quot;display/display.hpp&quot;
+#include &quot;display/text_area.hpp&quot;
+#include &quot;font/fonts.hpp&quot;
+#include &quot;controller_help_window.hpp&quot;
+
+ControllerHelpWindow* ControllerHelpWindow::current_ = 0;
+
+class ControllerHelpWindowImpl
+{
+public:
+  TextArea* text_area;
+  bool active;
+};
+
+ControllerHelpWindow::ControllerHelpWindow()
+  : impl(new ControllerHelpWindowImpl)
+{
+  current_ = this;
+  int width  = 200;
+  int height = 120;
+  
+  impl-&gt;active = false;
+  impl-&gt;text_area = new TextArea(Rect(Point(Display::get_width() - width - 16,
+                                            Display::get_height() - height - 16),
+                                      Size(width, height)), false);
+  impl-&gt;text_area-&gt;set_font(Fonts::ttffont);
+  impl-&gt;text_area-&gt;set_text(&quot;Control Help\n&quot;
+                            &quot;------------\n&quot;
+                            &quot;walk: left/right\n&quot;
+                            &quot;duck: down\n\n&quot;
+                            &quot;primary/run:    s\n&quot;
+                            &quot;secondary/jump: d\n&quot;
+                            &quot;tertiary:       a\n&quot;
+                            &quot;pda:            w\n&quot;
+                            );
+}
+
+void
+ControllerHelpWindow::draw()
+{
+  if (!impl-&gt;active)
+    return;
+    
+  const Rectf&amp; rect = impl-&gt;text_area-&gt;get_rect().grow(8.0f);
+
+  Display::fill_rounded_rect(rect, 16.0f, Color(0.3f, 0.3f, 0.5f, 0.5f));
+  Display::draw_rounded_rect(rect, 16.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+  impl-&gt;text_area-&gt;draw();
+
+  Controller controller = InputManager::get_controller();
+  
+  Rectf crect(Vector(rect.right - 100, rect.top - 100 - 8.0f),
+              Size(100, 100));
+
+  Display::fill_rounded_rect(crect, 10.0f, Color(1.0f, 1.0f, 1.0f, 0.2f));
+  Display::draw_rounded_rect(crect, 10.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+
+  Vector pos(crect.left + crect.get_width()/2  + controller.get_axis_state(X_AXIS) * (crect.get_width()-16.0f)/2,
+             crect.top  + crect.get_height()/2 + controller.get_axis_state(Y_AXIS)   * (crect.get_width()-16.0f)/2);
+
+  Display::fill_circle(pos, 10.0f, Color(0.8f, 0, 0));
+  Display::draw_circle(pos, 10.0f, Color(1.0f, 0, 0));
+
+  for(int i = 0; i &lt; 6; ++i)
+    {
+      if (controller.get_button_state(i))
+        {
+          Display::fill_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
+                               10.0f, Color(0.8f, 0, 0));
+          Display::draw_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
+                               10.0f, Color(1.0f, 0.0f, 0.0f));
+        }
+      else
+        {
+          Display::fill_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
+                               10.0f, Color(1.0f, 1.0f, 1.0f, 0.2f));
+          Display::draw_circle(Vector(crect.left - 16.0f, crect.top + (crect.get_height()-20)/3 * i + 10.0f),
+                               10.0f,  Color(1.0f, 1.0f, 1.0f, 0.5f));
+        }
+    }
+}
+
+void
+ControllerHelpWindow::update(float delta, const Controller&amp; )
+{
+  impl-&gt;text_area-&gt;update(delta);
+}
+
+void
+ControllerHelpWindow::set_active(bool active)
+{
+  impl-&gt;active = active;
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/controller_help_window.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/hud/controller_help_window.hpp (from rev 2466, trunk/windstille/src/controller_help_window.hpp)
===================================================================
--- trunk/windstille/src/controller_help_window.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/controller_help_window.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,45 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_CONTROLLER_HELP_WINDOW_HPP
+#define HEADER_WINDSTILLE_CONTROLLER_HELP_WINDOW_HPP
+
+#include &quot;screen/screen.hpp&quot;
+#include &lt;boost/shared_ptr.hpp&gt;
+
+class ControllerHelpWindowImpl;
+
+/** */
+class ControllerHelpWindow : public Screen
+{
+public:
+  ControllerHelpWindow();
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+  void set_active(bool active);
+  static ControllerHelpWindow* current() { return current_; }
+
+private:
+  boost::shared_ptr&lt;ControllerHelpWindowImpl&gt; impl;
+  static ControllerHelpWindow* current_;
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/controller_help_window.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/hud/conversation.cpp (from rev 2466, trunk/windstille/src/conversation.cpp)
===================================================================
--- trunk/windstille/src/conversation.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/conversation.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,181 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;math/math.hpp&quot;
+#include &quot;input/controller.hpp&quot;
+#include &quot;input/input_manager.hpp&quot;
+#include &quot;font/fonts.hpp&quot;
+#include &quot;math/rect.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
+#include &quot;display/display.hpp&quot;
+#include &quot;conversation.hpp&quot;
+#include &quot;pda.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
+
+Conversation* Conversation::current_ = 0;
+
+Conversation::Conversation()
+  : pos(400, 300),
+    time(0)
+{
+  current_ = this;
+  active = false;
+  selection = 0;
+}
+
+void
+Conversation::add(const std::string&amp; text)
+{
+  if (!active)
+    {
+      choices.push_back(Choice(text, &quot;&quot;));
+      if (selection &gt;= int(choices.size()))
+        selection = 0;
+    }
+}
+
+void
+Conversation::add(const std::string&amp; topic, const std::string&amp; text)
+{
+  if (!active)
+    {
+      choices.push_back(Choice(topic, text));
+      if (selection &gt;= int(choices.size()))
+        selection = 0;
+    }
+}
+
+void
+Conversation::draw()
+{
+  if (!active)
+    return;
+  
+  Display::fill_circle(pos, 42.0f, Color(0.5f, 0.5f, 0.5f, 0.75f), 24);
+
+  float segment = 360.0f / choices.size();
+
+  for(int i = 0; i &lt; choices.size(); ++i)
+    { // FIXME:
+      Vector offset(0.0f, 1.0f);
+      offset = offset.rotate(math::deg2rad(segment*i) - M_PI/2);
+
+      float start = -segment/2 - 90.0f + segment*i;
+      float end   = -segment/2 - 90.0f + segment*(i+1);
+      
+      float distance = 160.0f;
+
+      Vector textpos = pos + Vector(0, 16.0f);
+      // FIXME: Doesn't handle multi line text
+      Sizef size(Fonts::vera20-&gt;get_width(choices[i].topic) + 50,
+                 Fonts::vera20-&gt;get_height() + 30);
+      Rectf  rect(textpos + distance * offset - Vector(size.width/2, size.height - 15), size);
+
+      if (i == selection)
+        {
+          rect = rect.grow(grow);
+          
+          Display::fill_arc(pos, 42.0f, start, end, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
+          Display::fill_rounded_rect(rect, 5.0f, Color(0.5f, 0.5f, 0.5f, 0.75f));
+          Fonts::vera20-&gt;draw_center(textpos.x + distance * offset.x,
+                                     textpos.y + distance * offset.y, 
+                                     choices[i].topic, Color(1.0f, 1.0f, 1.0f));
+
+          Fonts::vera20-&gt;draw_center(400, 600 - 64,
+                                     choices[i].text, Color(1.0f, 1.0f, 1.0f));
+        }
+      else
+        {
+          Display::fill_rounded_rect(rect, 5.0f, Color(0.25f, 0.25f, 0.25f, 0.75f));
+          Fonts::vera20-&gt;draw_center(textpos.x + distance * offset.x,
+                                     textpos.y + distance * offset.y,
+                                     choices[i].topic, Color(0.5f, 0.5f, 0.5f));
+        }
+
+      Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 1.0f));
+
+      //Display::draw_arc(pos + 5.0f * offset, 32.0f,
+      //                  start, end,
+      //                  Color(1.0f, 1.0f, 1.0f, 1.0f), 24);
+
+    }
+  Display::draw_circle(pos, 42.0f, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
+
+  Display::fill_circle(pos + direction * 34.0f, 8.0f, Color(1.0f, 1.0f, 1.0f));
+  //Display::draw_line(pos, pos + direction*32.0f, Color(0.0f, 0.0f, 0.0f));
+}
+
+void
+Conversation::update(float delta, const Controller&amp; controller)
+{
+  time += delta;
+
+  if (!active)
+    return;
+
+  grow = fabs(sinf(time * 3.0f)) * 4.0f;
+
+  direction = Vector(controller.get_axis_state(X_AXIS),
+                     controller.get_axis_state(Y_AXIS));
+
+  if (fabs(controller.get_axis_state(X_AXIS)) &gt; 0.3f ||
+      fabs(controller.get_axis_state(Y_AXIS)) &gt; 0.3f)
+    {
+      float segment = 360.0f / choices.size();
+      float angle = math::rad2deg(math::normalize_angle(atan2f(direction.y, direction.x) + M_PI/2 + math::deg2rad(segment/2.0f)));
+
+      int new_selection = int(angle / segment);
+      new_selection = math::mid(0, new_selection, int(choices.size()));
+
+      if (new_selection != selection) {
+        selection = new_selection;
+        // FIXME: Might be a good idea to do the woople-size per button, not globaly
+        grow = 0.0f;
+        time = 0;
+      }
+    }
+  else
+    {
+      selection = -1;
+    }
+  
+  if (controller.button_was_pressed(OK_BUTTON) &amp;&amp; selection != -1)
+    {
+      active = false;
+      GameSession::current()-&gt;get_pda().add_dialog(&quot;Jane&quot;,
+                                                   choices[selection].topic + &quot; - &quot; +
+                                                   choices[selection].text);
+      choices.clear();
+      GameSession::current()-&gt;set_control_state(GameSession::GAME);
+      script_manager-&gt;fire_wakeup_event(ScriptManager::CONVERSATION_CLOSED);
+    }
+}
+
+int
+Conversation::get_selection() const
+{
+  return selection;
+}
+
+void
+Conversation::show()
+{
+  active = true;
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/conversation.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/hud/conversation.hpp (from rev 2466, trunk/windstille/src/conversation.hpp)
===================================================================
--- trunk/windstille/src/conversation.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/conversation.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,68 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_CONVERSATION_HPP
+#define HEADER_WINDSTILLE_CONVERSATION_HPP
+
+#include &lt;vector&gt;
+#include &lt;string&gt;
+#include &quot;screen/screen.hpp&quot;
+
+/** Displays a list of text strings from which the user can select
+    one, used to form multiple-choice dialogs */
+class Conversation : public Screen
+{
+private:
+  Vector pos;
+  Vector direction;
+  bool   active;
+  int    selection;
+  float  grow;
+  float  time;
+
+  struct Choice {
+    Choice(const std::string topic_,
+           const std::string text_)
+      : topic(topic_), 
+        text(text_) 
+    {}
+    std::string topic;
+    std::string text;
+  };
+
+  typedef std::vector&lt;Choice&gt; Choices;
+  Choices choices;
+  
+  static Conversation* current_;
+public:
+  static Conversation* current() { assert(current_); return current_; }
+  
+  Conversation();
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+
+  void add(const std::string&amp; text);
+  void add(const std::string&amp; topic, const std::string&amp; text);
+  int  get_selection() const;
+  void show();
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/conversation.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/hud/dialog_manager.cpp (from rev 2466, trunk/windstille/src/dialog_manager.cpp)
===================================================================
--- trunk/windstille/src/dialog_manager.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/dialog_manager.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,192 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;iostream&gt;
+#include &quot;font/fonts.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
+#include &quot;input/controller.hpp&quot;
+#include &quot;input/input_manager.hpp&quot;
+#include &quot;dialog_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
+#include &quot;display/text_area.hpp&quot;
+#include &quot;display/display.hpp&quot;
+#include &quot;config.hpp&quot;
+
+DialogManager* DialogManager::current_ = 0;
+
+DialogManager::DialogManager()
+{
+  current_ = this;
+  text_area = 0;
+}
+
+DialogManager::~DialogManager()
+{
+  delete text_area;
+}
+
+void
+DialogManager::add_dialog(int alignment_, const std::string&amp; portrait_, const std::string&amp; text_)
+{ 
+  delay     = 0.0;
+  alignment = alignment_;
+  portrait  = Sprite(portrait_);
+  portrait.set_scale(0.65f);
+  text      = text_;
+  caption = false;
+  
+  create_text();
+}
+
+void
+DialogManager::add_caption(int alignment_, const std::string&amp; text_)
+{
+  delay     = 0.0;
+  alignment = alignment_;
+  text      = text_;
+  caption = true;
+  
+  create_text();
+}
+
+void
+DialogManager::draw()
+{
+  int dialog_height = std::max(portrait_height + portrait_border_y*2,
+                               int(text_area-&gt;get_rect().get_height()
+                                   + text_border_y * 2.0f));
+
+  Point pos(0,0);
+  if(alignment &amp; LEFT) {
+    pos.x = outer_border_x;
+  } else if(alignment &amp; RIGHT) {
+    pos.x = Display::get_width() - dialog_width - outer_border_x;
+  } else {
+    pos.x = (Display::get_width() - dialog_width) / 2;
+  }
+
+  if(alignment &amp; TOP) {
+    pos.y = outer_border_y;
+  } else if(alignment &amp; BOTTOM) {
+    pos.y = Display::get_height() - dialog_height - outer_border_y;
+  } else {
+    pos.y = (Display::get_height() - dialog_height) / 2;
+  }
+
+  if (!caption) {
+    Rectf rect(pos.x,
+               pos.y,
+               pos.x + dialog_width,
+               pos.y + 200);
+    
+    Display::fill_rounded_rect(rect, 16.0f,
+                               Color(0, 0, 0.3f, 0.5f));
+    Display::draw_rounded_rect(rect, 16.0f,
+                               Color(0.6f, 1.0f, 1.0f, 0.8f));
+  
+    portrait.draw(Vector(pos.x + portrait_border_x,
+                         pos.y + portrait_border_y));
+  }
+  
+  text_area-&gt;draw();
+
+  if (text_area-&gt;is_progress_complete())
+    {
+      const Vector&amp; pos = text_area-&gt;get_cursor_pos();
+      Rectf cursor(pos.x + 8, pos.y + 8, pos.x + 24, pos.y + 24);
+      Display::fill_rect(cursor, Color(1.0, 1.0, 1.0, fabs(sin(SDL_GetTicks() / 1000.0f * M_PI * 3.0f))));
+    }
+}
+
+void
+DialogManager::update(float delta, const Controller&amp; controller)
+{
+  text_area-&gt;update(delta);
+
+  delay += delta;
+
+  InputEventLst events = controller.get_events();
+	
+  for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
+    {
+      if ((*i).type == BUTTON_EVENT)
+        {
+          if ((*i).button.name == OK_BUTTON &amp;&amp; (*i).button.down == true)
+            {
+              if (text_area-&gt;is_progress_complete())
+                {
+                  GameSession::current()-&gt;set_control_state(GameSession::GAME);
+                  script_manager-&gt;fire_wakeup_event(ScriptManager::DIALOG_CLOSED);
+                }
+              else if (delay &gt; 0.2)
+                text_area-&gt;set_progress_complete();
+            } 
+        }
+    }
+}
+
+void
+DialogManager::create_text()
+{
+  if (caption)
+    outer_border_y = 0;
+  else
+    outer_border_y = 20;
+    
+  Point pos(0,0);
+  if(alignment &amp; LEFT) {
+    pos.x = outer_border_x;
+  } else if(alignment &amp; RIGHT) {
+    pos.x = Display::get_width() - dialog_width - outer_border_x;
+  } else {
+    pos.x = (Display::get_width() - dialog_width) / 2;
+  }
+      
+  int text_width
+    = dialog_width - portrait_height - portrait_border_x*2 - text_border_x;
+  Rect text_rect = Rect(Point(pos.x + portrait_width + portrait_border_x*2, 0),
+                        Size(500, 200)); // FIXME: use real bounding box calc
+  
+  text_rect.bottom = text_rect.top + text_rect.get_height();
+  text_rect.top    = pos.y + text_border_y;
+
+  int dialog_height = std::max(portrait_height + portrait_border_y*2,
+                               text_rect.get_height() + text_border_y*2);
+
+  if(alignment &amp; TOP) {
+    pos.y = outer_border_y;
+  } else if(alignment &amp; BOTTOM) {
+    pos.y = Display::get_height() - dialog_height - outer_border_y;
+  } else {
+    pos.y = (Display::get_height() - dialog_height) / 2;
+  }
+
+  text_rect.bottom = text_rect.top + text_rect.get_height();
+  text_rect.top = pos.y + text_border_y;
+
+  Size dialog_size(dialog_width, dialog_height);
+
+
+  delete text_area;
+  text_area = new TextArea(Rect(Point(text_rect.left, text_rect.top + Fonts::vera20-&gt;get_height()),
+                                Size(text_width, 200)), true);
+  text_area-&gt;set_font(Fonts::vera20);
+  text_area-&gt;set_text(text);
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/dialog_manager.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/hud/dialog_manager.hpp (from rev 2466, trunk/windstille/src/dialog_manager.hpp)
===================================================================
--- trunk/windstille/src/dialog_manager.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/dialog_manager.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,78 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_DIALOG_MANAGER_HPP
+#define HEADER_WINDSTILLE_DIALOG_MANAGER_HPP
+
+#include &lt;vector&gt;
+#include &lt;string&gt;
+#include &quot;sprite2d/sprite.hpp&quot;
+#include &quot;globals.hpp&quot;
+#include &quot;screen/screen.hpp&quot;
+
+class TextArea;
+
+/** */
+class DialogManager : public Screen
+{
+private:
+  void create_text();
+  
+  Sprite portrait;
+  std::string text;
+  float delay;
+  TextArea* text_area;
+
+  enum Alignment {
+    VCENTER = 0x00,
+    LEFT    = 0x01,
+    RIGHT   = 0x02,
+    HCENTER = 0x00,
+    TOP     = 0x10,
+    BOTTOM  = 0x20
+  };
+  int alignment;
+  bool caption;
+  
+  static const int dialog_width = 600;
+  static const int portrait_border_x = 10;
+  static const int portrait_border_y = 10;
+  static const int text_border_x = 10;
+  static const int text_border_y = 10;
+  static const int portrait_width = 180;
+  static const int portrait_height = 192;
+  static const int outer_border_x = 20;
+  int outer_border_y;
+
+  static DialogManager* current_;
+public:
+  static DialogManager* current() { return current_; }
+
+  DialogManager();
+  ~DialogManager();
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+
+  void add_dialog(int alignment, const std::string&amp; portrait, const std::string&amp; text);
+  void add_caption(int alignment, const std::string&amp; text);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/dialog_manager.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/hud/energy_bar.cpp (from rev 2466, trunk/windstille/src/energy_bar.cpp)


Property changes on: trunk/windstille/src/hud/energy_bar.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/hud/energy_bar.hpp (from rev 2466, trunk/windstille/src/energy_bar.hpp)
===================================================================
--- trunk/windstille/src/energy_bar.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/energy_bar.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,43 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_ENERGY_BAR_HPP
+#define HEADER_WINDSTILLE_ENERGY_BAR_HPP
+
+#include &quot;screen/screen.hpp&quot;
+#include &quot;sprite2d/sprite.hpp&quot;
+
+/** */
+class EnergyBar : public Screen
+{
+private:
+  Sprite bar;
+public:
+  EnergyBar();
+  ~EnergyBar();
+  
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+private:
+  EnergyBar (const EnergyBar&amp;);
+  EnergyBar&amp; operator= (const EnergyBar&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/energy_bar.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/hud/inventory.cpp (from rev 2466, trunk/windstille/src/inventory.cpp)
===================================================================
--- trunk/windstille/src/inventory.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/inventory.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,183 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;iostream&gt;
+#include &lt;vector&gt;
+#include &quot;screen/game_session.hpp&quot;
+#include &quot;sprite2d/sprite.hpp&quot;
+#include &quot;font/fonts.hpp&quot;
+#include &quot;input/input_manager.hpp&quot;
+#include &quot;input/controller.hpp&quot;
+#include &quot;inventory.hpp&quot;
+
+class InventoryItem
+{
+public:
+  std::string name;
+  Sprite sprite;
+  
+  InventoryItem(const std::string&amp; name, const std::string&amp; filename)
+    : name(name), sprite(filename)
+  {
+  }
+};
+
+class InventoryImpl
+{
+public:
+  int   moving;
+  float add_angle;
+  Sprite slot;
+  Sprite slothighlight;
+  typedef std::vector&lt;InventoryItem&gt; Items;
+  Items items;
+  int current_item;
+
+  void update(float delta, const Controller&amp; controller);
+  void draw();
+  
+  void incr_current_item() { 
+    if (current_item == int(items.size()) - 1)
+      current_item = 0;
+    else
+      current_item += 1;
+  }
+
+  void decr_current_item() { 
+    if (current_item == 0)
+      current_item = items.size() - 1;
+    else
+      current_item -= 1;
+  }
+};
+
+Inventory::Inventory()
+  : impl(new InventoryImpl())
+{
+  impl-&gt;slot = Sprite(&quot;images/inventory/slot.sprite&quot;);
+  impl-&gt;slothighlight = Sprite(&quot;images/inventory/slothighlight.sprite&quot;);
+  impl-&gt;moving = false;
+  impl-&gt;add_angle = 0.0f;
+  impl-&gt;current_item = 0;
+
+  impl-&gt;items.push_back(InventoryItem(&quot;Flashlight&quot;,  &quot;images/inventory/flashlight.sprite&quot;));
+  impl-&gt;items.push_back(InventoryItem(&quot;Stone&quot;,       &quot;images/inventory/stone.sprite&quot;));
+  impl-&gt;items.push_back(InventoryItem(&quot;PDA&quot;,         &quot;images/inventory/pda.sprite&quot;));
+  impl-&gt;items.push_back(InventoryItem(&quot;5x Granates&quot;, &quot;images/inventory/granate.sprite&quot;));
+  impl-&gt;items.push_back(InventoryItem(&quot;Lv1 Keycard&quot;, &quot;images/inventory/keycard.sprite&quot;));
+}
+
+Inventory::~Inventory()
+{
+}
+
+void
+InventoryImpl::draw()
+{
+  Vector pos = Vector(400, 300); // View::current()-&gt;screen_Player::currently-&gt;get_pos();
+
+  int num_items = items.size();
+  float step_angle = (2*M_PI) / num_items;
+
+  for(int i = 0; i &lt; int(items.size()); ++i)
+    {
+      const InventoryItem&amp; item = items[(i+current_item)%items.size()];
+      Vector draw_pos = pos + Vector(128, 0).rotate(step_angle * i - M_PI/2 + add_angle);
+
+      if (i == 0 &amp;&amp; moving == 0)
+        {
+          slothighlight.draw(draw_pos);
+          Fonts::vera20-&gt;draw_center(draw_pos.x, draw_pos.y - 64, item.name);
+        }
+      else
+        {
+          slot.draw(draw_pos);
+        }
+
+      item.sprite.draw(draw_pos - Vector(32,32));
+    }
+}
+
+void
+Inventory::draw()
+{
+  impl-&gt;draw();
+}
+
+void
+Inventory::update(float delta, const Controller&amp; controller)
+{
+  impl-&gt;update(delta, controller);
+}
+
+void
+InventoryImpl::update(float delta, const Controller&amp; controller)
+{
+  float step_angle = (2*M_PI) / items.size();
+  if (fabsf(add_angle) &gt; step_angle)
+    {
+      if (moving == 1)
+        decr_current_item();
+      else if (moving == -1)
+        incr_current_item();
+
+      moving = 0;
+      add_angle = 0;
+    }
+
+  if (controller.get_axis_state(X_AXIS) &lt; -0.5f)
+    {
+      if (moving == 1)
+        {
+          add_angle = -step_angle + add_angle;
+          decr_current_item();
+        }
+
+      moving = -1;
+    }
+  else if (controller.get_axis_state(X_AXIS) &gt; 0.5f)
+    {
+      if (moving == -1)
+        {
+          add_angle = step_angle + add_angle;
+          incr_current_item();
+        }
+
+      moving =  1;
+    }
+
+  if (moving == -1)
+    {
+      add_angle -= 3 * delta;
+    }
+  else if (moving == 1)
+    {
+      add_angle += 3 * delta;
+    }
+
+  if (moving == 0)
+    {
+      if (controller.button_was_pressed(USE_BUTTON) ||
+          controller.button_was_pressed(INVENTORY_BUTTON))
+        {
+          GameSession::current()-&gt;set_control_state(GameSession::GAME);
+        }
+    }
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/inventory.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/hud/inventory.hpp (from rev 2466, trunk/windstille/src/inventory.hpp)
===================================================================
--- trunk/windstille/src/inventory.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/inventory.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,44 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_INVENTORY_HPP
+#define HEADER_WINDSTILLE_INVENTORY_HPP
+
+#include &quot;screen/screen.hpp&quot;
+#include &lt;boost/shared_ptr.hpp&gt;
+
+class InventoryImpl;
+
+/** */
+class Inventory : public Screen
+{
+private:
+public:
+  Inventory();
+  ~Inventory();
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+
+private:
+  boost::shared_ptr&lt;InventoryImpl&gt; impl;
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/inventory.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/hud/pda.cpp (from rev 2466, trunk/windstille/src/pda.cpp)
===================================================================
--- trunk/windstille/src/pda.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/pda.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,182 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;input/input_manager.hpp&quot;
+#include &quot;display/display.hpp&quot;
+#include &quot;display/text_area.hpp&quot;
+#include &quot;font/fonts.hpp&quot;
+#include &quot;pda.hpp&quot;
+
+DialogEntry::DialogEntry(const std::string&amp; arg_character, const std::string&amp; arg_text)
+  : character(arg_character),
+    text(arg_text)
+{
+}
+
+ObjectiveEntry::ObjectiveEntry(const std::string&amp; arg_name, const std::string&amp; arg_text)
+  : name(arg_name),
+    text(arg_text),
+    complete(false)
+{
+}
+
+PDA::PDA()
+  : state(PDA_OBJECTIVES)
+{ 
+  text_area  = 0;
+  background = Sprite(&quot;images/pda/pda.sprite&quot;);
+}
+
+void
+PDA::draw()
+{
+  if (text_area)
+    {
+      // Darken the background a bit
+      Display::fill_rect(Rect(0, 0, Display::get_width(), Display::get_height()), Color(0.0f, 0.0f, 0.0f, 0.25f));
+
+      Rectf rect = text_area-&gt;get_rect().grow(8.0f);
+
+      background.draw(Vector(30, 30));
+      
+      rect.top += 56;
+      Display::fill_rounded_rect(rect, 16.0f, Color(0.3f, 0.3f, 0.5f, 0.5f));
+      Display::draw_rounded_rect(rect, 16.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+
+      text_area-&gt;draw();
+    }
+}
+
+void
+PDA::update(float delta, const Controller&amp; controller)
+{
+  const InputEventLst&amp; events = controller.get_events();
+  for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i) {
+    if (i-&gt;type == BUTTON_EVENT)
+      {
+        if (i-&gt;axis.name == MENU_LEFT_BUTTON &amp;&amp; i-&gt;button.down) 
+          {
+            state = static_cast&lt;pda_state&gt;(state + 1);
+            if (state &gt; PDA_DIALOGS)
+              state = PDA_OBJECTIVES;
+          }
+        else if (i-&gt;axis.name == MENU_RIGHT_BUTTON &amp;&amp; i-&gt;button.down) 
+          {
+            state = static_cast&lt;pda_state&gt;(state - 1);
+            if (state &lt; PDA_OBJECTIVES)
+              state = PDA_DIALOGS;
+          }
+      }
+  }
+    
+  switch (state) {
+  case PDA_OBJECTIVES:
+    show_objectives();
+    break;
+  case PDA_DIALOGS:
+    show_dialogs();
+    break;
+  }
+ 
+  if (new_text != old_text) {
+    delete text_area; // FIXME: Unneeded could just use set_text
+    text_area = new TextArea(Rectf(70, 83, 385, 520).grow(-12.0f), false);
+    text_area-&gt;set_font(Fonts::ttffont);
+    text_area-&gt;set_text(new_text);
+    
+    old_text = new_text;
+  }
+  
+  text_area-&gt;update(delta);
+}
+
+void
+PDA::add_dialog(const std::string&amp; character, const std::string&amp; text)
+{
+  dialogs.push_back(DialogEntry(character, text));
+}
+
+void
+PDA::add_objective(const std::string&amp; name, const std::string&amp; text)
+{
+  objectives.push_back(ObjectiveEntry(name, text));
+}
+
+void
+PDA::objective_complete(const std::string&amp; name)
+{
+  for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) {
+    if (i-&gt;name == name)
+      i-&gt;complete = true;
+      return;
+  }
+}
+
+bool
+PDA::is_objective_given(const std::string&amp; name)
+{
+  for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) {
+    if (i-&gt;name == name)
+      return true;
+  }
+  
+  return false;
+}
+
+bool
+PDA::is_objective_complete(const std::string&amp; name)
+{
+  for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) {
+    if (i-&gt;name == name &amp;&amp; i-&gt;complete)
+      return true;
+  }
+  
+  return false;
+}
+
+void
+PDA::show_objectives()
+{
+  new_text = &quot;&lt;large&gt;Personal Digital Assistant&lt;/large&gt;\n&quot;;
+  new_text += &quot;&lt;b&gt;objectives&lt;/b&gt; - dialogs\n\n&quot;;
+  
+  for (std::vector&lt;ObjectiveEntry&gt;::reverse_iterator i = objectives.rbegin(); i != objectives.rend(); ++i) {
+    new_text += i-&gt;name;
+    new_text += &quot;: &quot;;
+    if (i-&gt;complete)
+      new_text += &quot;complete\n&quot;;
+    else
+      new_text += &quot;incomplete\n&quot;;
+    new_text += i-&gt;text + &quot;\n\n&quot;;
+  }
+}
+
+void
+PDA::show_dialogs()
+{
+  new_text = &quot;&lt;large&gt;Personal Digital Assistant&lt;/large&gt;\n&quot;;
+  new_text += &quot;objectives - &lt;b&gt;dialogs&lt;/b&gt;\n\n&quot;;
+  
+  for (std::vector&lt;DialogEntry&gt;::reverse_iterator i = dialogs.rbegin(); i != dialogs.rend(); ++i) {
+    new_text += i-&gt;character;
+    new_text += &quot;: &quot;;
+    new_text += i-&gt;text + '\n';
+  }
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/pda.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/hud/pda.hpp (from rev 2466, trunk/windstille/src/pda.hpp)
===================================================================
--- trunk/windstille/src/pda.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/hud/pda.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,77 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_PDA_HPP
+#define HEADER_WINDSTILLE_PDA_HPP
+
+#include &quot;sprite2d/sprite.hpp&quot;
+#include &quot;screen/screen.hpp&quot;
+
+class TextArea;
+
+class DialogEntry
+{
+public:
+  DialogEntry(const std::string&amp; arg_character, const std::string&amp; arg_text);
+  
+  std::string character;
+  std::string text;
+};
+
+class ObjectiveEntry
+{
+public:
+  ObjectiveEntry(const std::string&amp; arg_name, const std::string&amp; arg_text);
+  
+  std::string name;
+  std::string text;
+  bool complete;
+};
+
+/** */
+class PDA : public Screen
+{
+private:
+  Sprite    background;
+  TextArea* text_area;
+  std::vector&lt;DialogEntry&gt; dialogs;
+  std::vector&lt;ObjectiveEntry&gt; objectives;   
+  
+  std::string new_text;  
+  std::string old_text;
+  enum pda_state { PDA_OBJECTIVES, PDA_DIALOGS } state;
+
+  void show_objectives();
+  void show_dialogs();
+
+public:
+  PDA();
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+  void add_dialog(const std::string&amp; character, const std::string&amp; text);
+  
+  void add_objective(const std::string&amp; name, const std::string&amp; text);
+  void objective_complete(const std::string&amp; name);
+  bool is_objective_given(const std::string&amp; name);
+  bool is_objective_complete(const std::string&amp; name);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/hud/pda.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Modified: trunk/windstille/src/input/input_configurator.cpp
===================================================================
--- trunk/windstille/src/input/input_configurator.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/input/input_configurator.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -22,7 +22,7 @@
 #include &quot;math/rect.hpp&quot;
 #include &quot;controller_def.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
+#include &quot;screen/screen_manager.hpp&quot;
 #include &quot;input/input_manager_sdl.hpp&quot;
 #include &quot;input_configurator.hpp&quot;
 

Modified: trunk/windstille/src/input/input_configurator.hpp
===================================================================
--- trunk/windstille/src/input/input_configurator.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/input/input_configurator.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -20,8 +20,8 @@
 #define HEADER_WINDSTILLE_INPUT_INPUT_CONFIGURATOR_HPP
 
 #include &lt;sstream&gt;
-#include &quot;screen.hpp&quot;
-#include &quot;text_area.hpp&quot;
+#include &quot;screen/screen.hpp&quot;
+#include &quot;display/text_area.hpp&quot;
 
 struct ConfigureItem
 {

Deleted: trunk/windstille/src/inventory.cpp
===================================================================
--- trunk/windstille/src/inventory.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/inventory.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,183 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &lt;vector&gt;
-#include &quot;game_session.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;inventory.hpp&quot;
-
-class InventoryItem
-{
-public:
-  std::string name;
-  Sprite sprite;
-  
-  InventoryItem(const std::string&amp; name, const std::string&amp; filename)
-    : name(name), sprite(filename)
-  {
-  }
-};
-
-class InventoryImpl
-{
-public:
-  int   moving;
-  float add_angle;
-  Sprite slot;
-  Sprite slothighlight;
-  typedef std::vector&lt;InventoryItem&gt; Items;
-  Items items;
-  int current_item;
-
-  void update(float delta, const Controller&amp; controller);
-  void draw();
-  
-  void incr_current_item() { 
-    if (current_item == int(items.size()) - 1)
-      current_item = 0;
-    else
-      current_item += 1;
-  }
-
-  void decr_current_item() { 
-    if (current_item == 0)
-      current_item = items.size() - 1;
-    else
-      current_item -= 1;
-  }
-};
-
-Inventory::Inventory()
-  : impl(new InventoryImpl())
-{
-  impl-&gt;slot = Sprite(&quot;images/inventory/slot.sprite&quot;);
-  impl-&gt;slothighlight = Sprite(&quot;images/inventory/slothighlight.sprite&quot;);
-  impl-&gt;moving = false;
-  impl-&gt;add_angle = 0.0f;
-  impl-&gt;current_item = 0;
-
-  impl-&gt;items.push_back(InventoryItem(&quot;Flashlight&quot;,  &quot;images/inventory/flashlight.sprite&quot;));
-  impl-&gt;items.push_back(InventoryItem(&quot;Stone&quot;,       &quot;images/inventory/stone.sprite&quot;));
-  impl-&gt;items.push_back(InventoryItem(&quot;PDA&quot;,         &quot;images/inventory/pda.sprite&quot;));
-  impl-&gt;items.push_back(InventoryItem(&quot;5x Granates&quot;, &quot;images/inventory/granate.sprite&quot;));
-  impl-&gt;items.push_back(InventoryItem(&quot;Lv1 Keycard&quot;, &quot;images/inventory/keycard.sprite&quot;));
-}
-
-Inventory::~Inventory()
-{
-}
-
-void
-InventoryImpl::draw()
-{
-  Vector pos = Vector(400, 300); // View::current()-&gt;screen_Player::currently-&gt;get_pos();
-
-  int num_items = items.size();
-  float step_angle = (2*M_PI) / num_items;
-
-  for(int i = 0; i &lt; int(items.size()); ++i)
-    {
-      const InventoryItem&amp; item = items[(i+current_item)%items.size()];
-      Vector draw_pos = pos + Vector(128, 0).rotate(step_angle * i - M_PI/2 + add_angle);
-
-      if (i == 0 &amp;&amp; moving == 0)
-        {
-          slothighlight.draw(draw_pos);
-          Fonts::vera20-&gt;draw_center(draw_pos.x, draw_pos.y - 64, item.name);
-        }
-      else
-        {
-          slot.draw(draw_pos);
-        }
-
-      item.sprite.draw(draw_pos - Vector(32,32));
-    }
-}
-
-void
-Inventory::draw()
-{
-  impl-&gt;draw();
-}
-
-void
-Inventory::update(float delta, const Controller&amp; controller)
-{
-  impl-&gt;update(delta, controller);
-}
-
-void
-InventoryImpl::update(float delta, const Controller&amp; controller)
-{
-  float step_angle = (2*M_PI) / items.size();
-  if (fabsf(add_angle) &gt; step_angle)
-    {
-      if (moving == 1)
-        decr_current_item();
-      else if (moving == -1)
-        incr_current_item();
-
-      moving = 0;
-      add_angle = 0;
-    }
-
-  if (controller.get_axis_state(X_AXIS) &lt; -0.5f)
-    {
-      if (moving == 1)
-        {
-          add_angle = -step_angle + add_angle;
-          decr_current_item();
-        }
-
-      moving = -1;
-    }
-  else if (controller.get_axis_state(X_AXIS) &gt; 0.5f)
-    {
-      if (moving == -1)
-        {
-          add_angle = step_angle + add_angle;
-          incr_current_item();
-        }
-
-      moving =  1;
-    }
-
-  if (moving == -1)
-    {
-      add_angle -= 3 * delta;
-    }
-  else if (moving == 1)
-    {
-      add_angle += 3 * delta;
-    }
-
-  if (moving == 0)
-    {
-      if (controller.button_was_pressed(USE_BUTTON) ||
-          controller.button_was_pressed(INVENTORY_BUTTON))
-        {
-          GameSession::current()-&gt;set_control_state(GameSession::GAME);
-        }
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/inventory.hpp
===================================================================
--- trunk/windstille/src/inventory.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/inventory.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,44 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_INVENTORY_HPP
-#define HEADER_WINDSTILLE_INVENTORY_HPP
-
-#include &quot;screen.hpp&quot;
-#include &lt;boost/shared_ptr.hpp&gt;
-
-class InventoryImpl;
-
-/** */
-class Inventory : public Screen
-{
-private:
-public:
-  Inventory();
-  ~Inventory();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-private:
-  boost::shared_ptr&lt;InventoryImpl&gt; impl;
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/menu_manager.cpp
===================================================================
--- trunk/windstille/src/menu_manager.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/menu_manager.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -22,20 +22,20 @@
 #include &quot;console.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;game_session.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
 #include &quot;gui/group_component.hpp&quot;
 #include &quot;gui/gui_manager.hpp&quot;
 #include &quot;gui/menu_component.hpp&quot;
 #include &quot;gui/root_component.hpp&quot;
 #include &quot;gui/text_view.hpp&quot;
-#include &quot;particle_viewer.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
+#include &quot;screen/particle_viewer.hpp&quot;
+#include &quot;screen/screen_manager.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
-#include &quot;sprite3dview.hpp&quot;
-#include &quot;geometry_test.hpp&quot;
-#include &quot;armature_test.hpp&quot;
-#include &quot;navigation_test.hpp&quot;
+#include &quot;screen/sprite3dview.hpp&quot;
+#include &quot;screen/geometry_test.hpp&quot;
+#include &quot;screen/armature_test.hpp&quot;
+#include &quot;screen/navigation_test.hpp&quot;
 #include &quot;gui/menu_item.hpp&quot;
 #ifdef HAVE_CWIID
 #include &quot;input/wiimote.hpp&quot;

Deleted: trunk/windstille/src/navigation_test.cpp
===================================================================
--- trunk/windstille/src/navigation_test.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/navigation_test.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,267 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;assert.h&gt;
-#include &lt;iostream&gt;
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &quot;util/sexpr_file_reader.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;navigation/navigation_graph.hpp&quot;
-#include &quot;navigation/node.hpp&quot;
-#include &quot;navigation/segment_position.hpp&quot;
-#include &quot;navigation/segment.hpp&quot;
-#include &quot;navigation_test.hpp&quot;
-
-NavigationTest::NavigationTest()
-  : cursor(400, 300),
-    player(200,200),
-    graph(0),
-    connection(0),
-    selected_segment(0),
-    selected_node(0),
-    node_to_connect(0)
-{
-  graph = new NavigationGraph();
-
-  try {
-    FileReader reader = FileReader::parse(&quot;navigation.nav&quot;);
-    graph-&gt;load(reader);
-  } catch(std::exception&amp; err) {
-    std::cout &lt;&lt; &quot;NavigationTest: &quot; &lt;&lt; err.what() &lt;&lt; std::endl;
-  }
-
-  NodeHandle node1 = graph-&gt;add_node(Vector(100, 200));
-  NodeHandle node2 = graph-&gt;add_node(Vector(300, 400));
-  //Node* node3 = graph-&gt;add_node(Vector(500, 300));
-  //Node* node4 = graph-&gt;add_node(Vector(700, 400));
-
-  graph-&gt;add_segment(node1, node2);
-  //graph-&gt;add_segment(node2, node3);
-  //graph-&gt;add_segment(node3, node4);
-  
-}
-
-void
-NavigationTest::draw()
-{
-  glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
-  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-  graph-&gt;draw();
-
-  Display::fill_rect(Rectf(cursor - Vector(2,2), Sizef(5,5)),  Color(1.0f, 1.0f, 1.0f));
-  Display::draw_circle(cursor, 32.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-
-  std::vector&lt;NodeHandle&gt; nodes = graph-&gt;find_nodes(cursor, 128.0f);
-  for(std::vector&lt;NodeHandle&gt;::iterator i = nodes.begin(); i != nodes.end(); ++i)
-    {
-      Display::draw_circle((*i)-&gt;get_pos(), 12.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
-
-  if (node_to_connect)
-    {
-      Display::fill_rect(Rectf(node_to_connect-&gt;get_pos() - Vector(2,2), Sizef(5,5)),  
-                         Color(1.0f, 1.0f, 1.0f));
-      Display::draw_line(node_to_connect-&gt;get_pos(), cursor, Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
-
-  if (selected_node)
-    Display::draw_circle(selected_node-&gt;get_pos(), 12.0f, Color(1.0f, 1.0f, 1.0f, 1.0f));
-
-  if (selected_segment)
-    Display::draw_line(selected_segment-&gt;get_line(), Color(1.0f, 1.0f, 1.0f, 1.0f));
-
-  Display::fill_circle(player, 12.0f, Color(0.0f, 0.0f, 1.0f, 1.0f));
-
-  if (connection)
-    {
-      Display::fill_circle(connection-&gt;get_pos(), 16.0f, Color(0.0f, 0.0f, 1.0f, 0.5f));
-      Display::fill_circle(connection-&gt;get_pos(), 8.0f, Color(0.0f, 1.0f, 1.0f));
-     
-      Display::draw_line(connection-&gt;get_pos(), connection-&gt;get_pos() + 100.0f*stick,
-                         Color(1.0f, 1.0f, 1.0f, 1.0f));
-    }
-}
-
-void
-NavigationTest::update(float delta, const Controller&amp; controller)
-{
-  if (controller.button_was_pressed(ESCAPE_BUTTON) ||
-      controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      screen_manager.pop_screen();
-    }
-
-  cursor += Vector(controller.get_axis_state(X_AXIS) * 500.0f * delta,
-                   controller.get_axis_state(Y_AXIS) * 500.0f * delta);
-
-  stick = Vector(controller.get_axis_state(X2_AXIS),
-                 controller.get_axis_state(Y2_AXIS));
-
-  if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      if (node_to_connect)
-        {
-          if (selected_node)
-            graph-&gt;add_segment(node_to_connect, selected_node);
-          
-          node_to_connect = 0;
-        }
-      else if (selected_node)
-        {
-          node_to_connect = selected_node;
-        }
-      else if (selected_segment)
-        {
-          graph-&gt;split_segment(selected_segment);
-          selected_segment = 0;
-        }
-      else
-        {
-          graph-&gt;add_node(cursor);
-        }
-    }
-
-  if (controller.get_button_state(TERTIARY_BUTTON))
-    { // Move node
-      if (selected_node)
-        {
-          selected_node-&gt;set_pos(cursor);
-        }
-    }
-
-  if (controller.button_was_pressed(SECONDARY_BUTTON))
-    { // Set player
-      player = old_player = cursor;
-    }
-
-  if (connection)
-    { 
-      // Handle the movement of the connection
-      Node* next_node;
-      //float advance = 512.0f * controller.get_axis_state(X2_AXIS) * delta;
-      
-      Vector advance = delta * 512.0f * stick;
-      connection-&gt;advance(advance, next_node);
-
-      player = connection-&gt;get_pos();
-      
-      if (!advance.is_null())
-        { // Not all advancement got used up, which means we have hit
-          // the end of a segment
-
-          // FIXME: This should be a while loop, currently we are just
-          // discarding the rest movement
-
-          SegmentPosition next_segment;
-          float length = 0;
-          for(Node::Segments::iterator i = next_node-&gt;segments.begin(); i != next_node-&gt;segments.end(); ++i)
-            {
-              if (connection-&gt;get_segment() != i-&gt;segment)
-                { // Find out into the direction of which segment the stick is pointing
-                  Vector proj = stick.project(i-&gt;segment-&gt;get_vector());
-                  
-                  if (proj.length() &gt; length)
-                    {
-                      next_segment = *i;
-                      length       = proj.length();
-                    }
-                }
-            }
-              
-          if (!next_segment.segment)
-            {
-              std::cout &lt;&lt; &quot;Dead End&quot; &lt;&lt; std::endl;
-              delete connection;
-              connection = 0;
-
-              // FIXME: Voodoo to fix connection/deadend cicles
-              player += stick;
-              old_player = player;
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;transition&quot; &lt;&lt; std::endl;
-              *connection = next_segment;
-            }
-        }
-
-      if (controller.get_button_state(AIM_BUTTON))
-        {         
-          delete connection;
-          connection = 0;
-
-          // FIXME: Voodoo to fix connection/dedaend cicles
-          player += stick;
-          old_player = player;
-        }
-    }
-  else
-    { // handle non connection based movement
-      player += Vector(0.0f, 100.0f) * delta;
-      
-      player.x += 512.0f * stick.x * delta;
-
-      if (controller.get_button_state(AIM_BUTTON))
-        {
-          player.y -= 0.5f * 512.0f * delta;
-        }
-
-      std::vector&lt;SegmentPosition&gt; positions = graph-&gt;find_intersections(Line(old_player, player));
-      if (!positions.empty()) {
-        std::cout &lt;&lt; &quot;Doing connection&quot; &lt;&lt; std::endl;
-        connection = new SegmentPosition(positions.front());
-      }
-    }
-  
-  if (controller.button_was_pressed(VIEW_CENTER_BUTTON))
-    {
-      graph-&gt;save(std::cout);
-    }
-
-  if (controller.button_was_pressed(PDA_BUTTON))
-    {
-      if (selected_node) {
-        graph-&gt;remove_node(selected_node);
-        selected_node = 0;
-      } 
-      
-      if (selected_segment) {
-        graph-&gt;remove_segment(selected_segment);
-        selected_segment = 0;
-      }      
-    }
-
-  selected_node = graph-&gt;find_closest_node(cursor, 32.0f);
-  if (!selected_node)
-    selected_segment = graph-&gt;find_closest_segment(cursor, 32.0f);
-  else
-    selected_segment = 0;
-
-  if (connection &amp;&amp; !graph-&gt;valid(connection-&gt;get_segment()))
-    {
-      delete connection;
-      connection = 0;
-    }
-
-  old_player = player;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/navigation_test.hpp
===================================================================
--- trunk/windstille/src/navigation_test.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/navigation_test.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,60 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_NAVIGATION_TEST_HPP
-#define HEADER_WINDSTILLE_NAVIGATION_TEST_HPP
-
-#include &quot;navigation/navigation_graph.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-class NavigationGraph;
-class SegmentPosition;
-class Segment;
-class Node;
-
-/** */
-class NavigationTest : public Screen
-{
-private:
-  Vector cursor;
-  Vector stick;
-  Vector player;
-  Vector old_player;
-  
-  NavigationGraph* graph;
-  SegmentPosition* connection;
-
-  SegmentHandle selected_segment;
-  NodeHandle    selected_node;
-
-  NodeHandle node_to_connect;
-
-public:
-  NavigationTest();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-private:
-  NavigationTest (const NavigationTest&amp;);
-  NavigationTest&amp; operator= (const NavigationTest&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/objects/character.cpp
===================================================================
--- trunk/windstille/src/objects/character.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/objects/character.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -18,9 +18,9 @@
 
 #include &quot;character.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
-#include &quot;game_session.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
 #include &quot;scripting/wrapper.interface.hpp&quot;
-#include &quot;dialog_manager.hpp&quot;
+#include &quot;hud/dialog_manager.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;physfs/physfs_stream.hpp&quot;
 #include &quot;console.hpp&quot;

Modified: trunk/windstille/src/objects/player.cpp
===================================================================
--- trunk/windstille/src/objects/player.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/objects/player.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -25,7 +25,7 @@
 #include &quot;player.hpp&quot;
 #include &quot;objects/bomb.hpp&quot;
 #include &quot;globals.hpp&quot;
-#include &quot;pda.hpp&quot;
+#include &quot;hud/pda.hpp&quot;
 #include &quot;tile/tile.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
@@ -34,7 +34,7 @@
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;laser_pointer.hpp&quot;
 #include &quot;collision/stair_contact.hpp&quot;
-#include &quot;game_session.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
 #include &quot;console.hpp&quot;
 #include &quot;grenade.hpp&quot;
 #include &quot;pistol.hpp&quot;

Modified: trunk/windstille/src/objects/swarm.cpp
===================================================================
--- trunk/windstille/src/objects/swarm.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/objects/swarm.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -20,7 +20,7 @@
 #include &quot;player.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;hedgehog.hpp&quot;
-#include &quot;game_session.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
 #include &quot;view.hpp&quot;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;math/random.hpp&quot;

Deleted: trunk/windstille/src/particle_viewer.cpp
===================================================================
--- trunk/windstille/src/particle_viewer.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/particle_viewer.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,203 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;util/sexpr_file_reader.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;gui/gui_manager.hpp&quot;
-#include &quot;particle_viewer.hpp&quot;
-
-// Components
-#include &quot;gui/button.hpp&quot;
-#include &quot;gui/label.hpp&quot;
-#include &quot;gui/slider.hpp&quot;
-#include &quot;gui/root_component.hpp&quot;
-#include &quot;gui/grid_component.hpp&quot;
-#include &quot;gui/tab_component.hpp&quot;
-#include &quot;gui/list_view.hpp&quot;
-#include &quot;gui/text_view.hpp&quot;
-#include &quot;gui/automap.hpp&quot;
-
-class ParticleSystemGUI
-{
-public:
-  ParticleSystem* psystem;
-  gui::GridComponent* grid;
-  gui::Slider* gravity_slider;
-  gui::Slider* velocity_slider;
-  gui::Slider* count_slider;
-  
-  ParticleSystemGUI(gui::Component* parent, ParticleSystem* psystem_)
-    : psystem(psystem_)
-  {
-    using namespace gui;
-    grid = new GridComponent(Rectf(200, 120, 600, 220), 2, 3, parent);
-    grid-&gt;set_padding(4);
-
-    gravity_slider  = new Slider(grid);
-    velocity_slider = new Slider(grid);
-    count_slider    = new Slider(grid);
-
-    gravity_slider-&gt;set_range(-10, 10);
-    gravity_slider-&gt;set_step(3);
-    gravity_slider-&gt;set_pos(1);
-
-    velocity_slider-&gt;set_range(-500, 500);
-    velocity_slider-&gt;set_step(50);
-    velocity_slider-&gt;set_pos(10);//psystem-&gt;get_count());
-
-    count_slider-&gt;set_range(1, 500);
-    count_slider-&gt;set_step(10);
-    count_slider-&gt;set_pos(psystem-&gt;get_count());
-
-    grid-&gt;pack(new Label(&quot;Gravitation:&quot;), 0, 0);
-    grid-&gt;pack(new Label(&quot;Velocity:&quot;),    0, 1);
-    grid-&gt;pack(new Label(&quot;Count:&quot;),       0, 2);
-
-    grid-&gt;pack(gravity_slider,  1, 0);
-    grid-&gt;pack(velocity_slider, 1, 1);
-    grid-&gt;pack(count_slider,    1, 2);    
-  }
-
-  void update()
-  {
-    psystem-&gt;set_count(count_slider-&gt;get_pos());
-  }
-
-  gui::Component* get_component() { return grid; }
-};
-
-ParticleViewer::ParticleViewer()
-{
-  background = Sprite(&quot;images/greychess.sprite&quot;);
-  show_gui = false;
-
-  using namespace gui;
-
-  manager = new GUIManager();
-  tab = new TabComponent(Rectf(200, 50, 600, 250), manager-&gt;get_root());
-  
-  manager-&gt;get_root()-&gt;add_child(tab);
-}
-
-ParticleViewer::~ParticleViewer()
-{
-}
-
-void
-ParticleViewer::load(const std::string&amp; filename)
-{
-  std::cout &lt;&lt; &quot;ParticleViewer: loading &quot; &lt;&lt; filename &lt;&lt; std::endl;
-  
-  for(Systems::iterator i = systems.begin(); i != systems.end(); ++i)
-    delete *i;
-  systems.clear();
-  
-  FileReader root_reader = FileReader::parse(filename);
-  if(root_reader.get_name() != &quot;particle-systems&quot;) {
-    std::ostringstream msg;
-    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a particle-system file&quot;;
-    throw std::runtime_error(msg.str());
-  }
-
-  std::vector&lt;FileReader&gt; sections = root_reader.get_sections();
-  for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
-    { 
-      if (i-&gt;get_name() == &quot;particle-system&quot;)
-      {
-        systems.push_back(new ParticleSystem(*i));
-
-        guis.push_back(new ParticleSystemGUI(tab, systems.back()));
-        tab-&gt;pack(&quot;Testomap&quot;, guis.back()-&gt;get_component());
-      }
-  }
-
-  std::cout &lt;&lt; systems.size() &lt;&lt; &quot; particle systems ready to go&quot; &lt;&lt; std::endl;
-}
-  
-void
-ParticleViewer::draw()
-{
-  sc.reset_modelview();
-
-  for(int y = -background.get_width(); y &lt; 600 + background.get_height(); y += background.get_height())
-    for(int x = -background.get_width(); x &lt; 800 + background.get_width(); x += background.get_width())
-      sc.color().draw(background, Vector(x + int(pos.x) % background.get_width(),
-                                         y + int(pos.y) % background.get_height()), -900);
-
-  sc.translate(400 + pos.x, 600 + pos.y);
-  sc.light().fill_screen(Color(0.4, 0.4, 0.4));
-  //sc.light().fill_screen(Color(1.0, 1.0, 1.0));
-  sc.color().fill_screen(Color(0.0, 0.0, 0.0));
-
-  for(Systems::iterator i = systems.begin(); i != systems.end(); ++i)
-    (*i)-&gt;draw(sc);
-
-  sc.render();
-
-  if (show_gui)
-    {
-      manager-&gt;draw();
-    }
-}
-
-void
-ParticleViewer::update(float delta, const Controller&amp; controller)
-{
-  for(Systems::iterator i = systems.begin(); i != systems.end(); ++i)
-    (*i)-&gt;update(delta);
-
-  if (!show_gui)
-    {
-      pos.x += controller.get_axis_state(X_AXIS) * delta * 100.0f;
-      pos.y += controller.get_axis_state(Y_AXIS) * delta * 100.0f;
-
-      if (controller.button_was_pressed(OK_BUTTON))
-        {
-          // FIXME: Disable GUI, since its crashy
-          // show_gui = true;
-          // manager-&gt;get_root()-&gt;get_focus()-&gt;set_active(true);
-        }
-      else if (controller.button_was_pressed(CANCEL_BUTTON) ||
-               controller.button_was_pressed(ESCAPE_BUTTON))
-        {
-          screen_manager.pop_screen();
-        }
-    }
-  else
-    {
-      if (!manager-&gt;get_root()-&gt;is_active())
-        {
-          show_gui = false;
-        }
-      else
-        {
-          manager-&gt;update(delta, controller);
-        }
-    }
-
-  for(ParticleSystemGUIs::iterator i = guis.begin(); i != guis.end(); ++i)
-    {
-      (*i)-&gt;update();
-    }
-
-  //systems[3]-&gt;set_count(count_slider-&gt;get_pos());
-  //systems[3]-&gt;set_velocity(velocity_slider-&gt;get_pos(), velocity_slider-&gt;get_pos());
-}
-
-/* EOF */

Deleted: trunk/windstille/src/particle_viewer.hpp
===================================================================
--- trunk/windstille/src/particle_viewer.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/particle_viewer.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,65 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_PARTICLE_VIEWER_HPP
-#define HEADER_WINDSTILLE_PARTICLE_VIEWER_HPP
-
-#include &quot;screen.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;gui/gui_manager.hpp&quot;
-#include &quot;particles/particle_system.hpp&quot;
-
-namespace gui {
-class Slider;
-class TabComponent;
-}
-
-class ParticleSystemGUI;
-
-/** */
-class ParticleViewer : public Screen
-{
-private:
-  SceneContext sc;
-  typedef std::vector&lt;ParticleSystem*&gt; Systems;
-  Systems systems;
-  Sprite background;
-
-  Vector pos;
-  bool   show_gui;
-  gui::GUIManager* manager;
-  gui::TabComponent* tab;
-
-  typedef std::vector&lt;ParticleSystemGUI*&gt; ParticleSystemGUIs;
-  ParticleSystemGUIs guis;
-public:
-  ParticleViewer();
-  ~ParticleViewer();
-  
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-  void load(const std::string&amp; filename);
-
-private:
-  ParticleViewer (const ParticleViewer&amp;);
-  ParticleViewer&amp; operator= (const ParticleViewer&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/pda.cpp
===================================================================
--- trunk/windstille/src/pda.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/pda.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,182 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;text_area.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;pda.hpp&quot;
-
-DialogEntry::DialogEntry(const std::string&amp; arg_character, const std::string&amp; arg_text)
-  : character(arg_character),
-    text(arg_text)
-{
-}
-
-ObjectiveEntry::ObjectiveEntry(const std::string&amp; arg_name, const std::string&amp; arg_text)
-  : name(arg_name),
-    text(arg_text),
-    complete(false)
-{
-}
-
-PDA::PDA()
-  : state(PDA_OBJECTIVES)
-{ 
-  text_area  = 0;
-  background = Sprite(&quot;images/pda/pda.sprite&quot;);
-}
-
-void
-PDA::draw()
-{
-  if (text_area)
-    {
-      // Darken the background a bit
-      Display::fill_rect(Rect(0, 0, Display::get_width(), Display::get_height()), Color(0.0f, 0.0f, 0.0f, 0.25f));
-
-      Rectf rect = text_area-&gt;get_rect().grow(8.0f);
-
-      background.draw(Vector(30, 30));
-      
-      rect.top += 56;
-      Display::fill_rounded_rect(rect, 16.0f, Color(0.3f, 0.3f, 0.5f, 0.5f));
-      Display::draw_rounded_rect(rect, 16.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-
-      text_area-&gt;draw();
-    }
-}
-
-void
-PDA::update(float delta, const Controller&amp; controller)
-{
-  const InputEventLst&amp; events = controller.get_events();
-  for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i) {
-    if (i-&gt;type == BUTTON_EVENT)
-      {
-        if (i-&gt;axis.name == MENU_LEFT_BUTTON &amp;&amp; i-&gt;button.down) 
-          {
-            state = static_cast&lt;pda_state&gt;(state + 1);
-            if (state &gt; PDA_DIALOGS)
-              state = PDA_OBJECTIVES;
-          }
-        else if (i-&gt;axis.name == MENU_RIGHT_BUTTON &amp;&amp; i-&gt;button.down) 
-          {
-            state = static_cast&lt;pda_state&gt;(state - 1);
-            if (state &lt; PDA_OBJECTIVES)
-              state = PDA_DIALOGS;
-          }
-      }
-  }
-    
-  switch (state) {
-  case PDA_OBJECTIVES:
-    show_objectives();
-    break;
-  case PDA_DIALOGS:
-    show_dialogs();
-    break;
-  }
- 
-  if (new_text != old_text) {
-    delete text_area; // FIXME: Unneeded could just use set_text
-    text_area = new TextArea(Rectf(70, 83, 385, 520).grow(-12.0f), false);
-    text_area-&gt;set_font(Fonts::ttffont);
-    text_area-&gt;set_text(new_text);
-    
-    old_text = new_text;
-  }
-  
-  text_area-&gt;update(delta);
-}
-
-void
-PDA::add_dialog(const std::string&amp; character, const std::string&amp; text)
-{
-  dialogs.push_back(DialogEntry(character, text));
-}
-
-void
-PDA::add_objective(const std::string&amp; name, const std::string&amp; text)
-{
-  objectives.push_back(ObjectiveEntry(name, text));
-}
-
-void
-PDA::objective_complete(const std::string&amp; name)
-{
-  for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) {
-    if (i-&gt;name == name)
-      i-&gt;complete = true;
-      return;
-  }
-}
-
-bool
-PDA::is_objective_given(const std::string&amp; name)
-{
-  for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) {
-    if (i-&gt;name == name)
-      return true;
-  }
-  
-  return false;
-}
-
-bool
-PDA::is_objective_complete(const std::string&amp; name)
-{
-  for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) {
-    if (i-&gt;name == name &amp;&amp; i-&gt;complete)
-      return true;
-  }
-  
-  return false;
-}
-
-void
-PDA::show_objectives()
-{
-  new_text = &quot;&lt;large&gt;Personal Digital Assistant&lt;/large&gt;\n&quot;;
-  new_text += &quot;&lt;b&gt;objectives&lt;/b&gt; - dialogs\n\n&quot;;
-  
-  for (std::vector&lt;ObjectiveEntry&gt;::reverse_iterator i = objectives.rbegin(); i != objectives.rend(); ++i) {
-    new_text += i-&gt;name;
-    new_text += &quot;: &quot;;
-    if (i-&gt;complete)
-      new_text += &quot;complete\n&quot;;
-    else
-      new_text += &quot;incomplete\n&quot;;
-    new_text += i-&gt;text + &quot;\n\n&quot;;
-  }
-}
-
-void
-PDA::show_dialogs()
-{
-  new_text = &quot;&lt;large&gt;Personal Digital Assistant&lt;/large&gt;\n&quot;;
-  new_text += &quot;objectives - &lt;b&gt;dialogs&lt;/b&gt;\n\n&quot;;
-  
-  for (std::vector&lt;DialogEntry&gt;::reverse_iterator i = dialogs.rbegin(); i != dialogs.rend(); ++i) {
-    new_text += i-&gt;character;
-    new_text += &quot;: &quot;;
-    new_text += i-&gt;text + '\n';
-  }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/pda.hpp
===================================================================
--- trunk/windstille/src/pda.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/pda.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,77 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_PDA_HPP
-#define HEADER_WINDSTILLE_PDA_HPP
-
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-class TextArea;
-
-class DialogEntry
-{
-public:
-  DialogEntry(const std::string&amp; arg_character, const std::string&amp; arg_text);
-  
-  std::string character;
-  std::string text;
-};
-
-class ObjectiveEntry
-{
-public:
-  ObjectiveEntry(const std::string&amp; arg_name, const std::string&amp; arg_text);
-  
-  std::string name;
-  std::string text;
-  bool complete;
-};
-
-/** */
-class PDA : public Screen
-{
-private:
-  Sprite    background;
-  TextArea* text_area;
-  std::vector&lt;DialogEntry&gt; dialogs;
-  std::vector&lt;ObjectiveEntry&gt; objectives;   
-  
-  std::string new_text;  
-  std::string old_text;
-  enum pda_state { PDA_OBJECTIVES, PDA_DIALOGS } state;
-
-  void show_objectives();
-  void show_dialogs();
-
-public:
-  PDA();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-  void add_dialog(const std::string&amp; character, const std::string&amp; text);
-  
-  void add_objective(const std::string&amp; name, const std::string&amp; text);
-  void objective_complete(const std::string&amp; name);
-  bool is_objective_given(const std::string&amp; name);
-  bool is_objective_complete(const std::string&amp; name);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/windstille/src/screen/armature_test.cpp (from rev 2466, trunk/windstille/src/armature_test.cpp)


Property changes on: trunk/windstille/src/screen/armature_test.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/armature_test.hpp (from rev 2466, trunk/windstille/src/armature_test.hpp)


Property changes on: trunk/windstille/src/screen/armature_test.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/game_session.cpp (from rev 2466, trunk/windstille/src/game_session.cpp)
===================================================================
--- trunk/windstille/src/game_session.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/screen/game_session.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,496 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;math.h&gt;
+#include &lt;sstream&gt;
+#include &lt;stdarg.h&gt;
+
+#include &lt;squirrel.h&gt; 
+#include &lt;sqstdio.h&gt; 
+#include &lt;sqstdaux.h&gt; 
+
+#include &quot;menu_manager.hpp&quot;
+#include &quot;font/fonts.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
+#include &quot;console.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
+#include &quot;objects/player.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
+#include &quot;screen_manager.hpp&quot;
+#include &quot;view.hpp&quot;
+#include &quot;timer.hpp&quot;
+#include &quot;hud/energy_bar.hpp&quot;
+#include &quot;hud/dialog_manager.hpp&quot;
+#include &quot;windstille_main.hpp&quot;
+#include &quot;display/scene_context.hpp&quot;
+#include &quot;scripting/util.hpp&quot;
+#include &quot;scripting/wrapper.hpp&quot;
+#include &quot;input/input_manager.hpp&quot;
+#include &quot;particles/particle_system.hpp&quot;
+#include &quot;particles/spark_drawer.hpp&quot;
+#include &quot;particles/surface_drawer.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
+#include &quot;sound/sound_manager.hpp&quot;
+#include &quot;hud/conversation.hpp&quot;
+#include &quot;collision/collision_engine.hpp&quot;
+#include &quot;objects/test_object.hpp&quot;
+#include &quot;hud/inventory.hpp&quot;
+#include &quot;display/surface_manager.hpp&quot;
+#include &quot;display/surface.hpp&quot;
+#include &quot;display/display.hpp&quot;
+#include &quot;hud/pda.hpp&quot;
+
+#include &quot;game_session.hpp&quot;
+
+GameSession* GameSession::current_ = 0; 
+
+class GameSessionImpl
+{
+public:
+  SceneContext sc;
+
+  float fadeout_value;
+  float fade_time;
+  Sector* sector;
+  View    view;
+
+  std::string filename;
+
+  bool pause;
+  
+  /** Amount of how far the cutscene bars are visible, 0.0 means not
+      visible, 1.0 fully visible. */
+  float cutscene_value;
+
+  /** True if cutscene is active, false otherwhise */
+  bool  cutscene_mode;
+
+  enum { NO_ACTION, QUIT_ACTION, CHANGE_SECTOR_ACTION } next_action;
+  
+  enum { FADEIN, RUNNING, FADEOUT } fade_state;
+
+  Color fade_color;
+
+  // GUI Elements
+  ControllerHelpWindow controller_help_window;
+  EnergyBar     energy_bar;
+
+  // Active GUI Elements
+  DialogManager dialog_manager;
+  Conversation  conversation;
+  Inventory     inventory;
+  PDA           pda;
+
+  Screen* current_gui;
+
+  GameSessionImpl() {
+    sector         = 0;
+    current_gui    = 0;
+    cutscene_mode  = false;
+    cutscene_value = 0.0f;
+    fade_color     = Color(0.0f, 0.0f, 0.0f, 1.0f);
+    fade_state     = RUNNING;
+    fadeout_value  = 0.0f;
+    fade_time      = 1.0f;
+  }
+  ~GameSessionImpl() {
+    delete sector;
+  }
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+  void handle_event(const SDL_Event&amp; event);
+};
+
+GameSession::GameSession(const std::string&amp; arg_filename)
+  : impl(new GameSessionImpl())
+{
+  impl-&gt;filename = arg_filename;
+
+  if (debug) std::cout &lt;&lt; &quot;Creating new GameSession&quot; &lt;&lt; std::endl;
+  current_ = this;
+
+  impl-&gt;pause = false;
+  
+  if (1)
+    script_manager-&gt;run_script_file(&quot;scripts/init_script_vars.nut&quot;);
+    
+  set_sector(impl-&gt;filename);
+}
+
+GameSession::~GameSession()
+{
+}
+
+void
+GameSessionImpl::draw()
+{
+  view.draw(sc);
+
+  // Render the scene to the screen
+  sc.render();
+
+  if (!cutscene_mode)
+    {
+      // Draw HUD
+      energy_bar.draw();
+      controller_help_window.draw();
+    }
+
+  if (cutscene_mode || cutscene_value &gt; 0.0f)
+    {
+      int border_size = static_cast&lt;int&gt;(75 * cutscene_value);
+      Display::fill_rect(Rect(Point(0, 0), Size(Display::get_width(), border_size)), 
+                         Color(0.0f, 0.0f, 0.0f, cutscene_value));
+      Display::fill_rect(Rect(Point(0, Display::get_height() - border_size), Size(Display::get_width(), border_size)), 
+                         Color(0.0f, 0.0f, 0.0f, cutscene_value));
+    }
+
+  if (current_gui)
+    current_gui-&gt;draw();
+
+  if (fade_state == FADEOUT || fade_state == FADEIN)
+    {
+      Display::fill_rect(Rect(0, 0, 
+                               Display::get_width(), Display::get_height()),
+                         Color(fade_color.r, fade_color.g, fade_color.b, fadeout_value));
+    }
+
+  if (pause)
+    {
+      if ((SDL_GetTicks() / 1000) % 2)
+        Fonts::vera20-&gt;draw(Display::get_width()/2, Display::get_height()/2, &quot;Pause&quot;);
+    }
+}
+
+void
+GameSessionImpl::update(float delta, const Controller&amp; controller)
+{  
+  if (cutscene_mode)
+    cutscene_value += delta * 0.75f;
+  else
+    cutscene_value -= delta * 0.75f;
+
+  if (cutscene_value &gt; 1.0f)
+    cutscene_value = 1.0f;
+  else if (cutscene_value &lt; 0.0f)
+    cutscene_value = 0.0f;
+
+  // if (controller.button_was_pressed(PAUSE_BUTTON))
+  // pause = !pause;
+
+  Uint8 *keystate = SDL_GetKeyState(NULL);
+
+  if(keystate[SDLK_KP1])
+    game_speed *= 1.0 - delta;
+  if(keystate[SDLK_KP3])
+    game_speed *= 1.0 + delta;
+  if(keystate[SDLK_KP5])
+    game_speed = 1.0;
+ 
+  delta *= game_speed;
+
+  if (!pause)
+    {
+      game_time += delta;
+      script_manager-&gt;update();
+      
+      view.update(delta, controller);
+      sector-&gt;update(delta);
+  
+      switch (fade_state)
+        {
+        case FADEIN:
+          if (fadeout_value &lt;= 0.0f)
+            {
+              fade_state = RUNNING;
+              fadeout_value = 0.0f;
+              script_manager-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
+            }
+          else
+            {
+              fadeout_value -= delta * fade_time;
+            }
+          break;
+
+        case FADEOUT:
+          if (fadeout_value &gt;= 1.0f)
+            { 
+              fadeout_value = 1.0f;
+              script_manager-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
+
+              switch(next_action)
+                {
+                case CHANGE_SECTOR_ACTION:
+                  GameSession::current()-&gt;set_sector(filename);
+                  break;
+
+                case QUIT_ACTION:
+                  screen_manager.quit();
+                  break;
+
+                default:
+                  break;
+                }
+            }
+          else
+            {
+              fadeout_value += delta * fade_time;
+            }
+          break;
+
+        case RUNNING:
+          energy_bar.update(delta, controller);
+          if (current_gui)
+            current_gui-&gt;update(delta, controller);
+          break;
+        }
+      
+      controller_help_window.update(delta, controller);
+    }
+
+  if (controller.button_was_pressed(PDA_BUTTON))
+    {
+      if (current_gui == &amp;pda)
+        current_gui = 0;
+      else
+        current_gui = &pda;
+    }
+  else if (controller.button_was_pressed(INVENTORY_BUTTON))
+    {
+      if (current_gui == &amp;inventory)
+        current_gui = 0;
+      else
+        current_gui = &inventory;
+    }
+  else if (controller.button_was_pressed(ESCAPE_BUTTON) ||
+           controller.button_was_pressed(PAUSE_BUTTON))
+    {
+      menu_manager.display_pause_menu();
+    }
+}
+
+void
+GameSession::change_sector(const std::string&amp; arg_filename)
+{
+  impl-&gt;filename = arg_filename;
+ 
+  sound_manager-&gt;stop_music();
+
+  if (impl-&gt;fade_state == GameSessionImpl::FADEOUT)
+    {
+      GameSession::current()-&gt;set_sector(impl-&gt;filename);
+    }
+  else
+    {
+      impl-&gt;fade_time     = 1.0f;
+      impl-&gt;fade_state    = GameSessionImpl::FADEOUT;
+      impl-&gt;next_action   = GameSessionImpl::CHANGE_SECTOR_ACTION;
+    }
+}
+
+void
+GameSession::set_sector(const std::string&amp; )
+{
+  delete impl-&gt;sector;
+  impl-&gt;sector = new Sector(impl-&gt;filename);
+ 
+  GameObject::set_world(impl-&gt;sector);
+
+  //FIXME: does the TestObject class still need to exist?
+  //sector-&gt;add(new TestObject());
+  
+  impl-&gt;sector-&gt;activate();
+  
+  if (debug) std::cout &lt;&lt; &quot;Finished changing sector&quot; &lt;&lt; std::endl;
+}
+
+void
+GameSessionImpl::handle_event(const SDL_Event&amp; event)
+{
+  switch(event.type)
+  {
+    case SDL_KEYDOWN:
+    case SDL_KEYUP:
+      if (event.key.state)
+        {    
+          switch (event.key.keysym.sym)
+            {
+            case SDLK_1:
+              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::COLORMAP);
+              console &lt;&lt; &quot;Toggled COLORMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::COLORMAP) &gt; 0) &lt;&lt; std::endl;
+              break;
+
+            case SDLK_2:
+              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAP);
+              console &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAP) &gt; 0) &lt;&lt; std::endl;
+              break;
+      
+            case SDLK_3:
+              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::HIGHLIGHTMAP);
+              console &lt;&lt; &quot;Toggled HIGHLIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::HIGHLIGHTMAP) &gt; 0) &lt;&lt; std::endl;
+              break;      
+  
+            case SDLK_4:
+              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAPSCREEN);
+              console &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAPSCREEN) &gt; 0) &lt;&lt; std::endl;
+              break;
+
+            case SDLK_5:
+              sc.set_render_mask(sc.get_render_mask() ^ SceneContext::BLURMAP);
+              console &lt;&lt; &quot;Toggled blurmap: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::BLURMAP) &gt; 0) &lt;&lt; std::endl;
+              break;
+
+
+            case SDLK_c:
+              if (debug) {
+                collision_debug = !collision_debug;
+                console &lt;&lt; &quot;Collision Debugging &quot; &lt;&lt; (collision_debug ? &quot;enabled&quot; : &quot;disabled&quot;) &lt;&lt; std::endl;
+              }
+              break;
+
+            case SDLK_F2:
+              menu_manager.display_debug_menu();
+              break;
+        
+            default:
+              break;
+            }
+        }
+      break;
+        
+    case SDL_MOUSEBUTTONDOWN:
+      {
+        Vector real_pos = GameSession::current()-&gt;get_view()-&gt;screen_to_world(Vector(event.button.x,
+                                                                                  event.button.y));      
+        console &lt;&lt; &quot;Click at: &quot; &lt;&lt; int(real_pos.x) &lt;&lt; &quot;, &quot; &lt;&lt; int(real_pos.y) &lt;&lt; std::endl;
+      }
+      break;
+  }
+}
+
+void
+GameSession::quit()
+{
+  if (impl-&gt;fade_state != GameSessionImpl::FADEOUT)
+    {
+      sound_manager-&gt;stop_music();
+      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
+      impl-&gt;fade_time   = 1.0f;
+      impl-&gt;next_action = GameSessionImpl::QUIT_ACTION;
+    }
+}
+
+PDA&amp;
+GameSession::get_pda()
+{
+  return impl-&gt;pda;
+}
+
+void
+GameSession::draw()
+{
+  impl-&gt;draw();
+}
+
+void
+GameSession::update(float delta, const Controller&amp; controller)
+{
+  impl-&gt;update(delta, controller);
+}
+
+void
+GameSession::handle_event(const SDL_Event&amp; event)
+{
+  impl-&gt;handle_event(event);
+}
+
+View*
+GameSession::get_view() 
+{
+  return &amp;impl-&gt;view; 
+}
+
+void
+GameSession::set_control_state(ControlState state) 
+{
+  switch(state)
+    {
+    case DIALOG:
+      impl-&gt;current_gui = &amp;impl-&gt;dialog_manager;
+      break;
+
+    case CONVERSATION:
+      impl-&gt;current_gui = &amp;impl-&gt;conversation;
+      break;
+
+    case GAME:
+      impl-&gt;current_gui = 0;
+      break;
+    }
+}
+
+bool
+GameSession::is_active() const
+{
+  return (impl-&gt;current_gui == 0);
+}
+
+void
+GameSession::set_cutscene_mode(bool t)
+{
+  if (t != impl-&gt;cutscene_mode)
+    {
+      impl-&gt;cutscene_mode  = t;
+    }
+}
+
+void
+GameSession::fadeout(float time, const Color&amp; color)
+{
+  if (time == 0.0)
+    { // directly go to a state of solid color, no fading
+      impl-&gt;fadeout_value  = 1.0f;
+      impl-&gt;fade_color  = color;
+      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
+      impl-&gt;next_action = GameSessionImpl::NO_ACTION;
+    }
+  else
+    {
+      impl-&gt;fade_time   = 1.0f/time;
+      impl-&gt;fade_color  = color;
+      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
+      impl-&gt;next_action = GameSessionImpl::NO_ACTION;
+    }
+}
+
+void
+GameSession::fadein(float time)
+{
+  impl-&gt;fade_time   = 1.0f/time;
+  impl-&gt;fade_state  = GameSessionImpl::FADEIN;
+  impl-&gt;next_action = GameSessionImpl::NO_ACTION;
+}
+
+SceneContext*
+GameSession::get_scene_context()
+{
+  return &amp;(impl-&gt;sc);
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/screen/game_session.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/game_session.hpp (from rev 2466, trunk/windstille/src/game_session.hpp)
===================================================================
--- trunk/windstille/src/game_session.hpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/screen/game_session.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,93 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_GAME_SESSION_HPP
+#define HEADER_WINDSTILLE_GAME_SESSION_HPP
+
+#include &lt;string&gt;
+#include &lt;squirrel.h&gt;
+#include &quot;display/scene_context.hpp&quot;
+#include &quot;console.hpp&quot;
+#include &quot;screen.hpp&quot;
+#include &quot;hud/controller_help_window.hpp&quot;
+#include &quot;sprite2d/sprite.hpp&quot;
+#include &quot;globals.hpp&quot;
+
+class PDA;
+class EnergyBar;
+class View;
+class Sector;
+class Player;
+class DialogManager;
+class Conversation;
+class Inventory;
+
+class GameSessionImpl;
+
+class GameSession : public Screen
+{
+public:
+  enum ControlState { DIALOG, GAME, CONVERSATION };
+private:
+  static GameSession* current_; 
+public:
+  static GameSession* current() { return current_; } 
+
+  GameSession (const std::string&amp; arg_filename);
+  ~GameSession ();
+
+  View* get_view();
+
+  /** Return true when the gameplay is currently active, return false
+      if PDA, Conversation or other things are active */
+  bool is_active() const;
+
+  void set_control_state(ControlState state);
+
+  /** Switches the sector instantly without fadeout */
+  void set_sector(const std::string&amp; filename);
+
+  /** Fades out then switches sectors and fades in again */
+  void change_sector(const std::string&amp; filename);
+
+  /** Set the GameSession into a mode for cutscenes, this means for
+      most part to switch into a 16:9 viewmode with black borders */
+  void set_cutscene_mode(bool t);
+
+  /** \a time Time in seconds till the fade is complete 
+      \a color Color to which the screen should fade */
+  void fadeout(float time, const Color&amp; color);
+  void fadein(float time);
+
+  void draw();
+  void update(float delta, const Controller&amp; controller);
+  void handle_event(const SDL_Event&amp; event);
+
+  PDA&amp; get_pda();
+
+  void quit();
+
+  SceneContext* get_scene_context();
+
+private:
+  boost::shared_ptr&lt;GameSessionImpl&gt; impl;
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/screen/game_session.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/geometry_test.cpp (from rev 2466, trunk/windstille/src/geometry_test.cpp)


Property changes on: trunk/windstille/src/screen/geometry_test.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/geometry_test.hpp (from rev 2466, trunk/windstille/src/geometry_test.hpp)


Property changes on: trunk/windstille/src/screen/geometry_test.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/navigation_test.cpp (from rev 2466, trunk/windstille/src/navigation_test.cpp)


Property changes on: trunk/windstille/src/screen/navigation_test.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/navigation_test.hpp (from rev 2466, trunk/windstille/src/navigation_test.hpp)


Property changes on: trunk/windstille/src/screen/navigation_test.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/particle_viewer.cpp (from rev 2466, trunk/windstille/src/particle_viewer.cpp)
===================================================================
--- trunk/windstille/src/particle_viewer.cpp	2009-02-11 21:56:29 UTC (rev 2466)
+++ trunk/windstille/src/screen/particle_viewer.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -0,0 +1,203 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;util/sexpr_file_reader.hpp&quot;
+#include &quot;input/controller.hpp&quot;
+#include &quot;screen_manager.hpp&quot;
+#include &quot;gui/gui_manager.hpp&quot;
+#include &quot;screen/particle_viewer.hpp&quot;
+
+// Components
+#include &quot;gui/button.hpp&quot;
+#include &quot;gui/label.hpp&quot;
+#include &quot;gui/slider.hpp&quot;
+#include &quot;gui/root_component.hpp&quot;
+#include &quot;gui/grid_component.hpp&quot;
+#include &quot;gui/tab_component.hpp&quot;
+#include &quot;gui/list_view.hpp&quot;
+#include &quot;gui/text_view.hpp&quot;
+#include &quot;gui/automap.hpp&quot;
+
+class ParticleSystemGUI
+{
+public:
+  ParticleSystem* psystem;
+  gui::GridComponent* grid;
+  gui::Slider* gravity_slider;
+  gui::Slider* velocity_slider;
+  gui::Slider* count_slider;
+  
+  ParticleSystemGUI(gui::Component* parent, ParticleSystem* psystem_)
+    : psystem(psystem_)
+  {
+    using namespace gui;
+    grid = new GridComponent(Rectf(200, 120, 600, 220), 2, 3, parent);
+    grid-&gt;set_padding(4);
+
+    gravity_slider  = new Slider(grid);
+    velocity_slider = new Slider(grid);
+    count_slider    = new Slider(grid);
+
+    gravity_slider-&gt;set_range(-10, 10);
+    gravity_slider-&gt;set_step(3);
+    gravity_slider-&gt;set_pos(1);
+
+    velocity_slider-&gt;set_range(-500, 500);
+    velocity_slider-&gt;set_step(50);
+    velocity_slider-&gt;set_pos(10);//psystem-&gt;get_count());
+
+    count_slider-&gt;set_range(1, 500);
+    count_slider-&gt;set_step(10);
+    count_slider-&gt;set_pos(psystem-&gt;get_count());
+
+    grid-&gt;pack(new Label(&quot;Gravitation:&quot;), 0, 0);
+    grid-&gt;pack(new Label(&quot;Velocity:&quot;),    0, 1);
+    grid-&gt;pack(new Label(&quot;Count:&quot;),       0, 2);
+
+    grid-&gt;pack(gravity_slider,  1, 0);
+    grid-&gt;pack(velocity_slider, 1, 1);
+    grid-&gt;pack(count_slider,    1, 2);    
+  }
+
+  void update()
+  {
+    psystem-&gt;set_count(count_slider-&gt;get_pos());
+  }
+
+  gui::Component* get_component() { return grid; }
+};
+
+ParticleViewer::ParticleViewer()
+{
+  background = Sprite(&quot;images/greychess.sprite&quot;);
+  show_gui = false;
+
+  using namespace gui;
+
+  manager = new GUIManager();
+  tab = new TabComponent(Rectf(200, 50, 600, 250), manager-&gt;get_root());
+  
+  manager-&gt;get_root()-&gt;add_child(tab);
+}
+
+ParticleViewer::~ParticleViewer()
+{
+}
+
+void
+ParticleViewer::load(const std::string&amp; filename)
+{
+  std::cout &lt;&lt; &quot;ParticleViewer: loading &quot; &lt;&lt; filename &lt;&lt; std::endl;
+  
+  for(Systems::iterator i = systems.begin(); i != systems.end(); ++i)
+    delete *i;
+  systems.clear();
+  
+  FileReader root_reader = FileReader::parse(filename);
+  if(root_reader.get_name() != &quot;particle-systems&quot;) {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a particle-system file&quot;;
+    throw std::runtime_error(msg.str());
+  }
+
+  std::vector&lt;FileReader&gt; sections = root_reader.get_sections();
+  for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+    { 
+      if (i-&gt;get_name() == &quot;particle-system&quot;)
+      {
+        systems.push_back(new ParticleSystem(*i));
+
+        guis.push_back(new ParticleSystemGUI(tab, systems.back()));
+        tab-&gt;pack(&quot;Testomap&quot;, guis.back()-&gt;get_component());
+      }
+  }
+
+  std::cout &lt;&lt; systems.size() &lt;&lt; &quot; particle systems ready to go&quot; &lt;&lt; std::endl;
+}
+  
+void
+ParticleViewer::draw()
+{
+  sc.reset_modelview();
+
+  for(int y = -background.get_width(); y &lt; 600 + background.get_height(); y += background.get_height())
+    for(int x = -background.get_width(); x &lt; 800 + background.get_width(); x += background.get_width())
+      sc.color().draw(background, Vector(x + int(pos.x) % background.get_width(),
+                                         y + int(pos.y) % background.get_height()), -900);
+
+  sc.translate(400 + pos.x, 600 + pos.y);
+  sc.light().fill_screen(Color(0.4, 0.4, 0.4));
+  //sc.light().fill_screen(Color(1.0, 1.0, 1.0));
+  sc.color().fill_screen(Color(0.0, 0.0, 0.0));
+
+  for(Systems::iterator i = systems.begin(); i != systems.end(); ++i)
+    (*i)-&gt;draw(sc);
+
+  sc.render();
+
+  if (show_gui)
+    {
+      manager-&gt;draw();
+    }
+}
+
+void
+ParticleViewer::update(float delta, const Controller&amp; controller)
+{
+  for(Systems::iterator i = systems.begin(); i != systems.end(); ++i)
+    (*i)-&gt;update(delta);
+
+  if (!show_gui)
+    {
+      pos.x += controller.get_axis_state(X_AXIS) * delta * 100.0f;
+      pos.y += controller.get_axis_state(Y_AXIS) * delta * 100.0f;
+
+      if (controller.button_was_pressed(OK_BUTTON))
+        {
+          // FIXME: Disable GUI, since its crashy
+          // show_gui = true;
+          // manager-&gt;get_root()-&gt;get_focus()-&gt;set_active(true);
+        }
+      else if (controller.button_was_pressed(CANCEL_BUTTON) ||
+               controller.button_was_pressed(ESCAPE_BUTTON))
+        {
+          screen_manager.pop_screen();
+        }
+    }
+  else
+    {
+      if (!manager-&gt;get_root()-&gt;is_active())
+        {
+          show_gui = false;
+        }
+      else
+        {
+          manager-&gt;update(delta, controller);
+        }
+    }
+
+  for(ParticleSystemGUIs::iterator i = guis.begin(); i != guis.end(); ++i)
+    {
+      (*i)-&gt;update();
+    }
+
+  //systems[3]-&gt;set_count(count_slider-&gt;get_pos());
+  //systems[3]-&gt;set_velocity(velocity_slider-&gt;get_pos(), velocity_slider-&gt;get_pos());
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/screen/particle_viewer.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/particle_viewer.hpp (from rev 2466, trunk/windstille/src/particle_viewer.hpp)


Property changes on: trunk/windstille/src/screen/particle_viewer.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/screen.cpp (from rev 2466, trunk/windstille/src/screen.cpp)


Property changes on: trunk/windstille/src/screen/screen.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/screen.hpp (from rev 2466, trunk/windstille/src/screen.hpp)


Property changes on: trunk/windstille/src/screen/screen.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/screen_manager.cpp (from rev 2466, trunk/windstille/src/screen_manager.cpp)


Property changes on: trunk/windstille/src/screen/screen_manager.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/screen_manager.hpp (from rev 2466, trunk/windstille/src/screen_manager.hpp)


Property changes on: trunk/windstille/src/screen/screen_manager.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/sprite2dview.cpp (from rev 2466, trunk/windstille/src/sprite2dview.cpp)


Property changes on: trunk/windstille/src/screen/sprite2dview.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/sprite2dview.hpp (from rev 2466, trunk/windstille/src/sprite2dview.hpp)


Property changes on: trunk/windstille/src/screen/sprite2dview.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/sprite3dview.cpp (from rev 2466, trunk/windstille/src/sprite3dview.cpp)


Property changes on: trunk/windstille/src/screen/sprite3dview.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/sprite3dview.hpp (from rev 2466, trunk/windstille/src/sprite3dview.hpp)


Property changes on: trunk/windstille/src/screen/sprite3dview.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/screen/title_screen.cpp (from rev 2466, trunk/windstille/src/title_screen.cpp)


Property changes on: trunk/windstille/src/screen/title_screen.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/screen/title_screen.hpp (from rev 2466, trunk/windstille/src/title_screen.hpp)


Property changes on: trunk/windstille/src/screen/title_screen.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: trunk/windstille/src/screen.cpp
===================================================================
--- trunk/windstille/src/screen.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/screen.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,40 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;math.h&gt;
-#include &lt;iostream&gt;
-#include &quot;display/display.hpp&quot;
-#include &quot;windstille_main.hpp&quot;
-#include &quot;screen.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;config.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;input/input_manager_sdl.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-
-Screen::Screen()
-{
-}
-
-Screen::~Screen()
-{
-}
-
-/* EOF */

Deleted: trunk/windstille/src/screen.hpp
===================================================================
--- trunk/windstille/src/screen.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/screen.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,48 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SCREEN_HPP
-#define HEADER_WINDSTILLE_SCREEN_HPP
-
-#include &lt;SDL.h&gt;
-
-class Controller;
-
-/** */
-class Screen
-{
-public:
-  Screen();
-  virtual ~Screen();
-
-  virtual void on_startup() {}
-
-  /** Draw the current screen */
-  virtual void draw() =0;
-
-  /** Update the current screen by \a delta and with input from \a
-      controller */
-  virtual void update(float delta, const Controller&amp; controller) =0;
-
-  /** Called once a new SDL_Event arrives */
-  virtual void handle_event(const SDL_Event&amp; ) {}
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/screen_manager.cpp
===================================================================
--- trunk/windstille/src/screen_manager.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/screen_manager.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,363 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;boost/format.hpp&gt;
-#include &lt;iostream&gt;
-#ifndef WIN32
-#include &lt;unistd.h&gt;
-#endif
-#include &quot;game_session.hpp&quot;
-#include &quot;input/input_manager_sdl.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;screen.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;config.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;input/input_configurator.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-#include &quot;gui/gui_manager.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-
-// GUI Stuff, can be removed if gui is a bit better organised
-#include &quot;gui/button.hpp&quot;
-#include &quot;gui/slider.hpp&quot;
-#include &quot;gui/root_component.hpp&quot;
-#include &quot;gui/grid_component.hpp&quot;
-#include &quot;gui/menu_component.hpp&quot;
-#include &quot;gui/tab_component.hpp&quot;
-#include &quot;gui/list_view.hpp&quot;
-#include &quot;gui/text_view.hpp&quot;
-#include &quot;gui/automap.hpp&quot;
-
-#ifdef WIN32
-#define snprintf _snprintf
-#endif
-
-ScreenManager screen_manager; 
-
-ScreenManager::ScreenManager()
-  : time_counter(0),
-    frame_counter(0),
-    last_fps(0),
-    overlap_delta(0),
-    do_quit(false)
-{
-  screen_action = NONE;
-  screen_screen = 0;
-
-  overlay_screen_action = NONE;
-  overlay_screen_screen = 0;
-
-  ticks = 0;
-}
-
-ScreenManager::~ScreenManager()
-{
-}
-
-void
-ScreenManager::run()
-{
-  do_quit = false;
-
-  ticks = SDL_GetTicks();
-
-  while (!do_quit)
-    {
-      /// Amount of time the world moves forward each update(), this is
-      /// independed of the number of frames and always constant
-      static const float step = .001;
-
-      Uint32 now = SDL_GetTicks();
-      float delta = static_cast&lt;float&gt;(now - ticks) / 1000.0f + overlap_delta;
-      ticks = now;
-
-      time_counter  += delta;
-
-      while (delta &gt; step)
-        {
-          InputManager::update(delta);
-
-          console.update(step);
-          if (!console.is_active())
-            {
-              if (!overlay_screens.empty())
-                overlay_screens.back()-&gt;update(step, InputManager::get_controller());
-              else if (!screens.empty())
-                screens.back()-&gt;update(step, InputManager::get_controller());
-            }
-          InputManager::clear();
-  
-          delta -= step;
-        }
-
-      overlap_delta = delta;
-
-      sound_manager-&gt;update();
-
-      if (!screens.empty())
-        screens.back()-&gt;draw();
-
-      if (!overlay_screens.empty())
-        overlay_screens.back()-&gt;draw();
-
-      console.draw();
-
-      if (config.get_bool(&quot;show-fps&quot;))
-        draw_fps();
-
-      SDL_GL_SwapBuffers();
-      frame_counter += 1;
-
-      // Commit any pending screen actions
-      switch(overlay_screen_action)
-        {
-        case PUSH_SCREEN:
-          overlay_screens.push_back(overlay_screen_screen);
-          break;
-
-        case POP_SCREEN:
-          overlay_screens.pop_back();
-          break;
-
-        case CLEAR_SCREENS:
-          for(std::vector&lt;Screen*&gt;::iterator i = overlay_screens.begin(); i != overlay_screens.end(); ++i)
-            delete *i;
-          overlay_screens.clear();
-          break;
-
-        case NONE:
-          // nothing
-          break;
-        }
-      overlay_screen_action = NONE;
-
-      switch(screen_action)
-        {
-        case PUSH_SCREEN:
-          screens.push_back(screen_screen);
-          screens.back()-&gt;on_startup();
-          break;
-
-        case POP_SCREEN:
-          screens.pop_back();
-          if (!screens.empty())
-            screens.back()-&gt;on_startup();
-          break;
-
-        case CLEAR_SCREENS:
-          for(std::vector&lt;Screen*&gt;::iterator i = screens.begin(); i != screens.end(); ++i)
-            delete *i;
-          screens.clear();
-          break;
-
-        case NONE:
-          // nothing
-          break;
-        }
-      screen_action = NONE;
-
-      poll_events();
-    }
-}
-
-void
-ScreenManager::poll_events()
-{
-  SDL_Event event;
-  while(SDL_PollEvent(&amp;event))
-    {
-      switch(event.type)
-        {
-        case SDL_QUIT:
-          // FIXME: This should be a bit more gentle, but will do for now
-          std::cout &lt;&lt; &quot;Ctrl-c or Window-close pressed, game is going to quit&quot; &lt;&lt; std::endl;
-          quit();
-          break;
-          
-        case SDL_ACTIVEEVENT:
-          // event.active
-          break;
-          
-        case SDL_VIDEORESIZE:
-          // event.resize
-          break;
-              
-        case SDL_VIDEOEXPOSE:
-          // event.expose
-          break;
-                
-        case SDL_USEREVENT:
-          // event.user
-          break;
-                    
-        case SDL_SYSWMEVENT:
-          // event.syswm
-          break;
-          break;
-
-        case SDL_KEYDOWN:
-        case SDL_KEYUP:
-          if (event.key.state)
-            {    
-              switch (event.key.keysym.sym)
-                {
-                case SDLK_F6:
-                  SDL_ShowCursor(SDL_ENABLE);   // SDL_ENABLE to show the mouse cursor (default)
-                  SDL_WM_GrabInput(SDL_GRAB_OFF); // SDL_GRAB_OFF to not grab input (default)
-                  break;
-
-                case SDLK_F7:
-                  SDL_ShowCursor(SDL_DISABLE);   // SDL_ENABLE to show the mouse cursor (default)
-                  SDL_WM_GrabInput(SDL_GRAB_ON); // SDL_GRAB_OFF to not grab input (default)
-                  break;
-      
-                case SDLK_F9:
-                  push_overlay(new InputConfigurator());
-                  break;
-
-                case SDLK_F10:
-                  config.set_bool(&quot;show-fps&quot;, !config.get_bool(&quot;show-fps&quot;));
-                  break;
-              
-                case SDLK_F11:
-                  config.set_bool(&quot;fullscreen&quot;, !config.get_bool(&quot;fullscreen&quot;));
-                  Display::set_fullscreen(config.get_bool(&quot;fullscreen&quot;));
-                  break;
-              
-#ifndef WIN32
-                case SDLK_F12:
-                  {
-                    // FIXME: Replace this with Physfs stuff
-                    int count = 0;
-                    std::string filename;
-                    do {
-                      filename = (boost::format(&quot;/tmp/windstille%04d.png&quot;) % count).str();
-                      count += 1;
-                    } while(access(filename.c_str(), F_OK) == 0);
-
-                    Display::save_screenshot(filename);
-                    console &lt;&lt; &quot;Writing screenshot to: '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-                  }
-                  break;
-#endif
-              
-                default:
-                  if (!console.is_active())
-                    {
-                      if (!overlay_screens.empty())
-                        overlay_screens.back()-&gt;handle_event(event);
-                      else if (!screens.empty())
-                        screens.back()-&gt;handle_event(event);
-                    }
-                  break;
-                }
-            }
-              
-          if (!console.is_active() &amp;&amp; event.key.state &amp;&amp; event.key.keysym.sym == SDLK_F1)
-            {
-              console.activate();
-            }
-          else
-            {
-              if (InputManagerSDL::current())
-                InputManagerSDL::current()-&gt;on_event(event);
-            }
-          break;
-
-        case SDL_MOUSEBUTTONUP:
-        case SDL_MOUSEBUTTONDOWN:
-        case SDL_MOUSEMOTION:
-        case SDL_JOYAXISMOTION:
-        case SDL_JOYBALLMOTION:
-        case SDL_JOYHATMOTION:
-        case SDL_JOYBUTTONUP:
-        case SDL_JOYBUTTONDOWN:
-          if (InputManagerSDL::current())
-            InputManagerSDL::current()-&gt;on_event(event);
-
-          if (!overlay_screens.empty())
-            overlay_screens.back()-&gt;handle_event(event);
-          break;
-        
-        default:
-          if (!overlay_screens.empty())
-            overlay_screens.back()-&gt;handle_event(event);
-          else if (!screens.empty())
-            screens.back()-&gt;handle_event(event);
-          break;
-        }
-    }
-}
-
-void 
-ScreenManager::draw_fps()
-{
-  if(time_counter &gt; 1) 
-    {
-      last_fps = int(frame_counter / time_counter);
-
-      time_counter  = fmodf(time_counter, 1.0);
-      frame_counter = 0;
-    }
-  
-  char output[20];
-  snprintf(output, sizeof(output), &quot;FPS: %d&quot;, last_fps);
-  Fonts::ttffont-&gt;draw(Display::get_width() - 100, 30, output);
-}
-
-void
-ScreenManager::push_screen(Screen* s)
-{
-  screen_action = PUSH_SCREEN;
-  screen_screen = s;
-}
-
-void
-ScreenManager::pop_screen()
-{
-  screen_action = POP_SCREEN;
-}
-
-void
-ScreenManager::push_overlay(Screen* s)
-{
-  overlay_screen_action = PUSH_SCREEN;
-  overlay_screen_screen = s;
-}
-
-void
-ScreenManager::pop_overlay()
-{
-  overlay_screen_action = POP_SCREEN;
-}
-
-void
-ScreenManager::clear_overlay()
-{
-  overlay_screen_action = CLEAR_SCREENS;
-}
-
-void
-ScreenManager::quit()
-{
-  do_quit = true;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/screen_manager.hpp
===================================================================
--- trunk/windstille/src/screen_manager.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/screen_manager.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,81 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SCREEN_MANAGER_HPP
-#define HEADER_WINDSTILLE_SCREEN_MANAGER_HPP
-
-class Screen;
-
-/**
- *  The ScreenManager handles overlays like Option Menus, Main Menus
- *  and such
- */
-class ScreenManager
-{
-private:
-  enum ScreenAction { NONE, POP_SCREEN, PUSH_SCREEN, CLEAR_SCREENS };
-
-  std::vector&lt;Screen*&gt; screens;
-  ScreenAction screen_action;
-  Screen*      screen_screen;
-
-  std::vector&lt;Screen*&gt; overlay_screens;
-  ScreenAction overlay_screen_action;
-  Screen*      overlay_screen_screen;
-
-  unsigned int ticks;
-
-  float time_counter;
-  int   frame_counter;
-  int   last_fps;
-  float overlap_delta;
-  bool  do_quit;
-
-public:
-  ScreenManager();
-  ~ScreenManager();
-
-  /** Displays the previously set screen in until quit() is called */
-  void run();
-
-  /** Breaks out of the run() function */
-  void quit();
-
-  void push_screen(Screen* s);
-  void pop_screen();
-
-  void push_overlay(Screen* s);
-  void pop_overlay();
-  void clear_overlay();
-
-  // Callbacks, FIXME: Could be moved to a seperate class
-  void show_fps(int i);
-
-private:
-  void poll_events();
-  void draw_fps();
-
-  ScreenManager (const ScreenManager&amp;);
-  ScreenManager&amp; operator= (const ScreenManager&amp;);
-};
-
-extern ScreenManager screen_manager; 
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/scripting/interface.cpp
===================================================================
--- trunk/windstille/src/scripting/interface.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/scripting/interface.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -21,18 +21,18 @@
 #include &quot;util.hpp&quot;
 #include &quot;interface.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;
-#include &quot;game_session.hpp&quot;
-#include &quot;dialog_manager.hpp&quot;
-#include &quot;conversation.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
+#include &quot;hud/dialog_manager.hpp&quot;
+#include &quot;hud/conversation.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;engine/camera.hpp&quot;
 #include &quot;config.hpp&quot;
-#include &quot;pda.hpp&quot;
+#include &quot;hud/pda.hpp&quot;
 #include &quot;util/sexpr_file_reader.hpp&quot;
 #include &quot;display/display.hpp&quot;
-#include &quot;controller_help_window.hpp&quot;
+#include &quot;hud/controller_help_window.hpp&quot;
 
 namespace Scripting
 {

Deleted: trunk/windstille/src/sprite2dview.cpp
===================================================================
--- trunk/windstille/src/sprite2dview.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/sprite2dview.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,398 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &lt;algorithm&gt;
-#include &lt;physfs.h&gt;
-
-#include &quot;display/display.hpp&quot;
-#include &quot;sprite2d/manager.hpp&quot;
-#include &quot;math/math.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;display/surface_manager.hpp&quot;
-#include &quot;sprite2dview.hpp&quot;
-
-extern std::vector&lt;std::string&gt; arg_files;
-
-#define DISPLAY_W 800
-#define DISPLAY_H 600
-
-Sprite2DView::Sprite2DView()
-{
-  auto_scroll = false;
-  index = 0;
-
-  for(std::vector&lt;std::string&gt;::iterator i = arg_files.begin(); i != arg_files.end(); ++i)
-    {
-      if (PHYSFS_isDirectory(i-&gt;c_str()))
-        { 
-          adddir(i-&gt;c_str());
-        }
-      else
-        {
-          directory.push_back(*i);
-        }
-    }
-  
-  shuffle_directory = directory;
-  shuffle = false;
-
-  //std::sort(shuffle_directory.begin(), shuffle_directory.end());
-  //std::random_shuffle(shuffle_directory.begin(), shuffle_directory.end());
-
-  offset = 0.0f;
-
-  if (directory.size() &gt; 1)
-    mode = SLIDESHOW;
-  else
-    mode = SLIDESHOW; 
-
-  zoom = 1.0f;
-  pos  = Vector(0,0);
-  display_time = 0.0f;
-  show_thumbnail = false;
-  ignore_delta = false;
-
-
-  next_image(0);
-  sprite = new_sprite;
-  new_sprite = Sprite();
-
-}
-
-void
-Sprite2DView::adddir(const std::string&amp; dirname)
-{
-  char** dirlist = PHYSFS_enumerateFiles(dirname.c_str());
-  for (char **i = dirlist; *i != NULL; ++i)
-    {
-      //std::cout &lt;&lt; dirname + &quot;/&quot; + *i &lt;&lt; std::endl;
-      if (PHYSFS_isDirectory((dirname + &quot;/&quot; + *i).c_str()))
-        {
-          adddir(dirname + &quot;/&quot; + *i);
-        }
-      else
-        {
-          directory.push_back((dirname + &quot;/&quot; + *i).c_str());
-        }
-    }
-  PHYSFS_freeList(dirlist);
-}
-
-Sprite2DView::~Sprite2DView()
-{
-  
-}
-
-void
-Sprite2DView::draw()
-{ 
-  glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-
-  switch(mode)
-    {
-    case SLIDESHOW:
-      if (aspect &gt; 4.0/3.0)
-        {
-          sprite.draw(Vector(-offset, 0));
-        }
-      else
-        {
-          sprite.draw(Vector(0, -offset));
-        }
-
-      if (new_sprite)
-        {
-          new_sprite.draw(Vector(0,0));
-        }
-
-      if (show_thumbnail)
-        {
-          Sprite small = sprite;
-          small.set_alpha(1.0f);
-          float width  = small.get_width();
-          float height = small.get_height();
-          float scale;
-          if (width &gt; height)
-            {
-              scale = 125.0f / width;
-
-              width  *= scale;
-              height *= scale;
-              small.set_scale(scale);
-
-              small.draw(Vector(DISPLAY_W - width,
-                                DISPLAY_H - height));
-            }
-          else
-            {
-              scale = 125.0f / height;
-
-              width  *= scale;
-              height *= scale;
-              small.set_scale(scale);
-
-              small.draw(Vector(DISPLAY_W - width,
-                                DISPLAY_H - height));
-            }
-        }        
-      break;
-      
-    case MANUAL:
-      sprite.set_scale(zoom);
-      sprite.draw(pos);
-      break;
-    }
-}
-
-void
-Sprite2DView::update_slideshow(float delta, const Controller&amp; controller)
-{
-  if (!new_sprite)
-    {
-      width  = sprite.get_width();
-      height = sprite.get_height();
-      aspect = width/height;
-
-      if (aspect &gt; 4.0/3.0)
-        { // expand vertical
-          float scale = DISPLAY_H/height;
-          width  *= scale;
-          height *= scale;
-          sprite.set_scale(scale);
-
-          if (offset - (width - DISPLAY_W) &gt; 0)
-            {
-              offset = (width - DISPLAY_W);
-
-              if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
-                next_image();
-            }
-          else
-            {
-              offset += delta * 50.0f + controller.get_axis_state(X_AXIS) * 200.0f * delta;
-            }
-
-          offset +=  controller.get_ball_state(MOUSE_MOTION_Y);
-        }
-      else
-        { // expand horizontal
-          float scale = 800.0f/width;
-          width  *= scale;
-          height *= scale;
-          sprite.set_scale(scale);
-
-          if (offset - (height - DISPLAY_H) &gt; 0)
-            {
-              offset = (width - DISPLAY_H);
-
-              if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
-                next_image();
-            }
-          else
-            {
-              offset += delta * 50.0f +   controller.get_axis_state(X_AXIS) * 200.0f * delta;
-            }
-
-          offset += controller.get_ball_state(MOUSE_MOTION_Y);
-        }
-    }
-
-  if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      next_image();
-    }
-  else if (controller.button_was_pressed(SECONDARY_BUTTON))
-    {
-      prev_image();
-    }
-}
-
-void
-Sprite2DView::next_image(int i)
-{
-  if (directory.size() &gt; 1)
-    {
-      if (new_sprite)
-        {
-          sprite = new_sprite;
-          sprite.set_alpha(1.0f);
-          new_sprite = Sprite();
-          offset = 0;
-          display_time = 0;
-        }
-
-      index = (unsigned int)(index + i) % directory.size();
-
-      std::vector&lt;std::string&gt; dir;
-
-      if (shuffle)
-        dir = shuffle_directory;
-      else
-        dir = directory;
-      
-      bool retry = false;
-
-      do {
-        try {
-          new_sprite = Sprite(dir[index]);
-          retry = false;
-        } catch(std::exception&amp; e) {
-          // FIXME: won't work in combination with shuffle
-          std::cout &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
-          std::cout &lt;&lt; &quot;Removing '&quot; &lt;&lt; directory[index] &lt;&lt; &quot;' from the list&quot; &lt;&lt; std::endl;
-          directory.erase(directory.begin() + index);
-          index = (unsigned int)(index) % directory.size();
-          retry = true;
-        }
-      } while (retry);
-
-      ignore_delta = true;
-      fadein = 0.0f;
-      prepare_sprite(new_sprite);
-      console &lt;&lt; index &lt;&lt; &quot;: &quot; &lt;&lt; directory[index] &lt;&lt; std::endl;
-    }
-
-  sprite2d_manager-&gt;cleanup();
-  surface_manager-&gt;cleanup();
-}
-
-void
-Sprite2DView::prepare_sprite(Sprite&amp; sprite)
-{
-  float width  = sprite.get_width();
-  float height = sprite.get_height();
-  float aspect = width/height;
-
-  if (aspect &gt; 4.0/3.0)
-    { // expand vertical
-      float scale = DISPLAY_H/height;
-      width  *= scale;
-      height *= scale;
-      sprite.set_scale(scale);
-    }
-  else
-    { // expand horizontal
-      float scale = DISPLAY_W/width;
-      width  *= scale;
-      height *= scale;
-      sprite.set_scale(scale);
-    }  
-}
-
-void
-Sprite2DView::update_manual(float delta, const Controller&amp; controller)
-{
-  pos.x += controller.get_axis_state(X_AXIS) * 100.0f * delta + controller.get_ball_state(MOUSE_MOTION_X);
-  pos.y += controller.get_axis_state(Y_AXIS) * 100.0f * delta + controller.get_ball_state(MOUSE_MOTION_Y);
-  
-  if (controller.get_button_state(PRIMARY_BUTTON))
-    zoom *= 1.0f + 0.3f * delta;
-
-  if (controller.get_button_state(SECONDARY_BUTTON))
-    zoom /= 1.0f + 0.3f * delta;
-
-  sprite.update(delta);
-}
-
-void
-Sprite2DView::update(float delta, const Controller&amp; controller)
-{  
-  if (ignore_delta)
-    {
-      ignore_delta = false;
-      delta = 0.0f;
-    }
-  
-  display_time += delta * 0.5;
-
-  switch(mode) {
-  case SLIDESHOW:
-    update_slideshow(delta, controller);
-    break;
-  case MANUAL:
-    update_manual(delta, controller);
-    break;
-  }
-
-  if (controller.button_was_pressed(PDA_BUTTON))
-    {
-      if (shuffle)
-        {
-          std::vector&lt;std::string&gt;::iterator i = std::find(directory.begin(), directory.end(),
-                                                           shuffle_directory[index]);
-          if (i != directory.end())
-            {
-              index = i - directory.begin() ;
-            }
-        }
-      else
-        {
-          std::vector&lt;std::string&gt;::iterator i = std::find(shuffle_directory.begin(), shuffle_directory.end(),
-                                                           directory[index]);
-          if (i != shuffle_directory.end())
-            {
-              index = i - shuffle_directory.begin();
-            }
-        }
-
-      shuffle = !shuffle;
-
-      std::cout &lt;&lt; shuffle &lt;&lt; &quot; &quot; &lt;&lt; index &lt;&lt; std::endl;
-    }
-
-  //  if (controller.button_was_pressed(INVENTORY_BUTTON))
-  //std::random_shuffle(shuffle_directory.begin(), shuffle_directory.end());
-   
-  if (controller.button_was_pressed(TERTIARY_BUTTON))
-    show_thumbnail = !show_thumbnail;
-
-  if (controller.button_was_pressed(AIM_BUTTON))
-    {
-      if (mode == SLIDESHOW) mode = MANUAL; 
-      else if (mode == MANUAL) mode = SLIDESHOW; 
-    }
-
-  if (new_sprite)
-    {
-      fadein += delta;
-
-      if (fadein &gt; 1.0f)
-        {
-          sprite = new_sprite;
-          sprite.set_alpha(1.0f);
-          new_sprite = Sprite();
-          offset = 0;
-          display_time = 0;
-        }
-      else
-        {
-          new_sprite.set_alpha(fadein);
-        }
-    }
-}
-
-void
-Sprite2DView::set_sprite(const std::string&amp; filename)
-{
-  sprite = Sprite(filename);
-  ignore_delta = true;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/sprite2dview.hpp
===================================================================
--- trunk/windstille/src/sprite2dview.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/sprite2dview.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,88 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SPRITE2DVIEW_HPP
-#define HEADER_WINDSTILLE_SPRITE2DVIEW_HPP
-
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-/**
- * A simple class to view 3d sprites and their different actions,
- * mostly usefull for debugging 
- */
-class Sprite2DView : public Screen
-{
-private:
-  SceneContext sc;
-  std::vector&lt;std::string&gt; directory;
-  std::vector&lt;std::string&gt; shuffle_directory;
-
-  enum Mode { SLIDESHOW, MANUAL } mode;
-  
-  // Manual Mode Variables
-  float  zoom;
-  Vector pos;
-
-  // Slideshow variables
-  float width;
-  float height;
-  float aspect;
-
-  int    index;
-  Sprite sprite;
-  
-  Sprite new_sprite;
-  float fadein;
-
-  float  scale;
-  float  offset;
-
-  float display_time;
-  bool show_thumbnail;
-  bool ignore_delta;
-  bool shuffle;
-
-  bool auto_scroll;
-public:
-  Sprite2DView();
-  ~Sprite2DView();
-  
-  void adddir(const std::string&amp; dir);
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-  void update_slideshow(float delta, const Controller&amp; controller);
-  void update_manual(float delta, const Controller&amp; controller);
-
-  /** move \a i images forward in the directory */
-  void next_image(int i = 1);
-  void prev_image(int i = 1) { next_image(-i); }
-
-  void set_sprite(const std::string&amp; filename);
-  void prepare_sprite(Sprite&amp; sprite);
-private:
-  Sprite2DView (const Sprite2DView&amp;);
-  Sprite2DView&amp; operator= (const Sprite2DView&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/sprite3dview.cpp
===================================================================
--- trunk/windstille/src/sprite3dview.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/sprite3dview.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,162 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;input/controller.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;font/ttf_font.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;sprite3dview.hpp&quot;
-
-Sprite3DView::Sprite3DView()
-{
-  current_action = 0;
-
-  sprite = Sprite3D(&quot;models/characters/jane/jane.wsprite&quot;);
-  actions = sprite.get_actions();
-
-  sprite.set_action(actions[current_action]);
-  
-  rotation = Quaternion::identity();
-
-  scale = 2.0f;
-}
-
-Sprite3DView::~Sprite3DView()
-{
-}
-
-void
-Sprite3DView::set_model(const std::string&amp; filename)
-{
-  sprite  = Sprite3D(filename);
-  actions = sprite.get_actions();
-}
-
-void
-Sprite3DView::draw()
-{
-  sc.reset_modelview();
-  //sc.translate(-config-&gt;screen_width/2, -config-&gt;screen_height/2);
-  //sc.scale(2.0f, 2.0f);
-  
-  sc.color().fill_screen(Color(0.5, 0.0, 0.5));
-
-  sc.push_modelview();
-  sc.translate(Display::get_width()/2, Display::get_height()/2);
-  sc.scale(scale, scale);
-
-  // Rotate
-  sc.mult_modelview(rotation.to_matrix());  
-  sc.translate(0, 64.0f); // FIXME: use object height/2 instead of 64
-  sprite.draw(sc.color(), Vector(0,0), 0); 
-  sc.pop_modelview();
-
-  //Matrix matrix = sc.color().get_modelview();
-  //matrix.translate(-Display::get_width()/2, -Display::get_height()/2, 0);
-  //sprite.draw(sc.color(), matrix, 0.0f);
-
-  sc.light().fill_screen(Color(1.0, 1.0, 1.0));
-  //sc.color().draw(&quot;Hello World&quot;, 100, 100);
-  sc.render();
-  
-  int x = 10;
-  int y =  Fonts::vera12-&gt;get_height() + 5;
-  int line_height = Fonts::vera12-&gt;get_height()+5;
-
-  for(int i = 0; i &lt; int(actions.size()); ++i)
-    {
-      if (i == current_action)
-        Fonts::vera12-&gt;draw(x, y,
-                               actions[i], Color(1.0f, 1.0f, 1.0f));
-      else
-        Fonts::vera12-&gt;draw(x, y,
-                               actions[i], Color(0.7f, 0.7f, 0.7f));
-
-
-      y += line_height;
-      if (y &gt; 580)
-        {
-          x += 200;
-          y =  Fonts::vera12-&gt;get_height() + 5;
-        }
-    }
-}
-
-void
-Sprite3DView::update(float delta, const Controller&amp; controller)
-{
-  sprite.update(delta);
-  //std::cout &lt;&lt; &quot;Delta: &quot; &lt;&lt; delta &lt;&lt; std::endl;
-
-  int last_action = current_action;
-  if (controller.button_was_pressed(MENU_DOWN_BUTTON))
-    {
-      if (current_action == int(actions.size())-1)
-        current_action = 0;
-      else
-        current_action += 1;
-    }
-  else if (controller.button_was_pressed(MENU_UP_BUTTON))
-    {
-      if (current_action == 0)
-        current_action = actions.size()-1;
-      else
-        current_action -= 1;
-    }
-
-  if (controller.get_button_state(PRIMARY_BUTTON))
-    {
-      scale *= 1.0f + 0.3f * delta;
-    }
-  else if (controller.get_button_state(PDA_BUTTON))
-    {
-      scale /= 1.0f + 0.3f * delta;
-    }
-  
-  if (last_action != current_action &amp;&amp; !actions.empty())
-    {
-      sprite.set_action(actions[current_action]);
-    }
-
-  rotation = Quaternion(Vector3(0.0f, 1.0f, 0.0f),
-                        -controller.get_axis_state(X_AXIS) * delta * 4.0f) * rotation;
-  rotation = Quaternion(Vector3(1.0f, 0.0f, 0.0f),
-                        controller.get_axis_state(X2_AXIS) * delta * 4.0f) * rotation;
-  rotation = Quaternion(Vector3(0.0f, 0.0f, 1.0f),
-                        controller.get_axis_state(Y2_AXIS) * delta * 4.0f) * rotation;
-
-  if (controller.get_button_state(VIEW_CENTER_BUTTON))
-    {
-      rotation = Quaternion::identity();
-    }
-
-  if (controller.button_was_pressed(ESCAPE_BUTTON) ||
-      controller.button_was_pressed(CANCEL_BUTTON))
-    screen_manager.pop_screen();
-}
-
-void
-Sprite3DView::handle_event(const SDL_Event&amp; )
-{
-  
-}
-
-/* EOF */

Deleted: trunk/windstille/src/sprite3dview.hpp
===================================================================
--- trunk/windstille/src/sprite3dview.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/sprite3dview.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,59 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SPRITE3DVIEW_HPP
-#define HEADER_WINDSTILLE_SPRITE3DVIEW_HPP
-
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;sprite3d/sprite3d.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-/**
- * A simple class to view 3d sprites and their different actions,
- * mostly usefull for debugging 
- */
-class Sprite3DView : public Screen
-{
-private:
-  SceneContext sc;
-  Sprite3D sprite;
-  std::vector&lt;std::string&gt; actions;
-  int current_action;
-
-  Quaternion rotation;
-  float scale;
-
-public:
-  Sprite3DView();
-  ~Sprite3DView();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-  void set_model(const std::string&amp; filename);
-  
-  void handle_event(const SDL_Event&amp; );
-
-private:
-  Sprite3DView (const Sprite3DView&amp;);
-  Sprite3DView&amp; operator= (const Sprite3DView&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/text_area.cpp
===================================================================
--- trunk/windstille/src/text_area.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/text_area.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,382 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;assert.h&gt;
-
-#include &quot;display/opengl_state.hpp&quot;
-#include &quot;font/ttf_font.hpp&quot;
-#include &quot;text_area.hpp&quot;
-#include &quot;util/baby_xml.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;text_area.hpp&quot;
-
-struct TextAreaCommand 
-{
-  enum Type { WORD, START, END } type;
-  std::string content;
-    
-  TextAreaCommand(Type type_, const std::string&amp; content_)
-    : type(type_),
-      content(content_)
-  {}
-};
-
-class TextAreaImpl
-{
-public:
-  TTFFont* font;
-  Rectf rect;
-  float passed_time;
-
-  int v_space;
-  bool letter_by_letter;
-  bool progress_complete;
-  std::vector&lt;TextAreaCommand&gt; commands;
-  Vector cursor_pos;
-};
-
-TextArea::TextArea(const Rectf&amp; rect, bool letter_by_letter)
-  : impl(new TextAreaImpl)
-{
-  impl-&gt;font = Fonts::vera20;
-  impl-&gt;rect    = rect;
-  // FIXME: freetype might provide info for vspacing, not sure
-  impl-&gt;v_space = 2;
-  impl-&gt;letter_by_letter = letter_by_letter;
-  impl-&gt;progress_complete = false;
-  impl-&gt;passed_time = 0;
-}
-
-TextArea::~TextArea()
-{
-  delete impl;
-}
-
-void
-TextArea::set_rect(const Rectf&amp; rect)
-{
-  impl-&gt;rect = rect;
-}
-
-void
-TextArea::set_text(const std::string&amp; str)
-{
-  impl-&gt;commands.clear();
-
-  BabyXML xml(str);
-
-  for(BabyXML::iterator i = xml.begin(); i != xml.end(); ++i)
-    {
-      if (i-&gt;type == BabyXML::Node::START_TAG)
-        {
-          impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::START, i-&gt;content));
-        }
-      else if (i-&gt;type == BabyXML::Node::END_TAG)
-        {
-          impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::END, i-&gt;content));
-        }
-      else if (i-&gt;type == BabyXML::Node::TEXT)
-        {      
-          // Seperate the given str into words, words are seperated by either
-          // ' ' or '\n', space is threaded as a word of its own
-          // &quot;Hello  World \n&quot; =&gt; (&quot;Hello&quot;, &quot; &quot;, &quot; &quot;, &quot;World&quot;, &quot; &quot;, &quot;\n&quot;)
-          std::string word;
-          for(std::string::const_iterator j = i-&gt;content.begin(); j != i-&gt;content.end(); ++j)
-            {
-              if (*j == ' ' || *j == '\n')
-                {
-                  if (word.empty())
-                    {
-                      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, std::string(1, *j)));
-                    }
-                  else
-                    {
-                      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, word));
-                      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, std::string(1, *j)));
-                      word = &quot;&quot;;
-                    }
-                }
-              else
-                {
-                  word += *j;
-                }
-            }
-          if (!word.empty())
-            impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, word));
-        }
-    }
-}
-
-void
-TextArea::set_font(TTFFont* font)
-{
-  impl-&gt;font = font;
-}
-
-void
-TextArea::set_progress_complete()
-{
-  impl-&gt;letter_by_letter = false;
-}
-
-bool
-TextArea::is_progress_complete()
-{
-  return impl-&gt;progress_complete;
-}
-
-void
-TextArea::draw()
-{
-  assert(impl-&gt;font);
-
-  OpenGLState state;
-  
-  state.bind_texture(impl-&gt;font-&gt;get_texture());
-
-  state.enable(GL_BLEND);
-  state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-  state.activate();
-
-  glPushMatrix();
-  glTranslatef(impl-&gt;rect.left, impl-&gt;rect.top + impl-&gt;font-&gt;get_height(), 0);
-  // Voodoo to get non-blurry fonts
-  float mx = -0.375;
-  float my = -0.375; 
-  glBegin(GL_QUADS);
-
-  int x_pos = 0;
-  int y_pos = 0;
-
-  Color top_color    = Color(1.0f, 1.0f, 1.0f);
-  Color bottom_color = Color(1.0f, 1.0f, 1.0f);
-  bool is_small = false;
-  bool is_large = false;
-  float eat_time = impl-&gt;passed_time;
-  bool sinus = false;
-  bool break_writing = false;
-  std::vector&lt;TextAreaCommand&gt;::const_iterator i = impl-&gt;commands.begin();
-  for(; i != impl-&gt;commands.end(); ++i)
-    {
-      if (break_writing)
-        break;
-        
-      switch (i-&gt;type)
-        {
-        case TextAreaCommand::START:
-          if (i-&gt;content == &quot;b&quot;)
-            {
-              top_color    = Color(1.0f, 0.0f, 0.0f);
-              bottom_color = Color(0.8f, 0.0f, 0.0f);
-            }
-          else if (i-&gt;content == &quot;i&quot;)
-            {
-              top_color    = Color(0.65f, 0.7f, 1.0f);
-              bottom_color = Color(0.65f, 0.7f, 1.0f);
-            }
-          else if (i-&gt;content == &quot;small&quot;)
-            {
-              is_small = true;
-            }
-          else if (i-&gt;content == &quot;large&quot;)
-            {
-              is_large = true;
-            }
-          else if (i-&gt;content == &quot;sleep&quot;)
-            {
-              eat_time -= 1.0f;
-            }
-          else if (i-&gt;content == &quot;sin&quot;)
-            {
-              sinus = true;
-            }
-          break;
-
-        case TextAreaCommand::END:
-          if (i-&gt;content == &quot;b&quot; || i-&gt;content == &quot;i&quot;)
-            {
-              top_color    = Color(1.0f, 1.0f, 1.0f);
-              bottom_color = Color(1.0f, 1.0f, 1.0f);
-            }
-          else if (i-&gt;content == &quot;small&quot;)
-            {
-              is_small = false;
-            }
-          else if (i-&gt;content == &quot;large&quot;)
-            {
-              is_large = false;
-            }
-          else if (i-&gt;content == &quot;sin&quot;)
-            {
-              sinus = false;
-            }
-          break;
-          
-        case TextAreaCommand::WORD:
-        retry:
-          int word_width;
-
-          if (is_small)
-            word_width = static_cast&lt;int&gt;(impl-&gt;font-&gt;get_width(i-&gt;content) * 0.6f);
-          else if (is_large)
-            word_width = static_cast&lt;int&gt;(impl-&gt;font-&gt;get_width(i-&gt;content) * 2.0f);
-          else
-            word_width = impl-&gt;font-&gt;get_width(i-&gt;content);
-          
-          if (i-&gt;content == &quot;\n&quot;)
-            {
-              x_pos = 0;
-              y_pos += impl-&gt;font-&gt;get_height() + impl-&gt;v_space;
-            }
-          else if (x_pos + word_width &gt; impl-&gt;rect.get_width() &amp;&amp; word_width &lt;= impl-&gt;rect.get_width())
-            {
-              x_pos = 0;
-              y_pos += impl-&gt;font-&gt;get_height() + impl-&gt;v_space;
-              goto retry;
-            }
-          else
-            {
-              if (x_pos == 0 &amp;&amp; i-&gt;content == &quot; &quot;)
-                {
-                  // ignore space at the beginning of a line
-                }
-              else
-                {
-                  for(std::string::const_iterator j = i-&gt;content.begin(); j != i-&gt;content.end(); ++j)
-                    {
-                      if (impl-&gt;letter_by_letter &amp;&amp; eat_time &lt;= 0)
-                        {
-                          break_writing = true;
-                          break;
-                        }
-                        
-                      int x = x_pos;
-                      int y = y_pos;
-
-                      if (sinus) // FIXME: this could actually work per vertex
-                        y += static_cast&lt;int&gt;(sin(impl-&gt;passed_time * 10.0f + x_pos / 15.0f) * 5.0f);
-
-                      if (*j == '.' || *j == '\n')
-                        eat_time -= 0.50f;
-                      else
-                        eat_time -= 0.05f;
-
-                      const TTFCharacter&amp; character = impl-&gt;font-&gt;get_character(*j);
-                      
-                      if (is_small)
-                        {
-                          float scale = 0.6f;
-                          glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
-                          glTexCoord2f(character.uv.left, character.uv.top);
-                          glVertex2f(x + scale * character.pos.left + mx,
-                                     y + scale * (character.pos.top  + my));
-
-                          glTexCoord2f(character.uv.right, character.uv.top);
-                          glVertex2f(x + scale * character.pos.right + mx, 
-                                     y + scale * (character.pos.top) + my);
-
-                          glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
-                          glTexCoord2f(character.uv.right, character.uv.bottom);
-                          glVertex2f(x + scale * character.pos.right  + mx, 
-                                     y + scale * (character.pos.bottom) + my);
-
-                          glTexCoord2f(character.uv.left, character.uv.bottom);
-                          glVertex2f(x + scale * character.pos.left   + mx, 
-                                     y + scale * (character.pos.bottom) + my);
-                          x_pos += static_cast&lt;int&gt;(scale * character.advance);
-                        }
-                      else if (is_large)
-                        {
-                          float scale = 2.0f;
-                          glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
-                          glTexCoord2f(character.uv.left, character.uv.top);
-                          glVertex2f(x + scale * character.pos.left + mx,
-                                     y + (character.pos.top  + my));
-
-                          glTexCoord2f(character.uv.right, character.uv.top);
-                          glVertex2f(x + scale * character.pos.right + mx, 
-                                     y + (character.pos.top) + my);
-
-                          glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
-                          glTexCoord2f(character.uv.right, character.uv.bottom);
-                          glVertex2f(x + scale * character.pos.right  + mx, 
-                                     y + (character.pos.bottom) + my);
-
-                          glTexCoord2f(character.uv.left, character.uv.bottom);
-                          glVertex2f(x + scale * character.pos.left   + mx, 
-                                     y + (character.pos.bottom) + my);
-                          x_pos += static_cast&lt;int&gt;(scale * character.advance);
-                        }
-                      else   
-                        {
-                          glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
-                          glTexCoord2f(character.uv.left, character.uv.top);
-                          glVertex2f(x + character.pos.left + mx,
-                                     y + character.pos.top  + my);
-
-                          glTexCoord2f(character.uv.right, character.uv.top);
-                          glVertex2f(x + character.pos.right + mx, 
-                                     y + character.pos.top   + my);
-
-                          glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
-                          glTexCoord2f(character.uv.right, character.uv.bottom);
-                          glVertex2f(x + character.pos.right  + mx, 
-                                     y + character.pos.bottom + my);
-
-                          glTexCoord2f(character.uv.left, character.uv.bottom);
-                          glVertex2f(x + character.pos.left   + mx, 
-                                     y + character.pos.bottom + my);
-                          x_pos += character.advance;
-                        }
-                    }
-                }
-            }
-          break;
-        }
-    }
-
-  // FIXME: This is not correct, since the last command itself might
-  // not be completly excecuted
-  if (i == impl-&gt;commands.end())
-    impl-&gt;progress_complete = true;
-    
-  glEnd();
-  glPopMatrix();
-
-  impl-&gt;cursor_pos = Vector(x_pos + impl-&gt;rect.left, y_pos + impl-&gt;rect.top);
-}
-
-void
-TextArea::update(float delta)
-{
-  impl-&gt;passed_time += delta;
-}
-
-Rectf
-TextArea::get_rect() const
-{
-  return impl-&gt;rect;
-}
-
-Vector
-TextArea::get_cursor_pos() const
-{
-  return impl-&gt;cursor_pos;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/text_area.hpp
===================================================================
--- trunk/windstille/src/text_area.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/text_area.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,68 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TEXT_AREA_HPP
-#define HEADER_WINDSTILLE_TEXT_AREA_HPP
-
-#include &quot;math/rect.hpp&quot;
-#include &lt;string&gt;
-
-class TTFFont;
-class TextAreaImpl;
-
-/** A class for managing multiple lines of text in combination with
-    special formating.
-*/
-class TextArea
-{
-public:
-  /** The area which the TextArea should cover */
-  TextArea(const Rectf&amp; rect, bool letter_by_letter);
-  ~TextArea();
-
-  /** Set the rectangle into which the TextArea should fill its text */
-  void set_rect(const Rectf&amp; rect);
-
-  /** Sets the text to be displayed in the text box */
-  void set_text(const std::string&amp; str);
-
-  /** Sets the default font to be used in the text box, can be changed
-      with special tags */
-  void set_font(TTFFont* font);
-
-  /** Skips letter by letter display */  
-  void set_progress_complete();
-  
-  bool is_progress_complete();
-
-  void update(float delta);
-  void draw();
-
-  /** Return the rectangle that TextArea fills its text into */
-  Rectf get_rect() const;
-
-  /** Return the position of the last character in the TextArea,
-      usefull to display a blinking cursor or things like that */
-  Vector get_cursor_pos() const;
-private:
-  TextAreaImpl* impl;
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/tile/tile_packer.cpp
===================================================================
--- trunk/windstille/src/tile/tile_packer.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/tile/tile_packer.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -23,7 +23,7 @@
 #include &quot;globals.hpp&quot;
 #include &quot;tile_packer.hpp&quot;
 #include &quot;util/util.hpp&quot;
-#include &quot;blitter.hpp&quot;
+#include &quot;display/blitter.hpp&quot;
 
 class TilePackerImpl
 {

Deleted: trunk/windstille/src/title_screen.cpp
===================================================================
--- trunk/windstille/src/title_screen.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/title_screen.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,56 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;menu_manager.hpp&quot;
-#include &quot;title_screen.hpp&quot;
-
-TitleScreen::TitleScreen()
-{
-  background = Sprite(&quot;images/titlescreen.sprite&quot;);
-}
-
-TitleScreen::~TitleScreen()
-{
-}
-
-void
-TitleScreen::on_startup()
-{
-  menu_manager.display_main_menu();
-}
-
-void
-TitleScreen::draw()
-{
-  background.draw(Vector(0, 0));
-}
-
-void
-TitleScreen::update(float delta, const Controller&amp; controller)
-{
-  background.update(delta);
-}
-
-void
-TitleScreen::handle_event(const SDL_Event&amp; )
-{
-  
-}
-
-/* EOF */

Deleted: trunk/windstille/src/title_screen.hpp
===================================================================
--- trunk/windstille/src/title_screen.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/title_screen.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -1,49 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TITLE_SCREEN_HPP
-#define HEADER_WINDSTILLE_TITLE_SCREEN_HPP
-
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;screen.hpp&quot;
-
-/** */
-class TitleScreen : public Screen
-{
-private:
-  Sprite background;
-
-public:
-  TitleScreen();
-  ~TitleScreen();
-
-  void on_startup();
-
-  void draw();
-  void update(float delta, const Controller&amp; controller);
-
-  void handle_event(const SDL_Event&amp; );
-
-private:
-  TitleScreen (const TitleScreen&amp;);
-  TitleScreen&amp; operator= (const TitleScreen&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/view.hpp
===================================================================
--- trunk/windstille/src/view.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/view.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_VIEW_HPP
 #define HEADER_WINDSTILLE_VIEW_HPP
 
-#include &quot;graphic_context_state.hpp&quot;
+#include &quot;display/graphic_context_state.hpp&quot;
 #include &quot;engine/camera.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 

Modified: trunk/windstille/src/windstille_main.cpp
===================================================================
--- trunk/windstille/src/windstille_main.cpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/windstille_main.cpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -22,11 +22,11 @@
 #include &lt;physfs.h&gt;
 
 #include &quot;globals.hpp&quot;
-#include &quot;screen.hpp&quot;
+#include &quot;screen/screen.hpp&quot;
 #include &quot;windstille_main.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;game_session.hpp&quot;
-#include &quot;title_screen.hpp&quot;
+#include &quot;screen/game_session.hpp&quot;
+#include &quot;screen/title_screen.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;
@@ -39,10 +39,10 @@
 #include &quot;display/surface_manager.hpp&quot;
 #include &quot;display/texture_manager.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
-#include &quot;screen_manager.hpp&quot;
-#include &quot;sprite3dview.hpp&quot;
-#include &quot;sprite2dview.hpp&quot;
-#include &quot;particle_viewer.hpp&quot;
+#include &quot;screen/screen_manager.hpp&quot;
+#include &quot;screen/sprite3dview.hpp&quot;
+#include &quot;screen/sprite2dview.hpp&quot;
+#include &quot;screen/particle_viewer.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 
 #ifdef WIN32

Modified: trunk/windstille/src/windstille_main.hpp
===================================================================
--- trunk/windstille/src/windstille_main.hpp	2009-02-11 22:04:00 UTC (rev 2467)
+++ trunk/windstille/src/windstille_main.hpp	2009-02-12 08:17:19 UTC (rev 2468)
@@ -47,7 +47,7 @@
 #ifndef HEADER_WINDSTILLE_WINDSTILLE_MAIN_HPP
 #define HEADER_WINDSTILLE_WINDSTILLE_MAIN_HPP
 
-#include &quot;screen.hpp&quot;
+#include &quot;screen/screen.hpp&quot;
 
 struct SDL_Surface;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001464.html">[Windstille-commit] r2467 - trunk/windstille/data/scripts
</A></li>
	<LI>Next message: <A HREF="001466.html">[Windstille-commit] r2469 - in trunk/windstille/src: . engine	screen sprite3d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1465">[ date ]</a>
              <a href="thread.html#1465">[ thread ]</a>
              <a href="subject.html#1465">[ subject ]</a>
              <a href="author.html#1465">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
