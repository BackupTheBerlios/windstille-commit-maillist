<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r2463 - in trunk/windstille/src: . collision	gui objects tile
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2463%20-%20in%20trunk/windstille/src%3A%20.%20collision%0A%09gui%20objects%20tile&In-Reply-To=%3C200902112105.n1BL583b027132%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001459.html">
   <LINK REL="Next"  HREF="001461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r2463 - in trunk/windstille/src: . collision	gui objects tile</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2463%20-%20in%20trunk/windstille/src%3A%20.%20collision%0A%09gui%20objects%20tile&In-Reply-To=%3C200902112105.n1BL583b027132%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r2463 - in trunk/windstille/src: . collision	gui objects tile">grumbel at mail.berlios.de
       </A><BR>
    <I>Wed Feb 11 22:05:08 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001459.html">[Windstille-commit] r2462 - trunk/windstille/src
</A></li>
        <LI>Next message: <A HREF="001461.html">[Windstille-commit] r2464 - in trunk/windstille/src: . engine gui	objects particles scripting sprite3d tile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1460">[ date ]</a>
              <a href="thread.html#1460">[ thread ]</a>
              <a href="subject.html#1460">[ subject ]</a>
              <a href="author.html#1460">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-02-11 22:05:03 +0100 (Wed, 11 Feb 2009)
New Revision: 2463

Added:
   trunk/windstille/src/tile/
   trunk/windstille/src/tile/tile.cpp
   trunk/windstille/src/tile/tile.hpp
   trunk/windstille/src/tile/tile_description.cpp
   trunk/windstille/src/tile/tile_description.hpp
   trunk/windstille/src/tile/tile_factory.cpp
   trunk/windstille/src/tile/tile_factory.hpp
   trunk/windstille/src/tile/tile_map.cpp
   trunk/windstille/src/tile/tile_map.hpp
   trunk/windstille/src/tile/tile_packer.cpp
   trunk/windstille/src/tile/tile_packer.hpp
Removed:
   trunk/windstille/src/tile.cpp
   trunk/windstille/src/tile.hpp
   trunk/windstille/src/tile_description.cpp
   trunk/windstille/src/tile_description.hpp
   trunk/windstille/src/tile_factory.cpp
   trunk/windstille/src/tile_factory.hpp
   trunk/windstille/src/tile_map.cpp
   trunk/windstille/src/tile_map.hpp
   trunk/windstille/src/tile_packer.cpp
   trunk/windstille/src/tile_packer.hpp
Modified:
   trunk/windstille/src/SConscript
   trunk/windstille/src/collision/collision_engine.cpp
   trunk/windstille/src/collision/stair_contact.cpp
   trunk/windstille/src/entity.cpp
   trunk/windstille/src/game_session.cpp
   trunk/windstille/src/gui/automap.cpp
   trunk/windstille/src/laser_pointer.cpp
   trunk/windstille/src/objects/box.cpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/sector.cpp
   trunk/windstille/src/windstille_main.cpp
Log:
Moved tile related stuff to tile/

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/SConscript	2009-02-11 21:05:03 UTC (rev 2463)
@@ -182,11 +182,11 @@
 'sprite3d/sprite3d.cpp',
 'sprite3dview.cpp',
 'text_area.cpp',
-'tile.cpp',
-'tile_description.cpp',
-'tile_factory.cpp',
-'tile_map.cpp',
-'tile_packer.cpp',
+'tile/tile.cpp',
+'tile/tile_description.cpp',
+'tile/tile_factory.cpp',
+'tile/tile_map.cpp',
+'tile/tile_packer.cpp',
 'timer.cpp',
 'title_screen.cpp',
 'trigger.cpp',

Modified: trunk/windstille/src/collision/collision_engine.cpp
===================================================================
--- trunk/windstille/src/collision/collision_engine.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/collision/collision_engine.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -20,7 +20,7 @@
 #include &quot;collision_test.hpp&quot;
 #include &quot;collision_engine.hpp&quot;
 #include &quot;globals.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 
 std::vector&lt;Rectf&gt; tilemap_collision_list(TileMap *tilemap, const Rectf &amp;r, bool is_ground);
 

Modified: trunk/windstille/src/collision/stair_contact.cpp
===================================================================
--- trunk/windstille/src/collision/stair_contact.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/collision/stair_contact.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -17,8 +17,8 @@
 */
 
 #include &lt;iostream&gt;
-#include &quot;tile.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;stair_contact.hpp&quot;
 
 StairContact::StairContact(TileMap* tilemap_, const Point&amp; pos_)

Modified: trunk/windstille/src/entity.cpp
===================================================================
--- trunk/windstille/src/entity.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/entity.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -20,7 +20,7 @@
 #include &quot;globals.hpp&quot;
 #include &quot;entity.hpp&quot;
 #include &quot;sector.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 
 Entity::Entity()
   : velocity(0, 0),

Modified: trunk/windstille/src/game_session.cpp
===================================================================
--- trunk/windstille/src/game_session.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/game_session.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -30,7 +30,7 @@
 #include &quot;console.hpp&quot;
 #include &quot;game_object.hpp&quot;
 #include &quot;objects/player.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
 #include &quot;view.hpp&quot;
 #include &quot;timer.hpp&quot;

Modified: trunk/windstille/src/gui/automap.cpp
===================================================================
--- trunk/windstille/src/gui/automap.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/gui/automap.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -19,7 +19,7 @@
 #include &quot;display/surface_drawing_parameters.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;sector.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;automap.hpp&quot;
 

Modified: trunk/windstille/src/laser_pointer.cpp
===================================================================
--- trunk/windstille/src/laser_pointer.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/laser_pointer.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -21,7 +21,7 @@
 #include &quot;objects/player.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;sector.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;laser_pointer.hpp&quot;
 
 LaserPointer::LaserPointer()

Modified: trunk/windstille/src/objects/box.cpp
===================================================================
--- trunk/windstille/src/objects/box.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/objects/box.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -22,7 +22,7 @@
 #include &quot;globals.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;math/vector.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;random.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 

Modified: trunk/windstille/src/objects/player.cpp
===================================================================
--- trunk/windstille/src/objects/player.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/objects/player.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -17,7 +17,7 @@
 */
 
 #include &lt;boost/bind.hpp&gt;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
@@ -26,7 +26,7 @@
 #include &quot;objects/bomb.hpp&quot;
 #include &quot;globals.hpp&quot;
 #include &quot;pda.hpp&quot;
-#include &quot;tile.hpp&quot;
+#include &quot;tile/tile.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
 #include &quot;particles/particle_system.hpp&quot;

Modified: trunk/windstille/src/sector.cpp
===================================================================
--- trunk/windstille/src/sector.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/sector.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -23,7 +23,7 @@
 #include &quot;globals.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;objects/background_gradient.hpp&quot;
-#include &quot;tile_map.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
 #include &quot;game_object.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 #include &quot;trigger.hpp&quot;

Copied: trunk/windstille/src/tile/tile.cpp (from rev 2461, trunk/windstille/src/tile.cpp)


Property changes on: trunk/windstille/src/tile/tile.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile.hpp (from rev 2461, trunk/windstille/src/tile.hpp)


Property changes on: trunk/windstille/src/tile/tile.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile_description.cpp (from rev 2461, trunk/windstille/src/tile_description.cpp)


Property changes on: trunk/windstille/src/tile/tile_description.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/tile/tile_description.hpp (from rev 2461, trunk/windstille/src/tile_description.hpp)


Property changes on: trunk/windstille/src/tile/tile_description.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/tile/tile_factory.cpp (from rev 2461, trunk/windstille/src/tile_factory.cpp)


Property changes on: trunk/windstille/src/tile/tile_factory.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile_factory.hpp (from rev 2461, trunk/windstille/src/tile_factory.hpp)


Property changes on: trunk/windstille/src/tile/tile_factory.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile_map.cpp (from rev 2461, trunk/windstille/src/tile_map.cpp)


Property changes on: trunk/windstille/src/tile/tile_map.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile_map.hpp (from rev 2461, trunk/windstille/src/tile_map.hpp)


Property changes on: trunk/windstille/src/tile/tile_map.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile_packer.cpp (from rev 2461, trunk/windstille/src/tile_packer.cpp)


Property changes on: trunk/windstille/src/tile/tile_packer.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/tile/tile_packer.hpp (from rev 2461, trunk/windstille/src/tile_packer.hpp)


Property changes on: trunk/windstille/src/tile/tile_packer.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: trunk/windstille/src/tile.cpp
===================================================================
--- trunk/windstille/src/tile.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,30 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;tile.hpp&quot;
-
-Tile::Tile(unsigned int arg_colmap)
-  : colmap(arg_colmap)
-{
-  packer = -1;
-  desc = 0;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/tile.hpp
===================================================================
--- trunk/windstille/src/tile.hpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile.hpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,69 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TILE_HPP
-#define HEADER_WINDSTILLE_TILE_HPP
-
-#include &lt;assert.h&gt;
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &quot;display/texture.hpp&quot;
-#include &quot;math/rect.hpp&quot;
-
-enum TileType {
-  TILE_EMPTY  = 0,
-  TILE_SOLID  = (1 &lt;&lt; 0),
-  TILE_STAIRS = (1 &lt;&lt; 1),
-  TILE_LEFT   = (1 &lt;&lt; 2),
-  TILE_RIGHT  = (1 &lt;&lt; 3)
-};
-
-class TileDescription;
-
-/** A Tile is a surface or sprite together with information for
- *  collision detection (aka colmap). The collision map is at a
- *  resolution of 8x8 bits. Position information is handled in the
- *  TileMap and not here. (flyweight pattern). */
-class Tile
-{
-public:
-  /** The id of the Tile by which the tilemap refers to it */
-  int id; 
-
-  // FIXME: Using a surface here might be a worthy consideration, just
-  // need to find a way to properly bucket-sort the request
-
-  /**
-   * Id of the packer
-   */
-  int     packer;
-  Rectf   uv;
-  Texture texture;
-
-  /** bitmap that holds the collision attributes for this tile */
-  unsigned int colmap;
-  TileDescription* desc;
-
-  Tile(unsigned int arg_colmap);
-
-  unsigned get_colmap() const { return colmap; }
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/tile_description.cpp
===================================================================
--- trunk/windstille/src/tile_description.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_description.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,104 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-#include &lt;stdexcept&gt;
-#include &lt;SDL.h&gt;
-#include &lt;SDL_image.h&gt;
-#include &quot;physfs/physfs_sdl.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;tile.hpp&quot;
-#include &quot;tile_packer.hpp&quot;
-#include &quot;tile_factory.hpp&quot;
-#include &quot;tile_description.hpp&quot;
-
-TileDescription::TileDescription(FileReader&amp; props)
-  : width(0), height(0)
-{
-  props.get(&quot;ids&quot;,    ids);
-  props.get(&quot;image&quot;,  filename);
-  props.get(&quot;colmap&quot;, colmap);
-  props.get(&quot;width&quot;,  width);
-  props.get(&quot;height&quot;, height);
-    
-  props.print_unused_warnings(&quot;tiles&quot;);
-
-  if(filename == &quot;&quot;)
-    throw std::runtime_error(&quot;Missing color-image&quot;);
-}
-
-void
-TileDescription::load(TileFactory* factory)
-{  
-  if (debug)
-    std::cout &lt;&lt; &quot;Loading tiles: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-
-  SDL_Surface* image = IMG_Load_RW(get_physfs_SDLRWops(filename), 1);
-  if(!image) 
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Couldn't load image '&quot; &lt;&lt; filename &lt;&lt; &quot;': &quot; &lt;&lt; SDL_GetError();
-      throw std::runtime_error(msg.str());
-    }
-  else
-    {
-      try 
-        {
-          int num_tiles = width * height; //(image-&gt;w/TILE_RESOLUTION) * (image-&gt;h/TILE_RESOLUTION);
-          if (int(colmap.size()) != num_tiles)
-            {
-              std::ostringstream str;
-              str &lt;&lt; &quot;'colmap' information and num_tiles mismatch (&quot; 
-                  &lt;&lt; colmap.size() &lt;&lt; &quot; != &quot; &lt;&lt; num_tiles &lt;&lt; &quot;) for image '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot;;
-              throw std::runtime_error(str.str());
-            }
-
-          if (int(ids.size()) != num_tiles)
-            {
-              std::ostringstream str;
-              str &lt;&lt; &quot;'ids' information and num_tiles mismatch (&quot; 
-                  &lt;&lt; ids.size() &lt;&lt; &quot; != &quot; &lt;&lt; num_tiles &lt;&lt; &quot;) for image '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot;;
-              throw std::runtime_error(str.str());
-            }
-    
-          int i = 0;
-          for (int y = 0; y &lt; height*TILE_RESOLUTION; y += TILE_RESOLUTION)
-            {
-              for (int x = 0; x &lt; width*TILE_RESOLUTION; x += TILE_RESOLUTION)
-                {
-                  if(ids[i] != -1)
-                    {
-                      factory-&gt;pack(ids[i], colmap[i], image,
-                                    Rect(x, y, x+TILE_RESOLUTION, y+TILE_RESOLUTION));
-                    }
-
-                  i += 1; 
-                }
-            }
-        } 
-      catch(...) 
-        {
-          SDL_FreeSurface(image);
-          throw;
-        }
-      SDL_FreeSurface(image);
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/tile_description.hpp
===================================================================
--- trunk/windstille/src/tile_description.hpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_description.hpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,50 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TILE_DESCRIPTION_HPP
-#define HEADER_WINDSTILLE_TILE_DESCRIPTION_HPP
-
-#include &lt;vector&gt;
-#include &lt;string&gt;
-#include &quot;file_reader.hpp&quot;
-
-class TileFactory;
-
-/**
- * The TileDescription descriptes a set of tiles
- */
-class TileDescription
-{
-public:
-  std::vector&lt;int&gt; ids;
-  std::vector&lt;int&gt; colmap;
-  std::string filename;
-  int width;
-  int height;
-
-  TileDescription(FileReader&amp; props);
-
-  /**
-   * Load the TileDescription into the give TileFactory
-   */
-  void load(TileFactory* factory);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/tile_factory.cpp
===================================================================
--- trunk/windstille/src/tile_factory.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_factory.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,198 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;string&gt;
-#include &lt;sstream&gt;
-#include &lt;SDL.h&gt;
-#include &lt;SDL_image.h&gt;
-#include &lt;assert.h&gt;
-#include &lt;sstream&gt;
-#include &lt;iostream&gt;
-#include &lt;memory&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;tile.hpp&quot;
-#include &quot;tile_packer.hpp&quot;
-#include &quot;tile_factory.hpp&quot;
-#include &quot;tile_description.hpp&quot;
-#include &quot;sexpr_file_reader.hpp&quot;
-#include &quot;display/surface_manager.hpp&quot;
-#include &quot;display/texture.hpp&quot;
-#include &quot;physfs/physfs_sdl.hpp&quot;
-
-TileFactory* TileFactory::current_ = 0;
-
-std::string TileFactory::tile_def_file = &quot;tiles.scm&quot;;
-
-/** Check if the given region of the given image is fully transparent */
-bool surface_empty(SDL_Surface* image, int sx, int sy, int w, int h)
-{
-  SDL_LockSurface(image);
-  
-  unsigned char* data = static_cast&lt;unsigned char*&gt;(image-&gt;pixels);
-  
-  for(int y = sy; y &lt; sy + h; ++y)
-    for(int x = sx; x &lt; sx + w; ++x)
-      {
-        if (data[y * image-&gt;pitch + 4*x + 3] != 0)
-          { 
-            SDL_UnlockSurface(image);
-            return false;
-          }
-      }
-
-  SDL_UnlockSurface(image);
-  return true;
-}
-
-TileFactory::TileFactory (const std::string&amp; filename)
-{
-  packers.push_back(new TilePacker(1024, 1024));
-  packers.push_back(new TilePacker(1024, 1024));
-  color_packer     = 0;
-
-  FileReader reader = FileReader::parse(filename);
-  if(reader.get_name() != &quot;windstille-tiles&quot;)
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille tiles file&quot;;
-      throw std::runtime_error(msg.str());
-    }
-  
-  std::vector&lt;FileReader&gt; sections = reader.get_sections();
-  for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
-    {
-      if (i-&gt;get_name() == &quot;tiles&quot;) {
-        parse_tiles(*i);
-      } else if (i-&gt;get_name() == &quot;tilegroup&quot;) {
-        // ignore
-      }
-    }
-  reader.print_unused_warnings(&quot;TileFactory&quot;);
-}
-
-TileFactory::~TileFactory()
-{
-  for(Tiles::iterator i = tiles.begin(); i != tiles.end(); ++i)
-    {
-      delete *i;
-    }
-  tiles.clear();
-
-  for(std::vector&lt;TileDescription*&gt;::iterator i = descriptions.begin(); i != descriptions.end(); ++i)
-    {
-      delete *i;
-    }
-}
-
-void
-TileFactory::parse_tiles(FileReader&amp; reader)
-{
-  descriptions.push_back(new TileDescription(reader));
-
-  TileDescription&amp; desc = *descriptions.back();
-  
-  if (0)
-    { // Load all on startup
-      desc.load(this);
-    }
-  else
-    { // Load on demand
-      for(std::vector&lt;int&gt;::size_type i = 0; i &lt; desc.ids.size(); ++i)
-        { 
-          int&amp; id = desc.ids[i];
-          if (id != 0)
-            {
-              if (id &gt;= int(tiles.size()))
-                tiles.resize(id + 1, 0);
-    
-              delete tiles[id];
-              tiles[id] = new Tile(desc.colmap[i]);
-              tiles[id]-&gt;desc = &desc;
-            }
-        }
-    }
-}
-
-void
-TileFactory::pack(int id, int colmap, SDL_Surface* image, const Rect&amp; rect)
-{
-  if(id &lt; int(tiles.size())
-     &amp;&amp; tiles[id] != 0
-     &amp;&amp; tiles[id]-&gt;desc == 0)
-    {
-      std::cout &lt;&lt; &quot;Warning: Duplicate tile id '&quot; &lt;&lt; id &lt;&lt; &quot;' ignoring&quot; &lt;&lt; std::endl;
-    }
-  else
-    {      
-      if (id &gt;= int(tiles.size()))
-        tiles.resize(id + 1, 0);
-
-      delete tiles[id];
-      tiles[id]  = new Tile(colmap);
-      tiles[id]-&gt;desc  = 0;
-      tiles[id]-&gt;id    = id;
-
-      if (!surface_empty(image, rect.left, rect.top, rect.get_width(), rect.get_height()))
-        {
-          if(packers[color_packer]-&gt;is_full())
-            {
-              packers.push_back(new TilePacker(1024, 1024));
-              color_packer = packers.size() - 1;
-            }
-          
-          Rectf uv = packers[color_packer]-&gt;pack(image, 
-                                                 rect.left, rect.top,
-                                                 rect.get_width(), rect.get_height());
-          tiles[id]-&gt;uv      = uv;
-          tiles[id]-&gt;packer  = color_packer;
-          tiles[id]-&gt;texture = packers[color_packer]-&gt;get_texture();
-        }
-    }
-}
-
-Tile*
-TileFactory::create(int id)
-{
-  if(id &lt; 0 || id &gt;= (int) tiles.size())
-    {
-      return 0;
-    }
-  else
-    {
-      if (tiles[id] &amp;&amp; tiles[id]-&gt;desc)
-        tiles[id]-&gt;desc-&gt;load(this);
-
-      return tiles[id];
-    }
-}
-
-void
-TileFactory::init()
-{
-  assert(current_ == 0);
-  current_ = new TileFactory(tile_def_file);
-}
-
-/** Destroy the default TileFactor */
-void
-TileFactory::deinit()
-{
-  delete current_;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/tile_factory.hpp
===================================================================
--- trunk/windstille/src/tile_factory.hpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_factory.hpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,83 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TILE_FACTORY_HPP
-#define HEADER_WINDSTILLE_TILE_FACTORY_HPP
-
-#include &lt;map&gt;
-#include &lt;string&gt;
-#include &quot;tile_description.hpp&quot;
-
-class Tile;
-class TilePacker;
-
-/** */
-class TileFactory
-{
-private:
-  typedef std::vector&lt;Tile*&gt; Tiles;
-  Tiles tiles;
-  typedef std::vector&lt;TilePacker*&gt; TilePackers;
-  TilePackers packers;
-  int color_packer;
-
-  static TileFactory* current_;
-
-  friend class TileDescription;
-
-  std::vector&lt;TileDescription*&gt; descriptions;
-  
-public:
-  static std::string tile_def_file;
-
-  typedef Tiles::iterator iterator;
-  
-  iterator begin() { return tiles.begin(); }
-  iterator end()   { return tiles.end(); }
-
-  /** Create a TileFactory from a given tile definition file */
-  TileFactory(const std::string&amp; filename);
-  ~TileFactory();
-
-  /**
-   * Create a new tile, or loads&amp;create it if it is not already
-   * available
-   */
-  Tile* create(int tile_id);
-
-  /** 
-   * Adds a surface to the TileFactory
-   */
-  void pack(int id, int colmap, SDL_Surface* image, const Rect&amp; rect);
-
-  /** Create the default TileFactor*/
-  static void init();
-
-  /** Destroy the default TileFactor*/
-  static void deinit();
-
-  /** Access the default TileFactor*/
-  static TileFactory* current() { return current_; }
-
-private:
-  void parse_tiles(FileReader&amp; reader);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/tile_map.cpp
===================================================================
--- trunk/windstille/src/tile_map.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_map.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,274 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;sstream&gt;
-#include &lt;stdexcept&gt;
-#include &lt;physfs.h&gt;
-#include &quot;tile_map.hpp&quot;
-#include &quot;tile.hpp&quot;
-#include &quot;tile_factory.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;view.hpp&quot;
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &lt;inttypes.h&gt;
-
-TileMap::TileMap(FileReader&amp; props)
-{
-  int width = -1;
-  int height = -1;
-  z_pos = 0;
-  total_time = 0;
-  
-  props.get(&quot;name&quot;, name);
-  props.get(&quot;z-pos&quot;, z_pos);
-  props.get(&quot;width&quot;, width);
-  props.get(&quot;height&quot;, height);
-  if(width &lt;= 0 || height &lt;= 0) {
-    throw std::runtime_error(
-                             &quot;Invalid width or height defined or &quot;
-                             &quot;data defined before width and height&quot;);  
-  }
- 
-  if(width &lt;= 0 || height &lt;= 0) {
-    throw std::runtime_error(
-                             &quot;Invalid width or height defined or &quot;
-                             &quot;data defined before width and height&quot;);
-  }
-
-  std::string data_filename;
-  if (props.get(&quot;data-file&quot;, data_filename))
-    {
-      PHYSFS_file* file = PHYSFS_openRead(data_filename.c_str());
-      if (!file)
-        {
-          throw std::runtime_error(&quot;Couldn't open tiledata file: &quot; + data_filename);
-        }
-      
-      field = Field&lt;Tile*&gt;(width, height);
-
-      for(int y = 0; y &lt; height; ++y)
-        for(int x = 0; x &lt; width; ++x)
-          {
-            uint16_t result;
-            if(PHYSFS_readULE16(file, &amp;result) == 0) {
-              std::ostringstream msg;
-              msg &lt;&lt; &quot;Problem reading uint16 value: &quot; &lt;&lt; PHYSFS_getLastError();
-              throw std::runtime_error(msg.str());
-            }
-
-            field(x, y) = TileFactory::current()-&gt;create(result);
-          }
-
-      PHYSFS_close(file);
-    }
-  else // read data directly from the levelfile
-    {
-      Field&lt;int&gt; tmpfield(width, height);
-
-      props.get(&quot;data&quot;, tmpfield.get_vector());
-  
-      field = Field&lt;Tile*&gt;(width, height);
-      for (int y = 0; y &lt; field.get_height (); ++y) 
-        {
-          for (int x = 0; x &lt; field.get_width (); ++x)
-            {
-              field(x, y) = TileFactory::current()-&gt;create(tmpfield(x, y));
-            }
-        }
-    }
-
-  props.print_unused_warnings(&quot;tilemap&quot;);
-
-
-  if(field.size() == 0)
-    throw std::runtime_error(&quot;No tiles defined in tilemap&quot;);  
-}
-
-TileMap::~TileMap()
-{
-}
-
-void 
-TileMap::update (float delta)
-{
-  total_time += delta;
-}
-
-void
-TileMap::draw (SceneContext&amp; sc)
-{
-  Rect clip_rect = Rect(View::current()-&gt;get_clip_rect());
-
-  Rect rect(std::max(0, clip_rect.left/TILE_SIZE),
-            std::max(0, clip_rect.top/TILE_SIZE),
-            std::min(field.get_width(),  clip_rect.right/TILE_SIZE + 1),
-            std::min(field.get_height(), clip_rect.bottom/TILE_SIZE + 1));
-  
-  std::vector&lt;VertexArrayDrawingRequest*&gt; requests;
-  for (int y = rect.top;   y &lt; rect.bottom; ++y)
-    for (int x = rect.left; x &lt; rect.right; ++x)
-      {
-        Tile* tile = field(x, y);
-
-        if (!(tile == 0 || tile-&gt;packer &lt; 0))
-          {
-            int packer = tile-&gt;packer; 
-
-            if(packer &gt;= int(requests.size()))
-              requests.resize(packer+1);
-
-            VertexArrayDrawingRequest*&amp; request = requests[packer];
-            if (!request)
-              {
-                request = new VertexArrayDrawingRequest(Vector(0, 0), z_pos,
-                                                        sc.color().get_modelview());
-                request-&gt;set_mode(GL_QUADS);
-                request-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-                request-&gt;set_texture(tile-&gt;texture);
-              }
-            
-            request-&gt;texcoord(tile-&gt;uv.left, tile-&gt;uv.top);
-            request-&gt;vertex(x * TILE_SIZE, y * TILE_SIZE);
-
-            request-&gt;texcoord(tile-&gt;uv.right, tile-&gt;uv.top);
-            request-&gt;vertex(x * TILE_SIZE + TILE_SIZE, y * TILE_SIZE);
-
-            request-&gt;texcoord(tile-&gt;uv.right, tile-&gt;uv.bottom);
-            request-&gt;vertex(x * TILE_SIZE + TILE_SIZE, y * TILE_SIZE + TILE_SIZE);
-            
-            request-&gt;texcoord(tile-&gt;uv.left, tile-&gt;uv.bottom);
-            request-&gt;vertex(x * TILE_SIZE, y * TILE_SIZE + TILE_SIZE); 
-          }
-      }
-
-  for(std::vector&lt;VertexArrayDrawingRequest*&gt;::iterator i = requests.begin(); i != requests.end(); ++i)
-    {
-      if (*i)
-        sc.color().draw(*i);
-    }
-}
-
-unsigned int
-TileMap::get_pixel(int x, int y)
-{
-  if (x &lt; 0 || y &lt; 0 
-      || x &gt;= int(field.get_width())
-      || y &gt;= int(field.get_height()))
-    {
-      //std::cout &lt;&lt; &quot;Out of bounce: &quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; std::endl;
-      return 0;
-    }
-  else
-    {
-      Tile* tile = field(x, y);
-      
-      if (tile)
-        return tile-&gt;get_colmap();
-      else
-        return 0;     
-    }
-}
-
-bool
-TileMap::is_ground (float x, float y)
-{
-  int x_pos = int(x) / TILE_SIZE;
-  int y_pos = int(y) / TILE_SIZE;
-
-  if (x &lt; 0 || x_pos &gt;= field.get_width())
-    {
-      //std::cout &lt;&lt; &quot;TileMap::is_ground (): Out of range: &quot; &lt;&lt; x_pos &lt;&lt; &quot; &quot; &lt;&lt; y_pos &lt;&lt; std::endl;
-      return 1;
-    }
-  else if (y &lt; 0 || y_pos &gt;= field.get_height())
-    {
-      return 0;
-    }
-
-  if (field(x_pos, y_pos))
-    return field(x_pos, y_pos)-&gt;get_colmap();
-  else
-    return 0;
-}
-
-static float find_max(float pos, float v)
-{
-  if (v == 0) 
-    return 0;
-  else if (v &lt; 0)
-    return fmodf(fmodf(pos, TILE_SIZE) + TILE_SIZE, TILE_SIZE)/fabsf(v);
-  else // if (v &gt; 0)
-    {
-      return fmodf(fmodf(-pos, TILE_SIZE) + TILE_SIZE, TILE_SIZE)/v;
-    }
-}
-
-Vector
-TileMap::raycast(const Vector&amp; pos, float angle)
-{
-  ////////////////////////////////////////////
-  // FIXME: This code is buggy, use code from LaserPointer instead
-  ///////////////////////////////////////////////
-  
-  // Ray position in Tile units
-  int x = static_cast&lt;int&gt;(pos.x / TILE_SIZE);
-  int y = static_cast&lt;int&gt;(pos.y / TILE_SIZE);
-
-  Vector direction(cos(angle) * 100.0f, sin(angle) * 100.0f);
-
-  int step_x = (direction.x &gt; 0) ? 1 : -1;
-  int step_y = (direction.y &gt; 0) ? 1 : -1;
-
-  float tMaxX = find_max(pos.x, direction.x);
-  float tMaxY = find_max(pos.y, direction.y);
-
-  float tDeltaX = (direction.x == 0) ? 0 : fabsf(TILE_SIZE / direction.x);
-  float tDeltaY = (direction.y == 0) ? 0 : fabsf(TILE_SIZE / direction.y);
-
-  float t = 0;
-
-  while(x &gt;= 0 &amp;&amp; x &lt; get_width() &amp;&amp;
-        y &gt;= 0 &amp;&amp; y &lt; get_height())
-    {
-      Tile* tile = field(x, y);  
-      if (tile &amp;&amp; tile-&gt;colmap)
-        {
-          return pos + Vector(t * direction.x, t * direction.y);
-        }
-
-      // move one tile
-      if (tMaxX &lt; tMaxY)
-        {
-          t = tMaxX;
-          tMaxX += tDeltaX;
-          x = x + step_x;
-        }
-      else 
-        {
-          t = tMaxY;
-          tMaxY += tDeltaY;
-          y = y + step_y;
-        }
-    }
-
-  // Ray got out of the map
-  return pos + Vector(t * direction.x, t * direction.y);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/tile_map.hpp
===================================================================
--- trunk/windstille/src/tile_map.hpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_map.hpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,64 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TILE_MAP_HPP
-#define HEADER_WINDSTILLE_TILE_MAP_HPP
-
-#include &lt;string&gt;
-
-#include &quot;globals.hpp&quot;
-#include &quot;field.hpp&quot;
-#include &quot;game_object.hpp&quot;
-#include &quot;display/scene_context.hpp&quot;
-
-class Tile;
-
-class TileMap : public GameObject
-{
-private:
-  Field&lt;Tile*&gt; field;
-  typedef Field&lt;Tile*&gt;::iterator FieldIter;
-  float z_pos; 
-  float total_time;
-
-public:
-  TileMap(FileReader&amp; props);
-  virtual ~TileMap();
-
-  void update (float delta);
-  void draw (SceneContext&amp; gc);
-  
-  /** @return the type of ground at the given world coordinates */
-  bool is_ground(float x, float y);
-
-  /** @return the type of ground at the given subtile coordinates */
-  unsigned int get_pixel(int x, int y);
-  
-  int get_width () const { return field.get_width(); }
-  int get_height () const { return field.get_height (); }
-
-  int get_tile_size () const { return TILE_SIZE; }
-
-  /** Shoots a ray from \a pos into direction \a angle, returns the
-      position were the ray collides with the tilemap */
-  Vector raycast(const Vector&amp; pos, float angle);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/tile_packer.cpp
===================================================================
--- trunk/windstille/src/tile_packer.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_packer.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,129 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;assert.h&gt;
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &quot;display/texture.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;tile_packer.hpp&quot;
-#include &quot;util.hpp&quot;
-#include &quot;blitter.hpp&quot;
-
-class TilePackerImpl
-{
-public:
-  // Position for the next tile
-  int x_pos;
-  int y_pos;
-
-  Texture texture;
-
-  int width;
-  int height;
-};
-
-TilePacker::TilePacker(int width, int height)
-  : impl(new TilePackerImpl())
-{
-  impl-&gt;x_pos = 0;
-  impl-&gt;y_pos = 0;
-
-  impl-&gt;width  = width;
-  impl-&gt;height = height;
-
-  impl-&gt;texture = Texture(GL_TEXTURE_2D, width, height);
-        
-  assert_gl(&quot;setting TilePacker texture parameters&quot;); 
-}
-
-TilePacker::~TilePacker()
-{
-  delete impl;
-}
-
-/** Pack a tile and return the position where it is placed in the
-    pixel buffer */
-Rectf
-TilePacker::pack(SDL_Surface* image, int x, int y, int w, int h)
-{
-  assert(w == TILE_RESOLUTION &amp;&amp; h == TILE_RESOLUTION);
-  assert(!is_full());
-
-#if SDL_BYTEORDER == SDL_BIG_ENDIAN
-  SDL_Surface* convert = SDL_CreateRGBSurface(SDL_SWSURFACE,
-    w+2, h+2, 32,
-    0xff000000, 0x00ff0000, 0x0000ff00, 0x000000ff);
-#else
-  SDL_Surface* convert = SDL_CreateRGBSurface(SDL_SWSURFACE,
-    w+2, h+2, 32,
-      0x000000ff, 0x0000ff00, 0x00ff0000, 0xff000000);
-#endif
-  if(convert == 0)
-    throw std::runtime_error(&quot;Couldn't pack texture: out of memory&quot;);
-
-  SDL_Rect source_rect;
-  source_rect.x = x;
-  source_rect.y = y;
-  source_rect.w = w;
-  source_rect.h = h;
-  SDL_Rect dest_rect;
-  dest_rect.x = 1;
-  dest_rect.y = 1;
-  dest_rect.w = w;
-  dest_rect.h = h;
-  SDL_SetAlpha(image, 0, 0);
-  SDL_BlitSurface(image, &amp;source_rect, convert, &amp;dest_rect);
-  generate_border(convert, 1, 1, TILE_RESOLUTION, TILE_RESOLUTION);
-
-  impl-&gt;texture.put(convert, impl-&gt;x_pos, impl-&gt;y_pos);
-  SDL_FreeSurface(convert);
-
-  assert_gl(&quot;updating tilepacker texture&quot;);
-
-  Rectf rect(Vector(static_cast&lt;float&gt;(impl-&gt;x_pos+1)/impl-&gt;width, 
-                    static_cast&lt;float&gt;(impl-&gt;y_pos+1)/impl-&gt;height), 
-             Sizef(static_cast&lt;float&gt;(TILE_RESOLUTION)/impl-&gt;width, 
-                   static_cast&lt;float&gt;(TILE_RESOLUTION)/impl-&gt;height));
-
-  // we move by TILE_RESOLUTION+1 to avoid tiles bleeding into each other
-  // when blending
-  impl-&gt;x_pos += TILE_RESOLUTION + 2; 
-  if (impl-&gt;x_pos + TILE_RESOLUTION &gt; impl-&gt;width)
-    {
-      impl-&gt;x_pos = 0;
-      impl-&gt;y_pos += TILE_RESOLUTION + 2;
-    }
-
-  return rect;
-}
-
-/** Return true if the PixelBuffer is full */
-bool
-TilePacker::is_full() const
-{
-  return (impl-&gt;y_pos + TILE_RESOLUTION + 2 &gt; impl-&gt;height);
-}
-
-Texture
-TilePacker::get_texture() const
-{
-  return impl-&gt;texture;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/tile_packer.hpp
===================================================================
--- trunk/windstille/src/tile_packer.hpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/tile_packer.hpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -1,56 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TILE_PACKER_HPP
-#define HEADER_WINDSTILLE_TILE_PACKER_HPP
-
-#include &lt;SDL.h&gt;
-#include &lt;GL/glew.h&gt;
-#include &lt;GL/gl.h&gt;
-#include &quot;display/texture.hpp&quot;
-#include &quot;math/rect.hpp&quot;
-
-class TilePackerImpl;
-
-/** Creates a pixelbuffer of the given size and packs 32x32 large
-    tiles into it for later conversion to a texture */
-class TilePacker
-{
-private:
-public:
-  /** Let the texture be width/height large (only power of two values
-      recomment) */
-  TilePacker(int width, int height);
-  ~TilePacker();
-
-  /** Pack a tile and return the position where it is placed in the
-      pixel buffer */
-  Rectf pack(SDL_Surface* image, int x, int y, int w, int h);
-
-  /** Return true if the PixelBuffer is full */
-  bool is_full() const;
-
-  Texture get_texture() const;
-
-private:
-  TilePackerImpl* impl;
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/windstille_main.cpp
===================================================================
--- trunk/windstille/src/windstille_main.cpp	2009-02-11 20:45:55 UTC (rev 2462)
+++ trunk/windstille/src/windstille_main.cpp	2009-02-11 21:05:03 UTC (rev 2463)
@@ -30,7 +30,7 @@
 #include &quot;sector.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;
-#include &quot;tile_factory.hpp&quot;
+#include &quot;tile/tile_factory.hpp&quot;
 #include &quot;script_manager.hpp&quot;
 #include &quot;config.hpp&quot;
 #include &quot;util.hpp&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001459.html">[Windstille-commit] r2462 - trunk/windstille/src
</A></li>
	<LI>Next message: <A HREF="001461.html">[Windstille-commit] r2464 - in trunk/windstille/src: . engine gui	objects particles scripting sprite3d tile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1460">[ date ]</a>
              <a href="thread.html#1460">[ thread ]</a>
              <a href="subject.html#1460">[ subject ]</a>
              <a href="author.html#1460">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
