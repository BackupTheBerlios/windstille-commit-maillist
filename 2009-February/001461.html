<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r2464 - in trunk/windstille/src: . engine gui	objects particles scripting sprite3d tile
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2464%20-%20in%20trunk/windstille/src%3A%20.%20engine%20gui%0A%09objects%20particles%20scripting%20sprite3d%20tile&In-Reply-To=%3C200902112122.n1BLM5kc029262%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001460.html">
   <LINK REL="Next"  HREF="001462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r2464 - in trunk/windstille/src: . engine gui	objects particles scripting sprite3d tile</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2464%20-%20in%20trunk/windstille/src%3A%20.%20engine%20gui%0A%09objects%20particles%20scripting%20sprite3d%20tile&In-Reply-To=%3C200902112122.n1BLM5kc029262%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r2464 - in trunk/windstille/src: . engine gui	objects particles scripting sprite3d tile">grumbel at mail.berlios.de
       </A><BR>
    <I>Wed Feb 11 22:22:05 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001460.html">[Windstille-commit] r2463 - in trunk/windstille/src: . collision	gui objects tile
</A></li>
        <LI>Next message: <A HREF="001462.html">[Windstille-commit] r2465 - in trunk/windstille/src: . armature	display engine font gui input math navigation objects	particles scripting sprite2d tile util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1461">[ date ]</a>
              <a href="thread.html#1461">[ thread ]</a>
              <a href="subject.html#1461">[ subject ]</a>
              <a href="author.html#1461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-02-11 22:22:01 +0100 (Wed, 11 Feb 2009)
New Revision: 2464

Added:
   trunk/windstille/src/engine/
   trunk/windstille/src/engine/camera.cpp
   trunk/windstille/src/engine/camera.hpp
   trunk/windstille/src/engine/entity.cpp
   trunk/windstille/src/engine/entity.hpp
   trunk/windstille/src/engine/game_object.cpp
   trunk/windstille/src/engine/game_object.hpp
   trunk/windstille/src/engine/physics.cpp
   trunk/windstille/src/engine/physics.hpp
   trunk/windstille/src/engine/script_manager.cpp
   trunk/windstille/src/engine/script_manager.hpp
   trunk/windstille/src/engine/sector.cpp
   trunk/windstille/src/engine/sector.hpp
   trunk/windstille/src/objects/laser_pointer.cpp
   trunk/windstille/src/objects/laser_pointer.hpp
   trunk/windstille/src/objects/pistol.cpp
   trunk/windstille/src/objects/pistol.hpp
   trunk/windstille/src/objects/trigger.cpp
   trunk/windstille/src/objects/trigger.hpp
Removed:
   trunk/windstille/src/camera.cpp
   trunk/windstille/src/camera.hpp
   trunk/windstille/src/entity.cpp
   trunk/windstille/src/entity.hpp
   trunk/windstille/src/game_object.cpp
   trunk/windstille/src/game_object.hpp
   trunk/windstille/src/laser_pointer.cpp
   trunk/windstille/src/laser_pointer.hpp
   trunk/windstille/src/physics.cpp
   trunk/windstille/src/physics.hpp
   trunk/windstille/src/pistol.cpp
   trunk/windstille/src/pistol.hpp
   trunk/windstille/src/script_manager.cpp
   trunk/windstille/src/script_manager.hpp
   trunk/windstille/src/sector.cpp
   trunk/windstille/src/sector.hpp
   trunk/windstille/src/trigger.cpp
   trunk/windstille/src/trigger.hpp
Modified:
   trunk/windstille/src/SConscript
   trunk/windstille/src/console.cpp
   trunk/windstille/src/conversation.cpp
   trunk/windstille/src/dialog_manager.cpp
   trunk/windstille/src/game_session.cpp
   trunk/windstille/src/gui/automap.cpp
   trunk/windstille/src/menu_manager.cpp
   trunk/windstille/src/objects/background_gradient.hpp
   trunk/windstille/src/objects/bomb.cpp
   trunk/windstille/src/objects/bomb.hpp
   trunk/windstille/src/objects/box.hpp
   trunk/windstille/src/objects/character.cpp
   trunk/windstille/src/objects/character.hpp
   trunk/windstille/src/objects/elevator.cpp
   trunk/windstille/src/objects/elevator.hpp
   trunk/windstille/src/objects/grenade.cpp
   trunk/windstille/src/objects/grenade.hpp
   trunk/windstille/src/objects/hedgehog.cpp
   trunk/windstille/src/objects/hedgehog.hpp
   trunk/windstille/src/objects/liquid.hpp
   trunk/windstille/src/objects/nightvision.hpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/objects/player.hpp
   trunk/windstille/src/objects/scriptable_object.cpp
   trunk/windstille/src/objects/scriptable_object.hpp
   trunk/windstille/src/objects/shockwave.hpp
   trunk/windstille/src/objects/spider_mine.hpp
   trunk/windstille/src/objects/swarm.cpp
   trunk/windstille/src/objects/swarm.hpp
   trunk/windstille/src/objects/test_object.hpp
   trunk/windstille/src/objects/vrdummy.hpp
   trunk/windstille/src/particles/particle_system.hpp
   trunk/windstille/src/scripting/game_objects.cpp
   trunk/windstille/src/scripting/game_objects.hpp
   trunk/windstille/src/scripting/interface.cpp
   trunk/windstille/src/sprite3d/sprite3d.hpp
   trunk/windstille/src/tile/tile_map.hpp
   trunk/windstille/src/view.cpp
   trunk/windstille/src/view.hpp
   trunk/windstille/src/windstille_main.cpp
Log:
Moved engine related stuff to engine/, moved some objects into objects/

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/SConscript	2009-02-11 21:22:01 UTC (rev 2464)
@@ -48,7 +48,7 @@
 'armature_test.cpp',
 'baby_xml.cpp',
 'blitter.cpp',
-'camera.cpp',
+'engine/camera.cpp',
 'collision/collision_data.cpp',
 'collision/collision_engine.cpp',
 'collision/collision_object.cpp',
@@ -77,12 +77,12 @@
 'display/texture_manager.cpp',
 'display/vertex_array_drawing_request.cpp',
 'energy_bar.cpp',
-'entity.cpp',
+'engine/entity.cpp',
 'file_reader.cpp',
 'font/border_font_effect.cpp',
 'font/fonts.cpp',
 'font/ttf_font.cpp',
-'game_object.cpp',
+'engine/game_object.cpp',
 'game_session.cpp',
 'geometry_test.cpp',
 'getter.cpp',
@@ -111,7 +111,7 @@
 'input/input_manager_sdl.cpp',
 'input/wiimote.cpp',
 'inventory.cpp',
-'laser_pointer.cpp',
+'objects/laser_pointer.cpp',
 'lisp/getters.cpp',
 'lisp/lexer.cpp',
 'lisp/lisp.cpp',
@@ -155,19 +155,19 @@
 'pda.cpp',
 'physfs/physfs_sdl.cpp',
 'physfs/physfs_stream.cpp',
-'physics.cpp',
-'pistol.cpp',
+'engine/physics.cpp',
+'objects/pistol.cpp',
 'random.cpp',
 'response_curve.cpp',
 'screen.cpp',
 'screen_manager.cpp',
-'script_manager.cpp',
+'engine/script_manager.cpp',
 'scripting/game_objects.cpp',
 'scripting/interface.cpp',
 'scripting/squirrel_error.cpp',
 'scripting/util.cpp',
 'scripting/wrapper.cpp',
-'sector.cpp',
+'engine/sector.cpp',
 'sexpr_file_reader.cpp',
 'sound/sound_file.cpp',
 'sound/sound_manager.cpp',
@@ -189,7 +189,7 @@
 'tile/tile_packer.cpp',
 'timer.cpp',
 'title_screen.cpp',
-'trigger.cpp',
+'objects/trigger.cpp',
 'util.cpp',
 'view.cpp',
 'windstille_main.cpp',

Deleted: trunk/windstille/src/camera.cpp
===================================================================
--- trunk/windstille/src/camera.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/camera.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,178 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;objects/player.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;script_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;camera.hpp&quot;
-
-Camera* Camera::current_ = 0;
-
-/**
- * Calculate the distance between two camera PathPoints, distance here
- * means not only the distance between the points itself, but also
- * between their zoom and rotation setting
- */
-float distance(const Camera::PathPoint&amp; a, const Camera::PathPoint&amp; b)
-{
-  // &quot;100.0f *&quot; is there to balance out the speed between zoom and
-  // positional movement
-  return (b.pos - a.pos).length() 
-    + 100.0f * fabsf(b.zoom - a.zoom)
-    + fabsf(b.rotation - a.rotation);
-}
-
-/**
- * Simple linear interpolation to move along a given vector path
- * FIXME: Could add curves and different speed per vertex
- */
-Camera::PathPoint interpolate_path(const std::vector&lt;Camera::PathPoint&gt;&amp; path, float length)
-{
-  float length_so_far = 0.0f;
-  for(std::vector&lt;Camera::PathPoint&gt;::size_type i = 0; i &lt; path.size()-1; ++i)
-    {
-      float  segment_length = distance(path[i], path[i+1]);
-
-      if (length_so_far + segment_length &gt; length)
-        {
-          float factor = (length - length_so_far) / segment_length;
-          return Camera::PathPoint((path[i+1].pos * factor) + (path[i].pos * (1.0f - factor)),
-                                   (factor * path[i+1].zoom) + ((1.0f - factor) * path[i].zoom));
-        }
-      length_so_far += segment_length;
-    }
-
-  return path.back();
-}
-
-Camera::Camera()
-  : pos(0, 0), zoom(1.0f)
-{
-  path_pos = 0;
-  current_ = this;
-  mode     = CAMERA_FOLLOW_PLAYER;
-}
-
-void
-Camera::update(float delta)
-{
-  switch (mode)
-    {
-    case CAMERA_INACTIVE:
-      // do nothing
-      break;
-
-    case CAMERA_FOLLOW_PLAYER:
-      {
-        int hscroll_threshold = 100;
-        int vscroll_threshold = 150;
-
-        Vector tpos = Player::current()-&gt;get_pos();
-
-        float dist = tpos.x - pos.x;
-        if (dist &gt; hscroll_threshold)
-          pos.x = tpos.x - hscroll_threshold;
-        else if (dist &lt; - hscroll_threshold)
-          pos.x = tpos.x + hscroll_threshold;
-
-        dist = tpos.y - pos.y;
-        if (dist &gt; vscroll_threshold)
-          pos.y = tpos.y - vscroll_threshold;
-        else if (dist &lt; -vscroll_threshold)
-          pos.y = tpos.y + vscroll_threshold;
-
-        int start_x = Display::get_width()/2;
-        int end_x   = Sector::current()-&gt;get_width() - Display::get_width()/2;
-
-        int start_y = Display::get_height()/2;
-        int end_y   = Sector::current()-&gt;get_height() - Display::get_height()/2;
-
-        if (pos.x &lt; start_x)
-          pos.x = start_x;
-
-        if (pos.y &lt; start_y)
-          pos.y = start_y;
-
-        if (pos.x &gt; end_x)
-          pos.x = end_x;
-
-        if (pos.y &gt; end_y)
-          pos.y = end_y;
-      }
-      break;
-
-    case CAMERA_FOLLOW_PATH:
-      {
-        assert(!path.empty());
-        path_pos += delta * 50.0f;
-
-        PathPoint p = interpolate_path(path, path_pos);
-
-        set_pos(p.pos.x, p.pos.y);
-        set_zoom(p.zoom);
-
-        if (p == path.back())
-          {
-            script_manager-&gt;fire_wakeup_event(ScriptManager::CAMERA_DONE);
-            set_mode(CAMERA_INACTIVE);
-          }
-      }
-      break;
-    }
-}
-
-void
-Camera::set_pos(float x, float y)
-{
-  pos.x = x; // + Display::get_width()/2);
-  pos.y = y; // + Display::get_height()/2);
-}
-
-void
-Camera::set_zoom(float zoom_)
-{
-  zoom = zoom_;
-}
-
-float
-Camera::get_zoom() const
-{
-  return zoom;
-}
-
-void
-Camera::set_path(const std::vector&lt;PathPoint&gt;&amp; path_, bool cont)
-{
-  path.clear();
-  if (cont)
-    path.push_back(PathPoint(pos, zoom));
-
-  std::copy(path_.begin(), path_.end(), std::back_inserter(path)); 
-
-  path_pos = 0;
-  mode     = CAMERA_FOLLOW_PATH;
-}
-
-void
-Camera::set_mode(Mode mode_)
-{
-  mode = mode_;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/camera.hpp
===================================================================
--- trunk/windstille/src/camera.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/camera.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,97 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CAMERA_HPP
-#define HEADER_WINDSTILLE_CAMERA_HPP
-
-/** 
- * This class manages the virtual camera movement, it follows the
- * player, allows the player to watch around, might zoom out if
- * interesting stuff happens out of the screen and such
- */
-class Camera
-{
-public:
-  enum Mode { CAMERA_INACTIVE, CAMERA_FOLLOW_PLAYER, CAMERA_FOLLOW_PATH };
-
-  struct PathPoint
-  {
-    Vector pos;
-    float  zoom;
-    float  rotation;
-
-    PathPoint(const Vector&amp; pos_, float zoom_, float rotation_ = 0.0f)
-      : pos(pos_), zoom(zoom_), rotation(rotation_) {}
-
-    bool operator==(const PathPoint&amp; p) {
-      return p.pos == pos &amp;&amp; p.zoom == zoom;
-    }
-  };
-
-private:
-  Mode mode;
-  
-  /**
-   * Position of the camera, ie. where the center of the screen should
-   * be located
-   */
-  Vector pos;
-  
-  /**
-   * Zoom of the Camera, 1.0 means no zoom, 2.0 means everything will
-   * be twice as large 
-   */
-  float  zoom;
-
-  std::vector&lt;PathPoint&gt; path;
-  float path_pos;
-
-  static Camera* current_;
-public:
-  static Camera* current() { return current_; }
-
-  Camera();
-
-  void   update(float delta);
-
-  Vector get_pos() const { return pos; }
-  void   set_pos(float x, float y);
-
-  void   set_zoom(float zoom_);
-  float  get_zoom() const;
-
-  void   set_mode(Mode mode_);
-
-  /**
-   * Set Camera to follow the given path
-   *
-   * @param path_ The path the camera should follow
-   * @param cont True if you want to continue the path from the
-   * current camera position, false if you want the camera to jump to
-   * the start of the path instantly
-   */
-  void   set_path(const std::vector&lt;PathPoint&gt;&amp; path_, bool cont);
-
-private:
-  Camera (const Camera&amp;);
-  Camera&amp; operator= (const Camera&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/console.cpp
===================================================================
--- trunk/windstille/src/console.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/console.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 #include &quot;font/fonts.hpp&quot;
 #include &quot;game_session.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;scripting/util.hpp&quot;
 #include &quot;console.hpp&quot;

Modified: trunk/windstille/src/conversation.cpp
===================================================================
--- trunk/windstille/src/conversation.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/conversation.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;math/rect.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;conversation.hpp&quot;
 #include &quot;pda.hpp&quot;

Modified: trunk/windstille/src/dialog_manager.cpp
===================================================================
--- trunk/windstille/src/dialog_manager.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/dialog_manager.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -22,7 +22,7 @@
 #include &quot;input/controller.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;dialog_manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 #include &quot;text_area.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;config.hpp&quot;

Copied: trunk/windstille/src/engine/camera.cpp (from rev 2463, trunk/windstille/src/camera.cpp)


Property changes on: trunk/windstille/src/engine/camera.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/camera.hpp (from rev 2463, trunk/windstille/src/camera.hpp)


Property changes on: trunk/windstille/src/engine/camera.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/entity.cpp (from rev 2463, trunk/windstille/src/entity.cpp)
===================================================================
--- trunk/windstille/src/entity.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/engine/entity.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,63 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;assert.h&gt;
+#include &quot;globals.hpp&quot;
+#include &quot;sector.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
+#include &quot;entity.hpp&quot;
+
+Entity::Entity()
+  : velocity(0, 0),
+    useable(false)
+{
+  parent = 0;
+}
+
+Entity::~Entity()
+{
+}
+
+void
+Entity::set_pos(Vector pos)
+{
+  this-&gt;pos = pos;
+}
+
+bool
+Entity::on_ground() const
+{
+  return get_world ()-&gt;get_tilemap()-&gt;is_ground(pos.x, pos.y+16);
+}
+
+bool 
+Entity::in_wall() const
+{
+  return get_world ()-&gt;get_tilemap()-&gt;is_ground(pos.x, pos.y);
+}
+
+void
+Entity::set_parent(Entity* parent_)
+{
+  if (parent_ != this)
+    {
+      parent = parent_;
+    }
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/engine/entity.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/entity.hpp (from rev 2463, trunk/windstille/src/entity.hpp)
===================================================================
--- trunk/windstille/src/entity.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/engine/entity.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,82 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_ENTITY_HPP
+#define HEADER_WINDSTILLE_ENTITY_HPP
+
+#include &lt;boost/signal.hpp&gt;
+#include &quot;math/vector.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
+#include &quot;collision/collision_object.hpp&quot;
+
+/** A GameObject which has a position and some other properties which
+    are shared among all/most things in the world */
+class Entity : public GameObject
+{
+private:
+  boost::signal&lt;void ()&gt; done; 
+
+protected:
+  friend class Physics;
+  bool on_ground() const;
+  bool in_wall() const;
+  
+  Vector pos;
+  Vector velocity;
+  bool useable;
+  std::string use_verb;
+  
+  Entity* parent;
+public:
+  Entity();
+  virtual ~Entity();
+   
+  virtual Vector get_pos() const
+  { return pos; }
+
+  virtual void set_pos(Vector pos);
+
+  /** Called once per frame to allow the object to draw itself */
+  virtual void draw(SceneContext&amp; gc) = 0;
+
+  /** Called, possible multiple times, per frame to let the object
+      update its position and properties */
+  virtual void update(float delta) = 0;
+
+  /** Called when the player uses this entity */
+  virtual void use() {}
+
+  /** Returns true if the entity is useable by the player */
+  virtual bool is_useable() const { return useable; }
+  std::string get_use_verb() const { return use_verb; }
+
+  /** Makes the objects (un)usable for the player */
+  void set_useable(bool t) { useable = t; }
+
+  void set_parent(Entity* parent_);
+
+  boost::signal&lt;void ()&gt;&amp; sig_done() { return done; }
+
+private:
+  Entity (const Entity&amp;);
+  Entity&amp; operator= (const Entity&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/engine/entity.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/game_object.cpp (from rev 2463, trunk/windstille/src/game_object.cpp)
===================================================================
--- trunk/windstille/src/game_object.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/engine/game_object.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,25 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &quot;engine/game_object.hpp&quot;
+#include &quot;sector.hpp&quot;
+
+Sector* GameObject::world;
+
+
+/* EOF */


Property changes on: trunk/windstille/src/engine/game_object.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/game_object.hpp (from rev 2463, trunk/windstille/src/game_object.hpp)


Property changes on: trunk/windstille/src/engine/game_object.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/physics.cpp (from rev 2463, trunk/windstille/src/physics.cpp)


Property changes on: trunk/windstille/src/engine/physics.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/engine/physics.hpp (from rev 2463, trunk/windstille/src/physics.hpp)


Property changes on: trunk/windstille/src/engine/physics.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/engine/script_manager.cpp (from rev 2463, trunk/windstille/src/script_manager.cpp)


Property changes on: trunk/windstille/src/engine/script_manager.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/script_manager.hpp (from rev 2463, trunk/windstille/src/script_manager.hpp)


Property changes on: trunk/windstille/src/engine/script_manager.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/sector.cpp (from rev 2463, trunk/windstille/src/sector.cpp)
===================================================================
--- trunk/windstille/src/sector.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/engine/sector.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,397 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;iostream&gt;
+#include &lt;sstream&gt;
+#include &lt;stdexcept&gt;
+#include &quot;sexpr_file_reader.hpp&quot;
+#include &quot;globals.hpp&quot;
+#include &quot;display/scene_context.hpp&quot;
+#include &quot;objects/background_gradient.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
+#include &quot;objects/player.hpp&quot;
+#include &quot;objects/trigger.hpp&quot;
+#include &quot;objects/test_object.hpp&quot;
+#include &quot;objects/vrdummy.hpp&quot;
+#include &quot;sound/sound_manager.hpp&quot;
+#include &quot;script_manager.hpp&quot;
+#include &quot;collision/collision_engine.hpp&quot;
+#include &quot;particles/particle_system.hpp&quot;
+#include &quot;objects/test_object.hpp&quot;
+#include &quot;objects/elevator.hpp&quot;
+#include &quot;objects/nightvision.hpp&quot;
+#include &quot;objects/character.hpp&quot;
+#include &quot;objects/laser_pointer.hpp&quot;
+#include &quot;objects/swarm.hpp&quot;
+#include &quot;objects/liquid.hpp&quot;
+#include &quot;objects/shockwave.hpp&quot;
+#include &quot;objects/hedgehog.hpp&quot;
+#include &quot;objects/spider_mine.hpp&quot;
+#include &quot;objects/box.hpp&quot;
+#include &quot;objects/scriptable_object.hpp&quot;
+#include &quot;navigation/navigation_graph.hpp&quot;
+#include &quot;scripting/squirrel_error.hpp&quot;
+
+#include &quot;sector.hpp&quot;
+
+// The table (works like a namespace here) where the game objects will appear
+#define OBJECTS_TABLE &quot;objects&quot;
+
+Sector* Sector::current_ = 0;
+
+Sector::Sector(const std::string&amp; arg_filename)
+  : filename(arg_filename),
+    player(0)    
+{
+  // make sure squirrel has an &quot;objects&quot; table
+  script_manager-&gt;run_script(
+      &quot;if(! (\&quot;&quot; OBJECTS_TABLE &quot;\&quot; in this)) {&quot;
+      &quot;  &quot; OBJECTS_TABLE &quot; &lt;- {};&quot;
+      &quot;}&quot;, &quot;&quot;);
+  
+  if (debug) std::cout &lt;&lt; &quot;Creating new Sector&quot; &lt;&lt; std::endl;
+  collision_engine = new CollisionEngine();
+  navigation_graph = new NavigationGraph();
+
+  current_ = this;
+  interactive_tilemap = 0;
+  interactivebackground_tilemap = 0;
+
+  parse_file(filename);
+  if (!interactive_tilemap)
+    throw std::runtime_error(&quot;No interactive-tilemap available&quot;);
+
+  // add interactive to collision engine
+  collision_engine-&gt;add(new CollisionObject(interactive_tilemap));
+
+  // Spawn the Player
+  if(!player) {
+    player = new Player();
+    add(player);
+  }
+  player-&gt;set_pos(Vector(300,200));
+}
+
+Sector::~Sector()
+{
+  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
+    (*i)-&gt;unref();
+  for(Objects::iterator i = new_objects.begin(); i != new_objects.end(); ++i)
+    (*i)-&gt;unref();
+
+  delete navigation_graph;
+  delete collision_engine;
+}
+
+void
+Sector::parse_file(const std::string&amp; filename)
+{
+  if (debug) std::cout &lt;&lt; &quot;Sector:parse_file '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
+  
+  FileReader reader = FileReader::parse(filename);
+  if(reader.get_name() != &quot;windstille-sector&quot;) {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille-sector file&quot;;
+    throw std::runtime_error(msg.str());
+  }
+  
+  int version = 1;
+  if(!reader.get(&quot;version&quot;, version))
+    std::cerr &lt;&lt; &quot;Warning no version specified in levelformat.\n&quot;;
+  if(version &gt; 1)
+    std::cerr &lt;&lt; &quot;Warning: format version is newer than game.\n&quot;;
+
+  reader.get(&quot;name&quot;,          name);
+  reader.get(&quot;music&quot;,         music);
+  reader.get(&quot;init-script&quot;,   init_script);
+  reader.get(&quot;ambient-color&quot;, ambient_light);
+  
+  FileReader objects_reader;
+  if(reader.get(&quot;objects&quot;, objects_reader) == false)
+    throw std::runtime_error(&quot;No objects specified&quot;);
+
+  std::vector&lt;FileReader&gt; objects_readers = objects_reader.get_sections();
+  for(std::vector&lt;FileReader&gt;::iterator i = objects_readers.begin(); i != objects_readers.end(); ++i)
+    {
+      add_object(*i);
+    }
+
+  reader.print_unused_warnings(&quot;sector&quot;);
+  if (debug) std::cout &lt;&lt; &quot;Finished parsing&quot; &lt;&lt; std::endl;
+}
+
+void
+Sector::add_object(FileReader&amp; reader)
+{
+  if(reader.get_name() == &quot;tilemap&quot;) {
+    TileMap* tilemap = new TileMap(reader);
+    add(tilemap);
+    if (tilemap-&gt;get_name() == &quot;interactive&quot;)
+      interactive_tilemap = tilemap;
+    else if (tilemap-&gt;get_name() == &quot;interactivebackground&quot;)
+      interactivebackground_tilemap = tilemap;
+  } else if(reader.get_name() == &quot;background&quot;) {
+    // TODO
+  } else if (reader.get_name() == &quot;background-gradient&quot;) {
+    add(new BackgroundGradient(reader));
+  } else if(reader.get_name() == &quot;trigger&quot;) {
+    add(new Trigger(reader));
+  } else if(reader.get_name() == &quot;box&quot;) {
+    add(new Box(reader));
+  } else if(reader.get_name() == &quot;shockwave&quot;) {
+    add(new Shockwave(reader));
+  } else if(reader.get_name() == &quot;elevator&quot;) {
+    add(new Elevator(reader));
+  } else if(reader.get_name() == &quot;character&quot;) {    
+    add(new Character(reader));
+  } else if(reader.get_name() == &quot;spider-mine&quot;) {
+    add(new SpiderMine(reader));
+  } else if(reader.get_name() == &quot;hedgehog&quot;) {
+    add(new Hedgehog(reader));
+  } else if(reader.get_name() == &quot;test-object&quot;) {
+    add(new TestObject(reader));
+  } else if (reader.get_name() == &quot;nightvision&quot;) {
+    add(new Nightvision(reader));
+  } else if (reader.get_name() == &quot;particle-system&quot;) {
+    add(new ParticleSystem(reader));
+  } else if(reader.get_name() == &quot;scriptable-object&quot;) {    
+    add(new ScriptableObject(reader));
+  } else if (reader.get_name() == &quot;vrdummy&quot;) {
+    add(new VRDummy(reader));
+  } else if (reader.get_name() == &quot;swarm&quot;) {
+    add(new Swarm(reader));
+  } else if (reader.get_name() == &quot;laserpointer&quot;) {
+    add(new LaserPointer());
+  } else if (reader.get_name() == &quot;liquid&quot;) {
+    add(new Liquid(reader));
+  } else {
+    std::cout &lt;&lt; &quot;Skipping unknown Object: &quot; &lt;&lt; reader.get_name() &lt;&lt; &quot;\n&quot;;
+  }
+}
+
+void
+Sector::activate()
+{
+  commit_adds();
+  commit_removes();
+
+  sound_manager-&gt;play_music(music);
+  if (init_script != &quot;&quot;)
+    script_manager-&gt;run_script_file(init_script);
+}
+
+void
+Sector::draw(SceneContext&amp; sc)
+{
+  sc.light().fill_screen(ambient_light);
+
+  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
+    {
+      if ((*i)-&gt;is_active())
+        (*i)-&gt;draw(sc);
+    }
+}
+
+void Sector::commit_adds()
+{
+  // Add new game objects
+  for(Objects::iterator i = new_objects.begin(); i != new_objects.end(); ++i) {
+    objects.push_back(*i);
+  }
+  new_objects.clear();
+}
+
+void Sector::update(float delta)
+{
+  commit_adds();
+
+  collision_engine-&gt;update(delta);
+
+  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i) {
+    if ((*i)-&gt;is_active())
+      (*i)-&gt;update(delta);
+  }
+  commit_removes();
+}
+
+void
+Sector::commit_removes()
+{
+  // remove objects
+  for(Objects::iterator i = objects.begin(); i != objects.end(); ) {
+    GameObject* object = *i;
+    if(object-&gt;is_removable()) {
+      if(object-&gt;get_name() != &quot;&quot;) {
+        remove_object_from_squirrel(object);
+      }
+      object-&gt;unref();
+
+      i = objects.erase(i);
+      continue;
+    }
+
+    ++i;
+  }
+}
+
+void
+Sector::add(GameObject* obj)
+{
+  new_objects.push_back(obj);
+  obj-&gt;ref();
+  if(obj-&gt;get_name() != &quot;&quot;) {
+    expose_object_to_squirrel(obj);
+  }
+}
+
+void
+Sector::remove_object_from_squirrel(GameObject* object)
+{
+  using namespace scripting;
+
+  // get objects table
+  HSQUIRRELVM v = script_manager-&gt;get_vm();
+  sq_pushroottable(v);
+  sq_pushstring(v, OBJECTS_TABLE, -1);
+  if(SQ_FAILED(sq_get(v, -2)))
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
+    throw SquirrelError(v, msg.str());
+  }
+
+  // remove object from table
+  sq_pushstring(v, object-&gt;get_name().c_str(), object-&gt;get_name().size());
+  if(SQ_FAILED(sq_deleteslot(v, -2, SQFalse) &lt; 0)) {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't remove squirrel object for '&quot; &lt;&lt; object-&gt;get_name()
+        &lt;&lt; &quot;'&quot;;
+    throw SquirrelError(v, msg.str());
+  }
+  
+  // pop objects and root table
+  sq_pop(v, 2);
+}
+
+// tries to find out the &quot;real&quot; class of an gameobject by some dynamic casting
+// and creates a matching squirrel instance for that object
+static inline void create_squirrel_instance(HSQUIRRELVM v, GameObject* object)
+{
+  ScriptableObject* script_obj = dynamic_cast&lt;ScriptableObject*&gt; (object);
+  if(script_obj) {
+    create_squirrel_instance(v, new scripting::ScriptableObject(script_obj),
+                             true);
+    return;
+  }
+  
+  TestObject* tobj = dynamic_cast&lt;TestObject*&gt; (object);
+  if(tobj) {
+    create_squirrel_instance(v, new scripting::TestObject(tobj), true);
+    return;
+  }                                                                             
+
+  Player* player = dynamic_cast&lt;Player*&gt; (object);
+  if(player) {
+    create_squirrel_instance(v, new scripting::Player(player), true);
+    return;
+  }
+
+  create_squirrel_instance(v, new scripting::GameObject(object), true);
+}
+
+void
+Sector::expose_object_to_squirrel(GameObject* object)
+{
+  using namespace scripting;
+
+  // get objects table
+  HSQUIRRELVM v = script_manager-&gt;get_vm();
+  sq_pushroottable(v);
+  sq_pushstring(v, OBJECTS_TABLE, -1);
+  if(SQ_FAILED(sq_get(v, -2)))
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
+    throw SquirrelError(v, msg.str());
+  }
+  
+  // create squirrel instance and register in table
+  sq_pushstring(v, object-&gt;get_name().c_str(), object-&gt;get_name().size());
+  create_squirrel_instance(v, object);
+  if(SQ_FAILED(sq_createslot(v, -3)))
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't register object in objects tab&#246;e&quot;;
+    throw SquirrelError(v, msg.str());
+  }
+
+  // pop roottable and objects table
+  sq_pop(v, 2);
+}
+
+GameObject*
+Sector::get_object(const std::string&amp; name) const
+{
+  for(Objects::const_iterator i = objects.begin(); i != objects.end(); ++i) 
+    {
+      if ((*i)-&gt;get_name() == name)
+        {
+          return *i;
+        }
+    }
+  return 0;
+}
+
+int
+Sector::get_width () const
+{
+  return interactive_tilemap-&gt;get_width() * TILE_SIZE;
+}
+
+int
+Sector::get_height () const
+{
+  return interactive_tilemap-&gt;get_height() * TILE_SIZE;
+}
+
+void
+Sector::set_tilemap(TileMap* t)
+{
+  interactive_tilemap = t;
+}
+
+void
+Sector::set_ambient_light(const Color&amp; color)
+{
+  ambient_light = color;
+}
+
+Color
+Sector::get_ambient_light() const
+{
+  return ambient_light;
+}
+
+const std::string&amp;
+Sector::get_filename () const
+{
+  return filename;
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/engine/sector.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/engine/sector.hpp (from rev 2463, trunk/windstille/src/sector.hpp)


Property changes on: trunk/windstille/src/engine/sector.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: trunk/windstille/src/entity.cpp
===================================================================
--- trunk/windstille/src/entity.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/entity.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,63 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;assert.h&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;entity.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;tile/tile_map.hpp&quot;
-
-Entity::Entity()
-  : velocity(0, 0),
-    useable(false)
-{
-  parent = 0;
-}
-
-Entity::~Entity()
-{
-}
-
-void
-Entity::set_pos(Vector pos)
-{
-  this-&gt;pos = pos;
-}
-
-bool
-Entity::on_ground() const
-{
-  return get_world ()-&gt;get_tilemap()-&gt;is_ground(pos.x, pos.y+16);
-}
-
-bool 
-Entity::in_wall() const
-{
-  return get_world ()-&gt;get_tilemap()-&gt;is_ground(pos.x, pos.y);
-}
-
-void
-Entity::set_parent(Entity* parent_)
-{
-  if (parent_ != this)
-    {
-      parent = parent_;
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/entity.hpp
===================================================================
--- trunk/windstille/src/entity.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/entity.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,82 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_ENTITY_HPP
-#define HEADER_WINDSTILLE_ENTITY_HPP
-
-#include &lt;boost/signal.hpp&gt;
-#include &quot;math/vector.hpp&quot;
-#include &quot;game_object.hpp&quot;
-#include &quot;collision/collision_object.hpp&quot;
-
-/** A GameObject which has a position and some other properties which
-    are shared among all/most things in the world */
-class Entity : public GameObject
-{
-private:
-  boost::signal&lt;void ()&gt; done; 
-
-protected:
-  friend class Physics;
-  bool on_ground() const;
-  bool in_wall() const;
-  
-  Vector pos;
-  Vector velocity;
-  bool useable;
-  std::string use_verb;
-  
-  Entity* parent;
-public:
-  Entity();
-  virtual ~Entity();
-   
-  virtual Vector get_pos() const
-  { return pos; }
-
-  virtual void set_pos(Vector pos);
-
-  /** Called once per frame to allow the object to draw itself */
-  virtual void draw(SceneContext&amp; gc) = 0;
-
-  /** Called, possible multiple times, per frame to let the object
-      update its position and properties */
-  virtual void update(float delta) = 0;
-
-  /** Called when the player uses this entity */
-  virtual void use() {}
-
-  /** Returns true if the entity is useable by the player */
-  virtual bool is_useable() const { return useable; }
-  std::string get_use_verb() const { return use_verb; }
-
-  /** Makes the objects (un)usable for the player */
-  void set_useable(bool t) { useable = t; }
-
-  void set_parent(Entity* parent_);
-
-  boost::signal&lt;void ()&gt;&amp; sig_done() { return done; }
-
-private:
-  Entity (const Entity&amp;);
-  Entity&amp; operator= (const Entity&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/game_object.cpp
===================================================================
--- trunk/windstille/src/game_object.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/game_object.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,25 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;game_object.hpp&quot;
-#include &quot;sector.hpp&quot;
-
-Sector* GameObject::world;
-
-
-/* EOF */

Deleted: trunk/windstille/src/game_object.hpp
===================================================================
--- trunk/windstille/src/game_object.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/game_object.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,108 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_GAME_OBJECT_HPP
-#define HEADER_WINDSTILLE_GAME_OBJECT_HPP
-
-#include &lt;string&gt;
-#include &quot;file_reader.hpp&quot;
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;refcounter.hpp&quot;
-
-class Sector;
-
-/**
- * This is the base class for all in-game objects. The sector class keeps a list
- * of all GameObject and periodically calls draw() and update() for them.
- */
-class GameObject : public RefCounter
-{
-private:
-  static Sector* world;
-  
-protected:
-  bool remove_flag;
-
-  /**
-   * name of the GameObject. Note: You should not change it anymore once the
-   * object has been added to a Sector
-   */
-  std::string name;
-
-  /** If a object is 'active = false' it will neither be drawn or updated */
-  bool active;
-public:
-  GameObject() : remove_flag(false), active(true) {}
-  virtual ~GameObject() {}
-
-  /**
-   * Set the remove flag to true which will result in the object being removed
-   * from the world till the next frame
-   */
-  void remove()
-  {
-    remove_flag = true;
-  }
-  /**
-   * Returns the state of the remove flag
-   */
-  bool is_removable() const
-  {
-    return remove_flag;
-  }
-
-  /**
-   * return the name of the object
-   * The name is guaranteed to stay the same during the whole lifetime of
-   * the object
-   */
-  const std::string&amp; get_name() const
-  {
-    return name;
-  }
-
-  /**
-   * Activate or Deactivate an object. A deactivated object is not updated
-   * or drawn until it is activated again
-   */
-  void set_active(bool a) { active = a; }
-  /**
-   * Returns true if the object is active, false if it is inactive
-   */
-  bool is_active() const { return active; }
-
-  /**
-   * The object should draw itself when this function is called
-   */
-  virtual void draw (SceneContext&amp; context) = 0;
-  /**
-   * This function is called from time to time to give the object a chance to
-   * update it's state. delta is the time that elapsed since the last
-   * update call in seconds. It is possible that there are multiple objects
-   * between 2 draw() calls or multiple draw() calls between 2 updates
-   */
-  virtual void update (float delta) = 0;
-    
-  static void set_world (Sector* w) { world = w; }
-  Sector* get_world () const
-  { return world; }
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/game_session.cpp
===================================================================
--- trunk/windstille/src/game_session.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/game_session.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -26,9 +26,9 @@
 
 #include &quot;menu_manager.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;console.hpp&quot;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
@@ -44,7 +44,7 @@
 #include &quot;particles/particle_system.hpp&quot;
 #include &quot;particles/spark_drawer.hpp&quot;
 #include &quot;particles/surface_drawer.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;
 #include &quot;conversation.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;

Modified: trunk/windstille/src/gui/automap.cpp
===================================================================
--- trunk/windstille/src/gui/automap.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/gui/automap.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -18,7 +18,7 @@
 
 #include &quot;display/surface_drawing_parameters.hpp&quot;
 #include &quot;input/controller.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;automap.hpp&quot;

Deleted: trunk/windstille/src/laser_pointer.cpp
===================================================================
--- trunk/windstille/src/laser_pointer.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/laser_pointer.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,150 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-#include &lt;config.h&gt;
-
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
-#include &quot;objects/player.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;tile/tile_map.hpp&quot;
-#include &quot;laser_pointer.hpp&quot;
-
-LaserPointer::LaserPointer()
-{
-  noise = Texture(&quot;images/noise2.png&quot;);
-  laserpointer = Sprite(&quot;images/laserpointer.sprite&quot;);
-  laserpointer_light = Sprite(&quot;images/laserpointer_light.sprite&quot;);
-  laserpointer_light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-  noise.set_wrap(GL_REPEAT);
-  noise.set_filter(GL_LINEAR);
-  
-  progress = 0.0f;
-  angle = 0.0f;
-}
-
-LaserPointer::~LaserPointer()
-{
-}
-
-static float find_max(float pos, float v)
-{
-  if (v == 0) 
-    return 0;
-  else if (v &lt; 0)
-    return fmodf(fmodf(pos, TILE_SIZE) + TILE_SIZE, TILE_SIZE)/fabsf(v);
-  else // if (v &gt; 0)
-    {
-      return fmodf(fmodf(-pos, TILE_SIZE) + TILE_SIZE, TILE_SIZE)/v;
-    }
-}
-
-void
-LaserPointer::draw(SceneContext&amp; sc)
-{
-  TileMap* tilemap = Sector::current()-&gt;get_tilemap();
-  Vector pos = Player::current()-&gt;get_pos();
-  pos.y -= 80;
-  Vector target; // = Sector::current()-&gt;get_collision_engine()-&gt;raycast(pos, angle);
-
-  // Ray position in Tile units
-  int x = static_cast&lt;int&gt;(pos.x / TILE_SIZE);
-  int y = static_cast&lt;int&gt;(pos.y / TILE_SIZE);
-
-  Vector direction(cos(angle) * 100.0f, sin(angle) * 100.0f);
-
-  int step_x = (direction.x &gt; 0) ? 1 : -1;
-  int step_y = (direction.y &gt; 0) ? 1 : -1;
-
-  float tMaxX = find_max(pos.x, direction.x);
-  float tMaxY = find_max(pos.y, direction.y);
-
-  float tDeltaX = (direction.x == 0) ? 0 : fabsf(TILE_SIZE / direction.x);
-  float tDeltaY = (direction.y == 0) ? 0 : fabsf(TILE_SIZE / direction.y);
-
-  float t = 0;
-
-  while(x &gt;= 0 &amp;&amp; x &lt; tilemap-&gt;get_width() &amp;&amp;
-        y &gt;= 0 &amp;&amp; y &lt; tilemap-&gt;get_height())
-    {
-      //sc.color().fill_rect(Rectf(Vector(x * TILE_SIZE, y * TILE_SIZE), Size(TILE_SIZE, TILE_SIZE)), 
-      //                     Color(1.0, 1.0, 1.0, 0.5), 500);
-
-      if (tilemap-&gt;get_pixel(x, y))
-        {
-          //return Vector(x * TILE_SIZE, y * TILE_SIZE);
-          goto done;
-        }
-
-      // move one tile
-      if (tMaxX &lt; tMaxY)
-        {
-          t = tMaxX;
-          tMaxX += tDeltaX;
-          x = x + step_x;
-        }
-      else 
-        {
-          t = tMaxY;
-          tMaxY += tDeltaY;
-          y = y + step_y;
-        }
-    }
-  
- done:
-  target = pos + Vector(t * direction.x, t * direction.y);
-  
-  Vector ray = target - pos;
-  VertexArrayDrawingRequest* array = new VertexArrayDrawingRequest(Vector(0,0), 10000,
-                                                                   sc.highlight().get_modelview());
-  array-&gt;set_mode(GL_LINES);
-  array-&gt;set_texture(noise);
-  array-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);
-
-  array-&gt;color(Color(1.0f, 0.0f, 0.0f, 1.0f));
-  array-&gt;texcoord(0, progress);
-  array-&gt;vertex(0, 0);
-
-  array-&gt;color(Color(1.0f, 0.0f, 0.0f, 1.0f));
-  array-&gt;texcoord((target - pos).magnitude()/256.0f, progress);
-  array-&gt;vertex(ray.x, ray.y);
-
-  sc.highlight().draw(array);
-  laserpointer.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-  sc.highlight().draw(laserpointer, ray);
-  sc.light().draw(laserpointer_light, ray);
-}
-
-void
-LaserPointer::update(float delta)
-{
-  progress += 0.1 * delta;
-}
-
-float
-LaserPointer::get_angle() const
-{
-  return angle;
-}
-
-void
-LaserPointer::set_angle(float a)
-{
-  angle = a;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/laser_pointer.hpp
===================================================================
--- trunk/windstille/src/laser_pointer.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/laser_pointer.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,52 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_LASER_POINTER_HPP
-#define HEADER_WINDSTILLE_LASER_POINTER_HPP
-
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;display/texture.hpp&quot;
-#include &quot;game_object.hpp&quot;
-
-/** Simple class that generates a laser for pointing at objects */
-class LaserPointer : public GameObject
-{
-private:
-  Texture noise;
-  Sprite  laserpointer;
-  Sprite  laserpointer_light;
-  float   progress;
-  float   angle;
-
-public:
-  LaserPointer();
-  ~LaserPointer();
-
-  void draw(SceneContext&amp; sc);
-  void update(float delta);
-
-  float get_angle() const;
-  void  set_angle(float angle);
-private:
-  LaserPointer (const LaserPointer&amp;);
-  LaserPointer&amp; operator= (const LaserPointer&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/menu_manager.cpp
===================================================================
--- trunk/windstille/src/menu_manager.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/menu_manager.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -30,7 +30,7 @@
 #include &quot;gui/text_view.hpp&quot;
 #include &quot;particle_viewer.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
 #include &quot;sprite3dview.hpp&quot;
 #include &quot;geometry_test.hpp&quot;

Modified: trunk/windstille/src/objects/background_gradient.hpp
===================================================================
--- trunk/windstille/src/objects/background_gradient.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/background_gradient.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_OBJECTS_BACKGROUND_GRADIENT_HPP
 #define HEADER_WINDSTILLE_OBJECTS_BACKGROUND_GRADIENT_HPP
 
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 
 /** */
 class BackgroundGradient : public GameObject

Modified: trunk/windstille/src/objects/bomb.cpp
===================================================================
--- trunk/windstille/src/objects/bomb.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/bomb.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -17,7 +17,7 @@
 */
 
 #include &quot;globals.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;bomb.hpp&quot;
 
 Bomb::Bomb(int x, int y)

Modified: trunk/windstille/src/objects/bomb.hpp
===================================================================
--- trunk/windstille/src/objects/bomb.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/bomb.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -20,7 +20,7 @@
 #define HEADER_WINDSTILLE_OBJECTS_BOMB_HPP
 
 #include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 
 /** */
 class Bomb : public GameObject

Modified: trunk/windstille/src/objects/box.hpp
===================================================================
--- trunk/windstille/src/objects/box.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/box.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,9 +19,9 @@
 #ifndef HEADER_WINDSTILLE_BOX_HPP
 #define HEADER_WINDSTILLE_BOX_HPP
 
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 #include &quot;collision/collision_object.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;particles/particle_system.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 

Modified: trunk/windstille/src/objects/character.cpp
===================================================================
--- trunk/windstille/src/objects/character.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/character.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -17,11 +17,11 @@
 */
 
 #include &quot;character.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;game_session.hpp&quot;
 #include &quot;scripting/wrapper.interface.hpp&quot;
 #include &quot;dialog_manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 #include &quot;physfs/physfs_stream.hpp&quot;
 #include &quot;console.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;

Modified: trunk/windstille/src/objects/character.hpp
===================================================================
--- trunk/windstille/src/objects/character.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/character.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_CHARACTER_HPP
 #define HEADER_WINDSTILLE_CHARACTER_HPP
 
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 #include &quot;sprite3d/sprite3d.hpp&quot;
 
 class Character : public Entity

Modified: trunk/windstille/src/objects/elevator.cpp
===================================================================
--- trunk/windstille/src/objects/elevator.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/elevator.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -18,7 +18,7 @@
 
 #include &lt;stdexcept&gt;
 #include &quot;elevator.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 

Modified: trunk/windstille/src/objects/elevator.hpp
===================================================================
--- trunk/windstille/src/objects/elevator.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/elevator.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_ELEVATOR_HPP
 #define HEADER_WINDSTILLE_ELEVATOR_HPP
 
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 
 /** */

Modified: trunk/windstille/src/objects/grenade.cpp
===================================================================
--- trunk/windstille/src/objects/grenade.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/grenade.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -16,9 +16,9 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
+#include &quot;engine/sector.hpp&quot;
+#include &quot;collision/collision_engine.hpp&quot;
 #include &quot;grenade.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
 
 Grenade::Grenade()
   : sprite(&quot;models/objects/grenade/grenade.wsprite&quot;), physics(this)

Modified: trunk/windstille/src/objects/grenade.hpp
===================================================================
--- trunk/windstille/src/objects/grenade.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/grenade.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -18,8 +18,8 @@
 #ifndef HEADER_WINDSTILLE_GRENADE_HPP
 #define HEADER_WINDSTILLE_GRENADE_HPP
 
-#include &quot;entity.hpp&quot;
-#include &quot;physics.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
+#include &quot;engine/physics.hpp&quot;
 #include &quot;sprite3d/sprite3d.hpp&quot;
 #include &lt;memory&gt;
 

Modified: trunk/windstille/src/objects/hedgehog.cpp
===================================================================
--- trunk/windstille/src/objects/hedgehog.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/hedgehog.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -18,7 +18,7 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;player.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;hedgehog.hpp&quot;
 
 Hedgehog::Hedgehog(FileReader&amp; props)

Modified: trunk/windstille/src/objects/hedgehog.hpp
===================================================================
--- trunk/windstille/src/objects/hedgehog.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/hedgehog.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_OBJECTS_HEDGEHOG_HPP
 #define HEADER_WINDSTILLE_OBJECTS_HEDGEHOG_HPP
 
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 
 class Hedgehog : public Entity
 {

Copied: trunk/windstille/src/objects/laser_pointer.cpp (from rev 2463, trunk/windstille/src/laser_pointer.cpp)
===================================================================
--- trunk/windstille/src/laser_pointer.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/laser_pointer.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,150 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+#include &lt;config.h&gt;
+
+#include &quot;display/vertex_array_drawing_request.hpp&quot;
+#include &quot;objects/player.hpp&quot;
+#include &quot;collision/collision_engine.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
+#include &quot;tile/tile_map.hpp&quot;
+#include &quot;laser_pointer.hpp&quot;
+
+LaserPointer::LaserPointer()
+{
+  noise = Texture(&quot;images/noise2.png&quot;);
+  laserpointer = Sprite(&quot;images/laserpointer.sprite&quot;);
+  laserpointer_light = Sprite(&quot;images/laserpointer_light.sprite&quot;);
+  laserpointer_light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
+  noise.set_wrap(GL_REPEAT);
+  noise.set_filter(GL_LINEAR);
+  
+  progress = 0.0f;
+  angle = 0.0f;
+}
+
+LaserPointer::~LaserPointer()
+{
+}
+
+static float find_max(float pos, float v)
+{
+  if (v == 0) 
+    return 0;
+  else if (v &lt; 0)
+    return fmodf(fmodf(pos, TILE_SIZE) + TILE_SIZE, TILE_SIZE)/fabsf(v);
+  else // if (v &gt; 0)
+    {
+      return fmodf(fmodf(-pos, TILE_SIZE) + TILE_SIZE, TILE_SIZE)/v;
+    }
+}
+
+void
+LaserPointer::draw(SceneContext&amp; sc)
+{
+  TileMap* tilemap = Sector::current()-&gt;get_tilemap();
+  Vector pos = Player::current()-&gt;get_pos();
+  pos.y -= 80;
+  Vector target; // = Sector::current()-&gt;get_collision_engine()-&gt;raycast(pos, angle);
+
+  // Ray position in Tile units
+  int x = static_cast&lt;int&gt;(pos.x / TILE_SIZE);
+  int y = static_cast&lt;int&gt;(pos.y / TILE_SIZE);
+
+  Vector direction(cos(angle) * 100.0f, sin(angle) * 100.0f);
+
+  int step_x = (direction.x &gt; 0) ? 1 : -1;
+  int step_y = (direction.y &gt; 0) ? 1 : -1;
+
+  float tMaxX = find_max(pos.x, direction.x);
+  float tMaxY = find_max(pos.y, direction.y);
+
+  float tDeltaX = (direction.x == 0) ? 0 : fabsf(TILE_SIZE / direction.x);
+  float tDeltaY = (direction.y == 0) ? 0 : fabsf(TILE_SIZE / direction.y);
+
+  float t = 0;
+
+  while(x &gt;= 0 &amp;&amp; x &lt; tilemap-&gt;get_width() &amp;&amp;
+        y &gt;= 0 &amp;&amp; y &lt; tilemap-&gt;get_height())
+    {
+      //sc.color().fill_rect(Rectf(Vector(x * TILE_SIZE, y * TILE_SIZE), Size(TILE_SIZE, TILE_SIZE)), 
+      //                     Color(1.0, 1.0, 1.0, 0.5), 500);
+
+      if (tilemap-&gt;get_pixel(x, y))
+        {
+          //return Vector(x * TILE_SIZE, y * TILE_SIZE);
+          goto done;
+        }
+
+      // move one tile
+      if (tMaxX &lt; tMaxY)
+        {
+          t = tMaxX;
+          tMaxX += tDeltaX;
+          x = x + step_x;
+        }
+      else 
+        {
+          t = tMaxY;
+          tMaxY += tDeltaY;
+          y = y + step_y;
+        }
+    }
+  
+ done:
+  target = pos + Vector(t * direction.x, t * direction.y);
+  
+  Vector ray = target - pos;
+  VertexArrayDrawingRequest* array = new VertexArrayDrawingRequest(Vector(0,0), 10000,
+                                                                   sc.highlight().get_modelview());
+  array-&gt;set_mode(GL_LINES);
+  array-&gt;set_texture(noise);
+  array-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);
+
+  array-&gt;color(Color(1.0f, 0.0f, 0.0f, 1.0f));
+  array-&gt;texcoord(0, progress);
+  array-&gt;vertex(0, 0);
+
+  array-&gt;color(Color(1.0f, 0.0f, 0.0f, 1.0f));
+  array-&gt;texcoord((target - pos).magnitude()/256.0f, progress);
+  array-&gt;vertex(ray.x, ray.y);
+
+  sc.highlight().draw(array);
+  laserpointer.set_blend_func(GL_SRC_ALPHA, GL_ONE);
+  sc.highlight().draw(laserpointer, ray);
+  sc.light().draw(laserpointer_light, ray);
+}
+
+void
+LaserPointer::update(float delta)
+{
+  progress += 0.1 * delta;
+}
+
+float
+LaserPointer::get_angle() const
+{
+  return angle;
+}
+
+void
+LaserPointer::set_angle(float a)
+{
+  angle = a;
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/objects/laser_pointer.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/laser_pointer.hpp (from rev 2463, trunk/windstille/src/laser_pointer.hpp)
===================================================================
--- trunk/windstille/src/laser_pointer.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/laser_pointer.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,52 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_LASER_POINTER_HPP
+#define HEADER_WINDSTILLE_LASER_POINTER_HPP
+
+#include &quot;sprite2d/sprite.hpp&quot;
+#include &quot;display/texture.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
+
+/** Simple class that generates a laser for pointing at objects */
+class LaserPointer : public GameObject
+{
+private:
+  Texture noise;
+  Sprite  laserpointer;
+  Sprite  laserpointer_light;
+  float   progress;
+  float   angle;
+
+public:
+  LaserPointer();
+  ~LaserPointer();
+
+  void draw(SceneContext&amp; sc);
+  void update(float delta);
+
+  float get_angle() const;
+  void  set_angle(float angle);
+private:
+  LaserPointer (const LaserPointer&amp;);
+  LaserPointer&amp; operator= (const LaserPointer&amp;);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/objects/laser_pointer.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/windstille/src/objects/liquid.hpp
===================================================================
--- trunk/windstille/src/objects/liquid.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/liquid.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -20,7 +20,7 @@
 #define HEADER_WINDSTILLE_LIQUID_HPP
 
 #include &lt;vector&gt;
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 
 /** */
 class Liquid : public Entity

Modified: trunk/windstille/src/objects/nightvision.hpp
===================================================================
--- trunk/windstille/src/objects/nightvision.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/nightvision.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 
 #include &quot;display/texture.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 
 // FIXME: shouldn't really be a game object, but makes testing easier
 class Nightvision : public GameObject

Copied: trunk/windstille/src/objects/pistol.cpp (from rev 2463, trunk/windstille/src/pistol.cpp)


Property changes on: trunk/windstille/src/objects/pistol.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/pistol.hpp (from rev 2463, trunk/windstille/src/pistol.hpp)


Property changes on: trunk/windstille/src/objects/pistol.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Modified: trunk/windstille/src/objects/player.cpp
===================================================================
--- trunk/windstille/src/objects/player.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/player.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -18,7 +18,7 @@
 
 #include &lt;boost/bind.hpp&gt;
 #include &quot;tile/tile_map.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;controller_def.hpp&quot;

Modified: trunk/windstille/src/objects/player.hpp
===================================================================
--- trunk/windstille/src/objects/player.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/player.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -26,7 +26,7 @@
 #include &quot;sound/sound_source.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 #include &quot;globals.hpp&quot;
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 #include &quot;ref.hpp&quot;
 #include &quot;display/surface.hpp&quot;
 

Modified: trunk/windstille/src/objects/scriptable_object.cpp
===================================================================
--- trunk/windstille/src/objects/scriptable_object.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/scriptable_object.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -20,7 +20,7 @@
 #include &quot;globals.hpp&quot;
 #include &quot;scriptable_object.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 
 ScriptableObject::ScriptableObject(FileReader&amp; props)
   : z_pos(50),

Modified: trunk/windstille/src/objects/scriptable_object.hpp
===================================================================
--- trunk/windstille/src/objects/scriptable_object.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/scriptable_object.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 #define HEADER_WINDSTILLE_SCRIPTABLE_OBJECT_HPP
 
 #include &lt;string&gt;
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 
 /** Can represent any generic object that the player may see or interact with that

Modified: trunk/windstille/src/objects/shockwave.hpp
===================================================================
--- trunk/windstille/src/objects/shockwave.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/shockwave.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 
 #include &quot;display/shader_program.hpp&quot;
 #include &quot;display/texture.hpp&quot;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 
 /** */
 class Shockwave : public GameObject

Modified: trunk/windstille/src/objects/spider_mine.hpp
===================================================================
--- trunk/windstille/src/objects/spider_mine.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/spider_mine.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_OBJECTS_SPIDER_MINE_HPP
 #define HEADER_WINDSTILLE_OBJECTS_SPIDER_MINE_HPP
 
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
 
 class SpiderMine : public Entity

Modified: trunk/windstille/src/objects/swarm.cpp
===================================================================
--- trunk/windstille/src/objects/swarm.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/swarm.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -18,7 +18,7 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;player.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;hedgehog.hpp&quot;
 #include &quot;game_session.hpp&quot;
 #include &quot;view.hpp&quot;

Modified: trunk/windstille/src/objects/swarm.hpp
===================================================================
--- trunk/windstille/src/objects/swarm.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/swarm.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,7 +19,7 @@
 #ifndef HEADER_WINDSTILLE_OBJECTS_SWARM_HPP
 #define HEADER_WINDSTILLE_OBJECTS_SWARM_HPP
 
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 
 class SwarmAgent
 {

Modified: trunk/windstille/src/objects/test_object.hpp
===================================================================
--- trunk/windstille/src/objects/test_object.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/test_object.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -20,7 +20,7 @@
 #define HEADER_WINDSTILLE_OBJECTS_TEST_OBJECT_HPP
 
 #include &lt;vector&gt;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 #include &quot;sprite3d/sprite3d.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 

Copied: trunk/windstille/src/objects/trigger.cpp (from rev 2463, trunk/windstille/src/trigger.cpp)
===================================================================
--- trunk/windstille/src/trigger.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/trigger.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,84 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#include &lt;stdexcept&gt;
+#include &lt;list&gt;
+#include &quot;engine/sector.hpp&quot;
+#include &quot;trigger.hpp&quot;
+#include &quot;objects/player.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
+
+Trigger::Trigger(FileReader&amp; props)
+  : triggered(false), one_time_trigger(false)
+{
+  float x = -1;
+  float y = -1;
+  float width = -1;
+  float height = -1;
+  
+  props.get(&quot;x&quot;, x);
+  props.get(&quot;y&quot;, y);
+  props.get(&quot;width&quot;, width);
+  props.get(&quot;height&quot;, height);
+  props.get(&quot;script&quot;, script);
+  props.get(&quot;one-time-trigger&quot;, one_time_trigger);
+  props.print_unused_warnings(&quot;trigger&quot;);
+
+  if(x &lt; 0 || y &lt; 0 || width &lt; 0 || height &lt; 0)
+    throw std::runtime_error(&quot;Invalid or missing area in Trigger object&quot;);
+ 
+  area.left = x;
+  area.top = y;
+  area.right = area.left + width;
+  area.bottom = area.top + height;
+}
+
+Trigger::~Trigger()
+{
+}
+
+void
+Trigger::draw (SceneContext&amp; )
+{
+}
+
+void
+Trigger::update (float )
+{
+  //FIXME use proper collision detection
+  Player* player = Player::current();
+  if(!area.is_inside(player-&gt;get_pos())) {
+    last_trigger = false;
+    return;
+  }
+  
+  if(triggered &amp;&amp; one_time_trigger)
+    return;
+
+  if(last_trigger == false) {
+    triggered = true;
+    try {
+      script_manager-&gt;run_script(script, &quot;TriggerObject&quot;);
+    } catch(std::exception&amp; e) {
+      std::cerr &lt;&lt; &quot;Couldn't run trigger-script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
+    }
+  }
+  last_trigger = true;
+}
+
+/* EOF */


Property changes on: trunk/windstille/src/objects/trigger.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/trigger.hpp (from rev 2463, trunk/windstille/src/trigger.hpp)
===================================================================
--- trunk/windstille/src/trigger.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/trigger.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -0,0 +1,47 @@
+/*
+**  Windstille - A Sci-Fi Action-Adventure Game
+**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+**
+**  This program is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU General Public License as published by
+**  the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**  
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+**  
+**  You should have received a copy of the GNU General Public License
+**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
+*/
+
+#ifndef HEADER_WINDSTILLE_TRIGGER_HPP
+#define HEADER_WINDSTILLE_TRIGGER_HPP
+
+#include &lt;vector&gt;
+#include &quot;engine/game_object.hpp&quot;
+
+/** */
+class Trigger : public GameObject
+{
+private:
+  Rectf area;
+  std::string script;
+  /// has the trigger been activated at least once
+  bool triggered;
+  /// trigger active in last frame
+  bool last_trigger;
+  bool one_time_trigger;
+  
+public:
+  Trigger(FileReader&amp; props);
+  virtual ~Trigger();
+
+  void draw (SceneContext&amp; gc);
+  void update (float delta);
+};
+
+#endif
+
+/* EOF */


Property changes on: trunk/windstille/src/objects/trigger.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Modified: trunk/windstille/src/objects/vrdummy.hpp
===================================================================
--- trunk/windstille/src/objects/vrdummy.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/objects/vrdummy.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 
 #include &quot;sprite3d/sprite3d.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 
 /** */
 class VRDummy : public Entity

Modified: trunk/windstille/src/particles/particle_system.hpp
===================================================================
--- trunk/windstille/src/particles/particle_system.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/particles/particle_system.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -23,7 +23,7 @@
 
 #include &quot;color.hpp&quot;
 #include &quot;drawer.hpp&quot;
-#include &quot;entity.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
 
 class SceneContext;
 class Randomizer;

Deleted: trunk/windstille/src/physics.cpp
===================================================================
--- trunk/windstille/src/physics.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/physics.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,108 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;boost/bind.hpp&gt;
-#include &quot;physics.hpp&quot;
-
-Physics::Physics(Entity* entity)
-  : entity(entity)
-{
-  mass = 200.0;
-  bounciness = 1.0;
-  air_friction = 0.0;
-  contact_friction = 0.0;
-}
-
-Physics::~Physics()
-{
-}
-
-void
-Physics::register_collobj(CollisionObject&amp; object)
-{
-  object.sig_collision().connect(boost::bind(&amp;Physics::collision, this, _1));
-}
-
-void
-Physics::collision(const CollisionData&amp; data)
-{
-  GameObject* other_object = data.object2-&gt;get_game_object();
-
-  const Physics* physics = dynamic_cast&lt;const Physics*&gt; (other_object);
-  if(physics)
-  {
-    elastic_collision(data, *physics);
-    data.object1-&gt;set_velocity(velocity());
-    return;
-  }
-
-  // assume fix object...
-  bounce_collision(data);
-  data.object1-&gt;set_velocity(velocity());
-}
-
-void
-Physics::elastic_collision(const CollisionData&amp; data, const Physics&amp; other)
-{
-  printf(&quot;elastic collision.\n&quot;);
-  // we could calculate this cheaper if we'd do it once for both objects and not
-  // each object on it's own...
-
-  Vector other_collision_vel 
-    = data.direction * (other.velocity() * data.direction);
-  Vector collision_vel
-    = data.direction * (velocity() * data.direction);
-  
-  Vector new_v = collision_vel * (mass - other.mass);
-  new_v += other_collision_vel * (2 * other.mass);
-  new_v /= mass + other.mass;
-
-  velocity() += new_v - collision_vel;  
-  //force += (new_v - collision_vel) * mass / data.delta;
-
-  // TODO apply friction here?
-}
-
-void
-Physics::bounce_collision(const CollisionData&amp; data)
-{
-  printf(&quot;bounce collision.\n&quot;);
-  Vector collision_vel = data.direction * (velocity() * data.direction);
-
-  velocity() -= collision_vel * (1.0 + bounciness);
-  //force -= collision_vel * (1.0f + bounciness) * mass / data.delta;
-
-  // TODO apply friction
-}
-
-void
-Physics::update(float delta)
-{
-  // add gravity force (TODO make it configurable per Sector)
-  force += Vector(0, 9.81 * mass);
-
-  //force -= velocity() * air_friction;
-  
-  Vector acceleration = force / mass;
-  velocity() += acceleration * delta;
-  pos() += velocity() * delta;
-
-  force = Vector(0, 0);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/physics.hpp
===================================================================
--- trunk/windstille/src/physics.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/physics.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,55 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_PHYSICS_HPP
-#define HEADER_WINDSTILLE_PHYSICS_HPP
-
-#include &quot;collision/collision_data.hpp&quot;
-#include &quot;entity.hpp&quot;
-
-class Physics
-{
-public:
-  Physics(Entity* entity);
-  ~Physics();
-
-  void update(float delta);
-  void register_collobj(CollisionObject&amp; object);
-
-  Vector&amp; pos() const
-  { return entity-&gt;pos; }
-  Vector&amp; velocity() const
-  { return entity-&gt;velocity; }
-
-private:
-  void collision(const CollisionData&amp; data);
-  
-  void elastic_collision(const CollisionData&amp; data, const Physics&amp; other);
-  void bounce_collision(const CollisionData&amp; data);
-
-  Entity* entity;
-  float mass;
-  float bounciness;
-  Vector force;
-  float air_friction;
-  float contact_friction;
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/pistol.cpp
===================================================================
--- trunk/windstille/src/pistol.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/pistol.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,57 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;laser_pointer.hpp&quot;
-#include &quot;pistol.hpp&quot;
-
-Pistol::Pistol()
-  : laser_pointer(0)
-{
-  laser_pointer = new LaserPointer();
-  sprite = Sprite3D(&quot;models/objects/pistol/pistol.wsprite&quot;);
-}
-
-Pistol::~Pistol()
-{
-  delete laser_pointer;
-}
-
-void
-Pistol::draw(SceneContext&amp; sc)
-{
-  sprite.draw(sc.color(), Vector(0, 0), 1000);
-  // Disabled for now and done in the player class
-  //if(laser_pointer)
-  //  laser_pointer-&gt;draw(sc);
-}
-
-void
-Pistol::update(float delta)
-{
-  if(laser_pointer)
-    laser_pointer-&gt;update(delta);
-
-  sprite.update(delta);
-}
-
-void
-Pistol::fire(bool )
-{
-}
-
-/* EOF */

Deleted: trunk/windstille/src/pistol.hpp
===================================================================
--- trunk/windstille/src/pistol.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/pistol.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,47 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_PISTOL_HPP
-#define HEADER_WINDSTILLE_PISTOL_HPP
-
-#include &quot;sprite3d/sprite3d.hpp&quot;
-#include &quot;weapon.hpp&quot;
-
-class LaserPointer;
-
-class Pistol : public Weapon
-{
-private:
-  Sprite3D sprite;
-  //LaserPointer* laser_pointer;
-
-public:
-  LaserPointer* laser_pointer;
-  
-  Pistol();
-  virtual ~Pistol();
-  
-  void draw(SceneContext&amp; context);
-  void update(float delta);
-
-  void fire(bool enable);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/script_manager.cpp
===================================================================
--- trunk/windstille/src/script_manager.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/script_manager.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,240 +0,0 @@
-#include &quot;script_manager.hpp&quot;
-
-#include &lt;stdarg.h&gt;
-#include &lt;stdexcept&gt;
-#include &lt;sstream&gt;
-#include &lt;fstream&gt;
-#include &lt;sqstdio.h&gt;
-#include &lt;sqstdaux.h&gt;
-#include &lt;sqstdblob.h&gt;
-#include &lt;sqstdsystem.h&gt;
-#include &lt;sqstdmath.h&gt;
-#include &lt;sqstdstring.h&gt;
-
-#include &quot;console.hpp&quot;
-#include &quot;timer.hpp&quot;
-#include &quot;scripting/wrapper.hpp&quot;
-#include &quot;scripting/util.hpp&quot;
-#include &quot;scripting/squirrel_error.hpp&quot;
-#include &quot;physfs/physfs_stream.hpp&quot;
-
-using namespace scripting;
-
-ScriptManager* script_manager = 0;
-
-static void printfunc(HSQUIRRELVM, const char* str, ...)
-{
-  char buf[4096];
-  va_list arglist; 
-  va_start(arglist, str); 
-  vsprintf(buf, str, arglist);
-  console &lt;&lt; (char*)buf;
-  puts(buf);
-  va_end(arglist); 
-}
-
-ScriptManager::ScriptManager()
-{
-  v = sq_open(1024);
-  if(v == 0)
-    throw std::runtime_error(&quot;Couldn't initialize squirrel vm&quot;);
-
-  // register default error handlers
-  sqstd_seterrorhandlers(v);
-  // register squirrel libs
-  sq_pushroottable(v);
-  if(sqstd_register_bloblib(v) &lt; 0)
-    throw SquirrelError(v, &quot;Couldn't register blob lib&quot;);
-  if(sqstd_register_iolib(v) &lt; 0)
-    throw SquirrelError(v, &quot;Couldn't register io lib&quot;);
-  if(sqstd_register_systemlib(v) &lt; 0)
-    throw SquirrelError(v, &quot;Couldn't register system lib&quot;);
-  if(sqstd_register_mathlib(v) &lt; 0)
-    throw SquirrelError(v, &quot;Couldn't register math lib&quot;);
-  if(sqstd_register_stringlib(v) &lt; 0)
-    throw SquirrelError(v, &quot;Couldn't register string lib&quot;);
-
-  // register print function
-  sq_setprintfunc(v, printfunc);
-  
-  // register windstille API
-  scripting::register_windstille_wrapper(v);
-}
-
-ScriptManager::~ScriptManager()
-{
-  for(SquirrelVMs::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i)
-    sq_release(v, &amp;(i-&gt;vm_obj));
-
-  sq_close(v);
-}
-
-static SQInteger squirrel_read_char(SQUserPointer file)
-{
-  std::istream* in = reinterpret_cast&lt;std::istream*&gt; (file);
-  char c = in-&gt;get();
-  if(in-&gt;eof())
-    return 0;    
-  return c;
-}
-
-void
-ScriptManager::run_script_file(const std::string&amp; filename)
-{
-  IFileStream in(filename);
-  run_script(in, filename);
-}
-
-void
-ScriptManager::run_script(const std::string&amp; the_string,
-    const std::string&amp; sourcename)
-{
-  std::istringstream stream(the_string);
-  run_script(stream, sourcename);
-}
-
-void
-ScriptManager::run_script(std::istream&amp; in, const std::string&amp; sourcename)
-{
-  HSQUIRRELVM vm = sq_newthread(v, 1024);
-  if(vm == 0)
-    throw SquirrelError(v, &quot;Couldn't create new VM&quot;);
-
-  // retrieve reference to thread from stack and increase refcounter
-  HSQOBJECT vm_obj;
-  sq_resetobject(&amp;vm_obj);
-  if(sq_getstackobj(v, -1, &amp;vm_obj) &lt; 0)
-    throw SquirrelError(v, &quot;Couldn't get coroutine vm from stack&quot;);
-  sq_addref(v, &amp;vm_obj);
-  sq_pop(v, 1);
-  
-  if(sq_compile(vm, squirrel_read_char, &amp;in, sourcename.c_str(), true) &lt; 0)
-    throw SquirrelError(vm, &quot;Couldn't parse script&quot;);
-	
-  squirrel_vms.push_back(SquirrelVM(sourcename, vm, vm_obj));
-  already_run_scripts[sourcename] = true;
-
-  // FIXME: a script that gets run shouldn't have direct access to the root table
-  // <A HREF="http://wiki.squirrel-lang.org/default.aspx/SquirrelWiki/MultiVMs.html">http://wiki.squirrel-lang.org/default.aspx/SquirrelWiki/MultiVMs.html</A>
-  sq_pushroottable(vm);
-  //sq_clone(vm, -1); //FIXME
-  if(sq_call(vm, 1, false, true) &lt; 0)
-    throw SquirrelError(vm, &quot;Couldn't start script&quot;);
-}
-
-void
-ScriptManager::update()
-{
-  for(SquirrelVMs::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ) {
-    SquirrelVM&amp; squirrel_vm = *i;
-    int vm_state = sq_getvmstate(squirrel_vm.vm);
-    
-    if(vm_state == SQ_VMSTATE_SUSPENDED &amp;&amp; squirrel_vm.wakeup_time &gt; 0 &amp;&amp; game_time &gt;= squirrel_vm.wakeup_time) 
-      {
-        squirrel_vm.waiting_for_events = WakeupData(NO_EVENT);
-        try {
-          if(sq_wakeupvm(squirrel_vm.vm, false, false, true) &lt; 0) {
-            throw SquirrelError(squirrel_vm.vm, &quot;Couldn't resume script&quot;);
-          }
-        } catch(std::exception&amp; e) {
-          std::cerr &lt;&lt; &quot;Problem executing script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-          sq_release(v, &amp;squirrel_vm.vm_obj);
-          i = squirrel_vms.erase(i);
-          continue;
-        }
-      }
-	
-    if (vm_state != SQ_VMSTATE_SUSPENDED)
-      {
-        sq_release(v, &amp;(squirrel_vm.vm_obj));
-        i = squirrel_vms.erase(i);
-      }
-    else
-      {
-        ++i;
-      }
-  }
-}
-
-void
-ScriptManager::set_wakeup_event(HSQUIRRELVM vm, WakeupData event, float timeout)
-{
-  assert(event.type &gt;= 0 &amp;&amp; event.type &lt; MAX_WAKEUP_EVENT_COUNT);
-  // find the VM in the list and update it
-  for(SquirrelVMs::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i) {
-    SquirrelVM&amp; squirrel_vm = *i;
-    if(squirrel_vm.vm == vm) 
-      {
-        squirrel_vm.waiting_for_events = event;
-
-        if(timeout &lt; 0) {
-          squirrel_vm.wakeup_time = -1;
-        } else {
-          squirrel_vm.wakeup_time = game_time + timeout;
-        }
-        return;
-      }
-  }
-}
-
-void
-ScriptManager::fire_wakeup_event(WakeupData  event)
-{
-  assert(event.type &gt;= 0 &amp;&amp; event.type &lt; MAX_WAKEUP_EVENT_COUNT);
-  for(SquirrelVMs::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i) 
-    {
-      SquirrelVM&amp; vm = *i;
-      if(vm.waiting_for_events.type == event.type &amp;&amp; vm.waiting_for_events.type != NO_EVENT)
-        {
-          switch (event.type)
-            {
-            case GAMEOBJECT_DONE:
-              if (vm.waiting_for_events.game_object == event.game_object)
-                {
-                  vm.wakeup_time = game_time;
-                }
-              break;
-
-            default:
-              vm.wakeup_time = game_time;
-              break;
-            }
-        }
-    }
-}
-
-void
-ScriptManager::set_wakeup_event(HSQUIRRELVM vm, WakeupEvent event, float timeout)
-{
-  set_wakeup_event(vm, WakeupData(event), timeout);
-}
-
-void
-ScriptManager::fire_wakeup_event(WakeupEvent event)
-{
-  fire_wakeup_event(WakeupData(event));
-}
-
-bool ScriptManager::run_before(HSQUIRRELVM vm)
-{
-  std::string name;
-  for(SquirrelVMs::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i) {
-    if (i-&gt;vm == vm)
-      name = i-&gt;name;
-  }
-  
-  if (already_run_scripts.find(name) == already_run_scripts.end())
-    return false;
-  return true;
-}
-
-ScriptManager::SquirrelVM::SquirrelVM(const std::string&amp; arg_name, HSQUIRRELVM arg_vm, HSQOBJECT arg_obj)
-  : name(arg_name),
-    vm(arg_vm), 
-    vm_obj(arg_obj)
-{
-  waiting_for_events = WakeupData(NO_EVENT);
-  wakeup_time        = 0;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/script_manager.hpp
===================================================================
--- trunk/windstille/src/script_manager.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/script_manager.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,107 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SCRIPT_MANAGER_HPP
-#define HEADER_WINDSTILLE_SCRIPT_MANAGER_HPP
-
-#include &lt;vector&gt;
-#include &lt;list&gt;
-#include &lt;map&gt;
-#include &lt;squirrel.h&gt;
-#include &lt;iostream&gt;
-#include &quot;timer.hpp&quot;
-#include &quot;scripting/wrapper.hpp&quot;
-#include &quot;scripting/util.hpp&quot;
-
-/**
- * This class is responsible for managing all running squirrel threads
- * (called coroutines by others)
- * It contains functions for loading and starting script, keeps a list of
- * suspended scripts and receives wakeup events for them
- */
-class ScriptManager
-{
-public:
-  ScriptManager();
-  ~ScriptManager();
-
-  void update();
-
-  void run_script_file(const std::string&amp; filename);
-  void run_script(const std::string&amp; string, const std::string&amp; sourcename);
-  void run_script(std::istream&amp; in, const std::string&amp; sourcename);
-
-  HSQUIRRELVM get_vm() const
-  {
-    return v;
-  }
-
-  enum WakeupEvent {
-    NO_EVENT,
-    TIME,
-    DIALOG_CLOSED,
-    CONVERSATION_CLOSED,
-    FADE_DONE,
-    CAMERA_DONE,
-    GAMEOBJECT_DONE,
-    MAX_WAKEUP_EVENT_COUNT
-  };
-
-  struct WakeupData {
-    explicit WakeupData() : type(NO_EVENT) {}
-    explicit WakeupData(WakeupEvent type_) : type(type_) {}
-
-    WakeupEvent type;
-    
-    union {
-      // GAMEOBJECT_DONE
-      GameObject* game_object;
-    };
-  };
-
-  void set_wakeup_event(HSQUIRRELVM vm, WakeupEvent event, float timeout = -1);
-  void set_wakeup_event(HSQUIRRELVM vm, WakeupData  event, float timeout = -1);
-  void fire_wakeup_event(WakeupEvent event);
-  void fire_wakeup_event(WakeupData  event);
-  
-  bool run_before(HSQUIRRELVM vm);
-
-private:
-  class SquirrelVM
-  {
-  public:
-    SquirrelVM(const std::string&amp; arg_name, HSQUIRRELVM arg_vm, HSQOBJECT arg_obj);
-    std::string name;
-    HSQUIRRELVM vm;
-    HSQOBJECT   vm_obj;
-    float       wakeup_time;
-    WakeupData  waiting_for_events;
-  };
-  
-  typedef std::list&lt;SquirrelVM&gt; SquirrelVMs;
-  SquirrelVMs squirrel_vms;
-  std::map&lt;std::string, bool&gt; already_run_scripts;
-
-  HSQUIRRELVM v;
-};
-
-extern ScriptManager* script_manager;
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/scripting/game_objects.cpp
===================================================================
--- trunk/windstille/src/scripting/game_objects.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/scripting/game_objects.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -17,8 +17,8 @@
 */
 
 #include &quot;wrapper.interface.hpp&quot;
-#include &quot;entity.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/entity.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;game_objects.hpp&quot;
 
 namespace scripting {

Modified: trunk/windstille/src/scripting/game_objects.hpp
===================================================================
--- trunk/windstille/src/scripting/game_objects.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/scripting/game_objects.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -20,7 +20,7 @@
 #define HEADER_WINDSTILLE_SCRIPTING_GAME_OBJECTS_HPP
 
 #ifndef SCRIPTING_API
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 #include &quot;objects/test_object.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 #include &quot;objects/scriptable_object.hpp&quot;

Modified: trunk/windstille/src/scripting/interface.cpp
===================================================================
--- trunk/windstille/src/scripting/interface.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/scripting/interface.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -24,10 +24,10 @@
 #include &quot;game_session.hpp&quot;
 #include &quot;dialog_manager.hpp&quot;
 #include &quot;conversation.hpp&quot;
-#include &quot;script_manager.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;camera.hpp&quot;
+#include &quot;engine/camera.hpp&quot;
 #include &quot;config.hpp&quot;
 #include &quot;pda.hpp&quot;
 #include &quot;sexpr_file_reader.hpp&quot;

Deleted: trunk/windstille/src/sector.cpp
===================================================================
--- trunk/windstille/src/sector.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/sector.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,396 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;iostream&gt;
-#include &lt;sstream&gt;
-#include &lt;stdexcept&gt;
-#include &quot;sexpr_file_reader.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;display/scene_context.hpp&quot;
-#include &quot;objects/background_gradient.hpp&quot;
-#include &quot;tile/tile_map.hpp&quot;
-#include &quot;game_object.hpp&quot;
-#include &quot;objects/player.hpp&quot;
-#include &quot;trigger.hpp&quot;
-#include &quot;objects/test_object.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;objects/vrdummy.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &quot;particles/particle_system.hpp&quot;
-#include &quot;objects/test_object.hpp&quot;
-#include &quot;objects/elevator.hpp&quot;
-#include &quot;objects/nightvision.hpp&quot;
-#include &quot;objects/character.hpp&quot;
-#include &quot;laser_pointer.hpp&quot;
-#include &quot;objects/swarm.hpp&quot;
-#include &quot;objects/liquid.hpp&quot;
-#include &quot;objects/shockwave.hpp&quot;
-#include &quot;objects/hedgehog.hpp&quot;
-#include &quot;objects/spider_mine.hpp&quot;
-#include &quot;objects/box.hpp&quot;
-#include &quot;objects/scriptable_object.hpp&quot;
-#include &quot;navigation/navigation_graph.hpp&quot;
-#include &quot;scripting/squirrel_error.hpp&quot;
-
-// The table (works like a namespace here) where the game objects will appear
-#define OBJECTS_TABLE &quot;objects&quot;
-
-Sector* Sector::current_ = 0;
-
-Sector::Sector(const std::string&amp; arg_filename)
-  : filename(arg_filename),
-    player(0)    
-{
-  // make sure squirrel has an &quot;objects&quot; table
-  script_manager-&gt;run_script(
-      &quot;if(! (\&quot;&quot; OBJECTS_TABLE &quot;\&quot; in this)) {&quot;
-      &quot;  &quot; OBJECTS_TABLE &quot; &lt;- {};&quot;
-      &quot;}&quot;, &quot;&quot;);
-  
-  if (debug) std::cout &lt;&lt; &quot;Creating new Sector&quot; &lt;&lt; std::endl;
-  collision_engine = new CollisionEngine();
-  navigation_graph = new NavigationGraph();
-
-  current_ = this;
-  interactive_tilemap = 0;
-  interactivebackground_tilemap = 0;
-
-  parse_file(filename);
-  if (!interactive_tilemap)
-    throw std::runtime_error(&quot;No interactive-tilemap available&quot;);
-
-  // add interactive to collision engine
-  collision_engine-&gt;add(new CollisionObject(interactive_tilemap));
-
-  // Spawn the Player
-  if(!player) {
-    player = new Player();
-    add(player);
-  }
-  player-&gt;set_pos(Vector(300,200));
-}
-
-Sector::~Sector()
-{
-  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-    (*i)-&gt;unref();
-  for(Objects::iterator i = new_objects.begin(); i != new_objects.end(); ++i)
-    (*i)-&gt;unref();
-
-  delete navigation_graph;
-  delete collision_engine;
-}
-
-void
-Sector::parse_file(const std::string&amp; filename)
-{
-  if (debug) std::cout &lt;&lt; &quot;Sector:parse_file '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-  
-  FileReader reader = FileReader::parse(filename);
-  if(reader.get_name() != &quot;windstille-sector&quot;) {
-    std::ostringstream msg;
-    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille-sector file&quot;;
-    throw std::runtime_error(msg.str());
-  }
-  
-  int version = 1;
-  if(!reader.get(&quot;version&quot;, version))
-    std::cerr &lt;&lt; &quot;Warning no version specified in levelformat.\n&quot;;
-  if(version &gt; 1)
-    std::cerr &lt;&lt; &quot;Warning: format version is newer than game.\n&quot;;
-
-  reader.get(&quot;name&quot;,          name);
-  reader.get(&quot;music&quot;,         music);
-  reader.get(&quot;init-script&quot;,   init_script);
-  reader.get(&quot;ambient-color&quot;, ambient_light);
-  
-  FileReader objects_reader;
-  if(reader.get(&quot;objects&quot;, objects_reader) == false)
-    throw std::runtime_error(&quot;No objects specified&quot;);
-
-  std::vector&lt;FileReader&gt; objects_readers = objects_reader.get_sections();
-  for(std::vector&lt;FileReader&gt;::iterator i = objects_readers.begin(); i != objects_readers.end(); ++i)
-    {
-      add_object(*i);
-    }
-
-  reader.print_unused_warnings(&quot;sector&quot;);
-  if (debug) std::cout &lt;&lt; &quot;Finished parsing&quot; &lt;&lt; std::endl;
-}
-
-void
-Sector::add_object(FileReader&amp; reader)
-{
-  if(reader.get_name() == &quot;tilemap&quot;) {
-    TileMap* tilemap = new TileMap(reader);
-    add(tilemap);
-    if (tilemap-&gt;get_name() == &quot;interactive&quot;)
-      interactive_tilemap = tilemap;
-    else if (tilemap-&gt;get_name() == &quot;interactivebackground&quot;)
-      interactivebackground_tilemap = tilemap;
-  } else if(reader.get_name() == &quot;background&quot;) {
-    // TODO
-  } else if (reader.get_name() == &quot;background-gradient&quot;) {
-    add(new BackgroundGradient(reader));
-  } else if(reader.get_name() == &quot;trigger&quot;) {
-    add(new Trigger(reader));
-  } else if(reader.get_name() == &quot;box&quot;) {
-    add(new Box(reader));
-  } else if(reader.get_name() == &quot;shockwave&quot;) {
-    add(new Shockwave(reader));
-  } else if(reader.get_name() == &quot;elevator&quot;) {
-    add(new Elevator(reader));
-  } else if(reader.get_name() == &quot;character&quot;) {    
-    add(new Character(reader));
-  } else if(reader.get_name() == &quot;spider-mine&quot;) {
-    add(new SpiderMine(reader));
-  } else if(reader.get_name() == &quot;hedgehog&quot;) {
-    add(new Hedgehog(reader));
-  } else if(reader.get_name() == &quot;test-object&quot;) {
-    add(new TestObject(reader));
-  } else if (reader.get_name() == &quot;nightvision&quot;) {
-    add(new Nightvision(reader));
-  } else if (reader.get_name() == &quot;particle-system&quot;) {
-    add(new ParticleSystem(reader));
-  } else if(reader.get_name() == &quot;scriptable-object&quot;) {    
-    add(new ScriptableObject(reader));
-  } else if (reader.get_name() == &quot;vrdummy&quot;) {
-    add(new VRDummy(reader));
-  } else if (reader.get_name() == &quot;swarm&quot;) {
-    add(new Swarm(reader));
-  } else if (reader.get_name() == &quot;laserpointer&quot;) {
-    add(new LaserPointer());
-  } else if (reader.get_name() == &quot;liquid&quot;) {
-    add(new Liquid(reader));
-  } else {
-    std::cout &lt;&lt; &quot;Skipping unknown Object: &quot; &lt;&lt; reader.get_name() &lt;&lt; &quot;\n&quot;;
-  }
-}
-
-void
-Sector::activate()
-{
-  commit_adds();
-  commit_removes();
-
-  sound_manager-&gt;play_music(music);
-  if (init_script != &quot;&quot;)
-    script_manager-&gt;run_script_file(init_script);
-}
-
-void
-Sector::draw(SceneContext&amp; sc)
-{
-  sc.light().fill_screen(ambient_light);
-
-  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      if ((*i)-&gt;is_active())
-        (*i)-&gt;draw(sc);
-    }
-}
-
-void Sector::commit_adds()
-{
-  // Add new game objects
-  for(Objects::iterator i = new_objects.begin(); i != new_objects.end(); ++i) {
-    objects.push_back(*i);
-  }
-  new_objects.clear();
-}
-
-void Sector::update(float delta)
-{
-  commit_adds();
-
-  collision_engine-&gt;update(delta);
-
-  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i) {
-    if ((*i)-&gt;is_active())
-      (*i)-&gt;update(delta);
-  }
-  commit_removes();
-}
-
-void
-Sector::commit_removes()
-{
-  // remove objects
-  for(Objects::iterator i = objects.begin(); i != objects.end(); ) {
-    GameObject* object = *i;
-    if(object-&gt;is_removable()) {
-      if(object-&gt;get_name() != &quot;&quot;) {
-        remove_object_from_squirrel(object);
-      }
-      object-&gt;unref();
-
-      i = objects.erase(i);
-      continue;
-    }
-
-    ++i;
-  }
-}
-
-void
-Sector::add(GameObject* obj)
-{
-  new_objects.push_back(obj);
-  obj-&gt;ref();
-  if(obj-&gt;get_name() != &quot;&quot;) {
-    expose_object_to_squirrel(obj);
-  }
-}
-
-void
-Sector::remove_object_from_squirrel(GameObject* object)
-{
-  using namespace scripting;
-
-  // get objects table
-  HSQUIRRELVM v = script_manager-&gt;get_vm();
-  sq_pushroottable(v);
-  sq_pushstring(v, OBJECTS_TABLE, -1);
-  if(SQ_FAILED(sq_get(v, -2)))
-  {
-    std::ostringstream msg;
-    msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
-    throw SquirrelError(v, msg.str());
-  }
-
-  // remove object from table
-  sq_pushstring(v, object-&gt;get_name().c_str(), object-&gt;get_name().size());
-  if(SQ_FAILED(sq_deleteslot(v, -2, SQFalse) &lt; 0)) {
-    std::ostringstream msg;
-    msg &lt;&lt; &quot;Couldn't remove squirrel object for '&quot; &lt;&lt; object-&gt;get_name()
-        &lt;&lt; &quot;'&quot;;
-    throw SquirrelError(v, msg.str());
-  }
-  
-  // pop objects and root table
-  sq_pop(v, 2);
-}
-
-// tries to find out the &quot;real&quot; class of an gameobject by some dynamic casting
-// and creates a matching squirrel instance for that object
-static inline void create_squirrel_instance(HSQUIRRELVM v, GameObject* object)
-{
-  ScriptableObject* script_obj = dynamic_cast&lt;ScriptableObject*&gt; (object);
-  if(script_obj) {
-    create_squirrel_instance(v, new scripting::ScriptableObject(script_obj),
-                             true);
-    return;
-  }
-  
-  TestObject* tobj = dynamic_cast&lt;TestObject*&gt; (object);
-  if(tobj) {
-    create_squirrel_instance(v, new scripting::TestObject(tobj), true);
-    return;
-  }                                                                             
-
-  Player* player = dynamic_cast&lt;Player*&gt; (object);
-  if(player) {
-    create_squirrel_instance(v, new scripting::Player(player), true);
-    return;
-  }
-
-  create_squirrel_instance(v, new scripting::GameObject(object), true);
-}
-
-void
-Sector::expose_object_to_squirrel(GameObject* object)
-{
-  using namespace scripting;
-
-  // get objects table
-  HSQUIRRELVM v = script_manager-&gt;get_vm();
-  sq_pushroottable(v);
-  sq_pushstring(v, OBJECTS_TABLE, -1);
-  if(SQ_FAILED(sq_get(v, -2)))
-  {
-    std::ostringstream msg;
-    msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
-    throw SquirrelError(v, msg.str());
-  }
-  
-  // create squirrel instance and register in table
-  sq_pushstring(v, object-&gt;get_name().c_str(), object-&gt;get_name().size());
-  create_squirrel_instance(v, object);
-  if(SQ_FAILED(sq_createslot(v, -3)))
-  {
-    std::ostringstream msg;
-    msg &lt;&lt; &quot;Couldn't register object in objects tab&#246;e&quot;;
-    throw SquirrelError(v, msg.str());
-  }
-
-  // pop roottable and objects table
-  sq_pop(v, 2);
-}
-
-GameObject*
-Sector::get_object(const std::string&amp; name) const
-{
-  for(Objects::const_iterator i = objects.begin(); i != objects.end(); ++i) 
-    {
-      if ((*i)-&gt;get_name() == name)
-        {
-          return *i;
-        }
-    }
-  return 0;
-}
-
-int
-Sector::get_width () const
-{
-  return interactive_tilemap-&gt;get_width() * TILE_SIZE;
-}
-
-int
-Sector::get_height () const
-{
-  return interactive_tilemap-&gt;get_height() * TILE_SIZE;
-}
-
-void
-Sector::set_tilemap(TileMap* t)
-{
-  interactive_tilemap = t;
-}
-
-void
-Sector::set_ambient_light(const Color&amp; color)
-{
-  ambient_light = color;
-}
-
-Color
-Sector::get_ambient_light() const
-{
-  return ambient_light;
-}
-
-const std::string&amp;
-Sector::get_filename () const
-{
-  return filename;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/sector.hpp
===================================================================
--- trunk/windstille/src/sector.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/sector.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,122 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_SECTOR_HPP
-#define HEADER_WINDSTILLE_SECTOR_HPP
-
-#include &lt;string&gt;
-#include &lt;vector&gt;
-#include &quot;color.hpp&quot;
-
-class FileReader;
-class GameObject;
-class TileMap;
-class Player;
-class SceneContext;
-class SpawnPoint;
-class CollisionEngine;
-class NavigationGraph;
-class Entity;
-
-/** */
-class Sector
-{
-private: 
-  static Sector* current_;  
-public:
-  static Sector* current() { return current_; }
-  
-private:
-  std::string filename;
-  std::string name;
-  std::string music;
-  std::string init_script;
-
-  typedef std::vector&lt;GameObject*&gt; Objects;
-  Objects objects;
-  /** container for newly created GameObjects (they'll be added once per frame
-   * in the update function */
-  Objects new_objects;
-
-  Color ambient_light;
-
-  /** The TileMap with which the player interacts */
-  TileMap* interactive_tilemap;
-  TileMap* interactivebackground_tilemap;
-
-  CollisionEngine* collision_engine;
-  NavigationGraph* navigation_graph;
-
-  Player* player;
-
-  void parse_file(const std::string&amp; filename);
-
-  void commit_adds();
-  void commit_removes();
-
-  void expose_object_to_squirrel(GameObject* object);
-  void remove_object_from_squirrel(GameObject* object);
-
-public:
-  Sector(const std::string&amp; filename);
-  ~Sector();
-
-  const std::string&amp; get_filename () const;
-
-  void draw(SceneContext&amp; gc);
-  void update(float delta);
-
-  /**
-   * activates the sector. (Runs init script, changes music)
-   */
-  void activate();
-  
-  int get_width  () const;
-  int get_height () const;
-
-  /**
-   * Set ambient light, ie. the light that illuminates the whole sector
-   * all the time, to \a color
-   */
-  void  set_ambient_light(const Color&amp; color);
-  Color get_ambient_light() const;
-
-  void add(GameObject*);
-  void add_object(FileReader&amp; reader);
-
-  CollisionEngine* get_collision_engine() const { return collision_engine; }
-
-  GameObject* get_object(const std::string&amp; name) const;
-
-  std::vector&lt;GameObject*&gt;* get_objects() { return &objects; }
-  TileMap* get_tilemap() const { return interactive_tilemap; }
-  TileMap* get_tilemap2() const { return interactivebackground_tilemap; }
-  void     set_tilemap(TileMap* t);
-  Player* get_player() const
-  {
-    return player;
-  }
-  
-private:
-  Sector (const Sector&amp;);
-  Sector&amp; operator= (const Sector&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/sprite3d/sprite3d.hpp
===================================================================
--- trunk/windstille/src/sprite3d/sprite3d.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/sprite3d/sprite3d.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -21,7 +21,7 @@
 
 #include &lt;string&gt;
 #include &lt;stdint.h&gt;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 #include &quot;math/matrix.hpp&quot;

Modified: trunk/windstille/src/tile/tile_map.hpp
===================================================================
--- trunk/windstille/src/tile/tile_map.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/tile/tile_map.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -23,7 +23,7 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;field.hpp&quot;
-#include &quot;game_object.hpp&quot;
+#include &quot;engine/game_object.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 
 class Tile;

Deleted: trunk/windstille/src/trigger.cpp
===================================================================
--- trunk/windstille/src/trigger.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/trigger.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,84 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;stdexcept&gt;
-#include &lt;list&gt;
-#include &quot;sector.hpp&quot;
-#include &quot;trigger.hpp&quot;
-#include &quot;objects/player.hpp&quot;
-#include &quot;script_manager.hpp&quot;
-
-Trigger::Trigger(FileReader&amp; props)
-  : triggered(false), one_time_trigger(false)
-{
-  float x = -1;
-  float y = -1;
-  float width = -1;
-  float height = -1;
-  
-  props.get(&quot;x&quot;, x);
-  props.get(&quot;y&quot;, y);
-  props.get(&quot;width&quot;, width);
-  props.get(&quot;height&quot;, height);
-  props.get(&quot;script&quot;, script);
-  props.get(&quot;one-time-trigger&quot;, one_time_trigger);
-  props.print_unused_warnings(&quot;trigger&quot;);
-
-  if(x &lt; 0 || y &lt; 0 || width &lt; 0 || height &lt; 0)
-    throw std::runtime_error(&quot;Invalid or missing area in Trigger object&quot;);
- 
-  area.left = x;
-  area.top = y;
-  area.right = area.left + width;
-  area.bottom = area.top + height;
-}
-
-Trigger::~Trigger()
-{
-}
-
-void
-Trigger::draw (SceneContext&amp; )
-{
-}
-
-void
-Trigger::update (float )
-{
-  //FIXME use proper collision detection
-  Player* player = Player::current();
-  if(!area.is_inside(player-&gt;get_pos())) {
-    last_trigger = false;
-    return;
-  }
-  
-  if(triggered &amp;&amp; one_time_trigger)
-    return;
-
-  if(last_trigger == false) {
-    triggered = true;
-    try {
-      script_manager-&gt;run_script(script, &quot;TriggerObject&quot;);
-    } catch(std::exception&amp; e) {
-      std::cerr &lt;&lt; &quot;Couldn't run trigger-script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-    }
-  }
-  last_trigger = true;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/trigger.hpp
===================================================================
--- trunk/windstille/src/trigger.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/trigger.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -1,47 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_TRIGGER_HPP
-#define HEADER_WINDSTILLE_TRIGGER_HPP
-
-#include &lt;vector&gt;
-#include &quot;game_object.hpp&quot;
-
-/** */
-class Trigger : public GameObject
-{
-private:
-  Rectf area;
-  std::string script;
-  /// has the trigger been activated at least once
-  bool triggered;
-  /// trigger active in last frame
-  bool last_trigger;
-  bool one_time_trigger;
-  
-public:
-  Trigger(FileReader&amp; props);
-  virtual ~Trigger();
-
-  void draw (SceneContext&amp; gc);
-  void update (float delta);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/view.cpp
===================================================================
--- trunk/windstille/src/view.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/view.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -20,7 +20,7 @@
 #include &quot;display/display.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;objects/player.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;view.hpp&quot;
 
 View* View::current_ = 0;

Modified: trunk/windstille/src/view.hpp
===================================================================
--- trunk/windstille/src/view.hpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/view.hpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -19,8 +19,8 @@
 #ifndef HEADER_WINDSTILLE_VIEW_HPP
 #define HEADER_WINDSTILLE_VIEW_HPP
 
-#include &quot;camera.hpp&quot;
 #include &quot;graphic_context_state.hpp&quot;
+#include &quot;engine/camera.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 
 class Controller;

Modified: trunk/windstille/src/windstille_main.cpp
===================================================================
--- trunk/windstille/src/windstille_main.cpp	2009-02-11 21:05:03 UTC (rev 2463)
+++ trunk/windstille/src/windstille_main.cpp	2009-02-11 21:22:01 UTC (rev 2464)
@@ -27,11 +27,11 @@
 #include &quot;font/fonts.hpp&quot;
 #include &quot;game_session.hpp&quot;
 #include &quot;title_screen.hpp&quot;
-#include &quot;sector.hpp&quot;
+#include &quot;engine/sector.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;
 #include &quot;tile/tile_factory.hpp&quot;
-#include &quot;script_manager.hpp&quot;
+#include &quot;engine/script_manager.hpp&quot;
 #include &quot;config.hpp&quot;
 #include &quot;util.hpp&quot;
 #include &quot;font/ttf_font.hpp&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001460.html">[Windstille-commit] r2463 - in trunk/windstille/src: . collision	gui objects tile
</A></li>
	<LI>Next message: <A HREF="001462.html">[Windstille-commit] r2465 - in trunk/windstille/src: . armature	display engine font gui input math navigation objects	particles scripting sprite2d tile util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1461">[ date ]</a>
              <a href="thread.html#1461">[ thread ]</a>
              <a href="subject.html#1461">[ subject ]</a>
              <a href="author.html#1461">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
