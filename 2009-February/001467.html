<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r2470 - in trunk/windstille/src: . app	collision display engine font gui hud input objects particles	screen scripting sprite3d tile
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2470%20-%20in%20trunk/windstille/src%3A%20.%20app%0A%09collision%20display%20engine%20font%20gui%20hud%20input%20objects%20particles%0A%09screen%20scripting%20sprite3d%20tile&In-Reply-To=%3C200902120834.n1C8Y6X1011949%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001466.html">
   <LINK REL="Next"  HREF="001468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r2470 - in trunk/windstille/src: . app	collision display engine font gui hud input objects particles	screen scripting sprite3d tile</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2470%20-%20in%20trunk/windstille/src%3A%20.%20app%0A%09collision%20display%20engine%20font%20gui%20hud%20input%20objects%20particles%0A%09screen%20scripting%20sprite3d%20tile&In-Reply-To=%3C200902120834.n1C8Y6X1011949%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r2470 - in trunk/windstille/src: . app	collision display engine font gui hud input objects particles	screen scripting sprite3d tile">grumbel at mail.berlios.de
       </A><BR>
    <I>Thu Feb 12 09:34:06 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001466.html">[Windstille-commit] r2469 - in trunk/windstille/src: . engine	screen sprite3d
</A></li>
        <LI>Next message: <A HREF="001468.html">[Windstille-commit] r2471 - in trunk/windstille/src: . app engine	gui math objects screen tile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1467">[ date ]</a>
              <a href="thread.html#1467">[ thread ]</a>
              <a href="subject.html#1467">[ subject ]</a>
              <a href="author.html#1467">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-02-12 09:33:55 +0100 (Thu, 12 Feb 2009)
New Revision: 2470

Added:
   trunk/windstille/src/app/
   trunk/windstille/src/app/config.cpp
   trunk/windstille/src/app/config.hpp
   trunk/windstille/src/app/console.cpp
   trunk/windstille/src/app/console.hpp
   trunk/windstille/src/app/controller_def.cpp
   trunk/windstille/src/app/controller_def.hpp
   trunk/windstille/src/app/globals.cpp
   trunk/windstille/src/app/globals.hpp
   trunk/windstille/src/app/menu_manager.cpp
   trunk/windstille/src/app/menu_manager.hpp
   trunk/windstille/src/app/weapon.hpp
   trunk/windstille/src/app/windstille.hpp
   trunk/windstille/src/app/windstille_main.cpp
   trunk/windstille/src/app/windstille_main.hpp
Removed:
   trunk/windstille/src/config.cpp
   trunk/windstille/src/config.hpp
   trunk/windstille/src/console.cpp
   trunk/windstille/src/console.hpp
   trunk/windstille/src/controller_def.cpp
   trunk/windstille/src/controller_def.hpp
   trunk/windstille/src/globals.cpp
   trunk/windstille/src/globals.hpp
   trunk/windstille/src/menu_manager.cpp
   trunk/windstille/src/menu_manager.hpp
   trunk/windstille/src/mt19937ar.c
   trunk/windstille/src/windstille.hpp
   trunk/windstille/src/windstille_main.cpp
   trunk/windstille/src/windstille_main.hpp
Modified:
   trunk/windstille/src/SConscript
   trunk/windstille/src/collision/collision_engine.cpp
   trunk/windstille/src/display/display.cpp
   trunk/windstille/src/display/opengl_state.cpp
   trunk/windstille/src/display/surface_manager.cpp
   trunk/windstille/src/display/texture_manager.cpp
   trunk/windstille/src/engine/entity.cpp
   trunk/windstille/src/engine/script_manager.cpp
   trunk/windstille/src/engine/sector.cpp
   trunk/windstille/src/font/fonts.cpp
   trunk/windstille/src/gui/root_component.cpp
   trunk/windstille/src/hud/dialog_manager.cpp
   trunk/windstille/src/hud/dialog_manager.hpp
   trunk/windstille/src/hud/energy_bar.cpp
   trunk/windstille/src/input/controller.cpp
   trunk/windstille/src/input/controller.hpp
   trunk/windstille/src/input/input_configurator.cpp
   trunk/windstille/src/input/input_manager_sdl.cpp
   trunk/windstille/src/objects/bomb.cpp
   trunk/windstille/src/objects/box.cpp
   trunk/windstille/src/objects/character.cpp
   trunk/windstille/src/objects/hedgehog.cpp
   trunk/windstille/src/objects/nightvision.cpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/objects/player.hpp
   trunk/windstille/src/objects/scriptable_object.cpp
   trunk/windstille/src/objects/swarm.cpp
   trunk/windstille/src/particles/surface_drawer.cpp
   trunk/windstille/src/screen/game_session.cpp
   trunk/windstille/src/screen/game_session.hpp
   trunk/windstille/src/screen/geometry_test.cpp
   trunk/windstille/src/screen/screen.cpp
   trunk/windstille/src/screen/screen_manager.cpp
   trunk/windstille/src/screen/sprite2dview.cpp
   trunk/windstille/src/screen/sprite3dview.cpp
   trunk/windstille/src/screen/title_screen.cpp
   trunk/windstille/src/scripting/interface.cpp
   trunk/windstille/src/sprite3d/data.cpp
   trunk/windstille/src/sprite3d/sprite3d.cpp
   trunk/windstille/src/tile/tile.cpp
   trunk/windstille/src/tile/tile_description.cpp
   trunk/windstille/src/tile/tile_factory.cpp
   trunk/windstille/src/tile/tile_map.cpp
   trunk/windstille/src/tile/tile_map.hpp
   trunk/windstille/src/tile/tile_packer.cpp
Log:
Application stuff into app/

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/SConscript	2009-02-12 08:33:55 UTC (rev 2470)
@@ -40,6 +40,12 @@
 # env['ENV']['LSBCC_SHAREDLIBS'] = 'png2:SDL:SDL_image:vorbis:ogg:openal:physfs'
 
 env.Program('../windstille', [
+'app/config.cpp',
+'app/console.cpp',
+'app/controller_def.cpp',
+'app/globals.cpp',
+'app/menu_manager.cpp',
+'app/windstille_main.cpp',
 'armature/armature.cpp',
 'armature/bone.cpp',
 'armature/mesh.cpp',
@@ -51,9 +57,6 @@
 'collision/collision_test.cpp',
 'collision/ladder_contact.cpp',
 'collision/stair_contact.cpp',
-'config.cpp',
-'console.cpp',
-'controller_def.cpp',
 'display/blitter.cpp',
 'display/display.cpp',
 'display/drawing_context.cpp',
@@ -79,7 +82,6 @@
 'font/border_font_effect.cpp',
 'font/fonts.cpp',
 'font/ttf_font.cpp',
-'globals.cpp',
 'gui/automap.cpp',
 'gui/button.cpp',
 'gui/component.cpp',
@@ -121,7 +123,6 @@
 'math/random.cpp',
 'math/rect.cpp',
 'math/vector.cpp',
-'menu_manager.cpp',
 'navigation/navigation_graph.cpp',
 'navigation/node.cpp',
 'navigation/properties.cpp',
@@ -146,22 +147,22 @@
 'objects/test_object.cpp',
 'objects/trigger.cpp',
 'objects/vrdummy.cpp',
-'screen/particle_viewer.cpp',
 'particles/deform_drawer.cpp',
 'particles/particle_system.cpp',
 'particles/spark_drawer.cpp',
 'particles/surface_drawer.cpp',
 'physfs/physfs_sdl.cpp',
 'physfs/physfs_stream.cpp',
-'screen/screen.cpp',
 'screen/armature_test.cpp',
 'screen/game_session.cpp',
 'screen/geometry_test.cpp',
 'screen/navigation_test.cpp',
+'screen/particle_viewer.cpp',
+'screen/screen.cpp',
+'screen/screen_manager.cpp',
 'screen/sprite2dview.cpp',
 'screen/sprite3dview.cpp',
 'screen/title_screen.cpp',
-'screen/screen_manager.cpp',
 'scripting/game_objects.cpp',
 'scripting/interface.cpp',
 'scripting/squirrel_error.cpp',
@@ -191,7 +192,6 @@
 'util/sexpr_file_reader.cpp',
 'util/util.cpp',
 'view.cpp',
-'windstille_main.cpp',
 ])
 
 # EOF #

Copied: trunk/windstille/src/app/config.cpp (from rev 2466, trunk/windstille/src/config.cpp)


Property changes on: trunk/windstille/src/app/config.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/config.hpp (from rev 2466, trunk/windstille/src/config.hpp)


Property changes on: trunk/windstille/src/app/config.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/console.cpp (from rev 2468, trunk/windstille/src/console.cpp)


Property changes on: trunk/windstille/src/app/console.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/console.hpp (from rev 2466, trunk/windstille/src/console.hpp)


Property changes on: trunk/windstille/src/app/console.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/controller_def.cpp (from rev 2466, trunk/windstille/src/controller_def.cpp)


Property changes on: trunk/windstille/src/app/controller_def.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/controller_def.hpp (from rev 2466, trunk/windstille/src/controller_def.hpp)


Property changes on: trunk/windstille/src/app/controller_def.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/globals.cpp (from rev 2469, trunk/windstille/src/globals.cpp)


Property changes on: trunk/windstille/src/app/globals.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/globals.hpp (from rev 2469, trunk/windstille/src/globals.hpp)


Property changes on: trunk/windstille/src/app/globals.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/menu_manager.cpp (from rev 2468, trunk/windstille/src/menu_manager.cpp)


Property changes on: trunk/windstille/src/app/menu_manager.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/menu_manager.hpp (from rev 2466, trunk/windstille/src/menu_manager.hpp)


Property changes on: trunk/windstille/src/app/menu_manager.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/weapon.hpp (from rev 2466, trunk/windstille/src/weapon.hpp)


Property changes on: trunk/windstille/src/app/weapon.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/app/windstille.hpp (from rev 2466, trunk/windstille/src/windstille.hpp)


Property changes on: trunk/windstille/src/app/windstille.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/windstille_main.cpp (from rev 2468, trunk/windstille/src/windstille_main.cpp)


Property changes on: trunk/windstille/src/app/windstille_main.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/app/windstille_main.hpp (from rev 2468, trunk/windstille/src/windstille_main.hpp)


Property changes on: trunk/windstille/src/app/windstille_main.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Modified: trunk/windstille/src/collision/collision_engine.cpp
===================================================================
--- trunk/windstille/src/collision/collision_engine.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/collision/collision_engine.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -19,7 +19,7 @@
 
 #include &quot;collision_test.hpp&quot;
 #include &quot;collision_engine.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 
 std::vector&lt;Rectf&gt; tilemap_collision_list(TileMap *tilemap, const Rectf &amp;r, bool is_ground);

Deleted: trunk/windstille/src/config.cpp
===================================================================
--- trunk/windstille/src/config.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/config.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,456 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;windstille.hpp&quot;
-
-#include &lt;boost/format.hpp&gt;
-#include &lt;memory&gt;
-#include &lt;iostream&gt;
-#include &quot;config.hpp&quot;
-#include &quot;util/sexpr_file_reader.hpp&quot;
-#include &quot;util/command_line.hpp&quot;
-#include &quot;globals.hpp&quot;
-
-#define _(A) A
-
-std::vector&lt;std::string&gt; arg_files;
-
-Config config;
-
-Config::Config()
-{
-  add(new ConfigValue&lt;int&gt; (&quot;anti-aliasing&quot;,  _(&quot;Use NUMx Anti-Aliasing&quot;), true, 0));
-  add(new ConfigValue&lt;bool&gt;(&quot;fullscreen&quot;,     _(&quot;Use fullscreen&quot;),         true, false));
-  add(new ConfigValue&lt;bool&gt;(&quot;show-fps&quot;,       _(&quot;Show frames per second&quot;), true, true));
-
-  add(new ConfigValue&lt;bool&gt;(&quot;music&quot;,          _(&quot;Enable Music&quot;), true, true));
-  add(new ConfigValue&lt;bool&gt;(&quot;sound&quot;,          _(&quot;Enable Sound&quot;), true, true));
-  
-  add(new ConfigValue&lt;int&gt;(&quot;aspect-width&quot;,    _(&quot;Aspect Width&quot;),   true, 800));
-  add(new ConfigValue&lt;int&gt;(&quot;aspect-height&quot;,   _(&quot;Aspect Height&quot;),  true, 600));
-
-  add(new ConfigValue&lt;int&gt;(&quot;screen-width&quot;,    _(&quot;Screen Width&quot;),   true, 800));
-  add(new ConfigValue&lt;int&gt;(&quot;screen-height&quot;,   _(&quot;Screen Height&quot;), true, 600));
-
-  add(new ConfigValue&lt;std::string&gt;(&quot;levelfile&quot;,       _(&quot;Levelfile to be used at startup&quot;), false));
-
-  // FIXME: There is no need to limit this to just two
-  add(new ConfigValue&lt;std::string&gt;(&quot;primary-controller-file&quot;,   _(&quot;Controller Config file to load&quot;), true));
-  add(new ConfigValue&lt;std::string&gt;(&quot;secondary-controller-file&quot;, _(&quot;Controller Config file to load&quot;), true));
-
-  add(new ConfigValue&lt;std::string&gt;(&quot;screenshot-dir&quot;,  _(&quot;Directory where Screenshots are saved&quot;), false));
-
-  add(new ConfigValue&lt;std::string&gt;(&quot;recorder-file&quot;,   _(&quot;File to which demos are recorded&quot;), false));
-  add(new ConfigValue&lt;std::string&gt;(&quot;playback-file&quot;,   _(&quot;File from which a demo is played&quot;), false));
-
-  add(new ConfigValue&lt;int&gt;(&quot;master-volume&quot;,  _(&quot;Master Volume&quot;), true, 100));
-
-  add(new ConfigValue&lt;bool&gt;(&quot;wiimote&quot;, _(&quot;Try to connect to Wiimote on startup&quot;), true, false));
-}
-
-Config::~Config()
-{
-  for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-    {
-      delete i-&gt;second;
-    }
-}
-
-void 
-Config::add(ConfigValueBase* value)
-{
-  config_values[value-&gt;get_name()] = value;
-}
-
-std::string
-Config::get_string(const std::string&amp; name) const 
-{
-  return get&lt;std::string&gt;(name).get();
-}
-
-bool
-Config::get_bool(const std::string&amp; name) const 
-{
-  return get&lt;bool&gt;(name).get();
-}
-
-int
-Config::get_int(const std::string&amp; name) const 
-{
-  return get&lt;int&gt;(name).get();
-}
-
-float
-Config::get_float(const std::string&amp; name) const 
-{
-  return get&lt;float&gt;(name).get();
-}
-
-void
-Config::set_string(const std::string&amp; name, const std::string&amp; value)
-{
-  get&lt;std::string&gt;(name).set(value);
-}
-
-void
-Config::set_bool  (const std::string&amp; name, bool  value)
-{
-  get&lt;bool&gt;(name).set(value);
-}
-
-void
-Config::set_int   (const std::string&amp; name, int   value)
-{
-  get&lt;int&gt;(name).set(value);
-}
-
-void
-Config::set_float (const std::string&amp; name, float value)
-{
-  get&lt;float&gt;(name).set(value);
-}
-
-void
-Config::parse_args(int argc, char** argv)
-{
-  arg_files.clear();
-
-  CommandLine argp;
-
-  const int debug_flag        = 256;
-  const int nodebug_flag      = 257;
-  const int sprite3dview_flag = 258;
-  const int particleview_flag = 259;
-  const int sprite2dview_flag = 260;
-  const int secondary_controller_file = 261;
-    
-  argp.set_help_indent(24);
-  argp.add_usage (&quot;[LEVELFILE]&quot;);
-  argp.add_doc   (&quot;Windstille is a classic Jump'n Run game.&quot;);
-
-  argp.add_group(&quot;Mode Options:&quot;);
-  argp.add_option(sprite3dview_flag, &quot;sprite3dview&quot;, &quot;&quot;, &quot;Launch Sprite3DView instead of the game&quot;);
-  argp.add_option(sprite2dview_flag, &quot;sprite2dview&quot;, &quot;&quot;, &quot;Launch Sprite2DView instead of the game&quot;);
-  argp.add_option(particleview_flag, &quot;particle-viewer&quot;, &quot;&quot;, &quot;Launch ParticleView instead of the game&quot;);
-
-  argp.add_group(&quot;Display Options:&quot;);
-  argp.add_option('g', &quot;geometry&quot;,   &quot;WxH&quot;, &quot;Change window size to WIDTH and HEIGHT&quot;);
-  argp.add_option('a', &quot;aspect&quot;,   &quot;WxH&quot;, &quot;Change aspect size to WIDTH and HEIGHT&quot;);
-  argp.add_option('f', &quot;fullscreen&quot;, &quot;&quot;, &quot;Launch the game in fullscreen&quot;);
-  argp.add_option('A', &quot;anti-aliasing&quot;, &quot;NUM&quot;, &quot;Enable NUMx Anti-Aliasing&quot;);
-
-  argp.add_group(&quot;Sound Options:&quot;);
-  argp.add_option('s', &quot;disable-sound&quot;, &quot;&quot;, &quot;Disable sound&quot;);
-  argp.add_option('S', &quot;enable-sound&quot;, &quot;&quot;, &quot;Enable sound&quot;);
-
-  argp.add_group(&quot;Controlls Options:&quot;);
-  argp.add_option('c', &quot;controller&quot;, &quot;FILE&quot;, &quot;Use controller as defined in FILE&quot;);
-  argp.add_option(secondary_controller_file, &quot;secondary-controller&quot;, &quot;FILE&quot;,
-                  &quot;Use controller as defined in FILE&quot;);
-#ifdef HAVE_CWIID
-  argp.add_option('w', &quot;wiimote&quot;, &quot;&quot;, &quot;Connect to Wiimote on startup&quot;);
-#endif
-
-  argp.add_group(&quot;Misc Options:&quot;);
-  argp.add_option('d', &quot;datadir&quot;,    &quot;DIR&quot;, &quot;Fetch game data from DIR&quot;);
-  argp.add_option(debug_flag, &quot;debug&quot;,      &quot;&quot;, &quot;Turn on debug output&quot;);
-  argp.add_option(nodebug_flag, &quot;nodebug&quot;,      &quot;&quot;, &quot;Turn off debug output&quot;);
-  argp.add_option('v', &quot;version&quot;,       &quot;&quot;, &quot;Print Windstille Version&quot;);
-  argp.add_option('h', &quot;help&quot;,       &quot;&quot;, &quot;Print this help&quot;);
-
-  argp.add_group(&quot;Demo Recording/Playback Options:&quot;);
-  argp.add_option('r', &quot;record&quot;,      &quot;FILE&quot;, &quot;Record input events to FILE&quot;);
-  //argp.add_option('x', &quot;record-video&quot;,&quot;DIR&quot;,  &quot;Record a gameplay video to DIR&quot;);
-  argp.add_option('p', &quot;play&quot;,        &quot;FILE&quot;, &quot;Playback input events from FILE&quot;);
-
-  argp.parse_args(argc, argv);
-
-  while (argp.next())
-    {
-      switch (argp.get_key())
-        {
-        case 'A':
-          int anti_aliasing;
-          if (sscanf(argp.get_argument().c_str(), &quot;%d&quot;, &amp;anti_aliasing) != 1)
-            {
-              throw std::runtime_error(&quot;Anti-Aliasing option '-a' requires argument of type {NUM}&quot;);
-            }
-          else
-            {
-              get&lt;int&gt;(&quot;anti-aliasing&quot;) = anti_aliasing;
-            }
-          break;
-
-        case 'r':
-          get&lt;std::string&gt;(&quot;recorder-file&quot;) = argp.get_argument();
-          break;
-
-        case 'x':
-          get&lt;std::string&gt;(&quot;screenshot-dir&quot;) = argp.get_argument();
-          break;
-
-        case 'p':
-          get&lt;std::string&gt;(&quot;playback-file&quot;) = argp.get_argument();
-          break;
-
-        case 'w':
-          get&lt;bool&gt;(&quot;wiimote&quot;) = true;
-          break;
-
-        case 'd':
-          datadir = argp.get_argument();
-          break;
-
-        case debug_flag:
-          debug = true;
-          break;
-
-        case nodebug_flag:
-          debug = false;
-          break;
-
-        case sprite3dview_flag:
-          sprite3dview = true;
-          break;
-
-        case sprite2dview_flag:
-          sprite2dview = true;
-          break;
-
-        case particleview_flag:
-          particleview = true;
-          break;
-
-        case 'f':
-          set_bool(&quot;fullscreen&quot;, true);
-          break;
-
-        case 'g':
-          {
-            int screen_width  = 800;
-            int screen_height = 600;
-            if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;,
-                       &amp;screen_width, &amp;screen_height) == 2)
-              {
-                get&lt;int&gt;(&quot;screen-width&quot;)  = screen_width;
-                get&lt;int&gt;(&quot;screen-height&quot;) = screen_height;
-              
-                // FIXME: Why does this get printed twice?!
-                // Is the argument parser buggy?
-                std::cout &lt;&lt; &quot;Geometry: &quot; &lt;&lt; screen_width &lt;&lt; &quot;x&quot; &lt;&lt; screen_height &lt;&lt; std::endl;
-              }
-            else
-              {
-                throw std::runtime_error(&quot;Geometry option '-g' requires argument of type {WIDTH}x{HEIGHT}&quot;);
-              }
-          }
-          break;
-
-        case 'a':
-          {
-            int aspect_width  = 800;
-            int aspect_height = 600;
-            if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;,
-                       &amp;aspect_width, &amp;aspect_height) == 2)
-              {
-                get&lt;int&gt;(&quot;aspect-width&quot;)  = aspect_width;
-                get&lt;int&gt;(&quot;aspect-height&quot;) = aspect_height;
-              
-                // FIXME: Why does this get printed twice?!
-                // Is the argument parser buggy?
-                std::cout &lt;&lt; &quot;Geometry: &quot; &lt;&lt; aspect_width &lt;&lt; &quot;x&quot; &lt;&lt; aspect_height &lt;&lt; std::endl;
-              }
-            else
-              {
-                throw std::runtime_error(&quot;Geometry option '-a' requires argument of type {WIDTH}x{HEIGHT}&quot;);
-              }
-          }
-          break;
-        
-        case 's':
-          set_bool(&quot;sound&quot;, false);
-          break;
-
-        case 'S':
-          set_bool(&quot;sound&quot;, true);
-          break;  
-
-        case 'c':
-          get&lt;std::string&gt;(&quot;primary-controller-file&quot;) = argp.get_argument();
-          break;
-
-        case secondary_controller_file:
-          get&lt;std::string&gt;(&quot;secondary-controller-file&quot;) = argp.get_argument();
-          break;
-
-        case 'v':
-          std::cout &lt;&lt; &quot;Windstille &quot; &lt;&lt; WINDSTILLE_VERSION &lt;&lt; std::endl;
-          exit(EXIT_SUCCESS);
-          break;
-
-        case 'h':
-          argp.print_help();
-          exit(EXIT_SUCCESS);
-          break;
-
-        case CommandLine::REST_ARG:
-          set_string(&quot;levelfile&quot;, argp.get_argument());
-          arg_files.push_back(argp.get_argument());
-          break;
-        }
-    }
-}
-
-bool
-Config::has_key(const std::string&amp; name)
-{
-  ConfigValues::iterator i = config_values.find(name);
-  return (i != config_values.end());
-}
-
-bool
-Config::is_set(const std::string&amp; name)
-{
-  ConfigValues::iterator i = config_values.find(name);
-  if (i == config_values.end())
-    {
-      throw std::runtime_error(&quot;Error: unknown Config value: '&quot; + name + &quot;'&quot;);        
-    }    
-  else
-    {
-      return i-&gt;second-&gt;is_set();
-    }
-}
-
-void
-Config::load()
-{
-  try {
-    FileReader reader = FileReader::parse(&quot;config&quot;);
-    if(reader.get_name() != &quot;windstille-config&quot;) {
-      std::cerr &lt;&lt; &quot;Warning: Config file is not a windstille-config file.\n&quot;;
-      return;
-    }
-    
-    for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-      { // FIXME: all this dynamic_casting is overcomplicated crap
-        if (dynamic_cast&lt;ConfigValue&lt;int&gt;*&gt;(i-&gt;second))
-          {
-            int v;
-            if (reader.get(i-&gt;first.c_str(), v))
-              set_int(i-&gt;first, v);
-          }
-        else if (dynamic_cast&lt;ConfigValue&lt;bool&gt;*&gt;(i-&gt;second))
-          {
-            bool v;
-            if (reader.get(i-&gt;first.c_str(), v))
-              set_bool(i-&gt;first, v);
-          }
-        else if (dynamic_cast&lt;ConfigValue&lt;float&gt;*&gt;(i-&gt;second))
-          {
-            float v;
-            if (reader.get(i-&gt;first.c_str(), v))
-              set_float(i-&gt;first, v);
-          }
-        else if (dynamic_cast&lt;ConfigValue&lt;std::string&gt;*&gt;(i-&gt;second))
-          {
-            std::string v;
-            if (reader.get(i-&gt;first.c_str(), v))
-              set_string(i-&gt;first, v);
-          }
-        else 
-          {
-            std::cout &lt;&lt; &quot;Config: Unknown type for: &quot; &lt;&lt; i-&gt;first &lt;&lt; std::endl;
-          }
-      }
-    reader.print_unused_warnings(&quot;configfile&quot;);
-
-    // TODO read controller config
-  } catch(std::exception&amp; e) {
-    std::cerr &lt;&lt; &quot;Couldn't open config file: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;
-              &lt;&lt; &quot;This is normal on first startup!\n&quot;;
-    return;
-  }
-}
-
-void
-Config::save()
-{
-  try {
-    lisp::Writer writer(&quot;config&quot;);
-
-    writer.write_comment(&quot;;; -*- scheme -*-&quot;);
-    writer.write_comment(&quot;;; Windstille Config - automatically read and written on startup/quit&quot;);
-    writer.start_list(&quot;windstille-config&quot;);
-
-    for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-      {
-        if (i-&gt;second-&gt;should_be_saved() &amp;&amp; i-&gt;second-&gt;is_set())
-          {
-            writer.write_comment(&quot;  ;; &quot; + i-&gt;second-&gt;get_docstring()); 
-            i-&gt;second-&gt;write(writer);
-            writer.write_comment(&quot;&quot;);
-          }
-      }
-    // TODO write controller config
-    
-    writer.end_list(&quot;windstille-config&quot;);
-    writer.write_comment(&quot;;; EOF ;;&quot;);
-  } catch(std::exception&amp; e) {
-    std::cerr &lt;&lt; &quot;Couldn't write config file: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-  }
-}
-
-void
-Config::debug_print(std::ostream&amp; out)
-{
-  out &lt;&lt; &quot;Config &quot; &lt;&lt; this &lt;&lt; &quot;:&quot; &lt;&lt; std::endl;
-  for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-    {
-      out &lt;&lt; boost::format(&quot;  %|1$20| = %|2$-20| (%|3$|)&quot;)
-        % i-&gt;second-&gt;get_name()
-        % (boost::format(&quot;'%|1s|'&quot;) % (*i-&gt;second))
-        % (i-&gt;second-&gt;is_set() ? &quot;set&quot; : &quot;default&quot;)
-          &lt;&lt; std::endl;
-      
-    }
-}
-
-template&lt;&gt;
-void ConfigValue&lt;bool&gt;::write(lisp::Writer&amp; writer) {
-  writer.write_bool(get_name(), data);
-}
-
-template&lt;&gt;
-void ConfigValue&lt;int&gt;::write(lisp::Writer&amp; writer) {
-  writer.write_int(get_name(), data);
-}
-
-template&lt;&gt;
-void ConfigValue&lt;float&gt;::write(lisp::Writer&amp; writer) {
-  writer.write_float(get_name(), data);
-}
-
-template&lt;&gt;
-void ConfigValue&lt;std::string&gt;::write(lisp::Writer&amp; writer) {
-  writer.write_string(get_name(), data);
-}
-
-
-/* EOF */
-

Deleted: trunk/windstille/src/config.hpp
===================================================================
--- trunk/windstille/src/config.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/config.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,170 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CONFIG_HPP
-#define HEADER_WINDSTILLE_CONFIG_HPP
-
-#include &lt;map&gt;
-#include &lt;string&gt;
-#include &lt;typeinfo&gt;
-#include &lt;stdexcept&gt;
-#include &quot;lisp/writer.hpp&quot;
-
-class ConfigValueBase
-{
-private:
-  std::string name;
-  std::string docstring;
-
-protected:
-  bool has_been_set;
-  bool do_save;
-
-public:
-  ConfigValueBase(const std::string&amp; name_, const std::string&amp; docstring_, bool do_save_)
-    : name(name_), docstring(docstring_),
-      has_been_set(false),
-      do_save(do_save_)
-  {   
-  }
-
-  virtual ~ConfigValueBase() {}
-
-  const std::string&amp; get_name() { return name; }
-  const std::string&amp; get_docstring() { return docstring; }
-
-  bool is_set() {
-    return has_been_set;
-  }
-
-  bool should_be_saved() {
-    return do_save;
-  }
-
-  virtual std::ostream&amp; print(std::ostream&amp; os) const =0;
-
-  virtual void write(lisp::Writer&amp; writer) =0;
-};
-
-template&lt;class T&gt;
-class ConfigValue : public ConfigValueBase
-{
-private:
-  T    data;
-
-public:
-  ConfigValue(const std::string&amp; name_, const std::string&amp; docstring_, bool do_save_, const T&amp; data_)
-    : ConfigValueBase(name_, docstring_, do_save_),
-      data(data_)
-  {
-    has_been_set = true;
-  }
-
-  ConfigValue(const std::string&amp; name_, const std::string&amp; docstring_, bool do_save_)
-    : ConfigValueBase(name_, docstring_, do_save_)
-  {    
-    has_been_set = false;
-  }
-
-  const T&amp; get() const { 
-    return data; 
-  }
-
-  T&amp; get() { 
-    return data;
-  }
-
-  T&amp; set(const T&amp; data_) {
-    data = data_;
-    has_been_set  = true;
-    return data;
-  }
-  
-  T&amp; operator=(const T&amp; data_) {
-    return set(data_);
-  }
-
-  void write(lisp::Writer&amp; writer);
-
-  std::ostream&amp; print(std::ostream&amp; os) const {
-    return (os &lt;&lt; data);
-  }
-};
-
-inline std::ostream&amp; operator&lt;&lt;(std::ostream &amp;o, const ConfigValueBase&amp; value)
-{
-  return value.print(o);
-}
-
-class Config
-{
-private:
-  typedef std::map&lt;std::string, ConfigValueBase*&gt; ConfigValues;
-  ConfigValues config_values;
-
-  void add(ConfigValueBase*);
-public:
-  Config();
-  ~Config();
-
-  void set_defaults();
-
-  void parse_args(int argc, char** argv);
-
-  void load();
-  void save();
-
-  bool has_key(const std::string&amp; name);
-
-  bool is_set(const std::string&amp; name);
-
-  template&lt;class T&gt;
-  ConfigValue&lt;T&gt;&amp; get(const std::string&amp; name) const {
-    ConfigValues::const_iterator i = config_values.find(name);
-    if (i == config_values.end())
-      {
-        throw std::runtime_error(&quot;Error: unknown Config value: '&quot; + name + &quot;'&quot;);
-      }
-    else
-      {
-        ConfigValue&lt;T&gt;* ptr = dynamic_cast&lt;ConfigValue&lt;T&gt;*&gt;(i-&gt;second);
-        if (ptr)
-          return *ptr;
-        else
-          throw std::runtime_error(&quot;Error: Config value: '&quot; + name + &quot;' as wrong type&quot;);
-      }
-  }
-
-  std::string get_string(const std::string&amp; name) const;
-  bool        get_bool  (const std::string&amp; name) const;
-  int         get_int   (const std::string&amp; name) const;
-  float       get_float (const std::string&amp; name) const;
-
-  void set_string(const std::string&amp; name, const std::string&amp; value);
-  void set_bool  (const std::string&amp; name, bool  value);
-  void set_int   (const std::string&amp; name, int   value);
-  void set_float (const std::string&amp; name, float value);
-
-  void debug_print(std::ostream&amp; out);
-};
-
-extern Config config;
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/console.cpp
===================================================================
--- trunk/windstille/src/console.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/console.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,590 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;assert.h&gt;
-#include &quot;math/rect.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;screen/game_session.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;engine/script_manager.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;scripting/util.hpp&quot;
-#include &quot;console.hpp&quot;
-
-Console console;
-
-class ConsoleStreambuf : public std::streambuf
-{
-public:
-  ConsoleStreambuf(Console* console_)
-    : console(console_)
-  {
-    setp(buf, buf+sizeof(buf));
-  }
-
-  ~ConsoleStreambuf()
-  {
-    sync();
-  }
-
-protected:
-  virtual int overflow(int c)
-  {
-    if(pbase() == pptr())
-      return 0;
-
-    size_t size = pptr() - pbase();
-    console-&gt;add(pbase(), size);
-      
-    if(c != traits_type::eof()) {
-      char str[1];
-      str[0] = c;
-      console-&gt;add(str, 1);
-    }
-
-    setp(buf, buf + size);
-
-    return 0;
-  }
-
-  virtual int sync()
-  {
-    return overflow(traits_type::eof());
-  }
-
-private:
-  Console* console;
-  char buf[1024];
-};
-
-//-------------------------------------------------------------------------------
-
-class ConsoleImpl
-{
-public:
-  Console&amp; console;
-
-  struct ConsoleEntry {
-    std::string message;
-    float display_time;
-  };
-
-  int x_pos;
-  int y_pos;
-  typedef std::vector&lt;ConsoleEntry&gt; Buffer;
-  Buffer buffer;
-
-  std::string command_line;
-  bool active;
-  std::vector&lt;std::string&gt; history;
-  int history_position;
-
-  int cursor_pos;
-
-  int scroll_offset;
-  ConsoleEntry current_entry;
-
-  ConsoleImpl(Console&amp; console_)
-    : console(console_)
-  {
-    x_pos = 16;
-    y_pos = 600-16;
-
-    active = false;
-    history_position = 1; 
-
-    scroll_offset = 0;
-    cursor_pos  = 0;   
-  }
-
-  void draw();
-  void update(float delta);
-  void eval_command_line();
-  void tab_complete();
-
-  /** adds a newline if the current line contains content */
-  void maybe_newline();
-
-  std::vector&lt;std::string&gt; get_roottable();
-
-  void execute(const std::string&amp; str);
-
-  void add(char* buf, int len)
-  {
-    current_entry.display_time = 0;
-
-    for (int i = 0; i &lt; len; ++i)
-      {
-        if (buf[i] == '\n' || (current_entry.message.size() &gt; 80 &amp;&amp; buf[i] == ' ')) // primitive linebreak
-          {
-            buffer.push_back(current_entry);
-            current_entry = ConsoleEntry();
-          }
-        else
-          {
-            current_entry.message += buf[i];
-          }
-      }
-  }
-};
-
-//-------------------------------------------------------------------------------
-
-void
-ConsoleImpl::draw()
-{
-  int y = y_pos;
-
-  if (active)
-    y -= Fonts::ttffont-&gt;get_height() + 2;
-
-  int num_lines = 600 / (Fonts::ttffont-&gt;get_height() + 2);
-
-  if (console.is_active())
-    Display::fill_rect(Rect(0,0, 800, 600),
-                       Color(0, 0, 0, 0.5f));
-
-  for(int i = buffer.size()-1 - scroll_offset; i &gt;= 0 &amp;&amp; i &gt; int(buffer.size()) - num_lines - scroll_offset; --i)
-    {
-      if (buffer[i].display_time &lt; 5.0f || console.is_active())
-        {
-          float alpha = 1.0f;
-          if (buffer[i].display_time &gt; 4.0f &amp;&amp; !console.is_active())
-            alpha = 1.0f - (buffer[i].display_time - 4.0f);
-
-          Fonts::ttffont-&gt;draw(x_pos, y, buffer[i].message, Color(0.88f, 0.88f, 1.0f, alpha));
-        }
-      y -= Fonts::ttffont-&gt;get_height() + 2;
-    }
-
-  if (active)
-    {
-      std::string str = command_line;
-      if (SDL_GetTicks() % 300 &gt; 150)
-        {
-          if (cursor_pos &lt; int(str.size()))
-            str[cursor_pos] = '_';
-          else
-            str += &quot;_&quot;;
-        }
-
-      Fonts::ttffont-&gt;draw(x_pos, y_pos, &quot;&gt; &quot; + str, Color(1.0f, 1.0f, 1.0f));
-    }
-}
-
-void
-ConsoleImpl::update(float delta)
-{
-  for(Buffer::iterator i = buffer.begin(); i != buffer.end(); ++i)
-    {
-      i-&gt;display_time += delta;
-    }  
-
-  if (active)
-    {
-      InputEventLst events = InputManager::get_controller().get_events();
-  
-      for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
-        {
-          if ((*i).type == KEYBOARD_EVENT)
-            {
-              if ((*i).keyboard.key_type == KeyboardEvent::LETTER)
-                {
-                  if (cursor_pos == int(command_line.size()))
-                    {
-                      command_line += (char)(*i).keyboard.code;
-                      cursor_pos += 1;
-                    }
-                  else
-                    {
-                      command_line.insert(cursor_pos, std::string(1, (char)(*i).keyboard.code));
-                      cursor_pos += 1;
-                    }
-                }
-              else if ((*i).keyboard.key_type == KeyboardEvent::SPECIAL)
-                {
-                  //console &lt;&lt; &quot;special: &quot; &lt;&lt; i-&gt;keyboard.code &lt;&lt; std::endl;
-
-                  switch (i-&gt;keyboard.code)
-                    {
-                    case SDLK_BACKSPACE:
-                      if (!command_line.empty() &amp;&amp; cursor_pos &gt; 0)
-                        {
-                          command_line.erase(cursor_pos - 1, 1);
-                          cursor_pos -= 1;
-                        }
-                      break;
-
-                    case SDLK_DELETE:
-                      if (!command_line.empty())
-                        {
-                          command_line.erase(cursor_pos, 1);
-                        }
-                      break;
-
-                    case SDLK_DOWN:
-                      if (!history.empty())
-                        {
-                          history_position += 1;
-                          if (history_position &gt; int(history.size())-1)
-                            history_position = int(history.size())-1;
-                          command_line = history[history_position];
-                          cursor_pos = command_line.size();
-                        }
-                      break;
-
-                    case SDLK_HOME:
-                      cursor_pos = 0;
-                      break;
-                      
-                    case SDLK_END:
-                      cursor_pos = command_line.size();
-                      break;
-                        
-                    case SDLK_PAGEUP:
-                      console.scroll(10);
-                      break;
-
-                    case SDLK_PAGEDOWN:
-                      console.scroll(-10);
-                      break;
-
-                    case SDLK_TAB:
-                      tab_complete();
-                      break;
-
-                    case SDLK_UP:
-                      if (!history.empty())
-                        {
-                          history_position -= 1;
-                          if (history_position &lt; 0)
-                            history_position = 0;
-
-                          command_line = history[history_position];
-                          cursor_pos = command_line.size();
-                        }
-                      break;
-
-                    case SDLK_LEFT:
-                      cursor_pos -= 1;
-                      if (cursor_pos &lt; 0)
-                        cursor_pos = 0;
-                      break;
-
-                    case SDLK_RIGHT:
-                      cursor_pos += 1;
-                      if (cursor_pos &gt; int(command_line.size()))
-                        cursor_pos = command_line.size();
-                      break;
-
-                    case SDLK_RETURN:
-                      eval_command_line();
-                      break;
-
-                    case SDLK_ESCAPE:
-                    case SDLK_F1:
-                      console.deactive();
-                      break;
-                    }
-                }
-            }
-        }
-    }
-}
-
-void
-ConsoleImpl::maybe_newline()
-{
-  console &lt;&lt; std::flush;
-  if (!current_entry.message.empty())
-    {
-      console &lt;&lt; std::endl;
-    }
-}
-
-std::vector&lt;std::string&gt;
-ConsoleImpl::get_roottable()
-{
-  std::vector&lt;std::string&gt; roottable;
-  HSQUIRRELVM v = script_manager-&gt;get_vm();
-
-  sq_pushroottable(v);
-
-  //push your table/array here
-  sq_pushnull(v);  //null iterator
-  while(SQ_SUCCEEDED(sq_next(v,-2)))
-    {
-      //here -1 is the value and -2 is the key
-      const SQChar *s;
-      if (SQ_SUCCEEDED(sq_getstring(v,-2, &amp;s)))
-        {
-          roottable.push_back((char*)s);
-        }
-      else
-        {
-          console &lt;&lt; &quot;Unknown key type for element&quot; &lt;&lt; std::endl;
-        }
-                              
-      sq_pop(v,2); //pops key and val before the nex iteration
-    }
-                          
-  sq_pop(v, 1);
-  
-  return roottable;
-}
-
-static bool has_prefix(const std::string&amp; lhs, const std::string rhs)
-{
-  if (lhs.length() &lt; rhs.length())
-    return false;
-  else
-    return lhs.compare(0, rhs.length(), rhs) == 0;
-}
-
-static std::string longest_prefix(const std::string&amp; lhs, const std::string rhs)
-{
-  std::string::size_type i;
-  for(i = 0; i &lt; lhs.size() &amp;&amp; i &lt; rhs.size() &amp;&amp; lhs[i] == rhs[i]; ++i);
-  return lhs.substr(0, i);
-}
-
-static std::string find_longest_prefix(const std::vector&lt;std::string&gt;&amp; lst)
-{
-  if (lst.empty())
-    {
-      return &quot;&quot;;
-    }
-  else
-    {
-      std::string prefix = lst.front();
-
-      for(std::vector&lt;std::string&gt;::const_iterator i = lst.begin() + 1; 
-          i != lst.end(); ++i)
-        {
-          prefix = longest_prefix(prefix, *i);
-        }
-
-      return prefix;
-    }
-}
-
-void
-ConsoleImpl::tab_complete()
-{
-  const std::vector&lt;std::string&gt;&amp; roottable = get_roottable();
-  std::vector&lt;std::string&gt; completions;
-
-  for(std::vector&lt;std::string&gt;::const_iterator i = roottable.begin();
-      i != roottable.end();
-      ++i)
-    {
-      if (has_prefix(*i, command_line))
-        {
-          completions.push_back(*i);
-        }
-    }
-
-  if (completions.empty())
-    {
-      // console &lt;&lt; &quot;No completions&quot; &lt;&lt; std::endl;
-    }
-  else if (completions.size() == 1)
-    {
-      command_line = completions.front();
-      cursor_pos = command_line.size();
-    }
-  else 
-    {
-      console &lt;&lt; &quot;&gt; &quot; &lt;&lt; command_line &lt;&lt; std::endl;
-      for(std::vector&lt;std::string&gt;::iterator i = completions.begin(); i != completions.end(); ++i)
-        {
-          console &lt;&lt; *i &lt;&lt; &quot; &quot;;
-        }
-      console &lt;&lt; std::endl;
-
-      command_line = find_longest_prefix(completions);
-      cursor_pos = command_line.size();
-    }
-}
-
-void
-ConsoleImpl::eval_command_line()
-{
-  if (!command_line.empty() &amp;&amp; (history.empty() || history.back() != command_line))
-    {
-      history.push_back(command_line);
-      history_position = history.size();
-    }
-                      
-  console &lt;&lt; &quot;&gt; &quot; &lt;&lt; command_line &lt;&lt; std::endl;
-
-  if (command_line == &quot;quit&quot; || command_line == &quot;exit&quot;)
-    {
-      console.deactive();
-    }
-  else if (command_line == &quot;help&quot;)
-    {
-      console &lt;&lt; &quot;This is a script console, can enter stuff in here that will then be evaluated.\n&quot;
-              &lt;&lt; &quot;Type 'quit' to exit the console.&quot; &lt;&lt; std::endl;
-    }
-  else if (command_line == &quot;reset&quot;)
-    {
-      GameSession::current()-&gt;set_sector(&quot;levels/newformat2.wst&quot;);
-    }
-  else if (command_line == &quot;show&quot;)
-    {
-      HSQUIRRELVM v = script_manager-&gt;get_vm();
-
-      int size = sq_getsize(v, -1);
-      console &lt;&lt; size &lt;&lt; &quot; elements on the root table&quot; &lt;&lt; std::endl;
-
-      sq_pushroottable(v);
-
-      //push your table/array here
-      sq_pushnull(v);  //null iterator
-      while(SQ_SUCCEEDED(sq_next(v,-2)))
-        {
-          //here -1 is the value and -2 is the key
-          const SQChar *s;
-          if (SQ_SUCCEEDED(sq_getstring(v,-2, &amp;s)))
-            {
-              console &lt;&lt; s &lt;&lt; &quot; -&gt; &quot; &lt;&lt; Scripting::squirrel2string(v, -1) &lt;&lt; std::endl;
-            }
-          else
-            {
-              console &lt;&lt; &quot;Unknown key type for element&quot; &lt;&lt; std::endl;
-            }
-                              
-          sq_pop(v,2); //pops key and val before the nex iteration
-        }
-                          
-      sq_pop(v, 1);
-    }
-  else
-    {
-      execute(command_line);
-      maybe_newline();
-    }
-  command_line = &quot;&quot;;
-  cursor_pos = 0;
-}
-
-void
-ConsoleImpl::execute(const std::string&amp; str_)
-{
-  std::string str = str_; //&quot;return (&quot; + str_ + &quot;)&quot;;
-
-  int i = str.length();
-  const char* buffer = str.c_str();
-
-  HSQUIRRELVM vm = script_manager-&gt;get_vm();
-  int oldtop = sq_gettop(vm); 
-  try {
-    int retval = 1;
-
-    if(i &gt; 0) 
-      {
-        if(SQ_SUCCEEDED(sq_compilebuffer(vm, buffer, i, _SC(&quot;interactive console&quot;), SQTrue)))
-          {
-            sq_pushroottable(vm);
-            if(SQ_SUCCEEDED(sq_call(vm, 1, retval, true))) 
-              {
-                // FIXME: This does only work when somebody is doing a 'return', i.e. almost never
-                if (sq_gettype(vm, -1) != OT_NULL)
-                  console &lt;&lt; Scripting::squirrel2string(vm, -1) &lt;&lt; std::endl;
-                // else
-                //   console &lt;&lt; &quot;(null)&quot; &lt;&lt; std::endl;
-              }
-          }
-      }
-  } catch(std::exception&amp; e) {
-    std::cerr &lt;&lt; &quot;Couldn't execute command '&quot; &lt;&lt; str_ &lt;&lt; &quot;': &quot;
-              &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-  }
-
-  sq_settop(vm, oldtop);
-}
-
-//-------------------------------------------------------------------------------
-
-Console::Console()
-  : std::ostream(new ConsoleStreambuf(this)),
-    impl(new ConsoleImpl(*this))
-{
-}
-
-void
-Console::activate()
-{
-  // Get rid of all input events so that we don't double press
-  InputManager::clear();
-  impl-&gt;active = true;
-
-  SDL_EnableKeyRepeat(SDL_DEFAULT_REPEAT_DELAY, SDL_DEFAULT_REPEAT_INTERVAL);
-}
-
-void
-Console::deactive()
-{
-  impl-&gt;active = false;
-
-  SDL_EnableKeyRepeat(0, SDL_DEFAULT_REPEAT_INTERVAL);
-}
-
-bool
-Console::is_active() const
-{
-  return impl-&gt;active;
-}
-
-void
-Console::draw()
-{
-  impl-&gt;draw();
-}
-
-void
-Console::update(float delta)
-{
-  impl-&gt;update(delta);
-}
-
-void
-Console::add(char* buf, int len)
-{
-  impl-&gt;add(buf, len);
-}
-
-void
-Console::scroll(int lines)
-{
-  impl-&gt;scroll_offset += lines;
-  
-  if (impl-&gt;scroll_offset &lt; 0)
-    impl-&gt;scroll_offset = 0;
-  else if (impl-&gt;scroll_offset &gt;= int(impl-&gt;buffer.size()))
-    impl-&gt;scroll_offset = impl-&gt;buffer.size()-1;
-}
-
-void
-Console::execute(const std::string&amp; str)
-{
-  impl-&gt;execute(str);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/console.hpp
===================================================================
--- trunk/windstille/src/console.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/console.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,56 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CONSOLE_HPP
-#define HEADER_WINDSTILLE_CONSOLE_HPP
-
-#include &lt;vector&gt;
-#include &lt;sstream&gt;
-
-class ConsoleImpl;
-
-class Console : public std::ostream
-{
-public:
-  Console();
-
-  void draw();
-  void update(float delta);
-
-  void activate();
-  void deactive();
-  bool is_active() const;
-
-  void scroll(int lines);
-
-  void add(char* buf, int len);
-  
-  /** execute the given string */
-  void execute(const std::string&amp; str);
-private:
-  Console (const Console&amp;);
-  Console&amp; operator= (const Console&amp;);
-
-  ConsoleImpl* impl;
-};
-
-extern Console console;
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/controller_def.cpp
===================================================================
--- trunk/windstille/src/controller_def.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/controller_def.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,23 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;controller_def.hpp&quot;
-
-ControllerDescription controller_description;
-
-/* EOF */

Deleted: trunk/windstille/src/controller_def.hpp
===================================================================
--- trunk/windstille/src/controller_def.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/controller_def.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,72 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CONTROLLER_DEF_HPP
-#define HEADER_WINDSTILLE_CONTROLLER_DEF_HPP
-
-#include &lt;map&gt;
-#include &lt;string&gt;
-#include &quot;input/input_event.hpp&quot;
-#include &quot;input/controller_description.hpp&quot;
-
-enum InputEventName
-  { 
-    MOUSE_MOTION_X, 
-    MOUSE_MOTION_Y, 
-
-    X_AXIS, // used to run left/right
-    Y_AXIS,  // used to aim up/down
-
-    X2_AXIS,
-    Y2_AXIS, 
-    
-    VIEW_CENTER_BUTTON,
-
-    PRIMARY_BUTTON,   // used to ok a dialog or for running
-    SECONDARY_BUTTON, // used to cancel a dialog or for jumping
-    TERTIARY_BUTTON,  // used to cancel a dialog or for jumping
-    PDA_BUTTON,       // display the PDA
-    INVENTORY_BUTTON, // display inventory button
-    
-    PAUSE_BUTTON,     // used to pause the game
-    AIM_BUTTON,       // used to draw the gun and aim
-
-    // Keys for menu navigation, they come with hardcoded defaults for
-    // the keyboard, a joystick might emmit them as well
-    ESCAPE_BUTTON,
-    ENTER_BUTTON,
-
-    MENU_UP_BUTTON,  
-    MENU_DOWN_BUTTON,
-    MENU_LEFT_BUTTON,
-    MENU_RIGHT_BUTTON,
-
-    LAST_EVENT
-  };
-
-#define JUMP_BUTTON   PRIMARY_BUTTON
-#define RUN_BUTTON    TERTIARY_BUTTON
-#define USE_BUTTON    SECONDARY_BUTTON
-#define OK_BUTTON     PRIMARY_BUTTON
-#define CANCEL_BUTTON SECONDARY_BUTTON
-
-extern ControllerDescription controller_description;
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/display/display.cpp
===================================================================
--- trunk/windstille/src/display/display.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/display/display.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -23,8 +23,8 @@
 #include &lt;fstream&gt;
 #include &lt;stdexcept&gt;
 #include &lt;SDL.h&gt;
-#include &quot;console.hpp&quot;
-#include &quot;config.hpp&quot;
+#include &quot;app/console.hpp&quot;
+#include &quot;app/config.hpp&quot;
 #include &quot;math/math.hpp&quot;
 #include &quot;display/opengl_state.hpp&quot;
 #include &quot;display.hpp&quot;

Modified: trunk/windstille/src/display/opengl_state.cpp
===================================================================
--- trunk/windstille/src/display/opengl_state.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/display/opengl_state.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -23,7 +23,7 @@
 #include &lt;iostream&gt;
 #include &quot;texture.hpp&quot;
 #include &quot;color.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;display/display.hpp&quot;
 #include &quot;util/util.hpp&quot;
 

Modified: trunk/windstille/src/display/surface_manager.cpp
===================================================================
--- trunk/windstille/src/display/surface_manager.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/display/surface_manager.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -25,7 +25,7 @@
 #include &lt;GL/glew.h&gt;
 #include &lt;GL/gl.h&gt;
 #include &quot;util/util.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;texture.hpp&quot;
 #include &quot;surface.hpp&quot;
 #include &quot;texture_manager.hpp&quot;

Modified: trunk/windstille/src/display/texture_manager.cpp
===================================================================
--- trunk/windstille/src/display/texture_manager.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/display/texture_manager.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -25,7 +25,7 @@
 #include &lt;GL/glew.h&gt;
 #include &lt;GL/gl.h&gt;
 #include &quot;util/util.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;texture.hpp&quot;
 #include &quot;physfs/physfs_sdl.hpp&quot;
 

Modified: trunk/windstille/src/engine/entity.cpp
===================================================================
--- trunk/windstille/src/engine/entity.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/engine/entity.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -17,7 +17,7 @@
 */
 
 #include &lt;assert.h&gt;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 #include &quot;entity.hpp&quot;

Modified: trunk/windstille/src/engine/script_manager.cpp
===================================================================
--- trunk/windstille/src/engine/script_manager.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/engine/script_manager.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -11,7 +11,7 @@
 #include &lt;sqstdmath.h&gt;
 #include &lt;sqstdstring.h&gt;
 
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;scripting/wrapper.hpp&quot;
 #include &quot;scripting/util.hpp&quot;
 #include &quot;scripting/squirrel_error.hpp&quot;

Modified: trunk/windstille/src/engine/sector.cpp
===================================================================
--- trunk/windstille/src/engine/sector.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/engine/sector.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -20,7 +20,7 @@
 #include &lt;sstream&gt;
 #include &lt;stdexcept&gt;
 #include &quot;util/sexpr_file_reader.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;objects/background_gradient.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;

Modified: trunk/windstille/src/font/fonts.cpp
===================================================================
--- trunk/windstille/src/font/fonts.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/font/fonts.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;border_font_effect.hpp&quot;
 #include &quot;fonts.hpp&quot;
 

Deleted: trunk/windstille/src/globals.cpp
===================================================================
--- trunk/windstille/src/globals.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/globals.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,41 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;globals.hpp&quot;
-
-std::string datadir;
-
-int TILE_SIZE    = 32;
-int TILE_RESOLUTION = 64;
-
-float game_time = 0.0f;
-
-float game_speed = 1.0f;
-#ifdef DEBUG
-bool debug = true;
-#else
-bool debug = false;
-#endif
-bool collision_debug = false;
-bool sound_disabled  = false;
-
-bool sprite3dview    = false;
-bool sprite2dview    = false;
-bool particleview    = false;
-
-/* EOF */

Deleted: trunk/windstille/src/globals.hpp
===================================================================
--- trunk/windstille/src/globals.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/globals.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,52 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_GLOBALS_HPP
-#define HEADER_WINDSTILLE_GLOBALS_HPP
-
-#include &lt;string&gt;
-
-typedef enum { WEST, EAST} Direction;
-
-extern int TILE_SIZE;
-extern int TILE_RESOLUTION;
-
-const float GRAVITY = 1500;
-
-/** datadir =&gt; /usr/local/share/games/windstille/ */
-extern std::string datadir;
-
-/**
- * This is the global game time in seconds. Should be the same as normal time,
- * except that it stops when the game pauses
- */
-extern float game_time;
-
-extern float game_speed;
-
-extern bool debug;
-extern bool collision_debug;
-extern bool sprite3dview;
-extern bool sprite2dview;
-extern bool particleview;
-
-enum GameMainState { RUN_GAME, LOAD_MENU, LOAD_GAME_SESSION, QUIT_GAME };
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/gui/root_component.cpp
===================================================================
--- trunk/windstille/src/gui/root_component.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/gui/root_component.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -18,7 +18,7 @@
 
 #include &lt;iostream&gt;
 #include &lt;algorithm&gt;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;root_component.hpp&quot;
 

Modified: trunk/windstille/src/hud/dialog_manager.cpp
===================================================================
--- trunk/windstille/src/hud/dialog_manager.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/hud/dialog_manager.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -25,7 +25,7 @@
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;display/text_area.hpp&quot;
 #include &quot;display/display.hpp&quot;
-#include &quot;config.hpp&quot;
+#include &quot;app/config.hpp&quot;
 
 DialogManager* DialogManager::current_ = 0;
 

Modified: trunk/windstille/src/hud/dialog_manager.hpp
===================================================================
--- trunk/windstille/src/hud/dialog_manager.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/hud/dialog_manager.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -22,7 +22,7 @@
 #include &lt;vector&gt;
 #include &lt;string&gt;
 #include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;screen/screen.hpp&quot;
 
 class TextArea;

Modified: trunk/windstille/src/hud/energy_bar.cpp
===================================================================
--- trunk/windstille/src/hud/energy_bar.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/hud/energy_bar.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 #include &quot;energy_bar.hpp&quot;
 

Modified: trunk/windstille/src/input/controller.cpp
===================================================================
--- trunk/windstille/src/input/controller.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/input/controller.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -18,7 +18,7 @@
 */
 
 #include &lt;assert.h&gt;
-#include &quot;controller_def.hpp&quot;
+#include &quot;app/controller_def.hpp&quot;
 #include &quot;controller.hpp&quot;
 
 Controller::Controller()

Modified: trunk/windstille/src/input/controller.hpp
===================================================================
--- trunk/windstille/src/input/controller.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/input/controller.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -20,7 +20,7 @@
 #define HEADER_WINDSTILLE_INPUT_CONTROLLER_HPP
 
 #include &lt;vector&gt;
-#include &quot;controller_def.hpp&quot;
+#include &quot;app/controller_def.hpp&quot;
 #include &quot;input_event.hpp&quot;
 
 /** The Controller class presents the current state of the controller

Modified: trunk/windstille/src/input/input_configurator.cpp
===================================================================
--- trunk/windstille/src/input/input_configurator.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/input/input_configurator.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -20,7 +20,7 @@
 #include &lt;stdexcept&gt;
 #include &quot;display/display.hpp&quot;
 #include &quot;math/rect.hpp&quot;
-#include &quot;controller_def.hpp&quot;
+#include &quot;app/controller_def.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;screen/screen_manager.hpp&quot;
 #include &quot;input/input_manager_sdl.hpp&quot;

Modified: trunk/windstille/src/input/input_manager_sdl.cpp
===================================================================
--- trunk/windstille/src/input/input_manager_sdl.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/input/input_manager_sdl.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -25,9 +25,9 @@
 #include &lt;stdio.h&gt;
 #include &lt;vector&gt;
 #include &quot;math/math.hpp&quot;
-#include &quot;config.hpp&quot;
+#include &quot;app/config.hpp&quot;
 #include &quot;util/file_reader.hpp&quot;
-#include &quot;controller_def.hpp&quot;
+#include &quot;app/controller_def.hpp&quot;
 #include &quot;input_manager_sdl.hpp&quot;
 #ifdef HAVE_CWIID
 #include &quot;wiimote.hpp&quot;

Deleted: trunk/windstille/src/menu_manager.cpp
===================================================================
--- trunk/windstille/src/menu_manager.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/menu_manager.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,633 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;boost/bind.hpp&gt;
-#include &quot;config.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;screen/game_session.hpp&quot;
-#include &quot;gui/group_component.hpp&quot;
-#include &quot;gui/gui_manager.hpp&quot;
-#include &quot;gui/menu_component.hpp&quot;
-#include &quot;gui/root_component.hpp&quot;
-#include &quot;gui/text_view.hpp&quot;
-#include &quot;screen/particle_viewer.hpp&quot;
-#include &quot;screen/screen_manager.hpp&quot;
-#include &quot;engine/sector.hpp&quot;
-#include &quot;sprite3d/manager.hpp&quot;
-#include &quot;screen/sprite3dview.hpp&quot;
-#include &quot;screen/geometry_test.hpp&quot;
-#include &quot;screen/armature_test.hpp&quot;
-#include &quot;screen/navigation_test.hpp&quot;
-#include &quot;gui/menu_item.hpp&quot;
-#ifdef HAVE_CWIID
-#include &quot;input/wiimote.hpp&quot;
-#endif
-#include &quot;menu_manager.hpp&quot;
-
-MenuManager menu_manager;
-
-MenuManager::MenuManager()
-{
-}
-
-void
-MenuManager::display_option_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-250, 300-170), Sizef(500, 340)), 
-                                             &quot;Options&quot;,
-                                             manager-&gt;get_root());
-
-  // Begin Menu
-  MenuComponent* menu = new MenuComponent(Rectf(), true,
-                                          group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  SliderMenuItem* music_volume_item = new SliderMenuItem(menu,  &quot;Master Volume&quot;,   
-                                                         config.get_int(&quot;master-volume&quot;), 0, 100, 10);
-  music_volume_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_music_volume, this, _1));
-  menu-&gt;add_item(music_volume_item);
-
-  SliderMenuItem* sfx_volume_item   = new SliderMenuItem(menu,  &quot;SFX Volume&quot;,   100, 0, 100, 10);
-  menu-&gt;add_item(sfx_volume_item);
-
-  SliderMenuItem* voice_volume_item = new SliderMenuItem(menu,  &quot;Voice Volume&quot;, 100, 0, 100, 10);
-  menu-&gt;add_item(voice_volume_item);
-
-  EnumMenuItem* aspect_item = new EnumMenuItem(menu,  &quot;Aspect Ratio&quot;, 0);
-  aspect_item-&gt;add_pair(0, &quot;4:3&quot;);
-  aspect_item-&gt;add_pair(1, &quot;5:4&quot;);
-  aspect_item-&gt;add_pair(2, &quot;16:9&quot;);
-  aspect_item-&gt;add_pair(3, &quot;16:10&quot;);
-  aspect_item-&gt;add_pair(4, &quot;letterbox&quot;);
-  menu-&gt;add_item(aspect_item);
-  
-  EnumMenuItem* show_fps_item = new EnumMenuItem(menu,  &quot;Show FPS&quot;, config.get_bool(&quot;show-fps&quot;));
-  show_fps_item-&gt;add_pair(0, &quot;off&quot;);
-  show_fps_item-&gt;add_pair(1, &quot;on&quot;);
-  menu-&gt;add_item(show_fps_item);
-  show_fps_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_show_fps, this, _1));
-
-  EnumMenuItem* fullscreen_item = new EnumMenuItem(menu,  &quot;Fullscreen&quot;, config.get_bool(&quot;fullscreen&quot;));
-  fullscreen_item-&gt;add_pair(0, &quot;off&quot;);
-  fullscreen_item-&gt;add_pair(1, &quot;on&quot;);
-  menu-&gt;add_item(fullscreen_item);
-  fullscreen_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_fullscreen, this, _1));
-
-  EnumMenuItem* difficulty_item = new EnumMenuItem(menu,  &quot;Difficulty&quot;, 1);
-  difficulty_item-&gt;add_pair(0, &quot;easy&quot;);
-  difficulty_item-&gt;add_pair(1, &quot;medium&quot;);
-  difficulty_item-&gt;add_pair(2, &quot;hard&quot;);
-  menu-&gt;add_item(difficulty_item);
-
-  SliderMenuItem* gamma_item   = new SliderMenuItem(menu,  &quot;Gamma&quot;,  100, 10, 200, 10);
-  gamma_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_gamma, this, _1));
-  menu-&gt;add_item(gamma_item);
-
-  #ifdef HAVE_CWIID
-  if (wiimote)
-    {
-      ButtonMenuItem* wiimote_button = new ButtonMenuItem(menu,  &quot;Try to Connect Wiimote&quot;);
-      wiimote_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_wiimote, this));
-      menu-&gt;add_item(wiimote_button);
-    }
-  #endif
-
-  manager-&gt;get_root()-&gt;add_child(group);
-  group-&gt;layout();
-  screen_manager.push_overlay(manager);
-}
-
-void
-MenuManager::display_main_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* text_group = new GroupComponent(Rectf(10, 500+20, 800-10, 600-10),
-                                                  &quot;&quot;,
-                                                  manager-&gt;get_root());
-
-  TextView* text = new TextView(Rectf(), text_group);
-  text_group-&gt;pack(text);
-  text-&gt;set_font(Fonts::vera12);
-  text-&gt;set_text(&quot;Windstille 0.4.0 - Copyright (C) 2009 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
-                 &quot;\n&quot;
-                 &quot;This program is free software: you can redistribute it and/or modify &quot;
-                 &quot;it under the terms of the GNU General Public License as published by &quot;
-                 &quot;the Free Software Foundation, either version 3 of the License, or &quot;
-                 &quot;(at your option) any later version.&quot;);
-
-  manager-&gt;get_root()-&gt;add_child(text_group);
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-25, 200), Sizef(250, 294)),
-                                             &quot;&quot;,
-                                             manager-&gt;get_root());
-
-  // Begin Menu
-  MenuComponent* menu = new MenuComponent(Rectf(), false,
-                                          group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  ButtonMenuItem* select_scenario_button = new ButtonMenuItem(menu,  &quot;Select Scenario&quot;);
-  select_scenario_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_scenario_menu, this));
-  menu-&gt;add_item(select_scenario_button);
-
-  ButtonMenuItem* navigation_test_button = new ButtonMenuItem(menu,  &quot;Navigation Test&quot;);
-  navigation_test_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_show_navigation_test, this));
-  menu-&gt;add_item(navigation_test_button);
-
-  ButtonMenuItem* armature_test_button = new ButtonMenuItem(menu,  &quot;Armature Test&quot;);
-  armature_test_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_show_armature_test, this));
-  menu-&gt;add_item(armature_test_button);
-
-  ButtonMenuItem* geometry_test_button = new ButtonMenuItem(menu,  &quot;Geometry Test&quot;);
-  geometry_test_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_show_geometry_test, this));
-  menu-&gt;add_item(geometry_test_button);
-
-  ButtonMenuItem* model_viewer_button = new ButtonMenuItem(menu,  &quot;Model Viewer&quot;);
-  model_viewer_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_models_menu, this));
-  menu-&gt;add_item(model_viewer_button);
-
-  ButtonMenuItem* particles_button = new ButtonMenuItem(menu,  &quot;Particle Systems&quot;);
-  particles_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_particle_menu, this));
-  menu-&gt;add_item(particles_button);
-
-  ButtonMenuItem* options_button = new ButtonMenuItem(menu,  &quot;Options&quot;);
-  options_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_option_menu, this));
-  menu-&gt;add_item(options_button);
-
-  ButtonMenuItem* credits_button = new ButtonMenuItem(menu,  &quot;Credits&quot;);
-  credits_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_credits, this));
-  menu-&gt;add_item(credits_button);
-
-  ButtonMenuItem* help_button = new ButtonMenuItem(menu,  &quot;Help&quot;);
-  help_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_help, this));
-  menu-&gt;add_item(help_button);
-
-  ButtonMenuItem* quit_button = new ButtonMenuItem(menu,  &quot;Quit&quot;);
-  quit_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_quit, this));
-  menu-&gt;add_item(quit_button);
-  // End: Option Menu
-
-  manager-&gt;get_root()-&gt;add_child(group);
-  group-&gt;layout();
-  screen_manager.push_overlay(manager);
-}
-
-void
-MenuManager::display_pause_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-200, 300-170), Sizef(400, 300)), 
-                                             &quot;Pause Menu&quot;,
-                                             manager-&gt;get_root());
-
-  // Begin Menu
-  MenuComponent* menu = new MenuComponent(Rectf(Vector(400-150, 200), Sizef(300, 500)), true,
-                                          group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  ButtonMenuItem* continue_button = new ButtonMenuItem(menu,  &quot;Resume Game&quot;);
-  continue_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_continue, this));
-  menu-&gt;add_item(continue_button);
-
-  //  ButtonMenuItem* select_scenario_button = new ButtonMenuItem(menu,  &quot;Select Scenario&quot;);
-  //  select_scenario_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_scenario_menu, this));
-  // menu-&gt;add_item(select_scenario_button);
-
-  ButtonMenuItem* options_button = new ButtonMenuItem(menu,  &quot;Options&quot;);
-  options_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_option_menu, this));
-  menu-&gt;add_item(options_button);
-
-  ButtonMenuItem* debug_button = new ButtonMenuItem(menu,  &quot;Debug&quot;);
-  debug_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_debug_menu, this));
-  menu-&gt;add_item(debug_button);
-
-  ButtonMenuItem* credits_button = new ButtonMenuItem(menu,  &quot;Credits&quot;);
-  credits_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_credits, this));
-  menu-&gt;add_item(credits_button);
-
-  ButtonMenuItem* help_button = new ButtonMenuItem(menu,  &quot;Help&quot;);
-  help_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::display_help, this));
-  menu-&gt;add_item(help_button);
-
-  ButtonMenuItem* quit_button = new ButtonMenuItem(menu,  &quot;Return to Title Screen&quot;);
-  quit_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_exit, this));
-  menu-&gt;add_item(quit_button);
-  // End: Option Menu
-
-  manager-&gt;get_root()-&gt;add_child(group);
-
-  screen_manager.push_overlay(manager); 
-}
-
-void
-MenuManager::display_models_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-275, 100), Sizef(550, 376)),  // 378
-                                             &quot;Select Model&quot;,
-                                             manager-&gt;get_root());
-
-  MenuComponent* menu = new MenuComponent(Rectf(), true, group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  std::vector&lt;std::string&gt; models;
-  models.push_back(&quot;models/characters/bob/bob.wsprite&quot;);
-  models.push_back(&quot;models/characters/jane/jane.wsprite&quot;);
-  models.push_back(&quot;models/characters/monster/monster.wsprite&quot;);
-  models.push_back(&quot;models/characters/powersuit/powersuit.wsprite&quot;);
-  models.push_back(&quot;models/characters/sophie/sophie.wsprite&quot;);
-  models.push_back(&quot;models/characters/spider/spider.wsprite&quot;);
-  models.push_back(&quot;models/characters/vrdummy/vrdummy.wsprite&quot;);
-  models.push_back(&quot;models/characters/yagor/yagor.wsprite&quot;);
-  models.push_back(&quot;models/objects/grenade/grenade.wsprite&quot;);
-  models.push_back(&quot;models/objects/pistol/pistol.wsprite&quot;);
-  models.push_back(&quot;models/vehicles/shuttle/shuttle.wsprite&quot;);
-  models.push_back(&quot;models/vehicles/train/train.wsprite&quot;); 
-
-  for(std::vector&lt;std::string&gt;::iterator i = models.begin(); i != models.end(); ++i)
-    {
-      ButtonMenuItem* scenario_button = new ButtonMenuItem(menu,  *i);
-
-      scenario_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_show_model, this, std::string(*i)));
-
-      menu-&gt;add_item(scenario_button);
-    }
-
-  manager-&gt;get_root()-&gt;add_child(group);
-
-  screen_manager.push_overlay(manager);  
-}
-
-void
-MenuManager::display_particle_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-200, 300-170), Sizef(400, 340)), 
-                                             &quot;Particle Systems&quot;,
-                                             manager-&gt;get_root());
-
-  MenuComponent* menu = new MenuComponent(Rectf(), true, group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  std::vector&lt;std::string&gt; scenarios;
-  scenarios.push_back(&quot;particlesystems/fire.particles&quot;);
-  
-  for(std::vector&lt;std::string&gt;::iterator i = scenarios.begin(); i != scenarios.end(); ++i)
-    {
-      ButtonMenuItem* scenario_button = new ButtonMenuItem(menu,  *i);
-
-      scenario_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_show_particle_system, this, *i));
-
-      menu-&gt;add_item(scenario_button);
-    }
-
-  manager-&gt;get_root()-&gt;add_child(group);
-
-  screen_manager.push_overlay(manager); 
-}
-
-void
-MenuManager::display_scenario_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-200, 300-170), Sizef(400, 340)), 
-                                             &quot;Select Scenario&quot;,
-                                             manager-&gt;get_root());
-
-  MenuComponent* menu = new MenuComponent(Rectf(), true, group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  std::vector&lt;std::string&gt; scenarios;
-  scenarios.push_back(&quot;levels/apartment.wst&quot;);
-  scenarios.push_back(&quot;levels/bluestone.wst&quot;);
-  scenarios.push_back(&quot;levels/forest.wst&quot;);
-  scenarios.push_back(&quot;levels/industrial.wst&quot;);
-  scenarios.push_back(&quot;levels/intro.wst&quot;);
-  scenarios.push_back(&quot;levels/newformat2.wst&quot;);
-  scenarios.push_back(&quot;levels/virtualreality.wst&quot;);
-  
-  for(std::vector&lt;std::string&gt;::iterator i = scenarios.begin(); i != scenarios.end(); ++i)
-    {
-      ButtonMenuItem* scenario_button = new ButtonMenuItem(menu,  *i);
-
-      scenario_button-&gt;sig_click().connect(boost::bind(&amp;MenuManager::menu_start_scenario, this, *i));
-
-      menu-&gt;add_item(scenario_button);
-    }
-
-  manager-&gt;get_root()-&gt;add_child(group);
-
-  screen_manager.push_overlay(manager); 
-}
-
-void
-MenuManager::display_debug_menu()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-250, 300-170), Sizef(500, 340)), 
-                                             &quot;Debug&quot;,
-                                             manager-&gt;get_root());
-
-  // Begin Menu
-  MenuComponent* menu = new MenuComponent(Rectf(), true, group);
-  group-&gt;pack(menu);
-
-  menu-&gt;set_font(Fonts::vera20);
-
-  Color amb = Sector::current()-&gt;get_ambient_light();
-
-  SliderMenuItem* r_ambient_light_item = new SliderMenuItem(menu,  &quot;Ambient Light (Red)&quot;, int(amb.r*100), 0, 100, 10);
-  r_ambient_light_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_ambient_light, this, _1, 0));
-  menu-&gt;add_item(r_ambient_light_item);
-
-  SliderMenuItem* g_ambient_light_item = new SliderMenuItem(menu,  &quot;Ambient Light (Green)&quot;, int(amb.g*100), 0, 100, 10);
-  g_ambient_light_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_ambient_light, this, _1, 1));
-  menu-&gt;add_item(g_ambient_light_item);
-
-  SliderMenuItem* b_ambient_light_item = new SliderMenuItem(menu,  &quot;Ambient Light (Blue)&quot;, int(amb.b*100), 0, 100, 10);
-  b_ambient_light_item-&gt;sig_change().connect(boost::bind(&amp;MenuManager::menu_ambient_light, this, _1, 2));
-  menu-&gt;add_item(b_ambient_light_item);
-
-  manager-&gt;get_root()-&gt;add_child(group);
-
-  screen_manager.push_overlay(manager); 
-}
-
-void
-MenuManager::display_help()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-250, 300-200), Sizef(500, 400)), 
-                                             &quot;Help&quot;,
-                                             manager-&gt;get_root());
-
-  TextView* text = new TextView(Rectf(), group);
-  group-&gt;pack(text);
-
-  text-&gt;set_font(Fonts::vera12);
-  text-&gt;set_text(&quot;This is a tech-demo of Windstille. Its not meant &quot;
-                 &quot;to be playable in any way except a bit of walking around. &quot;
-                 &quot;It provides nothing to accomplish, just a few scenarios to &quot;
-                 &quot;load and look at. Enjoy what works, don't complain if something &quot;
-                 &quot;doesn't, since most stuff simply won't work anyway.\n&quot;
-                 &quot;\n&quot;
-                 &quot;Key Bindings\n&quot;
-                 &quot;============\n&quot;
-                 &quot;F1 - open the console\n&quot;
-                 &quot;F6 - mouse release\n&quot;
-                 &quot;F7 - mouse grap\n&quot;
-                 &quot;F8 - run gui test (broken)\n&quot;
-                 &quot;F9 - configure input\n&quot;
-                 &quot;F11 - toggle fullscreen\n&quot;
-                 &quot;F12 - do a screenshot\n&quot;
-                 &quot;\n&quot;
-                 &quot;cursor keys - walk\n&quot;
-                 &quot;d - run/cancel\n&quot;
-                 &quot;s - jump/ok\n&quot;
-                 );
-  text-&gt;set_active(true);
-
-  manager-&gt;get_root()-&gt;add_child(group);
-  screen_manager.push_overlay(manager);
-}
-
-void
-MenuManager::display_credits()
-{
-  using namespace gui;
-  GUIManager* manager = new GUIManager();
-
-  GroupComponent* group = new GroupComponent(Rectf(Vector(400-250, 300-200), Sizef(500, 400)), 
-                                             &quot;Credits&quot;,
-                                             manager-&gt;get_root());
-
-  TextView* text = new TextView(Rectf(), group);
-  group-&gt;pack(text);
-
-  text-&gt;set_font(Fonts::vera12);
-  text-&gt;set_text(&quot;Programming\n&quot;
-                 &quot;===========\n&quot;
-                 &quot;\n&quot;
-                 &quot;  Ingo Ruhnke - Grumbel - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
-                 &quot;  Matthias Braun - MatzeB - <A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>\n&quot;
-                 &quot;  James Gregory -\n&quot;
-                 &quot;  David Kamphausen - Godrin - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">david.kamphausen at web.de</A>&gt;\n&quot;
-                 &quot;  Mark Dillavou - Line72- &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">line72 at line72.net</A>&gt;\n&quot;
-                 &quot;\n&quot;
-                 &quot;Graphics\n&quot;
-                 &quot;========\n&quot;
-                 &quot;  Ingo Ruhnke - Grumbel - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
-                 &quot;  Ken Hirsch - quickflash - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">khirsch11414 at yahoo.com</A>&gt;\n&quot;
-                 &quot;\n&quot;
-                 &quot;0.2.0 Win32 Build\n&quot;
-                 &quot;==================\n&quot;
-                 &quot;  Robert Konrad &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">rkon at gmx.de</A>&gt;\n&quot;
-                 &quot;\n&quot;
-                 &quot;Music\n&quot;
-                 &quot;=====\n&quot;
-                 &quot;  Ralph Weinert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">r.weinert at bluewin.ch</A>&gt;\n&quot;
-                 &quot;  Marek Moeckel - Wansti - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">wansti at gmx.de</A>&gt;\n&quot;);
-  text-&gt;set_active(true);
-
-  manager-&gt;get_root()-&gt;add_child(group);
-  screen_manager.push_overlay(manager);
-}
-  
-// Callbacks
-
-void
-MenuManager::menu_show_model(std::string model)
-{
-  Sprite3DView* sprite3dview = new Sprite3DView();
-
-  sprite3dview-&gt;set_model(model);
-
-  // Launching Sprite3DView instead of game
-  screen_manager.push_screen(sprite3dview);
-  screen_manager.clear_overlay();
-}
-
-void
-MenuManager::menu_show_particle_system(std::string file)
-{
-  ParticleViewer* particle_viewer = new ParticleViewer();
-  particle_viewer-&gt;load(file);
-
-  screen_manager.push_screen(particle_viewer);
-  screen_manager.clear_overlay();
-}
-
-void
-MenuManager::menu_start_game()
-{
-  screen_manager.push_screen(new GameSession(&quot;levels/newformat2.wst&quot;));
-  screen_manager.pop_overlay();
-}
-
-void
-MenuManager::menu_quit()
-{
-  //GameSession::current()-&gt;quit();
-  screen_manager.pop_overlay();
-  screen_manager.quit();
-}
-
-void
-MenuManager::menu_start_scenario(std::string scenario)
-{
-  std::cout &lt;&lt; &quot;Starting: &quot; &lt;&lt; scenario &lt;&lt; std::endl;
-  screen_manager.push_screen(new GameSession(scenario));
-  screen_manager.clear_overlay();
- }
-
-void
-MenuManager::menu_show_fps(int i)
-{
-  config.set_bool(&quot;show-fps&quot;, i);
-}
-
-void
-MenuManager::menu_fullscreen(int i)
-{
-  config.set_bool(&quot;fullscreen&quot;, i);
-  Display::set_fullscreen(config.get_bool(&quot;fullscreen&quot;));
-}
-
-void
-MenuManager::menu_continue()
-{
-  screen_manager.pop_overlay();
-}
-
-void
-MenuManager::menu_exit()
-{
-  // FIXME: Make this return to the title screen
-  screen_manager.pop_overlay();
-  screen_manager.pop_screen(); 
-}
-
-void
-MenuManager::menu_ambient_light(int i, int component)
-{
-  if (Sector::current())
-    {
-      Color amb = Sector::current()-&gt;get_ambient_light();
-
-      if (component == 0)
-        amb.r = i / 100.0f;
-      else if (component == 1)
-        amb.g = i / 100.0f;
-      else if (component == 2)
-        amb.b = i / 100.0f;
-
-      Sector::current()-&gt;set_ambient_light(amb);
-    }
-}
-
-void
-MenuManager::menu_show_geometry_test()
-{
-  screen_manager.push_screen(new GeometryTest());
-  screen_manager.clear_overlay();  
-}
-
-void
-MenuManager::menu_show_armature_test()
-{
-  screen_manager.push_screen(new ArmatureTest());
-  screen_manager.clear_overlay();  
-}
-
-void
-MenuManager::menu_show_navigation_test()
-{
-  screen_manager.push_screen(new NavigationTest());
-  screen_manager.clear_overlay();  
-}
-
-void
-MenuManager::menu_gamma(int i)
-{
-  float gamma = i / 100.0f;
-  SDL_SetGamma(gamma, gamma, gamma);
-}
-
-void
-MenuManager::menu_wiimote()
-{
-#ifdef HAVE_CWIID
-  if (wiimote &amp;&amp; !wiimote-&gt;is_connected())
-    {
-      // FIXME: This never appears on screen due to timeout
-      console &lt;&lt; &quot;Trying to connect Wiimote: Press buttons 1 and 2 to connect&quot; &lt;&lt; std::endl;
-
-      wiimote-&gt;connect();
-
-      if (wiimote-&gt;is_connected())
-        console &lt;&lt; &quot;Wiimote connected&quot; &lt;&lt; std::endl;
-      else
-        console &lt;&lt; &quot;Wiimote connection failed&quot; &lt;&lt; std::endl;
-    }
-  else
-    {
-      console &lt;&lt; &quot;Wiimote already is connected&quot; &lt;&lt; std::endl;
-    }
-#endif
-}
-
-void
-MenuManager::menu_music_volume(int i)
-{
-  config.set_int(&quot;master-volume&quot;, i);
-  sound_manager-&gt;set_listener_gain((i/100.0f));
-}
-
-/* EOF */

Deleted: trunk/windstille/src/menu_manager.hpp
===================================================================
--- trunk/windstille/src/menu_manager.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/menu_manager.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,68 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_MENU_MANAGER_HPP
-#define HEADER_WINDSTILLE_MENU_MANAGER_HPP
-
-#include &lt;vector&gt;
-
-/** */
-class MenuManager
-{
-private:
-
-public:
-  MenuManager();
-
-  void display_option_menu();
-  void display_debug_menu();
-  void display_main_menu();
-  void display_pause_menu();
-  void display_scenario_menu();
-  void display_particle_menu();
-  void display_models_menu();
-  void display_credits();
-  void display_help();
-
-  // Callbacks
-  void menu_start_game();
-  void menu_quit();
-  void menu_exit();
-  void menu_show_fps(int i);
-  void menu_fullscreen(int i);
-  void menu_continue();
-  void menu_music_volume(int i);
-  void menu_ambient_light(int i, int component);
-  void menu_start_scenario(std::string scenario);
-  void menu_show_model(std::string scenario);
-  void menu_show_geometry_test();
-  void menu_show_armature_test();
-  void menu_show_navigation_test();
-  void menu_show_particle_system(std::string file);
-  void menu_gamma(int i);
-  void menu_wiimote();
-private:
-  MenuManager (const MenuManager&amp;);
-  MenuManager&amp; operator= (const MenuManager&amp;);
-};
-
-extern MenuManager menu_manager;
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/mt19937ar.c
===================================================================
--- trunk/windstille/src/mt19937ar.c	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/mt19937ar.c	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,190 +0,0 @@
-/* 
-   A C-program for MT19937, with initialization improved 2002/1/26.
-   Coded by Takuji Nishimura and Makoto Matsumoto.
-
-   Before using, initialize the state by using init_genrand(seed)  
-   or init_by_array(init_key, key_length).
-
-   Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,
-   All rights reserved.                          
-
-   Redistribution and use in source and binary forms, with or without
-   modification, are permitted provided that the following conditions
-   are met:
-
-     1. Redistributions of source code must retain the above copyright
-        notice, this list of conditions and the following disclaimer.
-
-     2. Redistributions in binary form must reproduce the above copyright
-        notice, this list of conditions and the following disclaimer in the
-        documentation and/or other materials provided with the distribution.
-
-     3. The names of its contributors may not be used to endorse or promote 
-        products derived from this software without specific prior written 
-        permission.
-
-   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
-   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
-   A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
-   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
-   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
-   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
-   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
-   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
-   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
-   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-
-   Any feedback is very welcome.
-   <A HREF="http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html">http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html</A>
-   email: m-mat @ math.sci.hiroshima-u.ac.jp (remove space)
-*/
-
-#include &lt;stdio.h&gt;
-
-/* Period parameters */  
-#define N 624
-#define M 397
-#define MATRIX_A 0x9908b0dfUL   /* constant vector a */
-#define UPPER_MASK 0x80000000UL /* most significant w-r bits */
-#define LOWER_MASK 0x7fffffffUL /* least significant r bits */
-
-static unsigned long mt[N]; /* the array for the state vector  */
-static int mti=N+1; /* mti==N+1 means mt[N] is not initialized */
-
-/* initializes mt[N] with a seed */
-void init_genrand(unsigned long s)
-{
-    mt[0]= s &amp; 0xffffffffUL;
-    for (mti=1; mti&lt;N; mti++) {
-        mt[mti] = 
-	    (1812433253UL * (mt[mti-1] ^ (mt[mti-1] &gt;&gt; 30)) + mti); 
-        /* See Knuth TAOCP Vol2. 3rd Ed. P.106 for multiplier. */
-        /* In the previous versions, MSBs of the seed affect   */
-        /* only MSBs of the array mt[].                        */
-        /* 2002/01/09 modified by Makoto Matsumoto             */
-        mt[mti] &amp;= 0xffffffffUL;
-        /* for &gt;32 bit machines */
-    }
-}
-
-/* initialize by an array with array-length */
-/* init_key is the array for initializing keys */
-/* key_length is its length */
-/* slight change for C++, 2004/2/26 */
-void init_by_array(unsigned long init_key[], int key_length)
-{
-    int i, j, k;
-    init_genrand(19650218UL);
-    i=1; j=0;
-    k = (N&gt;key_length ? N : key_length);
-    for (; k; k--) {
-        mt[i] = (mt[i] ^ ((mt[i-1] ^ (mt[i-1] &gt;&gt; 30)) * 1664525UL))
-          + init_key[j] + j; /* non linear */
-        mt[i] &amp;= 0xffffffffUL; /* for WORDSIZE &gt; 32 machines */
-        i++; j++;
-        if (i&gt;=N) { mt[0] = mt[N-1]; i=1; }
-        if (j&gt;=key_length) j=0;
-    }
-    for (k=N-1; k; k--) {
-        mt[i] = (mt[i] ^ ((mt[i-1] ^ (mt[i-1] &gt;&gt; 30)) * 1566083941UL))
-          - i; /* non linear */
-        mt[i] &amp;= 0xffffffffUL; /* for WORDSIZE &gt; 32 machines */
-        i++;
-        if (i&gt;=N) { mt[0] = mt[N-1]; i=1; }
-    }
-
-    mt[0] = 0x80000000UL; /* MSB is 1; assuring non-zero initial array */ 
-}
-
-/* generates a random number on [0,0xffffffff]-interval */
-unsigned long genrand_int32(void)
-{
-    unsigned long y;
-    static unsigned long mag01[2]={0x0UL, MATRIX_A};
-    /* mag01[x] = x * MATRIX_A  for x=0,1 */
-
-    if (mti &gt;= N) { /* generate N words at one time */
-        int kk;
-
-        if (mti == N+1)   /* if init_genrand() has not been called, */
-            init_genrand(5489UL); /* a default initial seed is used */
-
-        for (kk=0;kk&lt;N-M;kk++) {
-            y = (mt[kk]&amp;UPPER_MASK)|(mt[kk+1]&amp;LOWER_MASK);
-            mt[kk] = mt[kk+M] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
-        }
-        for (;kk&lt;N-1;kk++) {
-            y = (mt[kk]&amp;UPPER_MASK)|(mt[kk+1]&amp;LOWER_MASK);
-            mt[kk] = mt[kk+(M-N)] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
-        }
-        y = (mt[N-1]&amp;UPPER_MASK)|(mt[0]&amp;LOWER_MASK);
-        mt[N-1] = mt[M-1] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
-
-        mti = 0;
-    }
-  
-    y = mt[mti++];
-
-    /* Tempering */
-    y ^= (y &gt;&gt; 11);
-    y ^= (y &lt;&lt; 7) &amp; 0x9d2c5680UL;
-    y ^= (y &lt;&lt; 15) &amp; 0xefc60000UL;
-    y ^= (y &gt;&gt; 18);
-
-    return y;
-}
-
-/* generates a random number on [0,0x7fffffff]-interval */
-long genrand_int31(void)
-{
-    return (long)(genrand_int32()&gt;&gt;1);
-}
-
-/* generates a random number on [0,1]-real-interval */
-double genrand_real1(void)
-{
-    return genrand_int32()*(1.0/4294967295.0); 
-    /* divided by 2^32-1 */ 
-}
-
-/* generates a random number on [0,1)-real-interval */
-double genrand_real2(void)
-{
-    return genrand_int32()*(1.0/4294967296.0); 
-    /* divided by 2^32 */
-}
-
-/* generates a random number on (0,1)-real-interval */
-double genrand_real3(void)
-{
-    return (((double)genrand_int32()) + 0.5)*(1.0/4294967296.0); 
-    /* divided by 2^32 */
-}
-
-/* generates a random number on [0,1) with 53-bit resolution*/
-double genrand_res53(void) 
-{ 
-    unsigned long a=genrand_int32()&gt;&gt;5, b=genrand_int32()&gt;&gt;6; 
-    return(a*67108864.0+b)*(1.0/9007199254740992.0); 
-} 
-/* These real versions are due to Isaku Wada, 2002/01/09 added */
-
-int main(void)
-{
-    int i;
-    unsigned long init[4]={0x123, 0x234, 0x345, 0x456}, length=4;
-    init_by_array(init, length);
-    printf(&quot;1000 outputs of genrand_int32()\n&quot;);
-    for (i=0; i&lt;1000; i++) {
-      printf(&quot;%10lu &quot;, genrand_int32());
-      if (i%5==4) printf(&quot;\n&quot;);
-    }
-    printf(&quot;\n1000 outputs of genrand_real2()\n&quot;);
-    for (i=0; i&lt;1000; i++) {
-      printf(&quot;%10.8f &quot;, genrand_real2());
-      if (i%5==4) printf(&quot;\n&quot;);
-    }
-    return 0;
-}

Modified: trunk/windstille/src/objects/bomb.cpp
===================================================================
--- trunk/windstille/src/objects/bomb.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/bomb.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;bomb.hpp&quot;
 

Modified: trunk/windstille/src/objects/box.cpp
===================================================================
--- trunk/windstille/src/objects/box.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/box.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -19,7 +19,7 @@
 #include &lt;stdexcept&gt;
 #include &lt;boost/bind.hpp&gt;
 #include &quot;box.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;math/vector.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;

Modified: trunk/windstille/src/objects/character.cpp
===================================================================
--- trunk/windstille/src/objects/character.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/character.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -23,7 +23,7 @@
 #include &quot;hud/dialog_manager.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;physfs/physfs_stream.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
 #include &quot;util/util.hpp&quot;
 

Modified: trunk/windstille/src/objects/hedgehog.cpp
===================================================================
--- trunk/windstille/src/objects/hedgehog.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/hedgehog.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;player.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;hedgehog.hpp&quot;

Modified: trunk/windstille/src/objects/nightvision.cpp
===================================================================
--- trunk/windstille/src/objects/nightvision.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/nightvision.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;math/random.hpp&quot;
 #include &quot;math/matrix.hpp&quot;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;

Modified: trunk/windstille/src/objects/player.cpp
===================================================================
--- trunk/windstille/src/objects/player.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/player.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -21,10 +21,10 @@
 #include &quot;engine/sector.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
-#include &quot;controller_def.hpp&quot;
+#include &quot;app/controller_def.hpp&quot;
 #include &quot;player.hpp&quot;
 #include &quot;objects/bomb.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;hud/pda.hpp&quot;
 #include &quot;tile/tile.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;
@@ -35,7 +35,7 @@
 #include &quot;laser_pointer.hpp&quot;
 #include &quot;collision/stair_contact.hpp&quot;
 #include &quot;screen/game_session.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;grenade.hpp&quot;
 #include &quot;pistol.hpp&quot;
 

Modified: trunk/windstille/src/objects/player.hpp
===================================================================
--- trunk/windstille/src/objects/player.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/player.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -25,7 +25,7 @@
 #include &quot;sprite3d/sprite3d.hpp&quot;
 #include &quot;sound/sound_source.hpp&quot;
 #include &quot;math/vector.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;engine/entity.hpp&quot;
 #include &quot;util/ref.hpp&quot;
 #include &quot;display/surface.hpp&quot;

Modified: trunk/windstille/src/objects/scriptable_object.cpp
===================================================================
--- trunk/windstille/src/objects/scriptable_object.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/scriptable_object.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -17,7 +17,7 @@
 */
 
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;scriptable_object.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;

Modified: trunk/windstille/src/objects/swarm.cpp
===================================================================
--- trunk/windstille/src/objects/swarm.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/objects/swarm.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;player.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
 #include &quot;hedgehog.hpp&quot;

Modified: trunk/windstille/src/particles/surface_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/surface_drawer.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/particles/surface_drawer.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -18,7 +18,7 @@
 
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;particle_system.hpp&quot;
-#include &quot;../console.hpp&quot; 
+#include &quot;app/console.hpp&quot; 
 #include &quot;display/surface_manager.hpp&quot;
 #include &quot;surface_drawer.hpp&quot;
 

Modified: trunk/windstille/src/screen/game_session.cpp
===================================================================
--- trunk/windstille/src/screen/game_session.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/game_session.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -24,10 +24,10 @@
 #include &lt;sqstdio.h&gt; 
 #include &lt;sqstdaux.h&gt; 
 
-#include &quot;menu_manager.hpp&quot;
+#include &quot;app/menu_manager.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;engine/sector.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;engine/game_object.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
@@ -35,7 +35,7 @@
 #include &quot;view.hpp&quot;
 #include &quot;hud/energy_bar.hpp&quot;
 #include &quot;hud/dialog_manager.hpp&quot;
-#include &quot;windstille_main.hpp&quot;
+#include &quot;app/windstille_main.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;scripting/util.hpp&quot;
 #include &quot;scripting/wrapper.hpp&quot;

Modified: trunk/windstille/src/screen/game_session.hpp
===================================================================
--- trunk/windstille/src/screen/game_session.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/game_session.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -22,11 +22,11 @@
 #include &lt;string&gt;
 #include &lt;squirrel.h&gt;
 #include &quot;display/scene_context.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;screen.hpp&quot;
 #include &quot;hud/controller_help_window.hpp&quot;
 #include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 
 class PDA;
 class EnergyBar;

Modified: trunk/windstille/src/screen/geometry_test.cpp
===================================================================
--- trunk/windstille/src/screen/geometry_test.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/geometry_test.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -20,9 +20,9 @@
 #include &lt;GL/gl.h&gt;
 #include &quot;geometry_test.hpp&quot;
 #include &quot;math/rect.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;math/size.hpp&quot;
-#include &quot;controller_def.hpp&quot;
+#include &quot;app/controller_def.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
 #include &quot;display/display.hpp&quot;

Modified: trunk/windstille/src/screen/screen.cpp
===================================================================
--- trunk/windstille/src/screen/screen.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/screen.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -19,12 +19,12 @@
 #include &lt;math.h&gt;
 #include &lt;iostream&gt;
 #include &quot;display/display.hpp&quot;
-#include &quot;windstille_main.hpp&quot;
+#include &quot;app/windstille_main.hpp&quot;
 #include &quot;screen.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;config.hpp&quot;
+#include &quot;app/globals.hpp&quot;
+#include &quot;app/console.hpp&quot;
+#include &quot;app/config.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;input/input_manager_sdl.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;

Modified: trunk/windstille/src/screen/screen_manager.cpp
===================================================================
--- trunk/windstille/src/screen/screen_manager.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/screen_manager.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -24,10 +24,10 @@
 #include &quot;game_session.hpp&quot;
 #include &quot;input/input_manager_sdl.hpp&quot;
 #include &quot;display/display.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;screen.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
-#include &quot;config.hpp&quot;
+#include &quot;app/config.hpp&quot;
 #include &quot;input/input_manager.hpp&quot;
 #include &quot;input/input_configurator.hpp&quot;
 #include &quot;sound/sound_manager.hpp&quot;

Modified: trunk/windstille/src/screen/sprite2dview.cpp
===================================================================
--- trunk/windstille/src/screen/sprite2dview.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/sprite2dview.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -23,7 +23,7 @@
 #include &quot;display/display.hpp&quot;
 #include &quot;sprite2d/manager.hpp&quot;
 #include &quot;math/math.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;input/controller.hpp&quot;
 #include &quot;display/surface_manager.hpp&quot;
 #include &quot;sprite2dview.hpp&quot;

Modified: trunk/windstille/src/screen/sprite3dview.cpp
===================================================================
--- trunk/windstille/src/screen/sprite3dview.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/sprite3dview.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -19,7 +19,7 @@
 #include &lt;iostream&gt;
 #include &quot;input/controller.hpp&quot;
 #include &quot;display/display.hpp&quot;
-#include &quot;console.hpp&quot;
+#include &quot;app/console.hpp&quot;
 #include &quot;font/ttf_font.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;screen_manager.hpp&quot;

Modified: trunk/windstille/src/screen/title_screen.cpp
===================================================================
--- trunk/windstille/src/screen/title_screen.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/screen/title_screen.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -17,7 +17,7 @@
 */
 
 #include &lt;iostream&gt;
-#include &quot;menu_manager.hpp&quot;
+#include &quot;app/menu_manager.hpp&quot;
 #include &quot;title_screen.hpp&quot;
 
 TitleScreen::TitleScreen()

Modified: trunk/windstille/src/scripting/interface.cpp
===================================================================
--- trunk/windstille/src/scripting/interface.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/scripting/interface.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -28,7 +28,7 @@
 #include &quot;engine/sector.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 #include &quot;engine/camera.hpp&quot;
-#include &quot;config.hpp&quot;
+#include &quot;app/config.hpp&quot;
 #include &quot;hud/pda.hpp&quot;
 #include &quot;util/sexpr_file_reader.hpp&quot;
 #include &quot;display/display.hpp&quot;

Modified: trunk/windstille/src/sprite3d/data.cpp
===================================================================
--- trunk/windstille/src/sprite3d/data.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/sprite3d/data.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -24,7 +24,7 @@
 #include &lt;sstream&gt;
 #include &lt;stdexcept&gt;
 #include &quot;util/util.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;display/texture_manager.hpp&quot;
 #include &quot;display/texture.hpp&quot;
 

Modified: trunk/windstille/src/sprite3d/sprite3d.cpp
===================================================================
--- trunk/windstille/src/sprite3d/sprite3d.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/sprite3d/sprite3d.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -28,7 +28,7 @@
 #include &lt;physfs.h&gt;
 #include &quot;display/drawing_request.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;util/util.hpp&quot;
 #include &quot;display/opengl_state.hpp&quot;
 #include &quot;sprite3d/manager.hpp&quot;

Modified: trunk/windstille/src/tile/tile.cpp
===================================================================
--- trunk/windstille/src/tile/tile.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/tile/tile.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -17,7 +17,7 @@
 */
 
 #include &lt;iostream&gt;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;tile.hpp&quot;
 
 Tile::Tile(unsigned int arg_colmap)

Modified: trunk/windstille/src/tile/tile_description.cpp
===================================================================
--- trunk/windstille/src/tile/tile_description.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/tile/tile_description.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -22,7 +22,7 @@
 #include &lt;SDL.h&gt;
 #include &lt;SDL_image.h&gt;
 #include &quot;physfs/physfs_sdl.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;tile.hpp&quot;
 #include &quot;tile_packer.hpp&quot;
 #include &quot;tile_factory.hpp&quot;

Modified: trunk/windstille/src/tile/tile_factory.cpp
===================================================================
--- trunk/windstille/src/tile/tile_factory.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/tile/tile_factory.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -24,7 +24,7 @@
 #include &lt;sstream&gt;
 #include &lt;iostream&gt;
 #include &lt;memory&gt;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;tile.hpp&quot;
 #include &quot;tile_packer.hpp&quot;
 #include &quot;tile_factory.hpp&quot;

Modified: trunk/windstille/src/tile/tile_map.cpp
===================================================================
--- trunk/windstille/src/tile/tile_map.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/tile/tile_map.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -22,7 +22,7 @@
 #include &quot;tile_map.hpp&quot;
 #include &quot;tile.hpp&quot;
 #include &quot;tile_factory.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;view.hpp&quot;
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;

Modified: trunk/windstille/src/tile/tile_map.hpp
===================================================================
--- trunk/windstille/src/tile/tile_map.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/tile/tile_map.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -21,7 +21,7 @@
 
 #include &lt;string&gt;
 
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;util/field.hpp&quot;
 #include &quot;engine/game_object.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;

Modified: trunk/windstille/src/tile/tile_packer.cpp
===================================================================
--- trunk/windstille/src/tile/tile_packer.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/tile/tile_packer.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -20,7 +20,7 @@
 #include &lt;GL/glew.h&gt;
 #include &lt;GL/gl.h&gt;
 #include &quot;display/texture.hpp&quot;
-#include &quot;globals.hpp&quot;
+#include &quot;app/globals.hpp&quot;
 #include &quot;tile_packer.hpp&quot;
 #include &quot;util/util.hpp&quot;
 #include &quot;display/blitter.hpp&quot;

Deleted: trunk/windstille/src/windstille.hpp
===================================================================
--- trunk/windstille/src/windstille.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/windstille.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,26 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2007 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_WINDSTILLE_HPP
-#define HEADER_WINDSTILLE_WINDSTILLE_HPP
-
-#define WINDSTILLE_VERSION &quot;0.4.0&quot;
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/windstille_main.cpp
===================================================================
--- trunk/windstille/src/windstille_main.cpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/windstille_main.cpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,382 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;windstille.hpp&quot;
-
-#include &lt;stdio.h&gt;
-#include &lt;physfs.h&gt;
-
-#include &quot;globals.hpp&quot;
-#include &quot;screen/screen.hpp&quot;
-#include &quot;windstille_main.hpp&quot;
-#include &quot;font/fonts.hpp&quot;
-#include &quot;screen/game_session.hpp&quot;
-#include &quot;screen/title_screen.hpp&quot;
-#include &quot;engine/sector.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-#include &quot;tile/tile_factory.hpp&quot;
-#include &quot;engine/script_manager.hpp&quot;
-#include &quot;config.hpp&quot;
-#include &quot;util/util.hpp&quot;
-#include &quot;font/ttf_font.hpp&quot;
-#include &quot;display/display.hpp&quot;
-#include &quot;display/surface_manager.hpp&quot;
-#include &quot;display/texture_manager.hpp&quot;
-#include &quot;sprite3d/manager.hpp&quot;
-#include &quot;screen/screen_manager.hpp&quot;
-#include &quot;screen/sprite3dview.hpp&quot;
-#include &quot;screen/sprite2dview.hpp&quot;
-#include &quot;screen/particle_viewer.hpp&quot;
-#include &quot;sprite2d/manager.hpp&quot;
-
-#ifdef WIN32
-#include &quot;shlwapi.h&quot;
-#define strcasecmp lstrcmpiA 
-#endif
-
-WindstilleMain::WindstilleMain()
-{
-}
-
-WindstilleMain::~WindstilleMain()
-{
-}
-
-int 
-WindstilleMain::main(int argc, char** argv)
-{
-  try {
-    config.parse_args(argc, argv);
-
-    init_physfs(argv[0]);
-    init_sdl();
-
-    config.load();
-    
-    config.parse_args(argc, argv);
-
-    init_modules();
-
-    { // Fill controller_description with data
-      controller_description.add_button(&quot;primary-button&quot;,   PRIMARY_BUTTON);
-      controller_description.add_button(&quot;secondary-button&quot;, SECONDARY_BUTTON);
-      controller_description.add_button(&quot;tertiary-button&quot;,  TERTIARY_BUTTON);
-
-      controller_description.add_button(&quot;menu-up-button&quot;,   MENU_UP_BUTTON);
-      controller_description.add_button(&quot;menu-down-button&quot;, MENU_DOWN_BUTTON);
-
-      controller_description.add_button(&quot;menu-left-button&quot;,  MENU_LEFT_BUTTON);
-      controller_description.add_button(&quot;menu-right-button&quot;, MENU_RIGHT_BUTTON);
-  
-      controller_description.add_button(&quot;view-center-button&quot;, VIEW_CENTER_BUTTON);
-
-      controller_description.add_button(&quot;pda-button&quot;,       PDA_BUTTON);
-      controller_description.add_button(&quot;inventory-button&quot;, INVENTORY_BUTTON);
-
-      controller_description.add_button(&quot;aim-button&quot;,       AIM_BUTTON);
-      controller_description.add_button(&quot;pause-button&quot;,     PAUSE_BUTTON);
-
-      controller_description.add_axis(&quot;x-axis&quot;, X_AXIS);
-      controller_description.add_axis(&quot;y-axis&quot;, Y_AXIS);
-
-      controller_description.add_axis(&quot;x2-axis&quot;, X2_AXIS);
-      controller_description.add_axis(&quot;y2-axis&quot;, Y2_AXIS);
-
-      controller_description.add_ball(&quot;mouse-motion-x&quot;, MOUSE_MOTION_X);
-      controller_description.add_ball(&quot;mouse-motion-y&quot;, MOUSE_MOTION_Y);
-    }
-    
-    {
-      InputManager::init();
-      
-      if (config.get&lt;std::string&gt;(&quot;primary-controller-file&quot;).is_set())
-        InputManager::load(config.get&lt;std::string&gt;(&quot;primary-controller-file&quot;).get());
-      else
-        InputManager::load(&quot;controller/keyboard.scm&quot;);
-
-      if (config.get&lt;std::string&gt;(&quot;secondary-controller-file&quot;).is_set())
-        InputManager::load(config.get&lt;std::string&gt;(&quot;secondary-controller-file&quot;).get());
-    }
-
-    if (debug) std::cout &lt;&lt; &quot;Initialising TileFactory&quot; &lt;&lt; std::endl;
-    TileFactory::init();
-    
-    if (debug) std::cout &lt;&lt; &quot;Starting file: '&quot; &lt;&lt; config.get_string(&quot;levelfile&quot;) &lt;&lt; &quot;'&quot; 
-                         &lt;&lt; std::endl;
-    
-    std::string levelfile;
-    if (config.get&lt;std::string&gt;(&quot;levelfile&quot;).is_set())
-      {
-        // FIXME: Looks a little hacky, doesn't it?
-        std::string leveldir = dirname(config.get_string(&quot;levelfile&quot;));
-        PHYSFS_addToSearchPath(leveldir.c_str(), true);
-        levelfile = basename(config.get_string(&quot;levelfile&quot;));
-      }
-
-    if (sprite3dview)
-      {
-        Sprite3DView* sprite3dview = new Sprite3DView();
-
-        if (!levelfile.empty())
-          sprite3dview-&gt;set_model(levelfile);
-
-        // Launching Sprite3DView instead of game
-        screen_manager.push_screen(sprite3dview);
-      }
-    else if (sprite2dview)
-      {
-        Sprite2DView* sprite2dview = new Sprite2DView();
-
-        if (!levelfile.empty())
-          sprite2dview-&gt;set_sprite(levelfile);
-
-        // Launching Sprite2DView instead of game
-        screen_manager.push_screen(sprite2dview);
-      }
-    else if (particleview)
-      {
-        ParticleViewer* particle_viewer = new ParticleViewer();
-        if (!levelfile.empty())
-          particle_viewer-&gt;load(levelfile);
-        screen_manager.push_screen(particle_viewer);
-      }
-    else
-      {
-        if (levelfile.empty())
-          {
-            //screen_manager.push_screen(new GameSession(&quot;levels/newformat2.wst&quot;));
-            screen_manager.push_screen(new TitleScreen());
-          }
-        else
-          {
-            screen_manager.push_screen(new GameSession(levelfile));
-          }
-      }
-        
-    screen_manager.run();
-    
-    TileFactory::deinit();
-    InputManager::deinit();
-
-    deinit_modules();
-
-  } catch (std::exception&amp; err) {
-    std::cout &lt;&lt; &quot;std::exception: &quot; &lt;&lt; err.what() &lt;&lt; std::endl;
-  } catch (...) {
-    std::cout &lt;&lt; &quot;Error catched something unknown?!&quot; &lt;&lt; std::endl;
-  }
-
-  config.save();
-
-  SDL_Quit();
-  PHYSFS_deinit();
-
-  return 0;
-}
-
-void
-WindstilleMain::init_modules()
-{
-  if (debug) std::cout &lt;&lt; &quot;Initialising Freetype2&quot; &lt;&lt; std::endl;
-    
-  TTFFont::init();
-  
-  Display::init();
-
-  if (debug) std::cout &lt;&lt; &quot;Initialising Fonts&quot; &lt;&lt; std::endl;
-  Fonts::init(); 
-  sound_manager = new SoundManager();
-  sound_manager-&gt;set_listener_gain(config.get_int(&quot;master-volume&quot;)/100.0f);
-  sound_manager-&gt;enable_sound(config.get_bool(&quot;sound&quot;));
-  sound_manager-&gt;enable_music(config.get_bool(&quot;music&quot;));
-
-  if (debug) std::cout &lt;&lt; &quot;Initialising ScriptManager&quot; &lt;&lt; std::endl;
-  texture_manager  = new TextureManager();
-  surface_manager  = new SurfaceManager();
-  script_manager   = new ScriptManager();
-  sprite2d_manager = new SpriteManager();
-  sprite3d_manager = new sprite3d::Manager();
-
-  script_manager-&gt;run_script_file(&quot;scripts/windstille.nut&quot;);
-}
-
-void
-WindstilleMain::deinit_modules()
-{
-  delete sprite3d_manager;
-  sprite3d_manager = 0;
-
-  delete sprite2d_manager;
-  sprite2d_manager = 0;
-
-  delete script_manager;
-  script_manager = 0;
-
-  delete surface_manager;
-  surface_manager = 0;
-
-  delete texture_manager;
-  texture_manager = 0;
-  
-  delete sound_manager;
-  sound_manager = 0;
-  Fonts::deinit();
-
-  TTFFont::deinit();
-}
-
-void
-WindstilleMain::init_sdl()
-{
-#ifdef DEBUG
-  // I wanna have usefull backtraces in debug mode
-  if(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_JOYSTICK | SDL_INIT_NOPARACHUTE) &lt; 0) {
-#else
-  if(SDL_Init(SDL_INIT_VIDEO | SDL_INIT_JOYSTICK) &lt; 0) {
-#endif
-    std::stringstream msg;
-    msg &lt;&lt; &quot;Couldn't initialize SDL: &quot; &lt;&lt; SDL_GetError();
-    throw std::runtime_error(msg.str());
-  }
-
-  SDL_EnableUNICODE(1);
-}
-
-void
-WindstilleMain::init_physfs(const char* argv0)
-{
-  if(!PHYSFS_init(argv0)) {
-    std::stringstream msg;
-    msg &lt;&lt; &quot;Couldn't initialize physfs: &quot; &lt;&lt; PHYSFS_getLastError();
-    throw std::runtime_error(msg.str());
-  }
-
-  // Initialize physfs (this is a slightly modified version of
-  // PHYSFS_setSaneConfig
-  const char* application = &quot;windstille&quot;;
-  const char* userdir = PHYSFS_getUserDir();
-  const char* dirsep  = PHYSFS_getDirSeparator();
-  char* writedir = new char[strlen(userdir) + strlen(application) + 2];
-
-  // Set configuration directory
-  sprintf(writedir, &quot;%s.%s&quot;, userdir, application);
-  if(!PHYSFS_setWriteDir(writedir)) {
-    // try to create the directory
-    char* mkdir = new char[strlen(application) + 2];
-    sprintf(mkdir, &quot;.%s&quot;, application);
-    if(!PHYSFS_setWriteDir(userdir) || !PHYSFS_mkdir(mkdir)) {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Failed creating configuration directory '&quot;
-          &lt;&lt; writedir &lt;&lt; &quot;': &quot; &lt;&lt; PHYSFS_getLastError();
-      delete[] writedir;
-      delete[] mkdir;
-      throw std::runtime_error(msg.str());
-    }
-    delete[] mkdir;
-
-    if(!PHYSFS_setWriteDir(writedir)) {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Failed to use configuration directory '&quot;
-          &lt;&lt;  writedir &lt;&lt; &quot;': &quot; &lt;&lt; PHYSFS_getLastError();
-      delete[] writedir;
-      throw std::runtime_error(msg.str());
-    }
-  }
-  PHYSFS_addToSearchPath(writedir, 0);
-  delete[] writedir;
-
-  // Search for archives and add them to the search path
-  const char* archiveExt = &quot;zip&quot;;
-  char** rc = PHYSFS_enumerateFiles(&quot;/&quot;);
-  size_t extlen = strlen(archiveExt);
-
-  for(char** i = rc; *i != 0; ++i) {
-    size_t l = strlen(*i);
-    if((l &gt; extlen) &amp;&amp; ((*i)[l - extlen - 1] == '.')) {
-      const char* ext = (*i) + (l - extlen);
-
-      if(strcasecmp(ext, archiveExt) == 0) {
-        const char* d = PHYSFS_getRealDir(*i);
-        char* str = new char[strlen(d) + strlen(dirsep) + l + 1];
-        sprintf(str, &quot;%s%s%s&quot;, d, dirsep, *i);
-        PHYSFS_addToSearchPath(str, 1);
-        delete[] str;
-      }
-    }
-  }
-
-  PHYSFS_freeList(rc);
-
-  // when started from source dir...
-  ::datadir = PHYSFS_getBaseDir();
-  ::datadir += &quot;data/&quot;;
-  std::string testfname = ::datadir;
-  testfname += &quot;tiles.scm&quot;;
-  bool sourcedir = false;
-  FILE* f = fopen(testfname.c_str(), &quot;r&quot;);
-  if(f) {
-    fclose(f);
-    if(!PHYSFS_addToSearchPath(::datadir.c_str(), 1)) {
-      std::cout &lt;&lt; &quot;Warning: Couldn't add '&quot; &lt;&lt; ::datadir
-                &lt;&lt; &quot;' to physfs searchpath: &quot; &lt;&lt; PHYSFS_getLastError() &lt;&lt; &quot;\n&quot;;
-    } else {
-      sourcedir = true;
-    }
-  }
-
-  if(!sourcedir) {
-#if defined(APPDATADIR) || defined(ENABLE_BINRELOC)
-#ifdef ENABLE_BINRELOC
-    char* brdatadir = br_strcat(DATADIR, &quot;/&quot; PACKAGE_NAME);
-    ::datadir = brdatadir;
-    free(brdatadir);
-#else
-    ::datadir = APPDATADIR;
-#endif
-    if(!PHYSFS_addToSearchPath(::datadir.c_str(), 1)) {
-      std::cout &lt;&lt; &quot;Couldn't add '&quot; &lt;&lt; ::datadir
-        &lt;&lt; &quot;' to physfs searchpath: &quot; &lt;&lt; PHYSFS_getLastError() &lt;&lt; &quot;\n&quot;;
-    }
-#endif
-  }
-
-  // allow symbolic links
-  PHYSFS_permitSymbolicLinks(1);
-
-  //show search Path
-  if (debug)
-    {
-      std::cout &lt;&lt; &quot;SearchPath:&quot; &lt;&lt; std::endl;
-      char** search_path = PHYSFS_getSearchPath();
-      for(char** i = search_path; *i != NULL; i++)
-        std::cout &lt;&lt; &quot;  &quot; &lt;&lt; *i &lt;&lt; std::endl;;
-      PHYSFS_freeList(search_path);
-    }
-}
-
-int main(int argc, char** argv)
-{
-  WindstilleMain main_app;
-
-  main_app.main(argc, argv);
-
-  return 0;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/windstille_main.hpp
===================================================================
--- trunk/windstille/src/windstille_main.hpp	2009-02-12 08:24:12 UTC (rev 2469)
+++ trunk/windstille/src/windstille_main.hpp	2009-02-12 08:33:55 UTC (rev 2470)
@@ -1,71 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000,2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-/*! \mainpage Windstille Documentation
- *
- * \section intro_sec Introduction
- *
- * Windstille is a classic 2d jump'n shoot game in which the player
- * will be placed in a foreign alien world and has to find its way
- * back into safety. Windstille is currently available for GNU/Linux
- * and Windows.  Its webpage at which one might find new versions,
- * source code, artworks and more informations is located at:
- *
- * <A HREF="http://windstille.berlios.de/">http://windstille.berlios.de/</A>
- *
- * The latest development version can be obtained by:
- * 
- * $ svn co <A HREF="svn://svn.berlios.de/windstille/trunk/windstille">svn://svn.berlios.de/windstille/trunk/windstille</A>
- * 
- * Windstille is covered under the GNU GPL, which means that you can copy
- * and even modify it pretty much as you like, as long as you keep the
- * copyright headers in place and distribute the source too if you
- * distribute binaries, see the file COPYING for details.
- *
- * \section install_sec Installation
- *
- * To compile Windstille you need:
- *
- * OpenAL, OpenGL, SDL, SDL_image, freetype, libpng, physfs, boost, scons, bison, flex
- */
-
-#ifndef HEADER_WINDSTILLE_WINDSTILLE_MAIN_HPP
-#define HEADER_WINDSTILLE_WINDSTILLE_MAIN_HPP
-
-#include &quot;screen/screen.hpp&quot;
-
-struct SDL_Surface;
-
-class WindstilleMain
-{  
-public:
-  WindstilleMain();
-  ~WindstilleMain();
-
-  int main(int argc, char** argv);
-
-private:
-  void init_sdl();
-  void init_physfs(const char* argv0);
-  void init_modules();
-  void deinit_modules();
-};
-
-#endif
-
-/* EOF */


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001466.html">[Windstille-commit] r2469 - in trunk/windstille/src: . engine	screen sprite3d
</A></li>
	<LI>Next message: <A HREF="001468.html">[Windstille-commit] r2471 - in trunk/windstille/src: . app engine	gui math objects screen tile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1467">[ date ]</a>
              <a href="thread.html#1467">[ thread ]</a>
              <a href="subject.html#1467">[ subject ]</a>
              <a href="author.html#1467">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
