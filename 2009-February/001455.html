<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r2458 - in trunk/windstille/src: . objects	scripting
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2458%20-%20in%20trunk/windstille/src%3A%20.%20objects%0A%09scripting&In-Reply-To=%3C200902111748.n1BHm9ou001296%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001454.html">
   <LINK REL="Next"  HREF="001456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r2458 - in trunk/windstille/src: . objects	scripting</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r2458%20-%20in%20trunk/windstille/src%3A%20.%20objects%0A%09scripting&In-Reply-To=%3C200902111748.n1BHm9ou001296%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r2458 - in trunk/windstille/src: . objects	scripting">grumbel at mail.berlios.de
       </A><BR>
    <I>Wed Feb 11 18:48:09 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001454.html">[Windstille-commit] r2457 - in trunk/windstille/src: . collision	scripting sound sprite2d sprite3d
</A></li>
        <LI>Next message: <A HREF="001456.html">[Windstille-commit] r2459 - in trunk/windstille: doc src src/math	src/navigation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1455">[ date ]</a>
              <a href="thread.html#1455">[ thread ]</a>
              <a href="subject.html#1455">[ subject ]</a>
              <a href="author.html#1455">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2009-02-11 18:47:58 +0100 (Wed, 11 Feb 2009)
New Revision: 2458

Added:
   trunk/windstille/src/objects/box.cpp
   trunk/windstille/src/objects/box.hpp
   trunk/windstille/src/objects/character.cpp
   trunk/windstille/src/objects/character.hpp
   trunk/windstille/src/objects/elevator.cpp
   trunk/windstille/src/objects/elevator.hpp
   trunk/windstille/src/objects/grenade.cpp
   trunk/windstille/src/objects/grenade.hpp
   trunk/windstille/src/objects/liquid.cpp
   trunk/windstille/src/objects/liquid.hpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/objects/player.hpp
   trunk/windstille/src/objects/scriptable_object.cpp
   trunk/windstille/src/objects/scriptable_object.hpp
Removed:
   trunk/windstille/src/box.cpp
   trunk/windstille/src/box.hpp
   trunk/windstille/src/character.cpp
   trunk/windstille/src/character.hpp
   trunk/windstille/src/elevator.cpp
   trunk/windstille/src/elevator.hpp
   trunk/windstille/src/grenade.cpp
   trunk/windstille/src/grenade.hpp
   trunk/windstille/src/liquid.cpp
   trunk/windstille/src/liquid.hpp
   trunk/windstille/src/player.cpp
   trunk/windstille/src/player.hpp
   trunk/windstille/src/scriptable_object.cpp
   trunk/windstille/src/scriptable_object.hpp
Modified:
   trunk/windstille/src/SConscript
   trunk/windstille/src/camera.cpp
   trunk/windstille/src/energy_bar.cpp
   trunk/windstille/src/game_session.cpp
   trunk/windstille/src/laser_pointer.cpp
   trunk/windstille/src/scripting/game_objects.hpp
   trunk/windstille/src/sector.cpp
   trunk/windstille/src/trigger.cpp
   trunk/windstille/src/view.cpp
Log:
Moved all Entity objects into objects/

Modified: trunk/windstille/src/SConscript
===================================================================
--- trunk/windstille/src/SConscript	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/SConscript	2009-02-11 17:47:58 UTC (rev 2458)
@@ -40,149 +40,135 @@
 # env['ENV']['LSBCC_SHAREDLIBS'] = 'png2:SDL:SDL_image:vorbis:ogg:openal:physfs'
 
 env.Program('../windstille', [
-'armature_test.cpp',
 'armature/armature.cpp',
+'armature/bone.cpp',
 'armature/mesh.cpp',
 'armature/model.cpp',
 'armature/pose.cpp',
-'armature/bone.cpp',
+'armature_test.cpp',
 'baby_xml.cpp',
 'blitter.cpp',
-'box.cpp',
 'camera.cpp',
-'character.cpp',
+'collision/collision_data.cpp',
+'collision/collision_engine.cpp',
+'collision/collision_object.cpp',
+'collision/collision_test.cpp',
+'collision/ladder_contact.cpp',
+'collision/stair_contact.cpp',
 'command_line.cpp',
 'command_line_generic.cpp',
+'config.cpp',
 'console.cpp',
 'controller_def.cpp',
 'controller_help_window.cpp',
 'conversation.cpp',
 'dialog_manager.cpp',
-'elevator.cpp',
-'energy_bar.cpp',
-'entity.cpp',
-'file_reader.cpp',
-'sexpr_file_reader.cpp',
-'config.cpp',
-'game_object.cpp',
-'game_session.cpp',
-'globals.cpp',
-'getter.cpp',
-'geometry_test.cpp',
-'graphic_context_state.cpp',
-'grenade.cpp',
-'inventory.cpp',
-'laser_pointer.cpp',
-'liquid.cpp',
-'navigation_test.cpp',
-'pda.cpp',
-'physics.cpp',
-'pistol.cpp',
-'response_curve.cpp',
-'player.cpp',
-'random.cpp',
-'display/render_buffer.cpp',
-'screen.cpp',
-'screen_manager.cpp',
-'scriptable_object.cpp',
-'script_manager.cpp',
-'sector.cpp',
-'sprite3dview.cpp',
-'sprite2dview.cpp',
-'text_area.cpp',
-'tile.cpp',
-'tile_factory.cpp',
-'tile_map.cpp',
-'tile_packer.cpp',
-'tile_description.cpp',
-'timer.cpp',
-'trigger.cpp',
-'title_screen.cpp',
-'util.cpp',
-'view.cpp',
-'windstille_main.cpp',
-'objects/shockwave.cpp',
-'objects/test_object.cpp',
-'objects/bomb.cpp',
-'objects/background_gradient.cpp',
-'objects/hedgehog.cpp',
-'objects/spider_mine.cpp',
-'objects/swarm.cpp',
-'objects/vrdummy.cpp',
-'objects/nightvision.cpp',
-'collision/collision_data.cpp',
-'collision/collision_engine.cpp',
-'collision/collision_object.cpp',
-'collision/collision_test.cpp',
-'collision/ladder_contact.cpp',
-'collision/stair_contact.cpp',
 'display/display.cpp',
 'display/drawing_context.cpp',
 'display/framebuffer.cpp',
+'display/opengl_state.cpp',
+'display/render_buffer.cpp',
 'display/scene_context.cpp',
-'display/vertex_array_drawing_request.cpp',
-'display/opengl_state.cpp',
+'display/shader_object.cpp',
+'display/shader_program.cpp',
 'display/surface.cpp',
 'display/surface_manager.cpp',
 'display/texture.cpp',
 'display/texture_manager.cpp',
-'display/shader_program.cpp',
-'display/shader_object.cpp',
+'display/vertex_array_drawing_request.cpp',
+'energy_bar.cpp',
+'entity.cpp',
+'file_reader.cpp',
 'font/border_font_effect.cpp',
 'font/fonts.cpp',
 'font/ttf_font.cpp',
+'game_object.cpp',
+'game_session.cpp',
+'geometry_test.cpp',
+'getter.cpp',
+'globals.cpp',
+'graphic_context_state.cpp',
 'gui/automap.cpp',
 'gui/button.cpp',
-'gui/menu_component.cpp',
-'gui/menu_item.cpp',
-'gui/label.cpp',
 'gui/component.cpp',
 'gui/component_factory.cpp',
 'gui/grid_component.cpp',
 'gui/group_component.cpp',
 'gui/gui_manager.cpp',
+'gui/label.cpp',
 'gui/list_view.cpp',
+'gui/menu_component.cpp',
+'gui/menu_item.cpp',
 'gui/root_component.cpp',
 'gui/slider.cpp',
 'gui/tab_component.cpp',
 'gui/text_view.cpp',
 'input/controller.cpp',
-'input/wiimote.cpp',
 'input/controller_description.cpp',
 'input/input_configurator.cpp',
 'input/input_manager.cpp',
 'input/input_manager_impl.cpp',
 'input/input_manager_sdl.cpp',
+'input/wiimote.cpp',
+'inventory.cpp',
+'laser_pointer.cpp',
 'lisp/getters.cpp',
 'lisp/lexer.cpp',
 'lisp/lisp.cpp',
 'lisp/parser.cpp',
 'lisp/properties.cpp',
 'lisp/writer.cpp',
-'navigation/segment_position.cpp',
-'navigation/navigation_graph.cpp',
-'navigation/node.cpp',
-'navigation/segment.cpp',
-'navigation/properties.cpp',
+'math/line.cpp',
 'math/matrix.cpp',
 'math/origin.cpp',
 'math/quaternion.cpp',
 'math/rect.cpp',
 'math/vector.cpp',
-'math/line.cpp',
 'menu_manager.cpp',
+'navigation/navigation_graph.cpp',
+'navigation/node.cpp',
+'navigation/properties.cpp',
+'navigation/segment.cpp',
+'navigation/segment_position.cpp',
+'navigation_test.cpp',
+'objects/background_gradient.cpp',
+'objects/bomb.cpp',
+'objects/box.cpp',
+'objects/character.cpp',
+'objects/elevator.cpp',
+'objects/grenade.cpp',
+'objects/hedgehog.cpp',
+'objects/liquid.cpp',
+'objects/nightvision.cpp',
+'objects/player.cpp',
+'objects/scriptable_object.cpp',
+'objects/shockwave.cpp',
+'objects/spider_mine.cpp',
+'objects/swarm.cpp',
+'objects/test_object.cpp',
+'objects/vrdummy.cpp',
 'particle_viewer.cpp',
+'particles/deform_drawer.cpp',
 'particles/particle_system.cpp',
 'particles/spark_drawer.cpp',
-'particles/deform_drawer.cpp',
 'particles/surface_drawer.cpp',
+'pda.cpp',
 'physfs/physfs_sdl.cpp',
 'physfs/physfs_stream.cpp',
+'physics.cpp',
+'pistol.cpp',
+'random.cpp',
+'response_curve.cpp',
+'screen.cpp',
+'screen_manager.cpp',
+'script_manager.cpp',
 'scripting/game_objects.cpp',
 'scripting/interface.cpp',
 'scripting/squirrel_error.cpp',
+'scripting/util.cpp',
 'scripting/wrapper.cpp',
-'scripting/util.cpp',
+'sector.cpp',
+'sexpr_file_reader.cpp',
 'sound/sound_file.cpp',
 'sound/sound_manager.cpp',
 'sound/sound_source.cpp',
@@ -190,9 +176,23 @@
 'sprite2d/data.cpp',
 'sprite2d/manager.cpp',
 'sprite2d/sprite.cpp',
+'sprite2dview.cpp',
 'sprite3d/data.cpp',
 'sprite3d/manager.cpp',
-'sprite3d/sprite3d.cpp'
+'sprite3d/sprite3d.cpp',
+'sprite3dview.cpp',
+'text_area.cpp',
+'tile.cpp',
+'tile_description.cpp',
+'tile_factory.cpp',
+'tile_map.cpp',
+'tile_packer.cpp',
+'timer.cpp',
+'title_screen.cpp',
+'trigger.cpp',
+'util.cpp',
+'view.cpp',
+'windstille_main.cpp',
 ])
 
 # EOF #

Deleted: trunk/windstille/src/box.cpp
===================================================================
--- trunk/windstille/src/box.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/box.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,98 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 David Kamphausen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">david.kamphausen at web.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;stdexcept&gt;
-#include &lt;boost/bind.hpp&gt;
-#include &quot;box.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &quot;math/vector.hpp&quot;
-#include &quot;tile_map.hpp&quot;
-#include &quot;random.hpp&quot;
-#include &quot;sprite2d/manager.hpp&quot;
-
-Box::Box(FileReader&amp; props)
-{
-  gravity = 0.0f;
-  float width  = 64.0f;
-  float height = 64.0f;
-  std::string spritename;
-  Vector vel;
-
-  props.get(&quot;sprite&quot;, spritename);
-  props.get(&quot;pos&quot;, pos);
-  props.get(&quot;width&quot;, width);
-  props.get(&quot;height&quot;, height);
-  props.get(&quot;vel&quot;, vel);
-  props.get(&quot;name&quot;, name);
-  props.get(&quot;gravity&quot;, gravity);
-  props.print_unused_warnings(&quot;box object&quot;);
-  
-  if(spritename == &quot;&quot;)
-    throw std::runtime_error(&quot;No sprite name specified in Box&quot;);
-  
-  sprite = Sprite(spritename);
-  
-  colobj = new CollisionObject(this, Rectf(0, 0, width, height));
-  colobj-&gt;set_velocity(vel);
-  colobj-&gt;set_pos(Vector(pos.x, pos.y));
-
-  Sector::current()-&gt;get_collision_engine()-&gt;add(colobj);
-
-  colobj-&gt;sig_collision().connect(boost::bind(&amp;Box::collision, this, _1));
-}
-
-Box::~Box()
-{
-  Sector::current()-&gt;get_collision_engine()-&gt;remove(colobj);
-}
-
-void 
-Box::collision(const CollisionData&amp; data)
-{
-  //std::cout &lt;&lt; this &lt;&lt; &quot;: Collision Event&quot; &lt;&lt; std::endl;
-  if ((data.direction.x &gt; 0 &amp;&amp; colobj-&gt;get_velocity().x &lt; 0) ||
-      (data.direction.x &lt; 0 &amp;&amp; colobj-&gt;get_velocity().x &gt; 0))
-    {
-      colobj-&gt;set_velocity(Vector(-colobj-&gt;get_velocity().x, colobj-&gt;get_velocity().y));
-    }
-  
-  if ((data.direction.y &gt; 0 &amp;&amp; colobj-&gt;get_velocity().y &lt; 0) ||
-      (data.direction.y &lt; 0 &amp;&amp; colobj-&gt;get_velocity().y &gt; 0))
-    {
-      colobj-&gt;set_velocity(Vector(colobj-&gt;get_velocity().x, -colobj-&gt;get_velocity().y));
-    }
-}
-
-void 
-Box::update(float delta)
-{
-  colobj-&gt;set_velocity(Vector(colobj-&gt;get_velocity().x, 
-                              colobj-&gt;get_velocity().y + gravity * delta));
-
-  sprite.update(delta);
-  pos = colobj-&gt;get_pos();
-}
-
-void 
-Box::draw(SceneContext&amp; sc)
-{
-  sc.color().draw(sprite, pos, 10.0f);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/box.hpp
===================================================================
--- trunk/windstille/src/box.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/box.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,48 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 David Kamphausen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">david.kamphausen at web.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_BOX_HPP
-#define HEADER_WINDSTILLE_BOX_HPP
-
-#include &quot;entity.hpp&quot;
-#include &quot;collision/collision_object.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;particles/particle_system.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-
-class Box : public Entity
-{
-private:
-  Sprite sprite;
-  CollisionObject* colobj;
-  float gravity;
-
-public:
-  Box(FileReader&amp; props);
-  virtual ~Box();
-
-  void collision(const CollisionData&amp; data); 
-
-  void update(float delta);
-
-  void draw(SceneContext&amp; gc);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/camera.cpp
===================================================================
--- trunk/windstille/src/camera.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/camera.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -16,7 +16,7 @@
 **  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
 */
 
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;script_manager.hpp&quot;
 #include &quot;display/display.hpp&quot;

Deleted: trunk/windstille/src/character.cpp
===================================================================
--- trunk/windstille/src/character.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/character.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,85 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;character.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;game_session.hpp&quot;
-#include &quot;scripting/wrapper.interface.hpp&quot;
-#include &quot;dialog_manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
-#include &quot;physfs/physfs_stream.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;sprite3d/manager.hpp&quot;
-#include &quot;util.hpp&quot;
-
-#include &lt;exception&gt;
-
-Character::Character(FileReader&amp; props)
-{
-  set_useable(true);
-  use_verb = &quot;Talk&quot;;
-  z_pos = 100.0f;
-
-  std::string sprite3d_filename = &quot;models/characters/jane/jane.wsprite&quot;;
-  std::string action_name;
-
-  props.get(&quot;name&quot;, name);
-  props.get(&quot;pos&quot;, pos);
-  props.get(&quot;z-pos&quot;, z_pos);
-  props.get(&quot;sprite3d&quot;, sprite3d_filename);
-  props.get(&quot;action&quot;, action_name);
-  props.print_unused_warnings(&quot;character&quot;);
-  
-  sprite = Sprite3D(sprite3d_filename);
-
-  if (!action_name.empty())
-    sprite.set_action(action_name);
-}
-
-Character::~Character()
-{
-}
-
-void
-Character::update(float delta)
-{   
-  sprite.update(delta);
-}
-
-void
-Character::draw (SceneContext&amp; sc)
-{
-  sprite.draw(sc.color(), pos, z_pos);
-}
-
-void
-Character::use()
-{
-  std::string filename = basename(Sector::current()-&gt;get_filename());
-  filename.erase(filename.find('.'));
-  filename = &quot;scripts/&quot; + filename + &quot;/&quot; + name + &quot;.nut&quot;;
-
-  try 
-    {
-      script_manager-&gt;run_script_file(filename);
-    } catch (std::exception&amp; e) {
-      console &lt;&lt; e.what() &lt;&lt; std::endl;
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/character.hpp
===================================================================
--- trunk/windstille/src/character.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/character.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,42 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_CHARACTER_HPP
-#define HEADER_WINDSTILLE_CHARACTER_HPP
-
-#include &quot;entity.hpp&quot;
-#include &quot;sprite3d/sprite3d.hpp&quot;
-
-class Character : public Entity
-{
-private:
-  Sprite3D sprite;
-  float z_pos;
-    
-public:
-  Character(FileReader&amp; props);
-  ~Character();
-  
-  void update(float delta);
-  void draw (SceneContext&amp; gc);
-  void use();
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/elevator.cpp
===================================================================
--- trunk/windstille/src/elevator.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/elevator.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,63 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;stdexcept&gt;
-#include &quot;elevator.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &quot;sprite2d/manager.hpp&quot;
-
-Elevator::Elevator(FileReader&amp; props)
-{
-  std::string spritename;
-
-  props.get(&quot;sprite&quot;, spritename);
-  props.get(&quot;pos&quot;, pos);
-  props.get(&quot;name&quot;, name);
-  props.print_unused_warnings(&quot;elevator&quot;);
-
-  if(spritename == &quot;&quot;)
-    throw std::runtime_error(&quot;No sprite name specified in Elevator&quot;);
-
-  sprite = Sprite(spritename);
-  size  = Size(128, 64);
-  colobject = new CollisionObject(this, Rectf(Vector(0,0), size));
-  Sector::current()-&gt;get_collision_engine()-&gt;add(colobject);
-  colobject-&gt;set_pos(pos);
-}
-
-Elevator::~Elevator()
-{
-  if(Sector::current()-&gt;get_collision_engine())
-    Sector::current()-&gt;get_collision_engine()-&gt;remove(colobject);
-}
-
-void
-Elevator::draw(SceneContext&amp; sc)
-{
-  sc.color().draw(sprite, pos, 10.0f);
-}
-
-void
-Elevator::update(float delta)
-{
-  sprite.update(delta);
-  pos = colobject-&gt;get_pos();
-}
-
-/* EOF */

Deleted: trunk/windstille/src/elevator.hpp
===================================================================
--- trunk/windstille/src/elevator.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/elevator.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,42 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_ELEVATOR_HPP
-#define HEADER_WINDSTILLE_ELEVATOR_HPP
-
-#include &quot;entity.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-
-/** */
-class Elevator : public Entity
-{
-private:
-  Sizef size;
-  CollisionObject* colobject;
-  Sprite sprite;
-public:
-  Elevator(FileReader&amp; props);
-  ~Elevator();
-
-  void draw(SceneContext&amp; sc);
-  void update(float delta);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/energy_bar.cpp
===================================================================
--- trunk/windstille/src/energy_bar.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/energy_bar.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -17,7 +17,7 @@
 */
 
 #include &quot;globals.hpp&quot;
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;energy_bar.hpp&quot;
 
 EnergyBar::EnergyBar()

Modified: trunk/windstille/src/game_session.cpp
===================================================================
--- trunk/windstille/src/game_session.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/game_session.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -29,7 +29,7 @@
 #include &quot;sector.hpp&quot;
 #include &quot;console.hpp&quot;
 #include &quot;game_object.hpp&quot;
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;tile_map.hpp&quot;
 #include &quot;screen_manager.hpp&quot;
 #include &quot;view.hpp&quot;

Deleted: trunk/windstille/src/grenade.cpp
===================================================================
--- trunk/windstille/src/grenade.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/grenade.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,57 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;grenade.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-
-Grenade::Grenade()
-  : sprite(&quot;models/objects/grenade/grenade.wsprite&quot;), physics(this)
-{
-  c_object.reset(new CollisionObject(this, Rectf(0, 0, 32, 32)));
-  physics.register_collobj(*c_object);
-
-  Sector::current()-&gt;get_collision_engine()-&gt;add(c_object.get());
-}
-
-Grenade::~Grenade()
-{
-}
-
-void
-Grenade::draw(SceneContext&amp; sc)
-{
-  sprite.draw(sc.color(), pos, 0);
-}
-
-void
-Grenade::update(float delta)
-{
-  sprite.update(delta);
-  physics.update(delta);
-  c_object-&gt;set_pos(pos);
-  c_object-&gt;set_velocity(velocity);
-}
-
-void
-Grenade::set_velocity(const Vector&amp; velocity)
-{
-  this-&gt;velocity = velocity;
-}
-
-/* EOF */

Deleted: trunk/windstille/src/grenade.hpp
===================================================================
--- trunk/windstille/src/grenade.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/grenade.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,44 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-#ifndef HEADER_WINDSTILLE_GRENADE_HPP
-#define HEADER_WINDSTILLE_GRENADE_HPP
-
-#include &quot;entity.hpp&quot;
-#include &quot;physics.hpp&quot;
-#include &quot;sprite3d/sprite3d.hpp&quot;
-#include &lt;memory&gt;
-
-class Grenade : public Entity
-{
-public:
-  Grenade();
-  virtual ~Grenade();
-
-  void draw(SceneContext&amp; sc);
-  void update(float delta);
-  void set_velocity(const Vector&amp; vel);
-
-private:
-  Sprite3D sprite;
-  Physics physics;
-  std::auto_ptr&lt;CollisionObject&gt; c_object;
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/laser_pointer.cpp
===================================================================
--- trunk/windstille/src/laser_pointer.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/laser_pointer.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -18,7 +18,7 @@
 #include &lt;config.h&gt;
 
 #include &quot;display/vertex_array_drawing_request.hpp&quot;
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;tile_map.hpp&quot;

Deleted: trunk/windstille/src/liquid.cpp
===================================================================
--- trunk/windstille/src/liquid.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/liquid.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,140 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &quot;display/vertex_array_drawing_request.hpp&quot;
-#include &quot;random.hpp&quot;
-#include &quot;liquid.hpp&quot;
-
-#define SAMPLES 5
-
-Liquid::Liquid(FileReader&amp; props)
-{
-  int width = 10;
-  t = 0;
-
-  props.get(&quot;pos&quot;,    pos);
-  props.get(&quot;width&quot;,  width);
-  props.print_unused_warnings(&quot;Liquid&quot;);
-
-  heightfield1 = &amp;heightfield_store1;
-  heightfield2 = &amp;heightfield_store2;
-
-  heightfield1-&gt;resize(width * SAMPLES, 0);
-  heightfield2-&gt;resize(width * SAMPLES, 0);
-  
-  for(std::vector&lt;float&gt;::size_type i = 2; i &lt; heightfield1-&gt;size()-2; ++i)
-    {
-      (*heightfield1)[i] = sin(i/float(heightfield1-&gt;size()) * 10.0f) * 0.5f
-        + sin(i/float(heightfield1-&gt;size()) * 5.0f) * .5f;
-      (*heightfield2)[i] = (*heightfield1)[i];
-    }
-
-  for(int i = 50; i &lt; 70 &amp;&amp; i &lt; int(heightfield1-&gt;size()); ++i)
-    (*heightfield1)[i] += 0.0025f;
-
-  texture = Texture(&quot;images/textures/water.png&quot;);
-  texture.set_wrap(GL_REPEAT);
-}
-
-Liquid::~Liquid()
-{
-}
-
-void
-Liquid::draw(SceneContext&amp; sc)
-{
-  float texscale = 1.0f/128.0f;
-  {
-    VertexArrayDrawingRequest* array = new VertexArrayDrawingRequest(Vector(pos.x, pos.y), 10000,
-                                                                     sc.light().get_modelview());
-    array-&gt;set_texture(texture);
-    array-&gt;set_mode(GL_QUAD_STRIP);
-    array-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-
-    for(std::vector&lt;float&gt;::size_type i = 0; i &lt; heightfield1-&gt;size(); ++i)
-      {
-        float c = 0.5f;
-        if (i &gt; 0)
-          {
-            float angle = atan2(32.0f* ((*heightfield1)[i] - (*heightfield1)[i-1]), 3.2f);
-            c = std::min(1.0f, std::max(0.5f, 8.0f * (angle/float(M_PI)) + 0.5f));
-          }
-
-        array-&gt;color(Color(0.5f, 0.5f, 1.0f, 0.7f));
-        array-&gt;texcoord((i * 32.0f/SAMPLES) * texscale + sin(t + i/10.0f)*0.2f,
-                        (-32.0f * (*heightfield1)[i] + 8.0f) * texscale + sin(t+i/10.0f)*0.2f);
-        array-&gt;vertex(i * 32.0f/SAMPLES, -32.0f * (*heightfield1)[i] + 8.0f);
-
-        array-&gt;color(Color(c, c, 1.0f, 1.0f));
-        array-&gt;texcoord((i * 32.0f/SAMPLES) * texscale + sin(t + i/10.0f)*0.2f,
-                        (-32.0f * (*heightfield1)[i]) * texscale + sin(t+i/10.0f)*0.2f);
-        array-&gt;vertex(i * 32.0f/SAMPLES, -32.0f * (*heightfield1)[i]);
-      }
-
-    sc.color().draw(array);
-  }
-  {
-    VertexArrayDrawingRequest* array = new VertexArrayDrawingRequest(Vector(pos.x, pos.y), 10000,
-                                                                     sc.light().get_modelview());
-    array-&gt;set_texture(texture);
-    array-&gt;set_mode(GL_QUAD_STRIP);
-    array-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-
-    for(std::vector&lt;float&gt;::size_type i = 0; i &lt; heightfield1-&gt;size(); ++i)
-      {
-        array-&gt;color(Color(0.0f, 0.0f, 0.5f, 0.7f));
-        array-&gt;texcoord((i * 32.0f/SAMPLES) * texscale + sin(t + i/10.0f)*0.2f,
-                        (64.0f) * texscale + sin(t+i/10.0f)*0.2f);
-        array-&gt;vertex(i * 32.0f/SAMPLES, 64.0f);
-
-        array-&gt;color(Color(0.5f, 0.5f, 1.0f, 0.7f));
-        array-&gt;texcoord((i * 32.0f/SAMPLES) * texscale + sin(t + i/10.0f)*0.2f,
-                        (-32.0f * (*heightfield1)[i] + 8.0f) * texscale + sin(t+i/10.0f)*0.2f);
-        array-&gt;vertex(i * 32.0f/SAMPLES, -32.0f * (*heightfield1)[i] + 8.0f);
-      }
-
-    sc.color().draw(array);
-  }
-}
-
-void
-Liquid::update(float delta)
-{
-  t += delta * 1.0f;
-  float factor = 0.1f * delta;
-
-  for(int samples = 0; samples &lt; 3; ++samples)
-    {
-      for(std::vector&lt;float&gt;::size_type i = 2; i &lt; heightfield1-&gt;size()-2; ++i)
-        {
-          float value = 
-            factor * ((*heightfield1)[i-2] +
-                      (*heightfield1)[i-1] +
-                      (*heightfield1)[i+1] +
-                      (*heightfield1)[i+2])                      
-            - (factor * 4 * (*heightfield1)[i])
-            + (2*(*heightfield1)[i])
-            - (*heightfield2)[i];
-      
-          (*heightfield2)[i] = value * 0.99999f;
-        }
-      std::swap(heightfield2, heightfield1);
-    }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/liquid.hpp
===================================================================
--- trunk/windstille/src/liquid.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/liquid.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,52 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_LIQUID_HPP
-#define HEADER_WINDSTILLE_LIQUID_HPP
-
-#include &lt;vector&gt;
-#include &quot;entity.hpp&quot;
-
-/** */
-class Liquid : public Entity
-{
-private:
-  Texture texture;
-  float t;
-
-  std::vector&lt;float&gt; heightfield_store1;
-  std::vector&lt;float&gt; heightfield_store2;
-
-  std::vector&lt;float&gt;* heightfield1;
-  std::vector&lt;float&gt;* heightfield2;
-
-public:
-  Liquid(FileReader&amp; props);
-  ~Liquid();
-
-  void draw(SceneContext&amp; sc);
-  void update(float delta);
-
-private:
-  Liquid (const Liquid&amp;);
-  Liquid&amp; operator= (const Liquid&amp;);
-};
-
-#endif
-
-/* EOF */

Copied: trunk/windstille/src/objects/box.cpp (from rev 2456, trunk/windstille/src/box.cpp)


Property changes on: trunk/windstille/src/objects/box.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/box.hpp (from rev 2456, trunk/windstille/src/box.hpp)


Property changes on: trunk/windstille/src/objects/box.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/character.cpp (from rev 2456, trunk/windstille/src/character.cpp)


Property changes on: trunk/windstille/src/objects/character.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/character.hpp (from rev 2456, trunk/windstille/src/character.hpp)


Property changes on: trunk/windstille/src/objects/character.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/elevator.cpp (from rev 2456, trunk/windstille/src/elevator.cpp)


Property changes on: trunk/windstille/src/objects/elevator.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/elevator.hpp (from rev 2456, trunk/windstille/src/elevator.hpp)


Property changes on: trunk/windstille/src/objects/elevator.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/grenade.cpp (from rev 2457, trunk/windstille/src/grenade.cpp)


Property changes on: trunk/windstille/src/objects/grenade.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/grenade.hpp (from rev 2457, trunk/windstille/src/grenade.hpp)


Property changes on: trunk/windstille/src/objects/grenade.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/liquid.cpp (from rev 2456, trunk/windstille/src/liquid.cpp)


Property changes on: trunk/windstille/src/objects/liquid.cpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/liquid.hpp (from rev 2456, trunk/windstille/src/liquid.hpp)


Property changes on: trunk/windstille/src/objects/liquid.hpp
___________________________________________________________________
Name: svn:mergeinfo
   + 

Copied: trunk/windstille/src/objects/player.cpp (from rev 2456, trunk/windstille/src/player.cpp)


Property changes on: trunk/windstille/src/objects/player.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/player.hpp (from rev 2456, trunk/windstille/src/player.hpp)


Property changes on: trunk/windstille/src/objects/player.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/scriptable_object.cpp (from rev 2456, trunk/windstille/src/scriptable_object.cpp)


Property changes on: trunk/windstille/src/objects/scriptable_object.cpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Copied: trunk/windstille/src/objects/scriptable_object.hpp (from rev 2456, trunk/windstille/src/scriptable_object.hpp)


Property changes on: trunk/windstille/src/objects/scriptable_object.hpp
___________________________________________________________________
Name: svn:keywords
   + Id
Name: svn:mergeinfo
   + 
Name: svn:eol-style
   + native

Deleted: trunk/windstille/src/player.cpp
===================================================================
--- trunk/windstille/src/player.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/player.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,775 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#include &lt;boost/bind.hpp&gt;
-#include &quot;tile_map.hpp&quot;
-#include &quot;sector.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;input/input_manager.hpp&quot;
-#include &quot;controller_def.hpp&quot;
-#include &quot;player.hpp&quot;
-#include &quot;objects/bomb.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;pda.hpp&quot;
-#include &quot;tile.hpp&quot;
-#include &quot;sprite3d/manager.hpp&quot;
-#include &quot;display/surface_manager.hpp&quot;
-#include &quot;particles/particle_system.hpp&quot;
-#include &quot;sound/sound_manager.hpp&quot;
-#include &quot;collision/collision_engine.hpp&quot;
-#include &quot;laser_pointer.hpp&quot;
-#include &quot;collision/stair_contact.hpp&quot;
-#include &quot;game_session.hpp&quot;
-#include &quot;console.hpp&quot;
-#include &quot;grenade.hpp&quot;
-#include &quot;pistol.hpp&quot;
-
-static const int MAX_ENERGY = 16;
-static const float WALK_SPEED = 128.0;
-static const float RUN_SPEED = 256.0;
-
-Player* Player::current_ = 0;
-
-Player::Player () :
-  light(&quot;images/light3.sprite&quot;),
-  flashlight(&quot;images/flashlightlight.sprite&quot;),
-  flashlighthighlight(&quot;images/flashlighthighlight.sprite&quot;),
-  state(STAND)
-{
-  //laser_pointer = new LaserPointer();
-  sprite = Sprite3D(&quot;models/characters/jane/jane.wsprite&quot;);
-  pos.x = 320;
-  pos.y = 200;
-  name = &quot;player&quot;;
-
-  jumping = false;
-  energy = MAX_ENERGY;
-  current_ = this;
-
-  hit_count = 0.0f;
-  sprite.set_action(&quot;Stand&quot;);
-
-  // collision detection init
-  c_object = new CollisionObject(this, Rectf(-15, -120, 15, 0));
-
-  c_object-&gt;set_pos(pos);
-  c_object-&gt;set_velocity(velocity);
-  
-  c_object-&gt;sig_collision().connect(boost::bind(&amp;Player::collision, this, _1));
-
-  Sector::current()-&gt;get_collision_engine()-&gt;add(c_object);
-
-  z_pos = 100.0f;
-
-  contact = 0;
-  weapon = new Pistol();
-  laser_pointer = ((Pistol*) weapon)-&gt;laser_pointer;
-}
-
-Player::~Player()
-{
-  //delete laser_pointer;
-}
-
-void
-Player::draw (SceneContext&amp; sc)
-{
-  //light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-  //light.set_scale(4.0f);
-
-  flashlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-  flashlight.set_scale(2.0f);
-
-  flashlighthighlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-  flashlighthighlight.set_scale(2.0f);
-
-  if (1)
-    { // draw the 'stand-on' tile
-      sc.highlight().fill_rect(Rect(Point(int(pos.x)/32 * 32, (int(pos.y)/32 + 1) * 32),
-                                    Size(32, 32)),
-                               Color(1.0f, 0.0f, 0.0f, 0.5f), 10000.0f);
-    }
-
-  //sc.highlight().draw(flashlighthighlight, pos - Vector(40, 80), 100.0f);
-  //sc.light().draw(flashlight, pos - Vector(40, 80), 100.0f);
-  sprite.draw(sc.color(), pos, z_pos);
-
-  Entity* obj = find_useable_entity();
-  if (obj)
-    {
-      std::string use_str = &quot;[&quot; + obj-&gt;get_use_verb() + &quot;]&quot;;
-      sc.highlight().draw(use_str, obj-&gt;get_pos().x, obj-&gt;get_pos().y - 150, 1000);
-    }
-  
-  // Draw weapon at the 'Weapon' attachment point
-  Sprite3D::PointID id = sprite.get_attachment_point_id(&quot;Weapon&quot;);
-  sc.push_modelview();
-  sc.translate(pos.x, pos.y);
-  sc.mult_modelview(sprite.get_attachment_point_matrix(id));
-  weapon-&gt;draw(sc);
-  sc.pop_modelview();
-
-
-  sc.push_modelview();
-  sc.translate(pos.x, pos.y - 80);
-  laser_pointer-&gt;draw(sc);
-  sc.pop_modelview();
-}
-
-void
-Player::start_listening()
-{
-  if(state == STAND_TO_LISTEN || state == LISTEN)
-    return;
-
-  set_stand_to_listen(false);
-}
-
-void
-Player::stop_listening()
-{
-  if(state != LISTEN &amp;&amp; state != STAND_TO_LISTEN)
-    return;
-  
-  set_stand_to_listen(true);
-}
-
-void 
-Player::update(float delta)
-{
-  weapon-&gt;update(delta);
-  laser_pointer-&gt;update(delta);
-
-  controller = InputManager::get_controller();
-
-  laser_pointer-&gt;set_angle(laser_pointer-&gt;get_angle() + controller.get_axis_state(Y_AXIS) * delta);
-  //laser_pointer-&gt;set_angle(controller.get_axis_state(Y2_AXIS) * M_PI);
-
-  //std::cout &lt;&lt; controller.get_axis_state(Y2_AXIS) * M_PI &lt;&lt; std::endl;
-
-  if (GameSession::current()-&gt;is_active())
-    {
-      switch(state) {
-        case STAND:
-        case WALK:
-          update_walk_stand();
-          break;
-        case RUN:
-          update_run();
-          break;
-        case DUCKING:
-          update_ducking();
-          break;
-        case DUCKED:
-          update_ducked();
-          break;
-        case TURNAROUND:
-          update_turnaround();
-          break;
-        case STAND_TO_LISTEN:
-          update_stand_to_listen();
-          break;
-        case LISTEN:
-          update_listen();
-          break;
-        case JUMP_BEGIN:
-          update_jump_begin();
-          break;
-        case JUMP_AIR:
-          update_jump_air();
-          break;
-        case JUMP_LAND:
-          update_jump_land();
-          break;
-        case JUMP_UP_BEGIN:
-          update_jump_up_begin();
-          break;
-        case JUMP_UP_AIR:
-          update_jump_up_air();
-          break;
-        case JUMP_UP_LAND:
-          update_jump_up_land();
-          break;
-        case PULL_GUN:
-          update_pull_gun();
-          break;
-        case STAIRS_DOWN:
-        case STAIRS_UP:
-          update_stairs(delta);
-          break;
-        default:
-          assert(false);
-          break;
-      }
-    }
-
-  // fall down
-  velocity.y += GRAVITY * delta;
-
-  sprite.update(delta);
-
-  c_object-&gt;set_velocity (velocity);
-
-  pos = c_object-&gt;get_pos();
-}
-
-void
-Player::set_stand()
-{
-  try_set_action(&quot;Stand&quot;);
-  velocity = Vector(0, 0);
-  state = STAND;
-}
-
-void
-Player::update_walk_stand()
-{
-  if (controller.get_axis_state(Y_AXIS) &gt; 0.5f) {
-    TileMap* tilemap = Sector::current()-&gt;get_tilemap2();
-    if (tilemap)
-      {
-        Point p(int(pos.x)/32, (int(pos.y)/32 + 1));
-        unsigned int col = tilemap-&gt;get_pixel(p.x, p.y);
-
-        if ((col &amp; TILE_STAIRS) &amp;&amp; (get_direction() == WEST &amp;&amp; (col &amp; TILE_LEFT) ||
-                                    get_direction() == EAST &amp;&amp; (col &amp; TILE_RIGHT)))
-          {
-            delete contact;
-            contact = new StairContact(tilemap, p);
-
-            std::cout &lt;&lt; &quot;Stair mode&quot; &lt;&lt; std::endl;
-            state = STAIRS_DOWN;
-            //c_object-&gt;get_check_domains() &amp; (~CollisionObject::DOMAIN_TILEMAP));
-            Sector::current()-&gt;get_collision_engine()-&gt;remove(c_object);
-            z_pos = -10.0f;
-            return;
-          }
-        else
-          {
-            set_ducking();
-            return;
-          }
-      }
-  } else if (controller.get_axis_state(Y_AXIS) &lt; -0.5f) {
-    TileMap* tilemap = Sector::current()-&gt;get_tilemap2();
-    if (tilemap)
-      {
-        Point p(int(pos.x)/32 + ((get_direction() == WEST) ? -1 : +1), (int(pos.y)/32));
-        unsigned int col = tilemap-&gt;get_pixel(p.x, p.y);
-
-        if ((col &amp; TILE_STAIRS) &amp;&amp; (get_direction() == EAST &amp;&amp; (col &amp; TILE_LEFT) ||
-                                    get_direction() == WEST &amp;&amp; (col &amp; TILE_RIGHT)))
-          {
-            delete contact;
-            contact = new StairContact(tilemap, p);
-
-            state = STAIRS_UP;
-            //c_object-&gt;get_check_domains() &amp; (~CollisionObject::DOMAIN_TILEMAP));
-            Sector::current()-&gt;get_collision_engine()-&gt;remove(c_object);
-            z_pos = -10.0f;
-            return;
-          }
-      }    
-  }
-
-  if(state == STAND)
-    update_stand();
-  else
-    update_walk();
-}
-
-void
-Player::update_stairs(float delta)
-{
-  assert(contact);
-
-  if (controller.get_axis_state(X_AXIS) &lt; -0.5f ||
-      controller.get_axis_state(Y_AXIS) &gt; 0.5f)
-    contact-&gt;advance(-WALK_SPEED * delta * 0.7f);
-  else if (controller.get_axis_state(X_AXIS) &gt; 0.5f ||
-           controller.get_axis_state(Y_AXIS) &lt; -0.5f)
-    contact-&gt;advance(WALK_SPEED * delta * 0.7f);
-
-  velocity = Vector(0, 0);
-  c_object-&gt;set_pos(contact-&gt;get_pos());
-
-  if (!contact-&gt;is_active())
-    {
-      Sector::current()-&gt;get_collision_engine()-&gt;add(c_object);
-      state = STAND;
-    }
-}
-
-Entity*
-Player::find_useable_entity()
-{
-  std::vector&lt;GameObject*&gt;* objects = Sector::current()-&gt;get_objects();
-  for (std::vector&lt;GameObject*&gt;::iterator i = objects-&gt;begin(); i != objects-&gt;end(); ++i)
-    {
-      Entity* object = dynamic_cast&lt;Entity*&gt;(*i);
-      if (object &amp;&amp; object != this &amp;&amp; object-&gt;is_useable())
-        {
-          //FIXME use proper collision detection
-          if (object-&gt;get_pos().x &gt; pos.x - 32 &amp;&amp; object-&gt;get_pos().x &lt; pos.x + 32
-              &amp;&amp; object-&gt;get_pos().y &gt; pos.y - 256 &amp;&amp; object-&gt;get_pos().y &lt; pos.y + 256)
-            {
-              return object;
-            }
-        }
-    }
-  return 0;  
-}
-
-
-void
-Player::update_stand()
-{ 
-  if(controller.button_was_pressed(USE_BUTTON))
-    {
-      Entity* obj = find_useable_entity();
-      if (obj)
-        obj-&gt;use();
-      return;
-    }
-    
-  if(controller.button_was_pressed(JUMP_BUTTON)
-     &amp;&amp; controller.get_axis_state(Y_AXIS) &gt; 0.5f) 
-    {
-      set_jump_up_begin();
-    } 
-  else if (controller.button_was_pressed(AIM_BUTTON))
-    {
-      // TODO remove me later, just here for testing
-      Grenade* grenade = new Grenade();
-      grenade-&gt;set_pos(get_pos() + Vector(50, -300));
-      grenade-&gt;set_velocity(Vector(20, -10));
-      Sector::current()-&gt;add(grenade);
-      
-      sprite.set_action(&quot;PullGun&quot;);
-      state = PULL_GUN;
-    }
-  else if (controller.get_axis_state(X_AXIS) &lt; -0.5f) 
-    {
-      if(get_direction() == WEST)
-        set_walk(WEST);
-      else
-        set_turnaround();
-    }
-  else if (controller.get_axis_state(X_AXIS) &gt; 0.5f) 
-    {
-      if(get_direction() == EAST)
-        set_walk(EAST);
-      else
-        set_turnaround();
-    }
-}
-
-void
-Player::set_walk(Direction direction)
-{
-  try_set_action(&quot;Walk&quot;);
-  sprite.set_rot(direction == EAST);
-  state = WALK;
-  if(direction == EAST)
-    velocity.x = WALK_SPEED;
-  else
-    velocity.x = -WALK_SPEED;
-
-  // start walking sound
-  // sound_source.reset(sound_manager-&gt;create_sound_source(&quot;sounds/steps_dirt.ogg&quot;));
-  // sound_source-&gt;set_looping(true);
-  // sound_source-&gt;play();
-}
-
-void
-Player::update_walk()
-{
-  if (controller.get_axis_state(X_AXIS) == 0) {
-    leave_walk();
-    set_stand();
-    return;
-  }
-
-  if(get_direction() == WEST &amp;&amp; controller.get_axis_state(X_AXIS) &gt; 0.5f
-     || get_direction() == EAST &amp;&amp; controller.get_axis_state(X_AXIS) &lt; -0.5f) {
-    leave_walk();
-    set_turnaround();
-    return;
-  }
-  
-  if(controller.get_button_state(RUN_BUTTON)) {
-    leave_walk();
-    set_run();
-    return;
-  }
-}
-
-void
-Player::leave_walk()
-{
-  // stop walking sound
-  // sound_source-&gt;stop();
-}
-
-void
-Player::set_ducking()
-{
-  try_set_action(&quot;StandToDuck&quot;);
-  sprite.set_next_action(&quot;Ducking&quot;);
-  state = DUCKING;
-  velocity.x = 0;
-}
-
-void
-Player::update_ducking()
-{
-  // ducking
-  if(sprite.switched_actions()) {
-    if(sprite.get_action() == &quot;Ducking&quot;)
-      set_ducked();
-    else
-      set_stand();
-    return;
-  }
-  
-  if(!(controller.get_axis_state(Y_AXIS) &gt; 0.5f) &amp;&amp; sprite.get_speed() &gt; 0) {
-    sprite.set_speed(-1.0);
-    sprite.set_next_action(&quot;Stand&quot;);
-    state = STAND;
-  } else if(controller.get_axis_state(Y_AXIS) &gt; 0.5f &amp;&amp; sprite.get_speed() &lt; 0) {
-    sprite.set_speed(1.0);
-    sprite.set_next_action(&quot;Ducking&quot;);
-  }
-}
-
-void
-Player::set_ducked()
-{
-  assert(sprite.get_action() == &quot;Ducking&quot;);
-  state = DUCKED;
-}
-
-void
-Player::update_ducked()
-{
-  if(!controller.get_axis_state(Y_AXIS) &gt; 0.5f) {
-    state = DUCKING;
-    sprite.set_action(&quot;StandToDuck&quot;, -1.0);
-    sprite.set_next_action(&quot;Stand&quot;);
-  }  
-}
-
-void
-Player::set_turnaround()
-{
-  velocity.x = 0;
-  try_set_action(&quot;Turn&quot;);
-  sprite.set_next_action(&quot;Walk&quot;);
-  sprite.set_next_rot(! sprite.get_rot());
-  state = TURNAROUND;
-}
-
-void
-Player::update_turnaround()
-{
-  if(sprite.switched_actions()) {
-    if(sprite.get_rot()) {
-      set_walk(EAST);
-    } else {
-      set_walk(WEST);
-    }
-  } 
-  if(sprite.get_rot() &amp;&amp; controller.get_axis_state(X_AXIS) &gt; 0.5f
-     || !sprite.get_rot() &amp;&amp; controller.get_axis_state(X_AXIS) &lt; -0.5f) {
-    sprite.set_speed(-1.0);
-    sprite.set_next_action(&quot;Walk&quot;);
-    state = WALK;
-  }
-}
-
-void
-Player::set_stand_to_listen(bool backwards)
-{
-  try_set_action(&quot;StandtoListen&quot;, backwards ? -1.0 : 1.0);
-  if(!backwards) {
-    sprite.set_next_action(&quot;Listen&quot;);
-    velocity = Vector(0, 0);
-  } else {
-    sprite.set_next_action(&quot;Stand&quot;);
-  }
-  state = STAND_TO_LISTEN;
-}
-
-void
-Player::update_stand_to_listen()
-{
-  if(sprite.switched_actions()) {
-    if(sprite.get_action() == &quot;Stand&quot;)
-      set_stand();
-    else
-      set_listen();
-  }
-}
-
-void
-Player::set_listen()
-{
-  try_set_action(&quot;Listen&quot;);
-  state = LISTEN;
-}
-
-void
-Player::update_listen()
-{
-  // nothing
-}
-
-void
-Player::set_run()
-{
-  try_set_action(&quot;Run&quot;);
-  if(get_direction() == EAST)
-    velocity.x = RUN_SPEED;
-  else
-    velocity.x = -RUN_SPEED;  
-  state = RUN;
-
-  // start running sound
-  // sound_source.reset(sound_manager-&gt;create_sound_source(&quot;sounds/steps_dirt.ogg&quot;));
-  // sound_source-&gt;set_looping(true);
-  // sound_source-&gt;play();
-}
-
-void
-Player::update_run()
-{
-  if(!controller.get_button_state(RUN_BUTTON)) {
-    leave_run();
-    set_walk(get_direction());
-    return;
-  }
-  if(controller.get_button_state(JUMP_BUTTON)) {
-    leave_run();
-    set_jump_begin();
-    return;
-  }
-}
-
-void
-Player::leave_run()
-{
-  // sound_source-&gt;stop();
-}
-
-void
-Player::set_jump_begin()
-{
-  if(sprite.before_marker(&quot;RightFoot&quot;)) {
-    sprite.set_next_action(&quot;JumpRightFoot&quot;);
-    sprite.abort_at_marker(&quot;RightFoot&quot;);
-    jump_foot = LEFT_FOOT;
-  } else if(sprite.before_marker(&quot;LeftFoot&quot;)) {
-    sprite.set_next_action(&quot;JumpLeftFoot&quot;);
-    sprite.abort_at_marker(&quot;LeftFoot&quot;);
-    jump_foot = RIGHT_FOOT;
-  } else {
-    sprite.set_next_action(&quot;JumpRightFoot&quot;);
-    sprite.abort_at_marker(&quot;RightFoot&quot;);
-    jump_foot = LEFT_FOOT;
-  }
-  state = JUMP_BEGIN;
-}
-
-void
-Player::update_jump_begin()
-{
-  if(sprite.switched_actions()) {
-    if(sprite.get_action() == &quot;JumpLeftFoot&quot;) {
-      sprite.set_next_action(&quot;JumpLeftFootAir&quot;);
-    } else if(sprite.get_action() == &quot;JumpRightFoot&quot;) {
-      sprite.set_next_action(&quot;JumpRightFootAir&quot;);
-    } else {
-      set_jump_air();
-      return;
-    }
-  }
-}
-
-void
-Player::set_jump_air()
-{
-  velocity.y = -450;
-  sprite.set_next_action(&quot;JumpLandSofttoRun&quot;);
-  state = JUMP_AIR;
-}
-
-void
-Player::update_jump_air()
-{
-  if(sprite.switched_actions()) {
-    set_jump_land();
-    return;
-  }
-}
-
-void
-Player::set_jump_land()
-{
-  sprite.set_next_action(&quot;Run&quot;);
-  state = JUMP_LAND;
-}
-
-void
-Player::update_jump_land()
-{
-  if(sprite.switched_actions()) {
-    set_run();
-    return;
-  }
-}
-
-void
-Player::set_jump_up_begin()
-{
-  sprite.set_next_action(&quot;JumpUp&quot;);
-  state = JUMP_UP_BEGIN;
-}
-
-void
-Player::update_jump_up_begin()
-{
-  if(sprite.switched_actions()) {
-    set_jump_up_air();
-    return;
-  }
-}
-
-void
-Player::set_jump_up_air()
-{
-  velocity.y = -400;
-  sprite.set_next_action(&quot;JumpLandSofttoRun&quot;);
-  state = JUMP_UP_AIR;
-}
-
-void
-Player::update_jump_up_air()
-{
-  if(sprite.switched_actions()) {
-    set_jump_up_land();
-    return;
-  }
-}
-
-void
-Player::set_jump_up_land()
-{
-  sprite.set_next_action(&quot;Stand&quot;);
-  state = JUMP_UP_LAND;
-}
-
-void
-Player::update_jump_up_land()
-{
-  if(sprite.switched_actions()) {
-    set_stand();
-    return;
-  }
-}
-
-void
-Player::update_pull_gun()
-{
-  if (!controller.get_button_state(AIM_BUTTON))
-    {
-      sprite.set_next_action(&quot;Stand&quot;);      
-      state = STAND;
-    }
-}
-
-Direction
-Player::get_direction() const
-{
-  return sprite.get_rot() ? EAST : WEST;
-}
-
-void
-Player::try_set_action(const std::string&amp; name, float speed)
-{
-  if(sprite.get_action() == name)
-    return;
-  
-  sprite.set_action(name, speed);
-}
-
-int
-Player::get_energy() const
-{
-  return energy;
-}
-
-int
-Player::get_max_energy() const
-{
-  return MAX_ENERGY;
-}
-
-void
-Player::hit(int points)
-{
-  if (energy &gt; 0 &amp;&amp; hit_count &lt;= 0)
-    {
-      energy -= points;
-      //hit_count = 1.0f;
-
-      if (energy &lt;= 0)
-        {
-          //switch_movement_state(KILLED);
-          hit_count = 0;
-        }
-    }
-}
-
-void
-Player::collision(const CollisionData&amp; data)
-{
-  // copy velocity, as &quot;velocity&quot; is the wanted velocity, whereas
-  // cur_vel is the velocity in the current delta-frame
-  Vector cur_vel = c_object-&gt;get_velocity(); 
-  if (data.direction.y != 0)
-    {
-      cur_vel.y = 0;
-      velocity.y = 0; // also reset vertical velocity
-    }
-  else
-    {
-      // do not reset horizontal velocity, as it's only set, when starting to go/run
-      cur_vel.x = 0;
-    }
-  c_object-&gt;set_velocity (cur_vel);
-  
-}
-
-void 
-Player::set_pos(Vector pos)
-{
-  Entity::set_pos(pos);
-  c_object-&gt;set_pos(pos);
-}
-
-/* EOF */

Deleted: trunk/windstille/src/player.hpp
===================================================================
--- trunk/windstille/src/player.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/player.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,179 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-#ifndef HEADER_WINDSTILLE_PLAYER_HPP
-#define HEADER_WINDSTILLE_PLAYER_HPP
-
-#include &lt;memory&gt;
-#include &quot;sprite2d/sprite.hpp&quot;
-#include &quot;input/controller.hpp&quot;
-#include &quot;sprite3d/sprite3d.hpp&quot;
-#include &quot;sound/sound_source.hpp&quot;
-#include &quot;math/vector.hpp&quot;
-#include &quot;globals.hpp&quot;
-#include &quot;entity.hpp&quot;
-#include &quot;ref.hpp&quot;
-#include &quot;display/surface.hpp&quot;
-
-class Controller;
-class Contact;
-class LaserPointer;
-class Weapon;
-
-class Player : public Entity
-{
-private:
-  Controller controller;
-
-  Sprite   light;
-  Sprite   flashlight;
-  Sprite   flashlighthighlight;
-  Sprite3D sprite;
-  std::auto_ptr&lt;SoundSource&gt; sound_source;
-
-  bool jumping;
-  bool bomb_placed;
-  float hit_count;
-  int energy;
-
-  CollisionObject* c_object;
-
-  LaserPointer* laser_pointer;
-  Contact* contact;
-  Weapon* weapon;
-
-public:
-  enum State
-  {
-    STAND,
-    WALK,
-    TURNAROUND,
-    DUCKING,
-    DUCKED,
-    ACCELERATE,
-    RUN,
-    PULL_GUN,
-    SLOWDOWN,
-    STAND_TO_LISTEN,
-    LISTEN,
-    JUMP_BEGIN,
-    JUMP_AIR,
-    JUMP_LAND,
-    JUMP_UP_BEGIN,
-    JUMP_UP_AIR,
-    JUMP_UP_LAND,
-    STAIRS_UP,
-    STAIRS_DOWN
-  };
-
-private:
-  State state;
-
-  // jump state info
-  enum Foot {
-    LEFT_FOOT, RIGHT_FOOT
-  };
-  Foot jump_foot;
-  
-  double reload_time;
-  float  z_pos;
-  static Player* current_;
-public:
-  Player ();
-  virtual ~Player ();
-
-  static Player* current() { return current_; }
-
-  int get_movement_state() { return state; }
-
-  void draw (SceneContext&amp; gc);
-  void update (float delta);
-
-  void start_listening();
-  void stop_listening();
-  
-  int get_energy() const;
-  int get_max_energy() const;
-  void hit(int points);
-  
-  void collision(const CollisionData&amp; data);
-
-  Entity* find_useable_entity();
-
-  virtual void set_pos(Vector pos);
-
-private:
-  /*
-   * Following is a set of functions that manage the players state
-   * the set_ function is called to enter a new state, the update function is
-   * called each frame when a state is active, the leave function is called
-   * right before we enter a new state.
-   *
-   * TODO: can we generalize this mechanism? Or create a small specification
-   * language for this?
-   */
-  
-  void update_walk_stand();
-  void set_stand();
-  void update_stand();
-  void set_walk(Direction direction);
-  void update_walk();
-  void leave_walk();
-  void set_ducking();
-  void update_ducking();
-  void set_ducked();
-  void update_ducked();
-  void set_turnaround();
-  void update_turnaround();
-  void set_stand_to_listen(bool backwards);
-  void update_stand_to_listen();
-  void set_listen();
-  void update_listen();
-  void set_run();
-  void update_run();
-  void leave_run();
-  
-  void set_jump_begin();
-  void update_jump_begin();
-  void set_jump_air();
-  void update_jump_air();
-  void set_jump_land();
-  void update_jump_land();
-  
-  void set_jump_up_begin();
-  void update_jump_up_begin();
-  void set_jump_up_air();
-  void update_jump_up_air();
-  void set_jump_up_land();
-  void update_jump_up_land();
-
-  void update_pull_gun();
-  void update_stairs(float delta);
-
-  /**
-   * Sets an action for the sprite. In contrast to sprite-&gt;set_action this
-   * function will not restart the action if it was already running
-   */
-  void try_set_action(const std::string&amp; name, float speed = 1.0);
-
-  Direction get_direction() const;
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/windstille/src/scriptable_object.cpp
===================================================================
--- trunk/windstille/src/scriptable_object.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/scriptable_object.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,215 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-
-#include &quot;globals.hpp&quot;
-#include &quot;scriptable_object.hpp&quot;
-#include &quot;sprite2d/manager.hpp&quot;
-#include &quot;script_manager.hpp&quot;
-
-ScriptableObject::ScriptableObject(FileReader&amp; props)
-  : z_pos(50),
-    target_speed(0),
-    acceleration(0),
-    flash_speed(0)
-{ 
-  std::string spritename;
-  std::string highlightname;
-  std::string lightname;
-  
-  props.get(&quot;name&quot;, name);
-  props.get(&quot;sprite&quot;, spritename);
-  props.get(&quot;highlight&quot;, highlightname);
-  props.get(&quot;light&quot;,   lightname);
-  props.get(&quot;pos&quot;, pos);
-  props.get(&quot;script&quot;, use_script);
-  props.get(&quot;use-verb&quot;, use_verb);
-  props.get(&quot;active&quot;, active);
-  props.get(&quot;flash-speed&quot;, flash_speed); // FIXME: bad name, should be something more generic
-  props.get(&quot;z-pos&quot;, z_pos);
-  props.print_unused_warnings(&quot;scriptable-object&quot;);
-  
-  if (use_verb != &quot;&quot;)
-    set_useable(true);
-  
-  if(spritename != &quot;&quot;)
-    sprite = Sprite(spritename);
-  
-  if (highlightname != &quot;&quot;)
-    {
-      highlight = Sprite(highlightname);
-      highlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-    }
-
-  if (lightname != &quot;&quot;)
-    {
-      light = Sprite(lightname);
-      light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-    }
-    
-  flash_delta = game_time;
-  target_x = pos.x;
-  target_y = pos.y;
-}
-
-ScriptableObject::~ScriptableObject()
-{
-}
-
-void
-ScriptableObject::draw(SceneContext&amp; sc)
-{
-  Vector tmp_pos = pos;
-
-  if (parent)
-    tmp_pos += parent-&gt;get_pos();
-
-  if (flash_speed != 0)
-    flash();
-
-  if (sprite)
-    sc.color().draw(sprite, tmp_pos, z_pos);
-  
-  if (highlight) 
-    sc.highlight().draw(highlight, tmp_pos, z_pos);
-
-  if (light) 
-    {
-      sc.light().draw(light, tmp_pos, z_pos);
-    }
-}
-
-void
-ScriptableObject::update(float delta)
-{
-  if (sprite)
-    sprite.update(delta);
-
-  if (highlight)
-    highlight.update(delta);
-
-  if (light)
-    light.update(delta);
-    
-  if (target_speed &gt; 0)
-    move(delta);
-}
-
-void
-ScriptableObject::use()
-{
-  script_manager-&gt;run_script(use_script, &quot;ScriptableObject&quot;);
-}
-
-void
-ScriptableObject::move_to(float x, float y, float arg_target_speed, float arg_acceleration)
-{
-  target_x = x;
-  target_y = y;
-  target_speed = arg_target_speed;
-  acceleration = arg_acceleration;
-}
-
-void
-ScriptableObject::start_flash(float speed)
-{
-  active = true;
-  flash_speed = speed;
-  flash_delta = game_time;
-}
-
-void
-ScriptableObject::move(float delta)
-{
-  float dx = target_x - pos.x;
-  float dy = target_y - pos.y;
-  
-  if (!dx &amp;&amp; !dy) {
-    target_speed = 0;
-    return;
-  }
-  
-  //Work out proportion of x/y in direction vector
-  float propx = 0;
-  float propy = 0;
-  
-  float adx = fabs(dx);
-  float ady = fabs(dy);
-  
-  //we can't divide by 0 because we return above if !dx and !dy
-  if (dx &lt; 0)
-    propx = -(adx / (adx + ady));
-  else
-    propx = adx / (adx + ady);
-  
-  if (dy &lt; 0)
-    propy = -(ady / (adx + ady));
-  else
-    propy = ady / (adx + ady);
-  
-  //accelerate
-  float dvx = acceleration * delta * propx;
-  float dvy = acceleration * delta * propy;  
-  velocity.x += dvx;
-  velocity.y += dvy;
-    
-  //don't accelerate past max speed
-  float max_vx = fabs(target_speed * propx);
-  float max_vy = fabs(target_speed * propy);
-  
-  if (velocity.x &gt; max_vx)
-    velocity.x = max_vx;
-  else if (velocity.x &lt; -max_vx)
-    velocity.x = -max_vx;
-  
-  if (velocity.y &gt; max_vy)
-    velocity.y = max_vy;
-  else if (velocity.y &lt; -max_vy)
-    velocity.y = -max_vy;
-  
-  //don't move past the target
-  float distx = velocity.x * delta;
-  float disty = velocity.y * delta;
-  
-  if (adx - fabs(distx) &lt; 0)
-    distx = dx;
-  if (ady - fabs(disty) &lt; 0)
-    disty = dy;
-    
-  pos.x += distx;
-  pos.y += disty;
-}
-
-void
-ScriptableObject::flash()
-{
-  float time = game_time - flash_delta;
-  if(static_cast&lt;int&gt;(time/flash_speed) % 2 == 0) {    
-    float alpha = fmodf(time, flash_speed) / flash_speed;
-    // fade on
-    highlight.set_alpha(alpha);
-    light.set_alpha(alpha);
-  } else {
-    float alpha = 1.0 - (fmodf(time, flash_speed) / flash_speed);
-    // fade off
-    highlight.set_alpha(alpha);
-    light.set_alpha(alpha);
-  }
-}
-
-/* EOF */

Deleted: trunk/windstille/src/scriptable_object.hpp
===================================================================
--- trunk/windstille/src/scriptable_object.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/scriptable_object.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -1,73 +0,0 @@
-/*
-**  Windstille - A Sci-Fi Action-Adventure Game
-**  Copyright (C) 2005 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-**
-**  This program is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU General Public License as published by
-**  the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**  
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-**  
-**  You should have received a copy of the GNU General Public License
-**  along with this program.  If not, see &lt;<A HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</A>&gt;.
-*/
-
-
-#ifndef HEADER_WINDSTILLE_SCRIPTABLE_OBJECT_HPP
-#define HEADER_WINDSTILLE_SCRIPTABLE_OBJECT_HPP
-
-#include &lt;string&gt;
-#include &quot;entity.hpp&quot;
-#include &quot;sprite2d/sprite.hpp&quot;
-
-/** Can represent any generic object that the player may see or interact with that
-does not require collision physics or specialized C++ code. For example doors, trains,
-signs, objects you can pick up, and animations.
-
-TODO: should this provide optional collision detection such that you can use it to make
-crates etc? Or perhaps another object should derive from this which adds collision
-detection?
-*/
-class ScriptableObject : public Entity
-{
-private:
-  Sprite sprite;
-  Sprite light;
-  Sprite highlight;
-  float z_pos;
-  
-  //useable stuff
-  std::string use_script;
-  
-  //movement stuff
-  float target_x;
-  float target_y;
-  float target_speed;
-  float acceleration;
-  
-  //flashing stuff
-  float flash_speed;
-  float flash_delta;
-  
-protected:
-  void move(float delta);
-  void flash();
-
-public:
-  ScriptableObject(FileReader&amp; reader);
-  virtual ~ScriptableObject();
-
-  void draw (SceneContext&amp; sc);
-  void update (float delta);
-  void use();
-  void move_to(float x, float y, float arg_target_speed, float arg_acceleration);
-  void start_flash(float speed);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/windstille/src/scripting/game_objects.hpp
===================================================================
--- trunk/windstille/src/scripting/game_objects.hpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/scripting/game_objects.hpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -22,8 +22,8 @@
 #ifndef SCRIPTING_API
 #include &quot;game_object.hpp&quot;
 #include &quot;objects/test_object.hpp&quot;
-#include &quot;player.hpp&quot;
-#include &quot;scriptable_object.hpp&quot;
+#include &quot;objects/player.hpp&quot;
+#include &quot;objects/scriptable_object.hpp&quot;
 #include &quot;ref.hpp&quot;
 
 typedef GameObject _GameObject;

Modified: trunk/windstille/src/sector.cpp
===================================================================
--- trunk/windstille/src/sector.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/sector.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -25,7 +25,7 @@
 #include &quot;objects/background_gradient.hpp&quot;
 #include &quot;tile_map.hpp&quot;
 #include &quot;game_object.hpp&quot;
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;trigger.hpp&quot;
 #include &quot;objects/test_object.hpp&quot;
 #include &quot;sector.hpp&quot;
@@ -35,17 +35,17 @@
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;particles/particle_system.hpp&quot;
 #include &quot;objects/test_object.hpp&quot;
-#include &quot;elevator.hpp&quot;
+#include &quot;objects/elevator.hpp&quot;
 #include &quot;objects/nightvision.hpp&quot;
-#include &quot;character.hpp&quot;
+#include &quot;objects/character.hpp&quot;
 #include &quot;laser_pointer.hpp&quot;
 #include &quot;objects/swarm.hpp&quot;
-#include &quot;liquid.hpp&quot;
+#include &quot;objects/liquid.hpp&quot;
 #include &quot;objects/shockwave.hpp&quot;
 #include &quot;objects/hedgehog.hpp&quot;
 #include &quot;objects/spider_mine.hpp&quot;
-#include &quot;box.hpp&quot;
-#include &quot;scriptable_object.hpp&quot;
+#include &quot;objects/box.hpp&quot;
+#include &quot;objects/scriptable_object.hpp&quot;
 #include &quot;navigation/navigation_graph.hpp&quot;
 #include &quot;scripting/squirrel_error.hpp&quot;
 

Modified: trunk/windstille/src/trigger.cpp
===================================================================
--- trunk/windstille/src/trigger.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/trigger.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -20,7 +20,7 @@
 #include &lt;list&gt;
 #include &quot;sector.hpp&quot;
 #include &quot;trigger.hpp&quot;
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;script_manager.hpp&quot;
 
 Trigger::Trigger(FileReader&amp; props)

Modified: trunk/windstille/src/view.cpp
===================================================================
--- trunk/windstille/src/view.cpp	2009-02-11 16:25:56 UTC (rev 2457)
+++ trunk/windstille/src/view.cpp	2009-02-11 17:47:58 UTC (rev 2458)
@@ -19,7 +19,7 @@
 #include &lt;SDL.h&gt;
 #include &quot;display/display.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
-#include &quot;player.hpp&quot;
+#include &quot;objects/player.hpp&quot;
 #include &quot;sector.hpp&quot;
 #include &quot;view.hpp&quot;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001454.html">[Windstille-commit] r2457 - in trunk/windstille/src: . collision	scripting sound sprite2d sprite3d
</A></li>
	<LI>Next message: <A HREF="001456.html">[Windstille-commit] r2459 - in trunk/windstille: doc src src/math	src/navigation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1455">[ date ]</a>
              <a href="thread.html#1455">[ thread ]</a>
              <a href="subject.html#1455">[ subject ]</a>
              <a href="author.html#1455">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
