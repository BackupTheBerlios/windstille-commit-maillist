<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1158 - facebuilder
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-December/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1158%20-%20facebuilder&In-Reply-To=%3C200512251920.jBPJKxIo007801%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000810.html">
   <LINK REL="Next"  HREF="000812.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1158 - facebuilder</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1158%20-%20facebuilder&In-Reply-To=%3C200512251920.jBPJKxIo007801%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1158 - facebuilder">grumbel at berlios.de
       </A><BR>
    <I>Sun Dec 25 20:20:59 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000810.html">[Windstille-commit] r1157 - in facebuilder: . examples
</A></li>
        <LI>Next message: <A HREF="000812.html">[Windstille-commit] r1159 - facebuilder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#811">[ date ]</a>
              <a href="thread.html#811">[ thread ]</a>
              <a href="subject.html#811">[ subject ]</a>
              <a href="author.html#811">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-12-25 20:20:56 +0100 (Sun, 25 Dec 2005)
New Revision: 1158

Modified:
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
- some more gnomification

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-25 17:02:47 UTC (rev 1157)
+++ facebuilder/facebuilder.glade	2005-12-25 19:20:56 UTC (rev 1158)
@@ -35,7 +35,7 @@
 	  &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_NONE&lt;/property&gt;
 
 	  &lt;child&gt;
-	    &lt;widget class=&quot;GtkMenuBar&quot; id=&quot;menubar1&quot;&gt;
+	    &lt;widget class=&quot;GtkMenuBar&quot; id=&quot;FaceParts&quot;&gt;
 	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 
 	      &lt;child&gt;
@@ -319,74 +319,69 @@
 	  &lt;/child&gt;
 
 	  &lt;child&gt;
-	    &lt;widget class=&quot;GtkVPaned&quot; id=&quot;vpaned1&quot;&gt;
-	      &lt;property name=&quot;width_request&quot;&gt;85&lt;/property&gt;
+	    &lt;widget class=&quot;GtkScrolledWindow&quot; id=&quot;scrolledwindow2&quot;&gt;
 	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-	      &lt;property name=&quot;position&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;hscrollbar_policy&quot;&gt;GTK_POLICY_AUTOMATIC&lt;/property&gt;
+	      &lt;property name=&quot;vscrollbar_policy&quot;&gt;GTK_POLICY_AUTOMATIC&lt;/property&gt;
+	      &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_IN&lt;/property&gt;
+	      &lt;property name=&quot;window_placement&quot;&gt;GTK_CORNER_TOP_LEFT&lt;/property&gt;
 
 	      &lt;child&gt;
-		&lt;widget class=&quot;GtkScrolledWindow&quot; id=&quot;scrolledwindow3&quot;&gt;
+		&lt;widget class=&quot;GtkViewport&quot; id=&quot;viewport1&quot;&gt;
 		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;hscrollbar_policy&quot;&gt;GTK_POLICY_ALWAYS&lt;/property&gt;
-		  &lt;property name=&quot;vscrollbar_policy&quot;&gt;GTK_POLICY_ALWAYS&lt;/property&gt;
 		  &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_IN&lt;/property&gt;
-		  &lt;property name=&quot;window_placement&quot;&gt;GTK_CORNER_TOP_LEFT&lt;/property&gt;
 
 		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkTreeView&quot; id=&quot;FaceParts&quot;&gt;
-		      &lt;property name=&quot;width_request&quot;&gt;64&lt;/property&gt;
+		    &lt;widget class=&quot;GtkVBox&quot; id=&quot;vbox1&quot;&gt;
 		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;headers_visible&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;rules_hint&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;reorderable&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;enable_search&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;fixed_height_mode&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;hover_selection&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;hover_expand&quot;&gt;False&lt;/property&gt;
-		    &lt;/widget&gt;
-		  &lt;/child&gt;
-		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;shrink&quot;&gt;False&lt;/property&gt;
-		  &lt;property name=&quot;resize&quot;&gt;False&lt;/property&gt;
-		&lt;/packing&gt;
-	      &lt;/child&gt;
+		      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
+		      &lt;property name=&quot;spacing&quot;&gt;0&lt;/property&gt;
 
-	      &lt;child&gt;
-		&lt;widget class=&quot;GtkScrolledWindow&quot; id=&quot;scrolledwindow2&quot;&gt;
-		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;hscrollbar_policy&quot;&gt;GTK_POLICY_ALWAYS&lt;/property&gt;
-		  &lt;property name=&quot;vscrollbar_policy&quot;&gt;GTK_POLICY_ALWAYS&lt;/property&gt;
-		  &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_IN&lt;/property&gt;
-		  &lt;property name=&quot;window_placement&quot;&gt;GTK_CORNER_TOP_LEFT&lt;/property&gt;
+		      &lt;child&gt;
+			&lt;widget class=&quot;GtkComboBox&quot; id=&quot;PartSelector&quot;&gt;
+			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;add_tearoffs&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;focus_on_click&quot;&gt;True&lt;/property&gt;
+			&lt;/widget&gt;
+			&lt;packing&gt;
+			  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
+			  &lt;property name=&quot;fill&quot;&gt;False&lt;/property&gt;
+			&lt;/packing&gt;
+		      &lt;/child&gt;
 
-		  &lt;child&gt;
-		    &lt;widget class=&quot;GtkTreeView&quot; id=&quot;PartSelector&quot;&gt;
-		      &lt;property name=&quot;height_request&quot;&gt;100&lt;/property&gt;
-		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
-		      &lt;property name=&quot;headers_visible&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;rules_hint&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;reorderable&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;enable_search&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;fixed_height_mode&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;hover_selection&quot;&gt;False&lt;/property&gt;
-		      &lt;property name=&quot;hover_expand&quot;&gt;False&lt;/property&gt;
+		      &lt;child&gt;
+			&lt;widget class=&quot;GtkScrolledWindow&quot; id=&quot;scrolledwindow3&quot;&gt;
+			  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;hscrollbar_policy&quot;&gt;GTK_POLICY_ALWAYS&lt;/property&gt;
+			  &lt;property name=&quot;vscrollbar_policy&quot;&gt;GTK_POLICY_ALWAYS&lt;/property&gt;
+			  &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_NONE&lt;/property&gt;
+			  &lt;property name=&quot;window_placement&quot;&gt;GTK_CORNER_TOP_LEFT&lt;/property&gt;
+
+			  &lt;child&gt;
+			    &lt;widget class=&quot;GtkIconView&quot; id=&quot;FaceParts&quot;&gt;
+			      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+			      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+			      &lt;property name=&quot;selection_mode&quot;&gt;GTK_SELECTION_SINGLE&lt;/property&gt;
+			      &lt;property name=&quot;orientation&quot;&gt;GTK_ORIENTATION_VERTICAL&lt;/property&gt;
+			    &lt;/widget&gt;
+			  &lt;/child&gt;
+			&lt;/widget&gt;
+			&lt;packing&gt;
+			  &lt;property name=&quot;padding&quot;&gt;0&lt;/property&gt;
+			  &lt;property name=&quot;expand&quot;&gt;True&lt;/property&gt;
+			  &lt;property name=&quot;fill&quot;&gt;True&lt;/property&gt;
+			&lt;/packing&gt;
+		      &lt;/child&gt;
 		    &lt;/widget&gt;
 		  &lt;/child&gt;
 		&lt;/widget&gt;
-		&lt;packing&gt;
-		  &lt;property name=&quot;shrink&quot;&gt;True&lt;/property&gt;
-		  &lt;property name=&quot;resize&quot;&gt;True&lt;/property&gt;
-		&lt;/packing&gt;
 	      &lt;/child&gt;
 	    &lt;/widget&gt;
 	    &lt;packing&gt;
-	      &lt;property name=&quot;shrink&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;shrink&quot;&gt;True&lt;/property&gt;
 	      &lt;property name=&quot;resize&quot;&gt;True&lt;/property&gt;
 	    &lt;/packing&gt;
 	  &lt;/child&gt;

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 17:02:47 UTC (rev 1157)
+++ facebuilder/facebuilder.rb	2005-12-25 19:20:56 UTC (rev 1158)
@@ -18,19 +18,19 @@
     tips = @glade.get_tooltips(app.toplevel)
     callback_dummy = Proc.new{} #Dummy 
     uiinfos = [
-      Gnome::UIInfo::menu_new_item('_New', nil, callback_dummy, nil),
-      Gnome::UIInfo::menu_open_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_save_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_save_as_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_quit_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_cut_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_copy_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_paste_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_clear_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_properties_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_about_item(callback_dummy, nil),
-    ]
+               Gnome::UIInfo::menu_new_item('_New', nil, callback_dummy, nil),
+               Gnome::UIInfo::menu_open_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_save_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_save_as_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_quit_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_cut_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_copy_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_paste_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_clear_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_properties_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_about_item(callback_dummy, nil),
+              ]
     uiinfos[0][9] = @glade['new1']
     uiinfos[1][9] = @glade['open1']
     uiinfos[2][9] = @glade['save1']
@@ -77,9 +77,9 @@
     setup_controls(@canvas.root, Point.new(-200, -140),   :forehead)
     setup_controls(@canvas.root, Point.new(0, 200),   :head)
     setup_controls(@canvas.root, Point.new(200, -140), :hair)
-
+    
     setup_controls(@canvas.root, Point.new(-200, 0), :glasses)
-
+    
     setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
     setup_controls(@canvas.root, Point.new(200, 0),   :eye)
     setup_controls(@canvas.root, Point.new(200, 40),  :nose)
@@ -97,6 +97,10 @@
                             :anchor =&gt; Gtk::ANCHOR_N,
                             :fill_color =&gt; &quot;black&quot;})
 
+    @canvas.signal_connect_after(&quot;button-press-event&quot;) { |widget, event|
+      widget.grab_focus()
+    }
+
     @canvas.signal_connect(&quot;key-press-event&quot;) { |widget, event|
       part = @face.get_part(@parts[@current_part])
       case event.keyval
@@ -151,7 +155,7 @@
   end
   
   def on_open1_activate(widget)
-        dialog =  Gtk::FileChooserDialog.new(&quot;Gtk::FileChooser sample&quot;, nil,
+    dialog =  Gtk::FileChooserDialog.new(&quot;Gtk::FileChooser sample&quot;, nil,
                                          Gtk::FileChooser::ACTION_OPEN,
                                          &quot;gnome-vfs&quot;,
                                          [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
@@ -259,40 +263,61 @@
 
   def setup_faceparts()
     @treeview = @glade['FaceParts']
-    @list = Gtk::ListStore.new(Gdk::Pixbuf, String)
+    @list = Gtk::ListStore.new(String, Gdk::Pixbuf)
     @treeview.model = @list
-    @treeview.append_column(Gtk::TreeViewColumn.new(&quot;Stuff&quot;,
-                                                    Gtk::CellRendererPixbuf.new, 
-                                                    {:pixbuf =&gt; 0}))    
-    
-    @treeview.signal_connect(&quot;cursor-changed&quot;) { |treeview|
-      row, column = treeview.cursor()
-      puts @list.methods()
+    @treeview.set_property('selection-mode', Gtk::SELECTION_BROWSE)
 
-      puts &quot;Selected something #{@list.get_value(@list.get_iter(row), 1)}&quot;
-      filename = @list.get_value(@list.get_iter(row), 1)
-      @face.get_part(@parts[@current_part]).filename = filename
+    @treeview.signal_connect(&quot;selection-changed&quot;) { |iconview|
+      row = iconview.selected_items()[0]
+      if row then # when does this get nil?
+        filename = iconview.model.get_value(@list.get_iter(row), 0)
+        # puts filename.inspect
+        @face.get_part(@parts[@current_part]).filename = filename
+        # puts &quot;Selected something #{iconview.model.get_value(@list.get_iter(row), 1)}&quot;
+      end
     }
+
+    @treeview.text_column   = -1
+    @treeview.pixbuf_column = 1
   end
 
   def setup_partselector()
-    list = Gtk::ListStore.new(String)
     partselector = @glade['PartSelector']
-    partselector.model = list
+
+    #partselector.model = Gtk::ListStore.new(String)
     
+    model = Gtk::ListStore.new(Gdk::Pixbuf, String)
+
+    partselector.model = model
+    renderer = Gtk::CellRendererPixbuf.new
+    partselector.pack_start(renderer, false)
+    partselector.set_attributes(renderer, :pixbuf =&gt; 0)
+    
+    renderer = Gtk::CellRendererText.new
+    partselector.pack_start(renderer, true)
+    partselector.set_attributes(renderer, :text =&gt; 1)
+
+    partselector.signal_connect(&quot;changed&quot;) { |partselector|
+      set_current_part(@parts[partselector.active])
+    }
+
     @parts.each {|part|
-      iter = list.append()
-      iter[0] = part.to_s
+      #puts part.to_s
+      #iter = partselector.model.append()
+      #iter[0] = &quot;bla&quot; # part.to_s
+      # partselector.append_text part.to_s
+
+      iter = model.append
+      iter[0] = @glade['FaceBuilder'].render_icon(Gtk::Stock::OK, Gtk::IconSize::MENU, &quot;icon&quot;)
+      iter[1] = part.to_s
     }
-
-    partselector.append_column(Gtk::TreeViewColumn.new(&quot;Stuff&quot;,
-                                                       Gtk::CellRendererText.new, 
-                                                       {:text =&gt; 0}))    
   end
 
   def set_current_part(type)
     @parts.each_with_index() { |p, i|
       if type == p then
+        @glade['PartSelector'].active = i
+
         if @current_part != i
           @list.clear()
           Dir.new(&quot;data/#{type}/&quot;).grep(/\.png$/).each{|v|
@@ -310,9 +335,10 @@
               end
             end
 
+            
             # Add keep of aspect ratio
-            iter[0] = pixbuf
-            iter[1] = filename
+            iter[1] = pixbuf
+            iter[0] = filename
           }
 
           @current_part = i


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000810.html">[Windstille-commit] r1157 - in facebuilder: . examples
</A></li>
	<LI>Next message: <A HREF="000812.html">[Windstille-commit] r1159 - facebuilder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#811">[ date ]</a>
              <a href="thread.html#811">[ thread ]</a>
              <a href="subject.html#811">[ subject ]</a>
              <a href="author.html#811">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
