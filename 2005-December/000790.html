<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1137 - / facebuilder facebuilder/data facebuilder/data/ear facebuilder/data/eye facebuilder/data/eyebrow facebuilder/data/glasses facebuilder/data/hair facebuilder/data/head facebuilder/data/mouth facebuilder/data/nose trunk trunk/data/blender/hero trunk/data/images/objects trunk/data/levels trunk/data/models/vehicles/minetrain trunk/data/models/vehicles/troopshuttle
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-December/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1137%20-%20/%20facebuilder%20facebuilder/data%20facebuilder/data/ear%20facebuilder/data/eye%20facebuilder/data/eyebrow%20facebuilder/data/glasses%20facebuilder/data/hair%20facebuilder/data/head%20facebuilder/data/mouth%20facebuilder/data/nose%20trunk%20trunk/data/blender/hero%20trunk/data/images/objects%20trunk/data/levels%20trunk/data/models/vehicles/minetrain%20trunk/data/models/vehicles/troopshuttle&In-Reply-To=%3C200512171553.jBHFrVew000805%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000789.html">
   <LINK REL="Next"  HREF="000791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1137 - / facebuilder facebuilder/data facebuilder/data/ear facebuilder/data/eye facebuilder/data/eyebrow facebuilder/data/glasses facebuilder/data/hair facebuilder/data/head facebuilder/data/mouth facebuilder/data/nose trunk trunk/data/blender/hero trunk/data/images/objects trunk/data/levels trunk/data/models/vehicles/minetrain trunk/data/models/vehicles/troopshuttle</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1137%20-%20/%20facebuilder%20facebuilder/data%20facebuilder/data/ear%20facebuilder/data/eye%20facebuilder/data/eyebrow%20facebuilder/data/glasses%20facebuilder/data/hair%20facebuilder/data/head%20facebuilder/data/mouth%20facebuilder/data/nose%20trunk%20trunk/data/blender/hero%20trunk/data/images/objects%20trunk/data/levels%20trunk/data/models/vehicles/minetrain%20trunk/data/models/vehicles/troopshuttle&In-Reply-To=%3C200512171553.jBHFrVew000805%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1137 - / facebuilder facebuilder/data facebuilder/data/ear facebuilder/data/eye facebuilder/data/eyebrow facebuilder/data/glasses facebuilder/data/hair facebuilder/data/head facebuilder/data/mouth facebuilder/data/nose trunk trunk/data/blender/hero trunk/data/images/objects trunk/data/levels trunk/data/models/vehicles/minetrain trunk/data/models/vehicles/troopshuttle">grumbel at berlios.de
       </A><BR>
    <I>Sat Dec 17 16:53:31 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000789.html">[Windstille-commit] r1136 - htdocs
</A></li>
        <LI>Next message: <A HREF="000791.html">[Windstille-commit] r1138 - in facebuilder: . data data/beard data/eye data/glasses data/hair data/head data/mouth data/nose
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#790">[ date ]</a>
              <a href="thread.html#790">[ thread ]</a>
              <a href="subject.html#790">[ subject ]</a>
              <a href="author.html#790">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-12-17 16:51:41 +0100 (Sat, 17 Dec 2005)
New Revision: 1137

Added:
   facebuilder/
   facebuilder/clock.rb
   facebuilder/data/
   facebuilder/data/ear/
   facebuilder/data/ear/0000.png
   facebuilder/data/eye/
   facebuilder/data/eye/0000.png
   facebuilder/data/eye/0001.png
   facebuilder/data/eye/0002.png
   facebuilder/data/eye/0003.png
   facebuilder/data/eye/0004.png
   facebuilder/data/eyebrow/
   facebuilder/data/eyebrow/0000.png
   facebuilder/data/glasses/
   facebuilder/data/glasses/0000.png
   facebuilder/data/glasses/0001.png
   facebuilder/data/glasses/0002.png
   facebuilder/data/hair/
   facebuilder/data/hair/0000.png
   facebuilder/data/hair/0001.png
   facebuilder/data/hair/0002.png
   facebuilder/data/head/
   facebuilder/data/head/0000.png
   facebuilder/data/head/0001.png
   facebuilder/data/head/0002.png
   facebuilder/data/mouth/
   facebuilder/data/mouth/0000.png
   facebuilder/data/mouth/0001.png
   facebuilder/data/mouth/0002.png
   facebuilder/data/mouth/0003.png
   facebuilder/data/nose/
   facebuilder/data/nose/0000.png
   facebuilder/face.rb
   facebuilder/facebuilder.rb
   facebuilder/protoface.xcf
   trunk/data/images/objects/steelboxlarge.xcf
   trunk/data/images/objects/steelboxsmall.xcf
Modified:
   trunk/AUTHORS
   trunk/SConstruct
   trunk/data/blender/hero/heroken3.blend
   trunk/data/levels/industrial.wst
   trunk/data/levels/newformat2.wst
   trunk/data/models/vehicles/minetrain/minetrain.xcf
   trunk/data/models/vehicles/troopshuttle/troopshuttle.blend
Log:
- added facebuilder

Added: facebuilder/clock.rb
===================================================================
--- facebuilder/clock.rb	2005-12-13 11:09:37 UTC (rev 1136)
+++ facebuilder/clock.rb	2005-12-17 15:51:41 UTC (rev 1137)
@@ -0,0 +1,177 @@
+#!/usr/bin/env ruby
+#
+# GnomeCanvas based analog clock widget
+#
+# Copyright (c) 2004 Geoff Youngs
+#
+# You can redistribute it and/or modify it under the terms of
+# the Ruby's licence.
+
+require 'gnomecanvas2'
+
+class Clock &lt; Gtk::VBox
+  Point = Struct.new(&quot;Point&quot;, :x, :y)
+  class Point
+    def to_p
+     [x,y]
+    end
+    def -(p)
+      [x-p.x, y-p.y]
+    end
+  end
+  def clockhandposition(center, len, val, max)
+    angle = (Math::PI * (((val * 360.0) / max) - 90.0)) / 180.0
+    Point.new(center.x + (len * Math.cos(angle)),
+                         center.y + (len * Math.sin(angle)))
+  end
+  def basehandposition(center, len, val, max)
+    angle = (Math::PI * ((val * 360.0) / max)) / 180.0
+    Point.new(center.x + (len * Math.cos(angle)),
+                         center.y + (len * Math.sin(angle)))
+  end
+  def setup_clock()
+    topleft = Point.new(1.0,1.0)
+    bottomright = Point.new(100.0, 100.0)
+    center = Point.new(bottomright.x/2, bottomright.y/2)
+    @face=Gnome::CanvasEllipse.new(@canvas.root, {:x1 =&gt; topleft.x,
+                 :y1 =&gt; topleft.y,
+                 :x2 =&gt; bottomright.x,
+                 :y2 =&gt; bottomright.y,
+                 :fill_color =&gt; &quot;white&quot;,
+                 :outline_color =&gt; &quot;steelblue&quot;,
+                 :width_pixels =&gt; 1})
+    @radius = o = center.x * 0.50
+    o  = @radius / 2
+    @size =  center.x
+    @knob=Gnome::CanvasEllipse.new(@canvas.root, {:x1 =&gt; center.x-o,
+                 :y1 =&gt; center.y-o,
+                 :x2 =&gt; center.x+o,
+                 :y2 =&gt; center.y+o,
+                 :fill_color_rgba =&gt; 0x00669933})
+
+    @time = Time.now
+    @hourh = Gnome::CanvasPolygon.new(@canvas.root,
+                                          {:points =&gt; hourhand(center),
+                                            :fill_color_rgba =&gt; 0x00000080,
+                                            :join_style =&gt; Gdk::GC::JOIN_ROUND,
+                                            :outline_color =&gt; &quot;black&quot;})
+    @minuteh = Gnome::CanvasPolygon.new(@canvas.root,
+                                          {:points =&gt; minutehand(center),
+                                            :fill_color_rgba =&gt; 0x00000080,
+                                            :join_style =&gt; Gdk::GC::JOIN_ROUND,
+                                            :outline_color =&gt; &quot;black&quot;})
+    @secondh = Gnome::CanvasPolygon.new(@canvas.root,
+                                          {:points =&gt; secondhand(center),
+                                            :fill_color_rgba =&gt; 0xff000080,
+                                            :join_style =&gt; Gdk::GC::JOIN_ROUND,
+                                            :outline_color =&gt; &quot;red&quot;})
+
+                 
+  end
+  def hourhand(center)
+    val = (@time.hour % 12) + (@time.min / 60.0)
+    posn = clockhandposition(center, @radius * 0.6, val, 12)
+    size = @radius * 0.08
+    start = basehandposition(center, size, val, 12)
+    retn = basehandposition(center, - size, val, 12)
+    backp = clockhandposition(center, - size, val, 12)
+    [start.to_p, posn.to_p, retn.to_p, backp.to_p]
+  end
+  def minutehand(center)
+    posn = clockhandposition(center, [@radius - 4, @radius * 0.8].max, @time.min, 60)
+    size = @radius * 0.03
+    start = basehandposition(center, size, @time.min, 60)
+    retn = basehandposition(center, -size, @time.min, 60)
+    backp = clockhandposition(center, - size, @time.min, 60)
+    [start.to_p, posn.to_p, retn.to_p, backp.to_p]
+  end
+  def secondhand(center)
+    posn = clockhandposition(center, @radius * 0.9, @time.sec, 60)
+    size = @radius * 0.01
+    start = basehandposition(center, size, @time.sec, 60)
+    retn = basehandposition(center, -size, @time.sec, 60)
+    backp = clockhandposition(center, - size, @time.sec, 60)
+    [start.to_p, posn.to_p, retn.to_p, backp.to_p]
+  end
+  def draw_clock(resize=false)
+    return false if destroyed?
+    setup_clock() unless defined?(@face)
+    center = Point.new(@width/2, @height/2)
+    
+    if resize
+      @face.x1, @face.y1 = center.x - @radius, center.y - @radius
+      @face.x2, @face.y2 = center.x + @radius, center.y + @radius
+      o = @radius * 0.5
+      @knob.x1, @knob.y1 = center.x-o, center.y-o
+      @knob.x2, @knob.y2 = center.x+o, center.y+o
+    end
+    @time = Time.now
+    @hourh.points = hourhand(center)
+    @minuteh.points = minutehand(center)
+    @secondh.points = secondhand(center)
+    @label.set_markup(sprintf(&quot;&lt;small&gt;&lt;small&gt;%02i:%02i&lt;/small&gt;&lt;/small&gt;&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">, at time.hour</A>, @time.min))
+  end
+
+  def initialize()
+    super()
+    @box = Gtk::EventBox.new
+    pack_start(@box)
+    @label = Gtk::Label.new
+    @label.show
+    pack_end(@label,false,false,0)
+    set_border_width(@pad = 2)
+    set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
+    @canvas = Gnome::Canvas.new(true)
+    @box.add(@canvas)
+    draw_clock()
+    @box.signal_connect('size-allocate') { |w,e,*b| 
+      @width, @height = [e.width,e.height].collect{|i|i - (@pad*2)}
+      @size = [@<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">width, at height</A>].min
+      @radius = @size / 2
+      @canvas.set_size(@<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">width, at height</A>)
+      @canvas.set_scroll_region(<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">0,0, at width</A><A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">, at height</A>)
+      draw_clock(true)
+      false
+    }
+    signal_connect_after('show') {|w,e| start() }
+    signal_connect_after('hide') {|w,e| stop() }
+    @canvas.show()
+    @box.show()
+    show()
+  end
+  def start
+	@tid= Gtk::timeout_add(1000) { draw_clock(); true }
+  end
+  def stop
+	Gtk::timeout_remove(@tid) if @tid
+	@tid = nil
+  end
+  def set_bg(bg)
+  	modify_bg(Gtk::STATE_NORMAL, bg)
+  	@box.modify_bg(Gtk::STATE_NORMAL, bg)
+  	@canvas.modify_bg(Gtk::STATE_NORMAL, bg)
+  end
+end
+
+
+if $0 == __FILE__
+
+class Viewer &lt; Gtk::Window
+  def initialize()
+    super()
+    set_title(&quot;Analog Clock&quot;)
+    signal_connect(&quot;delete_event&quot;) { |i,a| Gtk::main_quit }
+    set_default_size(200,220)
+    add(Clock.new)
+    show()
+  end
+end
+
+Gtk.init()
+
+view = Viewer.new
+view.show
+
+Gtk.main()
+  
+end

Added: facebuilder/data/ear/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/ear/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-13 11:09:37 UTC (rev 1136)
+++ facebuilder/face.rb	2005-12-17 15:51:41 UTC (rev 1137)
@@ -0,0 +1,160 @@
+require 'gnomecanvas2'
+
+class FacePart
+  attr_reader :type, :offset, :filename, :canvas_items, :scale, :rotation
+  
+  def initialize(root, type, filename, offset)
+    @type     = type
+    @offset   = offset
+    @filename = filename
+    @scale    = 1.0
+    @rotation = 0
+
+    @canvas_items = []
+
+    im = Gdk::Pixbuf.new(@filename)
+    if ! im then 
+      raise &quot;#{@filename}: file not found: #{im.inspect}&quot;
+    end
+
+    @canvas_items &lt;&lt; Gnome::CanvasPixbuf.new(root,
+                                             :pixbuf =&gt; im,
+                                             :x =&gt; 0, # offset.x,
+                                             :y =&gt; 0, # offset.y,
+                                             :width =&gt;  im.width,
+                                             :height =&gt; im.height,
+                                             :anchor =&gt; Gtk::ANCHOR_CENTER)
+
+    case @type
+    when :eye, :ear, :eyebrow
+      @canvas_items &lt;&lt; Gnome::CanvasPixbuf.new(root,
+                                               :pixbuf =&gt; im,
+                                               :x =&gt; 0, # offset.x,
+                                               :y =&gt; 0, # offset.y,
+                                               :width =&gt;  im.width,
+                                               :height =&gt; im.height,
+                                               :anchor =&gt; Gtk::ANCHOR_CENTER)
+    end
+    update_items()
+  end
+
+  def reload()
+    self.filename=(@filename)
+  end
+  
+  def toggle()
+    pathname = &quot;data/&quot; + type.to_s + &quot;/&quot;
+    files = Dir.new(pathname).to_a[2..-1]
+
+
+    file = File::basename(@filename)
+    index = 0
+
+    files.each_with_index { |obj, i|
+      if obj == file then
+        index = i
+        break
+      end
+    }
+    index += 1
+    
+    if index &gt;= files.length then
+      index = 0
+    end
+
+    self.filename=(pathname + files[index])
+  end
+
+  def update_items()
+    if @canvas_items.length == 1 then
+      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+    elsif @canvas_items.length == 2 then
+      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+      @canvas_items[1].affine_absolute(Art::Affine.scale(-1.0, 1.0) * 
+                                       Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+    else
+      raise &quot;Unhandled @canvas_items.length: #{@canvas_items.length}&quot;
+    end
+  end
+
+  def rotation=(rotation)
+    @rotation = rotation
+    update_items()
+  end
+
+  def scale=(scale)
+    @scale = scale
+    update_items()
+  end
+
+  def filename=(filename)
+    puts &quot;Setting: #{filename}&quot;
+    @filename = filename    
+    pixbuf = Gdk::Pixbuf.new(@filename)
+    @canvas_items.each {|item|
+      item.pixbuf = pixbuf
+    }
+  end
+
+  def offset=(offset)
+    @offset = offset
+    update_items()
+  end
+
+  def offset()
+    return @offset
+  end
+
+  def save(out)
+    out &lt;&lt; &quot;  &lt;#{type}&gt;\n&quot;
+    out &lt;&lt; &quot;    &lt;filename&gt;#{@filename}&lt;/filename&gt;\n&quot;
+    out &lt;&lt; &quot;    &lt;offset&gt;&lt;x&gt;#{@offset.x}&lt;/x&gt;&lt;y&gt;#{@offset.y}&lt;/y&gt;&lt;/offset&gt;\n&quot;
+    out &lt;&lt; &quot;    &lt;scale&gt;#{@scale}&lt;/scale&gt;\n&quot;
+    out &lt;&lt; &quot;    &lt;rotation&gt;#{@rotation}&lt;/rotation&gt;\n&quot;
+    out &lt;&lt; &quot;  &lt;/#{type}&gt;\n&quot;
+  end
+end
+
+class Face
+  def initialize(root, filename = nil)
+    @root = root
+    @parts  = {
+      :head    =&gt; FacePart.new(root, :head,    &quot;data/head/0000.png&quot;,    Point.new(0, 0)),
+      :eye     =&gt; FacePart.new(root, :eye,     &quot;data/eye/0000.png&quot;,     Point.new(35, -10)),
+      :eyebrow =&gt; FacePart.new(root, :eyebrow, &quot;data/eyebrow/0000.png&quot;, Point.new(45, -30)),
+      :glasses =&gt; FacePart.new(root, :glasses, &quot;data/glasses/0000.png&quot;, Point.new(0, -10)),
+      :ear     =&gt; FacePart.new(root, :ear,     &quot;data/ear/0000.png&quot;,     Point.new(90, 0)),
+      :nose    =&gt; FacePart.new(root, :nose,    &quot;data/nose/0000.png&quot;,    Point.new(0, 30)),
+      :mouth   =&gt; FacePart.new(root, :mouth,   &quot;data/mouth/0000.png&quot;,   Point.new(0, 75)),
+      :hair    =&gt; FacePart.new(root, :hair,    &quot;data/hair/0000.png&quot;,    Point.new(0, -20))
+    }
+  end
+
+  def get_part(type)
+    return @parts[type]
+  end 
+
+  def reload()
+    @parts.each{|key, val| val.reload() }
+  end
+
+  def save(filename)
+    out = File.new(filename, &quot;w&quot;)
+    out &lt;&lt; &quot;&lt;face&gt;\n&quot;
+    @parts.each{|key, val| val.save(out)}
+    out &lt;&lt; &quot;&lt;/face&gt;\n&quot;
+    out.close()
+  end
+  
+  def load(filename)
+    
+  end
+end
+
+# EOF #

Added: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-13 11:09:37 UTC (rev 1136)
+++ facebuilder/facebuilder.rb	2005-12-17 15:51:41 UTC (rev 1137)
@@ -0,0 +1,241 @@
+#!/usr/bin/env ruby
+
+require 'gnomecanvas2'
+require &quot;face.rb&quot;
+
+Point = Struct.new(&quot;Point&quot;, :x, :y)
+class Point
+  def to_p
+    [x,y]
+  end
+  def +(p)
+    [x+p.x, y+p.y]
+  end
+  def -(p)
+    [x-p.x, y-p.y]
+  end
+end
+
+class FaceBuilder &lt; Gtk::VBox
+  def add_image(root, filename, x, y, anchor, affine = nil)
+    im = Gdk::Pixbuf.new(filename)
+
+    unless im.nil?
+      image = Gnome::CanvasPixbuf.new(root,
+                                      :pixbuf =&gt; im,
+                                      :x =&gt; x,
+                                      :y =&gt; y,
+                                      :width =&gt; im.width,
+                                      :height =&gt; im.height,
+                                      :anchor =&gt; anchor)
+
+      image.signal_connect(&quot;event&quot;) { |item,event|
+        puts &quot;Bla: &quot;, item, event
+      }
+      # puts image.i2w_affine
+      # puts image.i2c_affine
+
+      if affine then
+        image.affine_absolute(affine)
+      end
+
+      image.signal_connect(&quot;destroy&quot;, im) { |item, im| }
+      return image
+    end
+  end
+
+  def setup_menu()
+    accel_group = Gtk::AccelGroup.new
+    item_factory = Gtk::ItemFactory.new(Gtk::ItemFactory::TYPE_MENU_BAR,
+                                        '&lt;main&gt;', accel_group)
+    
+    @window.add_accel_group(accel_group)
+    @window.set_border_width(0)
+
+    ifactory_cb = proc do |data, widget|
+      puts &quot;ItemFactory: activated \&quot;#{Gtk::ItemFactory.path_from_widget(widget)}\&quot;&quot;
+    end
+    
+    menu_items = 
+      [
+       ['/_File'],
+       ['/File/tearoff1', '&lt;Tearoff&gt;', nil, nil, ifactory_cb],
+       ['/File/_New',
+        '&lt;Item&gt;', '&lt;control&gt;N', nil, ifactory_cb],
+       ['/File/_Open',
+        '&lt;Item&gt;', '&lt;control&gt;O', nil, method(:open_file)],
+       ['/File/_Save',
+        '&lt;Item&gt;', '&lt;control&gt;S', nil, method(:save_file)],
+       ['/File/Save _As...',
+        '&lt;Item&gt;', '&lt;control&gt;S', nil, method(:save_file)],
+       ['/File/Quit',
+        '&lt;Item&gt;', '&lt;control&gt;Q', nil, method(:quit)]
+      ]
+    item_factory.create_items(menu_items)
+    
+    return item_factory.get_widget('&lt;main&gt;')
+  end
+  
+  def quit(data, widget)
+    Gtk.main_quit
+  end
+
+  def open_file(data, widget)
+    dialog =  Gtk::FileChooserDialog.new(&quot;Gtk::FileChooser sample&quot;, nil,
+                                         Gtk::FileChooser::ACTION_OPEN,
+                                         &quot;gnome-vfs&quot;,
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::OPEN,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face = Face.new(@canvas.root, dialog.filename)
+      end
+      
+      dialog.destroy
+    }
+  end
+
+  def save_file(data, widget)
+    dialog =  Gtk::FileChooserDialog.new(&quot;Gtk::FileChooser sample&quot;, nil,
+                                         Gtk::FileChooser::ACTION_SAVE,
+                                         &quot;gnome-vfs&quot;,
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::SAVE,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face.save(dialog.filename)
+      end
+      
+      dialog.destroy
+    }
+  end
+
+  def initialize(window)
+    super()
+
+    @window = window
+
+    @box = Gtk::EventBox.new
+    @menu = setup_menu()
+    pack_start(@menu, false, false, 0)
+    pack_start(@box)
+
+    @label = Gtk::Label.new
+    @label.show
+    pack_end(@label,false,false,0)
+    set_border_width(@pad = 2)
+    set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
+    @canvas = Gnome::Canvas.new(true)
+    @box.add(@canvas)
+    
+    @canvas.signal_connect(&quot;button-press-event&quot;) { |item,event|
+      # Some throuble with alpha
+      # puts &quot;Bla: &quot;, @canvas.get_item_at(event.x, event.y)
+    }
+
+    puts @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
+
+    @canvas.root.affine_absolute(Art::Affine.translate(192, 192))
+
+    @face = Face.new(@canvas.root)
+
+    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :nose, :head, :hair]
+    @current_part = 0
+
+    @canvas.signal_connect(&quot;key-press-event&quot;) { |widget, event|
+      part = @face.get_part(@parts[@current_part])
+      case event.keyval
+      when Gdk::Keyval::GDK_e
+        @current_part -= 1
+        if @current_part &lt; 0 then
+          @current_part = @parts.length - 1
+        end
+        puts @parts[@current_part]
+
+      when Gdk::Keyval::GDK_o
+        @current_part += 1
+        if @current_part &gt;= @parts.length then
+          @current_part = 0
+        end
+        puts @parts[@current_part]
+
+      when Gdk::Keyval::GDK_r
+        @face.reload()
+
+      when Gdk::Keyval::GDK_p
+        part.scale=(part.scale / 1.02) if part
+
+      when Gdk::Keyval::GDK_u
+        part.scale=(part.scale * 1.02) if part
+
+      when Gdk::Keyval::GDK_y
+        part.rotation=(part.rotation - 1.0) if part
+
+      when Gdk::Keyval::GDK_i
+        part.rotation=(part.rotation + 1.0) if part
+
+      when Gdk::Keyval::GDK_a
+        part.toggle if part
+        
+      when Gdk::Keyval::GDK_Up
+        part.offset = Point.new(part.offset.x, part.offset.y - 1) if part
+        
+      when Gdk::Keyval::GDK_Down
+        part.offset = Point.new(part.offset.x, part.offset.y + 1) if part
+
+      when Gdk::Keyval::GDK_Left
+        part.offset = Point.new(part.offset.x - 1, part.offset.y) if part
+
+      when Gdk::Keyval::GDK_Right
+        part.offset = Point.new(part.offset.x + 1, part.offset.y) if part
+      end
+    }
+    
+    #     @box.signal_connect('size-allocate') { |w,e,*b| 
+    #       @width, @height = [e.width,e.height].collect{|i|i - (@pad*2)}
+    #       @size = [@<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">width, at height</A>].min
+    #       @radius = @size / 2
+    #       @canvas.set_size(@<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">width, at height</A>)
+    #       @canvas.set_scroll_region(<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">0,0, at width</A><A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">, at height</A>)
+    #       false
+    #     }
+
+    @canvas.set_size(384, 384)
+    @canvas.set_scroll_region(0,0,384,384)
+
+    signal_connect_after('show') {|w,e| }
+    signal_connect_after('hide') {|w,e| }
+    @canvas.show()
+    @menu.show()
+    @box.show()
+    show()
+  end
+end
+
+
+if $0 == __FILE__
+
+  class Viewer &lt; Gtk::Window
+    def initialize()
+      super()
+      set_title(&quot;Face Builder&quot;)
+      signal_connect(&quot;delete_event&quot;) { |i,a| Gtk::main_quit }
+      add(FaceBuilder.new(self))
+      set_default_size(512, 512)
+      # set_resizable(false)
+      show()
+    end
+  end
+
+  Gtk.init()
+
+  view = Viewer.new
+  view.show
+
+  Gtk.main()
+  
+end
+
+# EOF #

Added: facebuilder/protoface.xcf
===================================================================
(Binary files differ)


Property changes on: facebuilder/protoface.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/AUTHORS	2005-12-17 15:51:41 UTC (rev 1137)
@@ -1,13 +1,25 @@
-Programming &amp; Graphics
-======================
-  Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+Programming
+===========
 
-Win32 Build
-===========
+  Ingo Ruhnke - Grumbel - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+  Matthias Braun - MatzeB - <A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>
+  James Gregory -
+  David Kamphausen - Godrin - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">david.kamphausen at web.de</A>&gt;
+  Mark Dillavou - Line72- &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">line72 at line72.net</A>&gt;
+
+Graphics
+========
+  Ingo Ruhnke - Grumbel - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+  Ken Hirsch - quickflash - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">khirsch11414 at yahoo.com</A>&gt;
+
+0.2.0 Win32 Build
+==================
   Robert Konrad &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">rkon at gmx.de</A>&gt;
 
 Music
 =====
   Ralph Weinert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">r.weinert at bluewin.ch</A>&gt;
+  Marek Moeckel - Wansti - &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">wansti at gmx.de</A>&gt;
 
+
 # EOF #

Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/SConstruct	2005-12-17 15:51:41 UTC (rev 1137)
@@ -25,7 +25,6 @@
 ##
 
 import sys, os
-import sys, os
 sys.path.append('scons')
 
 def CheckSDL(context, version):
@@ -44,42 +43,70 @@
         return ret
 
 def CheckPhysFS(context, version):
+    optionFile = env['CACHEDIR'] + 'libphysfs.cache.py'
+    opts = Options(optionFile)
+    opts.AddOptions(
+        ('CACHED_LIBPHYSFS',   'Whether libphysfs is available'),
+        ('CXXFLAGS_LIBPHYSFS', ''),
+        ('LINKFLAGS_LIBPHYSFS',''),
+        )
+    opts.Update(context.env)
+
     context.Message( 'Checking for PhysFS &gt;= %s ...' % version )
-    if context.TryCompile(&quot;&quot;&quot;
-    #include &lt;physfs.h&gt;
-    int main()
-    {
-       return 0;
-    }
-    &quot;&quot;&quot;, '.c'):
-        context.Result(1)
+    if not context.env.has_key('CACHED_LIBPHYSFS'):
+        oldLIBS = context.env.get( 'LIBS', [] )
+        context.env.Append(LIBS = [ 'physfs' ])
+        ret = context.TryCompile(&quot;&quot;&quot;
+        #include &lt;physfs.h&gt;
+        int main()
+        {
+           return 0;
+        }
+        &quot;&quot;&quot;, '.c')
+        oldLIBS = context.env.get( 'LIBS', [] )
+        context.env.Replace(LIBS = oldLIBS)
+
+        if ret:
+            env['CACHED_LIBPHYSFS']  = '1'
+            env['CXXFLAGS_LIBPHYSFS']  = ''
+            env['LINKFLAGS_LIBPHYSFS'] = '-lphysfs'
+
+            opts.Save(optionFile, context.env)
+            context.Result(ret)
+            return ret
+        else:
+            context.Result(ret)
+        return ret
+    else:
+        context.Result('ok (cached)')
         return 1
-    else:
-        context.Result(0)
-        return 0
 
 opts = Options(['options.cache', 'custom.py'])
 opts.Add('CXX', 'The C++ compiler')
 
 env = Environment(options=opts)
 
+env[&quot;CACHEDIR&quot;] = &quot;cache/&quot;
+if not os.path.isdir(env['CACHEDIR']): os.mkdir(env['CACHEDIR'])
+
 # env.BuildDir('build2', '.')
 
-conf = Configure( env, custom_tests = { 'CheckSDL' : CheckSDL, 'CheckPhysFS' : CheckPhysFS } )
+if 'configure' in COMMAND_LINE_TARGETS:
+    conf = Configure( env, custom_tests = { 'CheckSDL' : CheckSDL, 'CheckPhysFS' : CheckPhysFS } )
 
-if not conf.CheckSDL('1.2.8'):
-    print 'We really need SDL!'
-    Exit(1)
+    if not conf.CheckSDL('1.2.8'):
+        print 'We really need SDL!'
+        Exit(1)
+        
+    if not conf.CheckPhysFS('1.0'):
+        print &quot;libphysfs missing&quot;
+        Exit(1)
 
-if not conf.CheckPhysFS('1.0'):
-    print &quot;libphysfs missing&quot;
-    Exit(1)
+    env = conf.Finish() 
+else:
+    Export('env')
+    SConscript('tools/miniswig/SConscript')
+    SConscript('src/SConscript')
+    SConscript('src/scripting/SConscript')
 
-env = conf.Finish() 
-
-Export('env')
-SConscript('tools/miniswig/SConscript')
-SConscript('src/SConscript')
-SConscript('src/scripting/SConscript')
-
 # EOF #

Modified: trunk/data/blender/hero/heroken3.blend
===================================================================
(Binary files differ)

Added: trunk/data/images/objects/steelboxlarge.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/objects/steelboxlarge.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/images/objects/steelboxsmall.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/objects/steelboxsmall.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/levels/industrial.wst
===================================================================
--- trunk/data/levels/industrial.wst	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/data/levels/industrial.wst	2005-12-17 15:51:41 UTC (rev 1137)
@@ -45,16 +45,16 @@
      )
 
     (particle-system
-     (lifetime   8.0)
+     (lifetime   15.0)
      (count      70)
 
      (z-pos  1000)
      (pos 0 136)
-     (velocity 80 150)
+     (velocity 60 80)
      (cone    85 95)
      (gravity 0.0 0.0)
      (size   0.9 1.0)
-     (drawer (surface-drawer (image &quot;images/particles/snow2.png&quot;)))
+     (drawer (surface-drawer (image &quot;images/particles/snow.png&quot;)))
      (color-begin 1.0 1.0 1.0 1.0)
      (color-end 1.0 1.0 1.0 1.0)
      (distribution (line-distribution (x1 0) (y1 0) (x2 1024) (y2 0)))

Modified: trunk/data/levels/newformat2.wst
===================================================================
--- trunk/data/levels/newformat2.wst	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/data/levels/newformat2.wst	2005-12-17 15:51:41 UTC (rev 1137)
@@ -16,6 +16,16 @@
     (width 20)
     )
 
+   (liquid
+    (pos 832 832)
+    (width 4)
+    )
+
+   (liquid
+    (pos 1312 832)
+    (width 4)
+    )
+
    (vrdummy
     (name &quot;VRDummy&quot;)
     (pos 600 600)
@@ -205,7 +215,7 @@
       (name &quot;bob&quot;)
       (pos 320 831)
       (z-pos -50)
-      (action &quot;Bar&quot;)
+      (action &quot;Aim&quot;)
       (sprite3d &quot;models/characters/bob/bob.wsprite&quot;)
     )
     (character

Modified: trunk/data/models/vehicles/minetrain/minetrain.xcf
===================================================================
(Binary files differ)

Modified: trunk/data/models/vehicles/troopshuttle/troopshuttle.blend
===================================================================
(Binary files differ)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000789.html">[Windstille-commit] r1136 - htdocs
</A></li>
	<LI>Next message: <A HREF="000791.html">[Windstille-commit] r1138 - in facebuilder: . data data/beard data/eye data/glasses data/hair data/head data/mouth data/nose
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#790">[ date ]</a>
              <a href="thread.html#790">[ thread ]</a>
              <a href="subject.html#790">[ subject ]</a>
              <a href="author.html#790">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
