<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r343 - in trunk: data src src/display
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-January/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r343%20-%20in%20trunk%3A%20data%20src%20src/display&In-Reply-To=%3C200501311518.j0VFI9PK025875%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r343 - in trunk: data src src/display</H1>
    <B>Ingo Ruhnke at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r343%20-%20in%20trunk%3A%20data%20src%20src/display&In-Reply-To=%3C200501311518.j0VFI9PK025875%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r343 - in trunk: data src src/display">grumbel at sheep.berlios.de
       </A><BR>
    <I>Mon Jan 31 16:18:09 CET 2005</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#0">[ date ]</a>
              <a href="thread.html#0">[ thread ]</a>
              <a href="subject.html#0">[ subject ]</a>
              <a href="author.html#0">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-01-31 16:18:07 +0100 (Mon, 31 Jan 2005)
New Revision: 343

Added:
   trunk/src/display/
   trunk/src/display/drawing_context.cxx
   trunk/src/display/drawing_context.hxx
   trunk/src/display/drawing_request.hxx
   trunk/src/display/scene_context.cxx
   trunk/src/display/scene_context.hxx
Removed:
   trunk/src/drawing_context.cxx
   trunk/src/drawing_context.hxx
   trunk/src/drawing_request.hxx
   trunk/src/scene_context.cxx
   trunk/src/scene_context.hxx
Modified:
   trunk/data/tiles.scm
   trunk/src/SConstruct
   trunk/src/background.hxx
   trunk/src/config.h
   trunk/src/game_world.hxx
   trunk/src/gameobj.hxx
   trunk/src/string_converter.hxx
   trunk/src/tile_map.hxx
   trunk/src/windstille_game.cxx
   trunk/src/windstille_game.hxx
   trunk/src/windstille_level.cxx
   trunk/src/windstille_level.hxx
   trunk/src/windstille_main.cxx
   trunk/src/windstille_menu.cxx
Log:
- seperated some stuff in a directory and some other cleanup

Modified: trunk/data/tiles.scm
===================================================================
--- trunk/data/tiles.scm	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/data/tiles.scm	2005-01-31 15:18:07 UTC (rev 343)
@@ -217,7 +217,7 @@
         (colmap 15 15 15 15 15 15 15 15))
 
   (tiles (id 1)
-        (image &quot;../data/images/groundset.png&quot;)
+        (image &quot;../data/images/groundset2.png&quot;)
         (colmap 255 255 255 255 255 255 255 255)))
 
 ;; EOF ;;

Modified: trunk/src/SConstruct
===================================================================
--- trunk/src/SConstruct	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/SConstruct	2005-01-31 15:18:07 UTC (rev 343)
@@ -96,8 +96,8 @@
     'collision_manager.cxx',
 
     # drawing
-    'drawing_context.cxx',
-    'scene_context.cxx',
+    'display/drawing_context.cxx',
+    'display/scene_context.cxx',
     
     # Input Subdirectory
     'input/controller.cxx', 

Modified: trunk/src/background.hxx
===================================================================
--- trunk/src/background.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/background.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -20,7 +20,7 @@
 #ifndef HEADER_BACKGROUND_HXX
 #define HEADER_BACKGROUND_HXX
 
-#include &quot;scene_context.hxx&quot;
+#include &quot;display/scene_context.hxx&quot;
 
 /** */
 class Background

Modified: trunk/src/config.h
===================================================================
--- trunk/src/config.h	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/config.h	2005-01-31 15:18:07 UTC (rev 343)
@@ -1,59 +1,5 @@
 /* config.h.  Generated by configure.  */
 /* config.h.in.  Generated from configure.ac by autoheader.  */
 
-/* Define to 1 if you have the &lt;inttypes.h&gt; header file. */
-#define HAVE_INTTYPES_H 1
-
-/* Define to 1 if you have the `guile' library (-lguile). */
-#define HAVE_LIBGUILE 1
-
-/* Define to 1 if you have the `qthreads' library (-lqthreads). */
-#define HAVE_LIBQTHREADS 1
-
-/* Define to 1 if you have the &lt;memory.h&gt; header file. */
-#define HAVE_MEMORY_H 1
-
-/* Define to 1 if you have the &lt;stdint.h&gt; header file. */
-#define HAVE_STDINT_H 1
-
-/* Define to 1 if you have the &lt;stdlib.h&gt; header file. */
-#define HAVE_STDLIB_H 1
-
-/* Define to 1 if you have the &lt;strings.h&gt; header file. */
-#define HAVE_STRINGS_H 1
-
-/* Define to 1 if you have the &lt;string.h&gt; header file. */
-#define HAVE_STRING_H 1
-
-/* Define to 1 if you have the &lt;sys/stat.h&gt; header file. */
-#define HAVE_SYS_STAT_H 1
-
-/* Define to 1 if you have the &lt;sys/types.h&gt; header file. */
-#define HAVE_SYS_TYPES_H 1
-
-/* Define to 1 if you have the &lt;unistd.h&gt; header file. */
-#define HAVE_UNISTD_H 1
-
-/* Name of package */
-#define PACKAGE &quot;windstille&quot;
-
-/* Define to the address where bug reports for this package should be sent. */
-#define PACKAGE_BUGREPORT &quot;&quot;
-
-/* Define to the full name of this package. */
-#define PACKAGE_NAME &quot;Windstille&quot;
-
-/* Define to the full name and version of this package. */
-#define PACKAGE_STRING &quot;Windstille 0.2.0&quot;
-
-/* Define to the one symbol short name of this package. */
-#define PACKAGE_TARNAME &quot;windstille&quot;
-
-/* Define to the version of this package. */
-#define PACKAGE_VERSION &quot;0.2.0&quot;
-
-/* Define to 1 if you have the ANSI C header files. */
-#define STDC_HEADERS 1
-
 /* Version number of package */
 #define VERSION &quot;0.2.0&quot;

Copied: trunk/src/display/drawing_context.cxx (from rev 337, trunk/src/drawing_context.cxx)

Copied: trunk/src/display/drawing_context.hxx (from rev 337, trunk/src/drawing_context.hxx)

Copied: trunk/src/display/drawing_request.hxx (from rev 337, trunk/src/drawing_request.hxx)

Copied: trunk/src/display/scene_context.cxx (from rev 337, trunk/src/scene_context.cxx)
===================================================================
--- trunk/src/scene_context.cxx	2004-11-04 02:44:28 UTC (rev 337)
+++ trunk/src/display/scene_context.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -0,0 +1,141 @@
+//  $Id$
+//
+//  Pingus - A free Lemmings clone
+//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+#include &lt;ClanLib/display.h&gt;
+#include &lt;ClanLib/gl.h&gt;
+#include &quot;scene_context.hxx&quot;
+
+class SceneContextImpl
+{
+public:
+  DrawingContext color;
+  DrawingContext light;
+  DrawingContext highlight; 
+
+  CL_OpenGLSurface lightmap;
+  CL_Canvas        canvas;
+
+  SceneContextImpl() 
+    : lightmap(new CL_PixelBuffer(CL_Display::get_width(), 
+                                  CL_Display::get_height(),
+                                  CL_Display::get_width()*4, CL_PixelFormat::rgba8888), true),
+      canvas(lightmap)
+  {
+    canvas.get_gc()-&gt;set_scale(0.25, 0.25);
+  }
+};
+
+SceneContext::SceneContext()
+{
+  impl = new SceneContextImpl();
+}
+
+SceneContext::~SceneContext()
+{
+  delete impl;
+}
+
+DrawingContext&amp;
+SceneContext::color()
+{
+  return impl-&gt;color; 
+}
+
+DrawingContext&amp;
+SceneContext::light()
+{ 
+  return impl-&gt;light; 
+}
+
+DrawingContext&amp;
+SceneContext::highlight()
+{ 
+  return impl-&gt;highlight; 
+}
+
+
+/** Translate the drawing context */
+void
+SceneContext::translate(float x, float y)
+{
+  impl-&gt;color.translate(x, y);
+  impl-&gt;light.translate(x, y);
+  impl-&gt;highlight.translate(x, y);
+}
+
+/** Set the rotation of the drawing context */
+void
+SceneContext::rotate(float angel)
+{
+  impl-&gt;color.rotate(angel);
+  impl-&gt;light.rotate(angel);
+  impl-&gt;highlight.rotate(angel);
+}
+
+/** Set the scaling of the drawing context */
+void
+SceneContext::scale(float x, float y)
+{
+  impl-&gt;color.scale(x, y);
+  impl-&gt;light.scale(x, y);
+  impl-&gt;highlight.scale(x, y);
+}
+
+void
+SceneContext::push_modelview()
+{
+  impl-&gt;color.push_modelview();
+  impl-&gt;light.push_modelview();
+  impl-&gt;highlight.push_modelview();
+}
+
+void
+SceneContext::pop_modelview()
+{
+  impl-&gt;color.pop_modelview();
+  impl-&gt;light.pop_modelview();
+  impl-&gt;highlight.pop_modelview();
+}
+
+void
+SceneContext::render()
+{
+  // Render all buffers
+  // FIXME: Render all to pbuffer for later combining of them
+  impl-&gt;color.render(0);
+  
+  impl-&gt;light.render(impl-&gt;canvas.get_gc());
+  impl-&gt;canvas.sync_surface();
+
+  //impl-&gt;lightmap.set_blend_func(blend_src_alpha, blend_one);
+  impl-&gt;lightmap.set_blend_func(blend_dest_color, blend_zero);
+  //GL_DST_COLOR, GL_ZERO
+  impl-&gt;lightmap.set_scale(4.0f, 4.0f);
+  impl-&gt;lightmap.draw();
+  impl-&gt;canvas.get_gc()-&gt;clear();
+
+  impl-&gt;highlight.render(0);
+
+  // Clear all DrawingContexts
+  impl-&gt;color.clear();
+  impl-&gt;light.clear();
+  impl-&gt;highlight.clear();
+}
+
+/* EOF */

Copied: trunk/src/display/scene_context.hxx (from rev 337, trunk/src/scene_context.hxx)

Deleted: trunk/src/drawing_context.cxx
===================================================================
--- trunk/src/drawing_context.cxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/drawing_context.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -1,175 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;assert.h&gt;
-#include &lt;ClanLib/Display/sprite.h&gt;
-#include &lt;ClanLib/Display/graphic_context.h&gt;
-#include &lt;iostream&gt;
-#include &quot;drawing_context.hxx&quot;
-
-struct DrawingRequestsSorter
-{
-  bool operator()(DrawingRequest* a, DrawingRequest* b) {
-    return a-&gt;get_z_pos() &lt; b-&gt;get_z_pos();
-  }
-};
-
-class FillScreenDrawingRequest : public DrawingRequest
-{
-private:
-  CL_Color color;
-public:
-  FillScreenDrawingRequest(const CL_Color&amp; color_) 
-    : DrawingRequest(CL_Vector(0, 0, -1000.0f)), color(color_)
-  {
-  }
-  virtual ~FillScreenDrawingRequest() {}
-
-  void draw(CL_GraphicContext* gc) {
-    gc-&gt;clear(color);
-  }
-};
-
-class SpriteDrawingRequest : public DrawingRequest
-{
-private:
-  CL_Sprite sprite;
-
-public:
-  SpriteDrawingRequest(const CL_Sprite&amp; sprite_, const CL_Vector&amp; pos_)
-    : DrawingRequest(pos_),
-      sprite(sprite_)
-  {}
-  virtual ~SpriteDrawingRequest() {}
-
-  void draw(CL_GraphicContext* gc) {
-    sprite.draw(static_cast&lt;int&gt;(pos.x), static_cast&lt;int&gt;(pos.y), gc);
-  }
-};
-
-class TextDrawingRequest : public DrawingRequest
-{
-private:
-  std::string text;
-public:
-  TextDrawingRequest(const std::string&amp; text_, const CL_Vector&amp; pos_)
-    : DrawingRequest(pos_),
-      text(text_)
-  {}
-  virtual ~TextDrawingRequest() {}
-
-  void draw(CL_GraphicContext* gc) {
-    // FIXME: not implemented
-  }
-};
-
-DrawingContext::DrawingContext()
-{
-  translate_stack.push_back(CL_Pointf(0, 0));
-}
-
-void
-DrawingContext::render(CL_GraphicContext* gc)
-{
-  std::stable_sort(drawingrequests.begin(), drawingrequests.end(), DrawingRequestsSorter());
-  
-  for(DrawingRequests::iterator i = drawingrequests.begin(); i != drawingrequests.end(); ++i)
-    {
-      (*i)-&gt;draw(gc);
-    }
-}
-
-void
-DrawingContext::clear()
-{
-  for(DrawingRequests::iterator i = drawingrequests.begin(); i != drawingrequests.end(); ++i)
-    {
-      delete *i;
-    }
-  drawingrequests.clear();
-}
-
-void
-DrawingContext::draw(DrawingRequest* request)
-{
-  drawingrequests.push_back(request);
-}
-
-void
-DrawingContext::draw(const CL_Sprite&amp;   sprite,  float x, float y, float z)
-{ // FIXME: This should get flattend down to a simple texture draw
-  // command for easier sorting after texture-id/alpha
-  draw(new SpriteDrawingRequest(sprite, CL_Vector(translate_stack.back().x + x,
-                                                  translate_stack.back().y + y,
-                                                  z)));
-}
-
-void
-DrawingContext::draw(const std::string&amp; text,    float x, float y, float z)
-{ 
-  draw(new TextDrawingRequest(text, CL_Vector(x, y, z)));
-}
-
-void
-DrawingContext::fill_screen(const CL_Color&amp; color)
-{
-  draw(new FillScreenDrawingRequest(color));
-}
-
-void
-DrawingContext::rotate(float angel)
-{
-  // FIXME: not implemented
-}
-
-void
-DrawingContext::scale(float x, float y)
-{
-  // FIXME: not implemented
-}
-
-void
-DrawingContext::translate(float x, float y)
-{
-  translate_stack.back().x += x;
-  translate_stack.back().y += y;
-}
-
-void
-DrawingContext::push_modelview()
-{
-  translate_stack.push_back(translate_stack.back());
-}
-
-void
-DrawingContext::pop_modelview()
-{
-  translate_stack.pop_back();
-  assert(!translate_stack.empty());
-}
-
-CL_Rect
-DrawingContext::get_clip_rect()
-{
-  return CL_Rect(CL_Point(static_cast&lt;int&gt;(translate_stack.back().x),
-                          static_cast&lt;int&gt;(translate_stack.back().y)),
-                 CL_Size(800, 600));
-}
-
-/* EOF */

Deleted: trunk/src/drawing_context.hxx
===================================================================
--- trunk/src/drawing_context.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/drawing_context.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -1,85 +0,0 @@
-//  $Id$
-// 
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef HEADER_DRAWING_CONTEXT_HXX
-#define HEADER_DRAWING_CONTEXT_HXX
-
-#include &lt;ClanLib/Core/Math/rect.h&gt;
-#include &lt;ClanLib/Display/color.h&gt;
-#include &lt;vector&gt;
-#include &quot;drawing_request.hxx&quot;
-
-class CL_Sprite;
-
-/** The DrawingContext collects all DrawingRequests and allows you to
-    flush them all down to the graphics card in one run, this has the
-    advantage that it is possible to z-sort, texture-id sort or
-    otherwise optimize the drawing. In addition to that it also allows
-    you do render the drawing commands to multiple buffers which might
-    be usefull for post-processing effects and such. */
-class DrawingContext
-{
-private:
-  typedef std::vector&lt;DrawingRequest*&gt; DrawingRequests;
-  DrawingRequests drawingrequests;
-
-  std::vector&lt;CL_Pointf&gt; translate_stack;
-
-public:
-  DrawingContext();
-
-  /** Draws everything in the drawing context to the screen */
-  void render(CL_GraphicContext* gc);
-
-  /** Empties the drawing context */
-  void clear();
-
-  /** Fills the screen with a given color, this is different from
-      clear() in that it doesn't remove other DrawingRequest from the
-      queue */
-  void fill_screen(const CL_Color&amp; color);
-
-  /*{ */
-  void draw(DrawingRequest* request);
-  void draw(const CL_Sprite&amp;   sprite,  float x, float y, float z = 0);
-  void draw(const std::string&amp; text,    float x, float y, float z = 0);
-  /*} */
-  
-  /** Translate the drawing context */
-  void translate(float x, float y);
-
-  /** Set the rotation of the drawing context */
-  void rotate(float angel);
-
-  /** Set the scaling of the drawing context */
-  void scale(float x, float y);
-
-  void push_modelview();
-  void pop_modelview();
-
-  /** Return the area of the screen that will be visible*/
-  CL_Rect get_clip_rect();
-private:
-  DrawingContext (const DrawingContext&amp;);
-  DrawingContext&amp; operator= (const DrawingContext&amp;);
-};
-
-#endif
-
-/* EOF */

Deleted: trunk/src/drawing_request.hxx
===================================================================
--- trunk/src/drawing_request.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/drawing_request.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -1,51 +0,0 @@
-//  $Id$
-// 
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef HEADER_DRAWING_REQUEST_HXX
-#define HEADER_DRAWING_REQUEST_HXX
-
-#include &lt;ClanLib/Core/Math/cl_vector.h&gt;
-
-class CL_GraphicContext;
-
-/** 
- */
-class DrawingRequest
-{
-protected:
-  CL_Vector pos;
-public:
-  DrawingRequest(const CL_Vector&amp; pos_) : pos(pos_) {}
-  
-  virtual void draw(CL_GraphicContext* gc) = 0;
-  
-  /** Returns true if the request contains an alpha channel and needs
-      to be drawn in order */
-  virtual bool has_alpha() { return true; }
-
-  /** Returns the position at which the request should be drawn */
-  virtual float get_z_pos() { return pos.z; }
-private:
-  DrawingRequest (const DrawingRequest&amp;);
-  DrawingRequest&amp; operator= (const DrawingRequest&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/src/game_world.hxx
===================================================================
--- trunk/src/game_world.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/game_world.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -24,7 +24,7 @@
 #include &lt;vector&gt;
 #include &lt;string&gt;
 #include &quot;coroutine_manager.hxx&quot;
-#include &quot;scene_context.hxx&quot;
+#include &quot;display/scene_context.hxx&quot;
 
 class TileMap;
 class DiamondMap;

Modified: trunk/src/gameobj.hxx
===================================================================
--- trunk/src/gameobj.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/gameobj.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -20,7 +20,7 @@
 #ifndef GAMEOBJ_HXX
 #define GAMEOBJ_HXX
 
-#include &quot;scene_context.hxx&quot;
+#include &quot;display/scene_context.hxx&quot;
 
 class GameWorld;
 

Deleted: trunk/src/scene_context.cxx
===================================================================
--- trunk/src/scene_context.cxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/scene_context.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -1,140 +0,0 @@
-//  $Id$
-//
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/display.h&gt;
-#include &lt;ClanLib/gl.h&gt;
-#include &quot;globals.hxx&quot;
-#include &quot;scene_context.hxx&quot;
-
-class SceneContextImpl
-{
-public:
-  DrawingContext color;
-  DrawingContext light;
-  DrawingContext highlight; 
-
-  CL_OpenGLSurface lightmap;
-  CL_Canvas        canvas;
-
-  SceneContextImpl() 
-    : lightmap(&quot;black&quot;, resources),
-      canvas(lightmap)
-  {
-    canvas.get_gc()-&gt;set_scale(0.25, 0.25);
-  }
-};
-
-SceneContext::SceneContext()
-{
-  impl = new SceneContextImpl();
-}
-
-SceneContext::~SceneContext()
-{
-  delete impl;
-}
-
-DrawingContext&amp;
-SceneContext::color()
-{
-  return impl-&gt;color; 
-}
-
-DrawingContext&amp;
-SceneContext::light()
-{ 
-  return impl-&gt;light; 
-}
-
-DrawingContext&amp;
-SceneContext::highlight()
-{ 
-  return impl-&gt;highlight; 
-}
-
-
-/** Translate the drawing context */
-void
-SceneContext::translate(float x, float y)
-{
-  impl-&gt;color.translate(x, y);
-  impl-&gt;light.translate(x, y);
-  impl-&gt;highlight.translate(x, y);
-}
-
-/** Set the rotation of the drawing context */
-void
-SceneContext::rotate(float angel)
-{
-  impl-&gt;color.rotate(angel);
-  impl-&gt;light.rotate(angel);
-  impl-&gt;highlight.rotate(angel);
-}
-
-/** Set the scaling of the drawing context */
-void
-SceneContext::scale(float x, float y)
-{
-  impl-&gt;color.scale(x, y);
-  impl-&gt;light.scale(x, y);
-  impl-&gt;highlight.scale(x, y);
-}
-
-void
-SceneContext::push_modelview()
-{
-  impl-&gt;color.push_modelview();
-  impl-&gt;light.push_modelview();
-  impl-&gt;highlight.push_modelview();
-}
-
-void
-SceneContext::pop_modelview()
-{
-  impl-&gt;color.pop_modelview();
-  impl-&gt;light.pop_modelview();
-  impl-&gt;highlight.pop_modelview();
-}
-
-void
-SceneContext::render()
-{
-  // Render all buffers
-  // FIXME: Render all to pbuffer for later combining of them
-  impl-&gt;color.render(0);
-  
-  impl-&gt;light.render(impl-&gt;canvas.get_gc());
-  impl-&gt;canvas.sync_surface();
-
-  //impl-&gt;lightmap.set_blend_func(blend_src_alpha, blend_one);
-  impl-&gt;lightmap.set_blend_func(blend_dest_color, blend_zero);
-  //GL_DST_COLOR, GL_ZERO
-  impl-&gt;lightmap.set_scale(4.0f, 4.0f);
-  impl-&gt;lightmap.draw();
-  impl-&gt;canvas.get_gc()-&gt;clear();
-
-  impl-&gt;highlight.render(0);
-
-  // Clear all DrawingContexts
-  impl-&gt;color.clear();
-  impl-&gt;light.clear();
-  impl-&gt;highlight.clear();
-}
-
-/* EOF */

Deleted: trunk/src/scene_context.hxx
===================================================================
--- trunk/src/scene_context.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/scene_context.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -1,81 +0,0 @@
-//  $Id$
-// 
-//  Pingus - A free Lemmings clone
-//  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef HEADER_SCENE_CONTEXT_HXX
-#define HEADER_SCENE_CONTEXT_HXX
-
-#include &quot;drawing_context.hxx&quot;
-
-class SceneContextImpl;
-
-/** The SceneContext maintains all the different drawing layers to
-    which a game object can draw. Each drawing layer serves a
-    different purporse and all are combined in the end to form the
-    final image. */
-class SceneContext
-{
-public:
-  SceneContext();
-  ~SceneContext();
-  
-  /** The main drawing context, also known as color buffer, to this
-      you draw all normal graphics, sprites and enemies, as you would
-      do with a normal framebuffer */
-  DrawingContext&amp; color();
-
-  /** This is the lightmap, to this you draw all lights, meaning that
-      a color of white will result in a area that is completly
-      visible, while a value of black will mean that the area will be
-      not lighted at all and be completly black. This lightmap is
-      multiplied with the color buffer to get the light effect */
-  DrawingContext&amp; light();
-
-  /** The highlight map is usefull for all objects that are extremly
-      bright so that they generate a lenseflare or a glow. The
-      highlight map doesn't light the scenario itself, but gets
-      additionally rendered above the color and light buffer, thus its
-      allows to add glow without risking to losing it in an area of
-      darkness */
-  DrawingContext&amp; highlight();
-
-  /** Translate the drawing context */
-  void translate(float x, float y);
-
-  /** Set the rotation of the drawing context */
-  void rotate(float angel);
-
-  /** Set the scaling of the drawing context */
-  void scale(float x, float y);
-
-  void push_modelview();
-  void pop_modelview();
-
-  /** Takes all the buffers and combines them to form the final image
-      that will be shown on the screen */
-  void render();
-private:
-  SceneContextImpl* impl;
-
-  SceneContext (const SceneContext&amp;);
-  SceneContext&amp; operator= (const SceneContext&amp;);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/src/string_converter.hxx
===================================================================
--- trunk/src/string_converter.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/string_converter.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -22,7 +22,6 @@
 
 #include &lt;stdexcept&gt;
 #include &lt;sstream&gt;
-#include &quot;config.h&quot;
 
 template &lt;class T&gt;
 std::string to_string(const T&amp; any)

Modified: trunk/src/tile_map.hxx
===================================================================
--- trunk/src/tile_map.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/tile_map.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -25,7 +25,7 @@
 
 #include &quot;globals.hxx&quot;
 #include &quot;field.hxx&quot;
-#include &quot;scene_context.hxx&quot;
+#include &quot;display/scene_context.hxx&quot;
 
 class WindstilleLevel;
 class Tile;

Modified: trunk/src/windstille_game.cxx
===================================================================
--- trunk/src/windstille_game.cxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/windstille_game.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -39,7 +39,7 @@
 #include &quot;dialog_manager.hxx&quot;
 #include &quot;windstille_main.hxx&quot;
 #include &quot;screenshot.hxx&quot;
-#include &quot;scene_context.hxx&quot;
+#include &quot;display/scene_context.hxx&quot;
 #include &quot;input/input_manager.hxx&quot;
 
 #include &quot;windstille_game.hxx&quot;

Modified: trunk/src/windstille_game.hxx
===================================================================
--- trunk/src/windstille_game.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/windstille_game.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -24,7 +24,7 @@
 #include &lt;ClanLib/Display/sprite.h&gt;
 #include &lt;ClanLib/Display/font.h&gt;
 #include &lt;ClanLib/Signals/slot_container.h&gt;
-#include &quot;scene_context.hxx&quot;
+#include &quot;display/scene_context.hxx&quot;
 #include &quot;screen.hxx&quot;
 
 class CL_InputEvent;

Modified: trunk/src/windstille_level.cxx
===================================================================
--- trunk/src/windstille_level.cxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/windstille_level.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -19,7 +19,6 @@
 
 #include &lt;assert.h&gt;
 #include &lt;iostream&gt;
-#include &quot;config.h&quot;
 #include &quot;globals.hxx&quot;
 #include &quot;windstille_level.hxx&quot;
 #include &quot;string_converter.hxx&quot;
@@ -52,7 +51,10 @@
     {
       LispReader reader(lisp_cdr(tree));
 
-      parse_properties(reader.get(&quot;properties&quot;));
+      reader.read_int(&quot;width&quot;,  &amp;width);
+      reader.read_int(&quot;height&quot;, &amp;height);
+      reader.read_string_vector(&quot;scripts&quot;, &amp;scripts);
+
       //parse_foreground_tilemap(tree-&gt;getLisp(&quot;foreground-tilemap&quot;));
       parse_foreground_tilemap(reader.get(&quot;interactive-tilemap&quot;));
       parse_background_tilemap(reader.get(&quot;background-tilemap&quot;));
@@ -90,23 +92,6 @@
 }
 
 void
-WindstilleLevel::parse_properties (lisp_object_t* tree)
-{
-  if (tree)
-    {
-      LispReader reader(tree);
-
-      reader.read_int(&quot;width&quot;,  &amp;width);
-      reader.read_int(&quot;height&quot;, &amp;height);
-      //tree-&gt;get(&quot;name&quot;,   name);
-      reader.read_string_vector(&quot;scripts&quot;, &amp;scripts);
-    }
-
-  if (debug)
-    std::cout &lt;&lt; &quot;WindstilleLevel: dimensions: &quot; &lt;&lt; width &lt;&lt; &quot;x&quot; &lt;&lt; height &lt;&lt; std::endl;
-}
-
-void
 WindstilleLevel::parse_background_tilemap (lisp_object_t* cur)
 {
   background_tilemap = parse_tilemap(cur);
@@ -128,7 +113,7 @@
 
   if ((static_cast&lt;int&gt;(field-&gt;get_vector().size()) != width*height))
     {
-      std::cout &lt;&lt; &quot;Error: Size is &quot; &lt;&lt; field-&gt;get_vector().size() 
+      std::cout &lt;&lt; &quot;WindstilleLevel: Error: Size is &quot; &lt;&lt; field-&gt;get_vector().size() 
                 &lt;&lt; &quot; should be &quot; &lt;&lt; width*height &lt;&lt; std::endl;
       assert(0);
     }

Modified: trunk/src/windstille_level.hxx
===================================================================
--- trunk/src/windstille_level.hxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/windstille_level.hxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -42,7 +42,6 @@
   std::vector&lt;std::string&gt; scripts;
 
   void parse_file (const std::string&amp; filename);
-  void parse_properties (lisp_object_t* cur);
 
   Field&lt;int&gt;* parse_tilemap (lisp_object_t* cur);
   void parse_foreground_tilemap (lisp_object_t* cur);

Modified: trunk/src/windstille_main.cxx
===================================================================
--- trunk/src/windstille_main.cxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/windstille_main.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -24,7 +24,6 @@
 #include &lt;ClanLib/sound.h&gt;
 #include &lt;ClanLib/display.h&gt;
 
-#include &quot;config.h&quot;
 #include &quot;ruby_functor.hxx&quot;
 #include &quot;string_converter.hxx&quot;
 #include &quot;windstille_error.hxx&quot;

Modified: trunk/src/windstille_menu.cxx
===================================================================
--- trunk/src/windstille_menu.cxx	2004-11-06 23:07:42 UTC (rev 342)
+++ trunk/src/windstille_menu.cxx	2005-01-31 15:18:07 UTC (rev 343)
@@ -25,13 +25,13 @@
 #include &lt;ClanLib/Display/keyboard.h&gt;
 #include &quot;globals.hxx&quot;
 #include &quot;fonts.hxx&quot;
-#include &quot;config.h&quot;
 #include &quot;input/controller.hxx&quot;
 #include &quot;windstille_menu.hxx&quot;
 #include &quot;windstille_game.hxx&quot;
 #include &quot;music_manager.hxx&quot;
 #include &quot;windstille_bonus.hxx&quot;
 #include &quot;input/input_manager.hxx&quot;
+#include &quot;config.h&quot;
 
 WindstilleMenu::WindstilleMenu()
   : background(&quot;menu_background&quot;, resources),
@@ -202,7 +202,7 @@
 
   Fonts::copyright.set_alignment(origin_bottom_left);
   Fonts::copyright.draw(15, CL_Display::get_height() - 10,
-                        PACKAGE_STRING &quot;\n&quot;
+                        &quot;Windstille &quot; VERSION &quot;\n&quot;
                         &quot;Copyright (c) 2003 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
                         &quot;This game comes with ABSOLUTELY NO WARRANTY. This is free software, and you are welcome\n&quot;
                         &quot;to redistribute it under certain conditions; see the file COPYING for details.\n&quot;);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#0">[ date ]</a>
              <a href="thread.html#0">[ thread ]</a>
              <a href="subject.html#0">[ subject ]</a>
              <a href="author.html#0">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
