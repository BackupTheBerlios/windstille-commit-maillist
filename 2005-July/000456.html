<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r803 - in trunk/src: . badguy collision display math particles scripting sprite2d sprite3d
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-July/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r803%20-%20in%20trunk/src%3A%20.%20badguy%20collision%20display%20math%20particles%20scripting%20sprite2d%20sprite3d&In-Reply-To=%3C200507271234.j6RCYqb5000347%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000455.html">
   <LINK REL="Next"  HREF="000457.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r803 - in trunk/src: . badguy collision display math particles scripting sprite2d sprite3d</H1>
    <B>Ingo Ruhnke at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r803%20-%20in%20trunk/src%3A%20.%20badguy%20collision%20display%20math%20particles%20scripting%20sprite2d%20sprite3d&In-Reply-To=%3C200507271234.j6RCYqb5000347%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r803 - in trunk/src: . badguy collision display math particles scripting sprite2d sprite3d">grumbel at berlios.de
       </A><BR>
    <I>Wed Jul 27 14:34:52 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000455.html">[Windstille-commit] r802 - trunk/src/glutil
</A></li>
        <LI>Next message: <A HREF="000457.html">[Windstille-commit] r804 - in trunk/src: . badguy scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#456">[ date ]</a>
              <a href="thread.html#456">[ thread ]</a>
              <a href="subject.html#456">[ subject ]</a>
              <a href="author.html#456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-07-27 14:34:49 +0200 (Wed, 27 Jul 2005)
New Revision: 803

Added:
   trunk/src/math/vector.cpp
Removed:
   trunk/src/animation_obj.cpp
   trunk/src/animation_obj.hpp
Modified:
   trunk/src/Jamfile
   trunk/src/badguy/badguy.cpp
   trunk/src/badguy/hedgehog.cpp
   trunk/src/badguy/spider_mine.cpp
   trunk/src/badguy/spider_mine.hpp
   trunk/src/box.cpp
   trunk/src/camera.cpp
   trunk/src/camera.hpp
   trunk/src/character.cpp
   trunk/src/collision/collision_data.hpp
   trunk/src/collision/collision_engine.cpp
   trunk/src/collision/collision_engine.hpp
   trunk/src/collision/collision_object.cpp
   trunk/src/collision/collision_object.hpp
   trunk/src/default_shoot.cpp
   trunk/src/default_shoot.hpp
   trunk/src/display/drawing_context.cpp
   trunk/src/display/drawing_request.hpp
   trunk/src/display/vertex_array_drawing_request.cpp
   trunk/src/display/vertex_array_drawing_request.hpp
   trunk/src/elevator.cpp
   trunk/src/flashing_sign.cpp
   trunk/src/game_session.cpp
   trunk/src/math/matrix.cpp
   trunk/src/math/matrix.hpp
   trunk/src/math/rect.hpp
   trunk/src/math/vector.hpp
   trunk/src/nightvision.cpp
   trunk/src/particles/spark_drawer.cpp
   trunk/src/particles/surface_drawer.cpp
   trunk/src/player.cpp
   trunk/src/scripting/game_objects.cpp
   trunk/src/sector.cpp
   trunk/src/sprite2d/data.cpp
   trunk/src/sprite2d/sprite.cpp
   trunk/src/sprite2d/sprite.hpp
   trunk/src/sprite3d/sprite.cpp
   trunk/src/sprite3d/sprite.hpp
   trunk/src/test_object.cpp
   trunk/src/tile_map.cpp
   trunk/src/useable_object.cpp
   trunk/src/view.cpp
   trunk/src/water_map.cpp
   trunk/src/water_map.hpp
   trunk/src/windstille_getters.cpp
Log:
- some minor cleanup
- moved Rect, Vector and Matrix stuff over into Windstille codebase
- broke something with the scrolling, not sure what

Modified: trunk/src/Jamfile
===================================================================
--- trunk/src/Jamfile	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/Jamfile	2005-07-27 12:34:49 UTC (rev 803)
@@ -17,8 +17,6 @@
 SubInclude TOP src math ;
 
 sources = 
-        animation_obj.cpp
-        animation_obj.hpp
         baby_xml.cpp
         baby_xml.hpp
         blitter.cpp

Deleted: trunk/src/animation_obj.cpp
===================================================================
--- trunk/src/animation_obj.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/animation_obj.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,46 +0,0 @@
-//  $Id: animation_obj.cxx,v 1.3 2003/08/12 08:24:41 grumbel Exp $
-//
-//  Windstille - A Jump'n Shoot Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-//
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#include &lt;ClanLib/display.h&gt;
-#include &quot;globals.hpp&quot;
-#include &quot;animation_obj.hpp&quot;
-
-extern CL_ResourceManager* resources;
-
-AnimationObj::AnimationObj (const std::string&amp; str, const CL_Vector&amp; arg_pos)
-  : sprite(CL_Sprite (str, resources)), 
-    pos(arg_pos)
-{
-}
-
-void
-AnimationObj::draw (SceneContext&amp; )
-{
-  sprite.draw (int (pos.x), int (pos.y));
-}
-
-void
-AnimationObj::update (float delta)
-{
-  if (sprite.is_finished ())
-    remove ();
-  sprite.update (delta);
-}
-
-/* EOF */

Deleted: trunk/src/animation_obj.hpp
===================================================================
--- trunk/src/animation_obj.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/animation_obj.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,47 +0,0 @@
-//  $Id: animation_obj.hpp,v 1.3 2003/09/12 16:31:20 grumbel Exp $
-// 
-//  Windstille - A Jump'n Shoot Game
-//  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
-//
-//  This program is free software; you can redistribute it and/or
-//  modify it under the terms of the GNU General Public License
-//  as published by the Free Software Foundation; either version 2
-//  of the License, or (at your option) any later version.
-//
-//  This program is distributed in the hope that it will be useful,
-//  but WITHOUT ANY WARRANTY; without even the implied warranty of
-//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-//  GNU General Public License for more details.
-// 
-//  You should have received a copy of the GNU General Public License
-//  along with this program; if not, write to the Free Software
-//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-
-#ifndef ANIMATIONOBJ_HXX
-#define ANIMATIONOBJ_HXX
-
-#include &lt;ClanLib/Display/sprite.h&gt;
-#include &lt;ClanLib/Core/Math/cl_vector.h&gt;
-#include &quot;game_object.hpp&quot;
-
-/** Display a sequenze of frames and then remove itself. Usefull for
-    explosions an other gfx only things which don't influence the game
-    physics by itself.
- */
-class AnimationObj : public GameObject
-{
-private:
-  CL_Sprite sprite;
-  CL_Vector pos;
-  
-public:
-  AnimationObj (const std::string&amp;, const CL_Vector&amp; position);
-  virtual ~AnimationObj() {}
-  
-  void draw (SceneContext&amp; gc);
-  void update (float);
-};
-
-#endif
-
-/* EOF */

Modified: trunk/src/badguy/badguy.cpp
===================================================================
--- trunk/src/badguy/badguy.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/badguy/badguy.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -29,7 +29,6 @@
 
 Badguy::Badguy()
 {
-  pos.z = 100;
 }
 
 Badguy::~Badguy()

Modified: trunk/src/badguy/hedgehog.cpp
===================================================================
--- trunk/src/badguy/hedgehog.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/badguy/hedgehog.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -103,7 +103,7 @@
           velocity.y += GRAVITY * delta;
         }
       
-      CL_Vector old_pos = pos;
+      Vector old_pos = pos;
       pos += velocity * delta;
       
       if ((was_on_ground &amp;&amp; !on_ground()) || in_wall())
@@ -115,7 +115,7 @@
     
   // Check if the player got hit
   // FIXME: Insert pixel perfect collision detection here
-  CL_Vector player_pos = Player::current()-&gt;get_pos();
+  Vector player_pos = Player::current()-&gt;get_pos();
   if (pos.x - 20 &lt; player_pos.x
         &amp;&amp; pos.x + 20 &gt; player_pos.x
         &amp;&amp; pos.y - 20 &lt; player_pos.y

Modified: trunk/src/badguy/spider_mine.cpp
===================================================================
--- trunk/src/badguy/spider_mine.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/badguy/spider_mine.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -99,7 +99,7 @@
   jump_time += delta;
 
   // !line72 - I should be using the real collision stuff for this
-  CL_Vector player_pos = player-&gt;get_pos();
+  Vector player_pos = player-&gt;get_pos();
   
   // check for explosion
   if (state == JUMP &amp;&amp; jump_time &gt; 0.3) {

Modified: trunk/src/badguy/spider_mine.hpp
===================================================================
--- trunk/src/badguy/spider_mine.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/badguy/spider_mine.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -34,7 +34,7 @@
   CL_Sprite spider_mine;
   CL_Sprite explode;
   CL_Sprite explode_light;
-  CL_Vector initial_position;
+  Vector initial_position;
   float walk_speed;
   float jump_time;
   enum { WAIT, ATTACK, RETURN, JUMP, EXPLODE } state;

Modified: trunk/src/box.cpp
===================================================================
--- trunk/src/box.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/box.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,4 +1,4 @@
-//  $Id: box.cpp,v 1.11 2005/07/11 14:06:01 godrin Exp $
+//  $Id$
 // 
 //  Windstille - A Jump'n Shoot Game
 //  Copyright (C) 2005 David Kamphausen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">david.kamphausen at web.de</A>&gt;
@@ -52,7 +52,7 @@
   if (!spritename.empty())
     sprite = CL_Sprite(spritename, resources);
 
-  colobj = new CollisionObject(CL_Rectf(0, 0, width, height));
+  colobj = new CollisionObject(Rectf(0, 0, width, height));
   colobj-&gt;set_velocity(vel);
   colobj-&gt;set_pos(Vector(pos.x, pos.y));
 

Modified: trunk/src/camera.cpp
===================================================================
--- trunk/src/camera.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/camera.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -35,7 +35,7 @@
   int hscroll_threshold = 100;
   int vscroll_threshold = 150;
 
-  CL_Vector tpos = Player::current()-&gt;get_pos();
+  Vector tpos = Player::current()-&gt;get_pos();
 
   float dist = tpos.x - pos.x;
   if (dist &gt; hscroll_threshold)

Modified: trunk/src/camera.hpp
===================================================================
--- trunk/src/camera.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/camera.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -27,7 +27,7 @@
 class Camera
 {
 private:
-  CL_Vector pos;
+  Vector pos;
 
   static Camera* current_;
 public:

Modified: trunk/src/character.cpp
===================================================================
--- trunk/src/character.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/character.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -37,8 +37,6 @@
 {
   set_useable(true);
 
-  pos.z = 100;
-
   lisp::Properties props(lisp);
   props.get(&quot;name&quot;, name);
   props.get(&quot;pos&quot;, pos);
@@ -62,7 +60,7 @@
 void
 Character::draw (SceneContext&amp; gc)
 {
-  sprite-&gt;draw(gc, pos);
+  sprite-&gt;draw(gc, pos, 100);
 }
 
 void

Modified: trunk/src/collision/collision_data.hpp
===================================================================
--- trunk/src/collision/collision_data.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/collision/collision_data.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -22,7 +22,8 @@
 #ifndef HEADER_COLLISION_DATA_HXX
 #define HEADER_COLLISION_DATA_HXX
 
-#include &lt;ClanLib/core.h&gt;
+#include &lt;iostream&gt;
+#include &quot;math/vector.hpp&quot;
 
 struct CollisionData
 {
@@ -33,7 +34,7 @@
    * It's the normal vector of the side/face that we collided with. The vector
    * points away from the object we collided with.
    */
-  CL_Vector direction;
+  Vector direction;
   
   // size of time frame
   float delta; 

Modified: trunk/src/collision/collision_engine.cpp
===================================================================
--- trunk/src/collision/collision_engine.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/collision/collision_engine.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -74,23 +74,23 @@
   add = 50;
   //  grace=0;
 
-  CL_Vector dir;
+  Vector dir;
 
   if (left &lt; right &amp;&amp; left &lt; top &amp;&amp; left &lt; bottom)
     {
-      dir = CL_Vector(std::min(left/2 + grace, add), 0, 0);
+      dir = Vector(std::min(left/2 + grace, add), 0);
     }
   else if (right &lt; left &amp;&amp; right &lt; top &amp;&amp; right &lt; bottom)
     {
-      dir = CL_Vector(-std::min(right/2 + grace, add), 0, 0);
+      dir = Vector(-std::min(right/2 + grace, add), 0);
     }
   else if (top &lt; left &amp;&amp; top &lt; right &amp;&amp; top &lt; bottom)
     {
-      dir = CL_Vector( 0, std::min(top/2 + grace, add), 0);
+      dir = Vector( 0, std::min(top/2 + grace, add));
     }
   else // (bottom &lt; left &amp;&amp; bottom &lt; right &amp;&amp; bottom &lt; top)
     {
-      dir = CL_Vector( 0, -std::min(bottom/2 + grace, add), 0);
+      dir = Vector( 0, -std::min(bottom/2 + grace, add));
     }
 
   if (a.unstuck_movable())
@@ -186,8 +186,8 @@
 
 // LEFT means b1 is left of b2
 CollisionData
-CollisionEngine::collide(const CL_Rectf&amp; b1, const CL_Rectf&amp; b2,
-                         const CL_Vector&amp; b1_v, const CL_Vector&amp; b2_v,
+CollisionEngine::collide(const Rectf&amp; b1, const Rectf&amp; b2,
+                         const Vector&amp; b1_v, const Vector&amp; b2_v,
                          float delta)
 {
   SweepResult result0 = simple_sweep_1d(b1.left, b1.get_width(),  b1_v.x,
@@ -210,12 +210,12 @@
 	      if(b1.left &lt; b2.left)
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(-1, 0);
+		  result.direction=Vector(-1, 0);
 		}
 	      else
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(1, 0);
+		  result.direction=Vector(1, 0);
 		}
 	      result.col_time=result0.t0;
 	    }
@@ -225,12 +225,12 @@
 	      if(b1.top &lt; b2.top)
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(0, -1);
+		  result.direction=Vector(0, -1);
 		}
 	      else
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(0, 1);
+		  result.direction=Vector(0, 1);
 		}
 	      result.col_time=result1.t0;
 	    }
@@ -244,8 +244,8 @@
 {
   if (a.object_type == CollisionObject::RECTANGLE &amp;&amp; b.object_type == CollisionObject::RECTANGLE)
     {
-      CL_Rectf ra = a.primitive;
-      CL_Rectf rb = b.primitive;
+      Rectf ra = a.primitive;
+      Rectf rb = b.primitive;
       
       ra.left   += a.get_pos().x;
       ra.right  += a.get_pos().x;
@@ -289,7 +289,7 @@
   return result;
 }
 
-bool tilemap_collision(TileMap *tilemap, const CL_Rectf &amp;r)
+bool tilemap_collision(TileMap *tilemap, const Rectf &amp;r)
 {
   int minx, maxx;
   int miny, maxy;
@@ -321,7 +321,7 @@
   assert(a.object_type == CollisionObject::TILEMAP);
   assert(b.object_type == CollisionObject::RECTANGLE);
 
-  CL_Vector vel = b.get_velocity() - a.get_velocity();
+  Vector vel = b.get_velocity() - a.get_velocity();
 
   if (vel.x == 0.0f &amp;&amp; vel.y == 0.0f)
     return result;
@@ -331,7 +331,7 @@
   // Then for the given frame delta, for each new grid collision is checked,
   // if a collision takes place.
 
-  CL_Rectf r = b.primitive;
+  Rectf r = b.primitive;
 
   r.left   += b.get_pos().x;
   r.right  += b.get_pos().x;
@@ -412,7 +412,7 @@
 	  time += ct;
 
 	  // now shift one more pixel and check for collision with tilemap
-	  CL_Rectf tmp(r);
+	  Rectf tmp(r);
 	  
 	  if (tx &lt; ty)
 	    {
@@ -433,9 +433,9 @@
 	      result.col_time = time;
 	      
 	      if (tx &lt; ty)
-		result.direction=CL_Vector(c_sign (vel.x), 0);
+		result.direction=Vector(c_sign (vel.x), 0);
 	      else
-		result.direction=CL_Vector(0, c_sign (vel.y));
+		result.direction=Vector(0, c_sign (vel.y));
 	      return result;
 	    }
 	}

Modified: trunk/src/collision/collision_engine.hpp
===================================================================
--- trunk/src/collision/collision_engine.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/collision/collision_engine.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -46,8 +46,8 @@
 private:
   void unstuck(CollisionObject&amp; a, CollisionObject&amp; b, float delta);
   CollisionData collide(CollisionObject&amp; a, CollisionObject&amp; b, float delta);
-  CollisionData collide(const CL_Rectf&amp; b1, const CL_Rectf&amp; b2,
-                        const CL_Vector&amp; b1_v, const CL_Vector&amp; b2_v,
+  CollisionData collide(const Rectf&amp; b1, const Rectf&amp; b2,
+                        const Vector&amp; b1_v, const Vector&amp; b2_v,
                         float delta);
   CollisionData collide_tilemap(CollisionObject&amp; a, CollisionObject&amp; b, float delta);
 };

Modified: trunk/src/collision/collision_object.cpp
===================================================================
--- trunk/src/collision/collision_object.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/collision/collision_object.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -29,7 +29,7 @@
  * CollisionObject
  ***********************************************************************/
 
-CollisionObject::CollisionObject(const CL_Rectf&amp; rect_)
+CollisionObject::CollisionObject(const Rectf&amp; rect_)
   : primitive(rect_)
 {
   object_type        = RECTANGLE;
@@ -37,8 +37,8 @@
   coll_engine        = 0;
   is_unstuckable     = true;
   is_unstuck_movable = true;
-  velocity           = CL_Vector(0,0,0);
-  pos                = CL_Vector(0,0,0);
+  velocity           = Vector(0,0);
+  pos                = Vector(0,0);
 }
 
 CollisionObject::CollisionObject(TileMap* tilemap_)
@@ -49,8 +49,8 @@
   coll_engine        = 0;
   is_unstuckable     = true;
   is_unstuck_movable = false;
-  velocity           = CL_Vector(0,0,0);
-  pos                = CL_Vector(0,0,0);
+  velocity           = Vector(0,0);
+  pos                = Vector(0,0);
 }
 
 CollisionObject::~CollisionObject()
@@ -60,8 +60,8 @@
 void
 CollisionObject::drawCollision()
 {
-  CL_Vector v = get_pos ();
-  CL_Rectf  r = primitive;
+  Vector v = get_pos ();
+  Rectf  r = primitive;
 
   r += CL_Pointf (v.x, v.y);
 
@@ -85,12 +85,12 @@
 }
 
 void 
-CollisionObject::set_velocity(const CL_Vector &amp;m)
+CollisionObject::set_velocity(const Vector &amp;m)
 {
   velocity=m;
 }
 
-CL_Vector
+Vector
 CollisionObject::get_pos() const
 {
   if(parent != 0)
@@ -99,7 +99,7 @@
   return pos;
 }
 
-CL_Vector
+Vector
 CollisionObject::get_velocity() const
 {
   if (parent != 0)
@@ -109,7 +109,7 @@
 }
 
 void
-CollisionObject::set_pos(const CL_Vector&amp; p)
+CollisionObject::set_pos(const Vector&amp; p)
 {
   // FIXME: Do this somewhat more clever to avoid stuck issues
   pos = p;

Modified: trunk/src/collision/collision_object.hpp
===================================================================
--- trunk/src/collision/collision_object.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/collision/collision_object.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -23,7 +23,8 @@
 #define HEADER_COLLISION_OBJECT_HPP
 
 #include &lt;ClanLib/core.h&gt;
-#include &lt;ClanLib/Core/Math/cl_vector.h&gt;
+#include &quot;math/vector.hpp&quot;
+#include &quot;math/rect.hpp&quot;
 #include &quot;collision_data.hpp&quot;
 
 class TileMap;
@@ -37,16 +38,16 @@
   ObjectType object_type;
 
   /// position of the object
-  CL_Vector pos;
+  Vector pos;
 
   /// velocity of the object
-  CL_Vector velocity;
+  Vector velocity;
 
   CollisionObject* parent;
 
   CL_Signal_v2&lt;const CollisionData &amp;, CollisionObject &amp;&gt; collision;
 
-  CL_Rectf primitive;
+  Rectf primitive;
   TileMap* tilemap;
 
   CollisionEngine* coll_engine;
@@ -55,22 +56,22 @@
   bool is_unstuck_movable;
 
 public:
-  CollisionObject(const CL_Rectf&amp; rect_);
+  CollisionObject(const Rectf&amp; rect_);
   CollisionObject(TileMap* tilemap_);
 
   virtual ~CollisionObject();
 
   /** Sets the velocity of this object */
-  void set_velocity(const CL_Vector &amp;v);
-  CL_Vector get_velocity() const;
+  void set_velocity(const Vector &amp;v);
+  Vector get_velocity() const;
 
   /** Sets the CollisionObject to the given pos FIXME: unstucking is
       currently not handled special here, but simply in the next run
       of the collision engine, this should probally be changed so that
       the object is unstuck here without affecting other objects and
       then the real placement position is returned */
-  void set_pos(const CL_Vector&amp; p);
-  CL_Vector get_pos() const;
+  void set_pos(const Vector&amp; p);
+  Vector get_pos() const;
 
   void update(float delta);
 

Modified: trunk/src/default_shoot.cpp
===================================================================
--- trunk/src/default_shoot.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/default_shoot.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,4 +1,4 @@
-//  $Id: default_shoot.cxx,v 1.3 2003/09/12 16:31:20 grumbel Exp $
+//  $Id$
 //
 //  Windstille - A Jump'n Shoot Game
 //  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
@@ -19,11 +19,10 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;sector.hpp&quot;
-#include &quot;animation_obj.hpp&quot;
 #include &quot;tile_map.hpp&quot;
 #include &quot;default_shoot.hpp&quot;
 
-DefaultShoot::DefaultShoot (const CL_Vector&amp; arg_pos,
+DefaultShoot::DefaultShoot (const Vector&amp; arg_pos,
 			    DefaultShoot::DirectionState dir)
   : pos (arg_pos),
     sprite (&quot;shoot/default&quot;, resources),
@@ -63,7 +62,7 @@
 DefaultShoot::explode ()
 {
   remove ();
-  get_world ()-&gt;add(new AnimationObj (&quot;shoot/explosion&quot;, pos));
+  //get_world ()-&gt;add(new AnimationObj (&quot;shoot/explosion&quot;, pos));
 }
 
 /* EOF */

Modified: trunk/src/default_shoot.hpp
===================================================================
--- trunk/src/default_shoot.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/default_shoot.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,4 +1,4 @@
-//  $Id: default_shoot.hpp,v 1.2 2003/08/12 08:24:41 grumbel Exp $
+//  $Id$
 // 
 //  Windstille - A Jump'n Shoot Game
 //  Copyright (C) 2000 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
@@ -28,8 +28,8 @@
 class DefaultShoot : public GameObject
 {
 private:
-  CL_Vector pos;
-  CL_Vector velocity;
+  Vector pos;
+  Vector velocity;
   CL_Sprite sprite;
 
 public:
@@ -38,7 +38,7 @@
 private:
   DirectionState direction;
 public:
-  DefaultShoot (const CL_Vector&amp; arg_pos,
+  DefaultShoot (const Vector&amp; arg_pos,
 		DefaultShoot::DirectionState);
   virtual ~DefaultShoot () {}
   void draw (SceneContext&amp; gc);

Modified: trunk/src/display/drawing_context.cpp
===================================================================
--- trunk/src/display/drawing_context.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/display/drawing_context.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -53,7 +53,7 @@
   Color color;
 public:
   FillScreenDrawingRequest(const Color&amp; color_) 
-    : DrawingRequest(Vector(0, 0, -1000.0f)), color(color_)
+    : DrawingRequest(Vector(0, 0), -1000.0f), color(color_)
   {
   }
   virtual ~FillScreenDrawingRequest() {}
@@ -73,8 +73,8 @@
   CL_Sprite sprite;
 
 public:
-  SpriteDrawingRequest(const CL_Sprite&amp; sprite_, const Vector&amp; pos_, const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, modelview_),
+  SpriteDrawingRequest(const CL_Sprite&amp; sprite_, const Vector&amp; pos_, float z_pos_, const Matrix&amp; modelview_)
+    : DrawingRequest(pos_, z_pos_, modelview_),
       sprite(sprite_)
   {}
   virtual ~SpriteDrawingRequest() {}
@@ -97,8 +97,9 @@
   CL_Surface sprite;
 
 public:
-  CLSurfaceDrawingRequest(const CL_Surface&amp; sprite_, const Vector&amp; pos_, const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, modelview_),
+  CLSurfaceDrawingRequest(const CL_Surface&amp; sprite_, const Vector&amp; pos_, float z_pos_,
+                          const Matrix&amp; modelview_)
+    : DrawingRequest(pos_, z_pos_, modelview_),
       sprite(sprite_)
   {}
   virtual ~CLSurfaceDrawingRequest() {}
@@ -118,8 +119,8 @@
 private:
   std::string text;
 public:
-  TextDrawingRequest(const std::string&amp; text_, const Vector&amp; pos_, const Matrix&amp; modelview_)
-    : DrawingRequest(pos_, modelview_),
+  TextDrawingRequest(const std::string&amp; text_, const Vector&amp; pos_, float z_pos_, const Matrix&amp; modelview_)
+    : DrawingRequest(pos_, z_pos_, modelview_),
       text(text_)
   {}
   virtual ~TextDrawingRequest() {}
@@ -140,9 +141,9 @@
   float alpha;
 
 public:
-  SurfaceDrawingRequest(Surface surface, const Vector&amp; pos,
+  SurfaceDrawingRequest(Surface surface, const Vector&amp; pos, float z_pos_,
                         const Matrix modelview, float alpha)
-    : DrawingRequest(pos, modelview), surface(surface), alpha(alpha)
+    : DrawingRequest(pos, z_pos_, modelview), surface(surface), alpha(alpha)
   {}
   virtual ~SurfaceDrawingRequest()
   {}
@@ -188,7 +189,7 @@
 
 DrawingContext::DrawingContext()
 {
-  modelview_stack.push_back(Matrix(true));
+  modelview_stack.push_back(Matrix::identity());
 }
 
 DrawingContext::~DrawingContext()
@@ -232,27 +233,27 @@
 DrawingContext::draw(const CL_Surface&amp;   sprite,  float x, float y, float z)
 { // FIXME: This should get flattend down to a simple texture draw
   // command for easier sorting after texture-id/alpha
-  draw(new CLSurfaceDrawingRequest(sprite, Vector(x, y, z), modelview_stack.back()));
+  draw(new CLSurfaceDrawingRequest(sprite, Vector(x, y), z, modelview_stack.back()));
 }
 
 void
 DrawingContext::draw(const CL_Sprite&amp;   sprite,  float x, float y, float z)
 { // FIXME: This should get flattend down to a simple texture draw
   // command for easier sorting after texture-id/alpha
-  draw(new SpriteDrawingRequest(sprite, Vector(x, y, z), modelview_stack.back()));
+  draw(new SpriteDrawingRequest(sprite, Vector(x, y), z, modelview_stack.back()));
 }
 
 void
 DrawingContext::draw(Surface surface, float x, float y, float z, float a)
 {
-  draw(new SurfaceDrawingRequest(surface, Vector(x, y, z),
+  draw(new SurfaceDrawingRequest(surface, Vector(x, y), z,
                                  modelview_stack.back(), a));
 }
 
 void
-DrawingContext::draw(const std::string&amp; text,    float x, float y, float z)
+DrawingContext::draw(const std::string&amp; text, float x, float y, float z)
 { 
-  draw(new TextDrawingRequest(text, Vector(x, y, z), modelview_stack.back()));
+  draw(new TextDrawingRequest(text, Vector(x, y), z, modelview_stack.back()));
 }
 
 void
@@ -276,7 +277,7 @@
   double c = cos(angle*3.14159265/180);
   double s = sin(angle*3.14159265/180);
 
-  Matrix matrix(true);
+  Matrix matrix = Matrix::identity();
   matrix[0] = x*x*(1-c)+c;
   matrix[1] = y*x*(1-c)+z*s;
   matrix[2] = x*z*(1-c)-y*s;
@@ -295,7 +296,7 @@
 void
 DrawingContext::scale(float x, float y, float z)
 {
-  Matrix matrix(true);
+  Matrix matrix = Matrix::identity();
   matrix[0] = x;
   matrix[5] = y;
   matrix[10] = z;
@@ -306,7 +307,7 @@
 void
 DrawingContext::translate(float x, float y, float z)
 {
-  Matrix matrix(true);
+  Matrix matrix = Matrix::identity();
   matrix[12] = x;
   matrix[13] = y;
   matrix[14] = z;
@@ -337,7 +338,7 @@
 DrawingContext::reset_modelview()
 {
   modelview_stack.clear();
-  modelview_stack.push_back(Matrix(true));
+  modelview_stack.push_back(Matrix::identity());
 }
 
 Rectf

Modified: trunk/src/display/drawing_request.hpp
===================================================================
--- trunk/src/display/drawing_request.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/display/drawing_request.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -30,10 +30,11 @@
 class DrawingRequest
 {
 protected:
-  Vector    pos;
+  Vector   pos;
+  float    z_pos;
   Matrix modelview;
 public:
-  DrawingRequest(const Vector&amp; pos_, const Matrix&amp; modelview_ = Matrix(true))
+  DrawingRequest(const Vector&amp; pos_, float z_pos = 0,  const Matrix&amp; modelview_ = Matrix::identity())
     : pos(pos_), modelview(modelview_)
   {}
   virtual ~DrawingRequest() {}
@@ -41,8 +42,7 @@
   virtual void draw(CL_GraphicContext* gc) = 0;
   
   /** Returns the position at which the request should be drawn */
-  float get_z_pos() const
-  { return pos.z; }
+  float get_z_pos() const { return z_pos; }
 
   Matrix get_modelview() const
   { return modelview; }

Modified: trunk/src/display/vertex_array_drawing_request.cpp
===================================================================
--- trunk/src/display/vertex_array_drawing_request.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/display/vertex_array_drawing_request.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -23,8 +23,9 @@
 #include &lt;ClanLib/Display/graphic_context.h&gt;
 #include &quot;vertex_array_drawing_request.hpp&quot;
 
-VertexArrayDrawingRequest::VertexArrayDrawingRequest(const CL_Vector&amp; pos_, const Matrix&amp; modelview_)
-  : DrawingRequest(pos_, modelview_)
+VertexArrayDrawingRequest::VertexArrayDrawingRequest(const Vector&amp; pos_, float z_pos_, 
+                                                     const Matrix&amp; modelview_)
+  : DrawingRequest(pos_, z_pos_, modelview_)
 {
   blend_sfactor = GL_SRC_ALPHA;
   blend_dfactor = GL_ONE_MINUS_SRC_ALPHA;
@@ -109,7 +110,7 @@
 {
   vertices.push_back(x + pos.x);
   vertices.push_back(y + pos.y);
-  vertices.push_back(z + pos.z);
+  vertices.push_back(z + z_pos);
 }
 
 void

Modified: trunk/src/display/vertex_array_drawing_request.hpp
===================================================================
--- trunk/src/display/vertex_array_drawing_request.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/display/vertex_array_drawing_request.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -42,7 +42,7 @@
   std::vector&lt;float&gt; vertices;
 
 public:
-  VertexArrayDrawingRequest(const CL_Vector&amp; pos_, const Matrix&amp; modelview_);
+  VertexArrayDrawingRequest(const Vector&amp; pos_, float z_pos_, const Matrix&amp; modelview_);
 
   void draw(CL_GraphicContext* gc);
   void draw(CL_GraphicContext* gc, int start, int end);

Modified: trunk/src/elevator.cpp
===================================================================
--- trunk/src/elevator.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/elevator.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -33,7 +33,7 @@
   pos.y =  832;
   size  = CL_Size(128, 64);
 
-  colobject = new CollisionObject(CL_Rectf(CL_Pointf(0,0), size));
+  colobject = new CollisionObject(Rectf(CL_Pointf(0,0), size));
   Sector::current()-&gt;get_collision_engine()-&gt;add(colobject);
   colobject-&gt;set_pos(pos);
 }

Modified: trunk/src/flashing_sign.cpp
===================================================================
--- trunk/src/flashing_sign.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/flashing_sign.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -10,7 +10,7 @@
 #include &quot;sprite2d/manager.hpp&quot;
 
 FlashingSign::FlashingSign(const lisp::Lisp* lisp)
-  : pos(0, 0, 10.0), enabled(false)
+  : pos(0, 0), enabled(false)
 {
   std::string spritename;
   flashspeed = 5;
@@ -52,7 +52,7 @@
     // fade off
     sprite-&gt;set_alpha(alpha);
   }
-  sprite-&gt;draw(sc, pos);
+  sprite-&gt;draw(sc, pos, 10.0f);
 }
 
 void

Modified: trunk/src/game_session.cpp
===================================================================
--- trunk/src/game_session.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/game_session.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -31,7 +31,6 @@
 #include &quot;console.hpp&quot;
 #include &quot;game_object.hpp&quot;
 #include &quot;player.hpp&quot;
-#include &quot;animation_obj.hpp&quot;
 #include &quot;tile_map.hpp&quot;
 #include &quot;view.hpp&quot;
 #include &quot;timer.hpp&quot;

Modified: trunk/src/math/matrix.cpp
===================================================================
--- trunk/src/math/matrix.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/math/matrix.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -33,18 +33,24 @@
 /////////////////////////////////////////////////////////////////////////////
 // CL_Matrix construction:
 
-Matrix::Matrix(bool identity)
+Matrix::Matrix()
 {
 	memset(matrix, 0, sizeof(double[16]));
-	if (identity)
-	{
-		matrix[0] = 1.0;
-		matrix[5] = 1.0;
-		matrix[10] = 1.0;
-		matrix[15] = 1.0;
-	}
 }
 
+Matrix
+Matrix::identity()
+{
+	Matrix matrix;
+
+	matrix.matrix[0] = 1.0;
+	matrix.matrix[5] = 1.0;
+	matrix.matrix[10] = 1.0;
+	matrix.matrix[15] = 1.0;
+	
+	return matrix;
+}
+
 Matrix::Matrix(const Matrix &amp;copy)
 {
 	for (int i=0; i&lt;16; i++)

Modified: trunk/src/math/matrix.hpp
===================================================================
--- trunk/src/math/matrix.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/math/matrix.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -38,9 +38,7 @@
 //! Construction:
 public:
 	//: Constructs a 4x4 matrix.
-	//param identity: When true, initial matrix will be the identity matrix. If false, initial will be null matrix.
-	//param matrix[16]: Initial matrix.
-	Matrix(bool identity = false);
+	Matrix();
 
 	Matrix(const Matrix &amp;copy);
 
@@ -48,6 +46,9 @@
 
 	Matrix(float *matrix);
 
+	/** Returns identity matrix */
+	static Matrix identity();
+
 //! Attributes:
 public:
 	double matrix[16];

Modified: trunk/src/math/rect.hpp
===================================================================
--- trunk/src/math/rect.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/math/rect.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -27,11 +27,12 @@
 **    (if your name is missing here, please add it)
 */
 
-#ifndef __RECT_HPP__
-#define __RECT_HPP__
+#ifndef __MATH_RECT_HPP__
+#define __MATH_RECT_HPP__
 
 #include &lt;ClanLib/Core/Math/point.h&gt;
 #include &lt;ClanLib/Core/Math/size.h&gt;
+#include &lt;ClanLib/Core/Math/rect.h&gt;
 #include &lt;ClanLib/Core/Math/origin.h&gt;
 
 class Rectf;
@@ -229,7 +230,9 @@
 	Rectf(const Rectf &amp;rect)
 	{ left = rect.left; top = rect.top; right = rect.right; bottom = rect.bottom; }
 
-	//: Rect += Rect operator.
+	operator CL_Rectf() { return CL_Rectf(left, top, right, bottom); }
+	
+   //: Rect += Rect operator.
 	Rectf &amp;operator+=(const Rectf &amp;r)
 	{ left += r.left; top += r.top; right += r.right; bottom += r.bottom; return *this; }
 

Added: trunk/src/math/vector.cpp
===================================================================
--- trunk/src/math/vector.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/math/vector.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -0,0 +1,33 @@
+//  $Id: vector.cpp 2642 2005-06-26 13:38:53Z matzebraun $
+//
+//  SuperTux -  A Jump'n Run
+//  Copyright (C) 2004 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+#include &lt;config.h&gt;
+
+#include &lt;cmath&gt;
+
+#include &quot;math/vector.hpp&quot;
+
+Vector Vector::unit() const
+{
+  return *this / norm();
+}
+
+float Vector::norm() const
+{
+  return sqrt(x*x + y*y);
+}

Modified: trunk/src/math/vector.hpp
===================================================================
--- trunk/src/math/vector.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/math/vector.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,9 +1,122 @@
-#ifndef __VECTOR_HPP__
-#define __VECTOR_HPP__
+//  $Id: vector.hpp 2642 2005-06-26 13:38:53Z matzebraun $
+//
+//  SuperTux -  A Jump'n Run
+//  Copyright (C) 2004 Matthias Braun &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;
+//
+//  This program is free software; you can redistribute it and/or
+//  modify it under the terms of the GNU General Public License
+//  as published by the Free Software Foundation; either version 2
+//  of the License, or (at your option) any later version.
+//
+//  This program is distributed in the hope that it will be useful,
+//  but WITHOUT ANY WARRANTY; without even the implied warranty of
+//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+//  GNU General Public License for more details.
+//
+//  You should have received a copy of the GNU General Public License
+//  along with this program; if not, write to the Free Software
+//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+#ifndef SUPERTUX_VECTOR_H
+#define SUPERTUX_VECTOR_H
 
-#include &lt;ClanLib/Core/Math/cl_vector.h&gt;
+/** Simple two dimensional vector. */
+class Vector
+{
+public:
+  Vector(float nx, float ny)
+      : x(nx), y(ny)
+  { }
+  Vector(const Vector&amp; other)
+      : x(other.x), y(other.y)
+  { }
+  Vector()
+      : x(0), y(0)
+  { }
 
-typedef CL_Vector Vector;
+  bool operator ==(const Vector&amp; other) const
+    {
+      return x == other.x &amp;&amp; y == other.y;
+    }
 
+  bool operator !=(const Vector&amp; other) const
+    {
+      return !(x == other.x &amp;&amp; y == other.y);
+    }
+
+  const Vector&amp; operator=(const Vector&amp; other)
+  {
+    x = other.x;
+    y = other.y;
+    return *this;
+  }
+
+  Vector operator+(const Vector&amp; other) const
+    {
+      return Vector(x + other.x, y + other.y);
+    }
+
+  Vector operator-(const Vector&amp; other) const
+    {
+      return Vector(x - other.x, y - other.y);
+    }
+
+  Vector operator*(float s) const
+    {
+      return Vector(x * s, y * s);
+    }
+
+  Vector operator/(float s) const
+    {
+      return Vector(x / s, y / s);
+    }
+
+  Vector operator-() const
+    {
+      return Vector(-x, -y);
+    }
+
+  const Vector&amp; operator +=(const Vector&amp; other)
+  {
+    x += other.x;
+    y += other.y;
+    return *this;
+  }
+
+  const Vector&amp; operator -=(const Vector&amp; other)
+  {
+    x -= other.x;
+    y -= other.y;
+    return *this;
+  }
+
+  const Vector&amp; operator *=(float val)
+  {
+    x *= val;
+    y *= val;
+    return *this;
+  }
+
+  const Vector&amp; operator /=(float val)
+  {
+    x /= val;
+    y /= val;
+    return *this;
+  }
+
+  /// Scalar product of 2 vectors
+  float operator*(const Vector&amp; other) const
+    {
+      return x*other.x + y*other.y;
+    }
+
+  float norm() const;
+  Vector unit() const;
+
+  // ... add the other operators as needed, I'm too lazy now ...
+
+  float x, y; // leave this public, get/set methods just give me headaches
+  // for such simple stuff :)
+};
+
 #endif
 

Modified: trunk/src/nightvision.cpp
===================================================================
--- trunk/src/nightvision.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/nightvision.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -25,6 +25,7 @@
 
 #include &quot;globals.hpp&quot;
 #include &quot;random.hpp&quot;
+#include &quot;math/matrix.hpp&quot;
 #include &quot;nightvision.hpp&quot;
 
 Nightvision::Nightvision(const lisp::Lisp* lisp)
@@ -45,7 +46,7 @@
 {
   // reset the modelview, so we can draw in screen coordinates
   sc.light().push_modelview();
-  sc.light().set_modelview(Matrix(true));
+  sc.light().set_modelview(Matrix::identity());
 
   // try to stay above everything else with large z value
   nightvision.set_alpha(1.0f);
@@ -60,7 +61,7 @@
   sc.light().pop_modelview();
 
   sc.highlight().push_modelview();
-  sc.highlight().set_modelview(Matrix(true));
+  sc.highlight().set_modelview(Matrix::identity());
   nightvision.set_alpha(0.5f);
   nightvision.set_blend_func(blend_src_alpha, blend_one);
   sc.highlight().draw(nightvision, 0, 0, 10000);

Modified: trunk/src/particles/spark_drawer.cpp
===================================================================
--- trunk/src/particles/spark_drawer.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/particles/spark_drawer.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -40,7 +40,7 @@
 void
 SparkDrawer::draw(SceneContext&amp; sc, ParticleSystem&amp; psys) 
 {
-  VertexArrayDrawingRequest* buffer = new VertexArrayDrawingRequest(CL_Vector(0, 0, 100.0f),
+  VertexArrayDrawingRequest* buffer = new VertexArrayDrawingRequest(Vector(0, 0), 100.0f,
                                                                     sc.color().get_modelview());
   if (width == 1.0f)
     {

Modified: trunk/src/particles/surface_drawer.cpp
===================================================================
--- trunk/src/particles/surface_drawer.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/particles/surface_drawer.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -47,7 +47,7 @@
 SurfaceDrawer::draw(SceneContext&amp; sc, ParticleSystem&amp; psys) 
 {          
   VertexArrayDrawingRequest* buffer 
-    = new VertexArrayDrawingRequest(Vector(psys.get_x_pos(), psys.get_y_pos(), 0), // FIXME: add zpos
+    = new VertexArrayDrawingRequest(Vector(psys.get_x_pos(), psys.get_y_pos()), 0, // FIXME: add zpos
                                     sc.color().get_modelview());
 
   buffer-&gt;set_mode(GL_QUADS);

Modified: trunk/src/player.cpp
===================================================================
--- trunk/src/player.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/player.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -42,7 +42,6 @@
 {
   pos.x = 320;
   pos.y = 200;
-  pos.z = 100;
   name = &quot;player&quot;;
   sprite = sprite3d_manager-&gt;create(&quot;3dsprites/heroken.wsprite&quot;);
   grenade = sprite3d_manager-&gt;create(&quot;3dsprites/grenade.wsprite&quot;);
@@ -57,7 +56,7 @@
   // collision detection init
   CollisionObject* c_object;
 
-  col_objects.push_back(c_object = new CollisionObject ( CL_Rectf ( -15, -120, 15, 0 )));
+  col_objects.push_back(c_object = new CollisionObject(Rectf(-15, -120, 15, 0)));
 
   c_object-&gt;set_pos(pos);
   c_object-&gt;set_velocity(velocity);
@@ -78,7 +77,7 @@
 {
   light.set_blend_func(blend_src_alpha, blend_one);
   gc.light().draw(light, pos.x, pos.y, 100);
-  sprite-&gt;draw(gc, pos);
+  sprite-&gt;draw(gc, pos, 100);
 
   Entity* obj = find_useable_entity();
   if (obj)
@@ -173,7 +172,7 @@
 Player::set_stand()
 {
   try_set_action(&quot;Stand&quot;);
-  velocity = Vector(0, 0, 0);
+  velocity = Vector(0, 0);
   state = STAND;
   printf(&quot;stand.\n&quot;);
 }
@@ -362,7 +361,7 @@
   try_set_action(&quot;StandtoListen&quot;, backwards ? -1.0 : 1.0);
   if(!backwards) {
     sprite-&gt;set_next_action(&quot;Listen&quot;);
-    velocity = Vector(0, 0, 0);
+    velocity = Vector(0, 0);
   } else {
     sprite-&gt;set_next_action(&quot;Stand&quot;);
   }

Modified: trunk/src/scripting/game_objects.cpp
===================================================================
--- trunk/src/scripting/game_objects.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/scripting/game_objects.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -43,7 +43,7 @@
 void
 TestObject::set_pos(float x, float y)
 {
-  obj()-&gt;set_pos(Vector(x, y, 100));
+  obj()-&gt;set_pos(Vector(x, y));
 }
 
 void

Modified: trunk/src/sector.cpp
===================================================================
--- trunk/src/sector.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/sector.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -185,7 +185,7 @@
     }
   }
 
-  Vector spawnpos(320, 200, 0);
+  Vector spawnpos(320, 200);
   if(result == 0) {
     if(spawnpoint != &quot;default&quot;) {
       std::cerr &lt;&lt; &quot;SpawnPoint '&quot; &lt;&lt; spawnpoint &lt;&lt; &quot;' not found.\n&quot;;

Modified: trunk/src/sprite2d/data.cpp
===================================================================
--- trunk/src/sprite2d/data.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/sprite2d/data.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -58,7 +58,7 @@
 {
   std::auto_ptr&lt;Action&gt; action (new Action);
   action-&gt;speed = 1.0;
-  action-&gt;offset = Vector(0, 0, 0);
+  action-&gt;offset = Vector(0, 0);
  
   lisp::Properties props(lisp);
   props.get(&quot;name&quot;, action-&gt;name);

Modified: trunk/src/sprite2d/sprite.cpp
===================================================================
--- trunk/src/sprite2d/sprite.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/sprite2d/sprite.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -113,10 +113,10 @@
 }
 
 void
-Sprite::draw(SceneContext&amp; sc, const Vector&amp; pos)
+Sprite::draw(SceneContext&amp; sc, const Vector&amp; pos, float z_pos)
 {
   Surface surface = current_action-&gt;surfaces[ static_cast&lt;int&gt; (frame) ];
-  sc.color().draw(surface, pos.x, pos.y, pos.z, alpha);
+  sc.color().draw(surface, pos.x, pos.y, z_pos, alpha);
 }
 
 }

Modified: trunk/src/sprite2d/sprite.hpp
===================================================================
--- trunk/src/sprite2d/sprite.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/sprite2d/sprite.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -20,7 +20,7 @@
   ~Sprite();
 
   void update(float elapsed_time);
-  void draw(SceneContext&amp; sc, const Vector&amp; pos);
+  void draw(SceneContext&amp; sc, const Vector&amp; pos, float z_pos);
 
   void set_action(const std::string&amp; name);
   const std::string&amp; get_action() const;

Modified: trunk/src/sprite3d/sprite.cpp
===================================================================
--- trunk/src/sprite3d/sprite.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/sprite3d/sprite.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -235,9 +235,9 @@
       quat[i] += bone2.quat[i] * blend_time;
   }
 
-  Matrix m(true);
-  m.matrix[3] += pos[0];
-  m.matrix[7] += pos[1];
+  Matrix m      = Matrix::identity();
+  m.matrix[3]  += pos[0];
+  m.matrix[7]  += pos[1];
   m.matrix[11] += pos[2];
 
   return m;
@@ -249,9 +249,9 @@
   Sprite* sprite;
 
 public:
-  SpriteDrawingRequest(Sprite* sprite, const Vector&amp; pos,
-                         const Matrix&amp; modelview)
-      : DrawingRequest(pos, modelview), sprite(sprite)
+  SpriteDrawingRequest(Sprite* sprite, const Vector&amp; pos, float z_pos,
+                       const Matrix&amp; modelview)
+      : DrawingRequest(pos, z_pos, modelview), sprite(sprite)
   {
   }
 
@@ -312,10 +312,10 @@
 }
 
 void
-Sprite::draw(SceneContext&amp; sc, const Vector&amp; pos)
+Sprite::draw(SceneContext&amp; sc, const Vector&amp; pos, float z_pos)
 {
   sc.color().draw(
-    new SpriteDrawingRequest(this, pos, sc.color().get_modelview()));
+    new SpriteDrawingRequest(this, pos, z_pos, sc.color().get_modelview()));
 }
 
 void
@@ -324,7 +324,7 @@
   Matrix mmatrix 
     = matrix.multiply(sc.color().get_modelview());
   sc.color().draw(
-    new SpriteDrawingRequest(this, Vector(0, 0, 0), mmatrix));
+    new SpriteDrawingRequest(this, Vector(0, 0), 0, mmatrix));
 }
 
 void

Modified: trunk/src/sprite3d/sprite.hpp
===================================================================
--- trunk/src/sprite3d/sprite.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/sprite3d/sprite.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -50,7 +50,7 @@
    * You should call this every frame
    */
   void update(float elapsed_time);
-  void draw(SceneContext&amp; sc, const Vector&amp; pos);
+  void draw(SceneContext&amp; sc, const Vector&amp; pos, float z_pos);
   void draw(SceneContext&amp; sc, const Matrix&amp; matrix);
   
   /**

Modified: trunk/src/test_object.cpp
===================================================================
--- trunk/src/test_object.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/test_object.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -8,7 +8,7 @@
 TestObject::TestObject(const lisp::Lisp* lisp)
 {
   using namespace lisp;
-  pos = Vector(0, 0, 100);
+  pos = Vector(0, 0);
   std::string spritename;
 
   Properties props(lisp);
@@ -30,7 +30,7 @@
 void
 TestObject::draw(SceneContext&amp; context)
 {
-  sprite-&gt;draw(context, pos);
+  sprite-&gt;draw(context, pos, 100);
 }
 
 void

Modified: trunk/src/tile_map.cpp
===================================================================
--- trunk/src/tile_map.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/tile_map.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -106,7 +106,7 @@
         VertexArrayDrawingRequest*&amp; request = requests[packer];
         if (!request)
           {
-            request = new VertexArrayDrawingRequest(CL_Vector(0, 0, z_pos),
+            request = new VertexArrayDrawingRequest(Vector(0, 0), z_pos,
                                                     sc.color().get_modelview());
             request-&gt;set_mode(GL_QUADS);
             request-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

Modified: trunk/src/useable_object.cpp
===================================================================
--- trunk/src/useable_object.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/useable_object.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -29,7 +29,6 @@
 {
   using namespace lisp;
   set_useable(true);
-  pos.z = 0;
 
   Properties props(lisp);
   props.get(&quot;pos&quot;, pos);

Modified: trunk/src/view.cpp
===================================================================
--- trunk/src/view.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/view.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,4 +1,4 @@
-//  $Id: view.cxx,v 1.1 2003/09/21 18:05:21 grumbel Exp $
+//  $Id$
 //
 //  Pingus - A free Lemmings clone
 //  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
@@ -25,7 +25,7 @@
 
 View::View()
   : state(CL_Display::get_width(), CL_Display::get_height()),
-  zoom(1), transform(0, 0, 0)
+  zoom(1), transform(0, 0)
 {
   current_ = this;
 }
@@ -61,7 +61,7 @@
   if(CL_Keyboard::get_keycode(CL_KEY_NUMPAD6))
     transform.x += delta * 200 / zoom;
   if(CL_Keyboard::get_keycode(CL_KEY_NUMPAD5)) {
-    transform = Vector(0, 0, 0);
+    transform = Vector(0, 0);
     zoom = 1.0;
   }
 }

Modified: trunk/src/water_map.cpp
===================================================================
--- trunk/src/water_map.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/water_map.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,4 +1,4 @@
-//  $Id: water_map.cxx,v 1.4 2003/09/27 08:29:12 grumbel Exp $
+//  $Id$
 //
 //  Pingus - A free Lemmings clone
 //  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
@@ -95,7 +95,7 @@
 void
 WaterMap::update(float )
 {
-  CL_Vector pos = Player::current()-&gt;get_pos();
+  Vector pos = Player::current()-&gt;get_pos();
 
   for (Waters::iterator i = waters.begin(); i != waters.end(); ++i)
     {

Modified: trunk/src/water_map.hpp
===================================================================
--- trunk/src/water_map.hpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/water_map.hpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -1,4 +1,4 @@
-//  $Id: water_map.hpp,v 1.2 2003/09/12 20:17:06 grumbel Exp $
+//  $Id$
 // 
 //  Pingus - A free Lemmings clone
 //  Copyright (C) 2002 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;
@@ -21,7 +21,7 @@
 #define HEADER_WATER_MAP_HXX
 
 #include &lt;vector&gt;
-#include &lt;ClanLib/Core/Math/cl_vector.h&gt;
+#include &quot;math/vector.hpp&quot;
 
 /** */
 class WaterMap
@@ -38,7 +38,7 @@
 
   typedef std::vector&lt;Water&gt; Waters;
   Waters waters;
-  CL_Vector old_pos;
+  Vector old_pos;
 public:
   WaterMap();
   ~WaterMap();

Modified: trunk/src/windstille_getters.cpp
===================================================================
--- trunk/src/windstille_getters.cpp	2005-07-27 11:56:54 UTC (rev 802)
+++ trunk/src/windstille_getters.cpp	2005-07-27 12:34:49 UTC (rev 803)
@@ -33,10 +33,6 @@
     return false;
   if(get(lisp-&gt;get_list_elem(2), vec.y) == false)
     return false;
-  if(size == 4) {
-    if(get(lisp-&gt;get_list_elem(3), vec.z) == false)
-      return false;
-  }
   return true;
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000455.html">[Windstille-commit] r802 - trunk/src/glutil
</A></li>
	<LI>Next message: <A HREF="000457.html">[Windstille-commit] r804 - in trunk/src: . badguy scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#456">[ date ]</a>
              <a href="thread.html#456">[ thread ]</a>
              <a href="subject.html#456">[ subject ]</a>
              <a href="author.html#456">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
