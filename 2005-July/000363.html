<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r710 - trunk/src/collision
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-July/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r710%20-%20trunk/src/collision&In-Reply-To=%3C200507231014.j6NAEPtH005258%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000362.html">
   <LINK REL="Next"  HREF="000364.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r710 - trunk/src/collision</H1>
    <B>Ingo Ruhnke at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r710%20-%20trunk/src/collision&In-Reply-To=%3C200507231014.j6NAEPtH005258%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r710 - trunk/src/collision">grumbel at berlios.de
       </A><BR>
    <I>Sat Jul 23 12:14:25 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000362.html">[Windstille-commit] r709 - trunk/src/collision
</A></li>
        <LI>Next message: <A HREF="000364.html">[Windstille-commit] r711 - trunk/src/collision
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#363">[ date ]</a>
              <a href="thread.html#363">[ thread ]</a>
              <a href="subject.html#363">[ subject ]</a>
              <a href="author.html#363">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-07-23 12:14:19 +0200 (Sat, 23 Jul 2005)
New Revision: 710

Modified:
   trunk/src/collision/collision.cpp
   trunk/src/collision/collision.hpp
   trunk/src/collision/collision_data.hpp
   trunk/src/collision/collision_engine.cpp
   trunk/src/collision/collision_engine.hpp
   trunk/src/collision/collision_object.hpp
   trunk/src/collision/collision_test.hpp
Log:
- no actualy code changes, just some more spaces

Modified: trunk/src/collision/collision.cpp
===================================================================
--- trunk/src/collision/collision.cpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision.cpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -79,7 +79,7 @@
 {
   CL_Vector v=object-&gt;get_pos ();
   CL_Rectf r=rect;
-  r += CL_Pointf (v.x,v.y);
+  r += CL_Pointf (v.x, v.y);
 
   CL_Display::fill_rect (r, CL_Color (255, 255, 255));
   
@@ -95,7 +95,11 @@
 
 std::ostream&amp; operator&lt;&lt;(std::ostream&amp; out, const CollPrimitive &amp;b)
 {
-  out&lt;&lt;&quot;(&quot;&lt;&lt;b.x_pos()&lt;&lt;&quot;,&quot;&lt;&lt;b.y_pos()&lt;&lt;&quot;,&quot;&lt;&lt;b.width()&lt;&lt;&quot;,&quot;&lt;&lt;b.height()&lt;&lt;&quot;,&quot;&lt;&lt;b.object-&gt;get_velocity().x&lt;&lt;&quot;,&quot;&lt;&lt;b.object-&gt;get_velocity().y&lt;&lt;&quot;)&quot;;
+  out &lt;&lt; &quot;(&quot; 
+      &lt;&lt; b.x_pos() &lt;&lt; &quot;, &quot; &lt;&lt; b.y_pos() &lt;&lt; &quot;, &quot; 
+      &lt;&lt; b.width() &lt;&lt; &quot;, &quot; &lt;&lt; b.height() &lt;&lt; &quot;, &quot; 
+      &lt;&lt; b.object-&gt;get_velocity().x &lt;&lt; &quot;, &quot; &lt;&lt; b.object-&gt;get_velocity().y
+      &lt;&lt; &quot;)&quot;;
   return out;
 }
 

Modified: trunk/src/collision/collision.hpp
===================================================================
--- trunk/src/collision/collision.hpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision.hpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -41,7 +41,7 @@
   CL_Rectf rect;
 
 public:
-  CollPrimitive(const CL_Rectf &amp;r_,CollisionObject *object_);
+  CollPrimitive(const CL_Rectf&amp; r_, CollisionObject* object_);
 
   float x_pos() const;
   float y_pos() const;

Modified: trunk/src/collision/collision_data.hpp
===================================================================
--- trunk/src/collision/collision_data.hpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision_data.hpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -54,9 +54,9 @@
   } 
 };
 
-inline std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const CollisionData &amp;r)
+inline std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o, const CollisionData &amp;r)
 {
-  o&lt;&lt;&quot;(&quot;&lt;&lt;r.direction.x&lt;&lt;&quot;,&quot;&lt;&lt;r.direction.y&lt;&lt;&quot;,&quot;&lt;&lt;r.col_time&lt;&lt;&quot;)&quot;;
+  o &lt;&lt; &quot;(&quot; &lt;&lt; r.direction.x &lt;&lt; &quot;, &quot; &lt;&lt; r.direction.y &lt;&lt; &quot;, &quot; &lt;&lt; r.col_time &lt;&lt; &quot;)&quot;;
   return o;
 }
 

Modified: trunk/src/collision/collision_engine.cpp
===================================================================
--- trunk/src/collision/collision_engine.cpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision_engine.cpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -50,8 +50,8 @@
 {
   CollisionData inv=result.invert();
 
-  a.collision(result,b);
-  b.collision(inv,a);
+  a.collision(result, b);
+  b.collision(inv, a);
 }
 
 void
@@ -75,19 +75,19 @@
 
   if (left &lt; right &amp;&amp; left &lt; top &amp;&amp; left &lt; bottom)
     {
-      dir = CL_Vector(std::min(left/2 + grace,add),0,0);
+      dir = CL_Vector(std::min(left/2 + grace, add), 0, 0);
     }
   else if (right &lt; left &amp;&amp; right &lt; top &amp;&amp; right &lt; bottom)
     {
-      dir = CL_Vector(-std::min(right/2 + grace,add),0,0);
+      dir = CL_Vector(-std::min(right/2 + grace, add), 0, 0);
     }
   else if (top &lt; left &amp;&amp; top &lt; right &amp;&amp; top &lt; bottom)
     {
-      dir = CL_Vector( 0, std::min(top/2 + grace,add),0);
+      dir = CL_Vector( 0, std::min(top/2 + grace, add), 0);
     }
   else // (bottom &lt; left &amp;&amp; bottom &lt; right &amp;&amp; bottom &lt; top)
     {
-      dir = CL_Vector( 0, -std::min(bottom/2 + grace,add),0);
+      dir = CL_Vector( 0, -std::min(bottom/2 + grace, add), 0);
     }
 
   if (a.unstuck_movable())
@@ -102,20 +102,18 @@
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
     {
-      bool moved=false;
-      Objects::iterator j = i/*objects.begin()*/;
-      j++;
-
-      for(; j != objects.end(); ++j)
+      bool moved = false;
+      
+      for(Objects::iterator j = i + 1; j != objects.end(); ++j)
         {
           if (i != j)
             {
-	      CollisionData r=collide(**i,**j,delta);
+	      CollisionData r=collide(**i, **j, delta);
 	      if(r.state!=CollisionData::NONE)
 		{
-		  collision(**i,**j,r,delta);
+		  collision(**i, **j, r, delta);
 
-		  if(r.col_time&gt;0)
+		  if(r.col_time &gt; 0)
 		    moved=true;
 		}
             }
@@ -125,7 +123,7 @@
     }
   //  return;
   // check penetration and resolve
-  bool penetration=true;
+  bool penetration = true;
   int maxtries=15;
   while(penetration)
     {
@@ -135,22 +133,20 @@
 	{
 	  if(!(*i)-&gt;unstuck())
 	    continue;
-	  Objects::iterator j = i/*objects.begin()*/;
-	  j++;
 	  
-	  for(; j != objects.end(); ++j)
+          for(Objects::iterator j = i+1; j != objects.end(); ++j)
 	    {
 	      if(!(*j)-&gt;unstuck())
 		continue;
 	      
 	      if (i != j &amp;&amp; ((*i)-&gt;unstuck_movable() || ((*j)-&gt;unstuck_movable())))
 		{
-		  CollisionData r=collide(**i,**j,delta/1000.0f);
+		  CollisionData r=collide(**i, **j, delta/1000.0f);
 		  if(r.state!=CollisionData::NONE)
 		    {
-		      //		      collision(**i,**j,r,delta);///30.0f);
+		      //		      collision(**i, **j, r, delta);///30.0f);
 		      penetration=true;
-		      unstuck(**i,**j,delta/3.0f);
+		      unstuck(**i, **j, delta/3.0f);
 		    }
 		}
 	    }
@@ -159,8 +155,6 @@
       if(maxtries==0)
 	break;
     }
-  //  cout&lt;&lt;(15-maxtries)&lt;&lt;endl;
-
 }
 
 void
@@ -169,7 +163,7 @@
   obj.update(delta);
 }
 
-CollisionObject *
+CollisionObject*
 CollisionEngine::add(CollisionObject *obj)
 {
   objects.push_back(obj);
@@ -181,8 +175,8 @@
 void 
 CollisionEngine::remove(CollisionObject *obj)
 {
-  Objects::iterator i=std::find(objects.begin(),objects.end(),obj);
-  if(i!=objects.end())
+  Objects::iterator i = std::find(objects.begin(), objects.end(), obj);
+  if(i != objects.end())
     objects.erase(i);
 }
 
@@ -196,12 +190,12 @@
 					b2.y_pos(), b2.height(), b2.y_velocity());
 
   CollisionData result;
-  result.delta=delta;
+  result.delta = delta;
 
   if(result0.collision(delta) &amp;&amp; result1.collision(delta))
     {
       if(result0.always() &amp;&amp; result1.always())
-	result.state=CollisionData::STUCK;
+	result.state = CollisionData::STUCK;
       else
 	{
 	  if(result0.begin(delta)&lt;result1.begin(delta))
@@ -210,12 +204,12 @@
 	      if(b1.x_pos()&lt;b2.x_pos())
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(-1,0);
+		  result.direction=CL_Vector(-1, 0);
 		}
 	      else
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(1,0);
+		  result.direction=CL_Vector(1, 0);
 		}
 	      result.col_time=result0.t0;
 	    }
@@ -225,12 +219,12 @@
 	      if(b1.y_pos()&lt;b2.y_pos())
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(0,-1);
+		  result.direction=CL_Vector(0, -1);
 		}
 	      else
 		{
 		  result.state=CollisionData::COLLISION;
-		  result.direction=CL_Vector(0,1);
+		  result.direction=CL_Vector(0, 1);
 		}
 	      result.col_time=result1.t0;
 	    }
@@ -240,7 +234,7 @@
 }
 
 CollisionData
-CollisionEngine::collide(CollisionObject &amp;a,CollisionObject &amp;b,float delta)
+CollisionEngine::collide(CollisionObject&amp; a, CollisionObject&amp; b, float delta)
 {
   CollisionData r;
 
@@ -248,17 +242,17 @@
   //    return r;
 
   bool first=true;
-  for(std::vector&lt;CollPrimitive&gt;::iterator i=a.colliders.begin(); i != a.colliders.end(); ++i)
+  for(std::vector&lt;CollPrimitive&gt;::iterator i = a.colliders.begin(); i != a.colliders.end(); ++i)
     {
       for(std::vector&lt;CollPrimitive&gt;::iterator j = b.colliders.begin(); j !=b.colliders.end(); ++j)
 	{
 	  if(first)
 	    {
-	      r = collide(*i,*j,delta);
+	      r = collide(*i, *j, delta);
 	      first=false;
 	    }
 	  else
-	    r.merge(collide(*i,*j,delta));
+	    r.merge(collide(*i, *j, delta));
 	}
     }
   return r;

Modified: trunk/src/collision/collision_engine.hpp
===================================================================
--- trunk/src/collision/collision_engine.hpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision_engine.hpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -54,7 +54,7 @@
   float minimum_velocity;
 
   void unstuck(CollisionObject&amp; a, CollisionObject&amp; b, float delta);
-  CollisionData collide(CollisionObject &amp;a,CollisionObject &amp;b,float delta);
+  CollisionData collide(CollisionObject&amp; a, CollisionObject&amp; b, float delta);
   CollisionData collide(CollPrimitive&amp; b1, CollPrimitive&amp; b2, float delta);
 };
 

Modified: trunk/src/collision/collision_object.hpp
===================================================================
--- trunk/src/collision/collision_object.hpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision_object.hpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -86,7 +86,7 @@
   CL_Signal_v2&lt;const CollisionData &amp;, CollisionObject &amp;&gt;&amp; sig_collision() { return collision; }
 
   friend class CollisionEngine;
-  friend CollisionData collide(CollisionObject &amp;a,CollisionObject &amp;b,float delta);
+  friend CollisionData collide(CollisionObject&amp; a, CollisionObject&amp; b, float delta);
 };
 
 #endif

Modified: trunk/src/collision/collision_test.hpp
===================================================================
--- trunk/src/collision/collision_test.hpp	2005-07-23 09:53:34 UTC (rev 709)
+++ trunk/src/collision/collision_test.hpp	2005-07-23 10:14:19 UTC (rev 710)
@@ -31,7 +31,8 @@
 {
   enum CollisionState { COL_AT, COL_ALWAYS, COL_NEVER };
   CollisionState state;
-  float t0,t1;
+  float t0;
+  float t1;
 
   SweepResult()
   {
@@ -61,9 +62,9 @@
 
 };
 
-inline std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o,const SweepResult &amp;r)
+inline std::ostream &amp;operator&lt;&lt;(std::ostream &amp;o, const SweepResult &amp;r)
 {
-  o&lt;&lt;&quot;(&quot;&lt;&lt;r.state&lt;&lt;&quot;,&quot;&lt;&lt;r.t0&lt;&lt;&quot;,&quot;&lt;&lt;r.t1&lt;&lt;&quot;)&quot;;
+  o &lt;&lt; &quot;(&quot; &lt;&lt; r.state &lt;&lt; &quot;, &quot; &lt;&lt; r.t0 &lt;&lt; &quot;, &quot; &lt;&lt; r.t1 &lt;&lt; &quot;)&quot;;
   return o;
 }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000362.html">[Windstille-commit] r709 - trunk/src/collision
</A></li>
	<LI>Next message: <A HREF="000364.html">[Windstille-commit] r711 - trunk/src/collision
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#363">[ date ]</a>
              <a href="thread.html#363">[ thread ]</a>
              <a href="subject.html#363">[ subject ]</a>
              <a href="author.html#363">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
