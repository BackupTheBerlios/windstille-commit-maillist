<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r371 - in trunk: data data/images src test
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-June/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r371%20-%20in%20trunk%3A%20data%20data/images%20src%20test&In-Reply-To=%3C200506201310.j5KDADLK031381%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000026.html">
   <LINK REL="Next"  HREF="000028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r371 - in trunk: data data/images src test</H1>
    <B>Ingo Ruhnke at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r371%20-%20in%20trunk%3A%20data%20data/images%20src%20test&In-Reply-To=%3C200506201310.j5KDADLK031381%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r371 - in trunk: data data/images src test">grumbel at sheep.berlios.de
       </A><BR>
    <I>Mon Jun 20 15:10:13 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000026.html">[Windstille-commit] r370 - in trunk/src: . input
</A></li>
        <LI>Next message: <A HREF="000028.html">[Windstille-commit] r372 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2005-06-20 15:10:08 +0200 (Mon, 20 Jun 2005)
New Revision: 371

Added:
   trunk/data/images/virtualreality-background.png
   trunk/data/images/virtualreality.png
   trunk/test/windstille-logo.png
Modified:
   trunk/data/tiles.scm
   trunk/src/globals.cxx
   trunk/src/tile.cxx
   trunk/src/tile.hxx
   trunk/src/tile_factory.cxx
   trunk/src/tile_factory.hxx
   trunk/src/tile_map.cxx
   trunk/src/tile_map.hxx
Log:
- switched over to the virtualreality tileset

Added: trunk/data/images/virtualreality-background.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/virtualreality-background.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/images/virtualreality.png
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/virtualreality.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/tiles.scm
===================================================================
--- trunk/data/tiles.scm	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/data/tiles.scm	2005-06-20 13:10:08 UTC (rev 371)
@@ -1,223 +1,11 @@
 (windstille-tiles
-  (tile (id 1)
-        (image &quot;tiles/tile1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 2)
-        (image &quot;tiles/tile2&quot;)
-        (colmap 0 0 0 0 255 255 255 255))
-  (tile (id 3)
-        (image &quot;tiles/tile3&quot;)
-        (colmap 0 0 0 0 1 3 31 255))
-  (tile (id 4)
-        (image &quot;tiles/tile4&quot;)
-        (colmap 0 0 0 0 128 224 248 255))
-  (tile (id 5)
-        (image &quot;tiles/tile5&quot;)
-        (colmap 0 0 255 255 255 255 0 0))
-  (tile (id 6)
-        (image &quot;tiles/tile6&quot;)
-        (colmap 0 0 0 0 0 0 255 255))
-  (tile (id 7)
-        (image &quot;tiles/tile7&quot;)
-        (colmap 0 0 0 15 15 15 255 255))
-  (tile (id 8)
-        (image &quot;tiles/tile8&quot;)
-        (colmap 0 0 0 0 255 255 255 255))
-  (tile (id 9)
-        (image &quot;tiles/tile9&quot;)
-        (colmap 0 0 240 240 192 192 0 0))
-  (tile (id 10)
-        (image &quot;tiles/tile10&quot;)
-        (colmap 0 0 15 15 3 3 0 0))
-  (tile (id 11)
-        (image &quot;tiles/tile11&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 12)
-        (image &quot;tiles/tile12&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 13)
-        (image &quot;tiles/tile13&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 14)
-        (image &quot;tiles/tile14&quot;)
-        (colmap 0 0 255 255 255 255 0 0))
-  (tile (id 15)
-        (image &quot;tiles/tile15&quot;)
-        (colmap 0 0 3 7 31 127 255 255))
-  (tile (id 16)
-        (image &quot;tiles/tile16&quot;)
-        (colmap 0 0 255 255 255 255 255 255))
-  (tile (id 17)
-        (image &quot;tiles/tile17&quot;)
-        (colmap 0 0 192 224 248 254 255 255))
-  (tile (id 18)
-        (image &quot;tiles/tile18&quot;)
-        (colmap 15 31 255 255 255 255 255 255))
-  (tile (id 19)
-        (image &quot;tiles/tile19&quot;)
-        (colmap 240 248 255 255 255 255 255 255))
-  (tile (id 20)
-        (image &quot;tiles/tile20&quot;)
-        (colmap 0 0 0 0 0 0 224 224))
-  (tile (id 21)
-        (image &quot;tiles/tile21&quot;)
-        (colmap 0 0 0 0 0 0 1 7))
-  (tile (id 22)
-        (image &quot;tiles/tile22&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 23)
-        (image &quot;tiles/tile23&quot;)
-        (colmap 0 0 0 0 126 126 60 0))
-  (tile (id 24)
-        (image &quot;tiles/tile24&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 25)
-        (image &quot;tiles/tile25&quot;)
-        (colmap 255 255 255 255 255 255 255 0))
-  (tile (id 26)
-        (image &quot;tiles/tile25&quot;)
-        (colmap 248 248 248 248 248 248 248 248))
-  (tile (id 27)
-        (image &quot;tiles/tile27&quot;)
-        (colmap 248 248 248 248 252 252 255 255))
-  (tile (id 28)
-        (image &quot;tiles/tile28&quot;)
-        (colmap 255 255 255 255 255 255 255 240))
-  (tile (id 29)
-        (image &quot;tiles/tile29&quot;)
-        (colmap 0 0 0 0 0 0 255 255))
-  (tile (id 30)
-        (image &quot;tiles/tile30&quot;)
-        (colmap 129 129 129 129 129 129 129 129))
-  (tile (id 31)
-        (image &quot;tiles/tile31&quot;)
-        (colmap 0 0 0 0 0 0 129 129))
-  (tile (id 32)
-        (image &quot;tiles/tile32&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 33)
-        (image &quot;tiles/tile33&quot;)
-        (colmap 129 129 129 129 129 129 0 0))
-  (tile (id 34)
-        (image &quot;tiles/tile34&quot;)
-        (colmap 255 255 255 255 255 255 0 0))
-  (tile (id 35)
-        (image &quot;tiles/tile35&quot;)
-        (colmap 0 0 0 0 0 0 240 252))
-  (tile (id 36)
-        (image &quot;tiles/tile36&quot;)
-        (colmap 252 252 254 255 255 255 255 255))
-  (tile (id 37)
-        (image &quot;tiles/tile36&quot;)
-        (colmap 0 0 0 0 255 255 255 255))
-  (tile (id 38)
-        (image &quot;tiles/tile38&quot;)
-        (colmap 0 0 0 0 128 224 255 255))
-  (tile (id 39)
-        (image &quot;tiles/air_air_brwn_brwn_1&quot;)
-        (colmap 0 0 0 0 255 255 255 255))
-  (tile (id 40)
-        (image &quot;tiles/air_brwn_brwn_brwn_1&quot;)
-        (colmap 15 15 15 15 255 255 255 255))
-  (tile (id 41)
-        (image &quot;tiles/air_brwn_brwn_air_1&quot;)
-        (colmap 15 15 15 15 15 15 15 15))
-  (tile (id 42)
-        (image &quot;tiles/brwn_brwn_brwn_air_1&quot;)
-        (colmap 255 255 255 255 15 15 15 15))
-  (tile (id 43)
-        (image &quot;tiles/brwn_brwn_air_air_1&quot;)
-        (colmap 255 255 255 255 0 0 0 0))
-  (tile (id 44)
-        (image &quot;tiles/brwn_air_brwn_brwn_1&quot;)
-        (colmap 240 240 240 240 255 255 255 255))
-  (tile (id 45)
-        (image &quot;tiles/brwn_brwn_air_brwn_1&quot;)
-        (colmap 255 255 255 255 240 240 240 240))
-  (tile (id 46)
-        (image &quot;tiles/brwn_air_air_brwn_1&quot;)
-        (colmap 240 240 240 240 240 240 240 240))
-  (tile (id 47)
-        (image &quot;tiles/brwn_brwn_brwn_air_1&quot;)
-        (colmap 15 15 15 15 255 255 255 255))
-  (tile (id 48)
-        (image &quot;tiles/air_air_air_brwn_1&quot;)
-        (colmap 0 0 0 0 240 240 240 240))
-  (tile (id 49)
-        (image &quot;tiles/brwn_air_air_air_1&quot;)
-        (colmap 240 240 240 240 0 0 0 0))
-  (tile (id 50)
-        (image &quot;tiles/air_air_brwn_air_1&quot;)
-        (colmap 0 0 0 0 15 15 15 14))
-  (tile (id 51)
-        (image &quot;tiles/air_brwn_air_air_1&quot;)
-        (colmap 15 15 15 15 0 0 0 0))
-  (tile (id 52)
-        (image &quot;tiles/brwn_brwn_brwn_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 53)
-        (image &quot;tiles/brwn_brwn_dbrw_brwn_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 54)
-        (image &quot;tiles/brwn_brwn_dbrw_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 55)
-        (image &quot;tiles/brwn_dbrw_brwn_brwn_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 56)
-        (image &quot;tiles/brwn_dbrw_brwn_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 57)
-        (image &quot;tiles/brwn_dbrw_dbrw_brwn_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 58)
-        (image &quot;tiles/brwn_dbrw_dbrw_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 59)
-        (image &quot;tiles/dbrw_brwn_brwn_brwn_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 60)
-        (image &quot;tiles/dbrw_brwn_brwn_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 61)
-        (image &quot;tiles/dbrw_brwn_dbrw_brwn_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 62)
-        (image &quot;tiles/dbrw_brwn_dbrw_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 63)
-        (image &quot;tiles/dbrw_dbrw_brwn_brwn_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 64)
-        (image &quot;tiles/dbrw_dbrw_brwn_dbrw_1&quot;)
-        (colmap 255 255 255 255 255 255 255 255))
-  (tile (id 65)
-        (image &quot;tiles/brwn_air_air_air_2&quot;)
-        (colmap 240 224 128 128 0 0 0 0))
-  (tile (id 66)
-        (image &quot;tiles/air_brwn_air_air_2&quot;)
-        (colmap 15 15 7 7 0 0 0 0))
-  (tile (id 67)
-        (image &quot;tiles/air_brwn_brwn_air_2&quot;)
-        (colmap 15 15 15 63 63 31 15 15))
-  (tile (id 68)
-        (image &quot;tiles/brwn_brwn_air_brwn_2&quot;)
-        (colmap 255 255 255 255 254 252 248 240))
-  (tile (id 69)
-        (image &quot;tiles/dbrw_dbrw_dbrw_brwn_1&quot;)
-        (colmap 255 255 255 255 254 252 248 240))
-  (tile (id 70)
-        (image &quot;tiles/tree1&quot;)
-        (colmap 0 0 0 0 0 0 0 0))
-  (tile (id 71)
-        (image &quot;tiles/dbrw_air_air_dbrw_1&quot;)
-        (colmap 240 240 240 240 240 240 240 240))
-  (tile (id 72)
-        (image &quot;tiles/air_dbrw_dbrw_air_1&quot;)
-        (colmap 15 15 15 15 15 15 15 15))
-
   (tiles (id 1)
-        (image &quot;../data/images/groundset2.png&quot;)
-        (colmap 255 255 255 255 255 255 255 255)))
+        (image &quot;../data/images/virtualreality.png&quot;)
+        (colmap 1))
 
+  (tiles (id 64)
+        (image &quot;../data/images/virtualreality-background.png&quot;)
+        (colmap 0))
+)
+
 ;; EOF ;;

Modified: trunk/src/globals.cxx
===================================================================
--- trunk/src/globals.cxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/globals.cxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -23,8 +23,8 @@
 std::string bindir;
 std::string homedir;
 
-int TILE_SIZE    = 64;
-int SUBTILE_SIZE = 16;
+int TILE_SIZE    = 32;
+int SUBTILE_SIZE = 32;
 int SUBTILE_NUM  = (TILE_SIZE/SUBTILE_SIZE);
 
 bool bonus_active = true;

Modified: trunk/src/tile.cxx
===================================================================
--- trunk/src/tile.cxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/tile.cxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -26,22 +26,19 @@
 
 Tile::Tile(const std::string&amp; filename_, 
            const CL_Color&amp; color_, 
-           const CL_Color&amp; attribute_color_, 
-           unsigned char arg_colmap[])
+           unsigned int arg_colmap)
   : color(color_),
-    attribute_color(attribute_color_),
+    colmap(arg_colmap),
     filename(filename_)
 {
   //sur.set_alignment(origin_center, 0, 0);
-  memcpy(colmap, arg_colmap, 8);
 }
 
 Tile::Tile(const CL_PixelBuffer&amp; buffer, 
            const CL_Color&amp; color_,
-           const CL_Color&amp; attribute_color_,
-           unsigned char arg_colmap[])
+           unsigned int arg_colmap)
   : color(color_),
-    attribute_color(attribute_color_),
+    colmap(arg_colmap),
     filename(&quot;&lt;unknown&gt;&quot;)
 {
   CL_SpriteDescription desc;
@@ -49,7 +46,6 @@
   sur = CL_Sprite(desc);
 
   //sur.set_alignment(origin_center, 0, 0);
-  memcpy(colmap, arg_colmap, 8);
 }
 
 CL_Color
@@ -58,12 +54,6 @@
   return color;
 }
 
-CL_Color
-Tile::get_attribute_color()
-{
-  return attribute_color;
-}
-
 CL_Sprite&amp;
 Tile::get_sprite()
 {

Modified: trunk/src/tile.hxx
===================================================================
--- trunk/src/tile.hxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/tile.hxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -35,43 +35,23 @@
   /** Color used for the minimap to represent this tile */
   CL_Color  color;
 
-  /** Color used on 'Show Attributes', ie. to represent walkable areas
-      and such */
-  CL_Color  attribute_color;
-
 public:
   int id; 
-  unsigned char colmap[8];
+  /** Bitmaps that holds the collision attributes for this tile */
+  unsigned int colmap;
   std::string filename;
 
   /** @param filename Surface to use 
    *  @param arg_colmap a 8 char long array */
   Tile(const std::string&amp; filename, 
-       const CL_Color&amp; color, const CL_Color&amp; attribute_color, unsigned char arg_colmap[]);
+       const CL_Color&amp; color, unsigned int arg_colmap);
 
   Tile(const CL_PixelBuffer&amp; buffer, 
-       const CL_Color&amp; color, const CL_Color&amp; attribute_color, unsigned char arg_colmap[]);
+       const CL_Color&amp; color, unsigned int arg_colmap);
 
+  unsigned get_colmap() const { return colmap; }
   CL_Sprite&amp; get_sprite();
   CL_Color   get_color();
-  CL_Color   get_attribute_color();
-
-  inline bool get_col(unsigned char x, unsigned char  y)
-  {
-    assert(x &lt; 8);
-    assert(y &lt; 8);
-    return (colmap[y] &amp; (1 &lt;&lt; (7-x)));
-  }
-
-  inline void set_col(unsigned char x, unsigned char  y, bool val)
-  {
-    assert(x &lt; 8);
-    assert(y &lt; 8);
-    if (val)
-      colmap[y] |= (1 &lt;&lt; (7-x));
-    else
-      colmap[y] &amp;= ~(1 &lt;&lt; (7-x));
-  }
 };
 
 #endif

Modified: trunk/src/tile_factory.cxx
===================================================================
--- trunk/src/tile_factory.cxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/tile_factory.cxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -56,12 +56,8 @@
               lisp_object_t* name    = lisp_car(current);
               lisp_object_t* data    = lisp_cdr(current);
       
-              if (strcmp(lisp_symbol(name), &quot;tile&quot;) == 0)
+              if (strcmp(lisp_symbol(name), &quot;tiles&quot;) == 0)
                 {
-                  parse_tile(data);
-                }
-              else if (strcmp(lisp_symbol(name), &quot;tiles&quot;) == 0)
-                {
                   parse_tiles(data);
                 }
               else
@@ -100,35 +96,19 @@
       return;
     }
 
-  std::vector&lt;unsigned char&gt; colmap;
-  if (!reader.read_unsigned_char_vector(&quot;colmap&quot;, &amp;colmap))
-    {
-      // fill with default
-      colmap.push_back(255);
-      colmap.push_back(255);
-      colmap.push_back(255);
-      colmap.push_back(255);
-
-      colmap.push_back(255);
-      colmap.push_back(255);
-      colmap.push_back(255);
-      colmap.push_back(255);
-    }
+  int colmap = 0;
+  reader.read_int(&quot;colmap&quot;, &amp;colmap);
   
-  if (colmap.size() != 8)
-    {
-      std::cout &lt;&lt; &quot;Error: Size does not match: &quot; &lt;&lt; colmap.size() &lt;&lt; std::endl;
-    }
-
   CL_PixelBuffer image = CL_ProviderFactory::load(filename);
 
-  int num_tiles = (image.get_width()/64) * (image.get_height()/64);
+  int num_tiles = (image.get_width()/TILE_SIZE) * (image.get_height()/TILE_SIZE);
 
   if ((id + num_tiles) &gt;= int(tiles.size()))
     {
       tiles.resize(id + num_tiles + 1);
     }
 
+  // FIMXE: Tiles should share one OpenGL texture
   for (int y = 0; y &lt; image.get_height(); y += TILE_SIZE)
     {
       for (int x = 0; x &lt; image.get_width(); x += TILE_SIZE)
@@ -148,100 +128,13 @@
 
           tiles[id] = new Tile(chopped_image, 
                                CL_Color(255, 255, 255),
-                               CL_Color(127, 127, 127), &amp;*colmap.begin());
+                               colmap);
           tiles[id]-&gt;id = id;
           id += 1;
         }
     }
 }
 
-void
-TileFactory::parse_tile(lisp_object_t* data)
-{
-  // FIXME: Move this to scripting and add a TileFactory::add()
-  int id = 1;
-  std::string image;
-  CL_Color color(255, 255, 255, 255);
-  CL_Color attribute_color(255, 255, 255, 255);
-  unsigned char colmap[8];
-  
-  while (!lisp_nil_p(data))
-    {
-      lisp_object_t* current = lisp_car(data);
-          
-      if (lisp_cons_p(current))
-        {
-          lisp_object_t* name    = lisp_car(current);
-          lisp_object_t* data    = lisp_cdr(current);
-
-          if (strcmp(lisp_symbol(name), &quot;id&quot;) == 0)
-            {
-              id = lisp_integer(lisp_car(data));
-            }
-          else if (strcmp(lisp_symbol(name), &quot;color&quot;) == 0)
-            {
-              color = CL_Color(lisp_integer(lisp_list_nth(data, 0)),
-                               lisp_integer(lisp_list_nth(data, 1)),
-                               lisp_integer(lisp_list_nth(data, 2)),
-                               lisp_integer(lisp_list_nth(data, 3)));
-            }
-          else if (strcmp(lisp_symbol(name), &quot;attribute-color&quot;) == 0)
-            {
-              attribute_color = CL_Color(lisp_integer(lisp_list_nth(data, 0)),
-                                         lisp_integer(lisp_list_nth(data, 1)),
-                                         lisp_integer(lisp_list_nth(data, 2)),
-                                         lisp_integer(lisp_list_nth(data, 3)));
-            }
-          else if (strcmp(lisp_symbol(name), &quot;image&quot;) == 0)
-            {
-              image = lisp_string(lisp_car(data));
-            }
-          else if (strcmp(lisp_symbol(name), &quot;colmap&quot;) == 0)
-            {
-              colmap[0] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[1] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[2] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[3] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[4] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[5] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[6] = lisp_integer(lisp_car(data));
-              data = lisp_cdr(data);
-              colmap[7] = lisp_integer(lisp_car(data));
-            }
-        }
-      data = lisp_cdr(data);
-    }
-
-  if (0) // Debugging code
-    {
-      std::cout &lt;&lt; &quot;Tile: id     = &quot; &lt;&lt; id &lt;&lt; &quot;\n&quot;
-                &lt;&lt; &quot;      image  = &quot; &lt;&lt; image &lt;&lt; &quot;\n&quot;
-                &lt;&lt; &quot;      colmap = &quot; 
-                &lt;&lt; int(colmap[0]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[1]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[2]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[3]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[4]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[5]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[6]) &lt;&lt; &quot;, &quot;
-                &lt;&lt; int(colmap[7])
-                &lt;&lt; std::endl;
-    }
-
-  if (id &gt;= int(tiles.size()))
-    {
-      tiles.resize(id+1);
-    }
-  tiles[id] = new Tile(image, color, attribute_color, colmap);
-  tiles[id]-&gt;id = id;
-}
-
 Tile* 
 TileFactory::create (int id)
 {

Modified: trunk/src/tile_factory.hxx
===================================================================
--- trunk/src/tile_factory.hxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/tile_factory.hxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -65,7 +65,6 @@
   static TileFactory* current() { return current_; }
 
 private:
-  void parse_tile(lisp_object_t* data);
   void parse_tiles(lisp_object_t* data);
 };
 

Modified: trunk/src/tile_map.cxx
===================================================================
--- trunk/src/tile_map.cxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/tile_map.cxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -79,24 +79,11 @@
 	  {
 	    field (x,y)-&gt;get_sprite().draw (x * TILE_SIZE, 
                                             y * TILE_SIZE);
-            if (0) // Draw subtiles
-              {
-                for(int tile_y = 0; tile_y &lt; 8; ++tile_y)
-                  for(int tile_x = 0; tile_x &lt; 8; ++tile_x)
-                    {
-                      if (field (x,y)-&gt;get_col(tile_x, tile_y))
-                        {
-                          CL_Display::fill_rect(CL_Rect(x * TILE_SIZE + tile_x*16, y*TILE_SIZE + tile_y*16,
-                                                        x * TILE_SIZE + tile_x*16 + 16, y * TILE_SIZE + tile_y*16 + 16),
-                                                CL_Color(255, 0, 0, 128));
-                        }
-                    }
-              }
 	  }
       }
 }
 
-bool
+unsigned int
 TileMap::get_pixel(int x, int y)
 {
   if (x &lt; 0 || y &lt; 0 
@@ -110,13 +97,9 @@
     {
       Tile* tile = field(x / SUBTILE_NUM,
                          y / SUBTILE_NUM);
-      if (0)
-        std::cout &lt;&lt; &quot;GetPixel: &quot; &lt;&lt; x / SUBTILE_NUM &lt;&lt; &quot;,&quot; &lt;&lt; x % SUBTILE_NUM &lt;&lt; &quot; x &quot;
-                &lt;&lt; y / SUBTILE_NUM &lt;&lt; &quot;,&quot; &lt;&lt; y % SUBTILE_NUM &lt;&lt; std::endl;
-
+      
       if (tile)
-        return tile-&gt;get_col(x % SUBTILE_NUM,
-                             y % SUBTILE_NUM);
+        return tile-&gt;get_colmap();
       else
         return 0;     
     }
@@ -128,9 +111,6 @@
   int x_pos = int(x) / TILE_SIZE;
   int y_pos = int(y) / TILE_SIZE;
 
-  int sub_tile_x = int(x) / (TILE_SIZE/8) - x_pos*8;
-  int sub_tile_y = int(y) / (TILE_SIZE/8) - y_pos*8;
-
   if (x &lt; 0 || x_pos &gt;= field.get_width())
     {
       //std::cout &lt;&lt; &quot;TileMap::is_ground (): Out of range: &quot; &lt;&lt; x_pos &lt;&lt; &quot; &quot; &lt;&lt; y_pos &lt;&lt; std::endl;
@@ -143,7 +123,7 @@
 
 
   if (field (x_pos, y_pos))
-    return field (x_pos, y_pos)-&gt;get_col(sub_tile_x, sub_tile_y);
+    return field(x_pos, y_pos)-&gt;get_colmap();
   else
     return 0;
 }

Modified: trunk/src/tile_map.hxx
===================================================================
--- trunk/src/tile_map.hxx	2005-06-18 18:15:05 UTC (rev 370)
+++ trunk/src/tile_map.hxx	2005-06-20 13:10:08 UTC (rev 371)
@@ -46,7 +46,7 @@
   bool is_ground(float x, float y);
 
   /** @return the type of ground at the given subtile coordinates */
-  bool get_pixel(int x, int y);
+  unsigned int get_pixel(int x, int y);
   
   int get_width () const { return field.get_width(); }
   int get_height () const { return field.get_height (); }

Added: trunk/test/windstille-logo.png
===================================================================
(Binary files differ)


Property changes on: trunk/test/windstille-logo.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000026.html">[Windstille-commit] r370 - in trunk/src: . input
</A></li>
	<LI>Next message: <A HREF="000028.html">[Windstille-commit] r372 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
