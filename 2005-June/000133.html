<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r476 - in trunk: . data data/locale src src/display src/input src/lisp src/physfs src/scripting src/sound src/tinygettext
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2005-June/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r476%20-%20in%20trunk%3A%20.%20data%20data/locale%20src%20src/display%20src/input%20src/lisp%20src/physfs%20src/scripting%20src/sound%20src/tinygettext&In-Reply-To=%3C200506290828.j5T8S2ae030703%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000132.html">
   <LINK REL="Next"  HREF="000134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r476 - in trunk: . data data/locale src src/display src/input src/lisp src/physfs src/scripting src/sound src/tinygettext</H1>
    <B>Matthias Braun at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r476%20-%20in%20trunk%3A%20.%20data%20data/locale%20src%20src/display%20src/input%20src/lisp%20src/physfs%20src/scripting%20src/sound%20src/tinygettext&In-Reply-To=%3C200506290828.j5T8S2ae030703%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r476 - in trunk: . data data/locale src src/display src/input src/lisp src/physfs src/scripting src/sound src/tinygettext">matzebraun at sheep.berlios.de
       </A><BR>
    <I>Wed Jun 29 10:28:02 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000132.html">[Windstille-commit] r475 - trunk/src
</A></li>
        <LI>Next message: <A HREF="000134.html">[Windstille-commit] r477 - in trunk: data/levels src src/scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#133">[ date ]</a>
              <a href="thread.html#133">[ thread ]</a>
              <a href="subject.html#133">[ subject ]</a>
              <a href="author.html#133">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: matzebraun
Date: 2005-06-29 10:27:54 +0200 (Wed, 29 Jun 2005)
New Revision: 476

Added:
   trunk/data/locale/
   trunk/data/locale/de.po
Removed:
   trunk/src/collision/
Modified:
   trunk/Jamfile
   trunk/Jamrules
   trunk/src/Jamfile
   trunk/src/controller_def.cxx
   trunk/src/display/Jamfile
   trunk/src/input/Jamfile
   trunk/src/input/input_keyboard_input_device.cxx
   trunk/src/lisp/Jamfile
   trunk/src/physfs/Jamfile
   trunk/src/scripting/Jamfile
   trunk/src/sound/Jamfile
   trunk/src/tinygettext/Jamfile
   trunk/src/water_map.cxx
   trunk/src/water_splash.cxx
   trunk/src/windstille_main.cxx
   trunk/src/windstille_menu.cxx
Log:
make game translatable

Modified: trunk/Jamfile
===================================================================
--- trunk/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -10,7 +10,7 @@
 # add some additional files to package
 Package INSTALL NEWS README COPYING AUTHORS ChangeLog ;
 
-#MakePot data/locale/messages.pot : $(TRANSLATABLE_SOURCES) ;
-#XGETTEXT_FLAGS on data/locale/messages.pot += --language=C++ ;
+MakePot data/locale/messages.pot : $(TRANSLATABLE_SOURCES) ;
+XGETTEXT_FLAGS on data/locale/messages.pot += --language=C++ ;
 
 InstallDoc README COPYING AUTHORS ChangeLog BUGS ;

Modified: trunk/Jamrules
===================================================================
--- trunk/Jamrules	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/Jamrules	2005-06-29 08:27:54 UTC (rev 476)
@@ -66,7 +66,7 @@
 {
     actions XGetText
     {
-        $(XGETTEXT) $(XGETTEXT_FLAGS) --keyword='_:1' -o $(&lt;) $(&gt;)
+        $(XGETTEXT) $(XGETTEXT_FLAGS) --keyword='_:1' --keyword='N_:1' -o $(&lt;) $(&gt;)
     }
     rule MakePot
     {

Added: trunk/data/locale/de.po
===================================================================
--- trunk/data/locale/de.po	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/data/locale/de.po	2005-06-29 08:27:54 UTC (rev 476)
@@ -0,0 +1,52 @@
+# German translations for windstille package
+# German messages for windstille.
+# Copyright (C) 2005 THE windstille'S COPYRIGHT HOLDER
+# This file is distributed under the same license as the windstille package.
+#  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;, 2005.
+#
+msgid &quot;&quot;
+msgstr &quot;&quot;
+&quot;Project-Id-Version: windstille 0.5\n&quot;
+&quot;Report-Msgid-Bugs-To: \n&quot;
+&quot;POT-Creation-Date: 2005-06-29 10:20+0200\n&quot;
+&quot;PO-Revision-Date: 2005-06-29 10:21+0200\n&quot;
+&quot;Last-Translator:  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">matze at braunis.de</A>&gt;\n&quot;
+&quot;Language-Team: German &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">de at li.org</A>&gt;\n&quot;
+&quot;MIME-Version: 1.0\n&quot;
+&quot;Content-Type: text/plain; charset=ISO-8859-15\n&quot;
+&quot;Content-Transfer-Encoding: 8bit\n&quot;
+&quot;Plural-Forms: nplurals=2; plural=(n != 1);\n&quot;
+
+#: src/windstille_menu.cxx:168 src/windstille_menu.cxx:169
+msgid &quot;[Start Game]&quot;
+msgstr &quot;[Spiel Beginnen]&quot;
+
+#: src/windstille_menu.cxx:172
+msgid &quot;Start Game&quot;
+msgstr &quot;Spiel Beginnnen&quot;
+
+#: src/windstille_menu.cxx:178 src/windstille_menu.cxx:179
+msgid &quot;[Extras]&quot;
+msgstr &quot;[Extras]&quot;
+
+#: src/windstille_menu.cxx:182
+msgid &quot;Extras&quot;
+msgstr &quot;Extras&quot;
+
+#: src/windstille_menu.cxx:186 src/windstille_menu.cxx:187
+#: src/windstille_menu.cxx:196 src/windstille_menu.cxx:197
+msgid &quot;[Quit]&quot;
+msgstr &quot;[Beenden]&quot;
+
+#: src/windstille_menu.cxx:190
+msgid &quot;Quit&quot;
+msgstr &quot;Beenden&quot;
+
+#: src/windstille_menu.cxx:204
+msgid &quot;&quot;
+&quot;Copyright (c) 2003 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
+&quot;This game comes with ABSOLUTELY NO WARRANTY.This is free software, and you &quot;
+&quot;are welcome\n&quot;
+&quot;to redistribute it under certain conditions;see the file COPYING for &quot;
+&quot;details.\n&quot;
+msgstr &quot;&quot;

Modified: trunk/src/Jamfile
===================================================================
--- trunk/src/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -9,21 +9,7 @@
 SubInclude TOP src tinygettext ;
 SubInclude TOP src scripting ;
 
-Application windstille 
-    :   $(display_objects)
-    
-        $(input_objects)
-
-        $(lisp_objects)
-
-        $(physfs_objects)
-
-        $(sound_objects)
-
-        $(tinygettext_objects)
-
-        $(scripting_objects)
-
+sources = 
         animation_obj.cxx
         animation_obj.hxx
         bomb.cxx
@@ -106,6 +92,27 @@
         windstille_menu.cxx
         windstille_menu.hxx
 ;
+
+TRANSLATABLE_SOURCES += [ SearchSource $(sources) ] ;
+
+Application windstille 
+    :   $(display_objects)
+    
+        $(input_objects)
+
+        $(lisp_objects)
+
+        $(physfs_objects)
+
+        $(sound_objects)
+
+        $(tinygettext_objects)
+
+        $(scripting_objects)
+
+        $(sources)
+;
+
 C++Flags windstille : -DAPPDATADIR='\&quot;$(appdatadir)\&quot;' ;
 LinkWith windstille : squirrel ;
 Help windstille : &quot;Build the windstille executable&quot; ;

Modified: trunk/src/controller_def.cxx
===================================================================
--- trunk/src/controller_def.cxx	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/controller_def.cxx	2005-06-29 08:27:54 UTC (rev 476)
@@ -83,13 +83,13 @@
 }
 
 std::string
-ControllerDef::axis_id2name(int id)
+ControllerDef::axis_id2name(int )
 {
   return &quot;unknown&quot;;
 }
 
 int 
-ControllerDef::axis_name2id(const std::string&amp; name)
+ControllerDef::axis_name2id(const std::string&amp; )
 {
   return -1;
 }

Modified: trunk/src/display/Jamfile
===================================================================
--- trunk/src/display/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/display/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -1,8 +1,10 @@
 SubDir TOP src display ;
 
-display_objects = [ CompileObjects
-  drawing_context.hxx
-  drawing_context.cxx
-  scene_context.hxx
-  scene_context.cxx
-] ;
+sources = drawing_context.hxx
+          drawing_context.cxx
+          scene_context.hxx
+          scene_context.cxx
+;
+
+TRANSLATABLE_SOURCES = [ SearchSource $(sources) ] ;
+display_objects = [ CompileObjects $(sources) ] ;

Modified: trunk/src/input/Jamfile
===================================================================
--- trunk/src/input/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/input/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -1,6 +1,6 @@
 SubDir TOP src input ;
 
-input_objects = [ CompileObjects
+sources =
     axis_button.cxx                
     axis_button.hxx
     axis_factory.cxx
@@ -33,5 +33,8 @@
     input_recorder.hxx
     multi_button.cxx
     multi_button.hxx
-] ;
+;
 
+TRANSLATABLE_SOURCES += [ SearchSource $(sources) ] ;
+input_objects = [ CompileObjects $(sources) ] ;
+

Modified: trunk/src/input/input_keyboard_input_device.cxx
===================================================================
--- trunk/src/input/input_keyboard_input_device.cxx	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/input/input_keyboard_input_device.cxx	2005-06-29 08:27:54 UTC (rev 476)
@@ -30,9 +30,8 @@
 }
 
 void
-InputKeyboardInputDevice::on_key_up(const CL_InputEvent&amp; event)
+InputKeyboardInputDevice::on_key_up(const CL_InputEvent&amp; )
 {
-  
 }
 
 void

Modified: trunk/src/lisp/Jamfile
===================================================================
--- trunk/src/lisp/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/lisp/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -1,6 +1,6 @@
 SubDir TOP src lisp ;
 
-lisp_objects = [ CompileObjects
+sources =
   lexer.cpp
   lexer.hpp
   lisp.cpp
@@ -11,5 +11,8 @@
   parser.hpp
   writer.cpp
   writer.hpp
-] ;
+;
 
+TRANSLATABLE_SOURCES += [ SearchSource $(sources) ] ;
+lisp_objects = [ CompileObjects $(sources) ] ;
+

Modified: trunk/src/physfs/Jamfile
===================================================================
--- trunk/src/physfs/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/physfs/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -1,7 +1,10 @@
 SubDir TOP src physfs ;
 
-physfs_objects = [ CompileObjects
+sources = 
     physfs_stream.cpp
     physfs_stream.hpp
-] ;
+;
 
+TRANSLATABLE_SOURCES += [ SearchSource $(sources) ] ;
+physfs_objects = [ CompileObjects $(sources) ] ;
+

Modified: trunk/src/scripting/Jamfile
===================================================================
--- trunk/src/scripting/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/scripting/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -47,3 +47,4 @@
         [ MiniSwigRule wrapper.cpp : wrapper.interface.hpp : windstille : --select-namespace Scripting ] ;
 }
 
+TRANSLATABLE_SOURCES += [ SearchSource $(scripting_sources) ] ;

Modified: trunk/src/sound/Jamfile
===================================================================
--- trunk/src/sound/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/sound/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -1,6 +1,6 @@
 SubDir TOP src sound ;
 
-sound_objects = [ CompileObjects
+sources =
     sound_file.cpp
     sound_file.hpp
     sound_manager.cpp
@@ -9,5 +9,8 @@
     sound_source.hpp
     stream_sound_source.cpp
     stream_sound_source.hpp
-] ;
+;
 
+TRANSLATABLE_SOURCES += [ SearchSource $(sources) ] ;
+sound_objects = [ CompileObjects $(sources) ] ;
+

Modified: trunk/src/tinygettext/Jamfile
===================================================================
--- trunk/src/tinygettext/Jamfile	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/tinygettext/Jamfile	2005-06-29 08:27:54 UTC (rev 476)
@@ -1,7 +1,12 @@
 SubDir TOP src tinygettext ;
 
-tinygettext_objects = [ CompileObjects
+sources =
     tinygettext.cpp
     tinygettext.hpp
-] ;
+    gettext.cpp
+    gettext.hpp
+;
 
+TRANSLATABLE_SOURCES += [ SearchSource $(sources) ] ;
+tinygettext_objects = [ CompileObjects $(sources) ] ;
+

Modified: trunk/src/water_map.cxx
===================================================================
--- trunk/src/water_map.cxx	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/water_map.cxx	2005-06-29 08:27:54 UTC (rev 476)
@@ -33,7 +33,7 @@
 }
 
 void
-WaterMap::draw(SceneContext&amp; gc)
+WaterMap::draw(SceneContext&amp; )
 {
   for (Waters::iterator i = waters.begin(); i != waters.end(); ++i)
     {
@@ -93,7 +93,7 @@
 }
 
 void
-WaterMap::update(float delta)
+WaterMap::update(float )
 {
   CL_Vector pos = Player::current()-&gt;get_pos();
 

Modified: trunk/src/water_splash.cxx
===================================================================
--- trunk/src/water_splash.cxx	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/water_splash.cxx	2005-06-29 08:27:54 UTC (rev 476)
@@ -32,7 +32,7 @@
 }
 
 void
-WaterSplash::draw (SceneContext&amp; gc)
+WaterSplash::draw (SceneContext&amp; )
 {
   float factor = time * 2.0f;
   

Modified: trunk/src/windstille_main.cxx
===================================================================
--- trunk/src/windstille_main.cxx	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/windstille_main.cxx	2005-06-29 08:27:54 UTC (rev 476)
@@ -17,8 +17,6 @@
 //  along with this program; if not, write to the Free Software
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 
-//#include &lt;ruby.h&gt;
-//#include &lt;ClanLib/gl.h&gt;
 #include &lt;ClanLib/core.h&gt;
 #include &lt;ClanLib/vorbis.h&gt;
 #include &lt;ClanLib/display.h&gt;
@@ -35,9 +33,8 @@
 #include &quot;sound/sound_manager.hpp&quot;
 #include &quot;tile_factory.hxx&quot;
 #include &quot;script_manager.hpp&quot;
+#include &quot;tinygettext/gettext.hpp&quot;
 
-//extern &quot;C&quot; void Init_windstille(void);
-
 WindstilleMain main_app;
 CL_ResourceManager* resources;
 
@@ -171,6 +168,9 @@
 
   try {
     init_physfs(argv[0]);
+    dictionaryManager = new TinyGetText::DictionaryManager();
+    dictionaryManager-&gt;set_charset(&quot;iso8859-1&quot;);
+    dictionaryManager-&gt;add_directory(&quot;locale&quot;);                    
   } catch(std::exception&amp; e) {
     std::cout &lt;&lt; &quot;std::exception: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
     return 1;
@@ -250,15 +250,16 @@
   }
 #endif
 
+  delete dictionaryManager;
+  dictionaryManager = 0;
+  PHYSFS_deinit();
+
   return 0;
 }
 
 void
 WindstilleMain::init_modules()
 {
-  // ruby_init();
-  //  Init_windstille();
-  
   // Init ClanLib
   CL_SetupCore::init();
   

Modified: trunk/src/windstille_menu.cxx
===================================================================
--- trunk/src/windstille_menu.cxx	2005-06-29 01:10:22 UTC (rev 475)
+++ trunk/src/windstille_menu.cxx	2005-06-29 08:27:54 UTC (rev 476)
@@ -31,6 +31,7 @@
 #include &quot;sound/sound_manager.hpp&quot;
 #include &quot;windstille_bonus.hxx&quot;
 #include &quot;input/input_manager.hxx&quot;
+#include &quot;tinygettext/gettext.hpp&quot;
 
 WindstilleMenu::WindstilleMenu()
   : background(&quot;menu_background&quot;, resources),
@@ -164,47 +165,50 @@
 
   if (current_choice == 0)
     {
-      Fonts::menu.draw(580, 330, &quot;[Start Game]&quot;);
-      Fonts::menu_h.draw(580, 330, &quot;[Start Game]&quot;);
+      Fonts::menu.draw(580, 330, _(&quot;[Start Game]&quot;));
+      Fonts::menu_h.draw(580, 330, _(&quot;[Start Game]&quot;));
     }
   else
-    Fonts::menu.draw(580, 330, &quot;Start Game&quot;);
+    Fonts::menu.draw(580, 330, _(&quot;Start Game&quot;));
 
   if (bonus_active)
     {
       if (current_choice == 1)
         {
-          Fonts::menu.draw(580, 385, &quot;[Extras]&quot;);
-          Fonts::menu_h.draw(580, 385, &quot;[Extras]&quot;);
+          Fonts::menu.draw(580, 385, _(&quot;[Extras]&quot;));
+          Fonts::menu_h.draw(580, 385, _(&quot;[Extras]&quot;));
         }
       else
-        Fonts::menu.draw(580, 385, &quot;Extras&quot;);
+        Fonts::menu.draw(580, 385, _(&quot;Extras&quot;));
 
       if (current_choice == 2)
         {
-          Fonts::menu.draw(580, 440, &quot;[Quit]&quot;);
-          Fonts::menu_h.draw(580, 440, &quot;[Quit]&quot;);
+          Fonts::menu.draw(580, 440, _(&quot;[Quit]&quot;));
+          Fonts::menu_h.draw(580, 440, _(&quot;[Quit]&quot;));
         }
       else
-        Fonts::menu.draw(580, 440, &quot;Quit&quot;);
+        Fonts::menu.draw(580, 440, _(&quot;Quit&quot;));
     }
   else
     {
       if (current_choice == 1 || (bonus_active &amp;&amp; current_choice == 3))
         {
-          Fonts::menu.draw(580, 440, &quot;[Quit]&quot;);
-          Fonts::menu_h.draw(580, 440, &quot;[Quit]&quot;);
+          Fonts::menu.draw(580, 440, _(&quot;[Quit]&quot;));
+          Fonts::menu_h.draw(580, 440, _(&quot;[Quit]&quot;));
         }
       else
         Fonts::menu.draw(580, 440, &quot;Quit&quot;);
     }
 
+  std::string copyright = &quot;Windstille &quot; PACKAGE_VERSION &quot;\n&quot;;
+  copyright += _(&quot;Copyright (c) 2003 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
+                 &quot;This game comes with ABSOLUTELY NO WARRANTY. &quot;
+                 &quot;This is free software, and you are welcome\n&quot;
+                 &quot;to redistribute it under certain conditions; &quot;
+                 &quot;see the file COPYING for details.\n&quot;);
+
   Fonts::copyright.set_alignment(origin_bottom_left);
-  Fonts::copyright.draw(15, CL_Display::get_height() - 10,
-                        &quot;Windstille &quot; PACKAGE_VERSION &quot;\n&quot;
-                        &quot;Copyright (c) 2003 Ingo Ruhnke &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/windstille-commit">grumbel at gmx.de</A>&gt;\n&quot;
-                        &quot;This game comes with ABSOLUTELY NO WARRANTY. This is free software, and you are welcome\n&quot;
-                        &quot;to redistribute it under certain conditions; see the file COPYING for details.\n&quot;);
+  Fonts::copyright.draw(15, CL_Display::get_height() - 10, copyright.c_str());
 }
 
 void


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000132.html">[Windstille-commit] r475 - trunk/src
</A></li>
	<LI>Next message: <A HREF="000134.html">[Windstille-commit] r477 - in trunk: data/levels src src/scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#133">[ date ]</a>
              <a href="thread.html#133">[ thread ]</a>
              <a href="subject.html#133">[ subject ]</a>
              <a href="author.html#133">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
