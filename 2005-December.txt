From grumbel at berlios.de  Tue Dec 13 12:06:38 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Tue, 13 Dec 2005 12:06:38 +0100
Subject: [Windstille-commit] r1135 - htdocs
Message-ID: <200512131106.jBDB6cwS011046@sheep.berlios.de>

Author: grumbel
Date: 2005-12-13 12:06:35 +0100 (Tue, 13 Dec 2005)
New Revision: 1135

Modified:
   htdocs/contact.xml
   htdocs/default.xsl
   htdocs/development.xml
Log:
--- some unknown new stuff (automatically inserted by the upload script) ---

Modified: htdocs/contact.xml
===================================================================
--- htdocs/contact.xml	2005-11-28 18:22:04 UTC (rev 1134)
+++ htdocs/contact.xml	2005-12-13 11:06:35 UTC (rev 1135)
@@ -6,7 +6,11 @@
       There is currently one mailing list for Windstille available:
     </p>
     <ul>
-      <li><a href="http://mail.freesoftware.fsf.org/mailman/listinfo/windstille-devel">Windstille-Devel mailinglist</a></li>
+      <!-- <li><a href="http://mail.freesoftware.fsf.org/mailman/listinfo/windstille-devel">Windstille-Devel mailinglist</a></li> -->
+
+      <li><a href="https://lists.berlios.de/mailman/listinfo/windstille-devel">Windstille-Devel mailinglist</a> - discussion of the game development</li>
+      <li><a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">Windstille-Commit mailinglist</a> - automatic messages of code pieces commited to the source code repository</li>
+
     </ul>
     <p>
       In addition to that you can reach <a

Modified: htdocs/default.xsl
===================================================================
--- htdocs/default.xsl	2005-11-28 18:22:04 UTC (rev 1134)
+++ htdocs/default.xsl	2005-12-13 11:06:35 UTC (rev 1135)
@@ -41,7 +41,7 @@
             <td width="20%">
             </td>
             <td width="60%">
-              <h1><a href="http://www.nongnu.org/windstille/"><img border="0" src="images/windstille_small.png" alt="Windstille" /></a></h1>
+              <h1><a href="http://windstille.berlios.de/windstille/"><img border="0" src="images/windstille_small.png" alt="Windstille" /></a></h1>
             </td>
             <td width="20%">
               <div align="right">

Modified: htdocs/development.xml
===================================================================
--- htdocs/development.xml	2005-11-28 18:22:04 UTC (rev 1134)
+++ htdocs/development.xml	2005-12-13 11:06:35 UTC (rev 1135)
@@ -4,6 +4,6 @@
   <section title="Development Wiki">
     <br />
     All development related information can be found in the <a
-    href="wiki/">Windstille Development Wiki</a>.
+    href="doc/">Windstille Development Wiki</a>.
   </section>
 </page>
\ No newline at end of file



From grumbel at berlios.de  Tue Dec 13 12:09:45 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Tue, 13 Dec 2005 12:09:45 +0100
Subject: [Windstille-commit] r1136 - htdocs
Message-ID: <200512131109.jBDB9jRc011939@sheep.berlios.de>

Author: grumbel
Date: 2005-12-13 12:09:37 +0100 (Tue, 13 Dec 2005)
New Revision: 1136

Modified:
   htdocs/development.xml
Log:
--- some unknown new stuff (automatically inserted by the upload script) ---

Modified: htdocs/development.xml
===================================================================
--- htdocs/development.xml	2005-12-13 11:06:35 UTC (rev 1135)
+++ htdocs/development.xml	2005-12-13 11:09:37 UTC (rev 1136)
@@ -4,6 +4,6 @@
   <section title="Development Wiki">
     <br />
     All development related information can be found in the <a
-    href="doc/">Windstille Development Wiki</a>.
+    href="wiki/">Windstille Development Wiki</a>.
   </section>
 </page>
\ No newline at end of file



From grumbel at berlios.de  Sat Dec 17 16:53:31 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 17 Dec 2005 16:53:31 +0100
Subject: [Windstille-commit] r1137 - / facebuilder facebuilder/data facebuilder/data/ear facebuilder/data/eye facebuilder/data/eyebrow facebuilder/data/glasses facebuilder/data/hair facebuilder/data/head facebuilder/data/mouth facebuilder/data/nose trunk trunk/data/blender/hero trunk/data/images/objects trunk/data/levels trunk/data/models/vehicles/minetrain trunk/data/models/vehicles/troopshuttle
Message-ID: <200512171553.jBHFrVew000805@sheep.berlios.de>

Author: grumbel
Date: 2005-12-17 16:51:41 +0100 (Sat, 17 Dec 2005)
New Revision: 1137

Added:
   facebuilder/
   facebuilder/clock.rb
   facebuilder/data/
   facebuilder/data/ear/
   facebuilder/data/ear/0000.png
   facebuilder/data/eye/
   facebuilder/data/eye/0000.png
   facebuilder/data/eye/0001.png
   facebuilder/data/eye/0002.png
   facebuilder/data/eye/0003.png
   facebuilder/data/eye/0004.png
   facebuilder/data/eyebrow/
   facebuilder/data/eyebrow/0000.png
   facebuilder/data/glasses/
   facebuilder/data/glasses/0000.png
   facebuilder/data/glasses/0001.png
   facebuilder/data/glasses/0002.png
   facebuilder/data/hair/
   facebuilder/data/hair/0000.png
   facebuilder/data/hair/0001.png
   facebuilder/data/hair/0002.png
   facebuilder/data/head/
   facebuilder/data/head/0000.png
   facebuilder/data/head/0001.png
   facebuilder/data/head/0002.png
   facebuilder/data/mouth/
   facebuilder/data/mouth/0000.png
   facebuilder/data/mouth/0001.png
   facebuilder/data/mouth/0002.png
   facebuilder/data/mouth/0003.png
   facebuilder/data/nose/
   facebuilder/data/nose/0000.png
   facebuilder/face.rb
   facebuilder/facebuilder.rb
   facebuilder/protoface.xcf
   trunk/data/images/objects/steelboxlarge.xcf
   trunk/data/images/objects/steelboxsmall.xcf
Modified:
   trunk/AUTHORS
   trunk/SConstruct
   trunk/data/blender/hero/heroken3.blend
   trunk/data/levels/industrial.wst
   trunk/data/levels/newformat2.wst
   trunk/data/models/vehicles/minetrain/minetrain.xcf
   trunk/data/models/vehicles/troopshuttle/troopshuttle.blend
Log:
- added facebuilder

Added: facebuilder/clock.rb
===================================================================
--- facebuilder/clock.rb	2005-12-13 11:09:37 UTC (rev 1136)
+++ facebuilder/clock.rb	2005-12-17 15:51:41 UTC (rev 1137)
@@ -0,0 +1,177 @@
+#!/usr/bin/env ruby
+#
+# GnomeCanvas based analog clock widget
+#
+# Copyright (c) 2004 Geoff Youngs
+#
+# You can redistribute it and/or modify it under the terms of
+# the Ruby's licence.
+
+require 'gnomecanvas2'
+
+class Clock < Gtk::VBox
+  Point = Struct.new("Point", :x, :y)
+  class Point
+    def to_p
+     [x,y]
+    end
+    def -(p)
+      [x-p.x, y-p.y]
+    end
+  end
+  def clockhandposition(center, len, val, max)
+    angle = (Math::PI * (((val * 360.0) / max) - 90.0)) / 180.0
+    Point.new(center.x + (len * Math.cos(angle)),
+                         center.y + (len * Math.sin(angle)))
+  end
+  def basehandposition(center, len, val, max)
+    angle = (Math::PI * ((val * 360.0) / max)) / 180.0
+    Point.new(center.x + (len * Math.cos(angle)),
+                         center.y + (len * Math.sin(angle)))
+  end
+  def setup_clock()
+    topleft = Point.new(1.0,1.0)
+    bottomright = Point.new(100.0, 100.0)
+    center = Point.new(bottomright.x/2, bottomright.y/2)
+    @face=Gnome::CanvasEllipse.new(@canvas.root, {:x1 => topleft.x,
+                 :y1 => topleft.y,
+                 :x2 => bottomright.x,
+                 :y2 => bottomright.y,
+                 :fill_color => "white",
+                 :outline_color => "steelblue",
+                 :width_pixels => 1})
+    @radius = o = center.x * 0.50
+    o  = @radius / 2
+    @size =  center.x
+    @knob=Gnome::CanvasEllipse.new(@canvas.root, {:x1 => center.x-o,
+                 :y1 => center.y-o,
+                 :x2 => center.x+o,
+                 :y2 => center.y+o,
+                 :fill_color_rgba => 0x00669933})
+
+    @time = Time.now
+    @hourh = Gnome::CanvasPolygon.new(@canvas.root,
+                                          {:points => hourhand(center),
+                                            :fill_color_rgba => 0x00000080,
+                                            :join_style => Gdk::GC::JOIN_ROUND,
+                                            :outline_color => "black"})
+    @minuteh = Gnome::CanvasPolygon.new(@canvas.root,
+                                          {:points => minutehand(center),
+                                            :fill_color_rgba => 0x00000080,
+                                            :join_style => Gdk::GC::JOIN_ROUND,
+                                            :outline_color => "black"})
+    @secondh = Gnome::CanvasPolygon.new(@canvas.root,
+                                          {:points => secondhand(center),
+                                            :fill_color_rgba => 0xff000080,
+                                            :join_style => Gdk::GC::JOIN_ROUND,
+                                            :outline_color => "red"})
+
+                 
+  end
+  def hourhand(center)
+    val = (@time.hour % 12) + (@time.min / 60.0)
+    posn = clockhandposition(center, @radius * 0.6, val, 12)
+    size = @radius * 0.08
+    start = basehandposition(center, size, val, 12)
+    retn = basehandposition(center, - size, val, 12)
+    backp = clockhandposition(center, - size, val, 12)
+    [start.to_p, posn.to_p, retn.to_p, backp.to_p]
+  end
+  def minutehand(center)
+    posn = clockhandposition(center, [@radius - 4, @radius * 0.8].max, @time.min, 60)
+    size = @radius * 0.03
+    start = basehandposition(center, size, @time.min, 60)
+    retn = basehandposition(center, -size, @time.min, 60)
+    backp = clockhandposition(center, - size, @time.min, 60)
+    [start.to_p, posn.to_p, retn.to_p, backp.to_p]
+  end
+  def secondhand(center)
+    posn = clockhandposition(center, @radius * 0.9, @time.sec, 60)
+    size = @radius * 0.01
+    start = basehandposition(center, size, @time.sec, 60)
+    retn = basehandposition(center, -size, @time.sec, 60)
+    backp = clockhandposition(center, - size, @time.sec, 60)
+    [start.to_p, posn.to_p, retn.to_p, backp.to_p]
+  end
+  def draw_clock(resize=false)
+    return false if destroyed?
+    setup_clock() unless defined?(@face)
+    center = Point.new(@width/2, @height/2)
+    
+    if resize
+      @face.x1, @face.y1 = center.x - @radius, center.y - @radius
+      @face.x2, @face.y2 = center.x + @radius, center.y + @radius
+      o = @radius * 0.5
+      @knob.x1, @knob.y1 = center.x-o, center.y-o
+      @knob.x2, @knob.y2 = center.x+o, center.y+o
+    end
+    @time = Time.now
+    @hourh.points = hourhand(center)
+    @minuteh.points = minutehand(center)
+    @secondh.points = secondhand(center)
+    @label.set_markup(sprintf("<small><small>%02i:%02i</small></small>", at time.hour, @time.min))
+  end
+
+  def initialize()
+    super()
+    @box = Gtk::EventBox.new
+    pack_start(@box)
+    @label = Gtk::Label.new
+    @label.show
+    pack_end(@label,false,false,0)
+    set_border_width(@pad = 2)
+    set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
+    @canvas = Gnome::Canvas.new(true)
+    @box.add(@canvas)
+    draw_clock()
+    @box.signal_connect('size-allocate') { |w,e,*b| 
+      @width, @height = [e.width,e.height].collect{|i|i - (@pad*2)}
+      @size = [@width, at height].min
+      @radius = @size / 2
+      @canvas.set_size(@width, at height)
+      @canvas.set_scroll_region(0,0, at width, at height)
+      draw_clock(true)
+      false
+    }
+    signal_connect_after('show') {|w,e| start() }
+    signal_connect_after('hide') {|w,e| stop() }
+    @canvas.show()
+    @box.show()
+    show()
+  end
+  def start
+	@tid= Gtk::timeout_add(1000) { draw_clock(); true }
+  end
+  def stop
+	Gtk::timeout_remove(@tid) if @tid
+	@tid = nil
+  end
+  def set_bg(bg)
+  	modify_bg(Gtk::STATE_NORMAL, bg)
+  	@box.modify_bg(Gtk::STATE_NORMAL, bg)
+  	@canvas.modify_bg(Gtk::STATE_NORMAL, bg)
+  end
+end
+
+
+if $0 == __FILE__
+
+class Viewer < Gtk::Window
+  def initialize()
+    super()
+    set_title("Analog Clock")
+    signal_connect("delete_event") { |i,a| Gtk::main_quit }
+    set_default_size(200,220)
+    add(Clock.new)
+    show()
+  end
+end
+
+Gtk.init()
+
+view = Viewer.new
+view.show
+
+Gtk.main()
+  
+end

Added: facebuilder/data/ear/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/ear/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-13 11:09:37 UTC (rev 1136)
+++ facebuilder/face.rb	2005-12-17 15:51:41 UTC (rev 1137)
@@ -0,0 +1,160 @@
+require 'gnomecanvas2'
+
+class FacePart
+  attr_reader :type, :offset, :filename, :canvas_items, :scale, :rotation
+  
+  def initialize(root, type, filename, offset)
+    @type     = type
+    @offset   = offset
+    @filename = filename
+    @scale    = 1.0
+    @rotation = 0
+
+    @canvas_items = []
+
+    im = Gdk::Pixbuf.new(@filename)
+    if ! im then 
+      raise "#{@filename}: file not found: #{im.inspect}"
+    end
+
+    @canvas_items << Gnome::CanvasPixbuf.new(root,
+                                             :pixbuf => im,
+                                             :x => 0, # offset.x,
+                                             :y => 0, # offset.y,
+                                             :width =>  im.width,
+                                             :height => im.height,
+                                             :anchor => Gtk::ANCHOR_CENTER)
+
+    case @type
+    when :eye, :ear, :eyebrow
+      @canvas_items << Gnome::CanvasPixbuf.new(root,
+                                               :pixbuf => im,
+                                               :x => 0, # offset.x,
+                                               :y => 0, # offset.y,
+                                               :width =>  im.width,
+                                               :height => im.height,
+                                               :anchor => Gtk::ANCHOR_CENTER)
+    end
+    update_items()
+  end
+
+  def reload()
+    self.filename=(@filename)
+  end
+  
+  def toggle()
+    pathname = "data/" + type.to_s + "/"
+    files = Dir.new(pathname).to_a[2..-1]
+
+
+    file = File::basename(@filename)
+    index = 0
+
+    files.each_with_index { |obj, i|
+      if obj == file then
+        index = i
+        break
+      end
+    }
+    index += 1
+    
+    if index >= files.length then
+      index = 0
+    end
+
+    self.filename=(pathname + files[index])
+  end
+
+  def update_items()
+    if @canvas_items.length == 1 then
+      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+    elsif @canvas_items.length == 2 then
+      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+      @canvas_items[1].affine_absolute(Art::Affine.scale(-1.0, 1.0) * 
+                                       Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+    else
+      raise "Unhandled @canvas_items.length: #{@canvas_items.length}"
+    end
+  end
+
+  def rotation=(rotation)
+    @rotation = rotation
+    update_items()
+  end
+
+  def scale=(scale)
+    @scale = scale
+    update_items()
+  end
+
+  def filename=(filename)
+    puts "Setting: #{filename}"
+    @filename = filename    
+    pixbuf = Gdk::Pixbuf.new(@filename)
+    @canvas_items.each {|item|
+      item.pixbuf = pixbuf
+    }
+  end
+
+  def offset=(offset)
+    @offset = offset
+    update_items()
+  end
+
+  def offset()
+    return @offset
+  end
+
+  def save(out)
+    out << "  <#{type}>\n"
+    out << "    <filename>#{@filename}</filename>\n"
+    out << "    <offset><x>#{@offset.x}</x><y>#{@offset.y}</y></offset>\n"
+    out << "    <scale>#{@scale}</scale>\n"
+    out << "    <rotation>#{@rotation}</rotation>\n"
+    out << "  </#{type}>\n"
+  end
+end
+
+class Face
+  def initialize(root, filename = nil)
+    @root = root
+    @parts  = {
+      :head    => FacePart.new(root, :head,    "data/head/0000.png",    Point.new(0, 0)),
+      :eye     => FacePart.new(root, :eye,     "data/eye/0000.png",     Point.new(35, -10)),
+      :eyebrow => FacePart.new(root, :eyebrow, "data/eyebrow/0000.png", Point.new(45, -30)),
+      :glasses => FacePart.new(root, :glasses, "data/glasses/0000.png", Point.new(0, -10)),
+      :ear     => FacePart.new(root, :ear,     "data/ear/0000.png",     Point.new(90, 0)),
+      :nose    => FacePart.new(root, :nose,    "data/nose/0000.png",    Point.new(0, 30)),
+      :mouth   => FacePart.new(root, :mouth,   "data/mouth/0000.png",   Point.new(0, 75)),
+      :hair    => FacePart.new(root, :hair,    "data/hair/0000.png",    Point.new(0, -20))
+    }
+  end
+
+  def get_part(type)
+    return @parts[type]
+  end 
+
+  def reload()
+    @parts.each{|key, val| val.reload() }
+  end
+
+  def save(filename)
+    out = File.new(filename, "w")
+    out << "<face>\n"
+    @parts.each{|key, val| val.save(out)}
+    out << "</face>\n"
+    out.close()
+  end
+  
+  def load(filename)
+    
+  end
+end
+
+# EOF #

Added: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-13 11:09:37 UTC (rev 1136)
+++ facebuilder/facebuilder.rb	2005-12-17 15:51:41 UTC (rev 1137)
@@ -0,0 +1,241 @@
+#!/usr/bin/env ruby
+
+require 'gnomecanvas2'
+require "face.rb"
+
+Point = Struct.new("Point", :x, :y)
+class Point
+  def to_p
+    [x,y]
+  end
+  def +(p)
+    [x+p.x, y+p.y]
+  end
+  def -(p)
+    [x-p.x, y-p.y]
+  end
+end
+
+class FaceBuilder < Gtk::VBox
+  def add_image(root, filename, x, y, anchor, affine = nil)
+    im = Gdk::Pixbuf.new(filename)
+
+    unless im.nil?
+      image = Gnome::CanvasPixbuf.new(root,
+                                      :pixbuf => im,
+                                      :x => x,
+                                      :y => y,
+                                      :width => im.width,
+                                      :height => im.height,
+                                      :anchor => anchor)
+
+      image.signal_connect("event") { |item,event|
+        puts "Bla: ", item, event
+      }
+      # puts image.i2w_affine
+      # puts image.i2c_affine
+
+      if affine then
+        image.affine_absolute(affine)
+      end
+
+      image.signal_connect("destroy", im) { |item, im| }
+      return image
+    end
+  end
+
+  def setup_menu()
+    accel_group = Gtk::AccelGroup.new
+    item_factory = Gtk::ItemFactory.new(Gtk::ItemFactory::TYPE_MENU_BAR,
+                                        '<main>', accel_group)
+    
+    @window.add_accel_group(accel_group)
+    @window.set_border_width(0)
+
+    ifactory_cb = proc do |data, widget|
+      puts "ItemFactory: activated \"#{Gtk::ItemFactory.path_from_widget(widget)}\""
+    end
+    
+    menu_items = 
+      [
+       ['/_File'],
+       ['/File/tearoff1', '<Tearoff>', nil, nil, ifactory_cb],
+       ['/File/_New',
+        '<Item>', '<control>N', nil, ifactory_cb],
+       ['/File/_Open',
+        '<Item>', '<control>O', nil, method(:open_file)],
+       ['/File/_Save',
+        '<Item>', '<control>S', nil, method(:save_file)],
+       ['/File/Save _As...',
+        '<Item>', '<control>S', nil, method(:save_file)],
+       ['/File/Quit',
+        '<Item>', '<control>Q', nil, method(:quit)]
+      ]
+    item_factory.create_items(menu_items)
+    
+    return item_factory.get_widget('<main>')
+  end
+  
+  def quit(data, widget)
+    Gtk.main_quit
+  end
+
+  def open_file(data, widget)
+    dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
+                                         Gtk::FileChooser::ACTION_OPEN,
+                                         "gnome-vfs",
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::OPEN,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face = Face.new(@canvas.root, dialog.filename)
+      end
+      
+      dialog.destroy
+    }
+  end
+
+  def save_file(data, widget)
+    dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
+                                         Gtk::FileChooser::ACTION_SAVE,
+                                         "gnome-vfs",
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::SAVE,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face.save(dialog.filename)
+      end
+      
+      dialog.destroy
+    }
+  end
+
+  def initialize(window)
+    super()
+
+    @window = window
+
+    @box = Gtk::EventBox.new
+    @menu = setup_menu()
+    pack_start(@menu, false, false, 0)
+    pack_start(@box)
+
+    @label = Gtk::Label.new
+    @label.show
+    pack_end(@label,false,false,0)
+    set_border_width(@pad = 2)
+    set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
+    @canvas = Gnome::Canvas.new(true)
+    @box.add(@canvas)
+    
+    @canvas.signal_connect("button-press-event") { |item,event|
+      # Some throuble with alpha
+      # puts "Bla: ", @canvas.get_item_at(event.x, event.y)
+    }
+
+    puts @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
+
+    @canvas.root.affine_absolute(Art::Affine.translate(192, 192))
+
+    @face = Face.new(@canvas.root)
+
+    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :nose, :head, :hair]
+    @current_part = 0
+
+    @canvas.signal_connect("key-press-event") { |widget, event|
+      part = @face.get_part(@parts[@current_part])
+      case event.keyval
+      when Gdk::Keyval::GDK_e
+        @current_part -= 1
+        if @current_part < 0 then
+          @current_part = @parts.length - 1
+        end
+        puts @parts[@current_part]
+
+      when Gdk::Keyval::GDK_o
+        @current_part += 1
+        if @current_part >= @parts.length then
+          @current_part = 0
+        end
+        puts @parts[@current_part]
+
+      when Gdk::Keyval::GDK_r
+        @face.reload()
+
+      when Gdk::Keyval::GDK_p
+        part.scale=(part.scale / 1.02) if part
+
+      when Gdk::Keyval::GDK_u
+        part.scale=(part.scale * 1.02) if part
+
+      when Gdk::Keyval::GDK_y
+        part.rotation=(part.rotation - 1.0) if part
+
+      when Gdk::Keyval::GDK_i
+        part.rotation=(part.rotation + 1.0) if part
+
+      when Gdk::Keyval::GDK_a
+        part.toggle if part
+        
+      when Gdk::Keyval::GDK_Up
+        part.offset = Point.new(part.offset.x, part.offset.y - 1) if part
+        
+      when Gdk::Keyval::GDK_Down
+        part.offset = Point.new(part.offset.x, part.offset.y + 1) if part
+
+      when Gdk::Keyval::GDK_Left
+        part.offset = Point.new(part.offset.x - 1, part.offset.y) if part
+
+      when Gdk::Keyval::GDK_Right
+        part.offset = Point.new(part.offset.x + 1, part.offset.y) if part
+      end
+    }
+    
+    #     @box.signal_connect('size-allocate') { |w,e,*b| 
+    #       @width, @height = [e.width,e.height].collect{|i|i - (@pad*2)}
+    #       @size = [@width, at height].min
+    #       @radius = @size / 2
+    #       @canvas.set_size(@width, at height)
+    #       @canvas.set_scroll_region(0,0, at width, at height)
+    #       false
+    #     }
+
+    @canvas.set_size(384, 384)
+    @canvas.set_scroll_region(0,0,384,384)
+
+    signal_connect_after('show') {|w,e| }
+    signal_connect_after('hide') {|w,e| }
+    @canvas.show()
+    @menu.show()
+    @box.show()
+    show()
+  end
+end
+
+
+if $0 == __FILE__
+
+  class Viewer < Gtk::Window
+    def initialize()
+      super()
+      set_title("Face Builder")
+      signal_connect("delete_event") { |i,a| Gtk::main_quit }
+      add(FaceBuilder.new(self))
+      set_default_size(512, 512)
+      # set_resizable(false)
+      show()
+    end
+  end
+
+  Gtk.init()
+
+  view = Viewer.new
+  view.show
+
+  Gtk.main()
+  
+end
+
+# EOF #

Added: facebuilder/protoface.xcf
===================================================================
(Binary files differ)


Property changes on: facebuilder/protoface.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/AUTHORS	2005-12-17 15:51:41 UTC (rev 1137)
@@ -1,13 +1,25 @@
-Programming & Graphics
-======================
-  Ingo Ruhnke <grumbel at gmx.de>
+Programming
+===========
 
-Win32 Build
-===========
+  Ingo Ruhnke - Grumbel - <grumbel at gmx.de>
+  Matthias Braun - MatzeB - matze at braunis.de
+  James Gregory -
+  David Kamphausen - Godrin - <david.kamphausen at web.de>
+  Mark Dillavou - Line72- <line72 at line72.net>
+
+Graphics
+========
+  Ingo Ruhnke - Grumbel - <grumbel at gmx.de>
+  Ken Hirsch - quickflash - <khirsch11414 at yahoo.com>
+
+0.2.0 Win32 Build
+==================
   Robert Konrad <rkon at gmx.de>
 
 Music
 =====
   Ralph Weinert <r.weinert at bluewin.ch>
+  Marek Moeckel - Wansti - <wansti at gmx.de>
 
+
 # EOF #

Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/SConstruct	2005-12-17 15:51:41 UTC (rev 1137)
@@ -25,7 +25,6 @@
 ##
 
 import sys, os
-import sys, os
 sys.path.append('scons')
 
 def CheckSDL(context, version):
@@ -44,42 +43,70 @@
         return ret
 
 def CheckPhysFS(context, version):
+    optionFile = env['CACHEDIR'] + 'libphysfs.cache.py'
+    opts = Options(optionFile)
+    opts.AddOptions(
+        ('CACHED_LIBPHYSFS',   'Whether libphysfs is available'),
+        ('CXXFLAGS_LIBPHYSFS', ''),
+        ('LINKFLAGS_LIBPHYSFS',''),
+        )
+    opts.Update(context.env)
+
     context.Message( 'Checking for PhysFS >= %s ...' % version )
-    if context.TryCompile("""
-    #include <physfs.h>
-    int main()
-    {
-       return 0;
-    }
-    """, '.c'):
-        context.Result(1)
+    if not context.env.has_key('CACHED_LIBPHYSFS'):
+        oldLIBS = context.env.get( 'LIBS', [] )
+        context.env.Append(LIBS = [ 'physfs' ])
+        ret = context.TryCompile("""
+        #include <physfs.h>
+        int main()
+        {
+           return 0;
+        }
+        """, '.c')
+        oldLIBS = context.env.get( 'LIBS', [] )
+        context.env.Replace(LIBS = oldLIBS)
+
+        if ret:
+            env['CACHED_LIBPHYSFS']  = '1'
+            env['CXXFLAGS_LIBPHYSFS']  = ''
+            env['LINKFLAGS_LIBPHYSFS'] = '-lphysfs'
+
+            opts.Save(optionFile, context.env)
+            context.Result(ret)
+            return ret
+        else:
+            context.Result(ret)
+        return ret
+    else:
+        context.Result('ok (cached)')
         return 1
-    else:
-        context.Result(0)
-        return 0
 
 opts = Options(['options.cache', 'custom.py'])
 opts.Add('CXX', 'The C++ compiler')
 
 env = Environment(options=opts)
 
+env["CACHEDIR"] = "cache/"
+if not os.path.isdir(env['CACHEDIR']): os.mkdir(env['CACHEDIR'])
+
 # env.BuildDir('build2', '.')
 
-conf = Configure( env, custom_tests = { 'CheckSDL' : CheckSDL, 'CheckPhysFS' : CheckPhysFS } )
+if 'configure' in COMMAND_LINE_TARGETS:
+    conf = Configure( env, custom_tests = { 'CheckSDL' : CheckSDL, 'CheckPhysFS' : CheckPhysFS } )
 
-if not conf.CheckSDL('1.2.8'):
-    print 'We really need SDL!'
-    Exit(1)
+    if not conf.CheckSDL('1.2.8'):
+        print 'We really need SDL!'
+        Exit(1)
+        
+    if not conf.CheckPhysFS('1.0'):
+        print "libphysfs missing"
+        Exit(1)
 
-if not conf.CheckPhysFS('1.0'):
-    print "libphysfs missing"
-    Exit(1)
+    env = conf.Finish() 
+else:
+    Export('env')
+    SConscript('tools/miniswig/SConscript')
+    SConscript('src/SConscript')
+    SConscript('src/scripting/SConscript')
 
-env = conf.Finish() 
-
-Export('env')
-SConscript('tools/miniswig/SConscript')
-SConscript('src/SConscript')
-SConscript('src/scripting/SConscript')
-
 # EOF #

Modified: trunk/data/blender/hero/heroken3.blend
===================================================================
(Binary files differ)

Added: trunk/data/images/objects/steelboxlarge.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/objects/steelboxlarge.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/data/images/objects/steelboxsmall.xcf
===================================================================
(Binary files differ)


Property changes on: trunk/data/images/objects/steelboxsmall.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/data/levels/industrial.wst
===================================================================
--- trunk/data/levels/industrial.wst	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/data/levels/industrial.wst	2005-12-17 15:51:41 UTC (rev 1137)
@@ -45,16 +45,16 @@
      )
 
     (particle-system
-     (lifetime   8.0)
+     (lifetime   15.0)
      (count      70)
 
      (z-pos  1000)
      (pos 0 136)
-     (velocity 80 150)
+     (velocity 60 80)
      (cone    85 95)
      (gravity 0.0 0.0)
      (size   0.9 1.0)
-     (drawer (surface-drawer (image "images/particles/snow2.png")))
+     (drawer (surface-drawer (image "images/particles/snow.png")))
      (color-begin 1.0 1.0 1.0 1.0)
      (color-end 1.0 1.0 1.0 1.0)
      (distribution (line-distribution (x1 0) (y1 0) (x2 1024) (y2 0)))

Modified: trunk/data/levels/newformat2.wst
===================================================================
--- trunk/data/levels/newformat2.wst	2005-12-13 11:09:37 UTC (rev 1136)
+++ trunk/data/levels/newformat2.wst	2005-12-17 15:51:41 UTC (rev 1137)
@@ -16,6 +16,16 @@
     (width 20)
     )
 
+   (liquid
+    (pos 832 832)
+    (width 4)
+    )
+
+   (liquid
+    (pos 1312 832)
+    (width 4)
+    )
+
    (vrdummy
     (name "VRDummy")
     (pos 600 600)
@@ -205,7 +215,7 @@
       (name "bob")
       (pos 320 831)
       (z-pos -50)
-      (action "Bar")
+      (action "Aim")
       (sprite3d "models/characters/bob/bob.wsprite")
     )
     (character

Modified: trunk/data/models/vehicles/minetrain/minetrain.xcf
===================================================================
(Binary files differ)

Modified: trunk/data/models/vehicles/troopshuttle/troopshuttle.blend
===================================================================
(Binary files differ)



From grumbel at berlios.de  Sat Dec 17 18:52:24 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 17 Dec 2005 18:52:24 +0100
Subject: [Windstille-commit] r1138 - in facebuilder: . data data/beard data/eye data/glasses data/hair data/head data/mouth data/nose
Message-ID: <200512171752.jBHHqOBw000315@sheep.berlios.de>

Author: grumbel
Date: 2005-12-17 18:52:20 +0100 (Sat, 17 Dec 2005)
New Revision: 1138

Added:
   facebuilder/data/beard/
   facebuilder/data/beard/0000.png
   facebuilder/data/beard/0001.png
   facebuilder/data/beard/0002.png
   facebuilder/data/eye/0005.png
   facebuilder/data/hair/0003.png
   facebuilder/data/hair/0004.png
   facebuilder/data/head/0003.png
   facebuilder/data/mouth/0004.png
   facebuilder/data/nose/0001.png
Modified:
   facebuilder/data/glasses/0002.png
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- some more stuff

Added: facebuilder/data/beard/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/beard/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/beard/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/beard/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/beard/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/beard/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/glasses/0002.png
===================================================================
(Binary files differ)

Added: facebuilder/data/hair/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-17 15:51:41 UTC (rev 1137)
+++ facebuilder/face.rb	2005-12-17 17:52:20 UTC (rev 1138)
@@ -44,9 +44,8 @@
   
   def toggle()
     pathname = "data/" + type.to_s + "/"
-    files = Dir.new(pathname).to_a[2..-1]
-
-
+    files = Dir.new(pathname).to_a[2..-1].grep(/\.png$/)
+    
     file = File::basename(@filename)
     index = 0
 
@@ -132,6 +131,7 @@
       :ear     => FacePart.new(root, :ear,     "data/ear/0000.png",     Point.new(90, 0)),
       :nose    => FacePart.new(root, :nose,    "data/nose/0000.png",    Point.new(0, 30)),
       :mouth   => FacePart.new(root, :mouth,   "data/mouth/0000.png",   Point.new(0, 75)),
+      :beard   => FacePart.new(root, :beard,   "data/beard/0000.png",   Point.new(0, 75)),
       :hair    => FacePart.new(root, :hair,    "data/hair/0000.png",    Point.new(0, -20))
     }
   end

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-17 15:51:41 UTC (rev 1137)
+++ facebuilder/facebuilder.rb	2005-12-17 17:52:20 UTC (rev 1138)
@@ -141,7 +141,7 @@
 
     @face = Face.new(@canvas.root)
 
-    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :nose, :head, :hair]
+    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :beard, :nose, :head, :hair]
     @current_part = 0
 
     @canvas.signal_connect("key-press-event") { |widget, event|



From grumbel at berlios.de  Wed Dec 21 18:34:59 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 21 Dec 2005 18:34:59 +0100
Subject: [Windstille-commit] r1139 - facebuilder
Message-ID: <200512211734.jBLHYxVt022485@sheep.berlios.de>

Author: grumbel
Date: 2005-12-21 18:34:58 +0100 (Wed, 21 Dec 2005)
New Revision: 1139

Added:
   facebuilder/examples/
Modified:
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- added some controls for use with mouse
- added load support

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-17 17:52:20 UTC (rev 1138)
+++ facebuilder/face.rb	2005-12-21 17:34:58 UTC (rev 1139)
@@ -1,3 +1,4 @@
+require "rexml/document"
 require 'gnomecanvas2'
 
 class FacePart
@@ -42,7 +43,7 @@
     self.filename=(@filename)
   end
   
-  def toggle()
+  def next_item()
     pathname = "data/" + type.to_s + "/"
     files = Dir.new(pathname).to_a[2..-1].grep(/\.png$/)
     
@@ -64,6 +65,28 @@
     self.filename=(pathname + files[index])
   end
 
+  def previous_item()
+    pathname = "data/" + type.to_s + "/"
+    files = Dir.new(pathname).to_a[2..-1].grep(/\.png$/)
+    
+    file = File::basename(@filename)
+    index = 0
+
+    files.each_with_index { |obj, i|
+      if obj == file then
+        index = i
+        break
+      end
+    }
+    index -= 1
+    
+    if index < 0 then
+      index = files.length - 1
+    end
+
+    self.filename=(pathname + files[index])
+  end
+
   def update_items()
     if @canvas_items.length == 1 then
       @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
@@ -93,7 +116,6 @@
   end
 
   def filename=(filename)
-    puts "Setting: #{filename}"
     @filename = filename    
     pixbuf = Gdk::Pixbuf.new(@filename)
     @canvas_items.each {|item|
@@ -127,12 +149,13 @@
       :head    => FacePart.new(root, :head,    "data/head/0000.png",    Point.new(0, 0)),
       :eye     => FacePart.new(root, :eye,     "data/eye/0000.png",     Point.new(35, -10)),
       :eyebrow => FacePart.new(root, :eyebrow, "data/eyebrow/0000.png", Point.new(45, -30)),
-      :glasses => FacePart.new(root, :glasses, "data/glasses/0000.png", Point.new(0, -10)),
       :ear     => FacePart.new(root, :ear,     "data/ear/0000.png",     Point.new(90, 0)),
       :nose    => FacePart.new(root, :nose,    "data/nose/0000.png",    Point.new(0, 30)),
       :mouth   => FacePart.new(root, :mouth,   "data/mouth/0000.png",   Point.new(0, 75)),
       :beard   => FacePart.new(root, :beard,   "data/beard/0000.png",   Point.new(0, 75)),
-      :hair    => FacePart.new(root, :hair,    "data/hair/0000.png",    Point.new(0, -20))
+      :glasses => FacePart.new(root, :glasses, "data/glasses/0000.png", Point.new(0, -10)),
+      :hair    => FacePart.new(root, :hair,    "data/hair/0000.png",    Point.new(0, -20)),
+      :hat     => FacePart.new(root,  :hat,    "data/hat/0000.png",    Point.new(0, -50))
     }
   end
 
@@ -153,7 +176,16 @@
   end
   
   def load(filename)
-    
+    file = File.new( filename )
+    doc = REXML::Document.new(file)
+    doc.elements.each("face/*") { |element|
+      part = element.name.to_sym
+      @parts[part].rotation = element.elements['rotation'].text.to_f
+      @parts[part].scale    = element.elements['scale'].text.to_f
+      @parts[part].filename = element.elements['filename'].text
+      @parts[part].offset   = Point.new(element.elements['offset/x/'].text.to_f, 
+                                        element.elements['offset/y'].text.to_f)
+    }
   end
 end
 

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-17 17:52:20 UTC (rev 1138)
+++ facebuilder/facebuilder.rb	2005-12-21 17:34:58 UTC (rev 1139)
@@ -1,6 +1,6 @@
 #!/usr/bin/env ruby
 
-require 'gnomecanvas2'
+require "gnomecanvas2"
 require "face.rb"
 
 Point = Struct.new("Point", :x, :y)
@@ -44,6 +44,39 @@
     end
   end
 
+  def setup_controls(root, pos, facepart)
+    left = Gtk::Button.new("<-")
+    Gnome::CanvasWidget.new(root,
+                            {:widget => left,
+                              :x => pos.x,
+                              :y => pos.y,
+                              :width =>  32.0,
+                              :height => 32.0,
+                              :anchor => Gtk::ANCHOR_EAST,
+                              :size_pixels => FALSE})
+    left.show()
+    left.signal_connect("clicked") {
+      @face.get_part(facepart).previous_item()
+      set_current_part(facepart)
+    }
+
+    right = Gtk::Button.new("->")
+    Gnome::CanvasWidget.new(root,
+                            {:widget => right,
+                              :x => pos.x,
+                              :y => pos.y,
+                              :width =>  32.0,
+                              :height => 32.0,
+                              :anchor => Gtk::ANCHOR_WEST,
+                              :size_pixels => FALSE})
+    right.show()
+    right.signal_connect("clicked") {
+      @face.get_part(facepart).next_item()
+      set_current_part(facepart)
+    }
+    return [left, right]
+  end
+
   def setup_menu()
     accel_group = Gtk::AccelGroup.new
     item_factory = Gtk::ItemFactory.new(Gtk::ItemFactory::TYPE_MENU_BAR,
@@ -69,12 +102,39 @@
        ['/File/Save _As...',
         '<Item>', '<control>S', nil, method(:save_file)],
        ['/File/Quit',
-        '<Item>', '<control>Q', nil, method(:quit)]
+        '<Item>', '<control>Q', nil, method(:quit)],
+       ['/Help/About',
+        '<Item>', nil, nil, method(:about_dialog)]
       ]
     item_factory.create_items(menu_items)
     
     return item_factory.get_widget('<main>')
   end
+
+  def about_dialog(data, widget)
+    Gtk::AboutDialog.set_email_hook {|about, link|
+      p "email_hook"
+      p link
+    }
+    Gtk::AboutDialog.set_url_hook {|about, link|
+      p "url_hook"
+      p link
+    }
+
+    Gtk::AboutDialog.show(nil,
+                          "artists" => ["Ingo Ruhnke <grumbel at gmx.de>"],
+                          "authors" => ["Ingo Ruhnke <grumbel at gmx.de>"],
+                          "comments" => "A simple tool to construct faces",
+                          "copyright" => "Copyright (C) 2005 Ingo Ruhnke <grumbel at gmx.de>",
+                          # "documenters" => ["Documenter 1 <no1 at foo.bar.com>", "Documenter 2 <no2 at foo.bar.com>"],
+                          "license" => "This program is licenced under the GNU GPL.",
+                          "logo_icon_name" => "gtk-home",
+                          "name" => "Face Builder",
+                          "version" => "0.0.1",
+                          "website" => "http://windstille.berlios.de/facebuilder/",
+                          "website_label" => "Face Builder"
+                          )
+  end
   
   def quit(data, widget)
     Gtk.main_quit
@@ -89,7 +149,7 @@
                                          )
     dialog.run { |response|
       if response == Gtk::Dialog::RESPONSE_ACCEPT then
-        @face = Face.new(@canvas.root, dialog.filename)
+        @face.load(dialog.filename)
       end
       
       dialog.destroy
@@ -112,6 +172,14 @@
     }
   end
 
+  def set_current_part(type)
+    @parts.each_with_index() { |p, i|
+      if type == p then
+        @current_part = i
+      end
+    }
+  end
+
   def initialize(window)
     super()
 
@@ -138,10 +206,18 @@
     puts @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
 
     @canvas.root.affine_absolute(Art::Affine.translate(192, 192))
-
     @face = Face.new(@canvas.root)
+    
+    setup_controls(@canvas.root, Point.new(0, -200),  :hat)
+    setup_controls(@canvas.root, Point.new(0, 200),   :head)
+    setup_controls(@canvas.root, Point.new(200, -140), :hair)
 
-    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :beard, :nose, :head, :hair]
+    setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
+    setup_controls(@canvas.root, Point.new(200, 0),   :eye)
+    setup_controls(@canvas.root, Point.new(200, 40),  :nose)
+    setup_controls(@canvas.root, Point.new(200, 80),  :mouth)
+
+    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :beard, :nose, :head, :hair, :hat]
     @current_part = 0
 
     @canvas.signal_connect("key-press-event") { |widget, event|
@@ -177,7 +253,7 @@
         part.rotation=(part.rotation + 1.0) if part
 
       when Gdk::Keyval::GDK_a
-        part.toggle if part
+        part.next_item if part
         
       when Gdk::Keyval::GDK_Up
         part.offset = Point.new(part.offset.x, part.offset.y - 1) if part
@@ -207,6 +283,7 @@
 
     signal_connect_after('show') {|w,e| }
     signal_connect_after('hide') {|w,e| }
+
     @canvas.show()
     @menu.show()
     @box.show()



From grumbel at berlios.de  Wed Dec 21 18:36:16 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 21 Dec 2005 18:36:16 +0100
Subject: [Windstille-commit] r1140 - in facebuilder/data: . eye eyebrow hair hat head mouth nose
Message-ID: <200512211736.jBLHaGXC024240@sheep.berlios.de>

Author: grumbel
Date: 2005-12-21 18:36:03 +0100 (Wed, 21 Dec 2005)
New Revision: 1140

Added:
   facebuilder/data/eye/0006.png
   facebuilder/data/eye/0007.png
   facebuilder/data/eye/0008.png
   facebuilder/data/eyebrow/0001.png
   facebuilder/data/eyebrow/0002.png
   facebuilder/data/eyebrow/0003.png
   facebuilder/data/hair/0005.png
   facebuilder/data/hat/
   facebuilder/data/hat/0000.png
   facebuilder/data/hat/0001.png
   facebuilder/data/hat/0002.png
   facebuilder/data/head/0005.png
   facebuilder/data/head/0006.png
   facebuilder/data/mouth/0005.png
   facebuilder/data/nose/0002.png
   facebuilder/data/nose/0003.png
   facebuilder/data/nose/0004.png
   facebuilder/data/nose/0005.png
Log:
- more face parts

Added: facebuilder/data/eye/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0008.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0008.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hat/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hat/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hat/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hat/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hat/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hat/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0002.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0002.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Wed Dec 21 19:38:26 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 21 Dec 2005 19:38:26 +0100
Subject: [Windstille-commit] r1141 - in facebuilder: . examples images
Message-ID: <200512211838.jBLIcQqc023412@sheep.berlios.de>

Author: grumbel
Date: 2005-12-21 19:38:19 +0100 (Wed, 21 Dec 2005)
New Revision: 1141

Added:
   facebuilder/COPYING
   facebuilder/README
   facebuilder/TODO
   facebuilder/examples/women1.xml
   facebuilder/examples/women2.xml
   facebuilder/images/
   facebuilder/images/screenshot-0.0.1-1.png
   facebuilder/images/screenshot-0.0.1-1_thumb.jpg
   facebuilder/images/screenshot-0.0.1-2.png
   facebuilder/images/screenshot-0.0.1-2_thumb.jpg
   facebuilder/index.html
Modified:
   facebuilder/facebuilder.rb
Log:
- readme and stuff

Added: facebuilder/COPYING
===================================================================
--- facebuilder/COPYING	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/COPYING	2005-12-21 18:38:19 UTC (rev 1141)
@@ -0,0 +1,340 @@
+		    GNU GENERAL PUBLIC LICENSE
+		       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.
+	51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Library General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+		    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
+
+In addition, mere aggregation of another work not based on the Program
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
+
+The source code for a work means the preferred form of the work for
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Program.
+
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+			    NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+		     END OF TERMS AND CONDITIONS
+
+	    How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
+
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year  name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  <signature of Ty Coon>, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Library General
+Public License instead of this License.

Added: facebuilder/README
===================================================================
--- facebuilder/README	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/README	2005-12-21 18:38:19 UTC (rev 1141)
@@ -0,0 +1,38 @@
+ ,----------------------
+| FaceBuilder README
++--------------
+
+FaceBuilder is a little toy application that lets you construct faces
+by putting together eyes, nose, mouth, head, hair and some additional
+items. You can also move, scale and rotate each of those face-parts as
+you like. The results can be saved to XML files and it currently
+provides ~50 faceparts in total.
+
+Running
+-------
+
+You need Ruby and the Ruby bindings for Gtk and GnomeCanvas. Once you
+have those just run:
+
+ ./facebuilder.rb
+
+
+Controls
+--------
+
+PgUp, PgDown: scale facepart
+Home, End:    rotate facepart
+Cursorkeys:   move facepart
+
+The face parts itself can be selected via the GUI
+
+
+Customizations
+--------------
+
+If you want to customize this programm just add new face parts to
+data/$FACEPART/, the programm should be able to find them
+automatically then.
+
+
+# EOF #

Added: facebuilder/TODO
===================================================================
--- facebuilder/TODO	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/TODO	2005-12-21 18:38:19 UTC (rev 1141)
@@ -0,0 +1,13 @@
+ ,----------------------
+| FaceBuilder ToDo
++--------------
+
+* follow a few more GUI conventions
+* select face part from a list instead of via next/previous toggles
+* add much more face parts
+* adjust all face parts to follow a standard convention (pupils in
+  center of, hair relative to the center of the face, etc) so that
+  they are easier swapable without size and position adjustments
+* support for different sets, male/female, comic, realistic, etc
+
+# EOF #

Added: facebuilder/examples/women1.xml
===================================================================
--- facebuilder/examples/women1.xml	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/examples/women1.xml	2005-12-21 18:38:19 UTC (rev 1141)
@@ -0,0 +1,62 @@
+<face>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>45</x><y>-30</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eyebrow>
+  <eye>
+    <filename>data/eye/0001.png</filename>
+    <offset><x>38</x><y>-4</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0</rotation>
+  </eye>
+  <hat>
+    <filename>data/hat/0001.png</filename>
+    <offset><x>0</x><y>-140</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hat>
+  <nose>
+    <filename>data/nose/0001.png</filename>
+    <offset><x>0</x><y>32</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0006.png</filename>
+    <offset><x>0</x><y>-12</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0000.png</filename>
+    <offset><x>0</x><y>-20</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hair>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <glasses>
+    <filename>data/glasses/0002.png</filename>
+    <offset><x>0</x><y>-4</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </glasses>
+</face>

Added: facebuilder/examples/women2.xml
===================================================================
--- facebuilder/examples/women2.xml	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/examples/women2.xml	2005-12-21 18:38:19 UTC (rev 1141)
@@ -0,0 +1,62 @@
+<face>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>37</x><y>-25</y></offset>
+    <scale>1.0404</scale>
+    <rotation>0</rotation>
+  </eyebrow>
+  <eye>
+    <filename>data/eye/0008.png</filename>
+    <offset><x>38</x><y>-2</y></offset>
+    <scale>0.510028165626483</scale>
+    <rotation>0</rotation>
+  </eye>
+  <hat>
+    <filename>data/hat/0000.png</filename>
+    <offset><x>0</x><y>-140</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hat>
+  <nose>
+    <filename>data/nose/0003.png</filename>
+    <offset><x>0</x><y>28</y></offset>
+    <scale>1.08243216</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0002.png</filename>
+    <offset><x>0</x><y>-5</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>0</x><y>73</y></offset>
+    <scale>0.530633303517793</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0002.png</filename>
+    <offset><x>0</x><y>-18</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hair>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <glasses>
+    <filename>data/glasses/0002.png</filename>
+    <offset><x>0</x><y>-4</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </glasses>
+</face>

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/facebuilder.rb	2005-12-21 18:38:19 UTC (rev 1141)
@@ -92,13 +92,9 @@
     menu_items = 
       [
        ['/_File'],
-       ['/File/tearoff1', '<Tearoff>', nil, nil, ifactory_cb],
-       ['/File/_New',
-        '<Item>', '<control>N', nil, ifactory_cb],
+#       ['/File/tearoff1', '<Tearoff>', nil, nil, ifactory_cb],
        ['/File/_Open',
         '<Item>', '<control>O', nil, method(:open_file)],
-       ['/File/_Save',
-        '<Item>', '<control>S', nil, method(:save_file)],
        ['/File/Save _As...',
         '<Item>', '<control>S', nil, method(:save_file)],
        ['/File/Quit',
@@ -112,14 +108,14 @@
   end
 
   def about_dialog(data, widget)
-    Gtk::AboutDialog.set_email_hook {|about, link|
-      p "email_hook"
-      p link
-    }
-    Gtk::AboutDialog.set_url_hook {|about, link|
-      p "url_hook"
-      p link
-    }
+#     Gtk::AboutDialog.set_email_hook {|about, link|
+#       p "email_hook"
+#       p link
+#     }
+#     Gtk::AboutDialog.set_url_hook {|about, link|
+#       p "url_hook"
+#       p link
+#     }
 
     Gtk::AboutDialog.show(nil,
                           "artists" => ["Ingo Ruhnke <grumbel at gmx.de>"],
@@ -127,7 +123,7 @@
                           "comments" => "A simple tool to construct faces",
                           "copyright" => "Copyright (C) 2005 Ingo Ruhnke <grumbel at gmx.de>",
                           # "documenters" => ["Documenter 1 <no1 at foo.bar.com>", "Documenter 2 <no2 at foo.bar.com>"],
-                          "license" => "This program is licenced under the GNU GPL.",
+                          "license" => File.new("COPYING").read(),
                           "logo_icon_name" => "gtk-home",
                           "name" => "Face Builder",
                           "version" => "0.0.1",
@@ -203,7 +199,8 @@
       # puts "Bla: ", @canvas.get_item_at(event.x, event.y)
     }
 
-    puts @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
+    # puts
+    @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
 
     @canvas.root.affine_absolute(Art::Affine.translate(192, 192))
     @face = Face.new(@canvas.root)
@@ -212,6 +209,8 @@
     setup_controls(@canvas.root, Point.new(0, 200),   :head)
     setup_controls(@canvas.root, Point.new(200, -140), :hair)
 
+    setup_controls(@canvas.root, Point.new(-200, 0), :glasses)
+
     setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
     setup_controls(@canvas.root, Point.new(200, 0),   :eye)
     setup_controls(@canvas.root, Point.new(200, 40),  :nose)
@@ -240,16 +239,16 @@
       when Gdk::Keyval::GDK_r
         @face.reload()
 
-      when Gdk::Keyval::GDK_p
+      when Gdk::Keyval::GDK_Page_Down
         part.scale=(part.scale / 1.02) if part
 
-      when Gdk::Keyval::GDK_u
+      when Gdk::Keyval::GDK_Page_Up
         part.scale=(part.scale * 1.02) if part
 
-      when Gdk::Keyval::GDK_y
+      when Gdk::Keyval::GDK_End
         part.rotation=(part.rotation - 1.0) if part
 
-      when Gdk::Keyval::GDK_i
+      when Gdk::Keyval::GDK_Home
         part.rotation=(part.rotation + 1.0) if part
 
       when Gdk::Keyval::GDK_a

Added: facebuilder/images/screenshot-0.0.1-1.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/screenshot-0.0.1-1.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/images/screenshot-0.0.1-1_thumb.jpg
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/screenshot-0.0.1-1_thumb.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/images/screenshot-0.0.1-2.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/screenshot-0.0.1-2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/images/screenshot-0.0.1-2_thumb.jpg
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/screenshot-0.0.1-2_thumb.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/index.html
===================================================================
--- facebuilder/index.html	2005-12-21 17:36:03 UTC (rev 1140)
+++ facebuilder/index.html	2005-12-21 18:38:19 UTC (rev 1141)
@@ -0,0 +1,35 @@
+<html>
+  <head></head>
+  <body>
+    <h1>Face Builder</h1>
+
+    <p>
+      FaceBuilder is a little toy application that lets you construct
+      faces by putting together eyes, nose, mouth, head, hair and some
+      additional items. You can also move, scale and rotate each of
+      those face-parts as you like. The results can be saved to XML
+      files. FaceBuilder currently provides ~50 faceparts in total.
+    </p>
+
+    <h2>Controls</h2>
+    <pre>
+      PgUp, PgDown: scale facepart
+      Home, End:    rotate facepart
+      Cursorkeys:   move facepart
+
+      The face parts itself can be selected via the GUI
+    </pre>
+
+    <h2>Screenshots</h2>
+    <a href="images/screenshot-0.0.1-1.png"><img src="images/screenshot-0.0.1-1_thumb.jpg" /></a>
+    <a href="images/screenshot-0.0.1-2.png"><img src="images/screenshot-0.0.1-2_thumb.jpg" /></a>
+    
+    <h2>Download</h2>
+    <p>
+      
+    </p>
+    
+    <hr>
+      Copyright &copy; 2005 <a href="http://pingus.seul.org/~grumbel/">Ingo Ruhnke</a>, <a href="mailto:grumbel at gmx.de?subject=[Windstille] ">&lt;grumbel at gmx.de&gt;</a>
+  </body>
+</html>
\ No newline at end of file



From grumbel at berlios.de  Fri Dec 23 00:49:00 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Fri, 23 Dec 2005 00:49:00 +0100
Subject: [Windstille-commit] r1142 - in trunk/src: . badguy sprite2d sprite3d
Message-ID: <200512222349.jBMNn0Yg022071@sheep.berlios.de>

Author: grumbel
Date: 2005-12-23 00:48:54 +0100 (Fri, 23 Dec 2005)
New Revision: 1142

Added:
   trunk/src/lisp_getters.cpp
   trunk/src/lisp_getters.hpp
Removed:
   trunk/src/windstille_getters.cpp
   trunk/src/windstille_getters.hpp
Modified:
   trunk/src/Jamfile
   trunk/src/badguy/hedgehog.cpp
   trunk/src/badguy/spider_mine.cpp
   trunk/src/badguy/swarm.cpp
   trunk/src/badguy/vrdummy.cpp
   trunk/src/game_object.hpp
   trunk/src/grenade.cpp
   trunk/src/physics.cpp
   trunk/src/physics.hpp
   trunk/src/pistol.cpp
   trunk/src/pistol.hpp
   trunk/src/sprite2d/sprite.cpp
   trunk/src/sprite2d/sprite.hpp
   trunk/src/sprite3d/sprite3d.cpp
   trunk/src/sprite3d/sprite3d.hpp
   trunk/src/test_object.cpp
   trunk/src/test_object.hpp
   trunk/src/weapon.hpp
Log:
- just some little renaming

Modified: trunk/src/Jamfile
===================================================================
--- trunk/src/Jamfile	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/Jamfile	2005-12-22 23:48:54 UTC (rev 1142)
@@ -121,8 +121,8 @@
         util.hpp
         view.cpp
         view.hpp
-        windstille_getters.hpp
-        windstille_getters.cpp
+        lisp_getters.hpp
+        lisp_getters.cpp
         windstille_main.cpp
         windstille_main.hpp
 ;

Modified: trunk/src/badguy/hedgehog.cpp
===================================================================
--- trunk/src/badguy/hedgehog.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/badguy/hedgehog.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -27,7 +27,7 @@
 #include "sector.hpp"
 #include "hedgehog.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 
 Hedgehog::Hedgehog(const lisp::Lisp* lisp)
   : sprite("images/hedgehog.sprite"),

Modified: trunk/src/badguy/spider_mine.cpp
===================================================================
--- trunk/src/badguy/spider_mine.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/badguy/spider_mine.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -26,7 +26,7 @@
 
 #include "spider_mine.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "player.hpp"
 #include "sprite2d/manager.hpp"
 

Modified: trunk/src/badguy/swarm.cpp
===================================================================
--- trunk/src/badguy/swarm.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/badguy/swarm.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -30,7 +30,7 @@
 #include "lisp/properties.hpp"
 #include "game_session.hpp"
 #include "view.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "display/vertex_array_drawing_request.hpp"
 #include "random.hpp"
 #include "swarm.hpp"

Modified: trunk/src/badguy/vrdummy.cpp
===================================================================
--- trunk/src/badguy/vrdummy.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/badguy/vrdummy.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -25,7 +25,7 @@
 
 #include "lisp/properties.hpp"
 #include "random.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "vrdummy.hpp"
 
 VRDummy::VRDummy(const lisp::Lisp* lisp)

Modified: trunk/src/game_object.hpp
===================================================================
--- trunk/src/game_object.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/game_object.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -92,11 +92,11 @@
   virtual void draw (SceneContext& context) = 0;
   /**
    * This function is called from time to time to give the object a chance to
-   * update it's state. elapsed_time is the time that elapsed since the last
+   * update it's state. delta is the time that elapsed since the last
    * update call in seconds. It is possible that there are multiple objects
    * between 2 draw() calls or multiple draw() calls between 2 updates
    */
-  virtual void update (float elapsed_time) = 0;
+  virtual void update (float delta) = 0;
     
   static void set_world (Sector* w) { world = w; }
   Sector* get_world () const

Modified: trunk/src/grenade.cpp
===================================================================
--- trunk/src/grenade.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/grenade.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -48,10 +48,10 @@
 }
 
 void
-Grenade::update(float elapsed_time)
+Grenade::update(float delta)
 {
-  sprite.update(elapsed_time);
-  physics.update(elapsed_time);
+  sprite.update(delta);
+  physics.update(delta);
   c_object->set_pos(pos);
   c_object->set_velocity(velocity);
 }

Copied: trunk/src/lisp_getters.cpp (from rev 1116, trunk/src/windstille_getters.cpp)
===================================================================
--- trunk/src/windstille_getters.cpp	2005-11-13 03:56:04 UTC (rev 1116)
+++ trunk/src/lisp_getters.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -0,0 +1,66 @@
+/*  $Id$
+**   __      __ __             ___        __   __ __   __
+**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
+**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
+**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
+**    \__/\  / |__|___|  /\____ /____  > |__| |__|____/____/\___  >
+**         \/          \/      \/    \/                         \/
+**  Copyright (C) 2000,2005 Matthias Braun <matze at braunis.de>
+**
+**  This program is free software; you can redistribute it and/or
+**  modify it under the terms of the GNU General Public License
+**  as published by the Free Software Foundation; either version 2
+**  of the License, or (at your option) any later version.
+**
+**  This program is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU General Public License for more details.
+** 
+**  You should have received a copy of the GNU General Public License
+**  along with this program; if not, write to the Free Software
+**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+**  02111-1307, USA.
+*/
+
+#include <config.h>
+
+#include "lisp/lisp.hpp"
+#include "lisp/getters.hpp"
+#include "lisp_getters.hpp"
+#include "math/vector.hpp"
+#include "color.hpp"
+
+namespace lisp
+{
+
+bool property_get(const lisp::Lisp* lisp, Color& color)
+{
+  std::vector<float> col;
+  if(property_get(lisp, col) == false)
+    return false;
+  if(col.size() == 3)
+    color = Color(col[0], col[1], col[2]);
+  else if(col.size() == 4)
+    color = Color(col[0], col[1], col[2], col[3]);
+  else
+    return false;
+  
+  return true;
+}
+
+bool property_get(const lisp::Lisp* lisp, Vector& vec)
+{
+  size_t size = lisp->get_list_size();
+  if(size != 4 && size != 3)
+    return false;
+  if(get(lisp->get_list_elem(1), vec.x) == false)
+    return false;
+  if(get(lisp->get_list_elem(2), vec.y) == false)
+    return false;
+  return true;
+}
+
+}
+
+/* EOF */

Copied: trunk/src/lisp_getters.hpp (from rev 1116, trunk/src/windstille_getters.hpp)

Modified: trunk/src/physics.cpp
===================================================================
--- trunk/src/physics.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/physics.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -75,7 +75,7 @@
 }
 
 void
-Physics::update(float elapsed_time)
+Physics::update(float delta)
 {
   // add gravity force (TODO make it configurable per Sector)
   force += Vector(0, 9.81 * mass);
@@ -83,8 +83,8 @@
   //force -= velocity() * air_friction;
   
   Vector acceleration = force / mass;
-  velocity() += acceleration * elapsed_time;
-  pos() += velocity() * elapsed_time;
+  velocity() += acceleration * delta;
+  pos() += velocity() * delta;
 
   force = Vector(0, 0);
 }

Modified: trunk/src/physics.hpp
===================================================================
--- trunk/src/physics.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/physics.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -10,7 +10,7 @@
   Physics(Entity* entity);
   ~Physics();
 
-  void update(float elapsed_time);
+  void update(float delta);
   void register_collobj(CollisionObject& object);
 
   Vector& pos() const

Modified: trunk/src/pistol.cpp
===================================================================
--- trunk/src/pistol.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/pistol.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -16,6 +16,7 @@
 //  You should have received a copy of the GNU General Public License
 //  along with this program; if not, write to the Free Software
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
 #include <config.h>
 
 #include "laser_pointer.hpp"
@@ -42,15 +43,17 @@
 }
 
 void
-Pistol::update(float elapsed_time)
+Pistol::update(float delta)
 {
   if(laser_pointer)
-    laser_pointer->update(elapsed_time);
+    laser_pointer->update(delta);
 
-  sprite.update(elapsed_time);
+  sprite.update(delta);
 }
 
 void
 Pistol::fire(bool )
 {
 }
+
+/* EOF */

Modified: trunk/src/pistol.hpp
===================================================================
--- trunk/src/pistol.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/pistol.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -16,6 +16,7 @@
 //  You should have received a copy of the GNU General Public License
 //  along with this program; if not, write to the Free Software
 //  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
 #ifndef PISTOL_HPP
 #define PISTOL_HPP
 
@@ -37,10 +38,11 @@
   virtual ~Pistol();
   
   void draw(SceneContext& context);
-  void update(float elapsed_time);
+  void update(float delta);
 
   void fire(bool enable);
 };
 
 #endif
 
+/* EOF */

Modified: trunk/src/sprite2d/sprite.cpp
===================================================================
--- trunk/src/sprite2d/sprite.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/sprite2d/sprite.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -55,9 +55,9 @@
 }
 
 void
-Sprite::update(float elapsed_time)
+Sprite::update(float delta)
 {
-  float step = elapsed_time * speed * current_action->speed;
+  float step = delta * speed * current_action->speed;
   if(reverse)
     step = -step;
 

Modified: trunk/src/sprite2d/sprite.hpp
===================================================================
--- trunk/src/sprite2d/sprite.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/sprite2d/sprite.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -28,7 +28,7 @@
   Sprite(const sprite2d::Data* data);
   ~Sprite();
 
-  void update(float elapsed_time);
+  void update(float delta);
   void draw(const Vector& pos) const;
 
   void  set_action(const std::string& name);

Modified: trunk/src/sprite3d/sprite3d.cpp
===================================================================
--- trunk/src/sprite3d/sprite3d.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/sprite3d/sprite3d.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -274,17 +274,17 @@
 }
 
 void
-Sprite3D::update(float elapsed_time)
+Sprite3D::update(float delta)
 {   
-  float time_delta = elapsed_time * frame1.action->speed * frame1.speed;
+  float time_delta = delta * frame1.action->speed * frame1.speed;
   if(frame1.speed < 0)
     time_delta = -time_delta;
   
   while(blend_time + time_delta >= 1.0) {
-    elapsed_time -= (1.0 - blend_time) / (frame1.action->speed * frame1.speed);
+    delta -= (1.0 - blend_time) / (frame1.action->speed * frame1.speed);
     set_next_frame();
 
-    time_delta = elapsed_time * frame1.action->speed * frame1.speed;
+    time_delta = delta * frame1.action->speed * frame1.speed;
     if(frame1.speed < 0)
       time_delta = -time_delta;
     blend_time = 0.0;

Modified: trunk/src/sprite3d/sprite3d.hpp
===================================================================
--- trunk/src/sprite3d/sprite3d.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/sprite3d/sprite3d.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -52,7 +52,7 @@
   /**
    * You should call this every frame
    */
-  void update(float elapsed_time);
+  void update(float delta);
   void draw(DrawingContext& sc, const Vector& pos, float z_pos) const;
   void draw(DrawingContext& sc, const Matrix& matrix, float z_pos) const;
   

Modified: trunk/src/test_object.cpp
===================================================================
--- trunk/src/test_object.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/test_object.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -42,12 +42,12 @@
 }
 
 void
-TestObject::update(float elapsed_time)
+TestObject::update(float delta)
 {
-  sprite.update(elapsed_time);
+  sprite.update(delta);
   for(std::vector<AttachedSprite>::iterator i = attached_sprites.begin();
       i != attached_sprites.end(); ++i) {
-    i->sprite.update(elapsed_time);
+    i->sprite.update(delta);
   }
 }
 

Modified: trunk/src/test_object.hpp
===================================================================
--- trunk/src/test_object.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/test_object.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -14,7 +14,7 @@
   virtual ~TestObject();
 
   void draw(SceneContext& context);
-  void update(float elapsed_time);
+  void update(float delta);
 
   void set_sprite(const std::string& filename);
   void set_action(const std::string& action);

Modified: trunk/src/weapon.hpp
===================================================================
--- trunk/src/weapon.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/weapon.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -30,7 +30,7 @@
   {}
   
   virtual void draw(SceneContext& context) = 0;
-  virtual void update(float elapsed_time) = 0;
+  virtual void update(float delta) = 0;
 
   virtual void fire(bool enable) = 0;
 };

Deleted: trunk/src/windstille_getters.cpp
===================================================================
--- trunk/src/windstille_getters.cpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/windstille_getters.cpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -1,66 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  > |__| |__|____/____/\___  >
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2000,2005 Matthias Braun <matze at braunis.de>
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#include <config.h>
-
-#include "lisp/lisp.hpp"
-#include "lisp/getters.hpp"
-#include "windstille_getters.hpp"
-#include "math/vector.hpp"
-#include "color.hpp"
-
-namespace lisp
-{
-
-bool property_get(const lisp::Lisp* lisp, Color& color)
-{
-  std::vector<float> col;
-  if(property_get(lisp, col) == false)
-    return false;
-  if(col.size() == 3)
-    color = Color(col[0], col[1], col[2]);
-  else if(col.size() == 4)
-    color = Color(col[0], col[1], col[2], col[3]);
-  else
-    return false;
-  
-  return true;
-}
-
-bool property_get(const lisp::Lisp* lisp, Vector& vec)
-{
-  size_t size = lisp->get_list_size();
-  if(size != 4 && size != 3)
-    return false;
-  if(get(lisp->get_list_elem(1), vec.x) == false)
-    return false;
-  if(get(lisp->get_list_elem(2), vec.y) == false)
-    return false;
-  return true;
-}
-
-}
-
-/* EOF */

Deleted: trunk/src/windstille_getters.hpp
===================================================================
--- trunk/src/windstille_getters.hpp	2005-12-21 18:38:19 UTC (rev 1141)
+++ trunk/src/windstille_getters.hpp	2005-12-22 23:48:54 UTC (rev 1142)
@@ -1,42 +0,0 @@
-/*  $Id$
-**   __      __ __             ___        __   __ __   __
-**  /  \    /  \__| ____    __| _/_______/  |_|__|  | |  |   ____
-**  \   \/\/   /  |/    \  / __ |/  ___/\   __\  |  | |  | _/ __ \
-**   \        /|  |   |  \/ /_/ |\___ \  |  | |  |  |_|  |_\  ___/
-**    \__/\  / |__|___|  /\____ /____  > |__| |__|____/____/\___  >
-**         \/          \/      \/    \/                         \/
-**  Copyright (C) 2000,2005 Matthias Braun <matze at braunis.de>
-**
-**  This program is free software; you can redistribute it and/or
-**  modify it under the terms of the GNU General Public License
-**  as published by the Free Software Foundation; either version 2
-**  of the License, or (at your option) any later version.
-**
-**  This program is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU General Public License for more details.
-** 
-**  You should have received a copy of the GNU General Public License
-**  along with this program; if not, write to the Free Software
-**  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
-**  02111-1307, USA.
-*/
-
-#ifndef __WINDSTILLE_GETTERS_HPP__
-#define __WINDSTILLE_GETTERS_HPP__
-
-#include "math/vector.hpp"
-
-class Color;
-
-namespace lisp
-{
-
-bool property_get(const lisp::Lisp* lisp, Color& col);
-bool property_get(const lisp::Lisp* lisp, Vector& vec);
-
-}
-
-#endif
-



From grumbel at berlios.de  Fri Dec 23 01:04:41 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Fri, 23 Dec 2005 01:04:41 +0100
Subject: [Windstille-commit] r1143 - in trunk/src: . particles sprite2d
Message-ID: <200512230004.jBN04f6k027836@sheep.berlios.de>

Author: grumbel
Date: 2005-12-23 01:04:33 +0100 (Fri, 23 Dec 2005)
New Revision: 1143

Modified:
   trunk/src/SConscript
   trunk/src/box.cpp
   trunk/src/character.cpp
   trunk/src/elevator.cpp
   trunk/src/liquid.cpp
   trunk/src/particles/particle_system.cpp
   trunk/src/particles/spark_drawer.cpp
   trunk/src/scriptable_object.cpp
   trunk/src/sector.cpp
   trunk/src/spawnpoint.cpp
   trunk/src/sprite2d/data.cpp
   trunk/src/test_object.cpp
Log:
- just some little renaming

Modified: trunk/src/SConscript
===================================================================
--- trunk/src/SConscript	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/SConscript	2005-12-23 00:04:33 UTC (rev 1143)
@@ -85,7 +85,7 @@
 'trigger.cpp',
 'util.cpp',
 'view.cpp',
-'windstille_getters.cpp',
+'lisp_getters.cpp',
 'windstille_main.cpp',
 'badguy/badguy.cpp',
 'badguy/hedgehog.cpp',

Modified: trunk/src/box.cpp
===================================================================
--- trunk/src/box.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/box.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -22,7 +22,7 @@
 #include "globals.hpp"
 #include "lisp/lisp.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "collision/collision_engine.hpp"
 #include "math/vector.hpp"
 #include "tile_map.hpp"

Modified: trunk/src/character.cpp
===================================================================
--- trunk/src/character.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/character.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -29,7 +29,7 @@
 #include "sprite3d/manager.hpp"
 #include "lisp/properties.hpp"
 #include "util.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 
 #include <exception>
 

Modified: trunk/src/elevator.cpp
===================================================================
--- trunk/src/elevator.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/elevator.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -28,7 +28,7 @@
 #include "collision/collision_engine.hpp"
 #include "sprite2d/manager.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 
 Elevator::Elevator(const lisp::Lisp* lisp)
 {

Modified: trunk/src/liquid.cpp
===================================================================
--- trunk/src/liquid.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/liquid.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -24,7 +24,7 @@
 */
 
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "display/vertex_array_drawing_request.hpp"
 #include "random.hpp"
 #include "liquid.hpp"

Modified: trunk/src/particles/particle_system.cpp
===================================================================
--- trunk/src/particles/particle_system.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/particles/particle_system.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -25,7 +25,7 @@
 #include "color.hpp"
 #include "lisp/properties.hpp"
 #include "lisp/property_iterator.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "spark_drawer.hpp"
 #include "surface_drawer.hpp"
 #include "randomizer.hpp"

Modified: trunk/src/particles/spark_drawer.cpp
===================================================================
--- trunk/src/particles/spark_drawer.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/particles/spark_drawer.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -21,7 +21,7 @@
 #include "display/vertex_array_drawing_request.hpp"
 #include "particle_system.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "color.hpp"
 #include "spark_drawer.hpp"
 

Modified: trunk/src/scriptable_object.cpp
===================================================================
--- trunk/src/scriptable_object.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/scriptable_object.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -28,7 +28,7 @@
 #include "globals.hpp"
 #include "scriptable_object.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "sprite2d/manager.hpp"
 #include "script_manager.hpp"
 

Modified: trunk/src/sector.cpp
===================================================================
--- trunk/src/sector.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/sector.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -23,7 +23,7 @@
 #include <stdexcept>
 #include "lisp/properties.hpp"
 #include "lisp/parser.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "globals.hpp"
 #include "display/scene_context.hpp"
 #include "background_gradient.hpp"

Modified: trunk/src/spawnpoint.cpp
===================================================================
--- trunk/src/spawnpoint.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/spawnpoint.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -3,7 +3,7 @@
 #include <iostream>
 #include <stdexcept>
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 
 SpawnPoint::SpawnPoint(const lisp::Lisp* lisp)
 {

Modified: trunk/src/sprite2d/data.cpp
===================================================================
--- trunk/src/sprite2d/data.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/sprite2d/data.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -11,7 +11,7 @@
 #include "lisp/lisp.hpp"
 #include "lisp/parser.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 #include "glutil/surface.hpp"
 #include "glutil/surface_manager.hpp"
 

Modified: trunk/src/test_object.cpp
===================================================================
--- trunk/src/test_object.cpp	2005-12-22 23:48:54 UTC (rev 1142)
+++ trunk/src/test_object.cpp	2005-12-23 00:04:33 UTC (rev 1143)
@@ -3,7 +3,7 @@
 #include "test_object.hpp"
 #include "sprite3d/manager.hpp"
 #include "lisp/properties.hpp"
-#include "windstille_getters.hpp"
+#include "lisp_getters.hpp"
 
 TestObject::TestObject(const lisp::Lisp* lisp)
 {



From grumbel at berlios.de  Fri Dec 23 21:24:06 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Fri, 23 Dec 2005 21:24:06 +0100
Subject: [Windstille-commit] r1144 - in facebuilder: . data data/eye data/glasses data/hair data/hat data/head data/nose images
Message-ID: <200512232024.jBNKO6Cq008811@sheep.berlios.de>

Author: grumbel
Date: 2005-12-23 21:23:45 +0100 (Fri, 23 Dec 2005)
New Revision: 1144

Added:
   facebuilder/data/eye/0009.png
   facebuilder/data/eye/0010.png
   facebuilder/data/eye/0011.png
   facebuilder/data/eye/0012.png
   facebuilder/data/eye/0013.png
   facebuilder/data/glasses/0003.png
   facebuilder/data/glasses/0004.png
   facebuilder/data/hair/0006.png
   facebuilder/data/hair/0007.png
   facebuilder/data/hair/0008.png
   facebuilder/data/hat/0003.png
   facebuilder/data/hat/0004.png
   facebuilder/data/logo.png
   facebuilder/images/facebuilder-pirate.png
   facebuilder/images/facebuilder.png
   facebuilder/logo.xcf
Modified:
   facebuilder/README
   facebuilder/data/head/0001.png
   facebuilder/data/nose/0005.png
   facebuilder/facebuilder.rb
   facebuilder/index.html
Log:
- some more faceparts

Modified: facebuilder/README
===================================================================
--- facebuilder/README	2005-12-23 00:04:33 UTC (rev 1143)
+++ facebuilder/README	2005-12-23 20:23:45 UTC (rev 1144)
@@ -14,7 +14,7 @@
 You need Ruby and the Ruby bindings for Gtk and GnomeCanvas. Once you
 have those just run:
 
- ./facebuilder.rb
+ ruby ./facebuilder.rb
 
 
 Controls

Added: facebuilder/data/eye/0009.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0010.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0011.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0012.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0012.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0013.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0013.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0008.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0008.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hat/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hat/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hat/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hat/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/head/0001.png
===================================================================
(Binary files differ)

Added: facebuilder/data/logo.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/logo.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/nose/0005.png
===================================================================
(Binary files differ)

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-23 00:04:33 UTC (rev 1143)
+++ facebuilder/facebuilder.rb	2005-12-23 20:23:45 UTC (rev 1144)
@@ -124,7 +124,8 @@
                           "copyright" => "Copyright (C) 2005 Ingo Ruhnke <grumbel at gmx.de>",
                           # "documenters" => ["Documenter 1 <no1 at foo.bar.com>", "Documenter 2 <no2 at foo.bar.com>"],
                           "license" => File.new("COPYING").read(),
-                          "logo_icon_name" => "gtk-home",
+                          # "logo_icon_name" => "gtk-home",
+                          "logo" => Gdk::Pixbuf.new("data/logo.png"),
                           "name" => "Face Builder",
                           "version" => "0.0.1",
                           "website" => "http://windstille.berlios.de/facebuilder/",

Added: facebuilder/images/facebuilder-pirate.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/facebuilder-pirate.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/images/facebuilder.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/facebuilder.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/index.html
===================================================================
--- facebuilder/index.html	2005-12-23 00:04:33 UTC (rev 1143)
+++ facebuilder/index.html	2005-12-23 20:23:45 UTC (rev 1144)
@@ -1,7 +1,7 @@
 <html>
   <head></head>
   <body>
-    <h1>Face Builder</h1>
+    <h1><img src="images/facebuilder.png" alt="Face Builder"/></h1>
 
     <p>
       FaceBuilder is a little toy application that lets you construct
@@ -25,8 +25,13 @@
     <a href="images/screenshot-0.0.1-2.png"><img src="images/screenshot-0.0.1-2_thumb.jpg" /></a>
     
     <h2>Download</h2>
+    <ul>
+      <li><a href="http://pingus.seul.org/~grumbel/tmp/facebuilder-0.0.1.tar.gz">facebuilder-0.0.1.tar.gz</a></li>
+    </ul>
+
+      <p>SVN Version is available at:</p>
     <p>
-      
+      <tt>svn checkout svn://svn.berlios.de/windstille/facebuilder</tt>
     </p>
     
     <hr>

Added: facebuilder/logo.xcf
===================================================================
(Binary files differ)


Property changes on: facebuilder/logo.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sat Dec 24 01:01:56 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 01:01:56 +0100
Subject: [Windstille-commit] r1145 - in facebuilder: . data data/eye data/eyebrow data/forehead data/hair data/mouthfold
Message-ID: <200512240001.jBO01uvs015456@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 01:01:02 +0100 (Sat, 24 Dec 2005)
New Revision: 1145

Added:
   facebuilder/AUTHORS
   facebuilder/data/eye/0014.png
   facebuilder/data/eyebrow/0004.png
   facebuilder/data/forehead/
   facebuilder/data/forehead/0000.png
   facebuilder/data/forehead/0001.png
   facebuilder/data/mouthfold/
   facebuilder/data/mouthfold/0000.png
   facebuilder/data/mouthfold/0001.png
Modified:
   facebuilder/data/hair/0002.png
   facebuilder/data/hair/0005.png
   facebuilder/face.rb
   facebuilder/facebuilder.rb
   facebuilder/index.html
Log:
- added some mouse control
- some more graphics


Added: facebuilder/AUTHORS
===================================================================
--- facebuilder/AUTHORS	2005-12-23 20:23:45 UTC (rev 1144)
+++ facebuilder/AUTHORS	2005-12-24 00:01:02 UTC (rev 1145)
@@ -0,0 +1 @@
+Ingo Ruhnke <grumbel at gmx.de>

Added: facebuilder/data/eye/0014.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0014.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0004.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0004.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/forehead/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/forehead/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/forehead/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/forehead/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/hair/0002.png
===================================================================
(Binary files differ)

Modified: facebuilder/data/hair/0005.png
===================================================================
(Binary files differ)

Added: facebuilder/data/mouthfold/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouthfold/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouthfold/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouthfold/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-23 20:23:45 UTC (rev 1144)
+++ facebuilder/face.rb	2005-12-24 00:01:02 UTC (rev 1145)
@@ -4,6 +4,42 @@
 class FacePart
   attr_reader :type, :offset, :filename, :canvas_items, :scale, :rotation
   
+  def item_event(item, event)
+    case event.event_type
+    when Gdk::Event::BUTTON_PRESS
+      case event.button
+      when 1
+        # Record the click position in item-space
+        @x, @y = item.parent.w2i(event.x, event.y)
+
+        # Record the item position before the drag
+        @old_offset = @offset.clone()
+
+        fleur = Gdk::Cursor.new(Gdk::Cursor::FLEUR)
+        item.grab(Gdk::Event::POINTER_MOTION_MASK | Gdk::Event::BUTTON_RELEASE_MASK,
+                  fleur,
+                  event.time)
+        
+        @dragging = true
+
+        $facebuilder.set_current_part(@type)
+      end
+
+    when Gdk::Event::MOTION_NOTIFY
+      item_x, item_y = item.parent.w2i(event.x, event.y)
+      if @dragging && (event.state & Gdk::Window::BUTTON1_MASK == Gdk::Window::BUTTON1_MASK)
+        # Calculate the new position
+        @offset.x = @old_offset.x + item_x - @x
+        @offset.y = @old_offset.y + item_y - @y       
+        update_items()
+      end
+
+    when Gdk::Event::BUTTON_RELEASE
+      item.ungrab(event.time)
+      @dragging = false;
+    end
+  end
+
   def initialize(root, type, filename, offset)
     @type     = type
     @offset   = offset
@@ -26,8 +62,12 @@
                                              :height => im.height,
                                              :anchor => Gtk::ANCHOR_CENTER)
 
+    @canvas_items.last.signal_connect("event") { |item, event|
+      item_event(item, event)
+    }
+
     case @type
-    when :eye, :ear, :eyebrow
+    when :eye, :ear, :eyebrow, :mouthfold
       @canvas_items << Gnome::CanvasPixbuf.new(root,
                                                :pixbuf => im,
                                                :x => 0, # offset.x,
@@ -147,11 +187,13 @@
     @root = root
     @parts  = {
       :head    => FacePart.new(root, :head,    "data/head/0000.png",    Point.new(0, 0)),
+      :forehead    => FacePart.new(root, :forehead,    "data/forehead/0000.png",    Point.new(0, -75)),
       :eye     => FacePart.new(root, :eye,     "data/eye/0000.png",     Point.new(35, -10)),
       :eyebrow => FacePart.new(root, :eyebrow, "data/eyebrow/0000.png", Point.new(45, -30)),
       :ear     => FacePart.new(root, :ear,     "data/ear/0000.png",     Point.new(90, 0)),
       :nose    => FacePart.new(root, :nose,    "data/nose/0000.png",    Point.new(0, 30)),
       :mouth   => FacePart.new(root, :mouth,   "data/mouth/0000.png",   Point.new(0, 75)),
+      :mouthfold => FacePart.new(root, :mouthfold,   "data/mouthfold/0000.png",   Point.new(40, 75)),
       :beard   => FacePart.new(root, :beard,   "data/beard/0000.png",   Point.new(0, 75)),
       :glasses => FacePart.new(root, :glasses, "data/glasses/0000.png", Point.new(0, -10)),
       :hair    => FacePart.new(root, :hair,    "data/hair/0000.png",    Point.new(0, -20)),

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-23 20:23:45 UTC (rev 1144)
+++ facebuilder/facebuilder.rb	2005-12-24 00:01:02 UTC (rev 1145)
@@ -118,8 +118,8 @@
 #     }
 
     Gtk::AboutDialog.show(nil,
-                          "artists" => ["Ingo Ruhnke <grumbel at gmx.de>"],
-                          "authors" => ["Ingo Ruhnke <grumbel at gmx.de>"],
+                          # "artists" => File.new("AUTHORS").readlines(),
+                          "authors" => File.new("AUTHORS").readlines(),
                           "comments" => "A simple tool to construct faces",
                           "copyright" => "Copyright (C) 2005 Ingo Ruhnke <grumbel at gmx.de>",
                           # "documenters" => ["Documenter 1 <no1 at foo.bar.com>", "Documenter 2 <no2 at foo.bar.com>"],
@@ -207,6 +207,7 @@
     @face = Face.new(@canvas.root)
     
     setup_controls(@canvas.root, Point.new(0, -200),  :hat)
+    setup_controls(@canvas.root, Point.new(-200, -140),   :forehead)
     setup_controls(@canvas.root, Point.new(0, 200),   :head)
     setup_controls(@canvas.root, Point.new(200, -140), :hair)
 
@@ -216,8 +217,20 @@
     setup_controls(@canvas.root, Point.new(200, 0),   :eye)
     setup_controls(@canvas.root, Point.new(200, 40),  :nose)
     setup_controls(@canvas.root, Point.new(200, 80),  :mouth)
+    setup_controls(@canvas.root, Point.new(-200, 80),  :mouthfold)
 
-    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :beard, :nose, :head, :hair, :hat]
+    Gnome::CanvasText.new(@canvas.root,
+                          {:text => 
+                            "PgUp, PgDown:\tscale\n" +
+                            "Home, End:\t\trotate\n" +
+                            "Cursorkeys:\t\tmove\n",
+                            :x => -180,
+                            :y => 180,
+                            :font => "Sans 10",
+                            :anchor => Gtk::ANCHOR_N,
+                            :fill_color => "black"})
+
+    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :mouthfold, :beard, :nose, :head, :forehead, :hair, :hat]
     @current_part = 0
 
     @canvas.signal_connect("key-press-event") { |widget, event|
@@ -299,7 +312,8 @@
       super()
       set_title("Face Builder")
       signal_connect("delete_event") { |i,a| Gtk::main_quit }
-      add(FaceBuilder.new(self))
+      $facebuilder = FaceBuilder.new(self)
+      add($facebuilder)
       set_default_size(512, 512)
       # set_resizable(false)
       show()

Modified: facebuilder/index.html
===================================================================
--- facebuilder/index.html	2005-12-23 20:23:45 UTC (rev 1144)
+++ facebuilder/index.html	2005-12-24 00:01:02 UTC (rev 1145)
@@ -1,6 +1,11 @@
 <html>
-  <head></head>
+  <head>
+    <link href="default.css" rel="stylesheet" type="text/css" />
+    <title>FaceBuilder</title>
+  </head>
+
   <body>
+    <div class="body">
     <h1><img src="images/facebuilder.png" alt="Face Builder"/></h1>
 
     <p>
@@ -33,8 +38,11 @@
     <p>
       <tt>svn checkout svn://svn.berlios.de/windstille/facebuilder</tt>
     </p>
-    
-    <hr>
-      Copyright &copy; 2005 <a href="http://pingus.seul.org/~grumbel/">Ingo Ruhnke</a>, <a href="mailto:grumbel at gmx.de?subject=[Windstille] ">&lt;grumbel at gmx.de&gt;</a>
+    </div>
+      <div class="copyright">
+      Copyright &copy; 2005 <a href="http://pingus.seul.org/~grumbel/">Ingo Ruhnke</a>, 
+      <a href="mailto:grumbel at gmx.de?subject=[Windstille] ">&lt;grumbel at gmx.de&gt;</a>
+    </div>
+
   </body>
 </html>
\ No newline at end of file



From grumbel at berlios.de  Sat Dec 24 01:55:16 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 01:55:16 +0100
Subject: [Windstille-commit] r1146 - in facebuilder: . data/mouth examples
Message-ID: <200512240055.jBO0tGOW001647@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 01:55:00 +0100 (Sat, 24 Dec 2005)
New Revision: 1146

Added:
   facebuilder/NEWS
   facebuilder/data/mouth/0006.png
   facebuilder/data/mouth/0007.png
   facebuilder/default.css
   facebuilder/examples/pirate.xml
   facebuilder/examples/women3.xml
   facebuilder/eyes.xcf
   facebuilder/face.xcf
Modified:
   facebuilder/
   facebuilder/TODO
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- added a quick-hack listbox


Property changes on: facebuilder
___________________________________________________________________
Name: svn:ignore
   + semantic.cache


Added: facebuilder/NEWS
===================================================================
--- facebuilder/NEWS	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/NEWS	2005-12-24 00:55:00 UTC (rev 1146)
@@ -0,0 +1,13 @@
+ ,----------------------
+| FaceBuilder News
++--------------
+
+FaceBuilder 0.1.0
+=================
+
+* face parts are moveable with the mouse
+* plenty of more faceparts
+* faceparts are now all shaded
+
+
+# EOF #

Modified: facebuilder/TODO
===================================================================
--- facebuilder/TODO	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/TODO	2005-12-24 00:55:00 UTC (rev 1146)
@@ -9,5 +9,6 @@
   center of, hair relative to the center of the face, etc) so that
   they are easier swapable without size and position adjustments
 * support for different sets, male/female, comic, realistic, etc
+* create a context-menu to center-x, center-y and similar stuff
 
 # EOF #

Added: facebuilder/data/mouth/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/default.css
===================================================================
--- facebuilder/default.css	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/default.css	2005-12-24 00:55:00 UTC (rev 1146)
@@ -0,0 +1,30 @@
+body {
+  margin-left:  5em;
+  margin-right: 5em;
+ margin: 1em 5em 3em 5em;
+  background-color: rgb(100, 150, 200);
+}
+
+div.body {
+  background-color: white;
+  padding: 0.5em 1em 2em 1em;
+  margin-bottom: 1em;
+  border-color: rgb(120, 180, 220);
+  border-style: solid;
+  border-width: 0.5em;
+}
+
+div.copyright {
+  text-align: right;
+  padding: 0.5em 1em 0.5em 1em;
+  background-color: white;
+  border-width: 0.5em;
+  border-style: solid;
+  border-color: rgb(120, 180, 220);
+}
+
+h1 {
+  text-align: center;
+}
+
+/* EOF */

Added: facebuilder/examples/pirate.xml
===================================================================
--- facebuilder/examples/pirate.xml	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/examples/pirate.xml	2005-12-24 00:55:00 UTC (rev 1146)
@@ -0,0 +1,62 @@
+<face>
+  <head>
+    <filename>data/head/0002.png</filename>
+    <offset><x>0.0</x><y>-5.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>0.0</x><y>73.0</y></offset>
+    <scale>0.480610931717894</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0008.png</filename>
+    <offset><x>1.0</x><y>-9.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90.0</x><y>0.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <glasses>
+    <filename>data/glasses/0004.png</filename>
+    <offset><x>-5.0</x><y>-11.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0.0</x><y>75.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>37.0</x><y>-25.0</y></offset>
+    <scale>1.0404</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <eye>
+    <filename>data/eye/0006.png</filename>
+    <offset><x>34.0</x><y>-4.0</y></offset>
+    <scale>0.743014729988519</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <hat>
+    <filename>data/hat/0003.png</filename>
+    <offset><x>-1.0</x><y>-75.0</y></offset>
+    <scale>1.17165938100227</scale>
+    <rotation>0.0</rotation>
+  </hat>
+  <nose>
+    <filename>data/nose/0003.png</filename>
+    <offset><x>0.0</x><y>28.0</y></offset>
+    <scale>1.08243216</scale>
+    <rotation>0.0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/women3.xml
===================================================================
--- facebuilder/examples/women3.xml	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/examples/women3.xml	2005-12-24 00:55:00 UTC (rev 1146)
@@ -0,0 +1,74 @@
+<face>
+  <forehead>
+    <filename>data/forehead/0001.png</filename>
+    <offset><x>-1</x><y>-51</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0</rotation>
+  </forehead>
+  <nose>
+    <filename>data/nose/0005.png</filename>
+    <offset><x>1</x><y>28</y></offset>
+    <scale>0.870560178613914</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0001.png</filename>
+    <offset><x>0</x><y>-9</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0007.png</filename>
+    <offset><x>0</x><y>78</y></offset>
+    <scale>0.942322334547044</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0003.png</filename>
+    <offset><x>2</x><y>3</y></offset>
+    <scale>0.942322334547044</scale>
+    <rotation>0</rotation>
+  </hair>
+  <mouthfold>
+    <filename>data/mouthfold/0001.png</filename>
+    <offset><x>35</x><y>69</y></offset>
+    <scale>0.980392156862745</scale>
+    <rotation>0</rotation>
+  </mouthfold>
+  <glasses>
+    <filename>data/glasses/0003.png</filename>
+    <offset><x>1</x><y>22</y></offset>
+    <scale>0.870560178613914</scale>
+    <rotation>0</rotation>
+  </glasses>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0000.png</filename>
+    <offset><x>40</x><y>-24</y></offset>
+    <scale>0.804263039093289</scale>
+    <rotation>1.0</rotation>
+  </eyebrow>
+  <hat>
+    <filename>data/hat/0002.png</filename>
+    <offset><x>2</x><y>-54</y></offset>
+    <scale>1.02</scale>
+    <rotation>0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0014.png</filename>
+    <offset><x>30</x><y>-1</y></offset>
+    <scale>0.646839036051574</scale>
+    <rotation>0.0</rotation>
+  </eye>
+</face>

Added: facebuilder/eyes.xcf
===================================================================
(Binary files differ)


Property changes on: facebuilder/eyes.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/face.rb	2005-12-24 00:55:00 UTC (rev 1146)
@@ -29,8 +29,14 @@
       item_x, item_y = item.parent.w2i(event.x, event.y)
       if @dragging && (event.state & Gdk::Window::BUTTON1_MASK == Gdk::Window::BUTTON1_MASK)
         # Calculate the new position
-        @offset.x = @old_offset.x + item_x - @x
+
+        if event.state & Gdk::Window::SHIFT_MASK == Gdk::Window::SHIFT_MASK
+          @offset.x = @old_offset.x
+        else
+          @offset.x = @old_offset.x + item_x - @x
+        end
         @offset.y = @old_offset.y + item_y - @y       
+
         update_items()
       end
 

Added: facebuilder/face.xcf
===================================================================
(Binary files differ)


Property changes on: facebuilder/face.xcf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-24 00:01:02 UTC (rev 1145)
+++ facebuilder/facebuilder.rb	2005-12-24 00:55:00 UTC (rev 1146)
@@ -1,6 +1,7 @@
 #!/usr/bin/env ruby
 
 require "gnomecanvas2"
+require "gtk2"
 require "face.rb"
 
 Point = Struct.new("Point", :x, :y)
@@ -172,20 +173,36 @@
   def set_current_part(type)
     @parts.each_with_index() { |p, i|
       if type == p then
-        @current_part = i
+        if @current_part != i
+          @treeview.columns[0].title = type.to_s.capitalize
+                                                          
+          @list.clear()
+          Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
+            iter = @list.append()
+            pixbuf = Gdk::Pixbuf.new("data/#{type}/#{v}")
+            # Add keep of aspect ratio
+            iter[0] = pixbuf.scale(64, 64)
+          }
+
+          @current_part = i
+        end       
       end
     }
+
+    
   end
 
   def initialize(window)
     super()
 
     @window = window
-
+    
     @box = Gtk::EventBox.new
     @menu = setup_menu()
     pack_start(@menu, false, false, 0)
-    pack_start(@box)
+    @hbox = Gtk::HBox.new()
+    pack_start(@hbox)
+    @hbox.pack_start(@box)
 
     @label = Gtk::Label.new
     @label.show
@@ -193,8 +210,25 @@
     set_border_width(@pad = 2)
     set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
     @canvas = Gnome::Canvas.new(true)
+    @box.border_width = 5
     @box.add(@canvas)
     
+    @list = Gtk::ListStore.new(Gdk::Pixbuf)
+    
+    [Gdk::Pixbuf.new("data/eye/0012.png"), 
+     Gdk::Pixbuf.new("data/eye/0010.png")].each {|v|
+      iter = @list.append()
+      iter[0] = v.scale(64, 64)
+      # puts iter
+    }
+
+    @treeview = Gtk::TreeView.new(@list)
+    @treeview.append_column(Gtk::TreeViewColumn.new("Pictures",
+                                                    Gtk::CellRendererPixbuf.new, {:pixbuf => 0}))
+    @treeview.selection.set_mode(Gtk::SELECTION_SINGLE)
+    # scrolled_win.add_with_viewport(treeview)
+
+    @hbox.pack_start(@treeview, false)
     @canvas.signal_connect("button-press-event") { |item,event|
       # Some throuble with alpha
       # puts "Bla: ", @canvas.get_item_at(event.x, event.y)
@@ -236,6 +270,9 @@
     @canvas.signal_connect("key-press-event") { |widget, event|
       part = @face.get_part(@parts[@current_part])
       case event.keyval
+      when Gdk::Keyval::GDK_c
+        part.offset = Point.new(0, part.offset.y) if part
+
       when Gdk::Keyval::GDK_e
         @current_part -= 1
         if @current_part < 0 then
@@ -298,8 +335,10 @@
     signal_connect_after('hide') {|w,e| }
 
     @canvas.show()
+    @treeview.show()
     @menu.show()
     @box.show()
+    @hbox.show()
     show()
   end
 end
@@ -314,7 +353,7 @@
       signal_connect("delete_event") { |i,a| Gtk::main_quit }
       $facebuilder = FaceBuilder.new(self)
       add($facebuilder)
-      set_default_size(512, 512)
+      set_default_size(640, 512)
       # set_resizable(false)
       show()
     end



From grumbel at berlios.de  Sat Dec 24 14:02:18 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 14:02:18 +0100
Subject: [Windstille-commit] r1147 - facebuilder
Message-ID: <200512241302.jBOD2ISD009347@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 14:02:07 +0100 (Sat, 24 Dec 2005)
New Revision: 1147

Modified:
   facebuilder/facebuilder.rb
   facebuilder/index.html
Log:
- made the listview clickable

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-24 00:55:00 UTC (rev 1146)
+++ facebuilder/facebuilder.rb	2005-12-24 13:02:07 UTC (rev 1147)
@@ -178,10 +178,23 @@
                                                           
           @list.clear()
           Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
+            filename = "data/#{type}/#{v}"
             iter = @list.append()
-            pixbuf = Gdk::Pixbuf.new("data/#{type}/#{v}")
+            pixbuf = Gdk::Pixbuf.new(filename)
+
+            # scale, while keeping aspect
+            if pixbuf.width > 64 or pixbuf.height > 64 then # need scaling, since larger then 64x64
+              aspect = pixbuf.width.to_f / pixbuf.height
+              if pixbuf.width > pixbuf.height then
+                pixbuf = pixbuf.scale(64, 64 / aspect)
+              else
+                pixbuf = pixbuf.scale(64 * aspect, 64)
+              end
+            end
+
             # Add keep of aspect ratio
-            iter[0] = pixbuf.scale(64, 64)
+            iter[0] = pixbuf
+            iter[1] = filename
           }
 
           @current_part = i
@@ -200,7 +213,7 @@
     @box = Gtk::EventBox.new
     @menu = setup_menu()
     pack_start(@menu, false, false, 0)
-    @hbox = Gtk::HBox.new()
+    @hbox = Gtk::HBox.new(false, 5)
     pack_start(@hbox)
     @hbox.pack_start(@box)
 
@@ -210,25 +223,45 @@
     set_border_width(@pad = 2)
     set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
     @canvas = Gnome::Canvas.new(true)
-    @box.border_width = 5
+    # @box.border_width = 5
     @box.add(@canvas)
     
-    @list = Gtk::ListStore.new(Gdk::Pixbuf)
+    @list = Gtk::ListStore.new(Gdk::Pixbuf, String)
     
     [Gdk::Pixbuf.new("data/eye/0012.png"), 
      Gdk::Pixbuf.new("data/eye/0010.png")].each {|v|
       iter = @list.append()
+      puts "iter: #{iter.inspect}"
       iter[0] = v.scale(64, 64)
+      iter[1] = ""
       # puts iter
     }
 
+    @scrolled_win = Gtk::ScrolledWindow.new
+    @scrolled_win.set_policy(Gtk::POLICY_AUTOMATIC,Gtk::POLICY_AUTOMATIC)
+    # @scrolled_win.width = 64
+
     @treeview = Gtk::TreeView.new(@list)
-    @treeview.append_column(Gtk::TreeViewColumn.new("Pictures",
-                                                    Gtk::CellRendererPixbuf.new, {:pixbuf => 0}))
+    @treeview.headers_visible = false
+    @treeview.append_column(Gtk::TreeViewColumn.new("Stuff",
+                                                    Gtk::CellRendererPixbuf.new, 
+                                                    {:pixbuf => 0}))
     @treeview.selection.set_mode(Gtk::SELECTION_SINGLE)
     # scrolled_win.add_with_viewport(treeview)
+    
+    @treeview.signal_connect("cursor-changed") { |treeview|
+      row, column = treeview.cursor()
+      puts @list.methods()
 
-    @hbox.pack_start(@treeview, false)
+      puts "Selected something #{@list.get_value(@list.get_iter(row), 1)}"
+      filename = @list.get_value(@list.get_iter(row), 1)
+      @face.get_part(@parts[@current_part]).filename = filename
+    }
+    
+    @scrolled_win.set_size_request(96,64)
+    @hbox.pack_end(@scrolled_win, false, false, 0)
+    @scrolled_win.add_with_viewport(@treeview)
+
     @canvas.signal_connect("button-press-event") { |item,event|
       # Some throuble with alpha
       # puts "Bla: ", @canvas.get_item_at(event.x, event.y)
@@ -335,6 +368,7 @@
     signal_connect_after('hide') {|w,e| }
 
     @canvas.show()
+    @scrolled_win.show()
     @treeview.show()
     @menu.show()
     @box.show()

Modified: facebuilder/index.html
===================================================================
--- facebuilder/index.html	2005-12-24 00:55:00 UTC (rev 1146)
+++ facebuilder/index.html	2005-12-24 13:02:07 UTC (rev 1147)
@@ -6,40 +6,52 @@
 
   <body>
     <div class="body">
-    <h1><img src="images/facebuilder.png" alt="Face Builder"/></h1>
+      <h1><img src="images/facebuilder.png" alt="Face Builder"/></h1>
 
-    <p>
-      FaceBuilder is a little toy application that lets you construct
-      faces by putting together eyes, nose, mouth, head, hair and some
-      additional items. You can also move, scale and rotate each of
-      those face-parts as you like. The results can be saved to XML
-      files. FaceBuilder currently provides ~50 faceparts in total.
-    </p>
+      <p>
+        FaceBuilder is a little toy application that lets you construct
+        faces by putting together eyes, nose, mouth, head, hair and some
+        additional items. You can also move, scale and rotate each of
+        those face-parts as you like. The results can be saved to XML
+        files. FaceBuilder currently provides ~50 faceparts in total.
+      </p>
 
-    <h2>Controls</h2>
-    <pre>
-      PgUp, PgDown: scale facepart
-      Home, End:    rotate facepart
-      Cursorkeys:   move facepart
+      <h2>Controls</h2>
+      <pre>
+        PgUp, PgDown: scale facepart
+        Home, End:    rotate facepart
+        Cursorkeys:   move facepart
 
-      The face parts itself can be selected via the GUI
-    </pre>
+        The face parts itself can be selected via the GUI
+      </pre>
 
-    <h2>Screenshots</h2>
-    <a href="images/screenshot-0.0.1-1.png"><img src="images/screenshot-0.0.1-1_thumb.jpg" /></a>
-    <a href="images/screenshot-0.0.1-2.png"><img src="images/screenshot-0.0.1-2_thumb.jpg" /></a>
-    
-    <h2>Download</h2>
-    <ul>
-      <li><a href="http://pingus.seul.org/~grumbel/tmp/facebuilder-0.0.1.tar.gz">facebuilder-0.0.1.tar.gz</a></li>
-    </ul>
+      <h2>Screenshots</h2>
+      <a href="images/screenshot-0.0.1-1.png"><img src="images/screenshot-0.0.1-1_thumb.jpg" /></a>
+      <a href="images/screenshot-0.0.1-2.png"><img src="images/screenshot-0.0.1-2_thumb.jpg" /></a>
+      
+      <h2>Download</h2>
+      <h3>Ruby/Gtk</h3>
+      <ul>
+        <li><a href="http://pingus.seul.org/~grumbel/tmp/facebuilder-0.0.1.tar.gz">facebuilder-0.0.1.tar.gz</a></li>
+      </ul>
 
       <p>SVN Version is available at:</p>
-    <p>
-      <tt>svn checkout svn://svn.berlios.de/windstille/facebuilder</tt>
-    </p>
+      <p>
+        <tt>svn checkout svn://svn.berlios.de/windstille/facebuilder</tt>
+      </p>
+
+      <h3>Javascript/DOM port</h3>
+      <p>
+        There is also a Javascript/DOM port of FaceBuilder, might lack
+        some features and be a bit slow, but works in a browser, its
+        available at:
+      </p>
+      <ul>
+        <li><a href="http://proj.phk.at/fb/">FaceBuilder Javascript/DOM port</a></li>
+      </ul>
+
     </div>
-      <div class="copyright">
+    <div class="copyright">
       Copyright &copy; 2005 <a href="http://pingus.seul.org/~grumbel/">Ingo Ruhnke</a>, 
       <a href="mailto:grumbel at gmx.de?subject=[Windstille] ">&lt;grumbel at gmx.de&gt;</a>
     </div>



From grumbel at berlios.de  Sat Dec 24 16:38:47 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 16:38:47 +0100
Subject: [Windstille-commit] r1148 - in facebuilder: . data/hair data/head
Message-ID: <200512241538.jBOFclYV026694@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 16:38:38 +0100 (Sat, 24 Dec 2005)
New Revision: 1148

Added:
   facebuilder/data/hair/0009.png
   facebuilder/data/hair/0010.png
Modified:
   facebuilder/data/hair/0001.png
   facebuilder/data/head/0000.png
   facebuilder/data/head/0003.png
   facebuilder/data/head/0005.png
   facebuilder/facebuilder.rb
Log:
- some more air and shaded heads

Modified: facebuilder/data/hair/0001.png
===================================================================
(Binary files differ)

Added: facebuilder/data/hair/0009.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0010.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/head/0000.png
===================================================================
(Binary files differ)

Modified: facebuilder/data/head/0003.png
===================================================================
(Binary files differ)

Modified: facebuilder/data/head/0005.png
===================================================================
(Binary files differ)

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-24 13:02:07 UTC (rev 1147)
+++ facebuilder/facebuilder.rb	2005-12-24 15:38:38 UTC (rev 1148)
@@ -228,15 +228,6 @@
     
     @list = Gtk::ListStore.new(Gdk::Pixbuf, String)
     
-    [Gdk::Pixbuf.new("data/eye/0012.png"), 
-     Gdk::Pixbuf.new("data/eye/0010.png")].each {|v|
-      iter = @list.append()
-      puts "iter: #{iter.inspect}"
-      iter[0] = v.scale(64, 64)
-      iter[1] = ""
-      # puts iter
-    }
-
     @scrolled_win = Gtk::ScrolledWindow.new
     @scrolled_win.set_policy(Gtk::POLICY_AUTOMATIC,Gtk::POLICY_AUTOMATIC)
     # @scrolled_win.width = 64



From grumbel at berlios.de  Sat Dec 24 17:45:53 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 17:45:53 +0100
Subject: [Windstille-commit] r1149 - facebuilder/data/hair
Message-ID: <200512241645.jBOGjr9G001762@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 17:45:52 +0100 (Sat, 24 Dec 2005)
New Revision: 1149

Added:
   facebuilder/data/hair/0011.png
Log:
- some more hair

Added: facebuilder/data/hair/0011.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sat Dec 24 17:55:17 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 17:55:17 +0100
Subject: [Windstille-commit] r1150 - facebuilder/data/hair
Message-ID: <200512241655.jBOGtH1e002422@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 17:55:15 +0100 (Sat, 24 Dec 2005)
New Revision: 1150

Added:
   facebuilder/data/hair/0012.png
Log:
- some more hair

Added: facebuilder/data/hair/0012.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0012.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sat Dec 24 21:41:30 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 21:41:30 +0100
Subject: [Windstille-commit] r1151 - in facebuilder/data: eye glasses hair nose
Message-ID: <200512242041.jBOKfUvV015381@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 21:41:19 +0100 (Sat, 24 Dec 2005)
New Revision: 1151

Added:
   facebuilder/data/eye/0015.png
   facebuilder/data/glasses/0005.png
   facebuilder/data/hair/0013.png
   facebuilder/data/hair/0014.png
   facebuilder/data/hair/0015.png
   facebuilder/data/hair/0016.png
   facebuilder/data/hair/0017.png
   facebuilder/data/hair/0018.png
   facebuilder/data/nose/0006.png
Log:
- some more hair

Added: facebuilder/data/eye/0015.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0015.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0013.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0013.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0014.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0014.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0015.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0015.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0016.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0016.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0017.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0017.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0018.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0018.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sat Dec 24 22:26:21 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 24 Dec 2005 22:26:21 +0100
Subject: [Windstille-commit] r1152 - facebuilder/data/hair
Message-ID: <200512242126.jBOLQLXx018191@sheep.berlios.de>

Author: grumbel
Date: 2005-12-24 22:26:18 +0100 (Sat, 24 Dec 2005)
New Revision: 1152

Added:
   facebuilder/data/hair/0020.png
   facebuilder/data/hair/0021.png
Log:
- some more hair

Added: facebuilder/data/hair/0020.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0020.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0021.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0021.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sun Dec 25 00:28:37 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 00:28:37 +0100
Subject: [Windstille-commit] r1153 - in facebuilder: . data/eye data/glasses data/hair data/nose
Message-ID: <200512242328.jBONSbfn026629@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 00:28:32 +0100 (Sun, 25 Dec 2005)
New Revision: 1153

Added:
   facebuilder/data/glasses/0006.png
   facebuilder/data/glasses/0007.png
   facebuilder/data/glasses/0008.png
   facebuilder/data/glasses/0009.png
   facebuilder/data/hair/0022.png
Modified:
   facebuilder/data/eye/0004.png
   facebuilder/data/hair/0015.png
   facebuilder/data/nose/0000.png
   facebuilder/facebuilder.rb
Log:
- some more hair

Modified: facebuilder/data/eye/0004.png
===================================================================
(Binary files differ)

Added: facebuilder/data/glasses/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0008.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0008.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/glasses/0009.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/hair/0015.png
===================================================================
(Binary files differ)

Added: facebuilder/data/hair/0022.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0022.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/nose/0000.png
===================================================================
(Binary files differ)

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-24 21:26:18 UTC (rev 1152)
+++ facebuilder/facebuilder.rb	2005-12-24 23:28:32 UTC (rev 1153)
@@ -100,6 +100,8 @@
         '<Item>', '<control>S', nil, method(:save_file)],
        ['/File/Quit',
         '<Item>', '<control>Q', nil, method(:quit)],
+       ['/View/Hide Controls', 
+        '<Item>', nil, nil, nil],
        ['/Help/About',
         '<Item>', nil, nil, method(:about_dialog)]
       ]



From grumbel at berlios.de  Sun Dec 25 00:47:16 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 00:47:16 +0100
Subject: [Windstille-commit] r1154 - in facebuilder/data: glasses hair
Message-ID: <200512242347.jBONlGi9012570@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 00:47:14 +0100 (Sun, 25 Dec 2005)
New Revision: 1154

Added:
   facebuilder/data/glasses/0010.png
   facebuilder/data/hair/0023.png
Log:
- some more hair

Added: facebuilder/data/glasses/0010.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0023.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0023.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sun Dec 25 01:09:30 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 01:09:30 +0100
Subject: [Windstille-commit] r1155 - in facebuilder/data: glasses hair
Message-ID: <200512250009.jBP09UAe022481@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 01:09:25 +0100 (Sun, 25 Dec 2005)
New Revision: 1155

Added:
   facebuilder/data/glasses/0011.png
   facebuilder/data/hair/0024.png
Modified:
   facebuilder/data/glasses/0010.png
Log:
- some more hair

Modified: facebuilder/data/glasses/0010.png
===================================================================
(Binary files differ)

Added: facebuilder/data/glasses/0011.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/glasses/0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0024.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0024.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sun Dec 25 01:36:26 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 01:36:26 +0100
Subject: [Windstille-commit] r1156 - facebuilder/data/hair
Message-ID: <200512250036.jBP0aQta000818@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 01:36:21 +0100 (Sun, 25 Dec 2005)
New Revision: 1156

Added:
   facebuilder/data/hair/0025.png
Log:
- some more hair

Added: facebuilder/data/hair/0025.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0025.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sun Dec 25 18:02:48 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 18:02:48 +0100
Subject: [Windstille-commit] r1157 - in facebuilder: . examples
Message-ID: <200512251702.jBPH2mkj004080@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 18:02:47 +0100 (Sun, 25 Dec 2005)
New Revision: 1157

Added:
   facebuilder/examples/women4.xml
   facebuilder/examples/women5.xml
   facebuilder/examples/women6.xml
   facebuilder/examples/women7.xml
   facebuilder/facebuilder-old.rb
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.gladep
   facebuilder/facebuilder.rb
Removed:
   facebuilder/facebuilder.rb
Modified:
   facebuilder/index.html
Log:
- gnomeified the app a bit

Added: facebuilder/examples/women4.xml
===================================================================
--- facebuilder/examples/women4.xml	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/examples/women4.xml	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,74 @@
+<face>
+  <hair>
+    <filename>data/hair/0014.png</filename>
+    <offset><x>-3.0</x><y>-5.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hair>
+  <mouthfold>
+    <filename>data/mouthfold/0000.png</filename>
+    <offset><x>40</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </mouthfold>
+  <glasses>
+    <filename>data/glasses/0001.png</filename>
+    <offset><x>1.0</x><y>-4.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </glasses>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>45</x><y>-30</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eyebrow>
+  <hat>
+    <filename>data/hat/0004.png</filename>
+    <offset><x>-32.0</x><y>-15.0</y></offset>
+    <scale>1.17165938100227</scale>
+    <rotation>0.0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0015.png</filename>
+    <offset><x>34.0</x><y>-7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eye>
+  <forehead>
+    <filename>data/forehead/0000.png</filename>
+    <offset><x>0</x><y>-75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </forehead>
+  <nose>
+    <filename>data/nose/0005.png</filename>
+    <offset><x>1.0</x><y>26.0</y></offset>
+    <scale>0.836755265872658</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0000.png</filename>
+    <offset><x>0</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0</rotation>
+  </mouth>
+</face>

Added: facebuilder/examples/women5.xml
===================================================================
--- facebuilder/examples/women5.xml	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/examples/women5.xml	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,74 @@
+<face>
+  <hair>
+    <filename>data/hair/0015.png</filename>
+    <offset><x>-1.0</x><y>-5.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hair>
+  <mouthfold>
+    <filename>data/mouthfold/0000.png</filename>
+    <offset><x>40</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </mouthfold>
+  <glasses>
+    <filename>data/glasses/0005.png</filename>
+    <offset><x>-1.0</x><y>-1.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </glasses>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>37.0</x><y>-25.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eyebrow>
+  <hat>
+    <filename>data/hat/0000.png</filename>
+    <offset><x>0</x><y>-50</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0015.png</filename>
+    <offset><x>33.0</x><y>-7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eye>
+  <forehead>
+    <filename>data/forehead/0000.png</filename>
+    <offset><x>0</x><y>-75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </forehead>
+  <nose>
+    <filename>data/nose/0003.png</filename>
+    <offset><x>0.0</x><y>24.0</y></offset>
+    <scale>1.24337430839465</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0000.png</filename>
+    <offset><x>0</x><y>-3.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>-1.0</x><y>74.0</y></offset>
+    <scale>0.870560178613914</scale>
+    <rotation>0</rotation>
+  </mouth>
+</face>

Added: facebuilder/examples/women6.xml
===================================================================
--- facebuilder/examples/women6.xml	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/examples/women6.xml	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,74 @@
+<face>
+  <hair>
+    <filename>data/hair/0017.png</filename>
+    <offset><x>1.0</x><y>-4.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hair>
+  <mouthfold>
+    <filename>data/mouthfold/0000.png</filename>
+    <offset><x>40</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </mouthfold>
+  <glasses>
+    <filename>data/glasses/0000.png</filename>
+    <offset><x>0</x><y>-10</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </glasses>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>36.0</x><y>-26.0</y></offset>
+    <scale>1.14868566764928</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <hat>
+    <filename>data/hat/0000.png</filename>
+    <offset><x>0</x><y>-50</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0015.png</filename>
+    <offset><x>35.0</x><y>-6.0</y></offset>
+    <scale>1.31947876306287</scale>
+    <rotation>0</rotation>
+  </eye>
+  <forehead>
+    <filename>data/forehead/0000.png</filename>
+    <offset><x>0</x><y>-75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </forehead>
+  <nose>
+    <filename>data/nose/0000.png</filename>
+    <offset><x>0</x><y>17.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0005.png</filename>
+    <offset><x>0</x><y>-7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0007.png</filename>
+    <offset><x>0</x><y>75.0</y></offset>
+    <scale>0.870560178613914</scale>
+    <rotation>0</rotation>
+  </mouth>
+</face>

Added: facebuilder/examples/women7.xml
===================================================================
--- facebuilder/examples/women7.xml	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/examples/women7.xml	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,74 @@
+<face>
+  <hair>
+    <filename>data/hair/0017.png</filename>
+    <offset><x>1.0</x><y>-4.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hair>
+  <mouthfold>
+    <filename>data/mouthfold/0001.png</filename>
+    <offset><x>33</x><y>66</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </mouthfold>
+  <glasses>
+    <filename>data/glasses/0006.png</filename>
+    <offset><x>0.0</x><y>-4.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </glasses>
+  <ear>
+    <filename>data/ear/0000.png</filename>
+    <offset><x>90</x><y>0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+  <beard>
+    <filename>data/beard/0000.png</filename>
+    <offset><x>0</x><y>75</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>36.0</x><y>-26.0</y></offset>
+    <scale>1.14868566764928</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <hat>
+    <filename>data/hat/0000.png</filename>
+    <offset><x>0</x><y>-50</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0015.png</filename>
+    <offset><x>35.0</x><y>-6.0</y></offset>
+    <scale>1.31947876306287</scale>
+    <rotation>0</rotation>
+  </eye>
+  <forehead>
+    <filename>data/forehead/0001.png</filename>
+    <offset><x>-1</x><y>-57</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </forehead>
+  <nose>
+    <filename>data/nose/0000.png</filename>
+    <offset><x>0</x><y>17.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0005.png</filename>
+    <offset><x>0</x><y>-7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <mouth>
+    <filename>data/mouth/0007.png</filename>
+    <offset><x>0</x><y>74.0</y></offset>
+    <scale>0.870560178613914</scale>
+    <rotation>0</rotation>
+  </mouth>
+</face>

Copied: facebuilder/facebuilder-old.rb (from rev 1153, facebuilder/facebuilder.rb)

Added: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/facebuilder.glade	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,417 @@
+<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
+<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">
+
+<glade-interface>
+<requires lib="gnome"/>
+<requires lib="canvas"/>
+<requires lib="bonobo"/>
+
+<widget class="GnomeApp" id="FaceBuilder">
+  <property name="visible">True</property>
+  <property name="title" translatable="yes">FaceBuilder</property>
+  <property name="type">GTK_WINDOW_TOPLEVEL</property>
+  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="modal">False</property>
+  <property name="default_width">800</property>
+  <property name="default_height">600</property>
+  <property name="resizable">True</property>
+  <property name="destroy_with_parent">False</property>
+  <property name="decorated">True</property>
+  <property name="skip_taskbar_hint">False</property>
+  <property name="skip_pager_hint">False</property>
+  <property name="type_hint">GDK_WINDOW_TYPE_HINT_NORMAL</property>
+  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
+  <property name="focus_on_map">True</property>
+  <property name="enable_layout_config">True</property>
+
+  <child internal-child="dock">
+    <widget class="BonoboDock" id="bonobodock1">
+      <property name="visible">True</property>
+      <property name="allow_floating">True</property>
+
+      <child>
+	<widget class="BonoboDockItem" id="bonobodockitem1">
+	  <property name="visible">True</property>
+	  <property name="shadow_type">GTK_SHADOW_NONE</property>
+
+	  <child>
+	    <widget class="GtkMenuBar" id="menubar1">
+	      <property name="visible">True</property>
+
+	      <child>
+		<widget class="GtkImageMenuItem" id="file1">
+		  <property name="visible">True</property>
+		  <property name="stock_item">GNOMEUIINFO_MENU_FILE_TREE</property>
+
+		  <child>
+		    <widget class="GtkMenu" id="file1_menu">
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="new1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_NEW_ITEM</property>
+			  <property name="label" translatable="yes">_New</property>
+			  <property name="use_underline">True</property>
+			  <signal name="activate" handler="on_new1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="open1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_OPEN_ITEM</property>
+			  <signal name="activate" handler="on_open1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="save1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_SAVE_ITEM</property>
+			  <signal name="activate" handler="on_save1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="save_as1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_SAVE_AS_ITEM</property>
+			  <signal name="activate" handler="on_save_as1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkSeparatorMenuItem" id="separator1">
+			  <property name="visible">True</property>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="quit1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_EXIT_ITEM</property>
+			  <signal name="activate" handler="on_quit1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+		    </widget>
+		  </child>
+		</widget>
+	      </child>
+
+	      <child>
+		<widget class="GtkImageMenuItem" id="edit1">
+		  <property name="visible">True</property>
+		  <property name="stock_item">GNOMEUIINFO_MENU_EDIT_TREE</property>
+
+		  <child>
+		    <widget class="GtkMenu" id="edit1_menu">
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="cut1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_CUT_ITEM</property>
+			  <signal name="activate" handler="on_cut1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="copy1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_COPY_ITEM</property>
+			  <signal name="activate" handler="on_copy1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="paste1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_PASTE_ITEM</property>
+			  <signal name="activate" handler="on_paste1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="clear1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_CLEAR_ITEM</property>
+			  <signal name="activate" handler="on_clear1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkSeparatorMenuItem" id="separator2">
+			  <property name="visible">True</property>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="properties1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_PROPERTIES_ITEM</property>
+			  <signal name="activate" handler="on_properties1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkSeparatorMenuItem" id="separator3">
+			  <property name="visible">True</property>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="preferences1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_PREFERENCES_ITEM</property>
+			  <signal name="activate" handler="on_preferences1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+		    </widget>
+		  </child>
+		</widget>
+	      </child>
+
+	      <child>
+		<widget class="GtkImageMenuItem" id="view1">
+		  <property name="visible">True</property>
+		  <property name="stock_item">GNOMEUIINFO_MENU_VIEW_TREE</property>
+
+		  <child>
+		    <widget class="GtkMenu" id="view1_menu">
+		    </widget>
+		  </child>
+		</widget>
+	      </child>
+
+	      <child>
+		<widget class="GtkImageMenuItem" id="help1">
+		  <property name="visible">True</property>
+		  <property name="stock_item">GNOMEUIINFO_MENU_HELP_TREE</property>
+
+		  <child>
+		    <widget class="GtkMenu" id="help1_menu">
+
+		      <child>
+			<widget class="GtkImageMenuItem" id="about1">
+			  <property name="visible">True</property>
+			  <property name="stock_item">GNOMEUIINFO_MENU_ABOUT_ITEM</property>
+			  <signal name="activate" handler="on_about1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
+			</widget>
+		      </child>
+		    </widget>
+		  </child>
+		</widget>
+	      </child>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="placement">BONOBO_DOCK_TOP</property>
+	  <property name="band">0</property>
+	  <property name="position">0</property>
+	  <property name="offset">0</property>
+	  <property name="behavior">BONOBO_DOCK_ITEM_BEH_EXCLUSIVE|BONOBO_DOCK_ITEM_BEH_NEVER_VERTICAL</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="BonoboDockItem" id="bonobodockitem2">
+	  <property name="visible">True</property>
+	  <property name="shadow_type">GTK_SHADOW_OUT</property>
+
+	  <child>
+	    <widget class="GtkToolbar" id="toolbar1">
+	      <property name="visible">True</property>
+	      <property name="orientation">GTK_ORIENTATION_HORIZONTAL</property>
+	      <property name="toolbar_style">GTK_TOOLBAR_ICONS</property>
+	      <property name="tooltips">True</property>
+	      <property name="show_arrow">True</property>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton1">
+		  <property name="visible">True</property>
+		  <property name="tooltip" translatable="yes">New File</property>
+		  <property name="stock_id">gtk-new</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_open_file">
+		  <property name="visible">True</property>
+		  <property name="tooltip" translatable="yes">Open File</property>
+		  <property name="stock_id">gtk-open</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_save_file">
+		  <property name="visible">True</property>
+		  <property name="tooltip" translatable="yes">Save File</property>
+		  <property name="stock_id">gtk-save</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	  </child>
+	</widget>
+	<packing>
+	  <property name="placement">BONOBO_DOCK_TOP</property>
+	  <property name="band">1</property>
+	  <property name="position">0</property>
+	  <property name="offset">0</property>
+	  <property name="behavior">BONOBO_DOCK_ITEM_BEH_EXCLUSIVE</property>
+	</packing>
+      </child>
+
+      <child>
+	<widget class="GtkHPaned" id="hpaned1">
+	  <property name="visible">True</property>
+	  <property name="can_focus">True</property>
+	  <property name="position">0</property>
+
+	  <child>
+	    <widget class="GtkScrolledWindow" id="scrolledwindow1">
+	      <property name="visible">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
+	      <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
+	      <property name="shadow_type">GTK_SHADOW_IN</property>
+	      <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+
+	      <child>
+		<widget class="GnomeCanvas" id="FaceCanvas">
+		  <property name="width_request">512</property>
+		  <property name="height_request">512</property>
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="aa">True</property>
+		  <property name="scroll_x1">-256</property>
+		  <property name="scroll_y1">-256</property>
+		  <property name="scroll_x2">256</property>
+		  <property name="scroll_y2">256</property>
+		  <property name="pixels_per_unit">1</property>
+		</widget>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="shrink">False</property>
+	      <property name="resize">False</property>
+	    </packing>
+	  </child>
+
+	  <child>
+	    <widget class="GtkVPaned" id="vpaned1">
+	      <property name="width_request">85</property>
+	      <property name="visible">True</property>
+	      <property name="can_focus">True</property>
+	      <property name="position">0</property>
+
+	      <child>
+		<widget class="GtkScrolledWindow" id="scrolledwindow3">
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
+		  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
+		  <property name="shadow_type">GTK_SHADOW_IN</property>
+		  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+
+		  <child>
+		    <widget class="GtkTreeView" id="FaceParts">
+		      <property name="width_request">64</property>
+		      <property name="visible">True</property>
+		      <property name="can_focus">True</property>
+		      <property name="headers_visible">False</property>
+		      <property name="rules_hint">False</property>
+		      <property name="reorderable">False</property>
+		      <property name="enable_search">False</property>
+		      <property name="fixed_height_mode">False</property>
+		      <property name="hover_selection">False</property>
+		      <property name="hover_expand">False</property>
+		    </widget>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="shrink">False</property>
+		  <property name="resize">False</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkScrolledWindow" id="scrolledwindow2">
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
+		  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
+		  <property name="shadow_type">GTK_SHADOW_IN</property>
+		  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+
+		  <child>
+		    <widget class="GtkTreeView" id="PartSelector">
+		      <property name="height_request">100</property>
+		      <property name="visible">True</property>
+		      <property name="can_focus">True</property>
+		      <property name="headers_visible">False</property>
+		      <property name="rules_hint">False</property>
+		      <property name="reorderable">False</property>
+		      <property name="enable_search">False</property>
+		      <property name="fixed_height_mode">False</property>
+		      <property name="hover_selection">False</property>
+		      <property name="hover_expand">False</property>
+		    </widget>
+		  </child>
+		</widget>
+		<packing>
+		  <property name="shrink">True</property>
+		  <property name="resize">True</property>
+		</packing>
+	      </child>
+	    </widget>
+	    <packing>
+	      <property name="shrink">False</property>
+	      <property name="resize">True</property>
+	    </packing>
+	  </child>
+	</widget>
+      </child>
+    </widget>
+    <packing>
+      <property name="padding">0</property>
+      <property name="expand">True</property>
+      <property name="fill">True</property>
+    </packing>
+  </child>
+
+  <child internal-child="appbar">
+    <widget class="GnomeAppBar" id="statusbar">
+      <property name="visible">True</property>
+      <property name="has_progress">True</property>
+      <property name="has_status">True</property>
+    </widget>
+    <packing>
+      <property name="padding">0</property>
+      <property name="expand">True</property>
+      <property name="fill">True</property>
+    </packing>
+  </child>
+</widget>
+
+</glade-interface>

Added: facebuilder/facebuilder.gladep
===================================================================
--- facebuilder/facebuilder.gladep	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/facebuilder.gladep	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,7 @@
+<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
+<!DOCTYPE glade-project SYSTEM "http://glade.gnome.org/glade-project-2.0.dtd">
+
+<glade-project>
+  <name>FaceBuilder</name>
+  <program_name>facebuilder</program_name>
+</glade-project>

Deleted: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/facebuilder.rb	2005-12-25 17:02:47 UTC (rev 1157)
@@ -1,398 +0,0 @@
-#!/usr/bin/env ruby
-
-require "gnomecanvas2"
-require "gtk2"
-require "face.rb"
-
-Point = Struct.new("Point", :x, :y)
-class Point
-  def to_p
-    [x,y]
-  end
-  def +(p)
-    [x+p.x, y+p.y]
-  end
-  def -(p)
-    [x-p.x, y-p.y]
-  end
-end
-
-class FaceBuilder < Gtk::VBox
-  def add_image(root, filename, x, y, anchor, affine = nil)
-    im = Gdk::Pixbuf.new(filename)
-
-    unless im.nil?
-      image = Gnome::CanvasPixbuf.new(root,
-                                      :pixbuf => im,
-                                      :x => x,
-                                      :y => y,
-                                      :width => im.width,
-                                      :height => im.height,
-                                      :anchor => anchor)
-
-      image.signal_connect("event") { |item,event|
-        puts "Bla: ", item, event
-      }
-      # puts image.i2w_affine
-      # puts image.i2c_affine
-
-      if affine then
-        image.affine_absolute(affine)
-      end
-
-      image.signal_connect("destroy", im) { |item, im| }
-      return image
-    end
-  end
-
-  def setup_controls(root, pos, facepart)
-    left = Gtk::Button.new("<-")
-    Gnome::CanvasWidget.new(root,
-                            {:widget => left,
-                              :x => pos.x,
-                              :y => pos.y,
-                              :width =>  32.0,
-                              :height => 32.0,
-                              :anchor => Gtk::ANCHOR_EAST,
-                              :size_pixels => FALSE})
-    left.show()
-    left.signal_connect("clicked") {
-      @face.get_part(facepart).previous_item()
-      set_current_part(facepart)
-    }
-
-    right = Gtk::Button.new("->")
-    Gnome::CanvasWidget.new(root,
-                            {:widget => right,
-                              :x => pos.x,
-                              :y => pos.y,
-                              :width =>  32.0,
-                              :height => 32.0,
-                              :anchor => Gtk::ANCHOR_WEST,
-                              :size_pixels => FALSE})
-    right.show()
-    right.signal_connect("clicked") {
-      @face.get_part(facepart).next_item()
-      set_current_part(facepart)
-    }
-    return [left, right]
-  end
-
-  def setup_menu()
-    accel_group = Gtk::AccelGroup.new
-    item_factory = Gtk::ItemFactory.new(Gtk::ItemFactory::TYPE_MENU_BAR,
-                                        '<main>', accel_group)
-    
-    @window.add_accel_group(accel_group)
-    @window.set_border_width(0)
-
-    ifactory_cb = proc do |data, widget|
-      puts "ItemFactory: activated \"#{Gtk::ItemFactory.path_from_widget(widget)}\""
-    end
-    
-    menu_items = 
-      [
-       ['/_File'],
-#       ['/File/tearoff1', '<Tearoff>', nil, nil, ifactory_cb],
-       ['/File/_Open',
-        '<Item>', '<control>O', nil, method(:open_file)],
-       ['/File/Save _As...',
-        '<Item>', '<control>S', nil, method(:save_file)],
-       ['/File/Quit',
-        '<Item>', '<control>Q', nil, method(:quit)],
-       ['/View/Hide Controls', 
-        '<Item>', nil, nil, nil],
-       ['/Help/About',
-        '<Item>', nil, nil, method(:about_dialog)]
-      ]
-    item_factory.create_items(menu_items)
-    
-    return item_factory.get_widget('<main>')
-  end
-
-  def about_dialog(data, widget)
-#     Gtk::AboutDialog.set_email_hook {|about, link|
-#       p "email_hook"
-#       p link
-#     }
-#     Gtk::AboutDialog.set_url_hook {|about, link|
-#       p "url_hook"
-#       p link
-#     }
-
-    Gtk::AboutDialog.show(nil,
-                          # "artists" => File.new("AUTHORS").readlines(),
-                          "authors" => File.new("AUTHORS").readlines(),
-                          "comments" => "A simple tool to construct faces",
-                          "copyright" => "Copyright (C) 2005 Ingo Ruhnke <grumbel at gmx.de>",
-                          # "documenters" => ["Documenter 1 <no1 at foo.bar.com>", "Documenter 2 <no2 at foo.bar.com>"],
-                          "license" => File.new("COPYING").read(),
-                          # "logo_icon_name" => "gtk-home",
-                          "logo" => Gdk::Pixbuf.new("data/logo.png"),
-                          "name" => "Face Builder",
-                          "version" => "0.0.1",
-                          "website" => "http://windstille.berlios.de/facebuilder/",
-                          "website_label" => "Face Builder"
-                          )
-  end
-  
-  def quit(data, widget)
-    Gtk.main_quit
-  end
-
-  def open_file(data, widget)
-    dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
-                                         Gtk::FileChooser::ACTION_OPEN,
-                                         "gnome-vfs",
-                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
-                                         [Gtk::Stock::OPEN,   Gtk::Dialog::RESPONSE_ACCEPT]
-                                         )
-    dialog.run { |response|
-      if response == Gtk::Dialog::RESPONSE_ACCEPT then
-        @face.load(dialog.filename)
-      end
-      
-      dialog.destroy
-    }
-  end
-
-  def save_file(data, widget)
-    dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
-                                         Gtk::FileChooser::ACTION_SAVE,
-                                         "gnome-vfs",
-                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
-                                         [Gtk::Stock::SAVE,   Gtk::Dialog::RESPONSE_ACCEPT]
-                                         )
-    dialog.run { |response|
-      if response == Gtk::Dialog::RESPONSE_ACCEPT then
-        @face.save(dialog.filename)
-      end
-      
-      dialog.destroy
-    }
-  end
-
-  def set_current_part(type)
-    @parts.each_with_index() { |p, i|
-      if type == p then
-        if @current_part != i
-          @treeview.columns[0].title = type.to_s.capitalize
-                                                          
-          @list.clear()
-          Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
-            filename = "data/#{type}/#{v}"
-            iter = @list.append()
-            pixbuf = Gdk::Pixbuf.new(filename)
-
-            # scale, while keeping aspect
-            if pixbuf.width > 64 or pixbuf.height > 64 then # need scaling, since larger then 64x64
-              aspect = pixbuf.width.to_f / pixbuf.height
-              if pixbuf.width > pixbuf.height then
-                pixbuf = pixbuf.scale(64, 64 / aspect)
-              else
-                pixbuf = pixbuf.scale(64 * aspect, 64)
-              end
-            end
-
-            # Add keep of aspect ratio
-            iter[0] = pixbuf
-            iter[1] = filename
-          }
-
-          @current_part = i
-        end       
-      end
-    }
-
-    
-  end
-
-  def initialize(window)
-    super()
-
-    @window = window
-    
-    @box = Gtk::EventBox.new
-    @menu = setup_menu()
-    pack_start(@menu, false, false, 0)
-    @hbox = Gtk::HBox.new(false, 5)
-    pack_start(@hbox)
-    @hbox.pack_start(@box)
-
-    @label = Gtk::Label.new
-    @label.show
-    pack_end(@label,false,false,0)
-    set_border_width(@pad = 2)
-    set_size_request((@width = 48)+(@pad*2), (@height = 48)+(@pad*2))
-    @canvas = Gnome::Canvas.new(true)
-    # @box.border_width = 5
-    @box.add(@canvas)
-    
-    @list = Gtk::ListStore.new(Gdk::Pixbuf, String)
-    
-    @scrolled_win = Gtk::ScrolledWindow.new
-    @scrolled_win.set_policy(Gtk::POLICY_AUTOMATIC,Gtk::POLICY_AUTOMATIC)
-    # @scrolled_win.width = 64
-
-    @treeview = Gtk::TreeView.new(@list)
-    @treeview.headers_visible = false
-    @treeview.append_column(Gtk::TreeViewColumn.new("Stuff",
-                                                    Gtk::CellRendererPixbuf.new, 
-                                                    {:pixbuf => 0}))
-    @treeview.selection.set_mode(Gtk::SELECTION_SINGLE)
-    # scrolled_win.add_with_viewport(treeview)
-    
-    @treeview.signal_connect("cursor-changed") { |treeview|
-      row, column = treeview.cursor()
-      puts @list.methods()
-
-      puts "Selected something #{@list.get_value(@list.get_iter(row), 1)}"
-      filename = @list.get_value(@list.get_iter(row), 1)
-      @face.get_part(@parts[@current_part]).filename = filename
-    }
-    
-    @scrolled_win.set_size_request(96,64)
-    @hbox.pack_end(@scrolled_win, false, false, 0)
-    @scrolled_win.add_with_viewport(@treeview)
-
-    @canvas.signal_connect("button-press-event") { |item,event|
-      # Some throuble with alpha
-      # puts "Bla: ", @canvas.get_item_at(event.x, event.y)
-    }
-
-    # puts
-    @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
-
-    @canvas.root.affine_absolute(Art::Affine.translate(192, 192))
-    @face = Face.new(@canvas.root)
-    
-    setup_controls(@canvas.root, Point.new(0, -200),  :hat)
-    setup_controls(@canvas.root, Point.new(-200, -140),   :forehead)
-    setup_controls(@canvas.root, Point.new(0, 200),   :head)
-    setup_controls(@canvas.root, Point.new(200, -140), :hair)
-
-    setup_controls(@canvas.root, Point.new(-200, 0), :glasses)
-
-    setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
-    setup_controls(@canvas.root, Point.new(200, 0),   :eye)
-    setup_controls(@canvas.root, Point.new(200, 40),  :nose)
-    setup_controls(@canvas.root, Point.new(200, 80),  :mouth)
-    setup_controls(@canvas.root, Point.new(-200, 80),  :mouthfold)
-
-    Gnome::CanvasText.new(@canvas.root,
-                          {:text => 
-                            "PgUp, PgDown:\tscale\n" +
-                            "Home, End:\t\trotate\n" +
-                            "Cursorkeys:\t\tmove\n",
-                            :x => -180,
-                            :y => 180,
-                            :font => "Sans 10",
-                            :anchor => Gtk::ANCHOR_N,
-                            :fill_color => "black"})
-
-    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :mouthfold, :beard, :nose, :head, :forehead, :hair, :hat]
-    @current_part = 0
-
-    @canvas.signal_connect("key-press-event") { |widget, event|
-      part = @face.get_part(@parts[@current_part])
-      case event.keyval
-      when Gdk::Keyval::GDK_c
-        part.offset = Point.new(0, part.offset.y) if part
-
-      when Gdk::Keyval::GDK_e
-        @current_part -= 1
-        if @current_part < 0 then
-          @current_part = @parts.length - 1
-        end
-        puts @parts[@current_part]
-
-      when Gdk::Keyval::GDK_o
-        @current_part += 1
-        if @current_part >= @parts.length then
-          @current_part = 0
-        end
-        puts @parts[@current_part]
-
-      when Gdk::Keyval::GDK_r
-        @face.reload()
-
-      when Gdk::Keyval::GDK_Page_Down
-        part.scale=(part.scale / 1.02) if part
-
-      when Gdk::Keyval::GDK_Page_Up
-        part.scale=(part.scale * 1.02) if part
-
-      when Gdk::Keyval::GDK_End
-        part.rotation=(part.rotation - 1.0) if part
-
-      when Gdk::Keyval::GDK_Home
-        part.rotation=(part.rotation + 1.0) if part
-
-      when Gdk::Keyval::GDK_a
-        part.next_item if part
-        
-      when Gdk::Keyval::GDK_Up
-        part.offset = Point.new(part.offset.x, part.offset.y - 1) if part
-        
-      when Gdk::Keyval::GDK_Down
-        part.offset = Point.new(part.offset.x, part.offset.y + 1) if part
-
-      when Gdk::Keyval::GDK_Left
-        part.offset = Point.new(part.offset.x - 1, part.offset.y) if part
-
-      when Gdk::Keyval::GDK_Right
-        part.offset = Point.new(part.offset.x + 1, part.offset.y) if part
-      end
-    }
-    
-    #     @box.signal_connect('size-allocate') { |w,e,*b| 
-    #       @width, @height = [e.width,e.height].collect{|i|i - (@pad*2)}
-    #       @size = [@width, at height].min
-    #       @radius = @size / 2
-    #       @canvas.set_size(@width, at height)
-    #       @canvas.set_scroll_region(0,0, at width, at height)
-    #       false
-    #     }
-
-    @canvas.set_size(384, 384)
-    @canvas.set_scroll_region(0,0,384,384)
-
-    signal_connect_after('show') {|w,e| }
-    signal_connect_after('hide') {|w,e| }
-
-    @canvas.show()
-    @scrolled_win.show()
-    @treeview.show()
-    @menu.show()
-    @box.show()
-    @hbox.show()
-    show()
-  end
-end
-
-
-if $0 == __FILE__
-
-  class Viewer < Gtk::Window
-    def initialize()
-      super()
-      set_title("Face Builder")
-      signal_connect("delete_event") { |i,a| Gtk::main_quit }
-      $facebuilder = FaceBuilder.new(self)
-      add($facebuilder)
-      set_default_size(640, 512)
-      # set_resizable(false)
-      show()
-    end
-  end
-
-  Gtk.init()
-
-  view = Viewer.new
-  view.show
-
-  Gtk.main()
-  
-end
-
-# EOF #

Added: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/facebuilder.rb	2005-12-25 17:02:47 UTC (rev 1157)
@@ -0,0 +1,336 @@
+#!/usr/bin/env ruby
+#
+# This file is gererated by ruby-glade-create-template 1.1.3.
+#
+require 'libglade2'
+require 'face.rb'
+
+Point = Struct.new("Point", :x, :y)
+
+class FacebuilderGlade
+  include GetText
+
+  attr :glade
+  
+  # Creates menu hints.
+  def create_uiinfo_menus(name)
+    app = @glade['FaceBuilder']
+    tips = @glade.get_tooltips(app.toplevel)
+    callback_dummy = Proc.new{} #Dummy 
+    uiinfos = [
+      Gnome::UIInfo::menu_new_item('_New', nil, callback_dummy, nil),
+      Gnome::UIInfo::menu_open_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_save_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_save_as_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_quit_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_cut_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_copy_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_paste_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_clear_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_properties_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
+      Gnome::UIInfo::menu_about_item(callback_dummy, nil),
+    ]
+    uiinfos[0][9] = @glade['new1']
+    uiinfos[1][9] = @glade['open1']
+    uiinfos[2][9] = @glade['save1']
+    uiinfos[3][9] = @glade['save_as1']
+    uiinfos[4][9] = @glade['quit1']
+    uiinfos[5][9] = @glade['cut1']
+    uiinfos[6][9] = @glade['copy1']
+    uiinfos[7][9] = @glade['paste1']
+    uiinfos[8][9] = @glade['clear1']
+    uiinfos[9][9] = @glade['properties1']
+    uiinfos[10][9] = @glade['preferences1']
+    uiinfos[11][9] = @glade['about1']
+    app.install_menu_hints(uiinfos)
+  end
+  # Creates tooltips.
+  def create_tooltips
+    @tooltip = Gtk::Tooltips.new
+    @glade['toolbutton1'].set_tooltip(@tooltip, _('New File'))
+    @glade['toolbutton_open_file'].set_tooltip(@tooltip, _('Open File'))
+    @glade['toolbutton_save_file'].set_tooltip(@tooltip, _('Save File'))
+
+    @glade['toolbutton_open_file'].signal_connect("clicked") { |*params| on_open1_activate(nil) }
+    @glade['toolbutton_save_file'].signal_connect("clicked") { |*params| on_save_as1_activate(nil) }
+  end
+  def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
+    bindtextdomain(domain, localedir, nil, "UTF-8")
+    @glade = GladeXML.new(path_or_data, root, domain, localedir, flag) {|handler| method(handler)}
+    
+    create_uiinfo_menus(domain)
+    create_tooltips
+
+    # Non Glade stuff
+    @parts = [:eye, :eyebrow, :glasses, :ear, :mouth, :mouthfold, :beard, :nose, :head, :forehead, :hair, :hat]
+    @current_part = 0
+
+    @canvas = @glade['FaceCanvas']
+    @face = Face.new(@canvas.root)
+    @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
+
+    setup_faceparts()
+    setup_partselector()
+
+    setup_controls(@canvas.root, Point.new(0, -200),  :hat)
+    setup_controls(@canvas.root, Point.new(-200, -140),   :forehead)
+    setup_controls(@canvas.root, Point.new(0, 200),   :head)
+    setup_controls(@canvas.root, Point.new(200, -140), :hair)
+
+    setup_controls(@canvas.root, Point.new(-200, 0), :glasses)
+
+    setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
+    setup_controls(@canvas.root, Point.new(200, 0),   :eye)
+    setup_controls(@canvas.root, Point.new(200, 40),  :nose)
+    setup_controls(@canvas.root, Point.new(200, 80),  :mouth)
+    setup_controls(@canvas.root, Point.new(-200, 80),  :mouthfold)
+
+    Gnome::CanvasText.new(@canvas.root,
+                          {:text => 
+                            "PgUp, PgDown:\tscale\n" +
+                            "Home, End:\t\trotate\n" +
+                            "Cursorkeys:\t\tmove\n",
+                            :x => -180,
+                            :y => 180,
+                            :font => "Sans 10",
+                            :anchor => Gtk::ANCHOR_N,
+                            :fill_color => "black"})
+
+    @canvas.signal_connect("key-press-event") { |widget, event|
+      part = @face.get_part(@parts[@current_part])
+      case event.keyval
+      when Gdk::Keyval::GDK_c
+        part.offset = Point.new(0, part.offset.y) if part
+
+      when Gdk::Keyval::GDK_e
+        @current_part -= 1
+        if @current_part < 0 then
+          @current_part = @parts.length - 1
+        end
+        puts @parts[@current_part]
+
+      when Gdk::Keyval::GDK_o
+        @current_part += 1
+        if @current_part >= @parts.length then
+          @current_part = 0
+        end
+        puts @parts[@current_part]
+
+      when Gdk::Keyval::GDK_r
+        @face.reload()
+
+      when Gdk::Keyval::GDK_Page_Down
+        part.scale=(part.scale / 1.02) if part
+
+      when Gdk::Keyval::GDK_Page_Up
+        part.scale=(part.scale * 1.02) if part
+
+      when Gdk::Keyval::GDK_End
+        part.rotation=(part.rotation - 1.0) if part
+
+      when Gdk::Keyval::GDK_Home
+        part.rotation=(part.rotation + 1.0) if part
+
+      when Gdk::Keyval::GDK_a
+        part.next_item if part
+        
+      when Gdk::Keyval::GDK_Up
+        part.offset = Point.new(part.offset.x, part.offset.y - 1) if part
+        
+      when Gdk::Keyval::GDK_Down
+        part.offset = Point.new(part.offset.x, part.offset.y + 1) if part
+
+      when Gdk::Keyval::GDK_Left
+        part.offset = Point.new(part.offset.x - 1, part.offset.y) if part
+
+      when Gdk::Keyval::GDK_Right
+        part.offset = Point.new(part.offset.x + 1, part.offset.y) if part
+      end
+    }
+  end
+  
+  def on_open1_activate(widget)
+        dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
+                                         Gtk::FileChooser::ACTION_OPEN,
+                                         "gnome-vfs",
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::OPEN,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face.load(dialog.filename)
+      end
+      
+      dialog.destroy
+    }
+  end
+  def on_paste1_activate(widget)
+    puts "on_paste1_activate() is not implemented yet."
+  end
+  def on_save_as1_activate(widget)
+    dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
+                                         Gtk::FileChooser::ACTION_SAVE,
+                                         "gnome-vfs",
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::SAVE,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face.save(dialog.filename)
+      end
+      
+      dialog.destroy
+    }
+  end
+  def on_about1_activate(widget)
+    Gtk::AboutDialog.show(nil,
+                          # "artists" => File.new("AUTHORS").readlines(),
+                          "authors" => File.new("AUTHORS").readlines(),
+                          "comments" => "A simple tool to construct faces",
+                          "copyright" => "Copyright (C) 2005 Ingo Ruhnke <grumbel at gmx.de>",
+                          # "documenters" => ["Documenter 1 <no1 at foo.bar.com>", "Documenter 2 <no2 at foo.bar.com>"],
+                          "license" => File.new("COPYING").read(),
+                          # "logo_icon_name" => "gtk-home",
+                          "logo" => Gdk::Pixbuf.new("data/logo.png"),
+                          "name" => "Face Builder",
+                          "version" => "0.0.1",
+                          "website" => "http://windstille.berlios.de/facebuilder/",
+                          "website_label" => "Face Builder"
+                          )
+  end
+  def on_preferences1_activate(widget)
+    puts "on_preferences1_activate() is not implemented yet."
+  end
+  def on_copy1_activate(widget)
+    puts "on_copy1_activate() is not implemented yet."
+  end
+  def on_new1_activate(widget)
+    puts "on_new1_activate() is not implemented yet."
+  end
+  def on_clear1_activate(widget)
+    puts "on_clear1_activate() is not implemented yet."
+  end
+  def on_cut1_activate(widget)
+    puts "on_cut1_activate() is not implemented yet."
+  end
+  def on_save1_activate(widget)
+    puts "on_save1_activate() is not implemented yet."
+  end
+  def on_properties1_activate(widget)
+    puts "on_properties1_activate() is not implemented yet."
+  end
+  def on_quit1_activate(widget)
+    Gtk.main_quit
+  end
+
+  def setup_controls(root, pos, facepart)
+    left = Gtk::Button.new("<-")
+    Gnome::CanvasWidget.new(root,
+                            {:widget => left,
+                              :x => pos.x,
+                              :y => pos.y,
+                              :width =>  32.0,
+                              :height => 32.0,
+                              :anchor => Gtk::ANCHOR_EAST,
+                              :size_pixels => FALSE})
+    left.show()
+    left.signal_connect("clicked") {
+      @face.get_part(facepart).previous_item()
+      set_current_part(facepart)
+    }
+
+    right = Gtk::Button.new("->")
+    Gnome::CanvasWidget.new(root,
+                            {:widget => right,
+                              :x => pos.x,
+                              :y => pos.y,
+                              :width =>  32.0,
+                              :height => 32.0,
+                              :anchor => Gtk::ANCHOR_WEST,
+                              :size_pixels => FALSE})
+    right.show()
+    right.signal_connect("clicked") {
+      @face.get_part(facepart).next_item()
+      set_current_part(facepart)
+    }
+    return [left, right]
+  end
+
+  def setup_faceparts()
+    @treeview = @glade['FaceParts']
+    @list = Gtk::ListStore.new(Gdk::Pixbuf, String)
+    @treeview.model = @list
+    @treeview.append_column(Gtk::TreeViewColumn.new("Stuff",
+                                                    Gtk::CellRendererPixbuf.new, 
+                                                    {:pixbuf => 0}))    
+    
+    @treeview.signal_connect("cursor-changed") { |treeview|
+      row, column = treeview.cursor()
+      puts @list.methods()
+
+      puts "Selected something #{@list.get_value(@list.get_iter(row), 1)}"
+      filename = @list.get_value(@list.get_iter(row), 1)
+      @face.get_part(@parts[@current_part]).filename = filename
+    }
+  end
+
+  def setup_partselector()
+    list = Gtk::ListStore.new(String)
+    partselector = @glade['PartSelector']
+    partselector.model = list
+    
+    @parts.each {|part|
+      iter = list.append()
+      iter[0] = part.to_s
+    }
+
+    partselector.append_column(Gtk::TreeViewColumn.new("Stuff",
+                                                       Gtk::CellRendererText.new, 
+                                                       {:text => 0}))    
+  end
+
+  def set_current_part(type)
+    @parts.each_with_index() { |p, i|
+      if type == p then
+        if @current_part != i
+          @list.clear()
+          Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
+            filename = "data/#{type}/#{v}"
+            iter = @list.append()
+            pixbuf = Gdk::Pixbuf.new(filename)
+
+            # scale, while keeping aspect
+            if pixbuf.width > 64 or pixbuf.height > 64 then # need scaling, since larger then 64x64
+              aspect = pixbuf.width.to_f / pixbuf.height
+              if pixbuf.width > pixbuf.height then
+                pixbuf = pixbuf.scale(64, 64 / aspect)
+              else
+                pixbuf = pixbuf.scale(64 * aspect, 64)
+              end
+            end
+
+            # Add keep of aspect ratio
+            iter[0] = pixbuf
+            iter[1] = filename
+          }
+
+          @current_part = i
+        end       
+      end
+    }   
+  end
+end
+
+# Main program
+if __FILE__ == $0
+  # Set values as your own application. 
+  PROG_PATH = "facebuilder.glade"
+  PROG_NAME = "FaceBuilder"
+  PROG_VERSION = "0.1.0"
+  Gnome::Program.new(PROG_NAME, PROG_VERSION)
+  #If you use Ruby/GTK2 widgets only, call Gtk.init not Gnome::Program.new here.
+  #Gtk.init
+  $facebuilder = FacebuilderGlade.new(PROG_PATH, nil, PROG_NAME)
+  Gtk.main
+end

Modified: facebuilder/index.html
===================================================================
--- facebuilder/index.html	2005-12-25 00:36:21 UTC (rev 1156)
+++ facebuilder/index.html	2005-12-25 17:02:47 UTC (rev 1157)
@@ -42,7 +42,7 @@
 
       <h3>Javascript/DOM port</h3>
       <p>
-        There is also a Javascript/DOM port of FaceBuilder, might lack
+        There is also a Javascript/DOM port of FaceBuilder writte by <a href="mailto:fb at phk.at">fb at phk.at</a>, might lack
         some features and be a bit slow, but works in a browser, its
         available at:
       </p>
@@ -57,4 +57,4 @@
     </div>
 
   </body>
-</html>
\ No newline at end of file
+</html>



From grumbel at berlios.de  Sun Dec 25 20:20:59 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 20:20:59 +0100
Subject: [Windstille-commit] r1158 - facebuilder
Message-ID: <200512251920.jBPJKxIo007801@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 20:20:56 +0100 (Sun, 25 Dec 2005)
New Revision: 1158

Modified:
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
- some more gnomification

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-25 17:02:47 UTC (rev 1157)
+++ facebuilder/facebuilder.glade	2005-12-25 19:20:56 UTC (rev 1158)
@@ -35,7 +35,7 @@
 	  <property name="shadow_type">GTK_SHADOW_NONE</property>
 
 	  <child>
-	    <widget class="GtkMenuBar" id="menubar1">
+	    <widget class="GtkMenuBar" id="FaceParts">
 	      <property name="visible">True</property>
 
 	      <child>
@@ -319,74 +319,69 @@
 	  </child>
 
 	  <child>
-	    <widget class="GtkVPaned" id="vpaned1">
-	      <property name="width_request">85</property>
+	    <widget class="GtkScrolledWindow" id="scrolledwindow2">
 	      <property name="visible">True</property>
 	      <property name="can_focus">True</property>
-	      <property name="position">0</property>
+	      <property name="hscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+	      <property name="vscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+	      <property name="shadow_type">GTK_SHADOW_IN</property>
+	      <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
 
 	      <child>
-		<widget class="GtkScrolledWindow" id="scrolledwindow3">
+		<widget class="GtkViewport" id="viewport1">
 		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
-		  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
 		  <property name="shadow_type">GTK_SHADOW_IN</property>
-		  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
 
 		  <child>
-		    <widget class="GtkTreeView" id="FaceParts">
-		      <property name="width_request">64</property>
+		    <widget class="GtkVBox" id="vbox1">
 		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="headers_visible">False</property>
-		      <property name="rules_hint">False</property>
-		      <property name="reorderable">False</property>
-		      <property name="enable_search">False</property>
-		      <property name="fixed_height_mode">False</property>
-		      <property name="hover_selection">False</property>
-		      <property name="hover_expand">False</property>
-		    </widget>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="shrink">False</property>
-		  <property name="resize">False</property>
-		</packing>
-	      </child>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">0</property>
 
-	      <child>
-		<widget class="GtkScrolledWindow" id="scrolledwindow2">
-		  <property name="visible">True</property>
-		  <property name="can_focus">True</property>
-		  <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
-		  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
-		  <property name="shadow_type">GTK_SHADOW_IN</property>
-		  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+		      <child>
+			<widget class="GtkComboBox" id="PartSelector">
+			  <property name="visible">True</property>
+			  <property name="add_tearoffs">False</property>
+			  <property name="focus_on_click">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
 
-		  <child>
-		    <widget class="GtkTreeView" id="PartSelector">
-		      <property name="height_request">100</property>
-		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="headers_visible">False</property>
-		      <property name="rules_hint">False</property>
-		      <property name="reorderable">False</property>
-		      <property name="enable_search">False</property>
-		      <property name="fixed_height_mode">False</property>
-		      <property name="hover_selection">False</property>
-		      <property name="hover_expand">False</property>
+		      <child>
+			<widget class="GtkScrolledWindow" id="scrolledwindow3">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
+			  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
+			  <property name="shadow_type">GTK_SHADOW_NONE</property>
+			  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+
+			  <child>
+			    <widget class="GtkIconView" id="FaceParts">
+			      <property name="visible">True</property>
+			      <property name="can_focus">True</property>
+			      <property name="selection_mode">GTK_SELECTION_SINGLE</property>
+			      <property name="orientation">GTK_ORIENTATION_VERTICAL</property>
+			    </widget>
+			  </child>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
 		    </widget>
 		  </child>
 		</widget>
-		<packing>
-		  <property name="shrink">True</property>
-		  <property name="resize">True</property>
-		</packing>
 	      </child>
 	    </widget>
 	    <packing>
-	      <property name="shrink">False</property>
+	      <property name="shrink">True</property>
 	      <property name="resize">True</property>
 	    </packing>
 	  </child>

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 17:02:47 UTC (rev 1157)
+++ facebuilder/facebuilder.rb	2005-12-25 19:20:56 UTC (rev 1158)
@@ -18,19 +18,19 @@
     tips = @glade.get_tooltips(app.toplevel)
     callback_dummy = Proc.new{} #Dummy 
     uiinfos = [
-      Gnome::UIInfo::menu_new_item('_New', nil, callback_dummy, nil),
-      Gnome::UIInfo::menu_open_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_save_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_save_as_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_quit_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_cut_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_copy_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_paste_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_clear_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_properties_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
-      Gnome::UIInfo::menu_about_item(callback_dummy, nil),
-    ]
+               Gnome::UIInfo::menu_new_item('_New', nil, callback_dummy, nil),
+               Gnome::UIInfo::menu_open_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_save_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_save_as_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_quit_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_cut_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_copy_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_paste_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_clear_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_properties_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
+               Gnome::UIInfo::menu_about_item(callback_dummy, nil),
+              ]
     uiinfos[0][9] = @glade['new1']
     uiinfos[1][9] = @glade['open1']
     uiinfos[2][9] = @glade['save1']
@@ -77,9 +77,9 @@
     setup_controls(@canvas.root, Point.new(-200, -140),   :forehead)
     setup_controls(@canvas.root, Point.new(0, 200),   :head)
     setup_controls(@canvas.root, Point.new(200, -140), :hair)
-
+    
     setup_controls(@canvas.root, Point.new(-200, 0), :glasses)
-
+    
     setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
     setup_controls(@canvas.root, Point.new(200, 0),   :eye)
     setup_controls(@canvas.root, Point.new(200, 40),  :nose)
@@ -97,6 +97,10 @@
                             :anchor => Gtk::ANCHOR_N,
                             :fill_color => "black"})
 
+    @canvas.signal_connect_after("button-press-event") { |widget, event|
+      widget.grab_focus()
+    }
+
     @canvas.signal_connect("key-press-event") { |widget, event|
       part = @face.get_part(@parts[@current_part])
       case event.keyval
@@ -151,7 +155,7 @@
   end
   
   def on_open1_activate(widget)
-        dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
+    dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
                                          Gtk::FileChooser::ACTION_OPEN,
                                          "gnome-vfs",
                                          [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
@@ -259,40 +263,61 @@
 
   def setup_faceparts()
     @treeview = @glade['FaceParts']
-    @list = Gtk::ListStore.new(Gdk::Pixbuf, String)
+    @list = Gtk::ListStore.new(String, Gdk::Pixbuf)
     @treeview.model = @list
-    @treeview.append_column(Gtk::TreeViewColumn.new("Stuff",
-                                                    Gtk::CellRendererPixbuf.new, 
-                                                    {:pixbuf => 0}))    
-    
-    @treeview.signal_connect("cursor-changed") { |treeview|
-      row, column = treeview.cursor()
-      puts @list.methods()
+    @treeview.set_property('selection-mode', Gtk::SELECTION_BROWSE)
 
-      puts "Selected something #{@list.get_value(@list.get_iter(row), 1)}"
-      filename = @list.get_value(@list.get_iter(row), 1)
-      @face.get_part(@parts[@current_part]).filename = filename
+    @treeview.signal_connect("selection-changed") { |iconview|
+      row = iconview.selected_items()[0]
+      if row then # when does this get nil?
+        filename = iconview.model.get_value(@list.get_iter(row), 0)
+        # puts filename.inspect
+        @face.get_part(@parts[@current_part]).filename = filename
+        # puts "Selected something #{iconview.model.get_value(@list.get_iter(row), 1)}"
+      end
     }
+
+    @treeview.text_column   = -1
+    @treeview.pixbuf_column = 1
   end
 
   def setup_partselector()
-    list = Gtk::ListStore.new(String)
     partselector = @glade['PartSelector']
-    partselector.model = list
+
+    #partselector.model = Gtk::ListStore.new(String)
     
+    model = Gtk::ListStore.new(Gdk::Pixbuf, String)
+
+    partselector.model = model
+    renderer = Gtk::CellRendererPixbuf.new
+    partselector.pack_start(renderer, false)
+    partselector.set_attributes(renderer, :pixbuf => 0)
+    
+    renderer = Gtk::CellRendererText.new
+    partselector.pack_start(renderer, true)
+    partselector.set_attributes(renderer, :text => 1)
+
+    partselector.signal_connect("changed") { |partselector|
+      set_current_part(@parts[partselector.active])
+    }
+
     @parts.each {|part|
-      iter = list.append()
-      iter[0] = part.to_s
+      #puts part.to_s
+      #iter = partselector.model.append()
+      #iter[0] = "bla" # part.to_s
+      # partselector.append_text part.to_s
+
+      iter = model.append
+      iter[0] = @glade['FaceBuilder'].render_icon(Gtk::Stock::OK, Gtk::IconSize::MENU, "icon")
+      iter[1] = part.to_s
     }
-
-    partselector.append_column(Gtk::TreeViewColumn.new("Stuff",
-                                                       Gtk::CellRendererText.new, 
-                                                       {:text => 0}))    
   end
 
   def set_current_part(type)
     @parts.each_with_index() { |p, i|
       if type == p then
+        @glade['PartSelector'].active = i
+
         if @current_part != i
           @list.clear()
           Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
@@ -310,9 +335,10 @@
               end
             end
 
+            
             # Add keep of aspect ratio
-            iter[0] = pixbuf
-            iter[1] = filename
+            iter[1] = pixbuf
+            iter[0] = filename
           }
 
           @current_part = i



From grumbel at berlios.de  Sun Dec 25 21:48:27 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 21:48:27 +0100
Subject: [Windstille-commit] r1159 - facebuilder
Message-ID: <200512252048.jBPKmR30017573@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 21:48:22 +0100 (Sun, 25 Dec 2005)
New Revision: 1159

Modified:
   facebuilder/face.rb
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
- added simple undo/redo

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-25 19:20:56 UTC (rev 1158)
+++ facebuilder/face.rb	2005-12-25 20:48:22 UTC (rev 1159)
@@ -1,6 +1,21 @@
 require "rexml/document"
 require 'gnomecanvas2'
 
+class FaceCommand
+  def initialize(undo_, redo_)
+    @undo = undo_
+    @redo = redo_    
+  end
+
+  def do_undo()
+    @undo.call()
+  end
+  
+  def do_redo()
+    @redo.call()
+  end
+end
+
 class FacePart
   attr_reader :type, :offset, :filename, :canvas_items, :scale, :rotation
   
@@ -43,10 +58,19 @@
     when Gdk::Event::BUTTON_RELEASE
       item.ungrab(event.time)
       @dragging = false;
+
+      if @old_offset != @offset then
+        old_offset = @old_offset.clone()
+        offset     = @offset.clone()
+
+        @parent.undo_stack << FaceCommand.new(proc{ @parent.get_part(@type).offset = old_offset },
+                                              proc{ @parent.get_part(@type).offset = offset     })
+      end
     end
   end
 
-  def initialize(root, type, filename, offset)
+  def initialize(parent, root, type, filename, offset)
+    @parent = parent
     @type     = type
     @offset   = offset
     @filename = filename
@@ -134,6 +158,8 @@
   end
 
   def update_items()
+    $facebuilder.update_undo() if $facebuilder
+
     if @canvas_items.length == 1 then
       @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
                                        Art::Affine.rotate(@rotation) *
@@ -189,21 +215,26 @@
 end
 
 class Face
+  attr_accessor :undo_stack, :redo_stack, :parts
+
   def initialize(root, filename = nil)
+    @undo_stack = []
+    @redo_stack = []
+
     @root = root
     @parts  = {
-      :head    => FacePart.new(root, :head,    "data/head/0000.png",    Point.new(0, 0)),
-      :forehead    => FacePart.new(root, :forehead,    "data/forehead/0000.png",    Point.new(0, -75)),
-      :eye     => FacePart.new(root, :eye,     "data/eye/0000.png",     Point.new(35, -10)),
-      :eyebrow => FacePart.new(root, :eyebrow, "data/eyebrow/0000.png", Point.new(45, -30)),
-      :ear     => FacePart.new(root, :ear,     "data/ear/0000.png",     Point.new(90, 0)),
-      :nose    => FacePart.new(root, :nose,    "data/nose/0000.png",    Point.new(0, 30)),
-      :mouth   => FacePart.new(root, :mouth,   "data/mouth/0000.png",   Point.new(0, 75)),
-      :mouthfold => FacePart.new(root, :mouthfold,   "data/mouthfold/0000.png",   Point.new(40, 75)),
-      :beard   => FacePart.new(root, :beard,   "data/beard/0000.png",   Point.new(0, 75)),
-      :glasses => FacePart.new(root, :glasses, "data/glasses/0000.png", Point.new(0, -10)),
-      :hair    => FacePart.new(root, :hair,    "data/hair/0000.png",    Point.new(0, -20)),
-      :hat     => FacePart.new(root,  :hat,    "data/hat/0000.png",    Point.new(0, -50))
+      :head      => FacePart.new(self, root, :head,      "data/head/0000.png",      Point.new( 0,   0)),
+      :forehead  => FacePart.new(self, root, :forehead,  "data/forehead/0000.png",  Point.new( 0, -75)),
+      :eye       => FacePart.new(self, root, :eye,       "data/eye/0000.png",       Point.new(35, -10)),
+      :eyebrow   => FacePart.new(self, root, :eyebrow,   "data/eyebrow/0000.png",   Point.new(45, -30)),
+      :ear       => FacePart.new(self, root, :ear,       "data/ear/0000.png",       Point.new(90,   0)),
+      :nose      => FacePart.new(self, root, :nose,      "data/nose/0000.png",      Point.new( 0,  30)),
+      :mouth     => FacePart.new(self, root, :mouth,     "data/mouth/0000.png",     Point.new( 0,  75)),
+      :mouthfold => FacePart.new(self, root, :mouthfold, "data/mouthfold/0000.png", Point.new(40,  75)),
+      :beard     => FacePart.new(self, root, :beard,     "data/beard/0000.png",     Point.new( 0,  75)),
+      :glasses   => FacePart.new(self, root, :glasses,   "data/glasses/0000.png",   Point.new( 0, -10)),
+      :hair      => FacePart.new(self, root, :hair,      "data/hair/0000.png",      Point.new( 0, -20)),
+      :hat       => FacePart.new(self, root, :hat,       "data/hat/0000.png",       Point.new( 0, -50))
     }
   end
 
@@ -235,6 +266,34 @@
                                         element.elements['offset/y'].text.to_f)
     }
   end
+
+  def do_undo()
+    if ! @undo_stack.empty? then
+      cmd = @undo_stack.pop
+      cmd.do_undo()
+      @redo_stack << cmd
+    end
+  end
+
+  def do_redo()
+    if ! @redo_stack.empty? then
+      cmd = @redo_stack.pop
+      cmd.do_redo()
+      @undo_stack << cmd
+    end    
+  end
+
+  def has_undo_stack?()
+    return ! @undo_stack.empty?
+  end
+
+  def has_redo_stack?()
+    return ! @redo_stack.empty?
+  end
+
+  def on_change()
+    
+  end
 end
 
 # EOF #

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-25 19:20:56 UTC (rev 1158)
+++ facebuilder/facebuilder.glade	2005-12-25 20:48:22 UTC (rev 1159)
@@ -270,6 +270,88 @@
 		  <property name="homogeneous">True</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton4">
+		  <property name="visible">True</property>
+		  <property name="stock_id">gtk-save-as</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_reload">
+		  <property name="visible">True</property>
+		  <property name="stock_id">gtk-refresh</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkSeparatorToolItem" id="separatortoolitem1">
+		  <property name="visible">True</property>
+		  <property name="draw">True</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">False</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_undo">
+		  <property name="visible">True</property>
+		  <property name="stock_id">gtk-undo</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_redo">
+		  <property name="visible">True</property>
+		  <property name="stock_id">gtk-redo</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkSeparatorToolItem" id="separatortoolitem2">
+		  <property name="visible">True</property>
+		  <property name="draw">True</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">False</property>
+		</packing>
+	      </child>
 	    </widget>
 	  </child>
 	</widget>

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 19:20:56 UTC (rev 1158)
+++ facebuilder/facebuilder.rb	2005-12-25 20:48:22 UTC (rev 1159)
@@ -31,20 +31,21 @@
                Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
                Gnome::UIInfo::menu_about_item(callback_dummy, nil),
               ]
-    uiinfos[0][9] = @glade['new1']
-    uiinfos[1][9] = @glade['open1']
-    uiinfos[2][9] = @glade['save1']
-    uiinfos[3][9] = @glade['save_as1']
-    uiinfos[4][9] = @glade['quit1']
-    uiinfos[5][9] = @glade['cut1']
-    uiinfos[6][9] = @glade['copy1']
-    uiinfos[7][9] = @glade['paste1']
-    uiinfos[8][9] = @glade['clear1']
-    uiinfos[9][9] = @glade['properties1']
+    uiinfos[0][9]  = @glade['new1']
+    uiinfos[1][9]  = @glade['open1']
+    uiinfos[2][9]  = @glade['save1']
+    uiinfos[3][9]  = @glade['save_as1']
+    uiinfos[4][9]  = @glade['quit1']
+    uiinfos[5][9]  = @glade['cut1']
+    uiinfos[6][9]  = @glade['copy1']
+    uiinfos[7][9]  = @glade['paste1']
+    uiinfos[8][9]  = @glade['clear1']
+    uiinfos[9][9]  = @glade['properties1']
     uiinfos[10][9] = @glade['preferences1']
     uiinfos[11][9] = @glade['about1']
     app.install_menu_hints(uiinfos)
   end
+
   # Creates tooltips.
   def create_tooltips
     @tooltip = Gtk::Tooltips.new
@@ -52,9 +53,13 @@
     @glade['toolbutton_open_file'].set_tooltip(@tooltip, _('Open File'))
     @glade['toolbutton_save_file'].set_tooltip(@tooltip, _('Save File'))
 
+    @glade['toolbutton_undo'].signal_connect("clicked") { |*params| self.on_undo() }
+    @glade['toolbutton_redo'].signal_connect("clicked") { |*params| self.on_redo() }
+
     @glade['toolbutton_open_file'].signal_connect("clicked") { |*params| on_open1_activate(nil) }
     @glade['toolbutton_save_file'].signal_connect("clicked") { |*params| on_save_as1_activate(nil) }
   end
+
   def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
     bindtextdomain(domain, localedir, nil, "UTF-8")
     @glade = GladeXML.new(path_or_data, root, domain, localedir, flag) {|handler| method(handler)}
@@ -153,6 +158,14 @@
       end
     }
   end
+
+  def on_undo()
+    @face.do_undo()
+  end
+
+  def on_redo()
+    @face.do_redo()
+  end
   
   def on_open1_activate(widget)
     dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
@@ -346,6 +359,11 @@
       end
     }   
   end
+
+  def update_undo()
+    @glade['toolbutton_undo'].set_sensitive(@face.has_undo_stack?)
+    @glade['toolbutton_redo'].set_sensitive(@face.has_redo_stack?)
+  end
 end
 
 # Main program
@@ -360,3 +378,5 @@
   $facebuilder = FacebuilderGlade.new(PROG_PATH, nil, PROG_NAME)
   Gtk.main
 end
+
+# EOF #



From grumbel at berlios.de  Sun Dec 25 22:11:35 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 22:11:35 +0100
Subject: [Windstille-commit] r1160 - facebuilder
Message-ID: <200512252111.jBPLBZ4S019585@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 22:11:34 +0100 (Sun, 25 Dec 2005)
New Revision: 1160

Modified:
   facebuilder/NEWS
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- some more undo/redo

Modified: facebuilder/NEWS
===================================================================
--- facebuilder/NEWS	2005-12-25 20:48:22 UTC (rev 1159)
+++ facebuilder/NEWS	2005-12-25 21:11:34 UTC (rev 1160)
@@ -8,6 +8,6 @@
 * face parts are moveable with the mouse
 * plenty of more faceparts
 * faceparts are now all shaded
+* simple undo/redo
 
-
 # EOF #

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-25 20:48:22 UTC (rev 1159)
+++ facebuilder/face.rb	2005-12-25 21:11:34 UTC (rev 1160)
@@ -65,6 +65,7 @@
 
         @parent.undo_stack << FaceCommand.new(proc{ @parent.get_part(@type).offset = old_offset },
                                               proc{ @parent.get_part(@type).offset = offset     })
+        $facebuilder.update_undo() if $facebuilder
       end
     end
   end
@@ -158,8 +159,6 @@
   end
 
   def update_items()
-    $facebuilder.update_undo() if $facebuilder
-
     if @canvas_items.length == 1 then
       @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
                                        Art::Affine.rotate(@rotation) *
@@ -188,6 +187,16 @@
   end
 
   def filename=(filename)
+    if @parent.use_undo() then
+      old_filename = @filename.clone()
+      new_filename = filename.clone()
+      @parent.undo_stack << FaceCommand.new(proc{ @parent.without_undo {
+                                                @parent.get_part(@type).filename=(old_filename) }},
+                                            proc{ @parent.without_undo {
+                                                @parent.get_part(@type).filename=(new_filename) }})
+      $facebuilder.update_undo() if $facebuilder
+    end
+
     @filename = filename    
     pixbuf = Gdk::Pixbuf.new(@filename)
     @canvas_items.each {|item|
@@ -216,10 +225,12 @@
 
 class Face
   attr_accessor :undo_stack, :redo_stack, :parts
+  attr_reader   :use_undo
 
   def initialize(root, filename = nil)
     @undo_stack = []
     @redo_stack = []
+    @use_undo   = true
 
     @root = root
     @parts  = {
@@ -238,6 +249,20 @@
     }
   end
 
+  def without_undo()
+    disable_undo()
+    yield()
+    enable_undo()
+  end
+
+  def disable_undo()
+    @use_undo = false
+  end
+
+  def enable_undo()
+    @use_undo = true
+  end
+
   def get_part(type)
     return @parts[type]
   end 

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 20:48:22 UTC (rev 1159)
+++ facebuilder/facebuilder.rb	2005-12-25 21:11:34 UTC (rev 1160)
@@ -58,6 +58,9 @@
 
     @glade['toolbutton_open_file'].signal_connect("clicked") { |*params| on_open1_activate(nil) }
     @glade['toolbutton_save_file'].signal_connect("clicked") { |*params| on_save_as1_activate(nil) }
+
+    @glade['toolbutton_undo'].set_sensitive(false)
+    @glade['toolbutton_redo'].set_sensitive(false)
   end
 
   def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
@@ -161,10 +164,12 @@
 
   def on_undo()
     @face.do_undo()
+    update_undo()
   end
 
   def on_redo()
     @face.do_redo()
+    update_undo()
   end
   
   def on_open1_activate(widget)



From grumbel at berlios.de  Sun Dec 25 22:29:40 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sun, 25 Dec 2005 22:29:40 +0100
Subject: [Windstille-commit] r1161 - facebuilder
Message-ID: <200512252129.jBPLTesj021134@sheep.berlios.de>

Author: grumbel
Date: 2005-12-25 22:29:40 +0100 (Sun, 25 Dec 2005)
New Revision: 1161

Modified:
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- some more work on undo/redo

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-25 21:11:34 UTC (rev 1160)
+++ facebuilder/face.rb	2005-12-25 21:29:40 UTC (rev 1161)
@@ -62,9 +62,9 @@
       if @old_offset != @offset then
         old_offset = @old_offset.clone()
         offset     = @offset.clone()
-
-        @parent.undo_stack << FaceCommand.new(proc{ @parent.get_part(@type).offset = old_offset },
-                                              proc{ @parent.get_part(@type).offset = offset     })
+        
+        @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.get_part(@type).offset = old_offset },
+                                                  proc{ @parent.get_part(@type).offset = offset     }))
         $facebuilder.update_undo() if $facebuilder
       end
     end
@@ -190,10 +190,10 @@
     if @parent.use_undo() then
       old_filename = @filename.clone()
       new_filename = filename.clone()
-      @parent.undo_stack << FaceCommand.new(proc{ @parent.without_undo {
-                                                @parent.get_part(@type).filename=(old_filename) }},
-                                            proc{ @parent.without_undo {
-                                                @parent.get_part(@type).filename=(new_filename) }})
+      @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
+                                                    @parent.get_part(@type).filename=(old_filename) }},
+                                                proc{ @parent.without_undo {
+                                                    @parent.get_part(@type).filename=(new_filename) }}))
       $facebuilder.update_undo() if $facebuilder
     end
 
@@ -224,8 +224,8 @@
 end
 
 class Face
-  attr_accessor :undo_stack, :redo_stack, :parts
-  attr_reader   :use_undo
+  attr_accessor :redo_stack, :parts
+  attr_reader   :use_undo, :undo_stack
 
   def initialize(root, filename = nil)
     @undo_stack = []
@@ -308,6 +308,11 @@
     end    
   end
 
+  def add_to_undo_stack(item)
+    @redo_stack.clear()
+    @undo_stack << item
+  end
+
   def has_undo_stack?()
     return ! @undo_stack.empty?
   end

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 21:11:34 UTC (rev 1160)
+++ facebuilder/facebuilder.rb	2005-12-25 21:29:40 UTC (rev 1161)
@@ -59,6 +59,10 @@
     @glade['toolbutton_open_file'].signal_connect("clicked") { |*params| on_open1_activate(nil) }
     @glade['toolbutton_save_file'].signal_connect("clicked") { |*params| on_save_as1_activate(nil) }
 
+    @glade['toolbutton_reload'].signal_connect("clicked") { |*params| 
+      @face.reload()
+    }
+
     @glade['toolbutton_undo'].set_sensitive(false)
     @glade['toolbutton_redo'].set_sensitive(false)
   end



From grumbel at berlios.de  Mon Dec 26 01:17:19 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Mon, 26 Dec 2005 01:17:19 +0100
Subject: [Windstille-commit] r1162 - in facebuilder: . data/beard data/forehead data/hat data/mouthfold
Message-ID: <200512260017.jBQ0HJeN025941@sheep.berlios.de>

Author: grumbel
Date: 2005-12-26 01:17:06 +0100 (Mon, 26 Dec 2005)
New Revision: 1162

Removed:
   facebuilder/data/beard/0000.png
   facebuilder/data/forehead/0000.png
   facebuilder/data/hat/0000.png
   facebuilder/data/mouthfold/0000.png
Modified:
   facebuilder/TODO
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- some beautification in the iconview
- removed no longer needed empty faceparts

Modified: facebuilder/TODO
===================================================================
--- facebuilder/TODO	2005-12-25 21:29:40 UTC (rev 1161)
+++ facebuilder/TODO	2005-12-26 00:17:06 UTC (rev 1162)
@@ -3,12 +3,16 @@
 +--------------
 
 * follow a few more GUI conventions
-* select face part from a list instead of via next/previous toggles
 * add much more face parts
 * adjust all face parts to follow a standard convention (pupils in
-  center of, hair relative to the center of the face, etc) so that
+  center of the image, hair relative to the center of the face, etc) so that
   they are easier swapable without size and position adjustments
 * support for different sets, male/female, comic, realistic, etc
 * create a context-menu to center-x, center-y and similar stuff
+* add simple cloths
+* seperate hair into front and back
+* export to PNG
+* export to SVG
+* add GUI handles for scale and rotate
 
 # EOF #

Deleted: facebuilder/data/beard/0000.png
===================================================================
(Binary files differ)

Deleted: facebuilder/data/forehead/0000.png
===================================================================
(Binary files differ)

Deleted: facebuilder/data/hat/0000.png
===================================================================
(Binary files differ)

Deleted: facebuilder/data/mouthfold/0000.png
===================================================================
(Binary files differ)

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-25 21:29:40 UTC (rev 1161)
+++ facebuilder/face.rb	2005-12-26 00:17:06 UTC (rev 1162)
@@ -46,7 +46,7 @@
         # Calculate the new position
 
         if event.state & Gdk::Window::SHIFT_MASK == Gdk::Window::SHIFT_MASK
-          @offset.x = @old_offset.x
+          @offset.x = 0 # @old_offset.x
         else
           @offset.x = @old_offset.x + item_x - @x
         end
@@ -93,10 +93,6 @@
                                              :height => im.height,
                                              :anchor => Gtk::ANCHOR_CENTER)
 
-    @canvas_items.last.signal_connect("event") { |item, event|
-      item_event(item, event)
-    }
-
     case @type
     when :eye, :ear, :eyebrow, :mouthfold
       @canvas_items << Gnome::CanvasPixbuf.new(root,
@@ -107,6 +103,13 @@
                                                :height => im.height,
                                                :anchor => Gtk::ANCHOR_CENTER)
     end
+    
+    @canvas_items.each {|i|
+      i.signal_connect("event") { |item, event|
+        item_event(item, event)
+      }
+    }
+
     update_items()
   end
 
@@ -187,21 +190,27 @@
   end
 
   def filename=(filename)
-    if @parent.use_undo() then
-      old_filename = @filename.clone()
-      new_filename = filename.clone()
-      @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
-                                                    @parent.get_part(@type).filename=(old_filename) }},
-                                                proc{ @parent.without_undo {
-                                                    @parent.get_part(@type).filename=(new_filename) }}))
-      $facebuilder.update_undo() if $facebuilder
+    if filename and ! filename.empty? then
+      if @parent.use_undo() then
+        old_filename = @filename.clone()
+        new_filename = filename.clone()
+        @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
+                                                      @parent.get_part(@type).filename=(old_filename) }},
+                                                  proc{ @parent.without_undo {
+                                                      @parent.get_part(@type).filename=(new_filename) }}))
+        $facebuilder.update_undo() if $facebuilder
+      end
+
+      @canvas_items.each{ |item| item.show() }
+      
+      @filename = filename    
+      pixbuf = Gdk::Pixbuf.new(@filename)
+      @canvas_items.each {|item|
+        item.pixbuf = pixbuf
+      }
+    else
+      @canvas_items.each{ |item| item.hide() }
     end
-
-    @filename = filename    
-    pixbuf = Gdk::Pixbuf.new(@filename)
-    @canvas_items.each {|item|
-      item.pixbuf = pixbuf
-    }
   end
 
   def offset=(offset)
@@ -214,12 +223,14 @@
   end
 
   def save(out)
-    out << "  <#{type}>\n"
-    out << "    <filename>#{@filename}</filename>\n"
-    out << "    <offset><x>#{@offset.x}</x><y>#{@offset.y}</y></offset>\n"
-    out << "    <scale>#{@scale}</scale>\n"
-    out << "    <rotation>#{@rotation}</rotation>\n"
-    out << "  </#{type}>\n"
+    if filename then
+      out << "  <#{type}>\n"
+      out << "    <filename>#{@filename}</filename>\n"
+      out << "    <offset><x>#{@offset.x}</x><y>#{@offset.y}</y></offset>\n"
+      out << "    <scale>#{@scale}</scale>\n"
+      out << "    <rotation>#{@rotation}</rotation>\n"
+      out << "  </#{type}>\n"
+    end
   end
 end
 

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-25 21:29:40 UTC (rev 1161)
+++ facebuilder/facebuilder.rb	2005-12-26 00:17:06 UTC (rev 1162)
@@ -284,12 +284,12 @@
   end
 
   def setup_faceparts()
-    @treeview = @glade['FaceParts']
+    faceparts = @glade['FaceParts']
     @list = Gtk::ListStore.new(String, Gdk::Pixbuf)
-    @treeview.model = @list
-    @treeview.set_property('selection-mode', Gtk::SELECTION_BROWSE)
+    faceparts.model = @list
+    faceparts.set_property('selection-mode', Gtk::SELECTION_BROWSE)
 
-    @treeview.signal_connect("selection-changed") { |iconview|
+    faceparts.signal_connect("selection-changed") { |iconview|
       row = iconview.selected_items()[0]
       if row then # when does this get nil?
         filename = iconview.model.get_value(@list.get_iter(row), 0)
@@ -299,8 +299,8 @@
       end
     }
 
-    @treeview.text_column   = -1
-    @treeview.pixbuf_column = 1
+    faceparts.text_column   = -1
+    faceparts.pixbuf_column =  1
   end
 
   def setup_partselector()
@@ -340,8 +340,15 @@
       if type == p then
         @glade['PartSelector'].active = i
 
-        if @current_part != i
+        if @current_part != i then
           @list.clear()
+
+          # Add empty item
+          iter = @list.append()
+          iter[0] = nil
+          iter[1] = Gdk::Pixbuf.new('data/empty.png')
+
+          # Add other items
           Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
             filename = "data/#{type}/#{v}"
             iter = @list.append()
@@ -357,9 +364,19 @@
               end
             end
 
-            
+            whitepixbuf = Gdk::Pixbuf.new(Gdk::Pixbuf::COLORSPACE_RGB, true, 8, 64, 64)
+            whitepixbuf.fill!(0xf5f5f5ff)
+
+            whitepixbuf.composite!(pixbuf, 
+                                   (whitepixbuf.width - pixbuf.width)/2, (whitepixbuf.height - pixbuf.height)/2,
+                                   pixbuf.width, pixbuf.height,
+                                   (whitepixbuf.width - pixbuf.width)/2, (whitepixbuf.height - pixbuf.height)/2,
+                                   1.0, 1.0,
+                                   Gdk::Pixbuf::INTERP_BILINEAR,
+                                   255)            
+
             # Add keep of aspect ratio
-            iter[1] = pixbuf
+            iter[1] = whitepixbuf
             iter[0] = filename
           }
 



From grumbel at berlios.de  Mon Dec 26 02:02:09 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Mon, 26 Dec 2005 02:02:09 +0100
Subject: [Windstille-commit] r1163 - in facebuilder: . data data/beard data/forehead data/hat data/mouthfold
Message-ID: <200512260102.jBQ129oL005730@sheep.berlios.de>

Author: grumbel
Date: 2005-12-26 02:01:57 +0100 (Mon, 26 Dec 2005)
New Revision: 1163

Added:
   facebuilder/data/beard/0000.png
   facebuilder/data/empty.png
   facebuilder/data/forehead/0000.png
   facebuilder/data/hat/0000.png
   facebuilder/data/mouthfold/0000.png
Removed:
   facebuilder/data/beard/0001.png
   facebuilder/data/forehead/0001.png
   facebuilder/data/hat/0004.png
   facebuilder/data/mouthfold/0001.png
Modified:
   facebuilder/facebuilder.glade
Log:
- some resize tweaks
- removed empty images

Added: facebuilder/data/beard/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/beard/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: facebuilder/data/beard/0001.png
===================================================================
(Binary files differ)

Added: facebuilder/data/empty.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/empty.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Copied: facebuilder/data/forehead/0000.png (from rev 1145, facebuilder/data/forehead/0001.png)

Deleted: facebuilder/data/forehead/0001.png
===================================================================
(Binary files differ)

Added: facebuilder/data/hat/0000.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hat/0000.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: facebuilder/data/hat/0004.png
===================================================================
(Binary files differ)

Copied: facebuilder/data/mouthfold/0000.png (from rev 1145, facebuilder/data/mouthfold/0001.png)

Deleted: facebuilder/data/mouthfold/0001.png
===================================================================
(Binary files differ)

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-26 00:17:06 UTC (rev 1162)
+++ facebuilder/facebuilder.glade	2005-12-26 01:01:57 UTC (rev 1163)
@@ -372,10 +372,12 @@
 
 	  <child>
 	    <widget class="GtkScrolledWindow" id="scrolledwindow1">
+	      <property name="width_request">533</property>
+	      <property name="height_request">533</property>
 	      <property name="visible">True</property>
 	      <property name="can_focus">True</property>
-	      <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
-	      <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
+	      <property name="hscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
+	      <property name="vscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
 	      <property name="shadow_type">GTK_SHADOW_IN</property>
 	      <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
 
@@ -401,65 +403,48 @@
 	  </child>
 
 	  <child>
-	    <widget class="GtkScrolledWindow" id="scrolledwindow2">
+	    <widget class="GtkVBox" id="vbox1">
+	      <property name="width_request">92</property>
 	      <property name="visible">True</property>
-	      <property name="can_focus">True</property>
-	      <property name="hscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
-	      <property name="vscrollbar_policy">GTK_POLICY_AUTOMATIC</property>
-	      <property name="shadow_type">GTK_SHADOW_IN</property>
-	      <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+	      <property name="homogeneous">False</property>
+	      <property name="spacing">0</property>
 
 	      <child>
-		<widget class="GtkViewport" id="viewport1">
+		<widget class="GtkComboBox" id="PartSelector">
 		  <property name="visible">True</property>
-		  <property name="shadow_type">GTK_SHADOW_IN</property>
+		  <property name="add_tearoffs">False</property>
+		  <property name="focus_on_click">True</property>
+		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">False</property>
+		  <property name="fill">False</property>
+		</packing>
+	      </child>
 
+	      <child>
+		<widget class="GtkScrolledWindow" id="scrolledwindow3">
+		  <property name="visible">True</property>
+		  <property name="can_focus">True</property>
+		  <property name="hscrollbar_policy">GTK_POLICY_NEVER</property>
+		  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
+		  <property name="shadow_type">GTK_SHADOW_NONE</property>
+		  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
+
 		  <child>
-		    <widget class="GtkVBox" id="vbox1">
+		    <widget class="GtkIconView" id="FaceParts">
 		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">0</property>
-
-		      <child>
-			<widget class="GtkComboBox" id="PartSelector">
-			  <property name="visible">True</property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkScrolledWindow" id="scrolledwindow3">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="hscrollbar_policy">GTK_POLICY_ALWAYS</property>
-			  <property name="vscrollbar_policy">GTK_POLICY_ALWAYS</property>
-			  <property name="shadow_type">GTK_SHADOW_NONE</property>
-			  <property name="window_placement">GTK_CORNER_TOP_LEFT</property>
-
-			  <child>
-			    <widget class="GtkIconView" id="FaceParts">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="selection_mode">GTK_SELECTION_SINGLE</property>
-			      <property name="orientation">GTK_ORIENTATION_VERTICAL</property>
-			    </widget>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">True</property>
-			  <property name="fill">True</property>
-			</packing>
-		      </child>
+		      <property name="can_focus">True</property>
+		      <property name="selection_mode">GTK_SELECTION_SINGLE</property>
+		      <property name="orientation">GTK_ORIENTATION_VERTICAL</property>
 		    </widget>
 		  </child>
 		</widget>
+		<packing>
+		  <property name="padding">0</property>
+		  <property name="expand">True</property>
+		  <property name="fill">True</property>
+		</packing>
 	      </child>
 	    </widget>
 	    <packing>



From grumbel at berlios.de  Mon Dec 26 02:12:18 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Mon, 26 Dec 2005 02:12:18 +0100
Subject: [Windstille-commit] r1164 - facebuilder/data/hair
Message-ID: <200512260112.jBQ1CIqC007394@sheep.berlios.de>

Author: grumbel
Date: 2005-12-26 02:12:12 +0100 (Mon, 26 Dec 2005)
New Revision: 1164

Removed:
   facebuilder/data/hair/0006.png
Log:
- removed empty image

Deleted: facebuilder/data/hair/0006.png
===================================================================
(Binary files differ)



From grumbel at berlios.de  Mon Dec 26 04:48:21 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Mon, 26 Dec 2005 04:48:21 +0100
Subject: [Windstille-commit] r1165 - facebuilder
Message-ID: <200512260348.jBQ3mLI1015054@sheep.berlios.de>

Author: grumbel
Date: 2005-12-26 04:48:12 +0100 (Mon, 26 Dec 2005)
New Revision: 1165

Modified:
   facebuilder/NEWS
   facebuilder/TODO
   facebuilder/face.rb
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
 -svg export

Modified: facebuilder/NEWS
===================================================================
--- facebuilder/NEWS	2005-12-26 01:12:12 UTC (rev 1164)
+++ facebuilder/NEWS	2005-12-26 03:48:12 UTC (rev 1165)
@@ -9,5 +9,7 @@
 * plenty of more faceparts
 * faceparts are now all shaded
 * simple undo/redo
+* SVG export
+* PNG export
 
 # EOF #

Modified: facebuilder/TODO
===================================================================
--- facebuilder/TODO	2005-12-26 01:12:12 UTC (rev 1164)
+++ facebuilder/TODO	2005-12-26 03:48:12 UTC (rev 1165)
@@ -15,4 +15,5 @@
 * export to SVG
 * add GUI handles for scale and rotate
 
+
 # EOF #

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-26 01:12:12 UTC (rev 1164)
+++ facebuilder/face.rb	2005-12-26 03:48:12 UTC (rev 1165)
@@ -1,4 +1,5 @@
 require "rexml/document"
+require "base64.rb"
 require 'gnomecanvas2'
 
 class FaceCommand
@@ -209,6 +210,7 @@
         item.pixbuf = pixbuf
       }
     else
+      @filename = nil
       @canvas_items.each{ |item| item.hide() }
     end
   end
@@ -222,8 +224,47 @@
     return @offset
   end
 
+  def save_svg(out)
+    if @filename then
+      pixbuf = Gdk::Pixbuf.new(@filename)
+
+      out.write("\n\n<!-- #{@type.to_s} -->\n")
+      out.write("<g transform=\"")
+      out.write("translate(#{pixbuf.width/2},#{pixbuf.height/2}) ")
+      out.write("translate(#{-pixbuf.width/2 + 256},#{-pixbuf.height/2 + 256}) ")
+      out.write("translate(#{offset.x},#{offset.y}) ")
+      out.write("rotate(#{@rotation}) ")
+      out.write("scale(#{@scale}) ")
+      out.write("translate(#{-pixbuf.width/2},#{-pixbuf.height/2}) ")
+
+      out.write("\">")
+      out.write("<image height=\"#{pixbuf.height}\" width=\"#{pixbuf.width}\" ")
+      out.write("xlink:href=\"data:image/png;base64,#{Base64.encode64(File.new(@filename).read())}\" ")
+      out.write("x=\"0\" y=\"0\" />")
+      out.write("</g>\n")
+
+      case @type
+      when :eye, :ear, :eyebrow, :mouthfold
+        out.write("<g transform=\"")
+        out.write("translate(#{pixbuf.width/2},#{pixbuf.height/2}) ")
+        out.write("scale(-1.0, 1.0) ")
+        out.write("translate(#{pixbuf.width/2 - 256},#{-pixbuf.height/2 + 256}) ")
+        out.write("translate(#{offset.x},#{offset.y}) ")
+        out.write("rotate(#{@rotation}) ")
+        out.write("scale(#{@scale}) ")
+        out.write("translate(#{-pixbuf.width/2},#{-pixbuf.height/2}) ")
+
+        out.write("\">")
+        out.write("<image height=\"#{pixbuf.height}\" width=\"#{pixbuf.width}\" ")
+        out.write("xlink:href=\"data:image/png;base64,#{Base64.encode64(File.new(@filename).read())}\" ")
+        out.write("x=\"0\" y=\"0\" />")
+        out.write("</g>\n")
+      end
+    end
+  end
+
   def save(out)
-    if filename then
+    if @filename then
       out << "  <#{type}>\n"
       out << "    <filename>#{@filename}</filename>\n"
       out << "    <offset><x>#{@offset.x}</x><y>#{@offset.y}</y></offset>\n"
@@ -282,6 +323,33 @@
     @parts.each{|key, val| val.reload() }
   end
 
+  def save_as_png(filename)
+    # FIXME: Only primitive export, only copies from framebuffer and doesn't work with overlap
+    puts $facebuilder.canvas.window
+    window = $facebuilder.canvas.window
+    pixbuf = Gdk::Pixbuf.from_drawable(window.colormap, window, 0, 0, 512, 512)
+    pixbuf.save(filename,"png")
+  end
+
+  def save_as_svg(filename)
+    f = File.new(filename, "w")
+    f.write <<EOF
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+<svg
+   xmlns="http://www.w3.org/2000/svg" version="1.1"
+   xmlns:xlink="http://www.w3.org/1999/xlink"
+   width="512"
+   height="512">
+EOF
+    
+    @parts.each{ |key, val| 
+      val.save_svg(f)
+    }
+    f.write "</svg>"
+    f.close()    
+  end
+
   def save(filename)
     out = File.new(filename, "w")
     out << "<face>\n"

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-26 01:12:12 UTC (rev 1164)
+++ facebuilder/facebuilder.glade	2005-12-26 03:48:12 UTC (rev 1165)
@@ -39,7 +39,7 @@
 	      <property name="visible">True</property>
 
 	      <child>
-		<widget class="GtkImageMenuItem" id="file1">
+		<widget class="GtkMenuItem" id="file1">
 		  <property name="visible">True</property>
 		  <property name="stock_item">GNOMEUIINFO_MENU_FILE_TREE</property>
 
@@ -87,6 +87,30 @@
 		      </child>
 
 		      <child>
+			<widget class="GtkMenuItem" id="export_as_png1">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Export as PNG...</property>
+			  <property name="use_underline">True</property>
+			  <signal name="activate" handler="on_export_as_png1_activate" last_modification_time="Mon, 26 Dec 2005 01:20:36 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkMenuItem" id="export_as_svg1">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Export as SVG...</property>
+			  <property name="use_underline">True</property>
+			  <signal name="activate" handler="on_export_as_svg1_activate" last_modification_time="Mon, 26 Dec 2005 01:20:36 GMT"/>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkSeparatorMenuItem" id="separator4">
+			  <property name="visible">True</property>
+			</widget>
+		      </child>
+
+		      <child>
 			<widget class="GtkImageMenuItem" id="quit1">
 			  <property name="visible">True</property>
 			  <property name="stock_item">GNOMEUIINFO_MENU_EXIT_ITEM</property>
@@ -99,7 +123,7 @@
 	      </child>
 
 	      <child>
-		<widget class="GtkImageMenuItem" id="edit1">
+		<widget class="GtkMenuItem" id="edit1">
 		  <property name="visible">True</property>
 		  <property name="stock_item">GNOMEUIINFO_MENU_EDIT_TREE</property>
 
@@ -171,19 +195,14 @@
 	      </child>
 
 	      <child>
-		<widget class="GtkImageMenuItem" id="view1">
+		<widget class="GtkMenuItem" id="view1">
 		  <property name="visible">True</property>
 		  <property name="stock_item">GNOMEUIINFO_MENU_VIEW_TREE</property>
-
-		  <child>
-		    <widget class="GtkMenu" id="view1_menu">
-		    </widget>
-		  </child>
 		</widget>
 	      </child>
 
 	      <child>
-		<widget class="GtkImageMenuItem" id="help1">
+		<widget class="GtkMenuItem" id="help1">
 		  <property name="visible">True</property>
 		  <property name="stock_item">GNOMEUIINFO_MENU_HELP_TREE</property>
 

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-26 01:12:12 UTC (rev 1164)
+++ facebuilder/facebuilder.rb	2005-12-26 03:48:12 UTC (rev 1165)
@@ -11,7 +11,8 @@
   include GetText
 
   attr :glade
-  
+  attr :canvas
+
   # Creates menu hints.
   def create_uiinfo_menus(name)
     app = @glade['FaceBuilder']
@@ -191,6 +192,39 @@
       dialog.destroy
     }
   end
+
+  def on_export_as_svg1_activate(widget)
+    dialog =  Gtk::FileChooserDialog.new("FaceBuilder - Export face as PNG", nil,
+                                         Gtk::FileChooser::ACTION_SAVE,
+                                         "gnome-vfs",
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::SAVE,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face.save_as_svg(dialog.filename)
+      end
+      
+      dialog.destroy
+    }       
+  end
+
+  def on_export_as_png1_activate(widget)
+    dialog =  Gtk::FileChooserDialog.new("FaceBuilder - Export face as PNG", nil,
+                                         Gtk::FileChooser::ACTION_SAVE,
+                                         "gnome-vfs",
+                                         [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
+                                         [Gtk::Stock::SAVE,   Gtk::Dialog::RESPONSE_ACCEPT]
+                                         )
+    dialog.run { |response|
+      if response == Gtk::Dialog::RESPONSE_ACCEPT then
+        @face.save_as_png(dialog.filename)
+      end
+      
+      dialog.destroy
+    }    
+  end
+
   def on_paste1_activate(widget)
     puts "on_paste1_activate() is not implemented yet."
   end



From grumbel at berlios.de  Mon Dec 26 17:08:44 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Mon, 26 Dec 2005 17:08:44 +0100
Subject: [Windstille-commit] r1167 - facebuilder
Message-ID: <200512261608.jBQG8i9X032234@sheep.berlios.de>

Author: grumbel
Date: 2005-12-26 17:08:43 +0100 (Mon, 26 Dec 2005)
New Revision: 1167

Modified:
   facebuilder/facebuilder.rb
Log:
- fixed version number

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-26 16:06:31 UTC (rev 1166)
+++ facebuilder/facebuilder.rb	2005-12-26 16:08:43 UTC (rev 1167)
@@ -304,7 +304,7 @@
                           # "logo_icon_name" => "gtk-home",
                           "logo" => Gdk::Pixbuf.new("data/logo.png"),
                           "name" => "Face Builder",
-                          "version" => "0.0.1",
+                          "version" => "0.1.0",
                           "website" => "http://windstille.berlios.de/facebuilder/",
                           "website_label" => "Face Builder"
                           )



From grumbel at berlios.de  Mon Dec 26 17:06:32 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Mon, 26 Dec 2005 17:06:32 +0100
Subject: [Windstille-commit] r1166 - in facebuilder: . examples
Message-ID: <200512261606.jBQG6WQp031989@sheep.berlios.de>

Author: grumbel
Date: 2005-12-26 17:06:31 +0100 (Mon, 26 Dec 2005)
New Revision: 1166

Added:
   facebuilder/icon_rotate_left.png
   facebuilder/icon_rotate_right.png
   facebuilder/icon_size_minus.png
   facebuilder/icon_size_plus.png
Modified:
   facebuilder/examples/pirate.xml
   facebuilder/face.rb
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
- added some icons for resize and rotate

Modified: facebuilder/examples/pirate.xml
===================================================================
--- facebuilder/examples/pirate.xml	2005-12-26 03:48:12 UTC (rev 1165)
+++ facebuilder/examples/pirate.xml	2005-12-26 16:06:31 UTC (rev 1166)
@@ -29,12 +29,6 @@
     <scale>1.0</scale>
     <rotation>0.0</rotation>
   </glasses>
-  <beard>
-    <filename>data/beard/0000.png</filename>
-    <offset><x>0.0</x><y>75.0</y></offset>
-    <scale>1.0</scale>
-    <rotation>0.0</rotation>
-  </beard>
   <eyebrow>
     <filename>data/eyebrow/0001.png</filename>
     <offset><x>37.0</x><y>-25.0</y></offset>

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-26 03:48:12 UTC (rev 1165)
+++ facebuilder/face.rb	2005-12-26 16:06:31 UTC (rev 1166)
@@ -47,7 +47,7 @@
         # Calculate the new position
 
         if event.state & Gdk::Window::SHIFT_MASK == Gdk::Window::SHIFT_MASK
-          @offset.x = 0 # @old_offset.x
+          @offset.x = @old_offset.x
         else
           @offset.x = @old_offset.x + item_x - @x
         end
@@ -71,21 +71,18 @@
     end
   end
 
-  def initialize(parent, root, type, filename, offset)
+  def initialize(parent, root, type, offset)
     @parent = parent
     @type     = type
+    
     @offset   = offset
-    @filename = filename
+    @filename = nil
     @scale    = 1.0
     @rotation = 0
 
     @canvas_items = []
 
-    im = Gdk::Pixbuf.new(@filename)
-    if ! im then 
-      raise "#{@filename}: file not found: #{im.inspect}"
-    end
-
+    im = Gdk::Pixbuf.new("data/empty.png")
     @canvas_items << Gnome::CanvasPixbuf.new(root,
                                              :pixbuf => im,
                                              :x => 0, # offset.x,
@@ -111,6 +108,7 @@
       }
     }
 
+    self.filename=(nil)
     update_items()
   end
 
@@ -191,17 +189,17 @@
   end
 
   def filename=(filename)
+    if @parent.use_undo() and filename != @filename then
+      old_filename = @filename.clone() if @filename
+      new_filename = filename.clone()  if filename
+      @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
+                                                    @parent.get_part(@type).filename=(old_filename) }},
+                                                proc{ @parent.without_undo {
+                                                    @parent.get_part(@type).filename=(new_filename) }}))
+      $facebuilder.update_undo() if $facebuilder
+    end
+    
     if filename and ! filename.empty? then
-      if @parent.use_undo() then
-        old_filename = @filename.clone()
-        new_filename = filename.clone()
-        @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
-                                                      @parent.get_part(@type).filename=(old_filename) }},
-                                                  proc{ @parent.without_undo {
-                                                      @parent.get_part(@type).filename=(new_filename) }}))
-        $facebuilder.update_undo() if $facebuilder
-      end
-
       @canvas_items.each{ |item| item.show() }
       
       @filename = filename    
@@ -286,18 +284,18 @@
 
     @root = root
     @parts  = {
-      :head      => FacePart.new(self, root, :head,      "data/head/0000.png",      Point.new( 0,   0)),
-      :forehead  => FacePart.new(self, root, :forehead,  "data/forehead/0000.png",  Point.new( 0, -75)),
-      :eye       => FacePart.new(self, root, :eye,       "data/eye/0000.png",       Point.new(35, -10)),
-      :eyebrow   => FacePart.new(self, root, :eyebrow,   "data/eyebrow/0000.png",   Point.new(45, -30)),
-      :ear       => FacePart.new(self, root, :ear,       "data/ear/0000.png",       Point.new(90,   0)),
-      :nose      => FacePart.new(self, root, :nose,      "data/nose/0000.png",      Point.new( 0,  30)),
-      :mouth     => FacePart.new(self, root, :mouth,     "data/mouth/0000.png",     Point.new( 0,  75)),
-      :mouthfold => FacePart.new(self, root, :mouthfold, "data/mouthfold/0000.png", Point.new(40,  75)),
-      :beard     => FacePart.new(self, root, :beard,     "data/beard/0000.png",     Point.new( 0,  75)),
-      :glasses   => FacePart.new(self, root, :glasses,   "data/glasses/0000.png",   Point.new( 0, -10)),
-      :hair      => FacePart.new(self, root, :hair,      "data/hair/0000.png",      Point.new( 0, -20)),
-      :hat       => FacePart.new(self, root, :hat,       "data/hat/0000.png",       Point.new( 0, -50))
+      :head      => FacePart.new(self, root, :head,      Point.new( 0,   0)),
+      :forehead  => FacePart.new(self, root, :forehead,  Point.new( 0, -75)),
+      :eye       => FacePart.new(self, root, :eye,       Point.new(35, -10)),
+      :eyebrow   => FacePart.new(self, root, :eyebrow,   Point.new(45, -30)),
+      :ear       => FacePart.new(self, root, :ear,       Point.new(90,   0)),
+      :nose      => FacePart.new(self, root, :nose,      Point.new( 0,  30)),
+      :mouth     => FacePart.new(self, root, :mouth,     Point.new( 0,  75)),
+      :mouthfold => FacePart.new(self, root, :mouthfold, Point.new(40,  75)),
+      :beard     => FacePart.new(self, root, :beard,     Point.new( 0,  75)),
+      :glasses   => FacePart.new(self, root, :glasses,   Point.new( 0, -10)),
+      :hair      => FacePart.new(self, root, :hair,      Point.new( 0, -20)),
+      :hat       => FacePart.new(self, root, :hat,       Point.new( 0, -50))
     }
   end
 

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-26 03:48:12 UTC (rev 1165)
+++ facebuilder/facebuilder.glade	2005-12-26 16:06:31 UTC (rev 1166)
@@ -131,14 +131,6 @@
 		    <widget class="GtkMenu" id="edit1_menu">
 
 		      <child>
-			<widget class="GtkImageMenuItem" id="cut1">
-			  <property name="visible">True</property>
-			  <property name="stock_item">GNOMEUIINFO_MENU_CUT_ITEM</property>
-			  <signal name="activate" handler="on_cut1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
-			</widget>
-		      </child>
-
-		      <child>
 			<widget class="GtkImageMenuItem" id="copy1">
 			  <property name="visible">True</property>
 			  <property name="stock_item">GNOMEUIINFO_MENU_COPY_ITEM</property>
@@ -155,14 +147,6 @@
 		      </child>
 
 		      <child>
-			<widget class="GtkImageMenuItem" id="clear1">
-			  <property name="visible">True</property>
-			  <property name="stock_item">GNOMEUIINFO_MENU_CLEAR_ITEM</property>
-			  <signal name="activate" handler="on_clear1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
-			</widget>
-		      </child>
-
-		      <child>
 			<widget class="GtkSeparatorMenuItem" id="separator2">
 			  <property name="visible">True</property>
 			</widget>
@@ -198,6 +182,21 @@
 		<widget class="GtkMenuItem" id="view1">
 		  <property name="visible">True</property>
 		  <property name="stock_item">GNOMEUIINFO_MENU_VIEW_TREE</property>
+
+		  <child>
+		    <widget class="GtkMenu" id="view1_menu">
+
+		      <child>
+			<widget class="GtkCheckMenuItem" id="show_controls1">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Show Controls</property>
+			  <property name="use_underline">True</property>
+			  <property name="active">False</property>
+			  <signal name="activate" handler="on_show_controls1_activate" last_modification_time="Mon, 26 Dec 2005 14:42:51 GMT"/>
+			</widget>
+		      </child>
+		    </widget>
+		  </child>
 		</widget>
 	      </child>
 
@@ -291,7 +290,7 @@
 	      </child>
 
 	      <child>
-		<widget class="GtkToolButton" id="toolbutton4">
+		<widget class="GtkToolButton" id="toolbutton_save_as_file">
 		  <property name="visible">True</property>
 		  <property name="stock_id">gtk-save-as</property>
 		  <property name="visible_horizontal">True</property>
@@ -371,6 +370,154 @@
 		  <property name="homogeneous">False</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_copy">
+		  <property name="visible">True</property>
+		  <property name="stock_id">gtk-copy</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_paste">
+		  <property name="visible">True</property>
+		  <property name="stock_id">gtk-paste</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkSeparatorToolItem" id="separatortoolitem3">
+		  <property name="visible">True</property>
+		  <property name="draw">True</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">False</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_size_minus">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="icon">icon_size_minus.png</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_size_plus">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="icon">icon_size_plus.png</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkSeparatorToolItem" id="separatortoolitem4">
+		  <property name="visible">True</property>
+		  <property name="draw">True</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">False</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_rotate_left">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="icon">icon_rotate_left.png</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_rotate_right">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="icon">icon_rotate_right.png</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkSeparatorToolItem" id="separatortoolitem5">
+		  <property name="border_width">2</property>
+		  <property name="visible">True</property>
+		  <property name="draw">True</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">False</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_reset_properties">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="stock_id">gtk-media-rewind</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
 	    </widget>
 	  </child>
 	</widget>

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-26 03:48:12 UTC (rev 1165)
+++ facebuilder/facebuilder.rb	2005-12-26 16:06:31 UTC (rev 1166)
@@ -15,8 +15,8 @@
 
   # Creates menu hints.
   def create_uiinfo_menus(name)
-    app = @glade['FaceBuilder']
-    tips = @glade.get_tooltips(app.toplevel)
+    @app = @glade['FaceBuilder']
+    tips = @glade.get_tooltips(@app.toplevel)
     callback_dummy = Proc.new{} #Dummy 
     uiinfos = [
                Gnome::UIInfo::menu_new_item('_New', nil, callback_dummy, nil),
@@ -24,10 +24,8 @@
                Gnome::UIInfo::menu_save_item(callback_dummy, nil),
                Gnome::UIInfo::menu_save_as_item(callback_dummy, nil),
                Gnome::UIInfo::menu_quit_item(callback_dummy, nil),
-               Gnome::UIInfo::menu_cut_item(callback_dummy, nil),
                Gnome::UIInfo::menu_copy_item(callback_dummy, nil),
                Gnome::UIInfo::menu_paste_item(callback_dummy, nil),
-               Gnome::UIInfo::menu_clear_item(callback_dummy, nil),
                Gnome::UIInfo::menu_properties_item(callback_dummy, nil),
                Gnome::UIInfo::menu_preferences_item(callback_dummy, nil),
                Gnome::UIInfo::menu_about_item(callback_dummy, nil),
@@ -37,14 +35,12 @@
     uiinfos[2][9]  = @glade['save1']
     uiinfos[3][9]  = @glade['save_as1']
     uiinfos[4][9]  = @glade['quit1']
-    uiinfos[5][9]  = @glade['cut1']
-    uiinfos[6][9]  = @glade['copy1']
-    uiinfos[7][9]  = @glade['paste1']
-    uiinfos[8][9]  = @glade['clear1']
-    uiinfos[9][9]  = @glade['properties1']
-    uiinfos[10][9] = @glade['preferences1']
-    uiinfos[11][9] = @glade['about1']
-    app.install_menu_hints(uiinfos)
+    uiinfos[5][9]  = @glade['copy1']
+    uiinfos[6][9]  = @glade['paste1']
+    uiinfos[7][9]  = @glade['properties1']
+    uiinfos[8][9] = @glade['preferences1']
+    uiinfos[9][9] = @glade['about1']
+    @app.install_menu_hints(uiinfos)
   end
 
   # Creates tooltips.
@@ -59,6 +55,7 @@
 
     @glade['toolbutton_open_file'].signal_connect("clicked") { |*params| on_open1_activate(nil) }
     @glade['toolbutton_save_file'].signal_connect("clicked") { |*params| on_save_as1_activate(nil) }
+    @glade['toolbutton_save_as_file'].signal_connect("clicked") { |*params| on_save_as1_activate(nil) }
 
     @glade['toolbutton_reload'].signal_connect("clicked") { |*params| 
       @face.reload()
@@ -66,6 +63,33 @@
 
     @glade['toolbutton_undo'].set_sensitive(false)
     @glade['toolbutton_redo'].set_sensitive(false)
+
+    @glade['toolbutton_copy'].signal_connect("clicked")  { |*params| on_copy1_activate(nil) }
+    @glade['toolbutton_paste'].signal_connect("clicked") { |*params| on_paste1_activate(nil) }
+
+    @glade['toolbutton_size_minus'].signal_connect("clicked") { |*params| 
+      part = @face.get_part(@parts[@current_part])
+      part.scale=(part.scale / 1.02) if part
+    }
+    @glade['toolbutton_size_plus'].signal_connect("clicked")  { |*params| 
+      part = @face.get_part(@parts[@current_part])
+      part.scale=(part.scale * 1.02) if part
+    }
+
+    @glade['toolbutton_rotate_left'].signal_connect("clicked")  { |*params|
+      part = @face.get_part(@parts[@current_part])
+      part.rotation=(part.rotation - 1.0) if part
+    }
+    @glade['toolbutton_rotate_right'].signal_connect("clicked") { |*params| 
+      part = @face.get_part(@parts[@current_part])
+      part.rotation=(part.rotation + 1.0) if part
+    }
+
+    @glade['toolbutton_reset_properties'].signal_connect("clicked") {|*params|
+      part = @face.get_part(@parts[@current_part])
+      part.rotation=(0) if part
+      part.scale=(1.0) if part
+    }      
   end
 
   def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
@@ -81,33 +105,40 @@
 
     @canvas = @glade['FaceCanvas']
     @face = Face.new(@canvas.root)
+    @face.load("examples/pirate.xml")
     @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
 
     setup_faceparts()
     setup_partselector()
 
-    setup_controls(@canvas.root, Point.new(0, -200),  :hat)
-    setup_controls(@canvas.root, Point.new(-200, -140),   :forehead)
-    setup_controls(@canvas.root, Point.new(0, 200),   :head)
-    setup_controls(@canvas.root, Point.new(200, -140), :hair)
+    @canvas_controls = []
+    group = Gnome::CanvasGroup.new(@canvas.root, {:x => 0.0, :y => 0.0 })
+
+    setup_controls(group, Point.new(0, -200),  :hat)
+    setup_controls(group, Point.new(-200, -140),   :forehead)
+    setup_controls(group, Point.new(0, 200),   :head)
+    setup_controls(group, Point.new(200, -140), :hair)
     
-    setup_controls(@canvas.root, Point.new(-200, 0), :glasses)
+    setup_controls(group, Point.new(-200, 0), :glasses)
     
-    setup_controls(@canvas.root, Point.new(200, -40), :eyebrow)
-    setup_controls(@canvas.root, Point.new(200, 0),   :eye)
-    setup_controls(@canvas.root, Point.new(200, 40),  :nose)
-    setup_controls(@canvas.root, Point.new(200, 80),  :mouth)
-    setup_controls(@canvas.root, Point.new(-200, 80),  :mouthfold)
+    setup_controls(group, Point.new(200, -40), :eyebrow)
+    setup_controls(group, Point.new(200, 0),   :eye)
+    setup_controls(group, Point.new(200, 40),  :nose)
+    setup_controls(group, Point.new(200, 80),  :mouth)
+    setup_controls(group, Point.new(-200, 80),  :mouthfold)
 
+    hide_controls()
+
     Gnome::CanvasText.new(@canvas.root,
                           {:text => 
                             "PgUp, PgDown:\tscale\n" +
                             "Home, End:\t\trotate\n" +
-                            "Cursorkeys:\t\tmove\n",
-                            :x => -180,
-                            :y => 180,
+                            "Cursorkeys:\t\tmove\n" +
+                            "Cursor+Shift:\tmove vertical",
+                            :x => -256,
+                            :y => 256,
                             :font => "Sans 10",
-                            :anchor => Gtk::ANCHOR_N,
+                            :anchor => Gtk::ANCHOR_SW,
                             :fill_color => "black"})
 
     @canvas.signal_connect_after("button-press-event") { |widget, event|
@@ -165,6 +196,13 @@
         part.offset = Point.new(part.offset.x + 1, part.offset.y) if part
       end
     }
+
+    @glade['toolbutton_copy'].set_sensitive(false)
+    @glade['toolbutton_paste'].set_sensitive(false)
+    @glade['copy1'].set_sensitive(false)
+    @glade['paste1'].set_sensitive(false)
+    @glade['properties1'].set_sensitive(false)
+    @glade['preferences1'].set_sensitive(false)
   end
 
   def on_undo()
@@ -194,7 +232,7 @@
   end
 
   def on_export_as_svg1_activate(widget)
-    dialog =  Gtk::FileChooserDialog.new("FaceBuilder - Export face as PNG", nil,
+    dialog =  Gtk::FileChooserDialog.new("FaceBuilder - Export face as SVG", nil,
                                          Gtk::FileChooser::ACTION_SAVE,
                                          "gnome-vfs",
                                          [Gtk::Stock::CANCEL, Gtk::Dialog::RESPONSE_CANCEL],
@@ -227,7 +265,19 @@
 
   def on_paste1_activate(widget)
     puts "on_paste1_activate() is not implemented yet."
+
+    clipboard = @app.get_clipboard(Gdk::Selection::CLIPBOARD)
+
+    clipboard.request_text{|clipboard, text| 
+      puts "GOt: >>#{text}<<"
+    }
+
+    clipboard.request_contents(Gdk::Atom.intern("CLIPBOARD", false)) { |clipboard, selection_data| 
+      puts selection_data.type, selection_data.text
+    }
+
   end
+
   def on_save_as1_activate(widget)
     dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
                                          Gtk::FileChooser::ACTION_SAVE,
@@ -262,8 +312,11 @@
   def on_preferences1_activate(widget)
     puts "on_preferences1_activate() is not implemented yet."
   end
+
   def on_copy1_activate(widget)
     puts "on_copy1_activate() is not implemented yet."
+    clipboard = @canvas.get_clipboard(Gdk::Selection::CLIPBOARD)
+    # puts clipboard.text
   end
   def on_new1_activate(widget)
     puts "on_new1_activate() is not implemented yet."
@@ -280,10 +333,26 @@
   def on_properties1_activate(widget)
     puts "on_properties1_activate() is not implemented yet."
   end
+  def on_show_controls1_activate(widget)
+    if widget.active? then
+      show_controls()
+    else
+      hide_controls()
+    end
+  end
+
   def on_quit1_activate(widget)
     Gtk.main_quit
   end
 
+  def hide_controls()
+    @canvas_controls.each {|item| item.hide() }
+  end
+
+  def show_controls()
+    @canvas_controls.each {|item| item.show() }
+  end
+
   def setup_controls(root, pos, facepart)
     left = Gtk::Button.new("<-")
     Gnome::CanvasWidget.new(root,
@@ -314,6 +383,8 @@
       @face.get_part(facepart).next_item()
       set_current_part(facepart)
     }
+    @canvas_controls += [left, right]
+
     return [left, right]
   end
 

Added: facebuilder/icon_rotate_left.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/icon_rotate_left.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/icon_rotate_right.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/icon_rotate_right.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/icon_size_minus.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/icon_size_minus.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/icon_size_plus.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/icon_size_plus.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Wed Dec 28 00:11:52 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 28 Dec 2005 00:11:52 +0100
Subject: [Windstille-commit] r1168 - in facebuilder: . data/ear data/eye data/hair data/head data/nose examples
Message-ID: <200512272311.jBRNBqMA025742@sheep.berlios.de>

Author: grumbel
Date: 2005-12-28 00:11:44 +0100 (Wed, 28 Dec 2005)
New Revision: 1168

Added:
   facebuilder/data/ear/0001.png
   facebuilder/data/eye/0016.png
   facebuilder/data/hair/0026.png
   facebuilder/data/hair/0027.png
   facebuilder/data/head/0007.png
   facebuilder/data/nose/0007.png
   facebuilder/examples/women8.xml
Modified:
   facebuilder/NEWS
   facebuilder/README
   facebuilder/face.rb
   facebuilder/index.html
Log:
- more body parts

Modified: facebuilder/NEWS
===================================================================
--- facebuilder/NEWS	2005-12-26 16:08:43 UTC (rev 1167)
+++ facebuilder/NEWS	2005-12-27 23:11:44 UTC (rev 1168)
@@ -7,9 +7,10 @@
 
 * face parts are moveable with the mouse
 * plenty of more faceparts
-* faceparts are now all shaded
+* faceparts are mostly shaded
 * simple undo/redo
 * SVG export
 * PNG export
+* list instead of buttons to select faceparts from 
 
 # EOF #

Modified: facebuilder/README
===================================================================
--- facebuilder/README	2005-12-26 16:08:43 UTC (rev 1167)
+++ facebuilder/README	2005-12-27 23:11:44 UTC (rev 1168)
@@ -6,7 +6,7 @@
 by putting together eyes, nose, mouth, head, hair and some additional
 items. You can also move, scale and rotate each of those face-parts as
 you like. The results can be saved to XML files and it currently
-provides ~50 faceparts in total.
+provides ~100 faceparts in total.
 
 Running
 -------

Added: facebuilder/data/ear/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/ear/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0016.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0016.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0026.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0026.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0027.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0027.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/examples/women8.xml
===================================================================
--- facebuilder/examples/women8.xml	2005-12-26 16:08:43 UTC (rev 1167)
+++ facebuilder/examples/women8.xml	2005-12-27 23:11:44 UTC (rev 1168)
@@ -0,0 +1,50 @@
+<face>
+  <head>
+    <filename>data/head/0007.png</filename>
+    <offset><x>1.0</x><y>1.0</y></offset>
+    <scale>0.942322334547044</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>78.0</x><y>24.0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>0.0</x><y>74.0</y></offset>
+    <scale>0.804263039093289</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0026.png</filename>
+    <offset><x>17.0</x><y>2.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0015.png</filename>
+    <offset><x>33.0</x><y>3.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>37.0</x><y>-25.0</y></offset>
+    <scale>1.0404</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>31.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0005.png</filename>
+    <offset><x>1.0</x><y>7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+</face>

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-26 16:08:43 UTC (rev 1167)
+++ facebuilder/face.rb	2005-12-27 23:11:44 UTC (rev 1168)
@@ -285,10 +285,10 @@
     @root = root
     @parts  = {
       :head      => FacePart.new(self, root, :head,      Point.new( 0,   0)),
+      :ear       => FacePart.new(self, root, :ear,       Point.new(90,   0)),
       :forehead  => FacePart.new(self, root, :forehead,  Point.new( 0, -75)),
       :eye       => FacePart.new(self, root, :eye,       Point.new(35, -10)),
       :eyebrow   => FacePart.new(self, root, :eyebrow,   Point.new(45, -30)),
-      :ear       => FacePart.new(self, root, :ear,       Point.new(90,   0)),
       :nose      => FacePart.new(self, root, :nose,      Point.new( 0,  30)),
       :mouth     => FacePart.new(self, root, :mouth,     Point.new( 0,  75)),
       :mouthfold => FacePart.new(self, root, :mouthfold, Point.new(40,  75)),

Modified: facebuilder/index.html
===================================================================
--- facebuilder/index.html	2005-12-26 16:08:43 UTC (rev 1167)
+++ facebuilder/index.html	2005-12-27 23:11:44 UTC (rev 1168)
@@ -26,12 +26,14 @@
       </pre>
 
       <h2>Screenshots</h2>
+      <a href="images/screenshot-0.1.0-1.png"><img src="images/screenshot-0.1.0-1_thumb.jpg" /></a>
       <a href="images/screenshot-0.0.1-1.png"><img src="images/screenshot-0.0.1-1_thumb.jpg" /></a>
       <a href="images/screenshot-0.0.1-2.png"><img src="images/screenshot-0.0.1-2_thumb.jpg" /></a>
       
       <h2>Download</h2>
       <h3>Ruby/Gtk</h3>
       <ul>
+        <li><a href="http://pingus.seul.org/~grumbel/tmp/facebuilder-0.1.0.tar.gz">facebuilder-0.1.0.tar.gz</a></li>
         <li><a href="http://pingus.seul.org/~grumbel/tmp/facebuilder-0.0.1.tar.gz">facebuilder-0.0.1.tar.gz</a></li>
       </ul>
 



From grumbel at berlios.de  Wed Dec 28 15:26:44 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 28 Dec 2005 15:26:44 +0100
Subject: [Windstille-commit] r1169 - in facebuilder: . data/beard data/eye data/eyebrow data/hair data/head data/mouth data/nose examples
Message-ID: <200512281426.jBSEQiJM032481@sheep.berlios.de>

Author: grumbel
Date: 2005-12-28 15:26:35 +0100 (Wed, 28 Dec 2005)
New Revision: 1169

Added:
   facebuilder/data/beard/0001.png
   facebuilder/data/eyebrow/0005.png
   facebuilder/data/hair/0028.png
   facebuilder/data/hair/0029.png
   facebuilder/data/hair/0030.png
   facebuilder/data/head/0008.png
   facebuilder/data/head/0009.png
   facebuilder/data/head/0010.png
   facebuilder/data/mouth/0008.png
   facebuilder/examples/male1.xml
   facebuilder/examples/male2.xml
   facebuilder/examples/male3.xml
   facebuilder/examples/male4.xml
   facebuilder/examples/male5.xml
   facebuilder/examples/male6.xml
   facebuilder/examples/male7.xml
   facebuilder/examples/male8.xml
   facebuilder/examples/male9.xml
Modified:
   facebuilder/data/eye/0005.png
   facebuilder/data/nose/0007.png
   facebuilder/face.rb
   facebuilder/facebuilder.rb
Log:
- more faceparts
- removed gettext support

Added: facebuilder/data/beard/0001.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/beard/0001.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/eye/0005.png
===================================================================
(Binary files differ)

Added: facebuilder/data/eyebrow/0005.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0005.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0028.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0028.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0029.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0029.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0030.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0030.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0008.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0008.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0009.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0010.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0008.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0008.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/data/nose/0007.png
===================================================================
(Binary files differ)

Added: facebuilder/examples/male1.xml
===================================================================
--- facebuilder/examples/male1.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male1.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,44 @@
+<face>
+  <head>
+    <filename>data/head/0008.png</filename>
+    <offset><x>2.0</x><y>15.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>82.0</x><y>27.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>-1.0</x><y>85.0</y></offset>
+    <scale>0.530633303517793</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0003.png</filename>
+    <offset><x>2.0</x><y>0.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>35.0</x><y>2.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>34.0</x><y>-10.0</y></offset>
+    <scale>1.19509256862231</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>36.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/male2.xml
===================================================================
--- facebuilder/examples/male2.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male2.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,44 @@
+<face>
+  <head>
+    <filename>data/head/0008.png</filename>
+    <offset><x>0.0</x><y>16.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>82.0</x><y>27.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>-1.0</x><y>91.0</y></offset>
+    <scale>0.541245969588149</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0028.png</filename>
+    <offset><x>3.0</x><y>15.0</y></offset>
+    <scale>0.804263039093289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0016.png</filename>
+    <offset><x>35.0</x><y>14.0</y></offset>
+    <scale>0.686430759770219</scale>
+    <rotation>0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>36.0</x><y>-2.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>40.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/male3.xml
===================================================================
--- facebuilder/examples/male3.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male3.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,44 @@
+<face>
+  <head>
+    <filename>data/head/0007.png</filename>
+    <offset><x>-1.0</x><y>20.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>82.0</x><y>27.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>-1.0</x><y>91.0</y></offset>
+    <scale>0.541245969588149</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0028.png</filename>
+    <offset><x>3.0</x><y>15.0</y></offset>
+    <scale>0.804263039093289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0016.png</filename>
+    <offset><x>35.0</x><y>14.0</y></offset>
+    <scale>0.686430759770219</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>36.0</x><y>-2.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>40.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/male4.xml
===================================================================
--- facebuilder/examples/male4.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male4.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,56 @@
+<face>
+  <head>
+    <filename>data/head/0007.png</filename>
+    <offset><x>-1.0</x><y>20.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>82.0</x><y>27.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>-1.0</x><y>91.0</y></offset>
+    <scale>0.541245969588149</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0028.png</filename>
+    <offset><x>3.0</x><y>12.0</y></offset>
+    <scale>0.804263039093289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <hat>
+    <filename>data/hat/0003.png</filename>
+    <offset><x>239.0</x><y>-150.0</y></offset>
+    <scale>1.061208</scale>
+    <rotation>0.0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0016.png</filename>
+    <offset><x>35.0</x><y>14.0</y></offset>
+    <scale>0.686430759770219</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>36.0</x><y>-2.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>40.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0011.png</filename>
+    <offset><x>0.0</x><y>16.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+</face>

Added: facebuilder/examples/male5.xml
===================================================================
--- facebuilder/examples/male5.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male5.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,50 @@
+<face>
+  <head>
+    <filename>data/head/0009.png</filename>
+    <offset><x>0.0</x><y>47.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>85.0</x><y>51.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>1.0</x><y>102.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0029.png</filename>
+    <offset><x>-1.0</x><y>44.0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>34.0</x><y>27.0</y></offset>
+    <scale>0.961168781237985</scale>
+    <rotation>0</rotation>
+  </eye>
+  <beard>
+    <filename>data/beard/0001.png</filename>
+    <offset><x>1.0</x><y>58.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>35.0</x><y>10.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>2.0</x><y>49.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/male6.xml
===================================================================
--- facebuilder/examples/male6.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male6.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,50 @@
+<face>
+  <head>
+    <filename>data/head/0009.png</filename>
+    <offset><x>0.0</x><y>47.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>85.0</x><y>51.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0008.png</filename>
+    <offset><x>-1.0</x><y>105.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0029.png</filename>
+    <offset><x>-1.0</x><y>44.0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>34.0</x><y>27.0</y></offset>
+    <scale>0.961168781237985</scale>
+    <rotation>0</rotation>
+  </eye>
+  <beard>
+    <filename>data/beard/0001.png</filename>
+    <offset><x>-1.0</x><y>54.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>35.0</x><y>10.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>46.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/male7.xml
===================================================================
--- facebuilder/examples/male7.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male7.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,44 @@
+<face>
+  <head>
+    <filename>data/head/0010.png</filename>
+    <offset><x>1.0</x><y>21.0</y></offset>
+    <scale>0.773032525080055</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>75.0</x><y>32.0</y></offset>
+    <scale>0.773032525080055</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>-1.0</x><y>85.0</y></offset>
+    <scale>0.788493175581656</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0030.png</filename>
+    <offset><x>4.0</x><y>34.0</y></offset>
+    <scale>0.820348299875155</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0016.png</filename>
+    <offset><x>35.0</x><y>8.0</y></offset>
+    <scale>0.634155917697622</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0000.png</filename>
+    <offset><x>34.0</x><y>-9.0</y></offset>
+    <scale>0.597579284831646</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>35.0</y></offset>
+    <scale>0.820348299875155</scale>
+    <rotation>0.0</rotation>
+  </nose>
+</face>

Added: facebuilder/examples/male8.xml
===================================================================
--- facebuilder/examples/male8.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male8.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,62 @@
+<face>
+  <head>
+    <filename>data/head/0010.png</filename>
+    <offset><x>2.0</x><y>50.0</y></offset>
+    <scale>0.773032525080055</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>81.0</x><y>54.0</y></offset>
+    <scale>0.887971382186192</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>1.0</x><y>106.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0030.png</filename>
+    <offset><x>3.0</x><y>46.0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <hat>
+    <filename>data/hat/0003.png</filename>
+    <offset><x>-2.0</x><y>-20.0</y></offset>
+    <scale>1.08243216</scale>
+    <rotation>0.0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>34.0</x><y>27.0</y></offset>
+    <scale>0.961168781237985</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <beard>
+    <filename>data/beard/0001.png</filename>
+    <offset><x>1.0</x><y>61.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0.0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>35.0</x><y>10.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>2.0</x><y>54.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0004.png</filename>
+    <offset><x>-5.0</x><y>27.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+</face>

Added: facebuilder/examples/male9.xml
===================================================================
--- facebuilder/examples/male9.xml	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/examples/male9.xml	2005-12-28 14:26:35 UTC (rev 1169)
@@ -0,0 +1,56 @@
+<face>
+  <head>
+    <filename>data/head/0008.png</filename>
+    <offset><x>-1.0</x><y>2.0</y></offset>
+    <scale>0.942322334547044</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>84.0</x><y>9.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0002.png</filename>
+    <offset><x>0.0</x><y>71.0</y></offset>
+    <scale>0.480610931717894</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0030.png</filename>
+    <offset><x>3.0</x><y>15.0</y></offset>
+    <scale>0.820348299875155</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <eye>
+    <filename>data/eye/0016.png</filename>
+    <offset><x>35.0</x><y>-5.0</y></offset>
+    <scale>0.646839036051574</scale>
+    <rotation>0</rotation>
+  </eye>
+  <beard>
+    <filename>data/beard/0001.png</filename>
+    <offset><x>0.0</x><y>28.0</y></offset>
+    <scale>0.659775816772605</scale>
+    <rotation>0.0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0001.png</filename>
+    <offset><x>37.0</x><y>-25.0</y></offset>
+    <scale>1.0404</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0005.png</filename>
+    <offset><x>0.0</x><y>20.0</y></offset>
+    <scale>0.887971382186192</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0005.png</filename>
+    <offset><x>-1.0</x><y>-2.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+</face>

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/face.rb	2005-12-28 14:26:35 UTC (rev 1169)
@@ -287,12 +287,12 @@
       :head      => FacePart.new(self, root, :head,      Point.new( 0,   0)),
       :ear       => FacePart.new(self, root, :ear,       Point.new(90,   0)),
       :forehead  => FacePart.new(self, root, :forehead,  Point.new( 0, -75)),
+      :beard     => FacePart.new(self, root, :beard,     Point.new( 0,  75)),
       :eye       => FacePart.new(self, root, :eye,       Point.new(35, -10)),
       :eyebrow   => FacePart.new(self, root, :eyebrow,   Point.new(45, -30)),
       :nose      => FacePart.new(self, root, :nose,      Point.new( 0,  30)),
       :mouth     => FacePart.new(self, root, :mouth,     Point.new( 0,  75)),
       :mouthfold => FacePart.new(self, root, :mouthfold, Point.new(40,  75)),
-      :beard     => FacePart.new(self, root, :beard,     Point.new( 0,  75)),
       :glasses   => FacePart.new(self, root, :glasses,   Point.new( 0, -10)),
       :hair      => FacePart.new(self, root, :hair,      Point.new( 0, -20)),
       :hat       => FacePart.new(self, root, :hat,       Point.new( 0, -50))

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-27 23:11:44 UTC (rev 1168)
+++ facebuilder/facebuilder.rb	2005-12-28 14:26:35 UTC (rev 1169)
@@ -8,8 +8,6 @@
 Point = Struct.new("Point", :x, :y)
 
 class FacebuilderGlade
-  include GetText
-
   attr :glade
   attr :canvas
 
@@ -46,9 +44,9 @@
   # Creates tooltips.
   def create_tooltips
     @tooltip = Gtk::Tooltips.new
-    @glade['toolbutton1'].set_tooltip(@tooltip, _('New File'))
-    @glade['toolbutton_open_file'].set_tooltip(@tooltip, _('Open File'))
-    @glade['toolbutton_save_file'].set_tooltip(@tooltip, _('Save File'))
+    @glade['toolbutton1'].set_tooltip(@tooltip, 'New File')
+    @glade['toolbutton_open_file'].set_tooltip(@tooltip, 'Open File')
+    @glade['toolbutton_save_file'].set_tooltip(@tooltip, 'Save File')
 
     @glade['toolbutton_undo'].signal_connect("clicked") { |*params| self.on_undo() }
     @glade['toolbutton_redo'].signal_connect("clicked") { |*params| self.on_redo() }
@@ -93,7 +91,6 @@
   end
 
   def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
-    bindtextdomain(domain, localedir, nil, "UTF-8")
     @glade = GladeXML.new(path_or_data, root, domain, localedir, flag) {|handler| method(handler)}
     
     create_uiinfo_menus(domain)



From grumbel at berlios.de  Wed Dec 28 19:49:46 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 28 Dec 2005 19:49:46 +0100
Subject: [Windstille-commit] r1170 - in facebuilder: . data/beard data/eye data/mouth data/nose
Message-ID: <200512281849.jBSInkLw001588@sheep.berlios.de>

Author: grumbel
Date: 2005-12-28 19:49:42 +0100 (Wed, 28 Dec 2005)
New Revision: 1170

Added:
   facebuilder/data/beard/0003.png
   facebuilder/data/eye/0017.png
   facebuilder/data/mouth/0009.png
   facebuilder/data/nose/0008.png
Modified:
   facebuilder/NEWS
   facebuilder/face.rb
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
 - some more body parts
- some bugfixes

Modified: facebuilder/NEWS
===================================================================
--- facebuilder/NEWS	2005-12-28 14:26:35 UTC (rev 1169)
+++ facebuilder/NEWS	2005-12-28 18:49:42 UTC (rev 1170)
@@ -2,6 +2,15 @@
 | FaceBuilder News
 +--------------
 
+FaceBuilder 0.1.1
+=================
+* some more male faceparts
+* removed gettext dependency
+* new buttons to center horizontal and vertical
+* fixed loading
+* quit properly when window close button is pressed
+
+
 FaceBuilder 0.1.0
 =================
 

Added: facebuilder/data/beard/0003.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/beard/0003.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eye/0017.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0017.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0009.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0008.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0008.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-28 14:26:35 UTC (rev 1169)
+++ facebuilder/face.rb	2005-12-28 18:49:42 UTC (rev 1170)
@@ -359,6 +359,13 @@
   def load(filename)
     file = File.new( filename )
     doc = REXML::Document.new(file)
+    @parts.each { |key, part|
+      part.rotation = 0.0
+      part.scale    = 1.0
+      part.filename = nil
+      part.offset   = Point.new(0, 0)
+    }
+
     doc.elements.each("face/*") { |element|
       part = element.name.to_sym
       @parts[part].rotation = element.elements['rotation'].text.to_f

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-28 14:26:35 UTC (rev 1169)
+++ facebuilder/facebuilder.glade	2005-12-28 18:49:42 UTC (rev 1170)
@@ -23,6 +23,7 @@
   <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
   <property name="focus_on_map">True</property>
   <property name="enable_layout_config">True</property>
+  <signal name="delete_event" handler="on_quit" />
 
   <child internal-child="dock">
     <widget class="BonoboDock" id="bonobodock1">
@@ -518,6 +519,38 @@
 		  <property name="homogeneous">True</property>
 		</packing>
 	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_center_horizontal">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="icon">icon_center_horizontal.png</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
+
+	      <child>
+		<widget class="GtkToolButton" id="toolbutton_center_vertical">
+		  <property name="visible">True</property>
+		  <property name="label" translatable="yes"></property>
+		  <property name="use_underline">True</property>
+		  <property name="icon">icon_center_vertical.png</property>
+		  <property name="visible_horizontal">True</property>
+		  <property name="visible_vertical">True</property>
+		  <property name="is_important">False</property>
+		</widget>
+		<packing>
+		  <property name="expand">False</property>
+		  <property name="homogeneous">True</property>
+		</packing>
+	      </child>
 	    </widget>
 	  </child>
 	</widget>

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-28 14:26:35 UTC (rev 1169)
+++ facebuilder/facebuilder.rb	2005-12-28 18:49:42 UTC (rev 1170)
@@ -4,6 +4,7 @@
 #
 require 'libglade2'
 require 'face.rb'
+require 'command_line.rb'
 
 Point = Struct.new("Point", :x, :y)
 
@@ -44,6 +45,7 @@
   # Creates tooltips.
   def create_tooltips
     @tooltip = Gtk::Tooltips.new
+
     @glade['toolbutton1'].set_tooltip(@tooltip, 'New File')
     @glade['toolbutton_open_file'].set_tooltip(@tooltip, 'Open File')
     @glade['toolbutton_save_file'].set_tooltip(@tooltip, 'Save File')
@@ -74,6 +76,16 @@
       part.scale=(part.scale * 1.02) if part
     }
 
+    @glade['toolbutton_center_vertical'].signal_connect("clicked")  { |*params| 
+      part = @face.get_part(@parts[@current_part])
+      part.offset = Point.new(part.offset.x, 0) if part
+    }
+
+    @glade['toolbutton_center_horizontal'].signal_connect("clicked")  { |*params| 
+      part = @face.get_part(@parts[@current_part])
+      part.offset = Point.new(0, part.offset.y) if part
+    }
+
     @glade['toolbutton_rotate_left'].signal_connect("clicked")  { |*params|
       part = @face.get_part(@parts[@current_part])
       part.rotation=(part.rotation - 1.0) if part
@@ -91,8 +103,8 @@
   end
 
   def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
-    @glade = GladeXML.new(path_or_data, root, domain, localedir, flag) {|handler| method(handler)}
-    
+    @glade = GladeXML.new(path_or_data, root, domain, localedir, flag) {|handler| method(handler) }
+
     create_uiinfo_menus(domain)
     create_tooltips
 
@@ -102,7 +114,11 @@
 
     @canvas = @glade['FaceCanvas']
     @face = Face.new(@canvas.root)
-    @face.load("examples/pirate.xml")
+    if $startupfile then
+      @face.load($startupfile)
+    else
+      @face.load("examples/pirate.xml")
+    end
     @canvas.modify_bg(Gtk::STATE_NORMAL, Gdk::Color.new(65535, 65535, 65535))
 
     setup_faceparts()
@@ -488,21 +504,65 @@
     }   
   end
 
+  def on_quit
+    Gtk.main_quit
+  end
+
+
   def update_undo()
     @glade['toolbutton_undo'].set_sensitive(@face.has_undo_stack?)
     @glade['toolbutton_redo'].set_sensitive(@face.has_redo_stack?)
   end
 end
 
+def init_command_line()
+  @cmd = CommandLine.new() {
+    name("FaceBuilder 0.1.1")
+    usage("[OPTION]... [FILE]...")
+    description("A little toy application for creating faces.")
+    
+    group("Display")
+    option(?h, "help",       nil,            "Print this help")
+
+    text("Report bugs to <grumbel at gmx.de>.")
+  }
+end
+
+def eval_command_line(argv)
+  begin
+    args = @cmd.parse(argv)
+  rescue CommandLineException => err
+    puts('FaceBuilder:' + err)
+    exit()
+  end
+
+  args.each { |option, argument|
+    case option
+    when ?h
+      @cmd.print_help()
+      @cmd.exit()
+      exit()
+
+    when :rest
+      $startupfile = argument
+
+    else
+      raise "Bug: Unhandled option: -#{option} #{argument}"
+    end
+  }
+end
+
+
 # Main program
 if __FILE__ == $0
+  init_command_line()
+  eval_command_line(ARGV)
+
   # Set values as your own application. 
   PROG_PATH = "facebuilder.glade"
   PROG_NAME = "FaceBuilder"
   PROG_VERSION = "0.1.0"
   Gnome::Program.new(PROG_NAME, PROG_VERSION)
-  #If you use Ruby/GTK2 widgets only, call Gtk.init not Gnome::Program.new here.
-  #Gtk.init
   $facebuilder = FacebuilderGlade.new(PROG_PATH, nil, PROG_NAME)
   Gtk.main
 end



From grumbel at berlios.de  Wed Dec 28 20:45:17 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Wed, 28 Dec 2005 20:45:17 +0100
Subject: [Windstille-commit] r1171 - in facebuilder: . examples images
Message-ID: <200512281945.jBSJjHxZ005226@sheep.berlios.de>

Author: grumbel
Date: 2005-12-28 20:45:04 +0100 (Wed, 28 Dec 2005)
New Revision: 1171

Added:
   facebuilder/examples/pirate2.xml
   facebuilder/examples/pirate3.xml
   facebuilder/icon_center_horizontal.png
   facebuilder/icon_center_vertical.png
   facebuilder/images/screenshot-0.1.0-1.png
   facebuilder/images/screenshot-0.1.0-1_thumb.jpg
Log:
- some more faceparts

Added: facebuilder/examples/pirate2.xml
===================================================================
--- facebuilder/examples/pirate2.xml	2005-12-28 18:49:42 UTC (rev 1170)
+++ facebuilder/examples/pirate2.xml	2005-12-28 19:45:04 UTC (rev 1171)
@@ -0,0 +1,62 @@
+<face>
+  <hat>
+    <filename>data/hat/0003.png</filename>
+    <offset><x>-2.0</x><y>-65.0</y></offset>
+    <scale>1.08243216</scale>
+    <rotation>0.0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>34.0</x><y>-14.0</y></offset>
+    <scale>0.961168781237985</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <beard>
+    <filename>data/beard/0001.png</filename>
+    <offset><x>0</x><y>23.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0.0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>35.0</x><y>-29.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0</x><y>17.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0004.png</filename>
+    <offset><x>-3.0</x><y>-12.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+  <head>
+    <filename>data/head/0010.png</filename>
+    <offset><x>0</x><y>0</y></offset>
+    <scale>0.773032525080055</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>81.0</x><y>3.0</y></offset>
+    <scale>0.887971382186192</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0006.png</filename>
+    <offset><x>0</x><y>68.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0030.png</filename>
+    <offset><x>3.0</x><y>0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+</face>

Added: facebuilder/examples/pirate3.xml
===================================================================
--- facebuilder/examples/pirate3.xml	2005-12-28 18:49:42 UTC (rev 1170)
+++ facebuilder/examples/pirate3.xml	2005-12-28 19:45:04 UTC (rev 1171)
@@ -0,0 +1,62 @@
+<face>
+  <hat>
+    <filename>data/hat/0003.png</filename>
+    <offset><x>2.0</x><y>-25.0</y></offset>
+    <scale>1.061208</scale>
+    <rotation>0.0</rotation>
+  </hat>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>34.0</x><y>27.0</y></offset>
+    <scale>0.961168781237985</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <beard>
+    <filename>data/beard/0001.png</filename>
+    <offset><x>-1.0</x><y>54.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0.0</rotation>
+  </beard>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>35.0</x><y>10.0</y></offset>
+    <scale>0.757875024588288</scale>
+    <rotation>-6.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>46.0</y></offset>
+    <scale>0.923845426026514</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0004.png</filename>
+    <offset><x>-3.0</x><y>27.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+  <head>
+    <filename>data/head/0009.png</filename>
+    <offset><x>0.0</x><y>47.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>85.0</x><y>51.0</y></offset>
+    <scale>0.905730809829916</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0008.png</filename>
+    <offset><x>-1.0</x><y>105.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0029.png</filename>
+    <offset><x>-1.0</x><y>44.0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </hair>
+</face>

Added: facebuilder/icon_center_horizontal.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/icon_center_horizontal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/icon_center_vertical.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/icon_center_vertical.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/images/screenshot-0.1.0-1.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/screenshot-0.1.0-1.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/images/screenshot-0.1.0-1_thumb.jpg
===================================================================
(Binary files differ)


Property changes on: facebuilder/images/screenshot-0.1.0-1_thumb.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Thu Dec 29 04:25:02 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Thu, 29 Dec 2005 04:25:02 +0100
Subject: [Windstille-commit] r1172 - in facebuilder/data: eye eyebrow hair head mouth nose
Message-ID: <200512290325.jBT3P224008104@sheep.berlios.de>

Author: grumbel
Date: 2005-12-29 04:24:55 +0100 (Thu, 29 Dec 2005)
New Revision: 1172

Added:
   facebuilder/data/eye/0018.png
   facebuilder/data/eyebrow/0006.png
   facebuilder/data/hair/0031.png
   facebuilder/data/head/0011.png
   facebuilder/data/mouth/0010.png
   facebuilder/data/nose/0009.png
Log:
- some more faceparts

Added: facebuilder/data/eye/0018.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0018.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0006.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0006.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/hair/0031.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0031.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0011.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0010.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0009.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0009.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Thu Dec 29 05:21:32 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Thu, 29 Dec 2005 05:21:32 +0100
Subject: [Windstille-commit] r1173 - facebuilder
Message-ID: <200512290421.jBT4LWh2014182@sheep.berlios.de>

Author: grumbel
Date: 2005-12-29 05:21:28 +0100 (Thu, 29 Dec 2005)
New Revision: 1173

Added:
   facebuilder/command_line.rb
Log:
- some more faceparts

Added: facebuilder/command_line.rb
===================================================================
--- facebuilder/command_line.rb	2005-12-29 03:24:55 UTC (rev 1172)
+++ facebuilder/command_line.rb	2005-12-29 04:21:28 UTC (rev 1173)
@@ -0,0 +1,186 @@
+##  $Id$
+## 
+##  Flexlay - A Generic 2D Game Editor
+##  Copyright (C) 2002 Ingo Ruhnke <grumbel at gmx.de>
+##
+##  This program is free software; you can redistribute it and/or
+##  modify it under the terms of the GNU General Public License
+##  as published by the Free Software Foundation; either version 2
+##  of the License, or (at your option) any later version.
+##
+##  This program is distributed in the hope that it will be useful,
+##  but WITHOUT ANY WARRANTY; without even the implied warranty of
+##  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+##  GNU General Public License for more details.
+## 
+##  You should have received a copy of the GNU General Public License
+##  along with this program; if not, write to the Free Software
+##  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+# A parser for command line arguments
+class CommandLineOption
+  attr_reader :short, :long, :argument, :description
+
+  def initialize(short, long, argument, description)
+    @short = short
+    @long  = long
+    @argument = argument
+    @description = description
+  end
+end
+
+class CommandLineException < RuntimeError
+end
+
+class CommandLine
+  def initialize(&block)
+    @options = []
+    @name    = nil
+    @usage   = nil
+    @help    = []
+    @description = nil
+
+    if block then
+      instance_eval(&block);
+    end
+  end
+
+  def name(name)
+    @name = name
+  end
+
+  def usage(usage)
+    @usage = usage
+  end
+
+  def description(description)
+    @description = description
+  end
+
+  def group(group)
+    @help.push("\n" + group + ":")
+  end
+
+  def text(text)
+    @help.push("\n" + text)
+  end
+
+  def option(short, long, argument, description)
+    cmd = CommandLineOption.new(short, long, argument, description)
+    @options.push(cmd)
+    @help.push(cmd)
+  end
+
+  def parse(args)
+    result = []
+    args = args.reverse()
+
+    @stop_parsing = false
+    while not args.empty? and not @stop_parsing
+      current = args.pop
+      
+      if current == "--" then
+        while not args.empty?
+          result.push([:rest, args.pop])
+        end
+        
+      elsif current == "-" then
+        result.push([:rest, current])
+
+      elsif current[0] == ?- then
+        if current[1] == ?- then
+          long_option = current[2..-1]
+          cmd = @options.find {|item| item.long == long_option }
+          
+          if not cmd then
+            raise CommandLineException, "unrecoginzed option '#{current}'"
+          else
+            if cmd.argument then
+              if args.empty? then
+                raise "Error: Option '#{current}' requires argument of type '#{cmd.argument}'"
+              else
+                result.push([cmd.short, args.pop()])
+              end
+            else
+              result.push([cmd.short, nil])
+            end
+          end
+
+        else
+          # short option
+          short_options = current[1..-1]
+          
+          while not short_options.empty? 
+            short = short_options[0]
+            short_options = short_options[1..-1]
+
+            cmd = @options.find {|item| item.short == short}
+            
+            if not cmd then
+              raise CommandLineException, "unrecoginzed option '#{current}'"
+            else
+              if cmd.argument then
+                if not short_options.empty? then
+                  result.push([cmd.short, short_options])
+                  short_options = ""
+                else
+                  if args.empty? then
+                    raise CommandLineException, "Error: Option '#{current}' requires argument of type '#{cmd.argument}'"
+                  else
+                    result.push([cmd.short, args.pop()])
+                  end    
+                end
+              else
+                result.push([cmd.short, nil])
+              end
+            end
+          end
+
+        end
+      else
+        # rest argument
+        result.push([:rest, current])
+      end
+    end
+
+    return result
+  end
+
+  def print_help()
+    puts(@name) if @name
+    puts("Usage: #{$0} #{@usage}") if @usage
+    puts("")
+    puts(@description) if @description
+
+    @help.each() { |item|
+      if item.is_a?(String)
+        puts(item)
+      elsif item.is_a?(CommandLineOption)
+        puts("  %-30s %s" % 
+               [("%s%s %s" % [if item.short.is_a?(Fixnum) then
+                            if item.long then
+                              "-#{item.short.chr}, " 
+                            else
+                              "-#{item.short.chr}" 
+                            end
+                          else
+                            ""
+                          end,
+                            if item.long then
+                              "--#{item.long}"
+                            else
+                              ""
+                            end,
+                   if item.argument then item.argument else "" end,
+                 ]),
+               item.description])
+      end
+    }
+  end
+
+  def exit()
+    @stop_parsing = true
+  end
+end
+
+# EOF #



From grumbel at berlios.de  Fri Dec 30 01:11:58 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Fri, 30 Dec 2005 01:11:58 +0100
Subject: [Windstille-commit] r1174 - in facebuilder/data: eye eyebrow head mouth nose
Message-ID: <200512300011.jBU0Bwu6008585@sheep.berlios.de>

Author: grumbel
Date: 2005-12-30 01:11:51 +0100 (Fri, 30 Dec 2005)
New Revision: 1174

Added:
   facebuilder/data/eye/0019.png
   facebuilder/data/eyebrow/0007.png
   facebuilder/data/head/0012.png
   facebuilder/data/mouth/0011.png
   facebuilder/data/nose/0010.png
Log:
- some more body parts

Added: facebuilder/data/eye/0019.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eye/0019.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/eyebrow/0007.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/eyebrow/0007.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0012.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0012.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/mouth/0011.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/mouth/0011.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/nose/0010.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/nose/0010.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From grumbel at berlios.de  Sat Dec 31 04:38:13 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 31 Dec 2005 04:38:13 +0100
Subject: [Windstille-commit] r1175 - in facebuilder: . data/ear data/glasses data/hair data/head examples
Message-ID: <200512310338.jBV3cDsc029870@sheep.berlios.de>

Author: grumbel
Date: 2005-12-31 04:37:55 +0100 (Sat, 31 Dec 2005)
New Revision: 1175

Added:
   facebuilder/data/hair/0032.png
   facebuilder/data/head/0013.png
   facebuilder/data/head/0014.png
   facebuilder/examples/male10.xml
   facebuilder/examples/male11.xml
Removed:
   facebuilder/data/glasses/0000.png
Modified:
   facebuilder/NEWS
   facebuilder/TODO
   facebuilder/data/ear/0000.png
   facebuilder/examples/pirate3.xml
   facebuilder/face.rb
   facebuilder/facebuilder.glade
   facebuilder/facebuilder.rb
Log:
- some bug fixes and some more faceparts

Modified: facebuilder/NEWS
===================================================================
--- facebuilder/NEWS	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/NEWS	2005-12-31 03:37:55 UTC (rev 1175)
@@ -9,6 +9,7 @@
 * new buttons to center horizontal and vertical
 * fixed loading
 * quit properly when window close button is pressed
+* face part thumbnails are now cached
 
 
 FaceBuilder 0.1.0

Modified: facebuilder/TODO
===================================================================
--- facebuilder/TODO	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/TODO	2005-12-31 03:37:55 UTC (rev 1175)
@@ -2,18 +2,12 @@
 | FaceBuilder ToDo
 +--------------
 
-* follow a few more GUI conventions
 * add much more face parts
 * adjust all face parts to follow a standard convention (pupils in
   center of the image, hair relative to the center of the face, etc) so that
   they are easier swapable without size and position adjustments
 * support for different sets, male/female, comic, realistic, etc
-* create a context-menu to center-x, center-y and similar stuff
 * add simple cloths
 * seperate hair into front and back
-* export to PNG
-* export to SVG
-* add GUI handles for scale and rotate
 
-
 # EOF #

Modified: facebuilder/data/ear/0000.png
===================================================================
(Binary files differ)

Deleted: facebuilder/data/glasses/0000.png
===================================================================
(Binary files differ)

Added: facebuilder/data/hair/0032.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/hair/0032.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0013.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0013.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/data/head/0014.png
===================================================================
(Binary files differ)


Property changes on: facebuilder/data/head/0014.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: facebuilder/examples/male10.xml
===================================================================
--- facebuilder/examples/male10.xml	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/examples/male10.xml	2005-12-31 03:37:55 UTC (rev 1175)
@@ -0,0 +1,44 @@
+<face>
+  <eye>
+    <filename>data/eye/0016.png</filename>
+    <offset><x>40.0</x><y>-21.0</y></offset>
+    <scale>0.728445813714234</scale>
+    <rotation>0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>39.0</x><y>-42.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0007.png</filename>
+    <offset><x>0.0</x><y>10.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </nose>
+  <head>
+    <filename>data/head/0013.png</filename>
+    <offset><x>0</x><y>-12.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>88.0</x><y>7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </ear>
+  <mouth>
+    <filename>data/mouth/0009.png</filename>
+    <offset><x>1.0</x><y>71.0</y></offset>
+    <scale>0.942322334547044</scale>
+    <rotation>0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0030.png</filename>
+    <offset><x>7.0</x><y>-4.0</y></offset>
+    <scale>0.870560178613914</scale>
+    <rotation>0.0</rotation>
+  </hair>
+</face>

Added: facebuilder/examples/male11.xml
===================================================================
--- facebuilder/examples/male11.xml	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/examples/male11.xml	2005-12-31 03:37:55 UTC (rev 1175)
@@ -0,0 +1,62 @@
+<face>
+  <forehead>
+    <filename>data/forehead/0000.png</filename>
+    <offset><x>0</x><y>-60.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </forehead>
+  <mouth>
+    <filename>data/mouth/0009.png</filename>
+    <offset><x>0.0</x><y>73.0</y></offset>
+    <scale>0.804263039093289</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0028.png</filename>
+    <offset><x>1.0</x><y>3.0</y></offset>
+    <scale>0.743014729988519</scale>
+    <rotation>0.0</rotation>
+  </hair>
+  <mouthfold>
+    <filename>data/mouthfold/0000.png</filename>
+    <offset><x>30</x><y>67.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </mouthfold>
+  <eye>
+    <filename>data/eye/0005.png</filename>
+    <offset><x>33.0</x><y>-7.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </eye>
+  <eyebrow>
+    <filename>data/eyebrow/0005.png</filename>
+    <offset><x>37.0</x><y>-28.0</y></offset>
+    <scale>1.0404</scale>
+    <rotation>0.0</rotation>
+  </eyebrow>
+  <nose>
+    <filename>data/nose/0010.png</filename>
+    <offset><x>0.0</x><y>20.0</y></offset>
+    <scale>1.061208</scale>
+    <rotation>0</rotation>
+  </nose>
+  <glasses>
+    <filename>data/glasses/0010.png</filename>
+    <offset><x>1.0</x><y>-2.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0.0</rotation>
+  </glasses>
+  <head>
+    <filename>data/head/0013.png</filename>
+    <offset><x>0</x><y>0.0</y></offset>
+    <scale>0.942322334547044</scale>
+    <rotation>0.0</rotation>
+  </head>
+  <ear>
+    <filename>data/ear/0001.png</filename>
+    <offset><x>84.0</x><y>15.0</y></offset>
+    <scale>1.0</scale>
+    <rotation>0</rotation>
+  </ear>
+</face>

Modified: facebuilder/examples/pirate3.xml
===================================================================
--- facebuilder/examples/pirate3.xml	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/examples/pirate3.xml	2005-12-31 03:37:55 UTC (rev 1175)
@@ -1,62 +1,62 @@
 <face>
+  <mouth>
+    <filename>data/mouth/0008.png</filename>
+    <offset><x>-1.0</x><y>58.0</y></offset>
+    <scale>0.853490371190111</scale>
+    <rotation>0.0</rotation>
+  </mouth>
+  <hair>
+    <filename>data/hair/0029.png</filename>
+    <offset><x>-1.0</x><y>-3.0</y></offset>
+    <scale>0.757875024588289</scale>
+    <rotation>0.0</rotation>
+  </hair>
   <hat>
     <filename>data/hat/0003.png</filename>
-    <offset><x>2.0</x><y>-25.0</y></offset>
+    <offset><x>2.0</x><y>-72.0</y></offset>
     <scale>1.061208</scale>
     <rotation>0.0</rotation>
   </hat>
   <eye>
     <filename>data/eye/0005.png</filename>
-    <offset><x>34.0</x><y>27.0</y></offset>
+    <offset><x>34.0</x><y>-20.0</y></offset>
     <scale>0.961168781237985</scale>
     <rotation>0.0</rotation>
   </eye>
   <beard>
     <filename>data/beard/0001.png</filename>
-    <offset><x>-1.0</x><y>54.0</y></offset>
+    <offset><x>-1.0</x><y>7.0</y></offset>
     <scale>0.728445813714234</scale>
     <rotation>0.0</rotation>
   </beard>
   <eyebrow>
     <filename>data/eyebrow/0005.png</filename>
-    <offset><x>35.0</x><y>10.0</y></offset>
+    <offset><x>35.0</x><y>-37.0</y></offset>
     <scale>0.757875024588288</scale>
     <rotation>-6.0</rotation>
   </eyebrow>
   <nose>
     <filename>data/nose/0007.png</filename>
-    <offset><x>0.0</x><y>46.0</y></offset>
+    <offset><x>0.0</x><y>-1.0</y></offset>
     <scale>0.923845426026514</scale>
     <rotation>0.0</rotation>
   </nose>
   <glasses>
     <filename>data/glasses/0004.png</filename>
-    <offset><x>-3.0</x><y>27.0</y></offset>
+    <offset><x>-3.0</x><y>-20.0</y></offset>
     <scale>1.0</scale>
     <rotation>0.0</rotation>
   </glasses>
   <head>
     <filename>data/head/0009.png</filename>
-    <offset><x>0.0</x><y>47.0</y></offset>
+    <offset><x>0.0</x><y>0.0</y></offset>
     <scale>0.905730809829916</scale>
     <rotation>0.0</rotation>
   </head>
   <ear>
     <filename>data/ear/0001.png</filename>
-    <offset><x>85.0</x><y>51.0</y></offset>
+    <offset><x>85.0</x><y>4.0</y></offset>
     <scale>0.905730809829916</scale>
     <rotation>0.0</rotation>
   </ear>
-  <mouth>
-    <filename>data/mouth/0008.png</filename>
-    <offset><x>-1.0</x><y>105.0</y></offset>
-    <scale>0.853490371190111</scale>
-    <rotation>0.0</rotation>
-  </mouth>
-  <hair>
-    <filename>data/hair/0029.png</filename>
-    <offset><x>-1.0</x><y>44.0</y></offset>
-    <scale>0.757875024588289</scale>
-    <rotation>0.0</rotation>
-  </hair>
 </face>

Modified: facebuilder/face.rb
===================================================================
--- facebuilder/face.rb	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/face.rb	2005-12-31 03:37:55 UTC (rev 1175)
@@ -1,6 +1,7 @@
 require "rexml/document"
 require "base64.rb"
 require 'gnomecanvas2'
+require 'face_part.rb'
 
 class FaceCommand
   def initialize(undo_, redo_)
@@ -17,262 +18,6 @@
   end
 end
 
-class FacePart
-  attr_reader :type, :offset, :filename, :canvas_items, :scale, :rotation
-  
-  def item_event(item, event)
-    case event.event_type
-    when Gdk::Event::BUTTON_PRESS
-      case event.button
-      when 1
-        # Record the click position in item-space
-        @x, @y = item.parent.w2i(event.x, event.y)
-
-        # Record the item position before the drag
-        @old_offset = @offset.clone()
-
-        fleur = Gdk::Cursor.new(Gdk::Cursor::FLEUR)
-        item.grab(Gdk::Event::POINTER_MOTION_MASK | Gdk::Event::BUTTON_RELEASE_MASK,
-                  fleur,
-                  event.time)
-        
-        @dragging = true
-
-        $facebuilder.set_current_part(@type)
-      end
-
-    when Gdk::Event::MOTION_NOTIFY
-      item_x, item_y = item.parent.w2i(event.x, event.y)
-      if @dragging && (event.state & Gdk::Window::BUTTON1_MASK == Gdk::Window::BUTTON1_MASK)
-        # Calculate the new position
-
-        if event.state & Gdk::Window::SHIFT_MASK == Gdk::Window::SHIFT_MASK
-          @offset.x = @old_offset.x
-        else
-          @offset.x = @old_offset.x + item_x - @x
-        end
-        @offset.y = @old_offset.y + item_y - @y       
-
-        update_items()
-      end
-
-    when Gdk::Event::BUTTON_RELEASE
-      item.ungrab(event.time)
-      @dragging = false;
-
-      if @old_offset != @offset then
-        old_offset = @old_offset.clone()
-        offset     = @offset.clone()
-        
-        @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.get_part(@type).offset = old_offset },
-                                                  proc{ @parent.get_part(@type).offset = offset     }))
-        $facebuilder.update_undo() if $facebuilder
-      end
-    end
-  end
-
-  def initialize(parent, root, type, offset)
-    @parent = parent
-    @type     = type
-    
-    @offset   = offset
-    @filename = nil
-    @scale    = 1.0
-    @rotation = 0
-
-    @canvas_items = []
-
-    im = Gdk::Pixbuf.new("data/empty.png")
-    @canvas_items << Gnome::CanvasPixbuf.new(root,
-                                             :pixbuf => im,
-                                             :x => 0, # offset.x,
-                                             :y => 0, # offset.y,
-                                             :width =>  im.width,
-                                             :height => im.height,
-                                             :anchor => Gtk::ANCHOR_CENTER)
-
-    case @type
-    when :eye, :ear, :eyebrow, :mouthfold
-      @canvas_items << Gnome::CanvasPixbuf.new(root,
-                                               :pixbuf => im,
-                                               :x => 0, # offset.x,
-                                               :y => 0, # offset.y,
-                                               :width =>  im.width,
-                                               :height => im.height,
-                                               :anchor => Gtk::ANCHOR_CENTER)
-    end
-    
-    @canvas_items.each {|i|
-      i.signal_connect("event") { |item, event|
-        item_event(item, event)
-      }
-    }
-
-    self.filename=(nil)
-    update_items()
-  end
-
-  def reload()
-    self.filename=(@filename)
-  end
-  
-  def next_item()
-    pathname = "data/" + type.to_s + "/"
-    files = Dir.new(pathname).to_a[2..-1].grep(/\.png$/)
-    
-    file = File::basename(@filename)
-    index = 0
-
-    files.each_with_index { |obj, i|
-      if obj == file then
-        index = i
-        break
-      end
-    }
-    index += 1
-    
-    if index >= files.length then
-      index = 0
-    end
-
-    self.filename=(pathname + files[index])
-  end
-
-  def previous_item()
-    pathname = "data/" + type.to_s + "/"
-    files = Dir.new(pathname).to_a[2..-1].grep(/\.png$/)
-    
-    file = File::basename(@filename)
-    index = 0
-
-    files.each_with_index { |obj, i|
-      if obj == file then
-        index = i
-        break
-      end
-    }
-    index -= 1
-    
-    if index < 0 then
-      index = files.length - 1
-    end
-
-    self.filename=(pathname + files[index])
-  end
-
-  def update_items()
-    if @canvas_items.length == 1 then
-      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
-                                       Art::Affine.rotate(@rotation) *
-                                       Art::Affine.scale(@scale, @scale))
-    elsif @canvas_items.length == 2 then
-      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
-                                       Art::Affine.rotate(@rotation) *
-                                       Art::Affine.scale(@scale, @scale))
-      @canvas_items[1].affine_absolute(Art::Affine.scale(-1.0, 1.0) * 
-                                       Art::Affine.translate(@offset.x, @offset.y) *
-                                       Art::Affine.rotate(@rotation) *
-                                       Art::Affine.scale(@scale, @scale))
-    else
-      raise "Unhandled @canvas_items.length: #{@canvas_items.length}"
-    end
-  end
-
-  def rotation=(rotation)
-    @rotation = rotation
-    update_items()
-  end
-
-  def scale=(scale)
-    @scale = scale
-    update_items()
-  end
-
-  def filename=(filename)
-    if @parent.use_undo() and filename != @filename then
-      old_filename = @filename.clone() if @filename
-      new_filename = filename.clone()  if filename
-      @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
-                                                    @parent.get_part(@type).filename=(old_filename) }},
-                                                proc{ @parent.without_undo {
-                                                    @parent.get_part(@type).filename=(new_filename) }}))
-      $facebuilder.update_undo() if $facebuilder
-    end
-    
-    if filename and ! filename.empty? then
-      @canvas_items.each{ |item| item.show() }
-      
-      @filename = filename    
-      pixbuf = Gdk::Pixbuf.new(@filename)
-      @canvas_items.each {|item|
-        item.pixbuf = pixbuf
-      }
-    else
-      @filename = nil
-      @canvas_items.each{ |item| item.hide() }
-    end
-  end
-
-  def offset=(offset)
-    @offset = offset
-    update_items()
-  end
-
-  def offset()
-    return @offset
-  end
-
-  def save_svg(out)
-    if @filename then
-      pixbuf = Gdk::Pixbuf.new(@filename)
-
-      out.write("\n\n<!-- #{@type.to_s} -->\n")
-      out.write("<g transform=\"")
-      out.write("translate(#{pixbuf.width/2},#{pixbuf.height/2}) ")
-      out.write("translate(#{-pixbuf.width/2 + 256},#{-pixbuf.height/2 + 256}) ")
-      out.write("translate(#{offset.x},#{offset.y}) ")
-      out.write("rotate(#{@rotation}) ")
-      out.write("scale(#{@scale}) ")
-      out.write("translate(#{-pixbuf.width/2},#{-pixbuf.height/2}) ")
-
-      out.write("\">")
-      out.write("<image height=\"#{pixbuf.height}\" width=\"#{pixbuf.width}\" ")
-      out.write("xlink:href=\"data:image/png;base64,#{Base64.encode64(File.new(@filename).read())}\" ")
-      out.write("x=\"0\" y=\"0\" />")
-      out.write("</g>\n")
-
-      case @type
-      when :eye, :ear, :eyebrow, :mouthfold
-        out.write("<g transform=\"")
-        out.write("translate(#{pixbuf.width/2},#{pixbuf.height/2}) ")
-        out.write("scale(-1.0, 1.0) ")
-        out.write("translate(#{pixbuf.width/2 - 256},#{-pixbuf.height/2 + 256}) ")
-        out.write("translate(#{offset.x},#{offset.y}) ")
-        out.write("rotate(#{@rotation}) ")
-        out.write("scale(#{@scale}) ")
-        out.write("translate(#{-pixbuf.width/2},#{-pixbuf.height/2}) ")
-
-        out.write("\">")
-        out.write("<image height=\"#{pixbuf.height}\" width=\"#{pixbuf.width}\" ")
-        out.write("xlink:href=\"data:image/png;base64,#{Base64.encode64(File.new(@filename).read())}\" ")
-        out.write("x=\"0\" y=\"0\" />")
-        out.write("</g>\n")
-      end
-    end
-  end
-
-  def save(out)
-    if @filename then
-      out << "  <#{type}>\n"
-      out << "    <filename>#{@filename}</filename>\n"
-      out << "    <offset><x>#{@offset.x}</x><y>#{@offset.y}</y></offset>\n"
-      out << "    <scale>#{@scale}</scale>\n"
-      out << "    <rotation>#{@rotation}</rotation>\n"
-      out << "  </#{type}>\n"
-    end
-  end
-end
-
 class Face
   attr_accessor :redo_stack, :parts
   attr_reader   :use_undo, :undo_stack
@@ -299,6 +44,13 @@
     }
   end
 
+  def center()
+    offset = @parts[:head].offset
+    @parts.each{|key, val| 
+      val.offset = Point.new(val.offset.x - offset.x, val.offset.y - offset.y)
+    }
+  end
+
   def without_undo()
     disable_undo()
     yield()
@@ -325,8 +77,9 @@
     # FIXME: Only primitive export, only copies from framebuffer and doesn't work with overlap
     puts $facebuilder.canvas.window
     window = $facebuilder.canvas.window
+    
     pixbuf = Gdk::Pixbuf.from_drawable(window.colormap, window, 0, 0, 512, 512)
-    pixbuf.save(filename,"png")
+    pixbuf.save(filename, "png")
   end
 
   def save_as_svg(filename)

Modified: facebuilder/facebuilder.glade
===================================================================
--- facebuilder/facebuilder.glade	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/facebuilder.glade	2005-12-31 03:37:55 UTC (rev 1175)
@@ -23,7 +23,7 @@
   <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
   <property name="focus_on_map">True</property>
   <property name="enable_layout_config">True</property>
-  <signal name="delete_event" handler="on_quit" />
+  <signal name="delete_event" handler="on_quit"/>
 
   <child internal-child="dock">
     <widget class="BonoboDock" id="bonobodock1">
@@ -174,6 +174,21 @@
 			  <signal name="activate" handler="on_preferences1_activate" last_modification_time="Sun, 25 Dec 2005 14:41:31 GMT"/>
 			</widget>
 		      </child>
+
+		      <child>
+			<widget class="GtkSeparatorMenuItem" id="separator5">
+			  <property name="visible">True</property>
+			</widget>
+		      </child>
+
+		      <child>
+			<widget class="GtkMenuItem" id="center_face2">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Center Face</property>
+			  <property name="use_underline">True</property>
+			  <signal name="activate" handler="on_center_face1_activate" last_modification_time="Sat, 31 Dec 2005 00:57:36 GMT"/>
+			</widget>
+		      </child>
 		    </widget>
 		  </child>
 		</widget>

Modified: facebuilder/facebuilder.rb
===================================================================
--- facebuilder/facebuilder.rb	2005-12-30 00:11:51 UTC (rev 1174)
+++ facebuilder/facebuilder.rb	2005-12-31 03:37:55 UTC (rev 1175)
@@ -37,8 +37,8 @@
     uiinfos[5][9]  = @glade['copy1']
     uiinfos[6][9]  = @glade['paste1']
     uiinfos[7][9]  = @glade['properties1']
-    uiinfos[8][9] = @glade['preferences1']
-    uiinfos[9][9] = @glade['about1']
+    uiinfos[8][9]  = @glade['preferences1']
+    uiinfos[9][9]  = @glade['about1']
     @app.install_menu_hints(uiinfos)
   end
 
@@ -102,7 +102,27 @@
     }      
   end
 
+  def create_directory(name)
+    if ! File.directory?(name) then
+      puts "Creating #{@dot_directory}..."
+      Dir.mkdir(name)
+    end
+  end
+
+  def create_dot_directory()
+    @dot_directory = ENV["HOME"] + "/.facebuilder"
+    create_directory(@dot_directory)
+    create_directory(@dot_directory + "/data")
+    create_directory(@dot_directory + "/thumbnails")
+    ["beard", "eyebrow", "glasses", "hat", "mouthfold",
+     "ear", "eye", "forehead", "hair", "head", "mouth", "nose"].each { |sub|
+      create_directory(@dot_directory + "/data/" + sub)
+    }
+  end
+
   def initialize(path_or_data, root = nil, domain = nil, localedir = nil, flag = GladeXML::FILE)
+    create_dot_directory()
+
     @glade = GladeXML.new(path_or_data, root, domain, localedir, flag) {|handler| method(handler) }
 
     create_uiinfo_menus(domain)
@@ -228,6 +248,10 @@
     update_undo()
   end
   
+  def on_center_face1_activate(widget)
+    @face.center()
+  end
+
   def on_open1_activate(widget)
     dialog =  Gtk::FileChooserDialog.new("Gtk::FileChooser sample", nil,
                                          Gtk::FileChooser::ACTION_OPEN,
@@ -288,7 +312,6 @@
     clipboard.request_contents(Gdk::Atom.intern("CLIPBOARD", false)) { |clipboard, selection_data| 
       puts selection_data.type, selection_data.text
     }
-
   end
 
   def on_save_as1_activate(widget)
@@ -378,7 +401,7 @@
                               :size_pixels => FALSE})
     left.show()
     left.signal_connect("clicked") {
-      @face.get_part(facepart).previous_item()
+      @face.get_part(facepart).next_item(-1)
       set_current_part(facepart)
     }
 
@@ -453,12 +476,31 @@
     }
   end
 
+  def store_thumbnail(pixmap, orig_filename)
+    filename = orig_filename.gsub("/", "_").gsub(".", "+")
+    filename = @dot_directory + "/thumbnails/" + "thumb0_" + filename + ".png"
+    pixmap.save(filename, "png")
+    File.utime(0, File.mtime(orig_filename), filename)
+  end
+
+  def load_thumbnail(orig_filename)
+    filename = orig_filename.gsub("/", "_").gsub(".", "+")
+    filename = @dot_directory + "/thumbnails/" + "thumb0_" + filename + ".png"
+    if File.exists? filename and File.mtime(orig_filename) == File.mtime(filename) then
+        return Gdk::Pixbuf.new(filename)
+    else
+      return nil
+    end
+  end
+
   def set_current_part(type)
     @parts.each_with_index() { |p, i|
       if type == p then
         @glade['PartSelector'].active = i
 
         if @current_part != i then
+          @current_part = i
+
           @list.clear()
 
           # Add empty item
@@ -467,38 +509,52 @@
           iter[1] = Gdk::Pixbuf.new('data/empty.png')
 
           # Add other items
+          i = 0
           Dir.new("data/#{type}/").grep(/\.png$/).each{|v|
             filename = "data/#{type}/#{v}"
             iter = @list.append()
-            pixbuf = Gdk::Pixbuf.new(filename)
-
-            # scale, while keeping aspect
-            if pixbuf.width > 64 or pixbuf.height > 64 then # need scaling, since larger then 64x64
-              aspect = pixbuf.width.to_f / pixbuf.height
-              if pixbuf.width > pixbuf.height then
-                pixbuf = pixbuf.scale(64, 64 / aspect)
-              else
-                pixbuf = pixbuf.scale(64 * aspect, 64)
+            
+            pixbuf = load_thumbnail(filename)
+            if ! pixbuf then
+              pixbuf = Gdk::Pixbuf.new(filename)
+              
+              # scale, while keeping aspect
+              if pixbuf.width > 64 or pixbuf.height > 64 then # need scaling, since larger then 64x64
+                aspect = pixbuf.width.to_f / pixbuf.height
+                if pixbuf.width > pixbuf.height then
+                  pixbuf = pixbuf.scale(64, 64 / aspect)
+                else
+                  pixbuf = pixbuf.scale(64 * aspect, 64)
+                end
               end
-            end
 
-            whitepixbuf = Gdk::Pixbuf.new(Gdk::Pixbuf::COLORSPACE_RGB, true, 8, 64, 64)
-            whitepixbuf.fill!(0xf5f5f5ff)
+              whitepixbuf = Gdk::Pixbuf.new(Gdk::Pixbuf::COLORSPACE_RGB, true, 8, 64, 64)
+              whitepixbuf.fill!(0xf5f5f5ff)
 
-            whitepixbuf.composite!(pixbuf, 
-                                   (whitepixbuf.width - pixbuf.width)/2, (whitepixbuf.height - pixbuf.height)/2,
-                                   pixbuf.width, pixbuf.height,
-                                   (whitepixbuf.width - pixbuf.width)/2, (whitepixbuf.height - pixbuf.height)/2,
-                                   1.0, 1.0,
-                                   Gdk::Pixbuf::INTERP_BILINEAR,
-                                   255)            
+              whitepixbuf.composite!(pixbuf, 
+                                     (whitepixbuf.width - pixbuf.width)/2, (whitepixbuf.height - pixbuf.height)/2,
+                                     pixbuf.width, pixbuf.height,
+                                     (whitepixbuf.width - pixbuf.width)/2, (whitepixbuf.height - pixbuf.height)/2,
+                                     1.0, 1.0,
+                                     Gdk::Pixbuf::INTERP_BILINEAR,
+                                     255)            
+              pixbuf = whitepixbuf
+              store_thumbnail(pixbuf, filename)              
+            end
 
             # Add keep of aspect ratio
-            iter[1] = whitepixbuf
+            iter[1] = pixbuf
             iter[0] = filename
+
+            if filename == @face.get_part(@parts[@current_part]).filename then
+              # FIXME: Doesn't handle keyboard focus correctly
+              @glade['FaceParts'].select_path(Gtk::TreePath.new((i+1).to_s))
+              # puts @glade['FaceParts'].methods().grep(/cursor/)
+              # @glade['FaceParts'].move_cursor(Gtk::MOVEMENT_LOGICAL_POSITIONS, i+1)
+            end
+
+            i += 1
           }
-
-          @current_part = i
         end       
       end
     }   



From grumbel at berlios.de  Sat Dec 31 04:39:15 2005
From: grumbel at berlios.de (grumbel at BerliOS)
Date: Sat, 31 Dec 2005 04:39:15 +0100
Subject: [Windstille-commit] r1176 - facebuilder
Message-ID: <200512310339.jBV3dFT5030433@sheep.berlios.de>

Author: grumbel
Date: 2005-12-31 04:39:12 +0100 (Sat, 31 Dec 2005)
New Revision: 1176

Added:
   facebuilder/face_part.rb
Log:
- seperated facepart into seperate file

Added: facebuilder/face_part.rb
===================================================================
--- facebuilder/face_part.rb	2005-12-31 03:37:55 UTC (rev 1175)
+++ facebuilder/face_part.rb	2005-12-31 03:39:12 UTC (rev 1176)
@@ -0,0 +1,240 @@
+
+class FacePart
+  attr_reader :type, :offset, :filename, :canvas_items, :scale, :rotation
+  
+  def item_event(item, event)
+    case event.event_type
+    when Gdk::Event::BUTTON_PRESS
+      case event.button
+      when 1
+        # Record the click position in item-space
+        @x, @y = item.parent.w2i(event.x, event.y)
+
+        # Record the item position before the drag
+        @old_offset = @offset.clone()
+
+        fleur = Gdk::Cursor.new(Gdk::Cursor::FLEUR)
+        item.grab(Gdk::Event::POINTER_MOTION_MASK | Gdk::Event::BUTTON_RELEASE_MASK,
+                  fleur,
+                  event.time)
+        
+        @dragging = true
+
+        $facebuilder.set_current_part(@type)
+      end
+
+    when Gdk::Event::MOTION_NOTIFY
+      item_x, item_y = item.parent.w2i(event.x, event.y)
+      if @dragging && (event.state & Gdk::Window::BUTTON1_MASK == Gdk::Window::BUTTON1_MASK)
+        # Calculate the new position
+
+        if event.state & Gdk::Window::SHIFT_MASK == Gdk::Window::SHIFT_MASK
+          @offset.x = @old_offset.x
+        else
+          @offset.x = @old_offset.x + item_x - @x
+        end
+        @offset.y = @old_offset.y + item_y - @y       
+
+        update_items()
+      end
+
+    when Gdk::Event::BUTTON_RELEASE
+      item.ungrab(event.time)
+      @dragging = false;
+
+      if @old_offset != @offset then
+        old_offset = @old_offset.clone()
+        offset     = @offset.clone()
+        
+        @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.get_part(@type).offset = old_offset },
+                                                  proc{ @parent.get_part(@type).offset = offset     }))
+        $facebuilder.update_undo() if $facebuilder
+      end
+    end
+  end
+
+  def initialize(parent, root, type, offset)
+    @parent = parent
+    @type     = type
+    
+    @offset   = offset
+    @filename = nil
+    @scale    = 1.0
+    @rotation = 0
+
+    @canvas_items = []
+
+    im = Gdk::Pixbuf.new("data/empty.png")
+    @canvas_items << Gnome::CanvasPixbuf.new(root,
+                                             :pixbuf => im,
+                                             :x => 0, # offset.x,
+                                             :y => 0, # offset.y,
+                                             :width =>  im.width,
+                                             :height => im.height,
+                                             :anchor => Gtk::ANCHOR_CENTER)
+
+    case @type
+    when :eye, :ear, :eyebrow, :mouthfold
+      @canvas_items << Gnome::CanvasPixbuf.new(root,
+                                               :pixbuf => im,
+                                               :x => 0, # offset.x,
+                                               :y => 0, # offset.y,
+                                               :width =>  im.width,
+                                               :height => im.height,
+                                               :anchor => Gtk::ANCHOR_CENTER)
+    end
+    
+    @canvas_items.each {|i|
+      i.signal_connect("event") { |item, event|
+        item_event(item, event)
+      }
+    }
+
+    self.filename=(nil)
+    update_items()
+  end
+
+  def reload()
+    self.filename=(@filename)
+  end
+  
+  
+  def next_item(n = 1)
+    pathname = "data/" + type.to_s + "/"
+    files = Dir.new(pathname).to_a[2..-1].grep(/\.png$/)
+    
+    file = File::basename(@filename)
+    index = 0
+
+    files.each_with_index { |obj, i|
+      if obj == file then
+        index = i
+        break
+      end
+    }
+    index += n
+    index %= files.length
+
+    self.filename=(pathname + files[index])
+  end
+
+  def update_items()
+    if @canvas_items.length == 1 then
+      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+    elsif @canvas_items.length == 2 then
+      @canvas_items[0].affine_absolute(Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+      @canvas_items[1].affine_absolute(Art::Affine.scale(-1.0, 1.0) * 
+                                       Art::Affine.translate(@offset.x, @offset.y) *
+                                       Art::Affine.rotate(@rotation) *
+                                       Art::Affine.scale(@scale, @scale))
+    else
+      raise "Unhandled @canvas_items.length: #{@canvas_items.length}"
+    end
+  end
+
+  def rotation=(rotation)
+    @rotation = rotation
+    update_items()
+  end
+
+  def scale=(scale)
+    @scale = scale
+    update_items()
+  end
+
+  def filename=(filename)
+    if @parent.use_undo() and filename != @filename then
+      old_filename = @filename.clone() if @filename
+      new_filename = filename.clone()  if filename
+      @parent.add_to_undo_stack(FaceCommand.new(proc{ @parent.without_undo {
+                                                    @parent.get_part(@type).filename=(old_filename) }},
+                                                proc{ @parent.without_undo {
+                                                    @parent.get_part(@type).filename=(new_filename) }}))
+      $facebuilder.update_undo() if $facebuilder
+    end
+    
+    if filename and ! filename.empty? then
+      if filename != @filename
+        @canvas_items.each{ |item| item.show() }
+
+        begin
+          pixbuf = Gdk::Pixbuf.new(filename)
+          @filename = filename    
+          @canvas_items.each {|item|
+            item.pixbuf = pixbuf
+          }
+        rescue GLib::FileError => err
+          puts err
+        end
+      end
+    else
+      @filename = nil
+      @canvas_items.each{ |item| item.hide() }
+    end
+  end
+
+  def offset=(offset)
+    @offset = offset
+    update_items()
+  end
+
+  def offset()
+    return @offset
+  end
+
+  def save_svg(out)
+    if @filename then
+      pixbuf = Gdk::Pixbuf.new(@filename)
+
+      out.write("\n\n<!-- #{@type.to_s} -->\n")
+      out.write("<g transform=\"")
+      out.write("translate(#{pixbuf.width/2},#{pixbuf.height/2}) ")
+      out.write("translate(#{-pixbuf.width/2 + 256},#{-pixbuf.height/2 + 256}) ")
+      out.write("translate(#{offset.x},#{offset.y}) ")
+      out.write("rotate(#{@rotation}) ")
+      out.write("scale(#{@scale}) ")
+      out.write("translate(#{-pixbuf.width/2},#{-pixbuf.height/2}) ")
+
+      out.write("\">")
+      out.write("<image height=\"#{pixbuf.height}\" width=\"#{pixbuf.width}\" ")
+      out.write("xlink:href=\"data:image/png;base64,#{Base64.encode64(File.new(@filename).read())}\" ")
+      out.write("x=\"0\" y=\"0\" />")
+      out.write("</g>\n")
+
+      case @type
+      when :eye, :ear, :eyebrow, :mouthfold
+        out.write("<g transform=\"")
+        out.write("translate(#{pixbuf.width/2},#{pixbuf.height/2}) ")
+        out.write("scale(-1.0, 1.0) ")
+        out.write("translate(#{pixbuf.width/2 - 256},#{-pixbuf.height/2 + 256}) ")
+        out.write("translate(#{offset.x},#{offset.y}) ")
+        out.write("rotate(#{@rotation}) ")
+        out.write("scale(#{@scale}) ")
+        out.write("translate(#{-pixbuf.width/2},#{-pixbuf.height/2}) ")
+
+        out.write("\">")
+        out.write("<image height=\"#{pixbuf.height}\" width=\"#{pixbuf.width}\" ")
+        out.write("xlink:href=\"data:image/png;base64,#{Base64.encode64(File.new(@filename).read())}\" ")
+        out.write("x=\"0\" y=\"0\" />")
+        out.write("</g>\n")
+      end
+    end
+  end
+
+  def save(out)
+    if @filename then
+      out << "  <#{type}>\n"
+      out << "    <filename>#{@filename}</filename>\n"
+      out << "    <offset><x>#{@offset.x}</x><y>#{@offset.y}</y></offset>\n"
+      out << "    <scale>#{@scale}</scale>\n"
+      out << "    <rotation>#{@rotation}</rotation>\n"
+      out << "  </#{type}>\n"
+    end
+  end
+end
+
+# EOF #



