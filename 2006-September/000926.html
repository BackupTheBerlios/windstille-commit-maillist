<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r1273 - in trunk: . data/3dsprites	data/blender/hero data/blender/shuttle data/controller	data/levels data/models/characters/airportpersonal	data/models/characters/merc3 data/models/characters/scientist	data/particlesystems data/scripts docs src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2006-September/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1273%20-%20in%20trunk%3A%20.%20data/3dsprites%0A%09data/blender/hero%20data/blender/shuttle%20data/controller%0A%09data/levels%20data/models/characters/airportpersonal%0A%09data/models/characters/merc3%20data/models/characters/scientist%0A%09data/particlesystems%20data/scripts%20docs%20src&In-Reply-To=%3C200609051841.k85IfX2r006697%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000927.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r1273 - in trunk: . data/3dsprites	data/blender/hero data/blender/shuttle data/controller	data/levels data/models/characters/airportpersonal	data/models/characters/merc3 data/models/characters/scientist	data/particlesystems data/scripts docs src</H1>
    <B>grumbel at BerliOS</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r1273%20-%20in%20trunk%3A%20.%20data/3dsprites%0A%09data/blender/hero%20data/blender/shuttle%20data/controller%0A%09data/levels%20data/models/characters/airportpersonal%0A%09data/models/characters/merc3%20data/models/characters/scientist%0A%09data/particlesystems%20data/scripts%20docs%20src&In-Reply-To=%3C200609051841.k85IfX2r006697%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r1273 - in trunk: . data/3dsprites	data/blender/hero data/blender/shuttle data/controller	data/levels data/models/characters/airportpersonal	data/models/characters/merc3 data/models/characters/scientist	data/particlesystems data/scripts docs src">grumbel at mail.berlios.de
       </A><BR>
    <I>Tue Sep  5 20:41:33 CEST 2006</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000927.html">[Windstille-commit] r1274 - in trunk: . windstille
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#926">[ date ]</a>
              <a href="thread.html#926">[ thread ]</a>
              <a href="subject.html#926">[ subject ]</a>
              <a href="author.html#926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2006-09-05 20:39:28 +0200 (Tue, 05 Sep 2006)
New Revision: 1273

Added:
   trunk/windstille/
Modified:
   trunk/data/3dsprites/heroken.wsprite
   trunk/data/blender/hero/heroken3.blend
   trunk/data/blender/shuttle/shuttle.blend
   trunk/data/controller/keyboard.scm
   trunk/data/levels/apartment.wst
   trunk/data/levels/industrial.wst
   trunk/data/levels/newformat2.wst
   trunk/data/models/characters/airportpersonal/airportpersonal.xcf
   trunk/data/models/characters/merc3/merc3.xcf
   trunk/data/models/characters/scientist/scientist.xcf
   trunk/data/particlesystems/fire.particles
   trunk/data/scripts/windstille.nut
   trunk/docs/wsprite_fileformat.txt
   trunk/src/sprite2dview.cpp
   trunk/src/sprite2dview.hpp
Log:
- misc stuff

Modified: trunk/data/3dsprites/heroken.wsprite
===================================================================
(Binary files differ)

Modified: trunk/data/blender/hero/heroken3.blend
===================================================================
(Binary files differ)

Modified: trunk/data/blender/shuttle/shuttle.blend
===================================================================
(Binary files differ)

Modified: trunk/data/controller/keyboard.scm
===================================================================
--- trunk/data/controller/keyboard.scm	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/data/controller/keyboard.scm	2006-09-05 18:39:28 UTC (rev 1273)
@@ -8,6 +8,14 @@
   (keyboard-axis (minus &quot;up&quot;) (plus &quot;down&quot;))
   (joystick-axis (device 0)  (axis 1)))
  
+ (x2-axis
+  (keyboard-axis (minus &quot;left&quot;) (plus &quot;right&quot;))
+  (joystick-axis (device 0)  (axis 3)))
+
+ (y2-axis
+  (keyboard-axis (minus &quot;c&quot;) (plus &quot;t&quot;))
+  (joystick-axis (device 0)  (axis 4)))
+
  (primary-button
   (keyboard-button (key &quot;s&quot;))
   (joystick-button (device 0)  (button 2)))
@@ -36,5 +44,4 @@
   (keyboard-button (key &quot;e&quot;)))
  )
 
-
 ;; EOF ;;

Modified: trunk/data/levels/apartment.wst
===================================================================
--- trunk/data/levels/apartment.wst	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/data/levels/apartment.wst	2006-09-05 18:39:28 UTC (rev 1273)
@@ -1,3 +1,4 @@
+;; -*- scheme -*-
 ;; Generated by Flexlay Editor
 (windstille-sector
   (version 2)
@@ -3,4 +4,5 @@
   (ambient-color .3 .3 .3)  (name   &quot;&quot;)
   (music  &quot;&quot;)
+  (init-script &quot;scripts/apartment/init.nut&quot;)
   (objects
   (tilemap (name &quot;background&quot;) (width 100) (height 30) (z-pos -2000)
@@ -199,6 +201,16 @@
       (z-pos -150)
       (sprite3d &quot;models/characters/yagor/yagor.wsprite&quot;)
     )
+
+    (scriptable-object
+      (name &quot;Barrobot&quot;)
+      (pos 470 177)
+      (z-pos -100)
+      (sprite  &quot;models/objects/barrobot/barrobotsprite.sprite&quot;)
+      (active true)
+      (script &quot;barrobot()&quot;)
+      (use-verb &quot;Look&quot;)
+    )
     
     (scriptable-object      
      (name &quot;flashlight&quot;)

Modified: trunk/data/levels/industrial.wst
===================================================================
--- trunk/data/levels/industrial.wst	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/data/levels/industrial.wst	2006-09-05 18:39:28 UTC (rev 1273)
@@ -13,53 +13,6 @@
         (pos 300 600)
         (count 10))
 
-    ;; Smoke
-    (particle-system
-     (lifetime   2.0)
-     (count      35)
-
-     (z-pos  1000)
-     (pos 386 736)
-     (velocity    50 60)
-     (cone   -110 -80)
-     (gravity -1.5 0.5)
-     (size   0.05 1.0)
-     (drawer (surface-drawer (image &quot;images/particles/smoke2.png&quot;)))
-     (distribution (point-distribution))
-     )
-
-
-    ;; Smoke
-    (particle-system
-     (lifetime   1.5)
-     (count      35)
-
-     (z-pos  1000)
-     (pos 900 736)
-     (velocity    150 160)
-     (cone   -110 -80)
-     (gravity -1.5 0.5)
-     (size   0.15 0.5)
-     (drawer (surface-drawer (image &quot;images/particles/smoke2.png&quot;)))
-     (distribution (point-distribution))
-     )
-
-    (particle-system
-     (lifetime   15.0)
-     (count      70)
-
-     (z-pos  1000)
-     (pos 0 136)
-     (velocity 60 80)
-     (cone    85 95)
-     (gravity 0.0 0.0)
-     (size   0.9 1.0)
-     (drawer (surface-drawer (image &quot;images/particles/snow.png&quot;)))
-     (color-begin 1.0 1.0 1.0 1.0)
-     (color-end 1.0 1.0 1.0 1.0)
-     (distribution (line-distribution (x1 0) (y1 0) (x2 1024) (y2 0)))
-     )
-
     (scriptable-object
       (name &quot;Lamp&quot;)
       (pos 256 736)

Modified: trunk/data/levels/newformat2.wst
===================================================================
--- trunk/data/levels/newformat2.wst	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/data/levels/newformat2.wst	2006-09-05 18:39:28 UTC (rev 1273)
@@ -16,6 +16,8 @@
     (width 20)
     )
 
+;;(shockwave (pos 400 300))
+
    (liquid
     (pos 832 832)
     (width 4)

Modified: trunk/data/models/characters/airportpersonal/airportpersonal.xcf
===================================================================
(Binary files differ)

Modified: trunk/data/models/characters/merc3/merc3.xcf
===================================================================
(Binary files differ)

Modified: trunk/data/models/characters/scientist/scientist.xcf
===================================================================
(Binary files differ)

Modified: trunk/data/particlesystems/fire.particles
===================================================================
--- trunk/data/particlesystems/fire.particles	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/data/particlesystems/fire.particles	2006-09-05 18:39:28 UTC (rev 1273)
@@ -6,6 +6,7 @@
   (drawer (spark-drawer (color 1.0 0.5 0.5)))
   (z-pos 900)
   (pos 0 32)
+  (layer &quot;highlight&quot;)
   (velocity 400 650)
   (cone -115 -65)
   (gravity 0  1)
@@ -28,19 +29,19 @@
 
 
  ;; Fire Light
- (particle-system
-  (pos 0 0)
-  (lifetime 1.0)
-  (count 20)
-  (layer &quot;light&quot;)
-  (z-pos 1000)
-  (velocity 200 300)
-  (cone -95 -85)
-  (gravity 0 0)
-  (distribution (line-distribution (x1 -50) (y1 0) (x2 50) (y2 0)))
-  (drawer (surface-drawer (image &quot;images/particles/fire_light.png&quot;)
-                          (blendfunc-src &quot;src_alpha&quot;)
-                          (blendfunc-dst &quot;one&quot;))))
+;  (particle-system
+;   (pos 0 0)
+;   (lifetime 1.0)
+;   (count 20)
+;   (layer &quot;light&quot;)
+;   (z-pos 1000)
+;   (velocity 200 300)
+;   (cone -95 -85)
+;   (gravity 0 0)
+;   (distribution (line-distribution (x1 -50) (y1 0) (x2 50) (y2 0)))
+;   (drawer (surface-drawer (image &quot;images/particles/fire_light.png&quot;)
+;                           (blendfunc-src &quot;src_alpha&quot;)
+;                           (blendfunc-dst &quot;one&quot;))))
  
  ;; Fire itself
  (particle-system
@@ -51,11 +52,31 @@
   (velocity 200 300)
   (cone -95 -85)
   (gravity 0 -0.05)
+  (size 1.5 1.0)
   (distribution (line-distribution (x1 -50) (y1 0) (x2 50) (y2 0)))
   (drawer (surface-drawer (image &quot;images/particles/smoke.png&quot;)
                           (blendfunc-src &quot;src_alpha&quot;)
                           (blendfunc-dst &quot;one&quot;))))
 
+
+ ;; Deform
+ (particle-system
+  (pos 0 0)
+        (lifetime 2.0)
+  (count 25)
+  (z-pos 1100)
+  (layer &quot;highlight&quot;)
+  (velocity 200 300)
+  (cone -95 -85)
+  (gravity 0 -0.3)
+  (size 1.5 1.0)
+  (distribution (line-distribution (x1 -50) (y1 0) (x2 50) (y2 0)))
+  (drawer (deform-drawer (image &quot;images/particles/smoke.png&quot;)
+                                 (blendfunc-src &quot;src_alpha&quot;)
+                                  (blendfunc-dst &quot;one&quot;))))
+
+
+
  )
 
 ;; EOF ;;

Modified: trunk/data/scripts/windstille.nut
===================================================================
--- trunk/data/scripts/windstille.nut	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/data/scripts/windstille.nut	2006-09-05 18:39:28 UTC (rev 1273)
@@ -33,11 +33,12 @@
  * Constants from display/scene_context.hpp, manually copied here so
  * you have to sync manually in case stuff changes
  */
-RENDER_MASK_COLORMAP       &lt;- 1&lt;&lt;0,
-RENDER_MASK_LIGHTMAP       &lt;- 1&lt;&lt;1,
-RENDER_MASK_HIGHLIGHTMAP   &lt;- 1&lt;&lt;2,
+RENDER_MASK_COLORMAP       &lt;- 1&lt;&lt;0
+RENDER_MASK_LIGHTMAP       &lt;- 1&lt;&lt;1
+RENDER_MASK_HIGHLIGHTMAP   &lt;- 1&lt;&lt;2
 RENDER_MASK_LIGHTMAPSCREEN &lt;- 1&lt;&lt;3
-RENDER_MASK_ALL            &lt;- (RENDER_MASK_HIGHLIGHTMAP | RENDER_MASK_LIGHTMAP | RENDER_MASK_COLORMAP)
+RENDER_MASK_BLURMAP        &lt;- 1&lt;&lt;4
+RENDER_MASK_ALL            &lt;- (RENDER_MASK_HIGHLIGHTMAP | RENDER_MASK_LIGHTMAP | RENDER_MASK_COLORMAP | RENDER_MASK_BLURMAP)
 
 has_nightvision &lt;- false;
 function nightvision_enabled(...)

Modified: trunk/docs/wsprite_fileformat.txt
===================================================================
--- trunk/docs/wsprite_fileformat.txt	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/docs/wsprite_fileformat.txt	2006-09-05 18:39:28 UTC (rev 1273)
@@ -1,39 +1,41 @@
 Header
-    char magic[4] (= W3DS)
+    char     magic[4] (= W3DS)
     uint16_t format_version      (=2 at the moment)
     uint16_t mesh_count
     uint16_t attachement_point_count
     uint16_t action_count
 
-Mesh Header
-    char texturename[64]
+Mesh Header (x mesh_count)
+    char     texturename[64]
     uint16_t triangle_count
     uint16_t vertex_count
 
-Data after mesh header:
-    uint16_t vertexnum, edge per triangle
-    float normal[3] per triangle
-    float texcoord[2] per vertex
+    uint16_t vertexnum    (x 3*triangle_count) # three vertex indexes per face
+    float    normal[3]    (x triangle_count)   # one normal per face
+    float    texcoord[2]  (x vertex_count)     # one uv coordinate per vertex
 
-Attachement Point Header
+Attachement Point Header x attachement_point_count
     char name[64]
 
-Action Header
-    char name[64]
-    float speed
+Action Header (x action_count)
+    char     name[64]
+    float    speed
     uint16_t marker_count
     uint16_t frame_count
 
-Data per marker:
-    char name[64]
-    uint16_t frame
+  Marker (x marker_count)
+    char     name[64]
+    uint16_t frame_count
 
-Data per action:
-    for all frames:
-      for all meshes:
-        for all vertices:
-          float x, y, z
-      for all attachement points:
+  MeshData (x frame_count)
+    (x frame_count)
+      (x mesh_count)
+        (x mesh.vertex_count)
+          float[3] vertex_location
+
+      (x attachement_point_count)
         float locX, locY, locZ
         float rotW, rotX, rotY, rotZ (it's a quaternion)
 
+
+# EOF #

Modified: trunk/src/sprite2dview.cpp
===================================================================
--- trunk/src/sprite2dview.cpp	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/src/sprite2dview.cpp	2006-09-05 18:39:28 UTC (rev 1273)
@@ -42,6 +42,7 @@
 
 Sprite2DView::Sprite2DView()
 {
+  auto_scroll = false;
   index = 0;
 
   for(std::vector&lt;std::string&gt;::iterator i = arg_files.begin(); i != arg_files.end(); ++i)
@@ -58,14 +59,16 @@
   
   shuffle_directory = directory;
   shuffle = false;
-  std::random_shuffle(shuffle_directory.begin(), shuffle_directory.end());
 
+  //std::sort(shuffle_directory.begin(), shuffle_directory.end());
+  //std::random_shuffle(shuffle_directory.begin(), shuffle_directory.end());
+
   offset = 0.0f;
 
   if (directory.size() &gt; 1)
     mode = SLIDESHOW;
   else
-    mode = MANUAL; 
+    mode = SLIDESHOW; 
 
   zoom = 1.0f;
   pos  = Vector(0,0);
@@ -183,13 +186,17 @@
 
           if (offset - (width - DISPLAY_W) &gt; 0)
             {
-              if (display_time &gt; 3.0f)
+              offset = (width - DISPLAY_W);
+
+              if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
                 next_image();
             }
           else
             {
-              offset += delta * 50.0f +   controller.get_axis_state(X_AXIS) * 200.0f * delta;
+              offset += delta * 50.0f + controller.get_axis_state(X_AXIS) * 200.0f * delta;
             }
+
+          offset +=  controller.get_ball_state(MOUSE_MOTION_Y);
         }
       else
         { // expand horizontal
@@ -200,13 +207,17 @@
 
           if (offset - (height - DISPLAY_H) &gt; 0)
             {
-              if (display_time &gt; 3.0f)
+              offset = (width - DISPLAY_H);
+
+              if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
                 next_image();
             }
           else
             {
               offset += delta * 50.0f +   controller.get_axis_state(X_AXIS) * 200.0f * delta;
             }
+
+          offset += controller.get_ball_state(MOUSE_MOTION_Y);
         }
     }
 
@@ -316,7 +327,7 @@
       delta = 0.0f;
     }
   
-  display_time += delta;
+  display_time += delta * 0.5;
 
   switch(mode) {
   case SLIDESHOW:

Modified: trunk/src/sprite2dview.hpp
===================================================================
--- trunk/src/sprite2dview.hpp	2006-06-22 15:15:05 UTC (rev 1272)
+++ trunk/src/sprite2dview.hpp	2006-09-05 18:39:28 UTC (rev 1273)
@@ -65,6 +65,8 @@
   bool show_thumbnail;
   bool ignore_delta;
   bool shuffle;
+
+  bool auto_scroll;
 public:
   Sprite2DView();
   ~Sprite2DView();


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000927.html">[Windstille-commit] r1274 - in trunk: . windstille
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#926">[ date ]</a>
              <a href="thread.html#926">[ thread ]</a>
              <a href="subject.html#926">[ subject ]</a>
              <a href="author.html#926">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
