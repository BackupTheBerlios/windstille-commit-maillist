<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Windstille-commit] r3337 - in trunk/windstille/src: app armature	collision display editor engine font gui hud input lisp math	navigation objects particles properties scenegraph screen	scripting sound sprite2d sprite3d tile util
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/windstille-commit/2010-July/index.html" >
   <LINK REL="made" HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3337%20-%20in%20trunk/windstille/src%3A%20app%20armature%0A%09collision%20display%20editor%20engine%20font%20gui%20hud%20input%20lisp%20math%0A%09navigation%20objects%20particles%20properties%20scenegraph%20screen%0A%09scripting%20sound%20sprite2d%20sprite3d%20tile%20util&In-Reply-To=%3C20100725032019.5A456480E6C%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002333.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Windstille-commit] r3337 - in trunk/windstille/src: app armature	collision display editor engine font gui hud input lisp math	navigation objects particles properties scenegraph screen	scripting sound sprite2d sprite3d tile util</H1>
    <B>grumbel at mail.berlios.de</B> 
    <A HREF="mailto:windstille-commit%40lists.berlios.de?Subject=Re%3A%20%5BWindstille-commit%5D%20r3337%20-%20in%20trunk/windstille/src%3A%20app%20armature%0A%09collision%20display%20editor%20engine%20font%20gui%20hud%20input%20lisp%20math%0A%09navigation%20objects%20particles%20properties%20scenegraph%20screen%0A%09scripting%20sound%20sprite2d%20sprite3d%20tile%20util&In-Reply-To=%3C20100725032019.5A456480E6C%40sheep.berlios.de%3E"
       TITLE="[Windstille-commit] r3337 - in trunk/windstille/src: app armature	collision display editor engine font gui hud input lisp math	navigation objects particles properties scenegraph screen	scripting sound sprite2d sprite3d tile util">grumbel at mail.berlios.de
       </A><BR>
    <I>Sun Jul 25 05:20:18 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002333.html">[Windstille-commit] r3336 - trunk/windstille/src/sound
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2334">[ date ]</a>
              <a href="thread.html#2334">[ thread ]</a>
              <a href="subject.html#2334">[ subject ]</a>
              <a href="author.html#2334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: grumbel
Date: 2010-07-25 05:20:18 +0200 (Sun, 25 Jul 2010)
New Revision: 3337

Modified:
   trunk/windstille/src/app/config.cpp
   trunk/windstille/src/app/config.hpp
   trunk/windstille/src/app/console.cpp
   trunk/windstille/src/app/controller_def.hpp
   trunk/windstille/src/app/menu_manager.cpp
   trunk/windstille/src/armature/armature.cpp
   trunk/windstille/src/armature/bone.cpp
   trunk/windstille/src/armature/ipo_curve.cpp
   trunk/windstille/src/armature/mesh.cpp
   trunk/windstille/src/armature/model.cpp
   trunk/windstille/src/armature/pose.cpp
   trunk/windstille/src/collision/collision_data.cpp
   trunk/windstille/src/collision/collision_engine.cpp
   trunk/windstille/src/collision/collision_object.cpp
   trunk/windstille/src/collision/collision_test.cpp
   trunk/windstille/src/collision/collision_test.hpp
   trunk/windstille/src/collision/stair_contact.cpp
   trunk/windstille/src/display/basic_compositor_impl.cpp
   trunk/windstille/src/display/blitter.cpp
   trunk/windstille/src/display/compositor.cpp
   trunk/windstille/src/display/display.cpp
   trunk/windstille/src/display/drawing_context.cpp
   trunk/windstille/src/display/framebuffer.cpp
   trunk/windstille/src/display/framebuffer_compositor_impl.cpp
   trunk/windstille/src/display/graphic_context_state.cpp
   trunk/windstille/src/display/opengl_state.cpp
   trunk/windstille/src/display/opengl_window.cpp
   trunk/windstille/src/display/render_buffer.cpp
   trunk/windstille/src/display/scene_context.cpp
   trunk/windstille/src/display/shader_object.cpp
   trunk/windstille/src/display/shader_program.cpp
   trunk/windstille/src/display/software_surface.cpp
   trunk/windstille/src/display/surface.cpp
   trunk/windstille/src/display/surface_manager.cpp
   trunk/windstille/src/display/text_area.cpp
   trunk/windstille/src/display/texture.cpp
   trunk/windstille/src/display/texture_manager.cpp
   trunk/windstille/src/display/texture_packer.cpp
   trunk/windstille/src/editor/control_point.cpp
   trunk/windstille/src/editor/decal_object_model.cpp
   trunk/windstille/src/editor/decal_rotate_control_point.cpp
   trunk/windstille/src/editor/decal_scale_control_point.cpp
   trunk/windstille/src/editor/document.cpp
   trunk/windstille/src/editor/editor_window.cpp
   trunk/windstille/src/editor/layer.cpp
   trunk/windstille/src/editor/layer_manager.cpp
   trunk/windstille/src/editor/layer_widget.cpp
   trunk/windstille/src/editor/navgraph_edge_object_model.cpp
   trunk/windstille/src/editor/navgraph_insert_tool.cpp
   trunk/windstille/src/editor/navgraph_node_object_model.cpp
   trunk/windstille/src/editor/navigation_graph_model.cpp
   trunk/windstille/src/editor/node_selection.cpp
   trunk/windstille/src/editor/object_model.cpp
   trunk/windstille/src/editor/object_selector.cpp
   trunk/windstille/src/editor/particle_system_object_model.cpp
   trunk/windstille/src/editor/scroll_tool.cpp
   trunk/windstille/src/editor/sector_model.cpp
   trunk/windstille/src/editor/sector_model_builder.cpp
   trunk/windstille/src/editor/select_tool.cpp
   trunk/windstille/src/editor/selection.cpp
   trunk/windstille/src/editor/sprite_object_model.cpp
   trunk/windstille/src/editor/timeline.cpp
   trunk/windstille/src/editor/timeline_layer.cpp
   trunk/windstille/src/editor/timeline_object_layer.cpp
   trunk/windstille/src/editor/undo_manager.cpp
   trunk/windstille/src/editor/windstille_widget.cpp
   trunk/windstille/src/editor/zoom_tool.cpp
   trunk/windstille/src/engine/camera.cpp
   trunk/windstille/src/engine/entity.cpp
   trunk/windstille/src/engine/game_object.hpp
   trunk/windstille/src/engine/physics.cpp
   trunk/windstille/src/engine/script_manager.cpp
   trunk/windstille/src/engine/script_manager.hpp
   trunk/windstille/src/engine/sector.cpp
   trunk/windstille/src/engine/sector_builder.cpp
   trunk/windstille/src/engine/squirrel_thread.cpp
   trunk/windstille/src/font/border_font_effect.cpp
   trunk/windstille/src/font/border_font_effect.hpp
   trunk/windstille/src/font/font_effect.hpp
   trunk/windstille/src/font/fonts.cpp
   trunk/windstille/src/font/no_font_effect.cpp
   trunk/windstille/src/font/no_font_effect.hpp
   trunk/windstille/src/font/ttf_font.cpp
   trunk/windstille/src/gui/automap.cpp
   trunk/windstille/src/gui/button.cpp
   trunk/windstille/src/gui/group_component.cpp
   trunk/windstille/src/gui/gui_manager.cpp
   trunk/windstille/src/gui/list_view.cpp
   trunk/windstille/src/gui/menu.cpp
   trunk/windstille/src/gui/menu_component.cpp
   trunk/windstille/src/gui/root_component.cpp
   trunk/windstille/src/gui/slider.cpp
   trunk/windstille/src/gui/tab_component.cpp
   trunk/windstille/src/gui/text_view.cpp
   trunk/windstille/src/hud/controller_help_window.cpp
   trunk/windstille/src/hud/conversation.cpp
   trunk/windstille/src/hud/dialog_manager.cpp
   trunk/windstille/src/hud/inventory.cpp
   trunk/windstille/src/hud/pda.cpp
   trunk/windstille/src/hud/speech_manager.cpp
   trunk/windstille/src/input/controller.cpp
   trunk/windstille/src/input/input_configurator.cpp
   trunk/windstille/src/input/input_manager_sdl.cpp
   trunk/windstille/src/input/wiimote.cpp
   trunk/windstille/src/lisp/lexer.cpp
   trunk/windstille/src/lisp/lisp.cpp
   trunk/windstille/src/lisp/parser.cpp
   trunk/windstille/src/lisp/properties.cpp
   trunk/windstille/src/lisp/writer.cpp
   trunk/windstille/src/math/line.cpp
   trunk/windstille/src/math/matrix.cpp
   trunk/windstille/src/math/origin.cpp
   trunk/windstille/src/math/origin.hpp
   trunk/windstille/src/math/point.hpp
   trunk/windstille/src/math/random.cpp
   trunk/windstille/src/math/rect.cpp
   trunk/windstille/src/math/rect.hpp
   trunk/windstille/src/math/size.hpp
   trunk/windstille/src/navigation/edge.cpp
   trunk/windstille/src/navigation/edge_position.cpp
   trunk/windstille/src/navigation/navigation_graph.cpp
   trunk/windstille/src/navigation/node.cpp
   trunk/windstille/src/objects/background_gradient.cpp
   trunk/windstille/src/objects/bomb.cpp
   trunk/windstille/src/objects/box.cpp
   trunk/windstille/src/objects/character.cpp
   trunk/windstille/src/objects/decal.cpp
   trunk/windstille/src/objects/doll.cpp
   trunk/windstille/src/objects/elevator.cpp
   trunk/windstille/src/objects/grenade.cpp
   trunk/windstille/src/objects/hedgehog.cpp
   trunk/windstille/src/objects/laser_pointer.cpp
   trunk/windstille/src/objects/layer.cpp
   trunk/windstille/src/objects/liquid.cpp
   trunk/windstille/src/objects/nightvision.cpp
   trunk/windstille/src/objects/particle_systems.cpp
   trunk/windstille/src/objects/pistol.cpp
   trunk/windstille/src/objects/player.cpp
   trunk/windstille/src/objects/scriptable_object.cpp
   trunk/windstille/src/objects/scriptable_object.hpp
   trunk/windstille/src/objects/shockwave.cpp
   trunk/windstille/src/objects/spider_mine.cpp
   trunk/windstille/src/objects/swarm.cpp
   trunk/windstille/src/objects/test_object.cpp
   trunk/windstille/src/objects/test_object.hpp
   trunk/windstille/src/objects/trigger.cpp
   trunk/windstille/src/objects/vrdummy.cpp
   trunk/windstille/src/particles/deform_drawer.cpp
   trunk/windstille/src/particles/particle_system.cpp
   trunk/windstille/src/particles/spark_drawer.cpp
   trunk/windstille/src/particles/surface_drawer.cpp
   trunk/windstille/src/properties/properties.cpp
   trunk/windstille/src/properties/property_set.cpp
   trunk/windstille/src/scenegraph/control_drawable.hpp
   trunk/windstille/src/scenegraph/shockwave_drawable.hpp
   trunk/windstille/src/screen/armature_test.cpp
   trunk/windstille/src/screen/game_session.cpp
   trunk/windstille/src/screen/geometry_test.cpp
   trunk/windstille/src/screen/navigation_test.cpp
   trunk/windstille/src/screen/particle_viewer.cpp
   trunk/windstille/src/screen/screen_manager.cpp
   trunk/windstille/src/screen/sprite2dview.cpp
   trunk/windstille/src/screen/sprite3dview.cpp
   trunk/windstille/src/screen/view.cpp
   trunk/windstille/src/scripting/game_objects.cpp
   trunk/windstille/src/scripting/game_objects.hpp
   trunk/windstille/src/scripting/squirrel_error.cpp
   trunk/windstille/src/scripting/util.cpp
   trunk/windstille/src/sound/sound_channel.cpp
   trunk/windstille/src/sound/sound_manager.cpp
   trunk/windstille/src/sprite2d/data.cpp
   trunk/windstille/src/sprite2d/manager.cpp
   trunk/windstille/src/sprite2d/sprite.cpp
   trunk/windstille/src/sprite3d/manager.cpp
   trunk/windstille/src/sprite3d/sprite3d.cpp
   trunk/windstille/src/tile/tile.cpp
   trunk/windstille/src/tile/tile_description.cpp
   trunk/windstille/src/tile/tile_factory.cpp
   trunk/windstille/src/tile/tile_map.cpp
   trunk/windstille/src/tile/tile_packer.cpp
   trunk/windstille/src/util/baby_xml.cpp
   trunk/windstille/src/util/command_line.cpp
   trunk/windstille/src/util/command_line.hpp
   trunk/windstille/src/util/command_line_generic.cpp
   trunk/windstille/src/util/command_line_generic.hpp
   trunk/windstille/src/util/file_reader.cpp
   trunk/windstille/src/util/file_reader.hpp
   trunk/windstille/src/util/file_writer.cpp
   trunk/windstille/src/util/getter.cpp
   trunk/windstille/src/util/handle.hpp
   trunk/windstille/src/util/pathname.cpp
   trunk/windstille/src/util/response_curve.cpp
   trunk/windstille/src/util/sexpr_file_reader.cpp
   trunk/windstille/src/util/system.cpp
Log:
Unified the indention

Modified: trunk/windstille/src/app/config.cpp
===================================================================
--- trunk/windstille/src/app/config.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/app/config.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -71,9 +71,9 @@
 Config::~Config()
 {
   for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-    {
-      delete i-&gt;second;
-    }
+  {
+    delete i-&gt;second;
+  }
   config_values.clear();
 }
 
@@ -175,119 +175,119 @@
   argp.parse_args(argc, argv);
 
   while (argp.next())
+  {
+    switch (argp.get_key())
     {
-      switch (argp.get_key())
+      case 'A':
+        int anti_aliasing;
+        if (sscanf(argp.get_argument().c_str(), &quot;%d&quot;, &amp;anti_aliasing) != 1)
         {
-        case 'A':
-          int anti_aliasing;
-          if (sscanf(argp.get_argument().c_str(), &quot;%d&quot;, &amp;anti_aliasing) != 1)
-            {
-              throw std::runtime_error(&quot;Anti-Aliasing option '-a' requires argument of type {NUM}&quot;);
-            }
-          else
-            {
-              get&lt;int&gt;(&quot;anti-aliasing&quot;) = anti_aliasing;
-            }
-          break;
+          throw std::runtime_error(&quot;Anti-Aliasing option '-a' requires argument of type {NUM}&quot;);
+        }
+        else
+        {
+          get&lt;int&gt;(&quot;anti-aliasing&quot;) = anti_aliasing;
+        }
+        break;
 
-        case 'r':
-          get&lt;std::string&gt;(&quot;recorder-file&quot;) = argp.get_argument();
-          break;
+      case 'r':
+        get&lt;std::string&gt;(&quot;recorder-file&quot;) = argp.get_argument();
+        break;
 
-        case 'x':
-          get&lt;std::string&gt;(&quot;screenshot-dir&quot;) = argp.get_argument();
-          break;
+      case 'x':
+        get&lt;std::string&gt;(&quot;screenshot-dir&quot;) = argp.get_argument();
+        break;
 
-        case 'p':
-          get&lt;std::string&gt;(&quot;playback-file&quot;) = argp.get_argument();
-          break;
+      case 'p':
+        get&lt;std::string&gt;(&quot;playback-file&quot;) = argp.get_argument();
+        break;
 
-        case 'w':
-          get&lt;bool&gt;(&quot;wiimote&quot;) = true;
-          break;
+      case 'w':
+        get&lt;bool&gt;(&quot;wiimote&quot;) = true;
+        break;
 
-        case 'd':
-          Pathname::set_datadir(argp.get_argument());
-          break;
+      case 'd':
+        Pathname::set_datadir(argp.get_argument());
+        break;
 
-        case 'f':
-          set_bool(&quot;fullscreen&quot;, true);
-          break;
+      case 'f':
+        set_bool(&quot;fullscreen&quot;, true);
+        break;
 
-        case 'g':
-          {
-            int screen_width  = 800;
-            int screen_height = 600;
-            if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;,
-                       &amp;screen_width, &amp;screen_height) == 2)
-              {
-                get&lt;int&gt;(&quot;screen-width&quot;)  = screen_width;
-                get&lt;int&gt;(&quot;screen-height&quot;) = screen_height;
+      case 'g':
+      {
+        int screen_width  = 800;
+        int screen_height = 600;
+        if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;,
+                   &amp;screen_width, &amp;screen_height) == 2)
+        {
+          get&lt;int&gt;(&quot;screen-width&quot;)  = screen_width;
+          get&lt;int&gt;(&quot;screen-height&quot;) = screen_height;
               
-                // FIXME: Why does this get printed twice?!
-                // Is the argument parser buggy?
-                std::cout &lt;&lt; &quot;Geometry: &quot; &lt;&lt; screen_width &lt;&lt; &quot;x&quot; &lt;&lt; screen_height &lt;&lt; std::endl;
-              }
-            else
-              {
-                throw std::runtime_error(&quot;Geometry option '-g' requires argument of type {WIDTH}x{HEIGHT}&quot;);
-              }
-          }
-          break;
+          // FIXME: Why does this get printed twice?!
+          // Is the argument parser buggy?
+          std::cout &lt;&lt; &quot;Geometry: &quot; &lt;&lt; screen_width &lt;&lt; &quot;x&quot; &lt;&lt; screen_height &lt;&lt; std::endl;
+        }
+        else
+        {
+          throw std::runtime_error(&quot;Geometry option '-g' requires argument of type {WIDTH}x{HEIGHT}&quot;);
+        }
+      }
+      break;
 
-        case 'a':
-          {
-            int aspect_width  = 800;
-            int aspect_height = 600;
-            if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;,
-                       &amp;aspect_width, &amp;aspect_height) == 2)
-              {
-                get&lt;int&gt;(&quot;aspect-width&quot;)  = aspect_width;
-                get&lt;int&gt;(&quot;aspect-height&quot;) = aspect_height;
+      case 'a':
+      {
+        int aspect_width  = 800;
+        int aspect_height = 600;
+        if (sscanf(argp.get_argument().c_str(), &quot;%dx%d&quot;,
+                   &amp;aspect_width, &amp;aspect_height) == 2)
+        {
+          get&lt;int&gt;(&quot;aspect-width&quot;)  = aspect_width;
+          get&lt;int&gt;(&quot;aspect-height&quot;) = aspect_height;
               
-                // FIXME: Why does this get printed twice?!
-                // Is the argument parser buggy?
-                std::cout &lt;&lt; &quot;Geometry: &quot; &lt;&lt; aspect_width &lt;&lt; &quot;x&quot; &lt;&lt; aspect_height &lt;&lt; std::endl;
-              }
-            else
-              {
-                throw std::runtime_error(&quot;Geometry option '-a' requires argument of type {WIDTH}x{HEIGHT}&quot;);
-              }
-          }
-          break;
+          // FIXME: Why does this get printed twice?!
+          // Is the argument parser buggy?
+          std::cout &lt;&lt; &quot;Geometry: &quot; &lt;&lt; aspect_width &lt;&lt; &quot;x&quot; &lt;&lt; aspect_height &lt;&lt; std::endl;
+        }
+        else
+        {
+          throw std::runtime_error(&quot;Geometry option '-a' requires argument of type {WIDTH}x{HEIGHT}&quot;);
+        }
+      }
+      break;
         
-        case 's':
-          set_bool(&quot;sound&quot;, false);
-          break;
+      case 's':
+        set_bool(&quot;sound&quot;, false);
+        break;
 
-        case 'S':
-          set_bool(&quot;sound&quot;, true);
-          break;  
+      case 'S':
+        set_bool(&quot;sound&quot;, true);
+        break;  
 
-        case 'c':
-          get&lt;std::string&gt;(&quot;primary-controller-file&quot;) = argp.get_argument();
-          break;
+      case 'c':
+        get&lt;std::string&gt;(&quot;primary-controller-file&quot;) = argp.get_argument();
+        break;
 
-        case secondary_controller_file:
-          get&lt;std::string&gt;(&quot;secondary-controller-file&quot;) = argp.get_argument();
-          break;
+      case secondary_controller_file:
+        get&lt;std::string&gt;(&quot;secondary-controller-file&quot;) = argp.get_argument();
+        break;
 
-        case 'v':
-          std::cout &lt;&lt; &quot;Windstille &quot; &lt;&lt; WINDSTILLE_VERSION &lt;&lt; std::endl;
-          exit(EXIT_SUCCESS);
-          break;
+      case 'v':
+        std::cout &lt;&lt; &quot;Windstille &quot; &lt;&lt; WINDSTILLE_VERSION &lt;&lt; std::endl;
+        exit(EXIT_SUCCESS);
+        break;
 
-        case 'h':
-          argp.print_help();
-          exit(EXIT_SUCCESS);
-          break;
+      case 'h':
+        argp.print_help();
+        exit(EXIT_SUCCESS);
+        break;
 
-        case CommandLine::REST_ARG:
-          set_string(&quot;levelfile&quot;, argp.get_argument());
-          arg_files.push_back(argp.get_argument());
-          break;
-        }
+      case CommandLine::REST_ARG:
+        set_string(&quot;levelfile&quot;, argp.get_argument());
+        arg_files.push_back(argp.get_argument());
+        break;
     }
+  }
 }
 
 bool
@@ -302,67 +302,67 @@
 {
   ConfigValues::iterator i = config_values.find(name);
   if (i == config_values.end())
-    {
-      throw std::runtime_error(&quot;Error: unknown Config value: '&quot; + name + &quot;'&quot;);        
-    }    
+  {
+    throw std::runtime_error(&quot;Error: unknown Config value: '&quot; + name + &quot;'&quot;);        
+  }    
   else
-    {
-      return i-&gt;second-&gt;is_set();
-    }
+  {
+    return i-&gt;second-&gt;is_set();
+  }
 }
 
 void
 Config::load()
 {
   try 
+  {
+    FileReader reader = FileReader::parse(Pathname(&quot;config&quot;, Pathname::kUserPath));
+    if(reader.get_name() != &quot;windstille-config&quot;) 
     {
-      FileReader reader = FileReader::parse(Pathname(&quot;config&quot;, Pathname::kUserPath));
-      if(reader.get_name() != &quot;windstille-config&quot;) 
-        {
-          std::cerr &lt;&lt; &quot;Warning: Config file is not a windstille-config file.\n&quot;;
-          return;
-        }
+      std::cerr &lt;&lt; &quot;Warning: Config file is not a windstille-config file.\n&quot;;
+      return;
+    }
     
-      for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-        { // FIXME: all this dynamic_casting is overcomplicated crap
-          if (dynamic_cast&lt;ConfigValue&lt;int&gt;*&gt;(i-&gt;second))
-            {
-              int v;
-              if (reader.get(i-&gt;first.c_str(), v))
-                set_int(i-&gt;first, v);
-            }
-          else if (dynamic_cast&lt;ConfigValue&lt;bool&gt;*&gt;(i-&gt;second))
-            {
-              bool v;
-              if (reader.get(i-&gt;first.c_str(), v))
-                set_bool(i-&gt;first, v);
-            }
-          else if (dynamic_cast&lt;ConfigValue&lt;float&gt;*&gt;(i-&gt;second))
-            {
-              float v;
-              if (reader.get(i-&gt;first.c_str(), v))
-                set_float(i-&gt;first, v);
-            }
-          else if (dynamic_cast&lt;ConfigValue&lt;std::string&gt;*&gt;(i-&gt;second))
-            {
-              std::string v;
-              if (reader.get(i-&gt;first.c_str(), v))
-                set_string(i-&gt;first, v);
-            }
-          else 
-            {
-              std::cout &lt;&lt; &quot;Config: Unknown type for: &quot; &lt;&lt; i-&gt;first &lt;&lt; std::endl;
-            }
-        }
+    for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
+    { // FIXME: all this dynamic_casting is overcomplicated crap
+      if (dynamic_cast&lt;ConfigValue&lt;int&gt;*&gt;(i-&gt;second))
+      {
+        int v;
+        if (reader.get(i-&gt;first.c_str(), v))
+          set_int(i-&gt;first, v);
+      }
+      else if (dynamic_cast&lt;ConfigValue&lt;bool&gt;*&gt;(i-&gt;second))
+      {
+        bool v;
+        if (reader.get(i-&gt;first.c_str(), v))
+          set_bool(i-&gt;first, v);
+      }
+      else if (dynamic_cast&lt;ConfigValue&lt;float&gt;*&gt;(i-&gt;second))
+      {
+        float v;
+        if (reader.get(i-&gt;first.c_str(), v))
+          set_float(i-&gt;first, v);
+      }
+      else if (dynamic_cast&lt;ConfigValue&lt;std::string&gt;*&gt;(i-&gt;second))
+      {
+        std::string v;
+        if (reader.get(i-&gt;first.c_str(), v))
+          set_string(i-&gt;first, v);
+      }
+      else 
+      {
+        std::cout &lt;&lt; &quot;Config: Unknown type for: &quot; &lt;&lt; i-&gt;first &lt;&lt; std::endl;
+      }
+    }
     
-      // TODO read controller config
-    } 
+    // TODO read controller config
+  } 
   catch(std::exception&amp; e) 
-    {
-      std::cerr &lt;&lt; &quot;Couldn't open config file: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;
-                &lt;&lt; &quot;This is normal on first startup!\n&quot;;
-      return;
-    }
+  {
+    std::cerr &lt;&lt; &quot;Couldn't open config file: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;
+              &lt;&lt; &quot;This is normal on first startup!\n&quot;;
+    return;
+  }
 }
 
 void
@@ -376,14 +376,14 @@
     writer.start_list(&quot;windstille-config&quot;);
 
     for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
+    {
+      if (i-&gt;second-&gt;should_be_saved() &amp;&amp; i-&gt;second-&gt;is_set())
       {
-        if (i-&gt;second-&gt;should_be_saved() &amp;&amp; i-&gt;second-&gt;is_set())
-          {
-            writer.write_comment(&quot;  ;; &quot; + i-&gt;second-&gt;get_docstring()); 
-            i-&gt;second-&gt;write(writer);
-            writer.write_comment(&quot;&quot;);
-          }
+        writer.write_comment(&quot;  ;; &quot; + i-&gt;second-&gt;get_docstring()); 
+        i-&gt;second-&gt;write(writer);
+        writer.write_comment(&quot;&quot;);
       }
+    }
     // TODO write controller config
     
     writer.end_list(&quot;windstille-config&quot;);
@@ -398,14 +398,14 @@
 {
   out &lt;&lt; &quot;Config &quot; &lt;&lt; this &lt;&lt; &quot;:&quot; &lt;&lt; std::endl;
   for(ConfigValues::iterator i = config_values.begin(); i != config_values.end(); ++i)
-    {
-      out &lt;&lt; boost::format(&quot;  %|1$20| = %|2$-20| (%|3$|)&quot;)
-        % i-&gt;second-&gt;get_name()
-        % (boost::format(&quot;'%|1s|'&quot;) % (*i-&gt;second))
-        % (i-&gt;second-&gt;is_set() ? &quot;set&quot; : &quot;default&quot;)
-          &lt;&lt; std::endl;
+  {
+    out &lt;&lt; boost::format(&quot;  %|1$20| = %|2$-20| (%|3$|)&quot;)
+      % i-&gt;second-&gt;get_name()
+      % (boost::format(&quot;'%|1s|'&quot;) % (*i-&gt;second))
+      % (i-&gt;second-&gt;is_set() ? &quot;set&quot; : &quot;default&quot;)
+        &lt;&lt; std::endl;
       
-    }
+  }
 }
 
 template&lt;&gt;

Modified: trunk/windstille/src/app/config.hpp
===================================================================
--- trunk/windstille/src/app/config.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/app/config.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -139,17 +139,17 @@
   ConfigValue&lt;T&gt;&amp; get(const std::string&amp; name) const {
     ConfigValues::const_iterator i = config_values.find(name);
     if (i == config_values.end())
-      {
-        throw std::runtime_error(&quot;Error: unknown Config value: '&quot; + name + &quot;'&quot;);
-      }
+    {
+      throw std::runtime_error(&quot;Error: unknown Config value: '&quot; + name + &quot;'&quot;);
+    }
     else
-      {
-        ConfigValue&lt;T&gt;* ptr = dynamic_cast&lt;ConfigValue&lt;T&gt;*&gt;(i-&gt;second);
-        if (ptr)
-          return *ptr;
-        else
-          throw std::runtime_error(&quot;Error: Config value: '&quot; + name + &quot;' as wrong type&quot;);
-      }
+    {
+      ConfigValue&lt;T&gt;* ptr = dynamic_cast&lt;ConfigValue&lt;T&gt;*&gt;(i-&gt;second);
+      if (ptr)
+        return *ptr;
+      else
+        throw std::runtime_error(&quot;Error: Config value: '&quot; + name + &quot;' as wrong type&quot;);
+    }
   }
 
   std::string get_string(const std::string&amp; name) const;

Modified: trunk/windstille/src/app/console.cpp
===================================================================
--- trunk/windstille/src/app/console.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/app/console.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -167,152 +167,152 @@
                        Color(0, 0, 0, 0.5f));
 
   for(int i = buffer.size()-1 - scroll_offset; i &gt;= 0 &amp;&amp; i &gt; int(buffer.size()) - num_lines - scroll_offset; --i)
+  {
+    if (buffer[i].display_time &lt; 5.0f || console.is_active())
     {
-      if (buffer[i].display_time &lt; 5.0f || console.is_active())
-        {
-          float alpha = 1.0f;
-          if (buffer[i].display_time &gt; 4.0f &amp;&amp; !console.is_active())
-            alpha = 1.0f - (buffer[i].display_time - 4.0f);
+      float alpha = 1.0f;
+      if (buffer[i].display_time &gt; 4.0f &amp;&amp; !console.is_active())
+        alpha = 1.0f - (buffer[i].display_time - 4.0f);
 
-          Fonts::current()-&gt;ttffont-&gt;draw(Vector2f(x_pos, static_cast&lt;float&gt;(y)), buffer[i].message, 
-                                          Color(0.88f, 0.88f, 1.0f, alpha));
-        }
-      y -= Fonts::current()-&gt;ttffont-&gt;get_height() + 2;
+      Fonts::current()-&gt;ttffont-&gt;draw(Vector2f(x_pos, static_cast&lt;float&gt;(y)), buffer[i].message, 
+                                      Color(0.88f, 0.88f, 1.0f, alpha));
     }
+    y -= Fonts::current()-&gt;ttffont-&gt;get_height() + 2;
+  }
 
   if (active)
+  {
+    std::string str = command_line;
+    if (SDL_GetTicks() % 300 &gt; 150)
     {
-      std::string str = command_line;
-      if (SDL_GetTicks() % 300 &gt; 150)
-        {
-          if (cursor_pos &lt; int(str.size()))
-            str[cursor_pos] = '_';
-          else
-            str += &quot;_&quot;;
-        }
+      if (cursor_pos &lt; int(str.size()))
+        str[cursor_pos] = '_';
+      else
+        str += &quot;_&quot;;
+    }
 
-      Fonts::current()-&gt;ttffont-&gt;draw(Vector2f(x_pos, y_pos), &quot;&gt; &quot; + str, Color(1.0f, 1.0f, 1.0f));
-    }
+    Fonts::current()-&gt;ttffont-&gt;draw(Vector2f(x_pos, y_pos), &quot;&gt; &quot; + str, Color(1.0f, 1.0f, 1.0f));
+  }
 }
 
 void
 ConsoleImpl::update(float delta)
 {
   for(Buffer::iterator i = buffer.begin(); i != buffer.end(); ++i)
-    {
-      i-&gt;display_time += delta;
-    }  
+  {
+    i-&gt;display_time += delta;
+  }  
 
   if (active)
+  {
+    InputEventLst events = InputManagerSDL::current()-&gt;get_controller().get_events();
+  
+    for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
     {
-      InputEventLst events = InputManagerSDL::current()-&gt;get_controller().get_events();
-  
-      for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
+      if ((*i).type == KEYBOARD_EVENT)
+      {
+        if ((*i).keyboard.key_type == KeyboardEvent::LETTER)
         {
-          if ((*i).type == KEYBOARD_EVENT)
-            {
-              if ((*i).keyboard.key_type == KeyboardEvent::LETTER)
-                {
-                  if (cursor_pos == int(command_line.size()))
-                    {
-                      command_line += static_cast&lt;char&gt;((*i).keyboard.code);
-                      cursor_pos += 1;
-                    }
-                  else
-                    {
-                      command_line.insert(cursor_pos, std::string(1, static_cast&lt;char&gt;((*i).keyboard.code)));
-                      cursor_pos += 1;
-                    }
-                }
-              else if ((*i).keyboard.key_type == KeyboardEvent::SPECIAL)
-                {
-                  //console &lt;&lt; &quot;special: &quot; &lt;&lt; i-&gt;keyboard.code &lt;&lt; std::endl;
+          if (cursor_pos == int(command_line.size()))
+          {
+            command_line += static_cast&lt;char&gt;((*i).keyboard.code);
+            cursor_pos += 1;
+          }
+          else
+          {
+            command_line.insert(cursor_pos, std::string(1, static_cast&lt;char&gt;((*i).keyboard.code)));
+            cursor_pos += 1;
+          }
+        }
+        else if ((*i).keyboard.key_type == KeyboardEvent::SPECIAL)
+        {
+          //console &lt;&lt; &quot;special: &quot; &lt;&lt; i-&gt;keyboard.code &lt;&lt; std::endl;
 
-                  switch (i-&gt;keyboard.code)
-                    {
-                    case SDLK_BACKSPACE:
-                      if (!command_line.empty() &amp;&amp; cursor_pos &gt; 0)
-                        {
-                          command_line.erase(cursor_pos - 1, 1);
-                          cursor_pos -= 1;
-                        }
-                      break;
+          switch (i-&gt;keyboard.code)
+          {
+            case SDLK_BACKSPACE:
+              if (!command_line.empty() &amp;&amp; cursor_pos &gt; 0)
+              {
+                command_line.erase(cursor_pos - 1, 1);
+                cursor_pos -= 1;
+              }
+              break;
 
-                    case SDLK_DELETE:
-                      if (!command_line.empty())
-                        {
-                          command_line.erase(cursor_pos, 1);
-                        }
-                      break;
+            case SDLK_DELETE:
+              if (!command_line.empty())
+              {
+                command_line.erase(cursor_pos, 1);
+              }
+              break;
 
-                    case SDLK_DOWN:
-                      if (!history.empty())
-                        {
-                          history_position += 1;
-                          if (history_position &gt; int(history.size())-1)
-                            history_position = int(history.size())-1;
-                          command_line = history[history_position];
-                          cursor_pos = command_line.size();
-                        }
-                      break;
+            case SDLK_DOWN:
+              if (!history.empty())
+              {
+                history_position += 1;
+                if (history_position &gt; int(history.size())-1)
+                  history_position = int(history.size())-1;
+                command_line = history[history_position];
+                cursor_pos = command_line.size();
+              }
+              break;
 
-                    case SDLK_HOME:
-                      cursor_pos = 0;
-                      break;
+            case SDLK_HOME:
+              cursor_pos = 0;
+              break;
                       
-                    case SDLK_END:
-                      cursor_pos = command_line.size();
-                      break;
+            case SDLK_END:
+              cursor_pos = command_line.size();
+              break;
                         
-                    case SDLK_PAGEUP:
-                      console.scroll(10);
-                      break;
+            case SDLK_PAGEUP:
+              console.scroll(10);
+              break;
 
-                    case SDLK_PAGEDOWN:
-                      console.scroll(-10);
-                      break;
+            case SDLK_PAGEDOWN:
+              console.scroll(-10);
+              break;
 
-                    case SDLK_TAB:
-                      tab_complete();
-                      break;
+            case SDLK_TAB:
+              tab_complete();
+              break;
 
-                    case SDLK_UP:
-                      if (!history.empty())
-                        {
-                          history_position -= 1;
-                          if (history_position &lt; 0)
-                            history_position = 0;
+            case SDLK_UP:
+              if (!history.empty())
+              {
+                history_position -= 1;
+                if (history_position &lt; 0)
+                  history_position = 0;
 
-                          command_line = history[history_position];
-                          cursor_pos = command_line.size();
-                        }
-                      break;
+                command_line = history[history_position];
+                cursor_pos = command_line.size();
+              }
+              break;
 
-                    case SDLK_LEFT:
-                      cursor_pos -= 1;
-                      if (cursor_pos &lt; 0)
-                        cursor_pos = 0;
-                      break;
+            case SDLK_LEFT:
+              cursor_pos -= 1;
+              if (cursor_pos &lt; 0)
+                cursor_pos = 0;
+              break;
 
-                    case SDLK_RIGHT:
-                      cursor_pos += 1;
-                      if (cursor_pos &gt; int(command_line.size()))
-                        cursor_pos = command_line.size();
-                      break;
+            case SDLK_RIGHT:
+              cursor_pos += 1;
+              if (cursor_pos &gt; int(command_line.size()))
+                cursor_pos = command_line.size();
+              break;
 
-                    case SDLK_RETURN:
-                      eval_command_line();
-                      break;
+            case SDLK_RETURN:
+              eval_command_line();
+              break;
 
-                    case SDLK_ESCAPE:
-                    case SDLK_F1:
-                      console.deactive();
-                      break;
-                    }
-                }
-            }
+            case SDLK_ESCAPE:
+            case SDLK_F1:
+              console.deactive();
+              break;
+          }
         }
+      }
     }
+  }
 }
 
 void
@@ -320,9 +320,9 @@
 {
   ConsoleLog &lt;&lt; std::flush;
   if (!current_entry.message.empty())
-    {
-      ConsoleLog &lt;&lt; std::endl;
-    }
+  {
+    ConsoleLog &lt;&lt; std::endl;
+  }
 }
 
 std::vector&lt;std::string&gt;
@@ -336,20 +336,20 @@
   //push your table/array here
   sq_pushnull(v);  //null iterator
   while(SQ_SUCCEEDED(sq_next(v,-2)))
+  {
+    // here -1 is the value and -2 is the key
+    const SQChar *s;
+    if (SQ_SUCCEEDED(sq_getstring(v,-2, &amp;s)))
     {
-      // here -1 is the value and -2 is the key
-      const SQChar *s;
-      if (SQ_SUCCEEDED(sq_getstring(v,-2, &amp;s)))
-        {
-          roottable.push_back(static_cast&lt;const char*&gt;(s)); // FIXME: likely not going to work on 64bit
-        }
-      else
-        {
-          ConsoleLog &lt;&lt; &quot;Unknown key type for element&quot; &lt;&lt; std::endl;
-        }
+      roottable.push_back(static_cast&lt;const char*&gt;(s)); // FIXME: likely not going to work on 64bit
+    }
+    else
+    {
+      ConsoleLog &lt;&lt; &quot;Unknown key type for element&quot; &lt;&lt; std::endl;
+    }
                               
-      sq_pop(v,2); //pops key and val before the nex iteration
-    }
+    sq_pop(v,2); //pops key and val before the nex iteration
+  }
                           
   sq_pop(v, 1);
   
@@ -374,21 +374,21 @@
 static std::string find_longest_prefix(const std::vector&lt;std::string&gt;&amp; lst)
 {
   if (lst.empty())
+  {
+    return &quot;&quot;;
+  }
+  else
+  {
+    std::string prefix = lst.front();
+
+    for(std::vector&lt;std::string&gt;::const_iterator i = lst.begin() + 1; 
+        i != lst.end(); ++i)
     {
-      return &quot;&quot;;
+      prefix = longest_prefix(prefix, *i);
     }
-  else
-    {
-      std::string prefix = lst.front();
 
-      for(std::vector&lt;std::string&gt;::const_iterator i = lst.begin() + 1; 
-          i != lst.end(); ++i)
-        {
-          prefix = longest_prefix(prefix, *i);
-        }
-
-      return prefix;
-    }
+    return prefix;
+  }
 }
 
 void
@@ -400,94 +400,94 @@
   for(std::vector&lt;std::string&gt;::const_iterator i = roottable.begin();
       i != roottable.end();
       ++i)
+  {
+    if (has_prefix(*i, command_line))
     {
-      if (has_prefix(*i, command_line))
-        {
-          completions.push_back(*i);
-        }
+      completions.push_back(*i);
     }
+  }
 
   if (completions.empty())
-    {
-      // console &lt;&lt; &quot;No completions&quot; &lt;&lt; std::endl;
-    }
+  {
+    // console &lt;&lt; &quot;No completions&quot; &lt;&lt; std::endl;
+  }
   else if (completions.size() == 1)
+  {
+    command_line = completions.front();
+    cursor_pos = command_line.size();
+  }
+  else 
+  {
+    ConsoleLog &lt;&lt; &quot;&gt; &quot; &lt;&lt; command_line &lt;&lt; std::endl;
+    for(std::vector&lt;std::string&gt;::iterator i = completions.begin(); i != completions.end(); ++i)
     {
-      command_line = completions.front();
-      cursor_pos = command_line.size();
+      ConsoleLog &lt;&lt; *i &lt;&lt; &quot; &quot;;
     }
-  else 
-    {
-      ConsoleLog &lt;&lt; &quot;&gt; &quot; &lt;&lt; command_line &lt;&lt; std::endl;
-      for(std::vector&lt;std::string&gt;::iterator i = completions.begin(); i != completions.end(); ++i)
-        {
-          ConsoleLog &lt;&lt; *i &lt;&lt; &quot; &quot;;
-        }
-      ConsoleLog &lt;&lt; std::endl;
+    ConsoleLog &lt;&lt; std::endl;
 
-      command_line = find_longest_prefix(completions);
-      cursor_pos = command_line.size();
-    }
+    command_line = find_longest_prefix(completions);
+    cursor_pos = command_line.size();
+  }
 }
 
 void
 ConsoleImpl::eval_command_line()
 {
   if (!command_line.empty() &amp;&amp; (history.empty() || history.back() != command_line))
-    {
-      history.push_back(command_line);
-      history_position = history.size();
-    }
+  {
+    history.push_back(command_line);
+    history_position = history.size();
+  }
                       
   ConsoleLog &lt;&lt; &quot;&gt; &quot; &lt;&lt; command_line &lt;&lt; std::endl;
 
   if (command_line == &quot;quit&quot; || command_line == &quot;exit&quot;)
-    {
-      console.deactive();
-    }
+  {
+    console.deactive();
+  }
   else if (command_line == &quot;help&quot;)
-    {
-      ConsoleLog &lt;&lt; &quot;This is a script console, can enter stuff in here that will then be evaluated.\n&quot;
-              &lt;&lt; &quot;Type 'quit' to exit the console.&quot; &lt;&lt; std::endl;
-    }
+  {
+    ConsoleLog &lt;&lt; &quot;This is a script console, can enter stuff in here that will then be evaluated.\n&quot;
+               &lt;&lt; &quot;Type 'quit' to exit the console.&quot; &lt;&lt; std::endl;
+  }
   else if (command_line == &quot;reset&quot;)
-    {
-      GameSession::current()-&gt;set_sector(Pathname(&quot;levels/newformat2.wst&quot;));
-    }
+  {
+    GameSession::current()-&gt;set_sector(Pathname(&quot;levels/newformat2.wst&quot;));
+  }
   else if (command_line == &quot;show&quot;)
-    {
-      HSQUIRRELVM v = ScriptManager::current()-&gt;get_vm();
+  {
+    HSQUIRRELVM v = ScriptManager::current()-&gt;get_vm();
 
-      int size = sq_getsize(v, -1);
-      ConsoleLog &lt;&lt; size &lt;&lt; &quot; elements on the root table&quot; &lt;&lt; std::endl;
+    int size = sq_getsize(v, -1);
+    ConsoleLog &lt;&lt; size &lt;&lt; &quot; elements on the root table&quot; &lt;&lt; std::endl;
 
-      sq_pushroottable(v);
+    sq_pushroottable(v);
 
-      //push your table/array here
-      sq_pushnull(v);  //null iterator
-      while(SQ_SUCCEEDED(sq_next(v,-2)))
-        {
-          //here -1 is the value and -2 is the key
-          const SQChar *s;
-          if (SQ_SUCCEEDED(sq_getstring(v,-2, &amp;s)))
-            {
-              ConsoleLog &lt;&lt; s &lt;&lt; &quot; -&gt; &quot; &lt;&lt; Scripting::squirrel2string(v, -1) &lt;&lt; std::endl;
-            }
-          else
-            {
-              ConsoleLog &lt;&lt; &quot;Unknown key type for element&quot; &lt;&lt; std::endl;
-            }
+    //push your table/array here
+    sq_pushnull(v);  //null iterator
+    while(SQ_SUCCEEDED(sq_next(v,-2)))
+    {
+      //here -1 is the value and -2 is the key
+      const SQChar *s;
+      if (SQ_SUCCEEDED(sq_getstring(v,-2, &amp;s)))
+      {
+        ConsoleLog &lt;&lt; s &lt;&lt; &quot; -&gt; &quot; &lt;&lt; Scripting::squirrel2string(v, -1) &lt;&lt; std::endl;
+      }
+      else
+      {
+        ConsoleLog &lt;&lt; &quot;Unknown key type for element&quot; &lt;&lt; std::endl;
+      }
                               
-          sq_pop(v,2); //pops key and val before the nex iteration
-        }
+      sq_pop(v,2); //pops key and val before the nex iteration
+    }
                           
-      sq_pop(v, 1);
-    }
+    sq_pop(v, 1);
+  }
   else
-    {
-      execute(command_line);
-      maybe_newline();
-    }
+  {
+    execute(command_line);
+    maybe_newline();
+  }
   command_line = &quot;&quot;;
   cursor_pos = 0;
 }
@@ -505,25 +505,25 @@
   int oldtop = sq_gettop(vm); 
 
   try 
+  {
+    if(SQ_SUCCEEDED(sq_compilebuffer(vm, str.c_str(), i, _SC(&quot;interactive console&quot;), SQTrue)))
     {
-      if(SQ_SUCCEEDED(sq_compilebuffer(vm, str.c_str(), i, _SC(&quot;interactive console&quot;), SQTrue)))
-        {
-          sq_pushroottable(vm);
-          if(SQ_SUCCEEDED(sq_call(vm, 1, 1/*retval*/, true))) 
-            {
-              // FIXME: This does only work when somebody is doing a 'return', i.e. almost never
-              if (sq_gettype(vm, -1) != OT_NULL)
-                ConsoleLog &lt;&lt; Scripting::squirrel2string(vm, -1) &lt;&lt; std::endl;
-              // else
-              //   console &lt;&lt; &quot;(null)&quot; &lt;&lt; std::endl;
-            }
-        }
-    } 
+      sq_pushroottable(vm);
+      if(SQ_SUCCEEDED(sq_call(vm, 1, 1/*retval*/, true))) 
+      {
+        // FIXME: This does only work when somebody is doing a 'return', i.e. almost never
+        if (sq_gettype(vm, -1) != OT_NULL)
+          ConsoleLog &lt;&lt; Scripting::squirrel2string(vm, -1) &lt;&lt; std::endl;
+        // else
+        //   console &lt;&lt; &quot;(null)&quot; &lt;&lt; std::endl;
+      }
+    }
+  } 
   catch(std::exception&amp; e) 
-    {
-      std::cerr &lt;&lt; &quot;Couldn't execute command '&quot; &lt;&lt; str_ &lt;&lt; &quot;': &quot;
-                &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-    }
+  {
+    std::cerr &lt;&lt; &quot;Couldn't execute command '&quot; &lt;&lt; str_ &lt;&lt; &quot;': &quot;
+              &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
+  }
 
   // Reset to old stack position
   sq_settop(vm, oldtop);
@@ -531,8 +531,8 @@
 
 //-------------------------------------------------------------------------------
 
-Console::Console()
-  : impl(new ConsoleImpl(*this))
+Console::Console() :
+  impl(new ConsoleImpl(*this))
 {
 }
 

Modified: trunk/windstille/src/app/controller_def.hpp
===================================================================
--- trunk/windstille/src/app/controller_def.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/app/controller_def.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,46 +22,46 @@
 #include &quot;input/controller_description.hpp&quot;
 
 enum InputEventName
-  { 
-    MOUSE_MOTION_X, 
-    MOUSE_MOTION_Y, 
+{ 
+  MOUSE_MOTION_X, 
+  MOUSE_MOTION_Y, 
 
-    X_AXIS,
-    Y_AXIS,
+  X_AXIS,
+  Y_AXIS,
 
-    X2_AXIS,
-    Y2_AXIS, 
+  X2_AXIS,
+  Y2_AXIS, 
 
-    LEFT_STICK_BUTTON,    
-    RIGHT_STICK_BUTTON,
+  LEFT_STICK_BUTTON,    
+  RIGHT_STICK_BUTTON,
 
-    PRIMARY_BUTTON,
-    SECONDARY_BUTTON,
-    TERTIARY_BUTTON,
-    QUATERNARY_BUTTON,
+  PRIMARY_BUTTON,
+  SECONDARY_BUTTON,
+  TERTIARY_BUTTON,
+  QUATERNARY_BUTTON,
 
-    LEFT_SHOULDER_BUTTON,
-    RIGHT_SHOULDER_BUTTON,
+  LEFT_SHOULDER_BUTTON,
+  RIGHT_SHOULDER_BUTTON,
 
-    LEFT_TRIGGER_AXIS,
-    RIGHT_TRIGGER_AXIS,
+  LEFT_TRIGGER_AXIS,
+  RIGHT_TRIGGER_AXIS,
 
-    SELECT_BUTTON,
-    START_BUTTON,
-    DEBUG_BUTTON,
+  SELECT_BUTTON,
+  START_BUTTON,
+  DEBUG_BUTTON,
     
-    // Keys for menu navigation, they come with hardcoded defaults for
-    // the keyboard, a joystick might emmit them as well
-    ESCAPE_BUTTON,
-    ENTER_BUTTON,
+  // Keys for menu navigation, they come with hardcoded defaults for
+  // the keyboard, a joystick might emmit them as well
+  ESCAPE_BUTTON,
+  ENTER_BUTTON,
 
-    MENU_UP_BUTTON,  
-    MENU_DOWN_BUTTON,
-    MENU_LEFT_BUTTON,
-    MENU_RIGHT_BUTTON,
+  MENU_UP_BUTTON,  
+  MENU_DOWN_BUTTON,
+  MENU_LEFT_BUTTON,
+  MENU_RIGHT_BUTTON,
 
-    LAST_EVENT
-  };
+  LAST_EVENT
+};
 
 // Map the physical buttons to logical names
 #define JUMP_BUTTON   PRIMARY_BUTTON

Modified: trunk/windstille/src/app/menu_manager.cpp
===================================================================
--- trunk/windstille/src/app/menu_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/app/menu_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -145,10 +145,10 @@
 
   menu.add_button(&quot;Resume&quot;,  boost::bind(&amp;MenuManager::menu_continue));
   if (Sector::current())
-    {
-      menu.add_button(&quot;Debug&quot;, boost::bind(&amp;MenuManager::display_debug_menu));
-      //menu.add_button(&quot;Select Scenario&quot;, boost::bind(&amp;MenuManager::display_scenario_menu));
-    }
+  {
+    menu.add_button(&quot;Debug&quot;, boost::bind(&amp;MenuManager::display_debug_menu));
+    //menu.add_button(&quot;Select Scenario&quot;, boost::bind(&amp;MenuManager::display_scenario_menu));
+  }
   menu.add_button(&quot;Options&quot;, boost::bind(&amp;MenuManager::display_option_menu));
   menu.add_button(&quot;Credits&quot;, boost::bind(&amp;MenuManager::display_credits));
   menu.add_button(&quot;Help&quot;, boost::bind(&amp;MenuManager::display_help));
@@ -177,9 +177,9 @@
   models.push_back(Pathname(&quot;models/vehicles/train/train.wsprite&quot;)); 
 
   for(std::vector&lt;Pathname&gt;::const_iterator i = models.begin(); i != models.end(); ++i)
-    {
-      menu.add_button(i-&gt;get_raw_path(), boost::bind(&amp;MenuManager::menu_show_model, *i));
-    }
+  {
+    menu.add_button(i-&gt;get_raw_path(), boost::bind(&amp;MenuManager::menu_show_model, *i));
+  }
   
   menu.show();
 }
@@ -216,9 +216,9 @@
   scenarios.push_back(Pathname(&quot;sectors/virtualreality/virtualreality.wst&quot;));
   
   for(std::vector&lt;Pathname&gt;::const_iterator i = scenarios.begin(); i != scenarios.end(); ++i)
-    {
-      menu.add_button(i-&gt;get_raw_path(), boost::bind(&amp;MenuManager::menu_start_scenario, *i));
-    }
+  {
+    menu.add_button(i-&gt;get_raw_path(), boost::bind(&amp;MenuManager::menu_start_scenario, *i));
+  }
 
   menu.show();
 }
@@ -301,7 +301,7 @@
                  &quot;distribute binaries, see the file COPYING for details.\n&quot;
                  &quot;\n&quot;
                  &quot;# EOF #\n&quot;
-                 );
+    );
   text-&gt;set_active(true);
   
   group-&gt;pack(text.release());
@@ -463,18 +463,18 @@
 MenuManager::menu_ambient_light(int i, int component)
 {
   if (Sector::current())
-    {
-      Color amb = Sector::current()-&gt;get_ambient_light();
+  {
+    Color amb = Sector::current()-&gt;get_ambient_light();
 
-      if (component == 0)
-        amb.r = static_cast&lt;float&gt;(i) / 100.0f;
-      else if (component == 1)
-        amb.g = static_cast&lt;float&gt;(i) / 100.0f;
-      else if (component == 2)
-        amb.b = static_cast&lt;float&gt;(i) / 100.0f;
+    if (component == 0)
+      amb.r = static_cast&lt;float&gt;(i) / 100.0f;
+    else if (component == 1)
+      amb.g = static_cast&lt;float&gt;(i) / 100.0f;
+    else if (component == 2)
+      amb.b = static_cast&lt;float&gt;(i) / 100.0f;
 
-      Sector::current()-&gt;set_ambient_light(amb);
-    }
+    Sector::current()-&gt;set_ambient_light(amb);
+  }
 }
 
 void
@@ -510,21 +510,21 @@
 {
 #ifdef HAVE_CWIID
   if (wiimote &amp;&amp; !wiimote-&gt;is_connected())
-    {
-      // FIXME: This never appears on screen due to timeout
-      ConsoleLog &lt;&lt; &quot;Trying to connect Wiimote: Press buttons 1 and 2 to connect&quot; &lt;&lt; std::endl;
+  {
+    // FIXME: This never appears on screen due to timeout
+    ConsoleLog &lt;&lt; &quot;Trying to connect Wiimote: Press buttons 1 and 2 to connect&quot; &lt;&lt; std::endl;
 
-      wiimote-&gt;connect();
+    wiimote-&gt;connect();
 
-      if (wiimote-&gt;is_connected())
-        ConsoleLog &lt;&lt; &quot;Wiimote connected&quot; &lt;&lt; std::endl;
-      else
-        ConsoleLog &lt;&lt; &quot;Wiimote connection failed&quot; &lt;&lt; std::endl;
-    }
+    if (wiimote-&gt;is_connected())
+      ConsoleLog &lt;&lt; &quot;Wiimote connected&quot; &lt;&lt; std::endl;
+    else
+      ConsoleLog &lt;&lt; &quot;Wiimote connection failed&quot; &lt;&lt; std::endl;
+  }
   else
-    {
-      ConsoleLog &lt;&lt; &quot;Wiimote already is connected&quot; &lt;&lt; std::endl;
-    }
+  {
+    ConsoleLog &lt;&lt; &quot;Wiimote already is connected&quot; &lt;&lt; std::endl;
+  }
 #endif
 }
 

Modified: trunk/windstille/src/armature/armature.cpp
===================================================================
--- trunk/windstille/src/armature/armature.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/armature/armature.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -26,10 +26,10 @@
 #include &quot;display/color.hpp&quot;
 #include &quot;armature/pose.hpp&quot;
 
-Armature::Armature(FileReader&amp; reader)
-  : name(),
-    bones(),
-    root_bone(0)
+Armature::Armature(FileReader&amp; reader) :
+  name(),
+  bones(),
+  root_bone(0)
 {
   parse(reader);
 }
@@ -45,66 +45,66 @@
 Armature::parse(FileReader&amp; reader)
 {
   if (reader.get_name() != &quot;armature&quot;)
-    {
-      throw std::runtime_error(&quot;Not an armature file: &quot; + reader.get_name());
-    }
+  {
+    throw std::runtime_error(&quot;Not an armature file: &quot; + reader.get_name());
+  }
   else
-    {
-      reader.get(&quot;name&quot;, name);
+  {
+    reader.get(&quot;name&quot;, name);
       
-      FileReader bones_section;
-      reader.get(&quot;bones&quot;, bones_section);
+    FileReader bones_section;
+    reader.get(&quot;bones&quot;, bones_section);
 
-      std::vector&lt;FileReader&gt; bone_sections = bones_section.get_sections();
-      for(std::vector&lt;FileReader&gt;::iterator i = bone_sections.begin(); i != bone_sections.end(); ++i)
+    std::vector&lt;FileReader&gt; bone_sections = bones_section.get_sections();
+    for(std::vector&lt;FileReader&gt;::iterator i = bone_sections.begin(); i != bone_sections.end(); ++i)
+    {
+      if (i-&gt;get_name() == &quot;bone&quot;)
+      {
+        std::auto_ptr&lt;Bone&gt; bone(new Bone());
+        if (!(i-&gt;get(&quot;name&quot;,     bone-&gt;name) &amp;&amp;
+              i-&gt;get(&quot;children&quot;, bone-&gt;children_names) &amp;&amp;
+              i-&gt;get(&quot;parent&quot;,   bone-&gt;parent_name) &amp;&amp;
+              i-&gt;get(&quot;length&quot;,   bone-&gt;length) &amp;&amp;
+              i-&gt;get(&quot;quat&quot;,     bone-&gt;quat) &amp;&amp;
+              i-&gt;get(&quot;head&quot;,     bone-&gt;offset)))
         {
-          if (i-&gt;get_name() == &quot;bone&quot;)
-            {
-              std::auto_ptr&lt;Bone&gt; bone(new Bone());
-              if (!(i-&gt;get(&quot;name&quot;,     bone-&gt;name) &amp;&amp;
-                    i-&gt;get(&quot;children&quot;, bone-&gt;children_names) &amp;&amp;
-                    i-&gt;get(&quot;parent&quot;,   bone-&gt;parent_name) &amp;&amp;
-                    i-&gt;get(&quot;length&quot;,   bone-&gt;length) &amp;&amp;
-                    i-&gt;get(&quot;quat&quot;,     bone-&gt;quat) &amp;&amp;
-                    i-&gt;get(&quot;head&quot;,     bone-&gt;offset)))
-                {
-                  std::cout &lt;&lt; &quot;Error: some Bone attribute missing&quot; &lt;&lt; std::endl;
-                }
-              else
-                {
-                  bone-&gt;render_matrix = bone-&gt;quat.to_matrix();
-                  bones.push_back(bone.release());
-                }
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;Armature: unknown tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
-            }
+          std::cout &lt;&lt; &quot;Error: some Bone attribute missing&quot; &lt;&lt; std::endl;
         }
+        else
+        {
+          bone-&gt;render_matrix = bone-&gt;quat.to_matrix();
+          bones.push_back(bone.release());
+        }
+      }
+      else
+      {
+        std::cout &lt;&lt; &quot;Armature: unknown tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
+      }
     }
+  }
   
   // insert code here to connet parent bones
   for(Bones::iterator i = bones.begin(); i != bones.end(); ++i)
+  {
+    Bone&amp; bone = **i;
+    for(std::vector&lt;std::string&gt;::iterator j = bone.children_names.begin(); j != bone.children_names.end(); ++j)
     {
-      Bone&amp; bone = **i;
-      for(std::vector&lt;std::string&gt;::iterator j = bone.children_names.begin(); j != bone.children_names.end(); ++j)
-        {
-          Bone* child = get_bone(*j);
-          if (child)
-            bone.children.push_back(child);
-        }
+      Bone* child = get_bone(*j);
+      if (child)
+        bone.children.push_back(child);
+    }
 
-      if (bone.parent_name.empty())
-        {
-          root_bone = &bone;
-        }
-      else
-        {
-          Bone* parent = get_bone(bone.parent_name);
-          if (parent)
-            bone.parent = parent;
-        }
+    if (bone.parent_name.empty())
+    {
+      root_bone = &bone;
     }
+    else
+    {
+      Bone* parent = get_bone(bone.parent_name);
+      if (parent)
+        bone.parent = parent;
+    }
+  }
 
   if (!root_bone)
     std::cout &lt;&lt; &quot;Root Bone Missing!&quot; &lt;&lt; std::endl;
@@ -114,10 +114,10 @@
 Armature::get_bone(const std::string&amp; name_)
 {
   for(Bones::iterator i = bones.begin(); i != bones.end(); ++i)
-    {
-      if ((*i)-&gt;name == name_)
-        return *i;
-    }
+  {
+    if ((*i)-&gt;name == name_)
+      return *i;
+  }
   std::cout &lt;&lt; &quot;Error: Bone: '&quot; &lt;&lt; name_ &lt;&lt; &quot;' not found&quot; &lt;&lt; std::endl;
   return 0;
 }
@@ -171,34 +171,34 @@
 Armature::apply(const Pose&amp; pose)
 {
   if (pose.get_name() != name)
+  {
+    std::cout &lt;&lt; &quot;Can't apply pose '&quot; &lt;&lt; pose.get_name() &lt;&lt; &quot;' to armature '&quot; &lt;&lt; name &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
+  }
+  else
+  {                                           
+    for(std::vector&lt;PoseBone&gt;::const_iterator pbone = pose.bones.begin(); pbone != pose.bones.end(); ++pbone)
     {
-      std::cout &lt;&lt; &quot;Can't apply pose '&quot; &lt;&lt; pose.get_name() &lt;&lt; &quot;' to armature '&quot; &lt;&lt; name &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
+      Bone* bone = get_bone(pbone-&gt;name);
+      if (!bone)
+      {
+        std::cout &lt;&lt; &quot;Error: Couldn't find bone: &quot; &lt;&lt; pbone-&gt;name &lt;&lt; std::endl;
+      }
+      else
+      {
+        bone-&gt;render_matrix = bone-&gt;quat.to_matrix().multiply(pbone-&gt;quat.to_matrix());
+      }
     }
-  else
-    {                                           
-      for(std::vector&lt;PoseBone&gt;::const_iterator pbone = pose.bones.begin(); pbone != pose.bones.end(); ++pbone)
-        {
-          Bone* bone = get_bone(pbone-&gt;name);
-          if (!bone)
-            {
-              std::cout &lt;&lt; &quot;Error: Couldn't find bone: &quot; &lt;&lt; pbone-&gt;name &lt;&lt; std::endl;
-            }
-          else
-            {
-              bone-&gt;render_matrix = bone-&gt;quat.to_matrix().multiply(pbone-&gt;quat.to_matrix());
-            }
-        }
-    }
+  }
 }
 
 void
 Armature::reset()
 {
   for(Bones::iterator i = bones.begin(); i != bones.end(); ++i)
-    {
-      Bone* bone = *i;
-      bone-&gt;render_matrix = bone-&gt;quat.to_matrix();
-    }
+  {
+    Bone* bone = *i;
+    bone-&gt;render_matrix = bone-&gt;quat.to_matrix();
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/armature/bone.cpp
===================================================================
--- trunk/windstille/src/armature/bone.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/armature/bone.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,18 +18,18 @@
 
 #include &quot;armature/bone.hpp&quot;
 
-Bone::Bone()
-  : name(),
-    children_names(),
-    parent_name(),
-    children(),
-    parent(0),
-    length(),
-    quat(),
-    offset(),
-    render_matrix(),
-    render_head(),
-    render_tail()
+Bone::Bone() :
+  name(),
+  children_names(),
+  parent_name(),
+  children(),
+  parent(0),
+  length(),
+  quat(),
+  offset(),
+  render_matrix(),
+  render_head(),
+  render_tail()
 {
 }
 

Modified: trunk/windstille/src/armature/ipo_curve.cpp
===================================================================
--- trunk/windstille/src/armature/ipo_curve.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/armature/ipo_curve.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,8 +18,8 @@
 
 #include &quot;armature/ipo_curve.hpp&quot;
 
-IpoCurve::IpoCurve()
-  : points()
+IpoCurve::IpoCurve() :
+  points()
 {
 }
 
@@ -48,11 +48,11 @@
 IpoCurve::add_point(const BezierPoint&amp; /*p*/)
 {
   /*
-  assert(points.empty() ||
-         points.back().point.x &lt; p.x &amp;&amp;
-         p.handle_left.x &lt; p.x &amp;&amp;
-         p.x &lt; p.handle_right.x);
-  points.push_back(p);
+    assert(points.empty() ||
+    points.back().point.x &lt; p.x &amp;&amp;
+    p.handle_left.x &lt; p.x &amp;&amp;
+    p.x &lt; p.handle_right.x);
+    points.push_back(p);
   */
 }
 

Modified: trunk/windstille/src/armature/mesh.cpp
===================================================================
--- trunk/windstille/src/armature/mesh.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/armature/mesh.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -26,17 +26,17 @@
 #include &quot;display/texture_manager.hpp&quot;
 #include &quot;util/util.hpp&quot;
 
-Mesh::Mesh(FileReader&amp; reader, const std::string&amp; path)
-  : name(),
-    vertices(),
-    normals(),
-    texcoords(),
-    triangles(),
-    groups(),
-    vertices_(),
-    texture(),
-    blend_sfactor(GL_ONE),
-    blend_dfactor(GL_ZERO)
+Mesh::Mesh(FileReader&amp; reader, const std::string&amp; path) :
+  name(),
+  vertices(),
+  normals(),
+  texcoords(),
+  triangles(),
+  groups(),
+  vertices_(),
+  texture(),
+  blend_sfactor(GL_ONE),
+  blend_dfactor(GL_ZERO)
 {
   if (reader.get_name() != &quot;mesh&quot;)
     throw std::runtime_error(&quot;Not a 'mesh' type, its '&quot; + reader.get_name() + &quot;'&quot;);
@@ -52,31 +52,31 @@
 
   FileReader groups_reader;
   if (reader.get(&quot;groups&quot;, groups_reader))
+  {
+    std::vector&lt;FileReader&gt; sections = groups_reader.get_sections();
+    for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
     {
-      std::vector&lt;FileReader&gt; sections = groups_reader.get_sections();
-      for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+      if ((*i).get_name() == &quot;group&quot;)
+      {
+        VertexGroup group;
+        if ((*i).get(&quot;bone&quot;,     group.bone_name) &amp;&amp;
+            (*i).get(&quot;weight&quot;,   group.weight) &amp;&amp; 
+            (*i).get(&quot;vertices&quot;, group.vertices))
         {
-          if ((*i).get_name() == &quot;group&quot;)
-            {
-              VertexGroup group;
-              if ((*i).get(&quot;bone&quot;,     group.bone_name) &amp;&amp;
-                  (*i).get(&quot;weight&quot;,   group.weight) &amp;&amp; 
-                  (*i).get(&quot;vertices&quot;, group.vertices))
-                {
-                  if (group.weight != 0.0f) // ignore useless bones
-                    groups.push_back(group);
-                }
-              else
-                {
-                std::cout &lt;&lt; &quot;Mesh::VertexGroup: Element missing&quot; &lt;&lt; std::endl;
-                }
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;Unknown tag: &quot; &lt;&lt; (*i).get_name() &lt;&lt; std::endl;
-            }
+          if (group.weight != 0.0f) // ignore useless bones
+            groups.push_back(group);
         }
+        else
+        {
+          std::cout &lt;&lt; &quot;Mesh::VertexGroup: Element missing&quot; &lt;&lt; std::endl;
+        }
+      }
+      else
+      {
+        std::cout &lt;&lt; &quot;Unknown tag: &quot; &lt;&lt; (*i).get_name() &lt;&lt; std::endl;
+      }
     }
+  }
 
   // Check that all vectors have the same right modulo
   assert(vertices.size()  % 3 == 0);
@@ -86,83 +86,83 @@
   // Convert the data to something we can use together with Armatures
   // and Bones
   for(std::vector&lt;float&gt;::size_type i = 0; i &lt; vertices.size()/3; ++i)
-    {
-      Vertex vertex;
+  {
+    Vertex vertex;
 
-      vertex.pos.x = vertices[3*i+0];
-      vertex.pos.y = vertices[3*i+1];
-      vertex.pos.z = vertices[3*i+2];
+    vertex.pos.x = vertices[3*i+0];
+    vertex.pos.y = vertices[3*i+1];
+    vertex.pos.z = vertices[3*i+2];
 
-      vertex.normal.x = normals[3*i+0];
-      vertex.normal.y = normals[3*i+1];
-      vertex.normal.z = normals[3*i+2];
+    vertex.normal.x = normals[3*i+0];
+    vertex.normal.y = normals[3*i+1];
+    vertex.normal.z = normals[3*i+2];
 
-      vertex.texcoord.x = texcoords[2*i+0];
-      vertex.texcoord.y = texcoords[2*i+1];
+    vertex.texcoord.x = texcoords[2*i+0];
+    vertex.texcoord.y = texcoords[2*i+1];
 
-      vertices_.push_back(vertex);
-    }
+    vertices_.push_back(vertex);
+  }
   
   // Add bone and weight to the individual vertices
   for(Groups::iterator i = groups.begin(); i != groups.end(); ++i)
+  {
+    VertexGroup&amp; group = *i;
+    for(std::vector&lt;int&gt;::iterator j = group.vertices.begin(); j != group.vertices.end(); ++j)
     {
-      VertexGroup&amp; group = *i;
-      for(std::vector&lt;int&gt;::iterator j = group.vertices.begin(); j != group.vertices.end(); ++j)
-        {
-          vertices_[*j].bone_names.push_back(group.bone_name);
-          vertices_[*j].weights.push_back(group.weight);
-        }
+      vertices_[*j].bone_names.push_back(group.bone_name);
+      vertices_[*j].weights.push_back(group.weight);
     }
+  }
   
   // Normalize Weight to 1.0f
   for(Vertices::iterator i = vertices_.begin(); i != vertices_.end(); ++i)
-    {
-      if (i-&gt;weights.empty())
-        std::cout &lt;&lt; &quot;Vertex doesn't have weight: &quot; &lt;&lt; i - vertices_.begin() &lt;&lt; std::endl;
+  {
+    if (i-&gt;weights.empty())
+      std::cout &lt;&lt; &quot;Vertex doesn't have weight: &quot; &lt;&lt; i - vertices_.begin() &lt;&lt; std::endl;
 
-      float total_weight = 0.0f;
-      for(std::vector&lt;float&gt;::iterator w = i-&gt;weights.begin(); w != i-&gt;weights.end(); ++w)
-        total_weight += *w;
+    float total_weight = 0.0f;
+    for(std::vector&lt;float&gt;::iterator w = i-&gt;weights.begin(); w != i-&gt;weights.end(); ++w)
+      total_weight += *w;
      
-      for(std::vector&lt;float&gt;::iterator w = i-&gt;weights.begin(); w != i-&gt;weights.end(); ++w)
-        *w /= total_weight;
-    }
+    for(std::vector&lt;float&gt;::iterator w = i-&gt;weights.begin(); w != i-&gt;weights.end(); ++w)
+      *w /= total_weight;
+  }
 
 #if 0 
   // FIXME: Broken by design
   FileReader influences_reader;
   if (reader.get(&quot;influences&quot;, influences_reader))
+  {
+    std::vector&lt;FileReader&gt; sections = influences_reader.get_sections();
+    for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
     {
-      std::vector&lt;FileReader&gt; sections = influences_reader.get_sections();
-      for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+      if ((*i).get_name() == &quot;vertex&quot;)
+      {
+        FileReader influences_sub_reader;
+
+        (*i).get(&quot;index&quot;, index);
+        if ((*i).get(&quot;influences&quot;, influences_sub_reader))
         {
-          if ((*i).get_name() == &quot;vertex&quot;)
+          std::vector&lt;FileReader&gt; sub_sections = influences_sub_reader.get_sections();
+          for(std::vector&lt;FileReader&gt;::iterator j = sub_sections.begin(); j != sub_sections.end(); ++j)
+          {
+            if ((*j).get_name() == &quot;influences&quot;)
             {
-              FileReader influences_sub_reader;
-
-              (*i).get(&quot;index&quot;, index);
-              if ((*i).get(&quot;influences&quot;, influences_sub_reader))
-                {
-                  std::vector&lt;FileReader&gt; sub_sections = influences_sub_reader.get_sections();
-                  for(std::vector&lt;FileReader&gt;::iterator j = sub_sections.begin(); j != sub_sections.end(); ++j)
-                    {
-                      if ((*j).get_name() == &quot;influences&quot;)
-                        {
-                          float weight;
-                          std::string bone_name;
+              float weight;
+              std::string bone_name;
                       
-                          (*j).get(&quot;weight&quot;, weight);
-                          (*j).get(&quot;bone&quot;,   bone_name);                         
-                        }
-                    }
-                }
+              (*j).get(&quot;weight&quot;, weight);
+              (*j).get(&quot;bone&quot;,   bone_name);                         
             }
-          else
-            {
-              std::cout &lt;&lt; &quot;Unknown tag: &quot; &lt;&lt; (*i).get_name() &lt;&lt; std::endl;
-            }
+          }
         }
+      }
+      else
+      {
+        std::cout &lt;&lt; &quot;Unknown tag: &quot; &lt;&lt; (*i).get_name() &lt;&lt; std::endl;
+      }
     }
+  }
 #endif
 
   texture_filename = path + basename(texture_filename);
@@ -191,14 +191,14 @@
   OpenGLState state;
 
   if (blend_sfactor != GL_ONE || blend_dfactor != GL_ZERO)
-    {
-      state.enable(GL_BLEND);
-      state.set_blend_func(blend_sfactor, blend_dfactor);
-    }
+  {
+    state.enable(GL_BLEND);
+    state.set_blend_func(blend_sfactor, blend_dfactor);
+  }
   else
-    {
-      state.enable(GL_DEPTH_TEST);
-    }
+  {
+    state.enable(GL_DEPTH_TEST);
+  }
 
   state.bind_texture(texture);
 
@@ -212,11 +212,11 @@
   assert_gl(&quot;gl init before sprite&quot;);
 
   for(Vertices::size_type i = 0; i &lt; vertices_.size(); ++i)
-    { // evil messing around with vertices, need more order
-      vertices[3*i + 0] = vertices_[i].render_pos.x;
-      vertices[3*i + 1] = vertices_[i].render_pos.y;
-      vertices[3*i + 2] = vertices_[i].render_pos.z;
-    }
+  { // evil messing around with vertices, need more order
+    vertices[3*i + 0] = vertices_[i].render_pos.x;
+    vertices[3*i + 1] = vertices_[i].render_pos.y;
+    vertices[3*i + 2] = vertices_[i].render_pos.z;
+  }
 
   glVertexPointer(3, GL_FLOAT, 0, &amp;*vertices.begin());
 
@@ -229,48 +229,48 @@
 Mesh::apply(Armature* armature)
 {
   for(Vertices::iterator i = vertices_.begin(); i != vertices_.end(); ++i)
+  {
+    if (i-&gt;bone_names.empty())
     {
-      if (i-&gt;bone_names.empty())
-        {
-          // This shouldn't be reached for full mehes
-          i-&gt;render_pos = i-&gt;pos;
-        }
-      else
-        {
-          if (i-&gt;bones.empty())
-            {
-              for(unsigned int j = 0; j &lt; i-&gt;bone_names.size(); ++j)
-                i-&gt;bones.push_back(armature-&gt;get_bone(i-&gt;bone_names[j]));
-            }
+      // This shouldn't be reached for full mehes
+      i-&gt;render_pos = i-&gt;pos;
+    }
+    else
+    {
+      if (i-&gt;bones.empty())
+      {
+        for(unsigned int j = 0; j &lt; i-&gt;bone_names.size(); ++j)
+          i-&gt;bones.push_back(armature-&gt;get_bone(i-&gt;bone_names[j]));
+      }
 
-          i-&gt;render_pos = Vector3(0.0f, 0.0f, 0.0f);
-          for(unsigned int j = 0; j &lt; i-&gt;bone_names.size(); ++j)
-            {
-              Bone* bone   = i-&gt;bones[j];
-              float weight = i-&gt;weights[j];
+      i-&gt;render_pos = Vector3(0.0f, 0.0f, 0.0f);
+      for(unsigned int j = 0; j &lt; i-&gt;bone_names.size(); ++j)
+      {
+        Bone* bone   = i-&gt;bones[j];
+        float weight = i-&gt;weights[j];
 
-              //std::cout &lt;&lt; &quot;apply: &quot; &lt;&lt; i-&gt;bone_names[j] &lt;&lt; &quot; &quot; &lt;&lt; bone &lt;&lt; &quot; &quot; &lt;&lt; weight &lt;&lt; std::endl;
+        //std::cout &lt;&lt; &quot;apply: &quot; &lt;&lt; i-&gt;bone_names[j] &lt;&lt; &quot; &quot; &lt;&lt; bone &lt;&lt; &quot; &quot; &lt;&lt; weight &lt;&lt; std::endl;
 
-              if (bone)
-                { // FIXME: Need to calculate the offset from the bone and rotate that, not the pos
-                  i-&gt;render_pos += (bone-&gt;render_matrix.multiply(i-&gt;pos)) * weight;
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;Couldn't find bone: &quot; &lt;&lt; i-&gt;bone_names[j] &lt;&lt; std::endl;
-                }
-            }
+        if (bone)
+        { // FIXME: Need to calculate the offset from the bone and rotate that, not the pos
+          i-&gt;render_pos += (bone-&gt;render_matrix.multiply(i-&gt;pos)) * weight;
         }
+        else
+        {
+          std::cout &lt;&lt; &quot;Couldn't find bone: &quot; &lt;&lt; i-&gt;bone_names[j] &lt;&lt; std::endl;
+        }
+      }
     }
+  }
 }
 
 void
 Mesh::reset()
 {
   for(Vertices::iterator i = vertices_.begin(); i != vertices_.end(); ++i)
-    {
-      i-&gt;render_pos = i-&gt;pos;
-    }
+  {
+    i-&gt;render_pos = i-&gt;pos;
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/armature/model.cpp
===================================================================
--- trunk/windstille/src/armature/model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/armature/model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,9 +22,9 @@
 #include &quot;armature/mesh.hpp&quot;
 #include &quot;armature/model.hpp&quot;
 
-Model::Model(FileReader&amp; reader, const std::string&amp; path)
-  : name(),
-    meshes()
+Model::Model(FileReader&amp; reader, const std::string&amp; path) :
+  name(),
+  meshes()
 {
   if (reader.get_name() != &quot;windstille-model&quot;)
     throw std::runtime_error(&quot;Not a 'windstille-model' file, its '&quot; + reader.get_name() + &quot;'&quot;);
@@ -33,17 +33,17 @@
 
   std::vector&lt;FileReader&gt; sections = reader.get_sections();
   for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+  {
+    if (i-&gt;get_name() == &quot;mesh&quot;)
     {
-      if (i-&gt;get_name() == &quot;mesh&quot;)
-        {
-          Mesh* mesh = new Mesh(*i, path);
-          meshes.push_back(mesh);
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;Ignoring unhandled tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
-        }
+      Mesh* mesh = new Mesh(*i, path);
+      meshes.push_back(mesh);
     }
+    else
+    {
+      std::cout &lt;&lt; &quot;Ignoring unhandled tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
+    }
+  }
 
   reset();
 }
@@ -58,27 +58,27 @@
 Model::draw()
 {
   for(Meshes::iterator i = meshes.begin(); i != meshes.end(); ++i)
-    {
-      (*i)-&gt;draw();
-    }
+  {
+    (*i)-&gt;draw();
+  }
 }
 
 void
 Model::reset()
 {
   for(Meshes::iterator i = meshes.begin(); i != meshes.end(); ++i)
-    {
-      (*i)-&gt;reset();
-    }  
+  {
+    (*i)-&gt;reset();
+  }  
 }
 
 void
 Model::apply(Armature* armature)
 {
   for(Meshes::iterator i = meshes.begin(); i != meshes.end(); ++i)
-    {
-      (*i)-&gt;apply(armature);
-    }    
+  {
+    (*i)-&gt;apply(armature);
+  }    
 }
 
 /* EOF */

Modified: trunk/windstille/src/armature/pose.cpp
===================================================================
--- trunk/windstille/src/armature/pose.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/armature/pose.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,42 +22,42 @@
 
 #include &quot;util/file_reader.hpp&quot;
 
-Pose::Pose(FileReader&amp; reader)
-  : name(),
-    bones()
+Pose::Pose(FileReader&amp; reader) :
+  name(),
+  bones()
 {
   if (reader.get_name() != &quot;pose&quot;)
+  {
+    throw std::runtime_error(&quot;not a pose file&quot;);
+  }
+  else
+  {
+    reader.get(&quot;name&quot;,  name);
+
+    FileReader bones_reader;
+    if (!reader.get(&quot;bones&quot;, bones_reader))
     {
-      throw std::runtime_error(&quot;not a pose file&quot;);
+      std::cout &lt;&lt; &quot;Bones section missing&quot; &lt;&lt; std::endl;
     }
-  else
+    else
     {
-      reader.get(&quot;name&quot;,  name);
-
-      FileReader bones_reader;
-      if (!reader.get(&quot;bones&quot;, bones_reader))
+      std::vector&lt;FileReader&gt; sections = bones_reader.get_sections();
+      for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+      {
+        if (i-&gt;get_name() == &quot;bone&quot;)
         {
-          std::cout &lt;&lt; &quot;Bones section missing&quot; &lt;&lt; std::endl;
+          PoseBone bone;
+          i-&gt;get(&quot;name&quot;, bone.name);
+          i-&gt;get(&quot;quat&quot;, bone.quat);
+          bones.push_back(bone);
         }
-      else
+        else
         {
-          std::vector&lt;FileReader&gt; sections = bones_reader.get_sections();
-          for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
-            {
-              if (i-&gt;get_name() == &quot;bone&quot;)
-                {
-                  PoseBone bone;
-                  i-&gt;get(&quot;name&quot;, bone.name);
-                  i-&gt;get(&quot;quat&quot;, bone.quat);
-                  bones.push_back(bone);
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;Unhandled tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
-                }
-            }
+          std::cout &lt;&lt; &quot;Unhandled tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
         }
+      }
     }
+  }
 
   //std::cout &lt;&lt; &quot;Pose: &quot; &lt;&lt; name &lt;&lt; &quot; &quot; &lt;&lt; bones.size() &lt;&lt; std::endl;
 }

Modified: trunk/windstille/src/collision/collision_data.cpp
===================================================================
--- trunk/windstille/src/collision/collision_data.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/collision/collision_data.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,14 +22,14 @@
 CollisionData::merge(const CollisionData &amp;r)
 {
   if (state==COLLISION)
-    {
-      if (( r.state==COLLISION &amp;&amp; r.col_time&lt;col_time ) || r.state==STUCK )
-	*this=r;
-    }
+  {
+    if (( r.state==COLLISION &amp;&amp; r.col_time&lt;col_time ) || r.state==STUCK )
+      *this=r;
+  }
   else if (state == NONE)
-    {
-      *this=r;
-    }
+  {
+    *this=r;
+  }
 
   return *this;
 }

Modified: trunk/windstille/src/collision/collision_engine.cpp
===================================================================
--- trunk/windstille/src/collision/collision_engine.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/collision/collision_engine.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -37,7 +37,7 @@
 CollisionEngine::~CollisionEngine()
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-      delete *i;
+    delete *i;
   objects.clear();
 }
 
@@ -45,51 +45,51 @@
 CollisionEngine::draw(DrawingContext&amp; dc)
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      (*i)-&gt;draw(dc);
-    }
+  {
+    (*i)-&gt;draw(dc);
+  }
 }
 
 void
 CollisionEngine::collision(const CollisionData &amp;result)
 {
   if (result.object2-&gt;get_is_domains() &amp; result.object1-&gt;get_check_domains())
-    {
-      result.object1-&gt;sig_collision()(result);
-    }
+  {
+    result.object1-&gt;sig_collision()(result);
+  }
   else
-    {
-      std::cout &lt;&lt; (result.object2-&gt;get_is_domains() &amp; result.object1-&gt;get_check_domains()) &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; (result.object2-&gt;get_is_domains() &amp; result.object1-&gt;get_check_domains()) &lt;&lt; std::endl;
+  }
   
   unsigned int res1 = result.object1-&gt;get_is_domains() &amp; result.object2-&gt;get_check_domains();
 
   if (res1)
-    {
-      result.object2-&gt;sig_collision()(result.invert());
-    }
+  {
+    result.object2-&gt;sig_collision()(result.invert());
+  }
   else
-    {
-      std::cout &lt;&lt; &quot;obj1: &quot; &lt;&lt; result.object1-&gt;get_is_domains() &lt;&lt; std::endl;
-      std::cout &lt;&lt; &quot;obj2: &quot; &lt;&lt; result.object2-&gt;get_check_domains() &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;obj1: &quot; &lt;&lt; result.object1-&gt;get_is_domains() &lt;&lt; std::endl;
+    std::cout &lt;&lt; &quot;obj2: &quot; &lt;&lt; result.object2-&gt;get_check_domains() &lt;&lt; std::endl;
+  }
 }
 
 void
 CollisionEngine::unstuck(CollisionObject&amp; a, CollisionObject&amp; b, float delta)
 {
   if (a.get_type() == CollisionObject::RECTANGLE &amp;&amp; b.get_type() == CollisionObject::RECTANGLE)
-    {
-      unstuck_rect_rect (a, b, delta);
-    }
+  {
+    unstuck_rect_rect (a, b, delta);
+  }
   else
-    {
-      if (a.get_type() == CollisionObject::RECTANGLE)
-	unstuck_tilemap (b, a, delta);
-      else
-	unstuck_tilemap (a, b, delta);
+  {
+    if (a.get_type() == CollisionObject::RECTANGLE)
+      unstuck_tilemap (b, a, delta);
+    else
+      unstuck_tilemap (a, b, delta);
 
-    }
+  }
 }
 
 Vector2f unstuck_direction(const Rectf &amp;a, const Rectf &amp;b, float delta, float unstuck_velocity)
@@ -111,21 +111,21 @@
   Vector2f dir;
 
   if (left &lt; right &amp;&amp; left &lt; top &amp;&amp; left &lt; bottom)
-    {
-      dir = Vector2f(std::min(left/2 + grace, add), 0);
-    }
+  {
+    dir = Vector2f(std::min(left/2 + grace, add), 0);
+  }
   else if (right &lt; left &amp;&amp; right &lt; top &amp;&amp; right &lt; bottom)
-    {
-      dir = Vector2f(-std::min(right/2 + grace, add), 0);
-    }
+  {
+    dir = Vector2f(-std::min(right/2 + grace, add), 0);
+  }
   else if (top &lt; left &amp;&amp; top &lt; right &amp;&amp; top &lt; bottom)
-    {
-      dir = Vector2f( 0, std::min(top/2 + grace, add));
-    }
+  {
+    dir = Vector2f( 0, std::min(top/2 + grace, add));
+  }
   else // (bottom &lt; left &amp;&amp; bottom &lt; right &amp;&amp; bottom &lt; top)
-    {
-      dir = Vector2f( 0, -std::min(bottom/2 + grace, add));
-    }
+  {
+    dir = Vector2f( 0, -std::min(bottom/2 + grace, add));
+  }
   return dir;
 }
 
@@ -141,12 +141,12 @@
 {
   int i = static_cast&lt;int&gt;(f);
   if(fabsf(f-static_cast&lt;float&gt;(i)) &gt; 0.5f)
-    {
-      if(i&gt;0)
-	i++;
-      else
-	i--;
-    }
+  {
+    if(i&gt;0)
+      i++;
+    else
+      i--;
+  }
   return i;
 }
 
@@ -155,10 +155,10 @@
   int x,y;
   for (x=l; x&lt;=l+w; x++)
     for (y=t; y&lt;=t+h; y++)
-      {
-	if (tilemap-&gt;is_ground(static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE)))
-	  return false;
-      }
+    {
+      if (tilemap-&gt;is_ground(static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE)))
+        return false;
+    }
   return true;
 }
 
@@ -178,22 +178,22 @@
   // find first set of free rectangle
   // simply iterate the rectangles around current position
   for(int d=1; d&lt;20; d++) // not more than 20 steps
+  {
+    for(int i=-d; i&lt;=d; i++)
     {
-      for(int i=-d; i&lt;=d; i++)
-	{
-	  if (is_rect_free(tilemap, i + rx, -d + ry, rw, rh))
-	    rects.push_back( Rect(i + rx, -d + ry, rw, rh));
-	  if (is_rect_free(tilemap, i + rx, d + ry, rw, rh))
-	    rects.push_back( Rect(i + rx, d + ry, rw, rh));
+      if (is_rect_free(tilemap, i + rx, -d + ry, rw, rh))
+        rects.push_back( Rect(i + rx, -d + ry, rw, rh));
+      if (is_rect_free(tilemap, i + rx, d + ry, rw, rh))
+        rects.push_back( Rect(i + rx, d + ry, rw, rh));
 
-	  if (is_rect_free(tilemap, -d + rx, i + ry, rw, rh))
-	    rects.push_back( Rect(-d + rx, i + ry, rw, rh));
-	  if (is_rect_free(tilemap,  d + rx, i + ry, rw, rh))
-	    rects.push_back( Rect(d  + rx, i + ry, rw, rh));
-	}
-      if (rects.size())
-	break;
+      if (is_rect_free(tilemap, -d + rx, i + ry, rw, rh))
+        rects.push_back( Rect(-d + rx, i + ry, rw, rh));
+      if (is_rect_free(tilemap,  d + rx, i + ry, rw, rh))
+        rects.push_back( Rect(d  + rx, i + ry, rw, rh));
     }
+    if (rects.size())
+      break;
+  }
   assert(rects.size());
 
   // find nearest rectangle in this set
@@ -201,16 +201,16 @@
   float dx,dy,d;
   Rectf nr;
   for (std::vector&lt;Rectf&gt;::iterator i = rects.begin(); i != rects.end(); ++i)
+  {
+    dx = i-&gt;left - r.left / static_cast&lt;float&gt;(TILE_SIZE);
+    dy = i-&gt;top  - r.top  / static_cast&lt;float&gt;(TILE_SIZE);
+    d = sqrtf( dx * dx + dy * dy );
+    if (d &lt; distance)
     {
-      dx = i-&gt;left - r.left / static_cast&lt;float&gt;(TILE_SIZE);
-      dy = i-&gt;top  - r.top  / static_cast&lt;float&gt;(TILE_SIZE);
-      d = sqrtf( dx * dx + dy * dy );
-      if (d &lt; distance)
-	{
-	  distance=d;
-	  nr=*i;
-	}
+      distance=d;
+      nr=*i;
     }
+  }
 
   nr.right += nr.left; 
   nr.bottom += nr.top; 
@@ -239,18 +239,18 @@
   // align to grid, if coming from right or bottom
 
   if(target.top &lt; rb.top)
-    {
-      float v = static_cast&lt;float&gt;(c_roundup(target.bottom / static_cast&lt;float&gt;(TILE_SIZE)))
-        * static_cast&lt;float&gt;(TILE_SIZE) - target.bottom;
-      target.top    += v;
-      target.bottom += v;
-    }
+  {
+    float v = static_cast&lt;float&gt;(c_roundup(target.bottom / static_cast&lt;float&gt;(TILE_SIZE)))
+      * static_cast&lt;float&gt;(TILE_SIZE) - target.bottom;
+    target.top    += v;
+    target.bottom += v;
+  }
   if(target.left &lt; rb.left)
-    {
-      float v = static_cast&lt;float&gt;(c_roundup(target.right / static_cast&lt;float&gt;(TILE_SIZE))) * static_cast&lt;float&gt;(TILE_SIZE) - target.right;
-      target.left  += v;
-      target.right += v;
-    }
+  {
+    float v = static_cast&lt;float&gt;(c_roundup(target.right / static_cast&lt;float&gt;(TILE_SIZE))) * static_cast&lt;float&gt;(TILE_SIZE) - target.right;
+    target.left  += v;
+    target.right += v;
+  }
 
   b.pos = Vector2f(target.left-b.primitive.left, target.top-b.primitive.top);
 }
@@ -293,91 +293,91 @@
   int max_tries=200;
 
   do
+  {
+    min_time=frame;
+      
+    for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
     {
-      min_time=frame;
-      
+      for(Objects::iterator j = i + 1; j != objects.end(); ++j)
+      {
+        if (i != j &amp;&amp; (((*i)-&gt;get_is_domains() &amp; (*j)-&gt;get_check_domains()) ||
+                       ((*j)-&gt;get_is_domains() &amp; (*i)-&gt;get_check_domains())))
+        {
+          CollisionData r = collide(**i, **j, frame);
+          if(r.state!=CollisionData::NONE)
+          {
+            if (min_time &gt; r.col_time &amp;&amp; r.col_time&gt;=0)
+            {
+              r.object1 = *i;
+              r.object2 = *j;
+              col_data = r;
+              min_time = r.col_time;
+              if (min_time &gt; 0.0005f)
+                min_time -= 0.0005f;
+            }
+          }
+        }
+      }
+    }
+
+    // move till first collision (or till end, when no collision occured)
+    if(min_time&gt;0)
+    {
       for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-	{
-	  for(Objects::iterator j = i + 1; j != objects.end(); ++j)
-	    {
-	      if (i != j &amp;&amp; (((*i)-&gt;get_is_domains() &amp; (*j)-&gt;get_check_domains()) ||
-                             ((*j)-&gt;get_is_domains() &amp; (*i)-&gt;get_check_domains())))
-		{
-		  CollisionData r = collide(**i, **j, frame);
-		  if(r.state!=CollisionData::NONE)
-		    {
-		      if (min_time &gt; r.col_time &amp;&amp; r.col_time&gt;=0)
-			{
-			  r.object1 = *i;
-			  r.object2 = *j;
-			  col_data = r;
-			  min_time = r.col_time;
-			  if (min_time &gt; 0.0005f)
-			    min_time -= 0.0005f;
-			}
-		    }
-		}
-	    }
-	}
+      {
+        update(**i,min_time);
+      }
+    }
+    // report collision
+    if (min_time &lt; frame)
+    {
+      collision (col_data);
+    }
 
-      // move till first collision (or till end, when no collision occured)
-      if(min_time&gt;0)
-	{
-	  for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-	    {
-	      update(**i,min_time);
-	    }
-	}
-      // report collision
-      if (min_time &lt; frame)
-	{
-	  collision (col_data);
-	}
+    frame-=min_time;
+    min_time=0;
 
-      frame-=min_time;
-      min_time=0;
+    // check tries
+    --max_tries;
+    if (max_tries == 0)
+      std::cerr&lt;&lt;&quot;Too much tries in collision detection&quot;&lt;&lt;std::endl;
 
-      // check tries
-      --max_tries;
-      if (max_tries == 0)
-	std::cerr&lt;&lt;&quot;Too much tries in collision detection&quot;&lt;&lt;std::endl;
+  }while (min_time &lt; frame  &amp;&amp; max_tries&gt;0);
 
-    }while (min_time &lt; frame  &amp;&amp; max_tries&gt;0);
-
   //return; // uncomment, if you want no unstucking
 
   // check penetration and resolve
   bool penetration = true;
   int maxtries=15;
   while(penetration)
+  {
+    penetration=false;
+    // FIXME: support this by some spatial container
+    for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
     {
-      penetration=false;
-      // FIXME: support this by some spatial container
-      for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-	{
-	  if(!(*i)-&gt;unstuck())
-	    continue;
-	  
-          for(Objects::iterator j = i+1; j != objects.end(); ++j)
-	    {
-	      if(!(*j)-&gt;unstuck())
-		continue;
-	      
-	      if (i != j &amp;&amp; ((*i)-&gt;unstuck_movable() || ((*j)-&gt;unstuck_movable())))
-		{
-		  CollisionData r = collide(**i, **j, 0);
-		  if(r.state!=CollisionData::NONE)
-		    {
-		      penetration=true;
-		      unstuck(**i, **j, delta/3.0f);
-		    }
-		}
-	    }
-	}
-      maxtries--;
-      if(maxtries==0)
-	break;
+      if(!(*i)-&gt;unstuck())
+        continue;
+          
+      for(Objects::iterator j = i+1; j != objects.end(); ++j)
+      {
+        if(!(*j)-&gt;unstuck())
+          continue;
+              
+        if (i != j &amp;&amp; ((*i)-&gt;unstuck_movable() || ((*j)-&gt;unstuck_movable())))
+        {
+          CollisionData r = collide(**i, **j, 0);
+          if(r.state!=CollisionData::NONE)
+          {
+            penetration=true;
+            unstuck(**i, **j, delta/3.0f);
+          }
+        }
+      }
     }
+    maxtries--;
+    if(maxtries==0)
+      break;
+  }
 }
 
 void
@@ -411,51 +411,51 @@
                          float delta)
 {
   SweepResult result0 = simple_sweep_1d(b1.left, b1.get_width(),  b1_v.x,
-					b2.left, b2.get_width(),  b2_v.x);
+                                        b2.left, b2.get_width(),  b2_v.x);
   SweepResult result1 = simple_sweep_1d(b1.top,  b1.get_height(), b1_v.y,
-					b2.top,  b2.get_height(), b2_v.y);
+                                        b2.top,  b2.get_height(), b2_v.y);
 
   CollisionData result;
   result.delta = delta;
 
   if(result0.collision(delta) &amp;&amp; result1.collision(delta))
+  {
+    if(result0.always() &amp;&amp; result1.always())
+      result.state = CollisionData::STUCK;
+    else
     {
-      if(result0.always() &amp;&amp; result1.always())
-	result.state = CollisionData::STUCK;
+      if(result0.begin(delta)&lt;result1.begin(delta))
+      {
+        // x direction prior
+        if(b1.left &lt; b2.left)
+        {
+          result.state=CollisionData::COLLISION;
+          result.direction=Vector2f(-1, 0);
+        }
+        else
+        {
+          result.state=CollisionData::COLLISION;
+          result.direction=Vector2f(1, 0);
+        }
+        result.col_time=result0.t0;
+      }
       else
-	{
-	  if(result0.begin(delta)&lt;result1.begin(delta))
-	    {
-	      // x direction prior
-	      if(b1.left &lt; b2.left)
-		{
-		  result.state=CollisionData::COLLISION;
-		  result.direction=Vector2f(-1, 0);
-		}
-	      else
-		{
-		  result.state=CollisionData::COLLISION;
-		  result.direction=Vector2f(1, 0);
-		}
-	      result.col_time=result0.t0;
-	    }
-	  else
-	    {
-	      // x direction prior
-	      if(b1.top &lt; b2.top)
-		{
-		  result.state=CollisionData::COLLISION;
-		  result.direction=Vector2f(0, -1);
-		}
-	      else
-		{
-		  result.state=CollisionData::COLLISION;
-		  result.direction=Vector2f(0, 1);
-		}
-	      result.col_time=result1.t0;
-	    }
-	}
+      {
+        // x direction prior
+        if(b1.top &lt; b2.top)
+        {
+          result.state=CollisionData::COLLISION;
+          result.direction=Vector2f(0, -1);
+        }
+        else
+        {
+          result.state=CollisionData::COLLISION;
+          result.direction=Vector2f(0, 1);
+        }
+        result.col_time=result1.t0;
+      }
     }
+  }
   return result;
 }
 
@@ -463,31 +463,31 @@
 CollisionEngine::collide(CollisionObject&amp; a, CollisionObject&amp; b, float delta)
 {
   if (a.get_type() == CollisionObject::RECTANGLE &amp;&amp; b.get_type() == CollisionObject::RECTANGLE)
-    {
-      Rectf ra = a.primitive;
-      Rectf rb = b.primitive;
+  {
+    Rectf ra = a.primitive;
+    Rectf rb = b.primitive;
       
-      ra.left   += a.get_pos().x;
-      ra.right  += a.get_pos().x;
-      ra.top    += a.get_pos().y;
-      ra.bottom += a.get_pos().y;
+    ra.left   += a.get_pos().x;
+    ra.right  += a.get_pos().x;
+    ra.top    += a.get_pos().y;
+    ra.bottom += a.get_pos().y;
       
-      rb.left   += b.get_pos().x;
-      rb.right  += b.get_pos().x;
-      rb.top    += b.get_pos().y;
-      rb.bottom += b.get_pos().y;
+    rb.left   += b.get_pos().x;
+    rb.right  += b.get_pos().x;
+    rb.top    += b.get_pos().y;
+    rb.bottom += b.get_pos().y;
       
-      return collide(ra, rb,
-		     a.get_velocity(), b.get_velocity(),
-		     delta);
-    }
+    return collide(ra, rb,
+                   a.get_velocity(), b.get_velocity(),
+                   delta);
+  }
   else
-    {
-      if (a.get_type() == CollisionObject::RECTANGLE)
-	return collide_tilemap (b, a, delta).invert();
-      else
-	return collide_tilemap (a, b, delta);
-    }
+  {
+    if (a.get_type() == CollisionObject::RECTANGLE)
+      return collide_tilemap (b, a, delta).invert();
+    else
+      return collide_tilemap (a, b, delta);
+  }
 }
 
 int get_next_integer(float f, float direction)
@@ -495,17 +495,17 @@
   int result;
 
   if(direction &lt; 0)
-    {
-      result = int (f);
-      if (result &gt;= f)
-	--result;
-    }
+  {
+    result = int (f);
+    if (result &gt;= f)
+      --result;
+  }
   else
-    {
-      result = int (f);
-      if (result &lt;= f)
-	++result;
-    }
+  {
+    result = int (f);
+    if (result &lt;= f)
+      ++result;
+  }
   return result;
 }
 
@@ -514,11 +514,11 @@
   int result=static_cast&lt;int&gt;(f);
 
   if(direction &lt; 0)
-    {
-      result = static_cast&lt;int&gt;(f);
-      if (result &gt; f)
-	--result;
-    }
+  {
+    result = static_cast&lt;int&gt;(f);
+    if (result &gt; f)
+      --result;
+  }
   return result;
 }
 
@@ -538,12 +538,12 @@
 
   for (y = std::max (0, miny); y &lt;= std::min (maxy, tilemap-&gt;get_height() - 1); ++y)
     for (x = std::max (0, minx); x &lt;= std::min (maxx, tilemap-&gt;get_width() - 1); ++x)
+    {
+      if(tilemap-&gt;is_ground (static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE) ))
       {
-	if(tilemap-&gt;is_ground (static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE) ))
-	  {
-	    return true;
-	  }
+        return true;
       }
+    }
   return false;
 }
 
@@ -561,15 +561,15 @@
 
   for (y = std::max (0, miny); y &lt;= std::min (maxy, tilemap-&gt;get_height() - 1); ++y)
     for (x = std::max (0, minx); x &lt;= std::min (maxx, tilemap-&gt;get_width() - 1); ++x)
+    {
+      if(tilemap-&gt;is_ground (static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE) ) == is_ground)
       {
-	if(tilemap-&gt;is_ground (static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE) ) == is_ground)
-	  {
-	    rect_list.push_back (Rectf (static_cast&lt;float&gt;(x * TILE_SIZE), 
-                                        static_cast&lt;float&gt;(y * TILE_SIZE), 
-                                        static_cast&lt;float&gt;(TILE_SIZE), 
-                                        static_cast&lt;float&gt;(TILE_SIZE)));
-	  }
+        rect_list.push_back (Rectf (static_cast&lt;float&gt;(x * TILE_SIZE), 
+                                    static_cast&lt;float&gt;(y * TILE_SIZE), 
+                                    static_cast&lt;float&gt;(TILE_SIZE), 
+                                    static_cast&lt;float&gt;(TILE_SIZE)));
       }
+    }
   return rect_list;
 }
 
@@ -602,12 +602,12 @@
 
   // check, if stuck
   if (tilemap_collision (a.tilemap, r))
-    {
-      result.state=CollisionData::STUCK;
-      result.col_time = 0;
+  {
+    result.state=CollisionData::STUCK;
+    result.col_time = 0;
       
-      return result;
-    }
+    return result;
+  }
 
   float time=0.0f;
   
@@ -634,100 +634,100 @@
   int maxtries=20; // prevent loops
 
   while (time &lt; delta &amp;&amp; ct &gt;= 0.0f &amp;&amp; maxtries&gt;0)
+  {
+    ct = -1.0f;
+
+    if(first_time)
     {
-      ct = -1.0f;
+      next_x = get_integer(static_cast&lt;float&gt;(*x) / static_cast&lt;float&gt;(TILE_SIZE), vel.x) * TILE_SIZE;
+      next_y = get_integer(static_cast&lt;float&gt;(*y) / static_cast&lt;float&gt;(TILE_SIZE), vel.y) * TILE_SIZE;
+      first_time = false;
+    }
+    else
+    {
+      next_x = get_next_integer ((static_cast&lt;float&gt;(*x) / static_cast&lt;float&gt;(TILE_SIZE)), vel.x) * TILE_SIZE;
+      next_y = get_next_integer ((static_cast&lt;float&gt;(*y) / static_cast&lt;float&gt;(TILE_SIZE)), vel.y) * TILE_SIZE;
 
-      if(first_time)
-	{
-	  next_x = get_integer(static_cast&lt;float&gt;(*x) / static_cast&lt;float&gt;(TILE_SIZE), vel.x) * TILE_SIZE;
-	  next_y = get_integer(static_cast&lt;float&gt;(*y) / static_cast&lt;float&gt;(TILE_SIZE), vel.y) * TILE_SIZE;
-	  first_time = false;
-	}
-      else
-	{
-	  next_x = get_next_integer ((static_cast&lt;float&gt;(*x) / static_cast&lt;float&gt;(TILE_SIZE)), vel.x) * TILE_SIZE;
-          next_y = get_next_integer ((static_cast&lt;float&gt;(*y) / static_cast&lt;float&gt;(TILE_SIZE)), vel.y) * TILE_SIZE;
+         
+      assert ( static_cast&lt;float&gt;(next_x) * static_cast&lt;float&gt;(c_sign(vel.x)) &gt; *x * static_cast&lt;float&gt;(c_sign(vel.x)) || vel.x == 0.0f);
+      assert ( static_cast&lt;float&gt;(next_y) * static_cast&lt;float&gt;(c_sign(vel.y)) &gt; *y * static_cast&lt;float&gt;(c_sign(vel.y)) || vel.y == 0.0f);
+    }
 
-	 
-	  assert ( static_cast&lt;float&gt;(next_x) * static_cast&lt;float&gt;(c_sign(vel.x)) &gt; *x * static_cast&lt;float&gt;(c_sign(vel.x)) || vel.x == 0.0f);
-          assert ( static_cast&lt;float&gt;(next_y) * static_cast&lt;float&gt;(c_sign(vel.y)) &gt; *y * static_cast&lt;float&gt;(c_sign(vel.y)) || vel.y == 0.0f);
-	}
+    if (vel.x != 0.0f)
+      tx = (static_cast&lt;float&gt;(next_x) - *x) / vel.x;
+    else
+      tx = 10000.0f;
 
-      if (vel.x != 0.0f)
-	tx = (static_cast&lt;float&gt;(next_x) - *x) / vel.x;
-      else
-	tx = 10000.0f;
+    if (vel.y != 0.0f)
+      ty = (static_cast&lt;float&gt;(next_y) - *y) / vel.y;
+    else
+      ty = 10000.0f;
 
-      if (vel.y != 0.0f)
-	ty = (static_cast&lt;float&gt;(next_y) - *y) / vel.y;
-      else
-	ty = 10000.0f;
+    if(tx&lt;0)
+      tx=0;
+    if(ty&lt;0)
+      ty=0;
 
-      if(tx&lt;0)
-	tx=0;
-      if(ty&lt;0)
-	ty=0;
-
-      if (tx &lt; ty)
-	{
-	  if (time + tx &lt; delta)
-	    ct = tx;
-	}
-      else
-	{
-	  if (time + ty &lt; delta)
-	    ct = ty;
-	}
+    if (tx &lt; ty)
+    {
+      if (time + tx &lt; delta)
+        ct = tx;
+    }
+    else
+    {
+      if (time + ty &lt; delta)
+        ct = ty;
+    }
       
-      if (ct &gt;= 0.0f)
-	{
-	  // move to next position
-	  float dx, dy;
+    if (ct &gt;= 0.0f)
+    {
+      // move to next position
+      float dx, dy;
 
-	  dx = ct * vel.x;
-	  dy = ct * vel.y;
+      dx = ct * vel.x;
+      dy = ct * vel.y;
 
-	  r.left   += dx;
-	  r.right  += dx;
-	  r.top    += dy;
-	  r.bottom += dy;
+      r.left   += dx;
+      r.right  += dx;
+      r.top    += dy;
+      r.bottom += dy;
 
-	  if(last_zero &amp;&amp; ct==0.0f)
-	    time += 0.0005f;
-	  else
-	    time += ct;
-	  last_zero=(ct==0.0f);
+      if(last_zero &amp;&amp; ct==0.0f)
+        time += 0.0005f;
+      else
+        time += ct;
+      last_zero=(ct==0.0f);
 
-	  // now shift one more pixel and check for collision with tilemap
-	  Rectf tmp(r);
-	  
-	  if (tx &lt; ty)
-	    {
-	      tmp.left  += static_cast&lt;float&gt;(c_sign(vel.x));
-              tmp.right += static_cast&lt;float&gt;(c_sign(vel.x));
-	    }
-	  else
-	    {
-	      tmp.top    += static_cast&lt;float&gt;(c_sign(vel.y));
-	      tmp.bottom += static_cast&lt;float&gt;(c_sign(vel.y));
-	    }
+      // now shift one more pixel and check for collision with tilemap
+      Rectf tmp(r);
+          
+      if (tx &lt; ty)
+      {
+        tmp.left  += static_cast&lt;float&gt;(c_sign(vel.x));
+        tmp.right += static_cast&lt;float&gt;(c_sign(vel.x));
+      }
+      else
+      {
+        tmp.top    += static_cast&lt;float&gt;(c_sign(vel.y));
+        tmp.bottom += static_cast&lt;float&gt;(c_sign(vel.y));
+      }
 
-	  // check collision with tilemap
+      // check collision with tilemap
 
-	  if (tilemap_collision (a.tilemap, tmp))
-	    {
-	      result.state=CollisionData::COLLISION;
-	      result.col_time = time;
-	      
-	      if (tx &lt; ty)
-		result.direction = Vector2f(static_cast&lt;float&gt;(c_sign(vel.x)), 0.0f);
-	      else
-		result.direction = Vector2f(0, static_cast&lt;float&gt;(c_sign(vel.y)));
-	      return result;
-	    }
-	}
-      maxtries--;
+      if (tilemap_collision (a.tilemap, tmp))
+      {
+        result.state=CollisionData::COLLISION;
+        result.col_time = time;
+              
+        if (tx &lt; ty)
+          result.direction = Vector2f(static_cast&lt;float&gt;(c_sign(vel.x)), 0.0f);
+        else
+          result.direction = Vector2f(0, static_cast&lt;float&gt;(c_sign(vel.y)));
+        return result;
+      }
     }
+    maxtries--;
+  }
   if(maxtries==0)
     std::cerr&lt;&lt;&quot;MAXTRIES reached&quot;&lt;&lt;std::endl;
 
@@ -738,12 +738,12 @@
 CollisionEngine::raycast(const Vector2f&amp; pos, float angle)
 {
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
+  {
+    if ((*i)-&gt;get_type() == CollisionObject::TILEMAP)
     {
-      if ((*i)-&gt;get_type() == CollisionObject::TILEMAP)
-        {
-          return (*i)-&gt;tilemap-&gt;raycast(pos, angle);
-        }
+      return (*i)-&gt;tilemap-&gt;raycast(pos, angle);
     }
+  }
 
   return Vector2f(0, 0);
 }

Modified: trunk/windstille/src/collision/collision_object.cpp
===================================================================
--- trunk/windstille/src/collision/collision_object.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/collision/collision_object.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -27,32 +27,32 @@
  ***********************************************************************/
 
 CollisionObject::CollisionObject(GameObject* game_object_, const Rectf&amp; rect_)
- : object_type(RECTANGLE),
-   pos(0,0),
-   velocity(0,0),
-   game_object(game_object_),
-   collision(),
-   primitive(rect_),
-   tilemap(),
-   is_unstuckable(true),
-   is_unstuck_movable(true),
-   is_domains(DOMAIN_PLAYER  | DOMAIN_ENEMY),
-   check_domains(DOMAIN_TILEMAP | DOMAIN_PLAYER | DOMAIN_ENEMY)
+  : object_type(RECTANGLE),
+    pos(0,0),
+    velocity(0,0),
+    game_object(game_object_),
+    collision(),
+    primitive(rect_),
+    tilemap(),
+    is_unstuckable(true),
+    is_unstuck_movable(true),
+    is_domains(DOMAIN_PLAYER  | DOMAIN_ENEMY),
+    check_domains(DOMAIN_TILEMAP | DOMAIN_PLAYER | DOMAIN_ENEMY)
 {
 }
 
 CollisionObject::CollisionObject(TileMap* tilemap_)
- : object_type(),
-   pos(),
-   velocity(),
-   game_object(),
-   collision(),
-   primitive(),
-   tilemap(tilemap_),
-   is_unstuckable(),
-   is_unstuck_movable(),
-   is_domains(),
-   check_domains() 
+  : object_type(),
+    pos(),
+    velocity(),
+    game_object(),
+    collision(),
+    primitive(),
+    tilemap(tilemap_),
+    is_unstuckable(),
+    is_unstuck_movable(),
+    is_domains(),
+    check_domains() 
 {
   object_type        = TILEMAP;
   is_unstuckable     = true;
@@ -82,9 +82,9 @@
   dc.draw_rect(r, Color(0.6f, 0.6f, 0.6f), 100.0f);
   
   dc.draw_line(Vector2f(r.left + r.get_width ()/2,
-                      r.top  + r.get_height ()/2),
+                        r.top  + r.get_height ()/2),
                Vector2f(r.left + r.get_width ()/2  + get_velocity ().x,
-                      r.top  + r.get_height ()/2 + get_velocity ().y),
+                        r.top  + r.get_height ()/2 + get_velocity ().y),
                Color(1.0f, 0, 1.0f), 100.0f);
 }
 

Modified: trunk/windstille/src/collision/collision_test.cpp
===================================================================
--- trunk/windstille/src/collision/collision_test.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/collision/collision_test.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,35 +21,35 @@
 #include &lt;assert.h&gt;
 
 SweepResult simple_sweep_1d(float a, float aw, float av,
-			    float b, float bw, float bv)
+                            float b, float bw, float bv)
 {
   SweepResult res;
   // Normalize the calculation so that only A moves and B stands still
   float v = av - bv;
 
   if (v &gt; 0)
-    {
-      res.t0 = (b - (a + aw)) / v;
-      res.t1 = (b + bw - a) / v;
-      res.state = SweepResult::COL_AT;
+  {
+    res.t0 = (b - (a + aw)) / v;
+    res.t1 = (b + bw - a) / v;
+    res.state = SweepResult::COL_AT;
 
-      assert(res.t0 &lt;= res.t1);
-    }
+    assert(res.t0 &lt;= res.t1);
+  }
   else if (v &lt; 0)
-    {
-      res.t0 = (b + bw - a) / v;
-      res.t1 = (b - (a + aw)) / v;
-      res.state = SweepResult::COL_AT;
+  {
+    res.t0 = (b + bw - a) / v;
+    res.t1 = (b - (a + aw)) / v;
+    res.state = SweepResult::COL_AT;
 
-      assert(res.t0 &lt;= res.t1);
-    }
+    assert(res.t0 &lt;= res.t1);
+  }
   else // (v == 0)
-    {
-      if ((a + aw) &lt; b || (a &gt; b + bw))
-        res.state = SweepResult::COL_NEVER;
-      else
-        res.state = SweepResult::COL_ALWAYS;
-    }
+  {
+    if ((a + aw) &lt; b || (a &gt; b + bw))
+      res.state = SweepResult::COL_NEVER;
+    else
+      res.state = SweepResult::COL_ALWAYS;
+  }
   return res;
 }
 

Modified: trunk/windstille/src/collision/collision_test.hpp
===================================================================
--- trunk/windstille/src/collision/collision_test.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/collision/collision_test.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -68,7 +68,7 @@
 }
 
 SweepResult simple_sweep_1d(float a, float aw, float av,
-			    float b, float bw, float bv);
+                            float b, float bw, float bv);
 
 #endif
 

Modified: trunk/windstille/src/collision/stair_contact.cpp
===================================================================
--- trunk/windstille/src/collision/stair_contact.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/collision/stair_contact.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -53,14 +53,14 @@
 
   // advancement must happen tile by tile  
   while ((fabs(s) &gt; fabs(step)) &amp;&amp; is_active())
-    {
-      advancement += step;
-      s -= step;
+  {
+    advancement += step;
+    s -= step;
 
-      // increment tile position, based on tile direction
-      // can be up/down, left/rigth
-      advance_or_not();
-    }
+    // increment tile position, based on tile direction
+    // can be up/down, left/rigth
+    advance_or_not();
+  }
 
   advancement += s;
   advance_or_not();
@@ -70,35 +70,35 @@
 StairContact::advance_or_not()
 {
   if (tile_type &amp; TILE_LEFT)
+  {
+    if (advancement &lt; -0.5f)
     {
-      if (advancement &lt; -0.5f)
-        {
-          pos.x -= 1;
-          pos.y += 1;
-          advancement += 1.0f;
-        }
-      else if (advancement &gt; 0.5f)
-        {
-          pos.x += 1;
-          pos.y -= 1;
-          advancement -= 1.0f;
-        }
+      pos.x -= 1;
+      pos.y += 1;
+      advancement += 1.0f;
     }
+    else if (advancement &gt; 0.5f)
+    {
+      pos.x += 1;
+      pos.y -= 1;
+      advancement -= 1.0f;
+    }
+  }
   else if (tile_type &amp; TILE_RIGHT)
+  {
+    if (advancement &lt; -0.5f)
     {
-      if (advancement &lt; -0.5f)
-        {
-          pos.x += 1;
-          pos.y -= 1;
-          advancement += 1.0f;
-        }
-      else if (advancement &gt; 0.5f)
-        {
-          pos.x -= 1;
-          pos.y += 1;
-          advancement -= 1.0f;
-        }
+      pos.x += 1;
+      pos.y -= 1;
+      advancement += 1.0f;
     }
+    else if (advancement &gt; 0.5f)
+    {
+      pos.x -= 1;
+      pos.y += 1;
+      advancement -= 1.0f;
+    }
+  }
 }
 
 Vector2f

Modified: trunk/windstille/src/display/basic_compositor_impl.cpp
===================================================================
--- trunk/windstille/src/display/basic_compositor_impl.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/basic_compositor_impl.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,10 +28,10 @@
 
 static const int LIGHTMAP_DIV = 4;
 
-BasicCompositorImpl::BasicCompositorImpl(const Size&amp; window, const Size&amp; viewport)
-  : CompositorImpl(window, viewport),
-    m_lightmap(m_window.width  / LIGHTMAP_DIV,
-               m_window.height / LIGHTMAP_DIV)
+BasicCompositorImpl::BasicCompositorImpl(const Size&amp; window, const Size&amp; viewport) :
+  CompositorImpl(window, viewport),
+  m_lightmap(m_window.width  / LIGHTMAP_DIV,
+             m_window.height / LIGHTMAP_DIV)
 {
 }
 

Modified: trunk/windstille/src/display/blitter.cpp
===================================================================
--- trunk/windstille/src/display/blitter.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/blitter.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -44,12 +44,12 @@
 
   // duplicate left and right borders
   for(int y = y_pos-1; y &lt; y_pos + height+1; ++y)
-    {
-      uint32_t* p = reinterpret_cast&lt;uint32_t*&gt; (data + (y*pitch + 4*(x_pos-1)));
-      *p = *(p+1);
-      p = reinterpret_cast&lt;uint32_t*&gt; (data + (y*pitch + 4*(x_pos + width)));
-      *p = *(p-1);
-    }
+  {
+    uint32_t* p = reinterpret_cast&lt;uint32_t*&gt; (data + (y*pitch + 4*(x_pos-1)));
+    *p = *(p+1);
+    p = reinterpret_cast&lt;uint32_t*&gt; (data + (y*pitch + 4*(x_pos + width)));
+    *p = *(p-1);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/display/compositor.cpp
===================================================================
--- trunk/windstille/src/display/compositor.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/compositor.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,8 +23,8 @@
 #include &quot;display/framebuffer_compositor_impl.hpp&quot;
 #include &quot;display/basic_compositor_impl.hpp&quot;
 
-Compositor::Compositor(const Size&amp; window, const Size&amp; viewport)
-  : impl()
+Compositor::Compositor(const Size&amp; window, const Size&amp; viewport) :
+  impl()
 {
   if (glewIsSupported(&quot;GL_EXT_framebuffer_object&quot;)) //(GLEW_EXT_framebuffer_object)
   {

Modified: trunk/windstille/src/display/display.cpp
===================================================================
--- trunk/windstille/src/display/display.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/display.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -165,21 +165,21 @@
   int n = 8;
   glBegin(GL_QUAD_STRIP);
   for(int i = 0; i &lt;= n; ++i)
-    {
-      float x = sinf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
-      float y = cosf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = sinf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
+    float y = cosf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
 
-      glVertex2f(irect.left  - x, irect.top - y);
-      glVertex2f(irect.right + x, irect.top - y);
-    }
+    glVertex2f(irect.left  - x, irect.top - y);
+    glVertex2f(irect.right + x, irect.top - y);
+  }
   for(int i = 0; i &lt;= n; ++i)
-    {
-      float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
-      float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
+    float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2.0f) / static_cast&lt;float&gt;(n)) * radius;
 
-      glVertex2f(irect.left  - x, irect.bottom + y);
-      glVertex2f(irect.right + x, irect.bottom + y);
-    }
+    glVertex2f(irect.left  - x, irect.bottom + y);
+    glVertex2f(irect.right + x, irect.bottom + y);
+  }
   glEnd();
 }
 
@@ -207,35 +207,35 @@
   int n = 4;
   glBegin(GL_LINE_STRIP);
   for(int i = 0; i &lt;= n; ++i)
-    {
-      float x = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
-      float y = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+    float y = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
 
-      glVertex2f(irect.left  - x, irect.top - y);
-    }
+    glVertex2f(irect.left  - x, irect.top - y);
+  }
   for(int i = 0; i &lt;= n; ++i)
-    {
-      float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
-      float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+    float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
 
-      glVertex2f(irect.left  - x, irect.bottom + y);
-    }
+    glVertex2f(irect.left  - x, irect.bottom + y);
+  }
 
   for(int i = 0; i &lt;= n; ++i)
-    {
-      float x = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
-      float y = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+    float y = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
 
-      glVertex2f(irect.right + x, irect.bottom + y);
-    }
+    glVertex2f(irect.right + x, irect.bottom + y);
+  }
 
   for(int i = 0; i &lt;= n; ++i)
-    {
-      float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
-      float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+    float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
         
-      glVertex2f(irect.right + x, irect.top - y);
-    }
+    glVertex2f(irect.right + x, irect.top - y);
+  }
   // go back to start
   glVertex2f(irect.left, irect.top - radius);
 
@@ -271,12 +271,12 @@
   glBegin(GL_LINE_STRIP);
   glVertex2f(radius + pos.x, pos.y);
   for(int i = 1; i &lt; segments; ++i)
-    {
-      float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
-      float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+    float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
       
-      glVertex2f(x + pos.x, y + pos.y);
-    }
+    glVertex2f(x + pos.x, y + pos.y);
+  }
   glVertex2f(radius + pos.x, pos.y);
   glEnd();
 }
@@ -298,12 +298,12 @@
   glVertex2f(pos.x, pos.y);
   glVertex2f(radius + pos.x, pos.y);
   for(int i = 1; i &lt; segments; ++i)
-    {
-      float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
-      float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+  {
+    float x = cosf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
+    float y = sinf(static_cast&lt;float&gt;(i) * (math::pi/2) / static_cast&lt;float&gt;(n)) * radius;
       
-      glVertex2f(x + pos.x, y + pos.y);
-    }
+    glVertex2f(x + pos.x, y + pos.y);
+  }
   glVertex2f(radius + pos.x, pos.y);
   glEnd();
 }
@@ -314,38 +314,38 @@
   assert(segments &gt;= 0);
 
   if (fabs(end - start) &gt;= 360.0f)
-    {
-      draw_circle(pos, radius, color, segments);
-    }
+  {
+    draw_circle(pos, radius, color, segments);
+  }
   else
-    {
-      float step  = (2.0f * math::pi) / static_cast&lt;float&gt;(segments);
+  {
+    float step  = (2.0f * math::pi) / static_cast&lt;float&gt;(segments);
 
-      if (start &gt; end) 
-        std::swap(start, end);
+    if (start &gt; end) 
+      std::swap(start, end);
 
-      OpenGLState state;
+    OpenGLState state;
 
-      state.enable(GL_BLEND);
-      state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-      state.color(color);
-      state.activate();
+    state.enable(GL_BLEND);
+    state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    state.color(color);
+    state.activate();
 
-      start = math::deg2rad(start);
-      end   = math::deg2rad(end);
+    start = math::deg2rad(start);
+    end   = math::deg2rad(end);
 
-      glBegin(GL_LINE_STRIP);
-      glVertex2f(pos.x, pos.y);
+    glBegin(GL_LINE_STRIP);
+    glVertex2f(pos.x, pos.y);
 
-      for(float angle = start; angle &lt; end; angle += step)
-        glVertex2f((cosf(angle) * radius) + pos.x,
-                   (sinf(angle) * radius) + pos.y);
+    for(float angle = start; angle &lt; end; angle += step)
+      glVertex2f((cosf(angle) * radius) + pos.x,
+                 (sinf(angle) * radius) + pos.y);
 
-      glVertex2f((cosf(end) * radius) + pos.x,
-                 (sinf(end) * radius) + pos.y);
-      glVertex2f(pos.x, pos.y);
-      glEnd();
-    }
+    glVertex2f((cosf(end) * radius) + pos.x,
+               (sinf(end) * radius) + pos.y);
+    glVertex2f(pos.x, pos.y);
+    glEnd();
+  }
 }
 
 void
@@ -354,38 +354,38 @@
   assert(segments &gt;= 0);
 
   if (fabs(end - start) &gt;= 360.0f)
-    {
-      fill_circle(pos, radius, color, segments);
-    }
+  {
+    fill_circle(pos, radius, color, segments);
+  }
   else
-    {
-      float step  = (2.0f * math::pi) / static_cast&lt;float&gt;(segments);
+  {
+    float step  = (2.0f * math::pi) / static_cast&lt;float&gt;(segments);
 
-      if (start &gt; end) 
-        std::swap(start, end);
+    if (start &gt; end) 
+      std::swap(start, end);
 
-      OpenGLState state;
+    OpenGLState state;
 
-      state.enable(GL_BLEND);
-      state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-      state.color(color);
-      state.activate();
+    state.enable(GL_BLEND);
+    state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    state.color(color);
+    state.activate();
 
-      start = math::deg2rad(start);
-      end   = math::deg2rad(end);
+    start = math::deg2rad(start);
+    end   = math::deg2rad(end);
 
-      glBegin(GL_TRIANGLE_FAN);
-      glVertex2f(pos.x, pos.y);
+    glBegin(GL_TRIANGLE_FAN);
+    glVertex2f(pos.x, pos.y);
 
-      for(float angle = start; angle &lt; end; angle += step)
-        glVertex2f((cosf(angle) * radius) + pos.x,
-                   (sinf(angle) * radius) + pos.y);
+    for(float angle = start; angle &lt; end; angle += step)
+      glVertex2f((cosf(angle) * radius) + pos.x,
+                 (sinf(angle) * radius) + pos.y);
 
-      glVertex2f(cosf(end) * radius + pos.x,
-                 sinf(end) * radius + pos.y);
+    glVertex2f(cosf(end) * radius + pos.x,
+               sinf(end) * radius + pos.y);
 
-      glEnd();
-    }
+    glEnd();
+  }
 }
 
 void
@@ -405,16 +405,16 @@
   float start_y = fmodf(offset.y, size.height);
 
   for(float x = start_x; x &lt; Display::get_width(); x += size.width)
-    {
-      glVertex2f(x, 0);
-      glVertex2f(x, static_cast&lt;float&gt;(Display::get_height()));
-    }
+  {
+    glVertex2f(x, 0);
+    glVertex2f(x, static_cast&lt;float&gt;(Display::get_height()));
+  }
 
   for(float y = start_y; y &lt; Display::get_height(); y += size.height)
-    {
-      glVertex2f(0, y);
-      glVertex2f(static_cast&lt;float&gt;(Display::get_width()), y);
-    }
+  {
+    glVertex2f(0, y);
+    glVertex2f(static_cast&lt;float&gt;(Display::get_width()), y);
+  }
 
   glEnd();  
 }
@@ -425,13 +425,13 @@
   Rect rect = rect_;
 
   if (!cliprects.empty())
-    {
-      rect.left   = std::max(rect.left, cliprects.back().left);
-      rect.top    = std::max(rect.top,  cliprects.back().top);
+  {
+    rect.left   = std::max(rect.left, cliprects.back().left);
+    rect.top    = std::max(rect.top,  cliprects.back().top);
 
-      rect.right  = std::min(rect.right,  cliprects.back().right);
-      rect.bottom = std::min(rect.bottom, cliprects.back().bottom);
-    }
+    rect.right  = std::min(rect.right,  cliprects.back().right);
+    rect.bottom = std::min(rect.bottom, cliprects.back().bottom);
+  }
 
   cliprects.push_back(rect);
 
@@ -448,16 +448,16 @@
   cliprects.pop_back();
 
   if (!cliprects.empty())
-    {
-      const Rect&amp; rect = cliprects.back();
+  {
+    const Rect&amp; rect = cliprects.back();
 
-      glScissor(rect.left, get_height() - rect.top - rect.get_height(),
-                rect.get_width(), rect.get_height());
-    }
+    glScissor(rect.left, get_height() - rect.top - rect.get_height(),
+              rect.get_width(), rect.get_height());
+  }
   else
-    {
-      glDisable(GL_SCISSOR_TEST);
-    }
+  {
+    glDisable(GL_SCISSOR_TEST);
+  }
 }
 
 void
@@ -479,64 +479,64 @@
   glReadPixels(0, 0, size.width, size.height, GL_RGB, GL_UNSIGNED_BYTE, pixels.get());
 
   if (0)
-    { // PPM saving
-      int pitch = size.width * 3;
+  { // PPM saving
+    int pitch = size.width * 3;
 
-      // save to ppm
-      std::ofstream out(filename.get_sys_path().c_str());
-      out &lt;&lt; &quot;P6\n&quot;
-          &lt;&lt; &quot;# Windstille Screenshot\n&quot;
-          &lt;&lt; size.width &lt;&lt; &quot; &quot; &lt;&lt; size.height &lt;&lt; &quot;\n&quot;
-          &lt;&lt; &quot;255\n&quot;;
+    // save to ppm
+    std::ofstream out(filename.get_sys_path().c_str());
+    out &lt;&lt; &quot;P6\n&quot;
+        &lt;&lt; &quot;# Windstille Screenshot\n&quot;
+        &lt;&lt; size.width &lt;&lt; &quot; &quot; &lt;&lt; size.height &lt;&lt; &quot;\n&quot;
+        &lt;&lt; &quot;255\n&quot;;
       
-      for(int y = size.height-1; y &gt;= 0; --y)
-        out.write(reinterpret_cast&lt;const char*&gt;(pixels.get() + y*pitch), pitch);
+    for(int y = size.height-1; y &gt;= 0; --y)
+      out.write(reinterpret_cast&lt;const char*&gt;(pixels.get() + y*pitch), pitch);
 
-      out.close();
-    }
+    out.close();
+  }
   else 
-    { // PNG saving
-      FILE* fp = fopen(filename.get_sys_path().c_str(), &quot;w&quot;);
+  { // PNG saving
+    FILE* fp = fopen(filename.get_sys_path().c_str(), &quot;w&quot;);
 
-      if (!fp)
-        {
-          std::cout &lt;&lt; &quot;Error: Couldn't save screenshot: &quot; &lt;&lt; strerror(errno) &lt;&lt; std::endl;
-          return;
-        }
-      else
-        {
-          int pitch = size.width * 3;
-          png_structp png_ptr;
-          png_infop   info_ptr;
+    if (!fp)
+    {
+      std::cout &lt;&lt; &quot;Error: Couldn't save screenshot: &quot; &lt;&lt; strerror(errno) &lt;&lt; std::endl;
+      return;
+    }
+    else
+    {
+      int pitch = size.width * 3;
+      png_structp png_ptr;
+      png_infop   info_ptr;
 
-          png_ptr  = png_create_write_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
-          info_ptr = png_create_info_struct(png_ptr);
+      png_ptr  = png_create_write_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
+      info_ptr = png_create_info_struct(png_ptr);
 
-          png_init_io(png_ptr, fp);
+      png_init_io(png_ptr, fp);
 
-          png_set_IHDR(png_ptr, info_ptr, 
-                       size.width, size.height, 8 /* bitdepth */,
-                       PNG_COLOR_TYPE_RGB,
-                       PNG_INTERLACE_NONE, 
-                       PNG_COMPRESSION_TYPE_BASE, 
-                       PNG_FILTER_TYPE_BASE);
+      png_set_IHDR(png_ptr, info_ptr, 
+                   size.width, size.height, 8 /* bitdepth */,
+                   PNG_COLOR_TYPE_RGB,
+                   PNG_INTERLACE_NONE, 
+                   PNG_COMPRESSION_TYPE_BASE, 
+                   PNG_FILTER_TYPE_BASE);
       
-          png_set_compression_level(png_ptr, 3);
-          png_write_info(png_ptr, info_ptr);
+      png_set_compression_level(png_ptr, 3);
+      png_write_info(png_ptr, info_ptr);
 
-          boost::scoped_array&lt;png_bytep&gt; row_pointers(new png_bytep[size.height]);
+      boost::scoped_array&lt;png_bytep&gt; row_pointers(new png_bytep[size.height]);
    
-          // generate row pointers
-          for (int k = 0; k &lt; size.height; k++)
-            row_pointers[k] = reinterpret_cast&lt;png_byte*&gt;(pixels.get() + ((size.height - k - 1) * pitch));
+      // generate row pointers
+      for (int k = 0; k &lt; size.height; k++)
+        row_pointers[k] = reinterpret_cast&lt;png_byte*&gt;(pixels.get() + ((size.height - k - 1) * pitch));
 
-          png_write_image(png_ptr, row_pointers.get());
+      png_write_image(png_ptr, row_pointers.get());
 
-          png_write_end(png_ptr, info_ptr);
+      png_write_end(png_ptr, info_ptr);
 
-          fclose(fp);
-        }
+      fclose(fp);
     }
+  }
 }
 
 void
@@ -554,13 +554,13 @@
   framebuffers.pop_back();
   
   if (!framebuffers.empty())
-    {
-      glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, framebuffers.back().get_handle());
-    }
+  {
+    glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, framebuffers.back().get_handle());
+  }
   else
-    {
-      glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0);
-    }
+  {
+    glBindFramebufferEXT(GL_FRAMEBUFFER_EXT, 0);
+  }
 }
 
 Framebuffer

Modified: trunk/windstille/src/display/drawing_context.cpp
===================================================================
--- trunk/windstille/src/display/drawing_context.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/drawing_context.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -47,9 +47,9 @@
   }
 };
 
-DrawingContext::DrawingContext()
-  : drawingrequests(),
-    modelview_stack()
+DrawingContext::DrawingContext() :
+  drawingrequests(),
+  modelview_stack()
 {
   modelview_stack.push_back(Matrix::identity());
 }
@@ -65,18 +65,18 @@
   std::stable_sort(drawingrequests.begin(), drawingrequests.end(), DrawablesSorter());
   
   for(Drawables::iterator i = drawingrequests.begin(); i != drawingrequests.end(); ++i)
-    {
-      (*i)-&gt;render(~0u);
-    }
+  {
+    (*i)-&gt;render(~0u);
+  }
 }
 
 void
 DrawingContext::clear()
 {
   for(Drawables::iterator i = drawingrequests.begin(); i != drawingrequests.end(); ++i)
-    {
-      delete *i;
-    }
+  {
+    delete *i;
+  }
   drawingrequests.clear();
 }
 
@@ -123,8 +123,8 @@
 DrawingContext::draw(Surface surface, float x, float y, float z, float )
 {
   draw(new SurfaceDrawable(surface,
-                                 SurfaceDrawingParameters().set_pos(Vector2f(x, y)),
-                                 z, modelview_stack.back()));
+                           SurfaceDrawingParameters().set_pos(Vector2f(x, y)),
+                           z, modelview_stack.back()));
 }
 
 void
@@ -156,12 +156,12 @@
 {
   float len2 = x*x+y*y+z*z;
   if (len2 != 1.0)
-    {
-      float len = sqrtf(len2);
-      x /= len;
-      y /= len;
-      z /= len;
-    }
+  {
+    float len = sqrtf(len2);
+    x /= len;
+    y /= len;
+    z /= len;
+  }
 
   float c = cosf(angle*3.14159265f/180.0f);
   float s = sinf(angle*3.14159265f/180.0f);

Modified: trunk/windstille/src/display/framebuffer.cpp
===================================================================
--- trunk/windstille/src/display/framebuffer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/framebuffer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -59,13 +59,13 @@
   }
 };
 
-Framebuffer::Framebuffer()
-  : impl()
+Framebuffer::Framebuffer() :
+  impl()
 {
 }
 
-Framebuffer::Framebuffer(GLenum target, int width, int height)
-  : impl(new FramebufferImpl(target, width, height))
+Framebuffer::Framebuffer(GLenum target, int width, int height) :
+  impl(new FramebufferImpl(target, width, height))
 {  
 }
 

Modified: trunk/windstille/src/display/framebuffer_compositor_impl.cpp
===================================================================
--- trunk/windstille/src/display/framebuffer_compositor_impl.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/framebuffer_compositor_impl.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -26,10 +26,10 @@
 
 static const int LIGHTMAP_DIV = 4;
 
-FramebufferCompositorImpl::FramebufferCompositorImpl(const Size&amp; window, const Size&amp; viewport)
-  : CompositorImpl(window, viewport),
-    m_screen  (GL_TEXTURE_2D, window.width, window.height),
-    m_lightmap(GL_TEXTURE_2D, window.width / LIGHTMAP_DIV, window.height / LIGHTMAP_DIV)
+FramebufferCompositorImpl::FramebufferCompositorImpl(const Size&amp; window, const Size&amp; viewport) :
+  CompositorImpl(window, viewport),
+  m_screen  (GL_TEXTURE_2D, window.width, window.height),
+  m_lightmap(GL_TEXTURE_2D, window.width / LIGHTMAP_DIV, window.height / LIGHTMAP_DIV)
 {
 }
 

Modified: trunk/windstille/src/display/graphic_context_state.cpp
===================================================================
--- trunk/windstille/src/display/graphic_context_state.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/graphic_context_state.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -40,13 +40,13 @@
   {}
 };
 
-GraphicContextState::GraphicContextState()
-  : impl(new GraphicContextStateImpl())
+GraphicContextState::GraphicContextState() :
+  impl(new GraphicContextStateImpl())
 {
 }
 
-GraphicContextState::GraphicContextState(int w, int h)
-  : impl(new GraphicContextStateImpl())
+GraphicContextState::GraphicContextState(int w, int h) :
+  impl(new GraphicContextStateImpl())
 {  
   impl-&gt;width  = w;
   impl-&gt;height = h;
@@ -68,12 +68,12 @@
   Matrix matrix = Matrix::identity();
 
   matrix = matrix.translate(static_cast&lt;float&gt;(impl-&gt;width)  / 2.0f, 
-                   static_cast&lt;float&gt;(impl-&gt;height) / 2.0f,
-                   0.0f);
+                            static_cast&lt;float&gt;(impl-&gt;height) / 2.0f,
+                            0.0f);
   matrix = matrix.rotate(impl-&gt;rotation, 0.0f, 0.0f, 1.0f);
   matrix = matrix.translate(static_cast&lt;float&gt;(-impl-&gt;width)  / 2.0f,
-               static_cast&lt;float&gt;(-impl-&gt;height) / 2.0f, 
-               0.0f);
+                            static_cast&lt;float&gt;(-impl-&gt;height) / 2.0f, 
+                            0.0f);
 
   matrix = matrix.scale(get_zoom(), get_zoom(), 1.0f);
   
@@ -107,7 +107,7 @@
 GraphicContextState::get_clip_rect()
 {
   return Rectf(Vector2f(-impl-&gt;offset.x,
-                         -impl-&gt;offset.y),
+                        -impl-&gt;offset.y),
                Sizef(static_cast&lt;float&gt;(get_width())  / impl-&gt;zoom,
                      static_cast&lt;float&gt;(get_height()) / impl-&gt;zoom));
 }
@@ -166,13 +166,13 @@
   
   //std::cout &lt;&lt; &quot;Screen: &quot; &lt;&lt; screen_relation &lt;&lt; &quot; Zoom: &quot; &lt;&lt; rect_relation &lt;&lt; std::endl;
   if (rect_relation &lt; screen_relation) // take width, ignore height
-    {
-      impl-&gt;zoom = static_cast&lt;float&gt;(get_width()) / width; 
-    }
+  {
+    impl-&gt;zoom = static_cast&lt;float&gt;(get_width()) / width; 
+  }
   else // take height, ignore width
-    {
-      impl-&gt;zoom = static_cast&lt;float&gt;(get_height()) / height;
-    }
+  {
+    impl-&gt;zoom = static_cast&lt;float&gt;(get_height()) / height;
+  }
 
   impl-&gt;offset.x = (static_cast&lt;float&gt;(get_width())  / (2.0f * impl-&gt;zoom)) - center_x;
   impl-&gt;offset.y = (static_cast&lt;float&gt;(get_height()) / (2.0f * impl-&gt;zoom)) - center_y;

Modified: trunk/windstille/src/display/opengl_state.cpp
===================================================================
--- trunk/windstille/src/display/opengl_state.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/opengl_state.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -91,8 +91,8 @@
 
 // The code here is just as placeholder for the moment, should be
 // replaced with something more optimized later
-OpenGLState::OpenGLState()
-  : impl(new OpenGLStateImpl())
+OpenGLState::OpenGLState() :
+  impl(new OpenGLStateImpl())
 {
   impl-&gt;state[GL_DEPTH_TEST]  = false;
   impl-&gt;state[GL_BLEND]       = false;
@@ -133,14 +133,14 @@
 {
   std::map&lt;GLenum, bool&gt;::const_iterator i = impl-&gt;state.find(cap);
   if (i == impl-&gt;state.end())
-    {
-      std::cout &lt;&lt; &quot;OpenGLState: Unknown state requested: &quot; &lt;&lt; cap &lt;&lt; std::endl;
-      return false;
-    }
+  {
+    std::cout &lt;&lt; &quot;OpenGLState: Unknown state requested: &quot; &lt;&lt; cap &lt;&lt; std::endl;
+    return false;
+  }
   else
-    {
-      return i-&gt;second;
-    }
+  {
+    return i-&gt;second;
+  }
 }
 
 void 
@@ -148,13 +148,13 @@
 {
   std::map&lt;GLenum, bool&gt;::iterator i = impl-&gt;state.find(cap);
   if (i == impl-&gt;state.end())
-    {
-      std::cout &lt;&lt; &quot;OpenGLState: Unknown state set: &quot; &lt;&lt; cap &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;OpenGLState: Unknown state set: &quot; &lt;&lt; cap &lt;&lt; std::endl;
+  }
   else
-    {
-      i-&gt;second = value;
-    } 
+  {
+    i-&gt;second = value;
+  } 
 }
 
 void
@@ -180,14 +180,14 @@
 {
   std::map&lt;GLenum, bool&gt;::const_iterator i = impl-&gt;client_state.find(array);
   if (i == impl-&gt;client_state.end())
-    {
-      std::cout &lt;&lt; &quot;OpenGLState: Unknown client state requested: &quot; &lt;&lt; array &lt;&lt; std::endl;
-      return false;
-    }
+  {
+    std::cout &lt;&lt; &quot;OpenGLState: Unknown client state requested: &quot; &lt;&lt; array &lt;&lt; std::endl;
+    return false;
+  }
   else
-    {
-      return i-&gt;second;
-    }
+  {
+    return i-&gt;second;
+  }
 }
 
 void
@@ -195,13 +195,13 @@
 {
   std::map&lt;GLenum, bool&gt;::iterator i = impl-&gt;client_state.find(array);
   if (i == impl-&gt;client_state.end())
-    {
-      std::cout &lt;&lt; &quot;OpenGLState: Unknown client state set: &quot; &lt;&lt; array &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;OpenGLState: Unknown client state set: &quot; &lt;&lt; array &lt;&lt; std::endl;
+  }
   else
-    {
-      i-&gt;second = value;
-    }
+  {
+    i-&gt;second = value;
+  }
 }
   
 void
@@ -236,74 +236,74 @@
 
   for(std::map&lt;GLenum, bool&gt;::iterator i = impl-&gt;state.begin();
       i != impl-&gt;state.end(); ++i)
+  {
+    if (global_state-&gt;get_state(i-&gt;first) != i-&gt;second)
     {
-      if (global_state-&gt;get_state(i-&gt;first) != i-&gt;second)
-        {
-          if (i-&gt;second)
-            glEnable(i-&gt;first);
-          else
-            glDisable(i-&gt;first);
+      if (i-&gt;second)
+        glEnable(i-&gt;first);
+      else
+        glDisable(i-&gt;first);
 
-          global_state-&gt;set_state(i-&gt;first, i-&gt;second);
-        }
+      global_state-&gt;set_state(i-&gt;first, i-&gt;second);
     }
+  }
 
   for(std::map&lt;GLenum, bool&gt;::iterator i = impl-&gt;client_state.begin();
       i != impl-&gt;client_state.end(); ++i)
+  {
+    if (global_state-&gt;get_client_state(i-&gt;first) != i-&gt;second)
     {
-      if (global_state-&gt;get_client_state(i-&gt;first) != i-&gt;second)
-        {
-          if (i-&gt;second)
-            glEnableClientState(i-&gt;first);
-          else
-            glDisableClientState(i-&gt;first);
+      if (i-&gt;second)
+        glEnableClientState(i-&gt;first);
+      else
+        glDisableClientState(i-&gt;first);
 
-          global_state-&gt;set_client_state(i-&gt;first, i-&gt;second);
-        }
+      global_state-&gt;set_client_state(i-&gt;first, i-&gt;second);
     }
+  }
 
   if (impl-&gt;blend_sfactor != global_state-&gt;impl-&gt;blend_sfactor ||
       impl-&gt;blend_dfactor != global_state-&gt;impl-&gt;blend_dfactor)
-    {
-      glBlendFunc(impl-&gt;blend_sfactor, impl-&gt;blend_dfactor);
+  {
+    glBlendFunc(impl-&gt;blend_sfactor, impl-&gt;blend_dfactor);
 
-      global_state-&gt;impl-&gt;blend_sfactor = impl-&gt;blend_sfactor;
-      global_state-&gt;impl-&gt;blend_dfactor = impl-&gt;blend_dfactor;
-    }
+    global_state-&gt;impl-&gt;blend_sfactor = impl-&gt;blend_sfactor;
+    global_state-&gt;impl-&gt;blend_dfactor = impl-&gt;blend_dfactor;
+  }
 
   for(int i = 0; i &lt; MAX_TEXTURE_UNITS; ++i)
-    {
-      if (impl-&gt;texture[i] != global_state-&gt;impl-&gt;texture[i])
-        { 
-          // FIXME: glActiveTexture() makes the game crash on Matrox
-          // G450, without that line it works
-          glActiveTexture(GL_TEXTURE0 + i);
-          if (impl-&gt;texture[i])
-            {
-              global_state-&gt;impl-&gt;texture[i] = impl-&gt;texture[i];
+  {
+    if (impl-&gt;texture[i] != global_state-&gt;impl-&gt;texture[i])
+    { 
+      // FIXME: glActiveTexture() makes the game crash on Matrox
+      // G450, without that line it works
+      glActiveTexture(GL_TEXTURE0 + i);
+      if (impl-&gt;texture[i])
+      {
+        global_state-&gt;impl-&gt;texture[i] = impl-&gt;texture[i];
 
-              switch (impl-&gt;texture[i].get_target())
-                {                 
-                case GL_TEXTURE_2D:
-                  glBindTexture(GL_TEXTURE_2D, impl-&gt;texture[i].get_handle());
-                  glEnable(GL_TEXTURE_2D);
-                  break;
+        switch (impl-&gt;texture[i].get_target())
+        {                 
+          case GL_TEXTURE_2D:
+            glBindTexture(GL_TEXTURE_2D, impl-&gt;texture[i].get_handle());
+            glEnable(GL_TEXTURE_2D);
+            break;
                   
-                default:
-                  assert(!&quot;Unknown texture target&quot;);
-                  break;
-                }
-            }
-          else
-            {
-              // FIXME: Hacky, should disable only the right target
-              glBindTexture(GL_TEXTURE_2D, 0);
-              glDisable(GL_TEXTURE_2D);
+          default:
+            assert(!&quot;Unknown texture target&quot;);
+            break;
+        }
+      }
+      else
+      {
+        // FIXME: Hacky, should disable only the right target
+        glBindTexture(GL_TEXTURE_2D, 0);
+        glDisable(GL_TEXTURE_2D);
 
-              global_state-&gt;impl-&gt;texture[i] = impl-&gt;texture[i];
-            }
-        }
+        global_state-&gt;impl-&gt;texture[i] = impl-&gt;texture[i];
+      }
     }
+  }
 
 #if 0
   if (debug)
@@ -316,45 +316,45 @@
 {
   for(std::map&lt;GLenum, bool&gt;::iterator i = impl-&gt;client_state.begin();
       i != impl-&gt;client_state.end(); ++i)
+  {
+    if (glIsEnabled(i-&gt;first) != i-&gt;second)
     {
-      if (glIsEnabled(i-&gt;first) != i-&gt;second)
-        {
-          std::cout &lt;&lt; &quot;OpenGLState: client_state &quot; &lt;&lt; i-&gt;first &lt;&lt; &quot; is out of sync&quot; &lt;&lt; std::endl;
-        }
-    }  
+      std::cout &lt;&lt; &quot;OpenGLState: client_state &quot; &lt;&lt; i-&gt;first &lt;&lt; &quot; is out of sync&quot; &lt;&lt; std::endl;
+    }
+  }  
 
   for(std::map&lt;GLenum, bool&gt;::iterator i = impl-&gt;state.begin();
       i != impl-&gt;state.end(); ++i)
+  {
+    if (glIsEnabled(i-&gt;first) != i-&gt;second)
     {
-      if (glIsEnabled(i-&gt;first) != i-&gt;second)
-        {
-          std::cout &lt;&lt; &quot;OpenGLState: state &quot; &lt;&lt; i-&gt;first &lt;&lt; &quot; is out of sync&quot; &lt;&lt; std::endl;
-        }
+      std::cout &lt;&lt; &quot;OpenGLState: state &quot; &lt;&lt; i-&gt;first &lt;&lt; &quot; is out of sync&quot; &lt;&lt; std::endl;
     }
+  }
 
   GLint sfactor; glGetIntegerv(GL_BLEND_SRC, &amp;sfactor);
   if (sfactor != int(impl-&gt;blend_sfactor))
-    {
-      std::cout &lt;&lt; &quot;OpenGLState: src blendfunc is out of sync&quot; &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;OpenGLState: src blendfunc is out of sync&quot; &lt;&lt; std::endl;
+  }
 
   GLint dfactor; glGetIntegerv(GL_BLEND_DST, &amp;dfactor);
   if (dfactor != int(impl-&gt;blend_dfactor))
-    {
-      std::cout &lt;&lt; &quot;OpenGLState: dst blendfunc is out of sync&quot; &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;OpenGLState: dst blendfunc is out of sync&quot; &lt;&lt; std::endl;
+  }
 
   if (0)
+  {
+    // FIXME: Add multitexture support here
+    GLint texture_handle;
+    glActiveTexture(GL_TEXTURE0);
+    glGetIntegerv(GL_TEXTURE_2D_BINDING_EXT, &amp;texture_handle);
+    if (impl-&gt;texture[0] &amp;&amp; static_cast&lt;GLuint&gt;(texture_handle) != impl-&gt;texture[0].get_handle())
     {
-      // FIXME: Add multitexture support here
-      GLint texture_handle;
-      glActiveTexture(GL_TEXTURE0);
-      glGetIntegerv(GL_TEXTURE_2D_BINDING_EXT, &amp;texture_handle);
-      if (impl-&gt;texture[0] &amp;&amp; static_cast&lt;GLuint&gt;(texture_handle) != impl-&gt;texture[0].get_handle())
-        {
-          std::cout &lt;&lt; &quot;OpenGLState: texture handle is out of sync: &quot; &lt;&lt; impl-&gt;texture[0].get_handle() &lt;&lt; std::endl;
-        }
+      std::cout &lt;&lt; &quot;OpenGLState: texture handle is out of sync: &quot; &lt;&lt; impl-&gt;texture[0].get_handle() &lt;&lt; std::endl;
     }
+  }
   assert_gl(&quot;OpenGLState::verify&quot;);
 }
 

Modified: trunk/windstille/src/display/opengl_window.cpp
===================================================================
--- trunk/windstille/src/display/opengl_window.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/opengl_window.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -40,8 +40,8 @@
   {}
 };
 
-OpenGLWindow::OpenGLWindow(const Size&amp; size, const Size&amp; aspect, bool fullscreen, int anti_aliasing)
-  : m_impl(new OpenGLWindowImpl)
+OpenGLWindow::OpenGLWindow(const Size&amp; size, const Size&amp; aspect, bool fullscreen, int anti_aliasing) :
+  m_impl(new OpenGLWindowImpl)
 {
   m_impl-&gt;m_size = size;
 
@@ -143,18 +143,18 @@
   m_impl-&gt;m_window = SDL_SetVideoMode(m_impl-&gt;m_size.width, m_impl-&gt;m_size.height, 0, flags);
 
   if (!m_impl-&gt;m_window)
-    {
-      throw std::runtime_error(&quot;OpenGLWindow: Couldn't create window&quot;);
-    }
+  {
+    throw std::runtime_error(&quot;OpenGLWindow: Couldn't create window&quot;);
+  }
 }
 
 void
 OpenGLWindow::set_gamma(float r, float g, float b)
 {
   if (SDL_SetGamma(r, g, b) == -1)
-    {
-      // Couldn't set gamma
-    }
+  {
+    // Couldn't set gamma
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/display/render_buffer.cpp
===================================================================
--- trunk/windstille/src/display/render_buffer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/render_buffer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -42,8 +42,8 @@
   }
 };
 
-RenderBuffer::RenderBuffer(GLenum format, int width, int height)
-  : impl(new RenderBufferImpl(format, width, height))
+RenderBuffer::RenderBuffer(GLenum format, int width, int height) :
+  impl(new RenderBufferImpl(format, width, height))
 {
 }
 

Modified: trunk/windstille/src/display/scene_context.cpp
===================================================================
--- trunk/windstille/src/display/scene_context.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/scene_context.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -52,8 +52,8 @@
   }
 };
 
-SceneContext::SceneContext()
-  : impl(new SceneContextImpl())
+SceneContext::SceneContext() :
+  impl(new SceneContextImpl())
 {
 }
 
@@ -163,34 +163,34 @@
   
   glBegin(GL_QUADS);
   for (int i = 0; i &lt; segments; ++i)
-    {
-      float angel = 2.0f * math::pi / static_cast&lt;float&gt;(segments);
+  {
+    float angel = 2.0f * math::pi / static_cast&lt;float&gt;(segments);
 
-      float x1 =  sinf(angel * static_cast&lt;float&gt;(i)) * radius;
-      float y1 = -cosf(angel * static_cast&lt;float&gt;(i)) * radius;
+    float x1 =  sinf(angel * static_cast&lt;float&gt;(i)) * radius;
+    float y1 = -cosf(angel * static_cast&lt;float&gt;(i)) * radius;
 
-      float x2 =  sinf(angel * static_cast&lt;float&gt;(i+1)) * radius;
-      float y2 = -cosf(angel * static_cast&lt;float&gt;(i+1)) * radius;
+    float x2 =  sinf(angel * static_cast&lt;float&gt;(i+1)) * radius;
+    float y2 = -cosf(angel * static_cast&lt;float&gt;(i+1)) * radius;
 
-      glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
-      glTexCoord2f(x1/512.0f+0.5f, y1/512.0f+0.5f);
-      glVertex3f(x1+256, y1+256, 0);
+    glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
+    glTexCoord2f(x1/512.0f+0.5f, y1/512.0f+0.5f);
+    glVertex3f(x1+256, y1+256, 0);
 
-      glTexCoord2f(x2/512.0f+0.5f, y2/512.0f+0.5f);
-      glVertex3f(x2+256, y2+256, 0);
+    glTexCoord2f(x2/512.0f+0.5f, y2/512.0f+0.5f);
+    glVertex3f(x2+256, y2+256, 0);
 
-      float x3 =  sinf(angel * static_cast&lt;float&gt;(i)) * minradius;
-      float y3 = -cosf(angel * static_cast&lt;float&gt;(i)) * minradius;
+    float x3 =  sinf(angel * static_cast&lt;float&gt;(i)) * minradius;
+    float y3 = -cosf(angel * static_cast&lt;float&gt;(i)) * minradius;
 
-      float x4 =  sinf(angel * static_cast&lt;float&gt;(i+1)) * minradius;
-      float y4 = -cosf(angel * static_cast&lt;float&gt;(i+1)) * minradius;
+    float x4 =  sinf(angel * static_cast&lt;float&gt;(i+1)) * minradius;
+    float y4 = -cosf(angel * static_cast&lt;float&gt;(i+1)) * minradius;
 
-      glColor4f(1.0f, 1.0f, 1.0f, 0.0f);
-      glTexCoord2f(x4/512.0f+0.5f, y4/512.0f+0.5f);
-      glVertex3f(x4+256, y4+256, 0);
-      glTexCoord2f(x3/512.0f+0.5f, y3/512.0f+0.5f);
-      glVertex3f(x3+256, y3+256, 0);
-    }
+    glColor4f(1.0f, 1.0f, 1.0f, 0.0f);
+    glTexCoord2f(x4/512.0f+0.5f, y4/512.0f+0.5f);
+    glVertex3f(x4+256, y4+256, 0);
+    glTexCoord2f(x3/512.0f+0.5f, y3/512.0f+0.5f);
+    glVertex3f(x3+256, y3+256, 0);
+  }
   glEnd();
 }
 

Modified: trunk/windstille/src/display/shader_object.cpp
===================================================================
--- trunk/windstille/src/display/shader_object.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/shader_object.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -32,20 +32,20 @@
   GLchar* str = static_cast&lt;char*&gt;(malloc(size));
   FILE* f = fopen(filename, &quot;r&quot;);
   if (!f)
-    {
-      perror(filename);
-      exit(EXIT_FAILURE);
-    }
+  {
+    perror(filename);
+    exit(EXIT_FAILURE);
+  }
   else
+  {
+    while ((true_size += fread(str, sizeof(GLchar), 4096, f)) == 4096)
     {
-      while ((true_size += fread(str, sizeof(GLchar), 4096, f)) == 4096)
-        {
-          size += block_size;
-          str = static_cast&lt;GLchar*&gt;(realloc(str, size));
-        }
-      str = static_cast&lt;GLchar*&gt;(realloc(str, true_size+1));
-      str[true_size] = '\0';
+      size += block_size;
+      str = static_cast&lt;GLchar*&gt;(realloc(str, size));
     }
+    str = static_cast&lt;GLchar*&gt;(realloc(str, true_size+1));
+    str[true_size] = '\0';
+  }
 
   fclose(f);
   return str;
@@ -67,8 +67,8 @@
   }
 };
 
-ShaderObject::ShaderObject(GLenum type, const std::string&amp; filename)
-  : impl(new ShaderObjectImpl(type))
+ShaderObject::ShaderObject(GLenum type, const std::string&amp; filename) :
+  impl(new ShaderObjectImpl(type))
 {
   load(filename);
   compile();
@@ -114,17 +114,17 @@
   assert_gl(&quot;print_log2&quot;);
 
   if (infologLength &gt; 0)
+  {
+    infoLog = static_cast&lt;GLchar*&gt;(malloc(infologLength));
+    if (infoLog == NULL)
     {
-      infoLog = static_cast&lt;GLchar*&gt;(malloc(infologLength));
-      if (infoLog == NULL)
-        {
-          printf(&quot;ERROR: Could not allocate InfoLog buffer\n&quot;);
-          exit(1);
-        }
-      glGetShaderInfoLog(impl-&gt;handle, infologLength, &amp;charsWritten, infoLog);
-      printf(&quot;InfoLog:\n%s\n\n&quot;, infoLog);
-      free(infoLog);
+      printf(&quot;ERROR: Could not allocate InfoLog buffer\n&quot;);
+      exit(1);
     }
+    glGetShaderInfoLog(impl-&gt;handle, infologLength, &amp;charsWritten, infoLog);
+    printf(&quot;InfoLog:\n%s\n\n&quot;, infoLog);
+    free(infoLog);
+  }
   assert_gl(&quot;print_log3&quot;);
 }
 

Modified: trunk/windstille/src/display/shader_program.cpp
===================================================================
--- trunk/windstille/src/display/shader_program.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/shader_program.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -36,8 +36,8 @@
   }
 };
 
-ShaderProgram::ShaderProgram()
-  : impl(new ShaderProgramImpl())
+ShaderProgram::ShaderProgram() :
+  impl(new ShaderProgramImpl())
 {
 }
 

Modified: trunk/windstille/src/display/software_surface.cpp
===================================================================
--- trunk/windstille/src/display/software_surface.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/software_surface.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -32,27 +32,27 @@
   SDL_Surface* surface;
 };
 
-SoftwareSurface::SoftwareSurface(const Pathname&amp; filename)
-  : impl(new SoftwareSurfaceImpl())
+SoftwareSurface::SoftwareSurface(const Pathname&amp; filename) :
+  impl(new SoftwareSurfaceImpl())
 {
   impl-&gt;surface = IMG_Load(filename.get_sys_path().c_str());
 
   if (!impl-&gt;surface)
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;SoftwareSurface: Couldn't load: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-      throw std::runtime_error(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;SoftwareSurface: Couldn't load: &quot; &lt;&lt; filename &lt;&lt; std::endl;
+    throw std::runtime_error(str.str());
+  }
   else
-    {
-      SDL_SetAlpha(impl-&gt;surface, 0, 0);
+  {
+    SDL_SetAlpha(impl-&gt;surface, 0, 0);
 
-      assert(!SDL_MUSTLOCK(impl-&gt;surface));
-    }
+    assert(!SDL_MUSTLOCK(impl-&gt;surface));
+  }
 }
 
-SoftwareSurface::SoftwareSurface(int width, int height, Format format)
-  : impl(new SoftwareSurfaceImpl())
+SoftwareSurface::SoftwareSurface(int width, int height, Format format) :
+  impl(new SoftwareSurfaceImpl())
 {
   assert(format == RGBA);
 
@@ -155,22 +155,22 @@
 {
   if (x &gt;= 0 &amp;&amp; x &lt; impl-&gt;surface-&gt;w &amp;&amp;
       y &gt;= 0 &amp;&amp; y &lt; impl-&gt;surface-&gt;h)
+  {
+    if (get_bits_per_pixel() == 32)
     {
-      if (get_bits_per_pixel() == 32)
-        {
-          uint8_t* pixels = static_cast&lt;uint8_t*&gt;(impl-&gt;surface-&gt;pixels);
+      uint8_t* pixels = static_cast&lt;uint8_t*&gt;(impl-&gt;surface-&gt;pixels);
           
-          return pixels[y * impl-&gt;surface-&gt;pitch + x*4 + 3] &gt; 128;
-        }
-      else
-        {
-          return true;
-        }
+      return pixels[y * impl-&gt;surface-&gt;pitch + x*4 + 3] &gt; 128;
     }
-  else
+    else
     {
-      return false;
+      return true;
     }
+  }
+  else
+  {
+    return false;
+  }
 }
 
 void
@@ -180,52 +180,52 @@
 
   if (get_bytes_per_pixel() != 4 &amp;&amp;
       get_bytes_per_pixel() != 3)
-    {
-      std::cout &lt;&lt; &quot;SoftwareSurface::save_png(): Unsupported pixel format&quot; &lt;&lt; std::endl;
-      return;
-    }
+  {
+    std::cout &lt;&lt; &quot;SoftwareSurface::save_png(): Unsupported pixel format&quot; &lt;&lt; std::endl;
+    return;
+  }
 
   FILE* fp = fopen(filename.c_str(), &quot;w&quot;);
 
   if (!fp)
-    {
-      std::cout &lt;&lt; &quot;Error: Couldn't save screenshot: &quot; &lt;&lt; strerror(errno) &lt;&lt; std::endl;
-      return;
-    }
+  {
+    std::cout &lt;&lt; &quot;Error: Couldn't save screenshot: &quot; &lt;&lt; strerror(errno) &lt;&lt; std::endl;
+    return;
+  }
   else
-    {
-      int pitch   = get_pitch();
-      png_structp png_ptr;
-      png_infop   info_ptr;
-      png_byte* pixels = static_cast&lt;png_byte*&gt;(get_pixels());
+  {
+    int pitch   = get_pitch();
+    png_structp png_ptr;
+    png_infop   info_ptr;
+    png_byte* pixels = static_cast&lt;png_byte*&gt;(get_pixels());
 
-      png_ptr  = png_create_write_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
-      info_ptr = png_create_info_struct(png_ptr);
+    png_ptr  = png_create_write_struct(PNG_LIBPNG_VER_STRING, NULL, NULL, NULL);
+    info_ptr = png_create_info_struct(png_ptr);
 
-      png_init_io(png_ptr, fp);
+    png_init_io(png_ptr, fp);
 
-      png_set_IHDR(png_ptr, info_ptr, 
-                   get_width(), get_height(), 8 /* bitdepth */,
-                   (get_bytes_per_pixel() == 32) ? PNG_COLOR_TYPE_RGBA : PNG_COLOR_TYPE_RGB,
-                   PNG_INTERLACE_NONE, 
-                   PNG_COMPRESSION_TYPE_BASE, 
-                   PNG_FILTER_TYPE_BASE);
+    png_set_IHDR(png_ptr, info_ptr, 
+                 get_width(), get_height(), 8 /* bitdepth */,
+                 (get_bytes_per_pixel() == 32) ? PNG_COLOR_TYPE_RGBA : PNG_COLOR_TYPE_RGB,
+                 PNG_INTERLACE_NONE, 
+                 PNG_COMPRESSION_TYPE_BASE, 
+                 PNG_FILTER_TYPE_BASE);
       
-      png_set_compression_level(png_ptr, 6);
-      png_write_info(png_ptr, info_ptr);
+    png_set_compression_level(png_ptr, 6);
+    png_write_info(png_ptr, info_ptr);
 
-      boost::scoped_array&lt;png_bytep&gt; row_pointers(new png_bytep[get_height()]);
+    boost::scoped_array&lt;png_bytep&gt; row_pointers(new png_bytep[get_height()]);
    
-      // generate row pointers
-      for (int k = 0; k &lt; get_height(); k++)
-        row_pointers[k] = reinterpret_cast&lt;png_byte*&gt;(pixels + ((get_height() - k - 1) * pitch));
+    // generate row pointers
+    for (int k = 0; k &lt; get_height(); k++)
+      row_pointers[k] = reinterpret_cast&lt;png_byte*&gt;(pixels + ((get_height() - k - 1) * pitch));
 
-      png_write_image(png_ptr, row_pointers.get());
+    png_write_image(png_ptr, row_pointers.get());
 
-      png_write_end(png_ptr, info_ptr);
+    png_write_end(png_ptr, info_ptr);
 
-      fclose(fp);
-    }
+    fclose(fp);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/display/surface.cpp
===================================================================
--- trunk/windstille/src/display/surface.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/surface.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -48,20 +48,20 @@
   {}
 };
 
-Surface::Surface()
-  : impl()
+Surface::Surface() :
+  impl()
 {
 }
 
-Surface::Surface(const Pathname&amp; filename)
-  : impl()
+Surface::Surface(const Pathname&amp; filename) :
+  impl()
 {
   // FIXME: a bit ugly, should move some of the surface_manager code over here
   *this = SurfaceManager::current()-&gt;get(filename);
 }
 
-Surface::Surface(int width, int height)
-  : impl(new SurfaceImpl())
+Surface::Surface(int width, int height) :
+  impl(new SurfaceImpl())
 {
   impl-&gt;size  = Size(width, height);
 
@@ -71,8 +71,8 @@
                         impl-&gt;size.height / static_cast&lt;float&gt;(impl-&gt;texture.get_height()));
 }
 
-Surface::Surface(Texture texture, const Rectf&amp; uv, const Sizef&amp; size)
-  : impl(new SurfaceImpl())
+Surface::Surface(Texture texture, const Rectf&amp; uv, const Sizef&amp; size) :
+  impl(new SurfaceImpl())
 {
   impl-&gt;texture = texture;
   impl-&gt;uv      = uv;

Modified: trunk/windstille/src/display/surface_manager.cpp
===================================================================
--- trunk/windstille/src/display/surface_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/surface_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -25,9 +25,9 @@
 #include &quot;display/texture_packer.hpp&quot;
 
 
-SurfaceManager::SurfaceManager()
-  : texture_packer(0), // (new TexturePacker(Size(2048, 2048))),
-    surfaces()
+SurfaceManager::SurfaceManager() :
+  texture_packer(0), // (new TexturePacker(Size(2048, 2048))),
+  surfaces()
 {
 }
 
@@ -35,13 +35,13 @@
 {
 #if 0 
   if (debug)
+  {
+    for(Surfaces::iterator i = surfaces.begin(); i != surfaces.end(); ++i)
     {
-      for(Surfaces::iterator i = surfaces.begin(); i != surfaces.end(); ++i)
-        {
-          //      if (i-&gt;second.use_count() &gt; 1)
-          std::cerr &lt;&lt; &quot;Warning: Surface '&quot; &lt;&lt; i-&gt;first &lt;&lt; &quot;' not released.\n&quot;;
-        }
+      //      if (i-&gt;second.use_count() &gt; 1)
+      std::cerr &lt;&lt; &quot;Warning: Surface '&quot; &lt;&lt; i-&gt;first &lt;&lt; &quot;' not released.\n&quot;;
     }
+  }
 #endif
 }
 
@@ -101,31 +101,31 @@
   Texture texture;
 
   try
-    {                                                                       
-      texture = create_texture(image, &amp;maxu, &amp;maxv);
-    }
+  {                                                                       
+    texture = create_texture(image, &amp;maxu, &amp;maxv);
+  }
   catch(std::exception&amp; e)
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Couldn't create texture for '&quot; &lt;&lt; filename &lt;&lt; &quot;': &quot; &lt;&lt; e.what();
-      throw std::runtime_error(msg.str());                                      
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't create texture for '&quot; &lt;&lt; filename &lt;&lt; &quot;': &quot; &lt;&lt; e.what();
+    throw std::runtime_error(msg.str());                                      
+  }
 
   for(int y = 0; y &lt;= image.get_height() - height + 1; y += height)
+  {
+    for(int x = 0; x &lt;= image.get_width() - width + 1; x += width)
     {
-      for(int x = 0; x &lt;= image.get_width() - width + 1; x += width)
-        {
-          float s_min_u = maxu * static_cast&lt;float&gt;(x) / static_cast&lt;float&gt;(image.get_width());
-          float s_min_v = maxv * static_cast&lt;float&gt;(x) / static_cast&lt;float&gt;(image.get_height());
-          float s_max_u = (maxu * (static_cast&lt;float&gt;(x + width)))  / static_cast&lt;float&gt;(image.get_width());
-          float s_max_v = (maxv * (static_cast&lt;float&gt;(x + height))) / static_cast&lt;float&gt;(image.get_height());
+      float s_min_u = maxu * static_cast&lt;float&gt;(x) / static_cast&lt;float&gt;(image.get_width());
+      float s_min_v = maxv * static_cast&lt;float&gt;(x) / static_cast&lt;float&gt;(image.get_height());
+      float s_max_u = (maxu * (static_cast&lt;float&gt;(x + width)))  / static_cast&lt;float&gt;(image.get_width());
+      float s_max_v = (maxv * (static_cast&lt;float&gt;(x + height))) / static_cast&lt;float&gt;(image.get_height());
 
-          out_surfaces.push_back(Surface(texture, 
-                                         Rectf(s_min_u, s_min_v, s_max_u, s_max_v), 
-                                         Sizef(static_cast&lt;float&gt;(width),
-                                               static_cast&lt;float&gt;(height))));
-        }
+      out_surfaces.push_back(Surface(texture, 
+                                     Rectf(s_min_u, s_min_v, s_max_u, s_max_v), 
+                                     Sizef(static_cast&lt;float&gt;(width),
+                                           static_cast&lt;float&gt;(height))));
     }
+  }
 }
 
 Texture
@@ -152,12 +152,12 @@
 SurfaceManager::cleanup()
 {
   for(Surfaces::iterator i = surfaces.begin(); i != surfaces.end(); ++i)
+  {
+    if (i-&gt;second.use_count() == 1)
     {
-      if (i-&gt;second.use_count() == 1)
-        {
-          surfaces.erase(i);
-        }
+      surfaces.erase(i);
     }
+  }
 }
 
 void

Modified: trunk/windstille/src/display/text_area.cpp
===================================================================
--- trunk/windstille/src/display/text_area.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/text_area.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -66,8 +66,8 @@
   TextAreaImpl&amp; operator=(const TextAreaImpl&amp;);
 };
 
-TextArea::TextArea(const Rectf&amp; rect, bool letter_by_letter)
-  : impl(new TextAreaImpl)
+TextArea::TextArea(const Rectf&amp; rect, bool letter_by_letter) :
+  impl(new TextAreaImpl)
 {
   impl-&gt;font = Fonts::current()-&gt;vera20.get();
   impl-&gt;rect    = rect;
@@ -101,45 +101,45 @@
   BabyXML xml(str);
 
   for(BabyXML::iterator i = xml.begin(); i != xml.end(); ++i)
+  {
+    if (i-&gt;type == BabyXML::Node::START_TAG)
     {
-      if (i-&gt;type == BabyXML::Node::START_TAG)
+      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::START, i-&gt;content));
+    }
+    else if (i-&gt;type == BabyXML::Node::END_TAG)
+    {
+      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::END, i-&gt;content));
+    }
+    else if (i-&gt;type == BabyXML::Node::TEXT)
+    {      
+      // Seperate the given str into words, words are seperated by either
+      // ' ' or '\n', space is threaded as a word of its own
+      // &quot;Hello  World \n&quot; =&gt; (&quot;Hello&quot;, &quot; &quot;, &quot; &quot;, &quot;World&quot;, &quot; &quot;, &quot;\n&quot;)
+      std::string word;
+      for(std::string::const_iterator j = i-&gt;content.begin(); j != i-&gt;content.end(); ++j)
+      {
+        if (*j == ' ' || *j == '\n')
         {
-          impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::START, i-&gt;content));
+          if (word.empty())
+          {
+            impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, std::string(1, *j)));
+          }
+          else
+          {
+            impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, word));
+            impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, std::string(1, *j)));
+            word = &quot;&quot;;
+          }
         }
-      else if (i-&gt;type == BabyXML::Node::END_TAG)
+        else
         {
-          impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::END, i-&gt;content));
+          word += *j;
         }
-      else if (i-&gt;type == BabyXML::Node::TEXT)
-        {      
-          // Seperate the given str into words, words are seperated by either
-          // ' ' or '\n', space is threaded as a word of its own
-          // &quot;Hello  World \n&quot; =&gt; (&quot;Hello&quot;, &quot; &quot;, &quot; &quot;, &quot;World&quot;, &quot; &quot;, &quot;\n&quot;)
-          std::string word;
-          for(std::string::const_iterator j = i-&gt;content.begin(); j != i-&gt;content.end(); ++j)
-            {
-              if (*j == ' ' || *j == '\n')
-                {
-                  if (word.empty())
-                    {
-                      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, std::string(1, *j)));
-                    }
-                  else
-                    {
-                      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, word));
-                      impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, std::string(1, *j)));
-                      word = &quot;&quot;;
-                    }
-                }
-              else
-                {
-                  word += *j;
-                }
-            }
-          if (!word.empty())
-            impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, word));
-        }
+      }
+      if (!word.empty())
+        impl-&gt;commands.push_back(TextAreaCommand(TextAreaCommand::WORD, word));
     }
+  }
 }
 
 void
@@ -165,14 +165,14 @@
 {
   assert(impl-&gt;font);
   if (impl-&gt;max_scroll_offset &gt; 0.0f)
-    {
-      float height = impl-&gt;max_scroll_offset + impl-&gt;rect.get_height();
+  {
+    float height = impl-&gt;max_scroll_offset + impl-&gt;rect.get_height();
 
-      Display::fill_rounded_rect(Rectf(Vector2f(impl-&gt;rect.right + 4,
-                                                impl-&gt;rect.top + impl-&gt;scroll_offset*impl-&gt;rect.get_height()/height), 
-                                       Sizef(8, impl-&gt;rect.get_height()*impl-&gt;rect.get_height()/height)),
-                                 4.0f, Color(1.0f, 1.0f, 1.0f, 0.25f));
-    }
+    Display::fill_rounded_rect(Rectf(Vector2f(impl-&gt;rect.right + 4,
+                                              impl-&gt;rect.top + impl-&gt;scroll_offset*impl-&gt;rect.get_height()/height), 
+                                     Sizef(8, impl-&gt;rect.get_height()*impl-&gt;rect.get_height()/height)),
+                               4.0f, Color(1.0f, 1.0f, 1.0f, 0.25f));
+  }
   OpenGLState state;
   
   state.bind_texture(impl-&gt;font-&gt;get_texture());
@@ -201,201 +201,201 @@
 
   std::vector&lt;TextAreaCommand&gt;::const_iterator i = impl-&gt;commands.begin();
   for(; i != impl-&gt;commands.end(); ++i)
+  {
+    if (break_writing)
+      break;
+        
+    switch (i-&gt;type)
     {
-      if (break_writing)
+      case TextAreaCommand::START:
+        if (i-&gt;content == &quot;b&quot;)
+        {
+          top_color    = Color(1.0f, 0.0f, 0.0f);
+          bottom_color = Color(0.8f, 0.0f, 0.0f);
+        }
+        else if (i-&gt;content == &quot;i&quot;)
+        {
+          top_color    = Color(0.65f, 0.7f, 1.0f);
+          bottom_color = Color(0.65f, 0.7f, 1.0f);
+        }
+        else if (i-&gt;content == &quot;small&quot;)
+        {
+          is_small = true;
+        }
+        else if (i-&gt;content == &quot;large&quot;)
+        {
+          is_large = true;
+        }
+        else if (i-&gt;content == &quot;sleep&quot;)
+        {
+          eat_time -= 1.0f;
+        }
+        else if (i-&gt;content == &quot;sin&quot;)
+        {
+          sinus = true;
+        }
         break;
-        
-      switch (i-&gt;type)
+
+      case TextAreaCommand::END:
+        if (i-&gt;content == &quot;b&quot; || i-&gt;content == &quot;i&quot;)
         {
-          case TextAreaCommand::START:
-            if (i-&gt;content == &quot;b&quot;)
-              {
-                top_color    = Color(1.0f, 0.0f, 0.0f);
-                bottom_color = Color(0.8f, 0.0f, 0.0f);
-              }
-            else if (i-&gt;content == &quot;i&quot;)
-              {
-                top_color    = Color(0.65f, 0.7f, 1.0f);
-                bottom_color = Color(0.65f, 0.7f, 1.0f);
-              }
-            else if (i-&gt;content == &quot;small&quot;)
-              {
-                is_small = true;
-              }
-            else if (i-&gt;content == &quot;large&quot;)
-              {
-                is_large = true;
-              }
-            else if (i-&gt;content == &quot;sleep&quot;)
-              {
-                eat_time -= 1.0f;
-              }
-            else if (i-&gt;content == &quot;sin&quot;)
-              {
-                sinus = true;
-              }
-            break;
-
-          case TextAreaCommand::END:
-            if (i-&gt;content == &quot;b&quot; || i-&gt;content == &quot;i&quot;)
-              {
-                top_color    = Color(1.0f, 1.0f, 1.0f);
-                bottom_color = Color(1.0f, 1.0f, 1.0f);
-              }
-            else if (i-&gt;content == &quot;small&quot;)
-              {
-                is_small = false;
-              }
-            else if (i-&gt;content == &quot;large&quot;)
-              {
-                is_large = false;
-              }
-            else if (i-&gt;content == &quot;sin&quot;)
-              {
-                sinus = false;
-              }
-            break;
+          top_color    = Color(1.0f, 1.0f, 1.0f);
+          bottom_color = Color(1.0f, 1.0f, 1.0f);
+        }
+        else if (i-&gt;content == &quot;small&quot;)
+        {
+          is_small = false;
+        }
+        else if (i-&gt;content == &quot;large&quot;)
+        {
+          is_large = false;
+        }
+        else if (i-&gt;content == &quot;sin&quot;)
+        {
+          sinus = false;
+        }
+        break;
           
-          case TextAreaCommand::WORD:
-            retry:
-            int word_width;
+      case TextAreaCommand::WORD:
+        retry:
+        int word_width;
 
-            if (is_small)
-              word_width = static_cast&lt;int&gt;(static_cast&lt;float&gt;(impl-&gt;font-&gt;get_width(i-&gt;content)) * 0.6f);
-            else if (is_large)
-              word_width = static_cast&lt;int&gt;(static_cast&lt;float&gt;(impl-&gt;font-&gt;get_width(i-&gt;content)) * 2.0f);
-            else
-              word_width = impl-&gt;font-&gt;get_width(i-&gt;content);
+        if (is_small)
+          word_width = static_cast&lt;int&gt;(static_cast&lt;float&gt;(impl-&gt;font-&gt;get_width(i-&gt;content)) * 0.6f);
+        else if (is_large)
+          word_width = static_cast&lt;int&gt;(static_cast&lt;float&gt;(impl-&gt;font-&gt;get_width(i-&gt;content)) * 2.0f);
+        else
+          word_width = impl-&gt;font-&gt;get_width(i-&gt;content);
           
-            if (i-&gt;content == &quot;\n&quot;)
+        if (i-&gt;content == &quot;\n&quot;)
+        {
+          x_pos = 0;
+          y_pos += impl-&gt;font-&gt;get_height() + impl-&gt;v_space;
+        }
+        else if (x_pos + word_width &gt; impl-&gt;rect.get_width() &amp;&amp; word_width &lt;= impl-&gt;rect.get_width())
+        {
+          x_pos = 0;
+          y_pos += impl-&gt;font-&gt;get_height() + impl-&gt;v_space;
+          goto retry;
+        }
+        else
+        {
+          if (x_pos == 0 &amp;&amp; i-&gt;content == &quot; &quot;)
+          {
+            // ignore space at the beginning of a line
+          }
+          else
+          {
+            for(std::string::const_iterator j = i-&gt;content.begin(); j != i-&gt;content.end(); ++j)
+            {
+              if (impl-&gt;letter_by_letter &amp;&amp; eat_time &lt;= 0)
               {
-                x_pos = 0;
-                y_pos += impl-&gt;font-&gt;get_height() + impl-&gt;v_space;
+                break_writing = true;
+                break;
               }
-            else if (x_pos + word_width &gt; impl-&gt;rect.get_width() &amp;&amp; word_width &lt;= impl-&gt;rect.get_width())
-              {
-                x_pos = 0;
-                y_pos += impl-&gt;font-&gt;get_height() + impl-&gt;v_space;
-                goto retry;
-              }
-            else
-              {
-                if (x_pos == 0 &amp;&amp; i-&gt;content == &quot; &quot;)
-                  {
-                    // ignore space at the beginning of a line
-                  }
-                else
-                  {
-                    for(std::string::const_iterator j = i-&gt;content.begin(); j != i-&gt;content.end(); ++j)
-                      {
-                        if (impl-&gt;letter_by_letter &amp;&amp; eat_time &lt;= 0)
-                          {
-                            break_writing = true;
-                            break;
-                          }
                         
-                        float x = static_cast&lt;float&gt;(x_pos);
-                        float y = static_cast&lt;float&gt;(y_pos);
+              float x = static_cast&lt;float&gt;(x_pos);
+              float y = static_cast&lt;float&gt;(y_pos);
                         
-                        if (sinus) // FIXME: this could actually work per vertex
-                          y += sinf(impl-&gt;passed_time * 10.0f + static_cast&lt;float&gt;(x_pos) / 15.0f) * 5.0f;
+              if (sinus) // FIXME: this could actually work per vertex
+                y += sinf(impl-&gt;passed_time * 10.0f + static_cast&lt;float&gt;(x_pos) / 15.0f) * 5.0f;
 
-                        if (*j == '.' || *j == '\n')
-                          eat_time -= 0.50f;
-                        else
-                          eat_time -= 0.05f;
+              if (*j == '.' || *j == '\n')
+                eat_time -= 0.50f;
+              else
+                eat_time -= 0.05f;
 
-                        const TTFCharacter&amp; character = impl-&gt;font-&gt;get_character(*j);
+              const TTFCharacter&amp; character = impl-&gt;font-&gt;get_character(*j);
                       
-                        bool draw_it = (y_pos &gt;= impl-&gt;scroll_offset &amp;&amp; 
-                                        y_pos &lt; impl-&gt;scroll_offset + impl-&gt;rect.get_height() - static_cast&lt;float&gt;(impl-&gt;font-&gt;get_height()));
-                        if (is_small)
-                          {
-                            float scale = 0.6f;
-                            if (draw_it)
-                              {
-                                glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
-                                glTexCoord2f(character.uv.left, character.uv.top);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left),
-                                           y + scale * static_cast&lt;float&gt;(character.pos.top));
+              bool draw_it = (y_pos &gt;= impl-&gt;scroll_offset &amp;&amp; 
+                              y_pos &lt; impl-&gt;scroll_offset + impl-&gt;rect.get_height() - static_cast&lt;float&gt;(impl-&gt;font-&gt;get_height()));
+              if (is_small)
+              {
+                float scale = 0.6f;
+                if (draw_it)
+                {
+                  glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
+                  glTexCoord2f(character.uv.left, character.uv.top);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left),
+                             y + scale * static_cast&lt;float&gt;(character.pos.top));
 
-                                glTexCoord2f(character.uv.right, character.uv.top);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
-                                           y + scale * static_cast&lt;float&gt;(character.pos.top));
+                  glTexCoord2f(character.uv.right, character.uv.top);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
+                             y + scale * static_cast&lt;float&gt;(character.pos.top));
 
-                                glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
-                                glTexCoord2f(character.uv.right, character.uv.bottom);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
-                                           y + scale * static_cast&lt;float&gt;(character.pos.bottom));
+                  glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
+                  glTexCoord2f(character.uv.right, character.uv.bottom);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
+                             y + scale * static_cast&lt;float&gt;(character.pos.bottom));
 
-                                glTexCoord2f(character.uv.left, character.uv.bottom);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left), 
-                                           y + scale * static_cast&lt;float&gt;(character.pos.bottom));
-                              }
-                            x_pos += static_cast&lt;int&gt;(scale * static_cast&lt;float&gt;(character.advance));
-                          }
-                        else if (is_large)
-                          {
-                            float scale = 2.0f;
-                            if (draw_it)
-                              {
-                                glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
-                                glTexCoord2f(character.uv.left, character.uv.top);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left),
-                                           y + static_cast&lt;float&gt;(character.pos.top));
+                  glTexCoord2f(character.uv.left, character.uv.bottom);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left), 
+                             y + scale * static_cast&lt;float&gt;(character.pos.bottom));
+                }
+                x_pos += static_cast&lt;int&gt;(scale * static_cast&lt;float&gt;(character.advance));
+              }
+              else if (is_large)
+              {
+                float scale = 2.0f;
+                if (draw_it)
+                {
+                  glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
+                  glTexCoord2f(character.uv.left, character.uv.top);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left),
+                             y + static_cast&lt;float&gt;(character.pos.top));
 
-                                glTexCoord2f(character.uv.right, character.uv.top);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
-                                           y + static_cast&lt;float&gt;(character.pos.top));
+                  glTexCoord2f(character.uv.right, character.uv.top);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
+                             y + static_cast&lt;float&gt;(character.pos.top));
 
-                                glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
-                                glTexCoord2f(character.uv.right, character.uv.bottom);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
-                                           y + static_cast&lt;float&gt;(character.pos.bottom));
+                  glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
+                  glTexCoord2f(character.uv.right, character.uv.bottom);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.right), 
+                             y + static_cast&lt;float&gt;(character.pos.bottom));
 
-                                glTexCoord2f(character.uv.left, character.uv.bottom);
-                                glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left), 
-                                           y + static_cast&lt;float&gt;(character.pos.bottom));
-                              }
-                            x_pos += static_cast&lt;int&gt;(scale * static_cast&lt;float&gt;(character.advance));
-                          }
-                        else   
-                          {
-                            if (draw_it)
-                              {
-                                glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
-                                glTexCoord2f(character.uv.left, character.uv.top);
-                                glVertex2f(x + static_cast&lt;float&gt;(character.pos.left),
-                                           y + static_cast&lt;float&gt;(character.pos.top));
+                  glTexCoord2f(character.uv.left, character.uv.bottom);
+                  glVertex2f(x + scale * static_cast&lt;float&gt;(character.pos.left), 
+                             y + static_cast&lt;float&gt;(character.pos.bottom));
+                }
+                x_pos += static_cast&lt;int&gt;(scale * static_cast&lt;float&gt;(character.advance));
+              }
+              else   
+              {
+                if (draw_it)
+                {
+                  glColor4f(top_color.r, top_color.g, top_color.b, top_color.a);
+                  glTexCoord2f(character.uv.left, character.uv.top);
+                  glVertex2f(x + static_cast&lt;float&gt;(character.pos.left),
+                             y + static_cast&lt;float&gt;(character.pos.top));
 
-                                glTexCoord2f(character.uv.right, character.uv.top);
-                                glVertex2f(x + static_cast&lt;float&gt;(character.pos.right), 
-                                           y + static_cast&lt;float&gt;(character.pos.top));
+                  glTexCoord2f(character.uv.right, character.uv.top);
+                  glVertex2f(x + static_cast&lt;float&gt;(character.pos.right), 
+                             y + static_cast&lt;float&gt;(character.pos.top));
 
-                                glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
-                                glTexCoord2f(character.uv.right, character.uv.bottom);
-                                glVertex2f(x + static_cast&lt;float&gt;(character.pos.right), 
-                                           y + static_cast&lt;float&gt;(character.pos.bottom));
+                  glColor4f(bottom_color.r, bottom_color.g, bottom_color.b, bottom_color.a);
+                  glTexCoord2f(character.uv.right, character.uv.bottom);
+                  glVertex2f(x + static_cast&lt;float&gt;(character.pos.right), 
+                             y + static_cast&lt;float&gt;(character.pos.bottom));
 
-                                glTexCoord2f(character.uv.left, character.uv.bottom);
-                                glVertex2f(x + static_cast&lt;float&gt;(character.pos.left), 
-                                           y + static_cast&lt;float&gt;(character.pos.bottom));
-                              }
-                            x_pos += character.advance;
-                          }
-                      }
-                  }
+                  glTexCoord2f(character.uv.left, character.uv.bottom);
+                  glVertex2f(x + static_cast&lt;float&gt;(character.pos.left), 
+                             y + static_cast&lt;float&gt;(character.pos.bottom));
+                }
+                x_pos += character.advance;
               }
-            break;
+            }
+          }
         }
+        break;
     }
+  }
 
   if (impl-&gt;max_scroll_offset == -1.0f)
-    {
-      impl-&gt;max_scroll_offset = static_cast&lt;float&gt;(y_pos) - impl-&gt;rect.get_height();
-      if (impl-&gt;max_scroll_offset &lt; 0)
-        impl-&gt;max_scroll_offset = 0;
-    }
+  {
+    impl-&gt;max_scroll_offset = static_cast&lt;float&gt;(y_pos) - impl-&gt;rect.get_height();
+    if (impl-&gt;max_scroll_offset &lt; 0)
+      impl-&gt;max_scroll_offset = 0;
+  }
 
   // FIXME: This is not correct, since the last command itself might
   // not be completly excecuted

Modified: trunk/windstille/src/display/texture.cpp
===================================================================
--- trunk/windstille/src/display/texture.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/texture.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -52,19 +52,19 @@
   }
 };
 
-Texture::Texture()
-  : impl()
+Texture::Texture() :
+  impl()
 {
 }
 
-Texture::Texture(const Pathname&amp; filename)
-  : impl()
+Texture::Texture(const Pathname&amp; filename) :
+  impl()
 {
   *this = TextureManager::current()-&gt;get(filename);
 }
 
-Texture::Texture(GLenum target, int width, int height, GLint format)
-  : impl(new TextureImpl())
+Texture::Texture(GLenum target, int width, int height, GLint format) :
+  impl(new TextureImpl())
 {
   impl-&gt;target = target;
   impl-&gt;width  = width;
@@ -89,8 +89,8 @@
   return (v &amp; (v-1)) == 0;
 }
 
-Texture::Texture(const SoftwareSurface&amp; image, GLint glformat)
-  : impl(new TextureImpl())
+Texture::Texture(const SoftwareSurface&amp; image, GLint glformat) :
+  impl(new TextureImpl())
 {
   impl-&gt;target = GL_TEXTURE_2D;
   impl-&gt;width  = image.get_width();
@@ -107,68 +107,68 @@
   // SDL_ConvertSurface(bmp, screen-&gt;format, SDL_SWSURFACE);
   
   try 
+  {
+    GLint maxt;
+    glGetIntegerv(GL_MAX_TEXTURE_SIZE, &amp;maxt);
+
+    if(image.get_width() &gt; maxt || image.get_height() &gt; maxt)
     {
-      GLint maxt;
-      glGetIntegerv(GL_MAX_TEXTURE_SIZE, &amp;maxt);
+      throw std::runtime_error(&quot;Texture size not supported&quot;);
+    }
 
-      if(image.get_width() &gt; maxt || image.get_height() &gt; maxt)
-        {
-          throw std::runtime_error(&quot;Texture size not supported&quot;);
-        }
+    GLint sdl_format;
 
-      GLint sdl_format;
+    if (image.get_bytes_per_pixel() == 3)
+    {
+      sdl_format = GL_RGB;
+    }
+    else if (image.get_bytes_per_pixel() == 4)
+    {
+      sdl_format = GL_RGBA;
+    }
+    else
+    {
+      throw std::runtime_error(&quot;Texture: Image format not supported&quot;);
+    }
 
-      if (image.get_bytes_per_pixel() == 3)
-        {
-          sdl_format = GL_RGB;
-        }
-      else if (image.get_bytes_per_pixel() == 4)
-        {
-          sdl_format = GL_RGBA;
-        }
-      else
-        {
-          throw std::runtime_error(&quot;Texture: Image format not supported&quot;);
-        }
+    OpenGLState state;
+    state.bind_texture(*this);
+    state.activate();
 
-      OpenGLState state;
-      state.bind_texture(*this);
-      state.activate();
+    glPixelStorei(GL_UNPACK_ALIGNMENT, 1);
+    glPixelStorei(GL_UNPACK_ROW_LENGTH, image.get_pitch() / image.get_bytes_per_pixel());
 
-      glPixelStorei(GL_UNPACK_ALIGNMENT, 1);
-      glPixelStorei(GL_UNPACK_ROW_LENGTH, image.get_pitch() / image.get_bytes_per_pixel());
-
-      if (0)
-      { // no mipmapping
-        glTexImage2D(impl-&gt;target, 0, glformat,
-                     image.get_width(), image.get_height(), 0, sdl_format,
-                     GL_UNSIGNED_BYTE, image.get_pixels());
+    if (0)
+    { // no mipmapping
+      glTexImage2D(impl-&gt;target, 0, glformat,
+                   image.get_width(), image.get_height(), 0, sdl_format,
+                   GL_UNSIGNED_BYTE, image.get_pixels());
         
-        glTexParameteri(impl-&gt;target, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
-        glTexParameteri(impl-&gt;target, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
-      }
-      else
-      { // use mipmapping
-        gluBuild2DMipmaps(impl-&gt;target, glformat,
-                          image.get_width(), image.get_height(), sdl_format,
-                          GL_UNSIGNED_BYTE, image.get_pixels());
+      glTexParameteri(impl-&gt;target, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
+      glTexParameteri(impl-&gt;target, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
+    }
+    else
+    { // use mipmapping
+      gluBuild2DMipmaps(impl-&gt;target, glformat,
+                        image.get_width(), image.get_height(), sdl_format,
+                        GL_UNSIGNED_BYTE, image.get_pixels());
         
-        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);
-        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
-      }
+      glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);
+      glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
+    }
 
-      assert_gl(&quot;creating texture&quot;);
+    assert_gl(&quot;creating texture&quot;);
 
-      glTexParameteri(impl-&gt;target, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
-      glTexParameteri(impl-&gt;target, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
-      glTexParameteri(impl-&gt;target, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);
+    glTexParameteri(impl-&gt;target, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
+    glTexParameteri(impl-&gt;target, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
+    glTexParameteri(impl-&gt;target, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);
 
-      assert_gl(&quot;setting texture parameters&quot;);
-    } 
+    assert_gl(&quot;setting texture parameters&quot;);
+  } 
   catch(...)
-    {
-      throw;
-    }
+  {
+    throw;
+  }
 }
 
 Texture::~Texture()
@@ -199,17 +199,17 @@
   GLint sdl_format;
 
   if (image.get_bytes_per_pixel() == 3)
-    {
-      sdl_format = GL_RGB;
-    }
+  {
+    sdl_format = GL_RGB;
+  }
   else if (image.get_bytes_per_pixel() == 4)
-    {
-      sdl_format = GL_RGBA;
-    }
+  {
+    sdl_format = GL_RGBA;
+  }
   else
-    {
-      throw std::runtime_error(&quot;Texture: Image format not supported&quot;);
-    }
+  {
+    throw std::runtime_error(&quot;Texture: Image format not supported&quot;);
+  }
 
   OpenGLState state;
   state.bind_texture(*this);

Modified: trunk/windstille/src/display/texture_manager.cpp
===================================================================
--- trunk/windstille/src/display/texture_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/texture_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,8 +21,8 @@
 #include &quot;display/texture.hpp&quot;
 #include &quot;display/software_surface.hpp&quot;
 
-TextureManager::TextureManager()
-  : textures()
+TextureManager::TextureManager() :
+  textures()
 {
 }
 
@@ -43,26 +43,26 @@
 {
   Textures::iterator i = textures.find(filename);
   if(i != textures.end())
-    {
-      return i-&gt;second;
-    }
+  {
+    return i-&gt;second;
+  }
   else
+  {
+    try 
     {
-      try 
-        {
-          SoftwareSurface image(filename);
-          Texture texture(image);
+      SoftwareSurface image(filename);
+      Texture texture(image);
 
-          textures.insert(std::make_pair(filename, texture));
+      textures.insert(std::make_pair(filename, texture));
 
-          return texture;
-        } 
-      catch(std::exception&amp; e) 
-        {
-          std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;
-          return get(Pathname(&quot;images/404.png&quot;));
-        }
+      return texture;
+    } 
+    catch(std::exception&amp; e) 
+    {
+      std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;
+      return get(Pathname(&quot;images/404.png&quot;));
     }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/display/texture_packer.cpp
===================================================================
--- trunk/windstille/src/display/texture_packer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/display/texture_packer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -47,36 +47,36 @@
   {
     if (size.width  &lt;= rect.get_width() &amp;&amp;
         size.height &lt;= rect.get_height())
+    {
+      if (!used)
       {
-        if (!used)
-          {
-            used = true;
-            out_rect = Rect(Point(rect.left, rect.top), size);
+        used = true;
+        out_rect = Rect(Point(rect.left, rect.top), size);
 
-            // FIXME: Make this alterate between horizontal and
-            // vertical splitting or chose whichever split options
-            // leads to less 'ugly' rectangle (how much different does
-            // this make in terms of packing density?)
-            left.reset(new TextureSpace(Rect(out_rect.left,  out_rect.bottom,
-                                             out_rect.right, rect.bottom)));
+        // FIXME: Make this alterate between horizontal and
+        // vertical splitting or chose whichever split options
+        // leads to less 'ugly' rectangle (how much different does
+        // this make in terms of packing density?)
+        left.reset(new TextureSpace(Rect(out_rect.left,  out_rect.bottom,
+                                         out_rect.right, rect.bottom)));
 
-            right.reset(new TextureSpace(Rect(out_rect.right, out_rect.top, 
-                                              rect.right, rect.bottom)));
+        right.reset(new TextureSpace(Rect(out_rect.right, out_rect.top, 
+                                          rect.right, rect.bottom)));
 
-            return true;
-          }
-        else
-          {
-            return
-              left-&gt;allocate(size, out_rect) ||
-              right-&gt;allocate(size, out_rect);
-          }
+        return true;
       }
-    else
+      else
       {
-        // Size doesn't fit here
-        return false;
+        return
+          left-&gt;allocate(size, out_rect) ||
+          right-&gt;allocate(size, out_rect);
       }
+    }
+    else
+    {
+      // Size doesn't fit here
+      return false;
+    }
   }
 
 private:
@@ -105,14 +105,14 @@
   bool allocate(const Size&amp; size, Rect&amp; out_rect, Texture&amp; out_texture)
   {
     if (space.allocate(size, out_rect))
-      {
-        out_texture = texture;
-        return true;
-      }
+    {
+      out_texture = texture;
+      return true;
+    }
     else
-      {
-        return false;
-      }
+    {
+      return false;
+    }
   }
 
 private:
@@ -120,9 +120,9 @@
   TexturePackerTexture&amp; operator=(const TexturePackerTexture&amp;);
 };
 
-TexturePacker::TexturePacker(const Size&amp; texture_size_)
-  : texture_size(texture_size_),
-    textures()
+TexturePacker::TexturePacker(const Size&amp; texture_size_) :
+  texture_size(texture_size_),
+  textures()
 {
 }
 
@@ -137,12 +137,12 @@
 TexturePacker::allocate(const Size&amp; size, Rect&amp; rect, Texture&amp; texture)
 {
   for(Textures::iterator i = textures.begin(); i != textures.end(); ++i)
+  {
+    if ((*i)-&gt;allocate(size, rect, texture))
     {
-      if ((*i)-&gt;allocate(size, rect, texture))
-        {
-          return true;
-        }
+      return true;
     }
+  }
 
   textures.push_back(new TexturePackerTexture(texture_size));
   return textures.back()-&gt;allocate(size, rect, texture);
@@ -159,61 +159,61 @@
   Texture texture;
 
   if (!allocate(size, rect, texture))
-    {
-      throw std::runtime_error(&quot;TexturePacker::upload: texture space allocation failed&quot;);
-    }
+  {
+    throw std::runtime_error(&quot;TexturePacker::upload: texture space allocation failed&quot;);
+  }
   else
-    {
-      // duplicate border pixel
+  {
+    // duplicate border pixel
 
-      // top
-      texture.put(surface, Rect(Point(0, 0), Size(surface.get_width(), 1)), 
-                  rect.left+1, rect.top);
-      // bottom
-      texture.put(surface, Rect(Point(0, surface.get_height()-1), Size(surface.get_width(), 1)), 
-                  rect.left+1, rect.bottom-1);
-      // left
-      texture.put(surface, Rect(Point(0, 0), Size(1, surface.get_height())), 
-                  rect.left, rect.top+1);
-      // right
-      texture.put(surface, Rect(Point(surface.get_width()-1, 0), Size(1, surface.get_height())),
-                  rect.right-1, rect.top+1);
+    // top
+    texture.put(surface, Rect(Point(0, 0), Size(surface.get_width(), 1)), 
+                rect.left+1, rect.top);
+    // bottom
+    texture.put(surface, Rect(Point(0, surface.get_height()-1), Size(surface.get_width(), 1)), 
+                rect.left+1, rect.bottom-1);
+    // left
+    texture.put(surface, Rect(Point(0, 0), Size(1, surface.get_height())), 
+                rect.left, rect.top+1);
+    // right
+    texture.put(surface, Rect(Point(surface.get_width()-1, 0), Size(1, surface.get_height())),
+                rect.right-1, rect.top+1);
 
-      // duplicate corner pixels
-      texture.put(surface, Rect(Point(0, 0), Size(1, 1)), 
-                  rect.left, rect.top);     
-      texture.put(surface, Rect(Point(surface.get_width()-1, 0), Size(1, 1)), 
-                  rect.right-1, rect.top);
-      texture.put(surface, Rect(Point(surface.get_width()-1, surface.get_height()-1), Size(1, 1)), 
-                  rect.right-1, rect.bottom-1);
-      texture.put(surface, Rect(Point(0, surface.get_height()-1), Size(1, 1)),
-                  rect.left, rect.bottom-1);
+    // duplicate corner pixels
+    texture.put(surface, Rect(Point(0, 0), Size(1, 1)), 
+                rect.left, rect.top);     
+    texture.put(surface, Rect(Point(surface.get_width()-1, 0), Size(1, 1)), 
+                rect.right-1, rect.top);
+    texture.put(surface, Rect(Point(surface.get_width()-1, surface.get_height()-1), Size(1, 1)), 
+                rect.right-1, rect.bottom-1);
+    texture.put(surface, Rect(Point(0, surface.get_height()-1), Size(1, 1)),
+                rect.left, rect.bottom-1);
 
-      // draw the main surface
-      texture.put(surface, rect.left+1, rect.top+1);
+    // draw the main surface
+    texture.put(surface, rect.left+1, rect.top+1);
 
-      return Surface(texture,
-                     Rectf(static_cast&lt;float&gt;(rect.left+1)   / static_cast&lt;float&gt;(texture.get_width()),
-                           static_cast&lt;float&gt;(rect.top+1)    / static_cast&lt;float&gt;(texture.get_height()),
-                           static_cast&lt;float&gt;(rect.right-1)  / static_cast&lt;float&gt;(texture.get_width()), 
-                           static_cast&lt;float&gt;(rect.bottom-1) / static_cast&lt;float&gt;(texture.get_height())),
-                     Sizef(static_cast&lt;float&gt;(surface.get_width()), static_cast&lt;float&gt;(surface.get_height())));
-    }
+    return Surface(texture,
+                   Rectf(static_cast&lt;float&gt;(rect.left+1)   / static_cast&lt;float&gt;(texture.get_width()),
+                         static_cast&lt;float&gt;(rect.top+1)    / static_cast&lt;float&gt;(texture.get_height()),
+                         static_cast&lt;float&gt;(rect.right-1)  / static_cast&lt;float&gt;(texture.get_width()), 
+                         static_cast&lt;float&gt;(rect.bottom-1) / static_cast&lt;float&gt;(texture.get_height())),
+                   Sizef(static_cast&lt;float&gt;(surface.get_width()), static_cast&lt;float&gt;(surface.get_height())));
+  }
 }
 
 void
 TexturePacker::save_all_as_png() const
 {
   for(Textures::const_iterator i = textures.begin(); i != textures.end(); ++i)
-    {
-      Texture texture = (*i)-&gt;get_texture();
-      SoftwareSurface surface = texture.get_software_surface();
+  {
+    Texture texture = (*i)-&gt;get_texture();
+    SoftwareSurface surface = texture.get_software_surface();
 
-      char filename[1024];
-      sprintf(filename, &quot;/tmp/texture_packer%04d.png&quot;, int(i - textures.begin()));
-      std::cout &lt;&lt; &quot;Saving: &quot; &lt;&lt; filename &lt;&lt; std::endl;
-      surface.save_png(filename);
-    }
+    char filename[1024];
+    sprintf(filename, &quot;/tmp/texture_packer%04d.png&quot;, int(i - textures.begin()));
+    std::cout &lt;&lt; &quot;Saving: &quot; &lt;&lt; filename &lt;&lt; std::endl;
+    surface.save_png(filename);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/editor/control_point.cpp
===================================================================
--- trunk/windstille/src/editor/control_point.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/control_point.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -27,10 +27,10 @@
   return ControlPointHandle(new ControlPoint(Surface(Pathname(&quot;editor/handle.png&quot;)), pos));
 }
 
-ControlPoint::ControlPoint(const Surface&amp; surface_, const Vector2f&amp; pos_)
-  : surface(surface_),
-    pos(pos_),
-    offset()
+ControlPoint::ControlPoint(const Surface&amp; surface_, const Vector2f&amp; pos_) :
+  surface(surface_),
+  pos(pos_),
+  offset()
 {
 }
 

Modified: trunk/windstille/src/editor/decal_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/decal_object_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/decal_object_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -39,17 +39,17 @@
   return ObjectModelHandle(new DecalObjectModel(name, pos, path, type));
 }
 
-DecalObjectModel::DecalObjectModel(const FileReader&amp; reader)
-  : ObjectModel(reader),
-    path(),
-    surface(),
-    software_surface(),
-    type(),
-    scale(1.0f, 1.0f),
-    angle(0.0f),
-    hflip(false),
-    vflip(false),
-    m_drawable()
+DecalObjectModel::DecalObjectModel(const FileReader&amp; reader) :
+  ObjectModel(reader),
+  path(),
+  surface(),
+  software_surface(),
+  type(),
+  scale(1.0f, 1.0f),
+  angle(0.0f),
+  hflip(false),
+  vflip(false),
+  m_drawable()
 {
   int map_type = 0;
   reader.get(&quot;path&quot;, path);
@@ -65,31 +65,31 @@
 }
 
 DecalObjectModel::DecalObjectModel(const std::string&amp; /*name*/, const Vector2f&amp; rel_pos_, 
-                                   const std::string&amp; path_, MapType type_)
-  : ObjectModel(&quot;DecalObjectModel&quot;, rel_pos_),
-    path(path_),
-    surface(Pathname(path_)),
-    software_surface(Pathname(path_)),
-    type(type_),
-    scale(1.0f, 1.0f),
-    angle(0.0f),
-    hflip(false),
-    vflip(false),
-    m_drawable()
+                                   const std::string&amp; path_, MapType type_) :
+  ObjectModel(&quot;DecalObjectModel&quot;, rel_pos_),
+  path(path_),
+  surface(Pathname(path_)),
+  software_surface(Pathname(path_)),
+  type(type_),
+  scale(1.0f, 1.0f),
+  angle(0.0f),
+  hflip(false),
+  vflip(false),
+  m_drawable()
 {
 }
 
-DecalObjectModel::DecalObjectModel(const DecalObjectModel&amp; rhs)
-  : ObjectModel(rhs),
-    path(rhs.path),
-    surface(rhs.surface),
-    software_surface(rhs.software_surface),
-    type(rhs.type),
-    scale(rhs.scale),
-    angle(rhs.angle),
-    hflip(rhs.hflip),
-    vflip(rhs.vflip),
-    m_drawable()
+DecalObjectModel::DecalObjectModel(const DecalObjectModel&amp; rhs) :
+  ObjectModel(rhs),
+  path(rhs.path),
+  surface(rhs.surface),
+  software_surface(rhs.software_surface),
+  type(rhs.type),
+  scale(rhs.scale),
+  angle(rhs.angle),
+  hflip(rhs.hflip),
+  vflip(rhs.vflip),
+  m_drawable()
 {
 }
 

Modified: trunk/windstille/src/editor/decal_rotate_control_point.cpp
===================================================================
--- trunk/windstille/src/editor/decal_rotate_control_point.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/decal_rotate_control_point.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,12 +19,12 @@
 #include &quot;display/scene_context.hpp&quot;
 #include &quot;editor/decal_rotate_control_point.hpp&quot;
 
-DecalRotateControlPoint::DecalRotateControlPoint(DecalObjectModel* object_, float ctrl_angle_, const Vector2f&amp; pos_)
-  : ControlPoint(Surface(Pathname(&quot;editor/rotate_handle.png&quot;)), pos_),
-    object(object_),
-    ctrl_angle(ctrl_angle_),
-    orig_angle(object-&gt;get_angle()),
-    center(object-&gt;get_world_pos())
+DecalRotateControlPoint::DecalRotateControlPoint(DecalObjectModel* object_, float ctrl_angle_, const Vector2f&amp; pos_) :
+  ControlPoint(Surface(Pathname(&quot;editor/rotate_handle.png&quot;)), pos_),
+  object(object_),
+  ctrl_angle(ctrl_angle_),
+  orig_angle(object-&gt;get_angle()),
+  center(object-&gt;get_world_pos())
 {
 }
 

Modified: trunk/windstille/src/editor/decal_scale_control_point.cpp
===================================================================
--- trunk/windstille/src/editor/decal_scale_control_point.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/decal_scale_control_point.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -20,13 +20,13 @@
 #include &quot;editor/decal_scale_control_point.hpp&quot;
 
 DecalScaleControlPoint::DecalScaleControlPoint(DecalObjectModel* object_, float ctrl_angle_, const Vector2f&amp; pos_, 
-                                               bool x_scale_, bool y_scale_)
-  : ControlPoint(Surface(Pathname(&quot;editor/scale_handle.png&quot;)), pos_),
-    object(object_),
-    ctrl_angle(ctrl_angle_),
-    orig_scale(object_-&gt;get_scale()),
-    x_scale(x_scale_),
-    y_scale(y_scale_)
+                                               bool x_scale_, bool y_scale_) :
+  ControlPoint(Surface(Pathname(&quot;editor/scale_handle.png&quot;)), pos_),
+  object(object_),
+  ctrl_angle(ctrl_angle_),
+  orig_scale(object_-&gt;get_scale()),
+  x_scale(x_scale_),
+  y_scale(y_scale_)
 {}
 
 void

Modified: trunk/windstille/src/editor/document.cpp
===================================================================
--- trunk/windstille/src/editor/document.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/document.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -36,14 +36,14 @@
 #include &quot;editor/object_commands.hpp&quot;
 #include &quot;editor/timeline_commands.hpp&quot;
 
-Document::Document()
-  : m_undo_manager(new UndoManager()),
-    m_sector_model(new SectorModel()),
-    m_group_command(),
-    m_group_command_count(0),
-    m_selection(Selection::create()),
-    m_control_points(),
-    m_sig_on_change()    
+Document::Document() :
+  m_undo_manager(new UndoManager()),
+  m_sector_model(new SectorModel()),
+  m_group_command(),
+  m_group_command_count(0),
+  m_selection(Selection::create()),
+  m_control_points(),
+  m_sig_on_change()    
 {
   m_sector_model-&gt;get_layer_tree()-&gt;signal_row_changed().connect(sigc::mem_fun(*this, &amp;Document::on_row_changed));
   m_sector_model-&gt;get_layer_tree()-&gt;signal_row_deleted().connect(sigc::mem_fun(*this, &amp;Document::on_row_deleted));
@@ -52,14 +52,14 @@
   m_sector_model-&gt;get_layer_tree()-&gt;signal_rows_reordered().connect(sigc::mem_fun(*this, &amp;Document::on_rows_reordered));
 }
 
-Document::Document(const std::string&amp; filename)
-  : m_undo_manager(new UndoManager()),
-    m_sector_model(new SectorModel(filename)),
-    m_group_command(),
-    m_group_command_count(0),
-    m_selection(Selection::create()),
-    m_control_points(),
-    m_sig_on_change()
+Document::Document(const std::string&amp; filename) :
+  m_undo_manager(new UndoManager()),
+  m_sector_model(new SectorModel(filename)),
+  m_group_command(),
+  m_group_command_count(0),
+  m_selection(Selection::create()),
+  m_control_points(),
+  m_sig_on_change()
 {
   m_sector_model-&gt;get_layer_tree()-&gt;signal_row_changed().connect(sigc::mem_fun(*this, &amp;Document::on_row_changed));
   m_sector_model-&gt;get_layer_tree()-&gt;signal_row_deleted().connect(sigc::mem_fun(*this, &amp;Document::on_row_deleted));

Modified: trunk/windstille/src/editor/editor_window.cpp
===================================================================
--- trunk/windstille/src/editor/editor_window.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/editor_window.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -54,44 +54,44 @@
 #include &quot;editor/timeline_sound_object.hpp&quot;
 #include &quot;editor/timeline_widget.hpp&quot;
 
-EditorWindow::EditorWindow(const Glib::RefPtr&lt;const Gdk::GL::Config&gt;&amp; glconfig_)
-  : vbox(),
-    sidebar_vbox(),
-    hbox(),
-    hpaned(),
-    vpaned(),
-    status_hbox(),
-    status_label(),
-    status(),
-    ui_manager(Gtk::UIManager::create()),
-    action_group(Gtk::ActionGroup::create()),
-    share_list(),
-    glconfig(glconfig_),
-    notebook(),
-    object_selector(*this),
-    layer_manager(*this),
-    minimap_widget(glconfig_),
-    select_tool_action(),
-    navgraph_insert_tool_action(),
-    navgraph_select_tool_action(),
-    zoom_tool_action(),
-    toggle_color_layer(),
-    toggle_light_layer(),
-    toggle_highlight_layer(),
-    toggle_control_layer(),
-    background_layer(),
-    visible_layer(),
-    grid_layer(),
-    play_action(),
-    snap_action(),
-    select_tool(new SelectTool()),
-    navgraph_insert_tool(new NavgraphInsertTool()),
-    zoom_tool(new ZoomTool()),
-    scroll_tool(new ScrollTool()),
-    current_tool(select_tool.get()),
-    layer_widget(),
-    timeout_connection(),
-    clipboard()
+EditorWindow::EditorWindow(const Glib::RefPtr&lt;const Gdk::GL::Config&gt;&amp; glconfig_) :
+  vbox(),
+  sidebar_vbox(),
+  hbox(),
+  hpaned(),
+  vpaned(),
+  status_hbox(),
+  status_label(),
+  status(),
+  ui_manager(Gtk::UIManager::create()),
+  action_group(Gtk::ActionGroup::create()),
+  share_list(),
+  glconfig(glconfig_),
+  notebook(),
+  object_selector(*this),
+  layer_manager(*this),
+  minimap_widget(glconfig_),
+  select_tool_action(),
+  navgraph_insert_tool_action(),
+  navgraph_select_tool_action(),
+  zoom_tool_action(),
+  toggle_color_layer(),
+  toggle_light_layer(),
+  toggle_highlight_layer(),
+  toggle_control_layer(),
+  background_layer(),
+  visible_layer(),
+  grid_layer(),
+  play_action(),
+  snap_action(),
+  select_tool(new SelectTool()),
+  navgraph_insert_tool(new NavgraphInsertTool()),
+  zoom_tool(new ZoomTool()),
+  scroll_tool(new ScrollTool()),
+  current_tool(select_tool.get()),
+  layer_widget(),
+  timeout_connection(),
+  clipboard()
 {
   set_title(&quot;Windstille Editor&quot;);
   set_default_size(1280, 800);

Modified: trunk/windstille/src/editor/layer.cpp
===================================================================
--- trunk/windstille/src/editor/layer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/layer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,12 +21,12 @@
 #include &quot;editor/layer_manager_columns.hpp&quot;
 #include &quot;editor/sector_model.hpp&quot;
 
-Layer::Layer(SectorModel&amp; sector)
-  : m_sector(sector),
-    objects(),
-    name(),
-    visible(true),
-    locked(false)
+Layer::Layer(SectorModel&amp; sector) :
+  m_sector(sector),
+  objects(),
+  name(),
+  visible(true),
+  locked(false)
 {
 }
 

Modified: trunk/windstille/src/editor/layer_manager.cpp
===================================================================
--- trunk/windstille/src/editor/layer_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/layer_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -30,12 +30,12 @@
 #include &quot;editor/sector_model.hpp&quot;
 #include &quot;editor/layer_manager_columns.hpp&quot;
 
-LayerManager::LayerManager(EditorWindow&amp; editor_)
-  : editor(editor_),
-    label(&quot;Layer Manager&quot;, Gtk::ALIGN_LEFT),
-    scrolled(),
-    treeview(),
-    auto_lock()
+LayerManager::LayerManager(EditorWindow&amp; editor_) :
+  editor(editor_),
+  label(&quot;Layer Manager&quot;, Gtk::ALIGN_LEFT),
+  scrolled(),
+  treeview(),
+  auto_lock()
 {
   treeview.set_headers_clickable();
   treeview.set_headers_visible(true);

Modified: trunk/windstille/src/editor/layer_widget.cpp
===================================================================
--- trunk/windstille/src/editor/layer_widget.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/layer_widget.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,10 +23,10 @@
 #include &quot;editor/select_mask.hpp&quot;
 #include &quot;editor/layer_widget.hpp&quot;
 
-LayerWidget::LayerWidget()
-  : table(2, 9, false),
-    buttons(),
-    signal_layer_toggle()
+LayerWidget::LayerWidget() :
+  table(2, 9, false),
+  buttons(),
+  signal_layer_toggle()
 {
   int layer_number = 0;
   for(int y = 0; y &lt; 2; ++y)

Modified: trunk/windstille/src/editor/navgraph_edge_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/navgraph_edge_object_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/navgraph_edge_object_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -25,11 +25,11 @@
 #include &quot;scenegraph/vertex_array_drawable.hpp&quot;
 
 NavGraphEdgeObjectModel::NavGraphEdgeObjectModel(boost::shared_ptr&lt;NavGraphNodeObjectModel&gt; lhs,
-                                                 boost::shared_ptr&lt;NavGraphNodeObjectModel&gt; rhs)
-  : ObjectModel(&quot;NavGraphEdgeObjectModel&quot;, Vector2f()),
-    m_lhs(lhs),
-    m_rhs(rhs),
-    m_drawable()
+                                                 boost::shared_ptr&lt;NavGraphNodeObjectModel&gt; rhs) :
+  ObjectModel(&quot;NavGraphEdgeObjectModel&quot;, Vector2f()),
+  m_lhs(lhs),
+  m_rhs(rhs),
+  m_drawable()
 {
   if (m_lhs == m_rhs)
   {

Modified: trunk/windstille/src/editor/navgraph_insert_tool.cpp
===================================================================
--- trunk/windstille/src/editor/navgraph_insert_tool.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/navgraph_insert_tool.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,13 +28,13 @@
 #include &quot;editor/navgraph_node_object_model.hpp&quot;
 #include &quot;editor/navgraph_edge_object_model.hpp&quot;
 
-NavgraphInsertTool::NavgraphInsertTool()
-  : mouse_pos(),
-    mode(NO_MODE),
-    last_node(),
-    connection_node(),
-    mouse_over_node(),
-    mouse_over_edge()
+NavgraphInsertTool::NavgraphInsertTool() :
+  mouse_pos(),
+  mode(NO_MODE),
+  last_node(),
+  connection_node(),
+  mouse_over_node(),
+  mouse_over_edge()
 {
 }
 

Modified: trunk/windstille/src/editor/navgraph_node_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/navgraph_node_object_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/navgraph_node_object_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,15 +24,15 @@
 #include &quot;navigation/node.hpp&quot;
 #include &quot;editor/constants.hpp&quot;
 
-NavGraphNodeObjectModel::NavGraphNodeObjectModel(const FileReader&amp; reader)
-  : ObjectModel(reader),
-    m_drawable()
+NavGraphNodeObjectModel::NavGraphNodeObjectModel(const FileReader&amp; reader) :
+  ObjectModel(reader),
+  m_drawable()
 {
 }
 
-NavGraphNodeObjectModel::NavGraphNodeObjectModel(const Vector2f&amp; pos)
-  : ObjectModel(&quot;NavGraphNodeObjectModel&quot;, pos),
-    m_drawable()
+NavGraphNodeObjectModel::NavGraphNodeObjectModel(const Vector2f&amp; pos) :
+  ObjectModel(&quot;NavGraphNodeObjectModel&quot;, pos),
+  m_drawable()
 {
 }
 
@@ -98,14 +98,14 @@
   SnapData snap;
 
   if (fabs(snap_x) &lt; g_snap_threshold)
-    {
-      snap.set_x(snap_x);
-    }
+  {
+    snap.set_x(snap_x);
+  }
 
   if (fabs(snap_y) &lt; g_snap_threshold)
-    {
-      snap.set_y(snap_y);
-    }
+  {
+    snap.set_y(snap_y);
+  }
 
   return snap;
 }

Modified: trunk/windstille/src/editor/navigation_graph_model.cpp
===================================================================
--- trunk/windstille/src/editor/navigation_graph_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/navigation_graph_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,10 +24,10 @@
 #include &quot;navigation/navigation_graph.hpp&quot;
 #include &quot;util/file_reader.hpp&quot;
 
-NavigationGraphModel::NavigationGraphModel(SectorModel&amp; sector)
-  : m_sector(sector),
-    m_nodes(),
-    m_edges()   
+NavigationGraphModel::NavigationGraphModel(SectorModel&amp; sector) :
+  m_sector(sector),
+  m_nodes(),
+  m_edges()   
 {
 }
 

Modified: trunk/windstille/src/editor/node_selection.cpp
===================================================================
--- trunk/windstille/src/editor/node_selection.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/node_selection.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,8 +18,8 @@
 
 #include &quot;editor/node_selection.hpp&quot;
 
-NodeSelection::NodeSelection()
-  : nodes()
+NodeSelection::NodeSelection() :
+  nodes()
 {
 }
 

Modified: trunk/windstille/src/editor/object_model.cpp
===================================================================
--- trunk/windstille/src/editor/object_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/object_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -27,19 +27,19 @@
 #include &quot;editor/editor_window.hpp&quot;
 #include &quot;util/file_reader.hpp&quot;
 
-ObjectModel::ObjectModel(const std::string&amp; name_, const Vector2f&amp; rel_pos_)
-  : name(name_),
-    rel_pos(rel_pos_),
-    select_mask(),
-    parent_ptr()
+ObjectModel::ObjectModel(const std::string&amp; name_, const Vector2f&amp; rel_pos_) :
+  name(name_),
+  rel_pos(rel_pos_),
+  select_mask(),
+  parent_ptr()
 {
 }
 
-ObjectModel::ObjectModel(const FileReader&amp; reader)
-  : name(),
-    rel_pos(),
-    select_mask(),
-    parent_ptr()
+ObjectModel::ObjectModel(const FileReader&amp; reader) :
+  name(),
+  rel_pos(),
+  select_mask(),
+  parent_ptr()
 {
   reader.get(&quot;name&quot;, name);
   reader.get(&quot;pos&quot;,  rel_pos);

Modified: trunk/windstille/src/editor/object_selector.cpp
===================================================================
--- trunk/windstille/src/editor/object_selector.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/object_selector.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -64,16 +64,16 @@
 
 ObjectSelector::Columns* ObjectSelector::Columns::instance_ = 0;
 
-ObjectSelector::ObjectSelector(EditorWindow&amp; editor_)
-  : editor(editor_),
-    label(&quot;Object Selector&quot;, Gtk::ALIGN_LEFT),
-    scrolled(),
-    iconview(),
-    list_store(),
-    list_filter(),
-    filter_box(),
-    filter_entries(),
-    filter_mask(OBJECT_GROUP_ALL)
+ObjectSelector::ObjectSelector(EditorWindow&amp; editor_) :
+  editor(editor_),
+  label(&quot;Object Selector&quot;, Gtk::ALIGN_LEFT),
+  scrolled(),
+  iconview(),
+  list_store(),
+  list_filter(),
+  filter_box(),
+  filter_entries(),
+  filter_mask(OBJECT_GROUP_ALL)
 {
 #if 0
   Glib::RefPtr&lt;Gtk::UIManager&gt;   ui_manager   = editor.get_ui_manager();

Modified: trunk/windstille/src/editor/particle_system_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/particle_system_object_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/particle_system_object_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,9 +19,9 @@
 #include &quot;particles/particle_system.hpp&quot;
 #include &quot;editor/particle_system_object_model.hpp&quot;
 
-ParticleSystemObjectModel::ParticleSystemObjectModel(const Vector2f&amp; pos)
-  : ObjectModel(&quot;ParticleSystem&quot;, pos),
-    systems()
+ParticleSystemObjectModel::ParticleSystemObjectModel(const Vector2f&amp; pos) :
+  ObjectModel(&quot;ParticleSystem&quot;, pos),
+  systems()
 {
 }
 

Modified: trunk/windstille/src/editor/scroll_tool.cpp
===================================================================
--- trunk/windstille/src/editor/scroll_tool.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/scroll_tool.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -20,10 +20,10 @@
 #include &quot;editor/windstille_widget.hpp&quot;
 #include &quot;editor/scroll_tool.hpp&quot;
 
-ScrollTool::ScrollTool()
-  : orig_state(),
-    orig_click(),
-    mode(NO_MODE)
+ScrollTool::ScrollTool() :
+  orig_state(),
+  orig_click(),
+  mode(NO_MODE)
 {
 }
 

Modified: trunk/windstille/src/editor/sector_model.cpp
===================================================================
--- trunk/windstille/src/editor/sector_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/sector_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -52,11 +52,11 @@
   SectorModelBuilder(filename, *this);
 }
 
-SectorModel::SectorModel()
-  : nav_graph(new NavigationGraphModel(*this)),
-    layer_tree(Gtk::ListStore::create(LayerManagerColumns::instance())),
-    m_timeline(new Timeline()),
-    ambient_color()
+SectorModel::SectorModel() :
+  nav_graph(new NavigationGraphModel(*this)),
+  layer_tree(Gtk::ListStore::create(LayerManagerColumns::instance())),
+  m_timeline(new Timeline()),
+  ambient_color()
 {
   register_callbacks();
 

Modified: trunk/windstille/src/editor/sector_model_builder.cpp
===================================================================
--- trunk/windstille/src/editor/sector_model_builder.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/sector_model_builder.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,10 +28,10 @@
 #include &quot;editor/sector_model.hpp&quot;
 #include &quot;util/file_reader.hpp&quot;
 
-SectorModelBuilder::SectorModelBuilder(const std::string&amp; filename, SectorModel&amp; sector)
-  : m_sector(sector),
-    m_id_table(),
-    m_parent_table()
+SectorModelBuilder::SectorModelBuilder(const std::string&amp; filename, SectorModel&amp; sector) :
+  m_sector(sector),
+  m_id_table(),
+  m_parent_table()
 {
   m_sector.get_layer_tree()-&gt;clear();
 

Modified: trunk/windstille/src/editor/select_tool.cpp
===================================================================
--- trunk/windstille/src/editor/select_tool.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/select_tool.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -27,13 +27,13 @@
 static const guint32 MOVE_TIMEOUT = 100;
 static const int MOVE_THRESHOLD = 16;
 
-SelectTool::SelectTool()
-  : click_pos(),
-    rect(),
-    selection(),
-    ctrl_point(),
-    start_time(),
-    mode(NO_MODE)    
+SelectTool::SelectTool() :
+  click_pos(),
+  rect(),
+  selection(),
+  ctrl_point(),
+  start_time(),
+  mode(NO_MODE)    
 {
 }
 

Modified: trunk/windstille/src/editor/selection.cpp
===================================================================
--- trunk/windstille/src/editor/selection.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/selection.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,12 +23,12 @@
 #include &quot;editor/editor_window.hpp&quot;
 #include &quot;editor/selection.hpp&quot;
 
-Selection::Selection()
-  : objects(),
-    object_orig_poss(),
-    non_moveable_objects(),
-    moving(false),
-    signal_changed()
+Selection::Selection() :
+  objects(),
+  object_orig_poss(),
+  non_moveable_objects(),
+  moving(false),
+  signal_changed()
 {
 }
 

Modified: trunk/windstille/src/editor/sprite_object_model.cpp
===================================================================
--- trunk/windstille/src/editor/sprite_object_model.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/sprite_object_model.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,10 +21,10 @@
 #include &quot;editor/sprite_object_model.hpp&quot;
 
 SpriteObjectModel::SpriteObjectModel(const std::string&amp; name_, const Vector2f&amp; rel_pos_,
-                                     const std::string&amp; path_)
-  : ObjectModel(name_, rel_pos_),
-    path(path_),
-    sprite(Pathname(path_))
+                                     const std::string&amp; path_) :
+  ObjectModel(name_, rel_pos_),
+  path(path_),
+  sprite(Pathname(path_))
 {
 }
 

Modified: trunk/windstille/src/editor/timeline.cpp
===================================================================
--- trunk/windstille/src/editor/timeline.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/timeline.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,8 +21,8 @@
 #include &quot;editor/timeline_object_layer.hpp&quot;
 #include &quot;editor/timeline_layer.hpp&quot;
 
-Timeline::Timeline()
-  : m_layers()
+Timeline::Timeline() :
+  m_layers()
 {
 }
 

Modified: trunk/windstille/src/editor/timeline_layer.cpp
===================================================================
--- trunk/windstille/src/editor/timeline_layer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/timeline_layer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,9 +23,9 @@
 #include &quot;util/file_writer.hpp&quot;
 #include &quot;editor/timeline_object.hpp&quot;
 
-TimelineLayer::TimelineLayer(const std::string&amp; name)
-  : m_name(name),
-    m_objects()
+TimelineLayer::TimelineLayer(const std::string&amp; name) :
+  m_name(name),
+  m_objects()
 {
 }
 

Modified: trunk/windstille/src/editor/timeline_object_layer.cpp
===================================================================
--- trunk/windstille/src/editor/timeline_object_layer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/timeline_object_layer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,10 +18,10 @@
 
 #include &quot;timeline_object_layer.hpp&quot;
 
-TimelineObjectLayer::TimelineObjectLayer(ObjectModelHandle object, TimelineProperty property)
-  : TimelineLayer(&quot;TimelineObjectLayer&quot;),
-    m_object(object),
-    m_property(property)
+TimelineObjectLayer::TimelineObjectLayer(ObjectModelHandle object, TimelineProperty property) :
+  TimelineLayer(&quot;TimelineObjectLayer&quot;),
+  m_object(object),
+  m_property(property)
 {
 }
 

Modified: trunk/windstille/src/editor/undo_manager.cpp
===================================================================
--- trunk/windstille/src/editor/undo_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/undo_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,9 +18,9 @@
 
 #include &quot;editor/undo_manager.hpp&quot;
 
-UndoManager::UndoManager()
-  : undo_stack(),
-    redo_stack()
+UndoManager::UndoManager() :
+  undo_stack(),
+  redo_stack()
 {
 }
 

Modified: trunk/windstille/src/editor/windstille_widget.cpp
===================================================================
--- trunk/windstille/src/editor/windstille_widget.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/windstille_widget.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -44,21 +44,21 @@
 
 WindstilleWidget::WindstilleWidget(EditorWindow&amp; editor_,
                                    const Glib::RefPtr&lt;const Gdk::GL::Config&gt;&amp;  glconfig,
-                                   const Glib::RefPtr&lt;const Gdk::GL::Context&gt;&amp; share_list)
-  : editor(editor_),
-    m_document(new Document),
-    m_scene_graph(new SceneGraph()),
-    m_rebuild_scene_graph(true),
-    filename(),
-    state(),
-    compositor(),
-    sc(),
-    map_type(DecalObjectModel::COLORMAP),
-    background_pattern(),
-    select_mask(1),
-    draw_background_pattern(true),
-    draw_only_active_layers(true),
-    grid_enabled(false)
+                                   const Glib::RefPtr&lt;const Gdk::GL::Context&gt;&amp; share_list) :
+  editor(editor_),
+  m_document(new Document),
+  m_scene_graph(new SceneGraph()),
+  m_rebuild_scene_graph(true),
+  filename(),
+  state(),
+  compositor(),
+  sc(),
+  map_type(DecalObjectModel::COLORMAP),
+  background_pattern(),
+  select_mask(1),
+  draw_background_pattern(true),
+  draw_only_active_layers(true),
+  grid_enabled(false)
 {
   set_gl_capability(glconfig, share_list);
 

Modified: trunk/windstille/src/editor/zoom_tool.cpp
===================================================================
--- trunk/windstille/src/editor/zoom_tool.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/editor/zoom_tool.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,10 +22,10 @@
 #include &quot;display/color.hpp&quot;
 #include &quot;editor/windstille_widget.hpp&quot;
 
-ZoomTool::ZoomTool()
-  : click_pos(),
-    mouse_pos(),
-    mode(NO_MODE)
+ZoomTool::ZoomTool() :
+  click_pos(),
+  mouse_pos(),
+  mode(NO_MODE)
 {
 }
 

Modified: trunk/windstille/src/engine/camera.cpp
===================================================================
--- trunk/windstille/src/engine/camera.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/camera.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -45,26 +45,26 @@
 {
   float length_so_far = 0.0f;
   for(std::vector&lt;Camera::PathPoint&gt;::size_type i = 0; i &lt; path.size()-1; ++i)
+  {
+    float  segment_length = distance(path[i], path[i+1]);
+
+    if (length_so_far + segment_length &gt; length)
     {
-      float  segment_length = distance(path[i], path[i+1]);
-
-      if (length_so_far + segment_length &gt; length)
-        {
-          float factor = (length - length_so_far) / segment_length;
-          return Camera::PathPoint((path[i+1].pos * factor) + (path[i].pos * (1.0f - factor)),
-                                   (factor * path[i+1].zoom) + ((1.0f - factor) * path[i].zoom));
-        }
-      length_so_far += segment_length;
+      float factor = (length - length_so_far) / segment_length;
+      return Camera::PathPoint((path[i+1].pos * factor) + (path[i].pos * (1.0f - factor)),
+                               (factor * path[i+1].zoom) + ((1.0f - factor) * path[i].zoom));
     }
+    length_so_far += segment_length;
+  }
 
   return path.back();
 }
 
-Camera::Camera()
-  : mode(CAMERA_FOLLOW_PLAYER),
-    pos(0, 0), 
-    zoom(1.0f),
-    path_pos(0)
+Camera::Camera() :
+  mode(CAMERA_FOLLOW_PLAYER),
+  pos(0, 0), 
+  zoom(1.0f),
+  path_pos(0)
 {  
 }
 
@@ -72,54 +72,54 @@
 Camera::update(float delta)
 {
   switch (mode)
-    {
+  {
     case CAMERA_INACTIVE:
       // do nothing
       break;
 
     case CAMERA_FOLLOW_PLAYER:
-      {
-        float hscroll_threshold = 100.0f;
-        float vscroll_threshold  = 150.0f;
+    {
+      float hscroll_threshold = 100.0f;
+      float vscroll_threshold  = 150.0f;
 
-        Vector2f tpos;
-        if (Player::current())
-          tpos = Player::current()-&gt;get_pos();
-        else if (Doll::current())
-          tpos = Doll::current()-&gt;get_pos();
+      Vector2f tpos;
+      if (Player::current())
+        tpos = Player::current()-&gt;get_pos();
+      else if (Doll::current())
+        tpos = Doll::current()-&gt;get_pos();
 
-        float dist = tpos.x - pos.x;
-        if (dist &gt; hscroll_threshold)
-          pos.x = tpos.x - hscroll_threshold;
-        else if (dist &lt; - hscroll_threshold)
-          pos.x = tpos.x + hscroll_threshold;
+      float dist = tpos.x - pos.x;
+      if (dist &gt; hscroll_threshold)
+        pos.x = tpos.x - hscroll_threshold;
+      else if (dist &lt; - hscroll_threshold)
+        pos.x = tpos.x + hscroll_threshold;
 
-        dist = tpos.y - pos.y;
-        if (dist &gt; vscroll_threshold)
-          pos.y = tpos.y - vscroll_threshold;
-        else if (dist &lt; -vscroll_threshold)
-          pos.y = tpos.y + vscroll_threshold;
-      }
-      break;
+      dist = tpos.y - pos.y;
+      if (dist &gt; vscroll_threshold)
+        pos.y = tpos.y - vscroll_threshold;
+      else if (dist &lt; -vscroll_threshold)
+        pos.y = tpos.y + vscroll_threshold;
+    }
+    break;
 
     case CAMERA_FOLLOW_PATH:
-      {
-        assert(!path.empty());
-        path_pos += delta * 50.0f;
+    {
+      assert(!path.empty());
+      path_pos += delta * 50.0f;
 
-        PathPoint p = interpolate_path(path, path_pos);
+      PathPoint p = interpolate_path(path, path_pos);
 
-        set_pos(p.pos.x, p.pos.y);
-        set_zoom(p.zoom);
+      set_pos(p.pos.x, p.pos.y);
+      set_zoom(p.zoom);
 
-        if (p == path.back())
-          {
-            ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::CAMERA_DONE);
-            set_mode(CAMERA_INACTIVE);
-          }
+      if (p == path.back())
+      {
+        ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::CAMERA_DONE);
+        set_mode(CAMERA_INACTIVE);
       }
-      break;
     }
+    break;
+  }
 }
 
 void

Modified: trunk/windstille/src/engine/entity.cpp
===================================================================
--- trunk/windstille/src/engine/entity.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/entity.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,13 +22,13 @@
 #include &quot;engine/sector.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 
-Entity::Entity()
-  : done(),
-    pos(),
-    velocity(0, 0),
-    useable(false),
-    use_verb(),
-    parent(0)
+Entity::Entity() :
+  done(),
+  pos(),
+  velocity(0, 0),
+  useable(false),
+  use_verb(),
+  parent(0)
 {
 }
 
@@ -58,9 +58,9 @@
 Entity::set_parent(Entity* parent_)
 {
   if (parent_ != this)
-    {
-      parent = parent_;
-    }
+  {
+    parent = parent_;
+  }
 }
 
 Properties
@@ -68,10 +68,10 @@
 {
   static PropertySet* type = 0;
   if (!type) 
-    {
-      type = new PropertySet(&quot;Entity&quot;);
-      type-&gt;add_bool(&quot;usable&quot;, &amp;Entity::useable);
-    }
+  {
+    type = new PropertySet(&quot;Entity&quot;);
+    type-&gt;add_bool(&quot;usable&quot;, &amp;Entity::useable);
+  }
 
   return Properties(type, this);
 }

Modified: trunk/windstille/src/engine/game_object.hpp
===================================================================
--- trunk/windstille/src/engine/game_object.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/game_object.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -49,9 +49,9 @@
 
 public:
   GameObject() 
-  : remove_flag(false), 
-    name(),
-    active(true)
+    : remove_flag(false), 
+      name(),
+      active(true)
   {}
   virtual ~GameObject() {}
 

Modified: trunk/windstille/src/engine/physics.cpp
===================================================================
--- trunk/windstille/src/engine/physics.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/physics.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,13 +22,13 @@
 
 #include &quot;collision/collision_object.hpp&quot;
 
-Physics::Physics(Entity* entity_)
-  : entity(entity_),
-    mass(200.0),
-    bounciness(1.0),
-    force(),
-    air_friction(0.0),
-    contact_friction(0.0)
+Physics::Physics(Entity* entity_) :
+  entity(entity_),
+  mass(200.0),
+  bounciness(1.0),
+  force(),
+  air_friction(0.0),
+  contact_friction(0.0)
 {
 }
 

Modified: trunk/windstille/src/engine/script_manager.cpp
===================================================================
--- trunk/windstille/src/engine/script_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/script_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -64,51 +64,51 @@
 {
   vm = sq_open(1024);
   if(vm == 0)
-    {
-      throw std::runtime_error(&quot;Couldn't initialize squirrel vm&quot;);
-    }
+  {
+    throw std::runtime_error(&quot;Couldn't initialize squirrel vm&quot;);
+  }
   else
-    {
-      // register default error handlers
-      sqstd_seterrorhandlers(vm);
+  {
+    // register default error handlers
+    sqstd_seterrorhandlers(vm);
 
-      { // register squirrel libs in the root table
+    { // register squirrel libs in the root table
         
-        sq_pushroottable(vm);
+      sq_pushroottable(vm);
       
-        /* FIXME: None of these should be needed for scripts
+      /* FIXME: None of these should be needed for scripts
 
-           if(SQ_FAILED(sqstd_register_bloblib(v)))
-           throw SquirrelError(v, &quot;Couldn't register blob lib&quot;);
+         if(SQ_FAILED(sqstd_register_bloblib(v)))
+         throw SquirrelError(v, &quot;Couldn't register blob lib&quot;);
 
-           if(SQ_FAILED(sqstd_register_iolib(v)))
-           throw SquirrelError(v, &quot;Couldn't register io lib&quot;);
+         if(SQ_FAILED(sqstd_register_iolib(v)))
+         throw SquirrelError(v, &quot;Couldn't register io lib&quot;);
 
-           if(SQ_FAILED(sqstd_register_systemlib(v)))
-           throw SquirrelError(v, &quot;Couldn't register system lib&quot;);
-        */
+         if(SQ_FAILED(sqstd_register_systemlib(v)))
+         throw SquirrelError(v, &quot;Couldn't register system lib&quot;);
+      */
 
-        if(SQ_FAILED(sqstd_register_mathlib(vm)))
-          throw SquirrelError(vm, &quot;Couldn't register math lib&quot;);
+      if(SQ_FAILED(sqstd_register_mathlib(vm)))
+        throw SquirrelError(vm, &quot;Couldn't register math lib&quot;);
 
-        if(SQ_FAILED(sqstd_register_stringlib(vm)))
-          throw SquirrelError(vm, &quot;Couldn't register string lib&quot;);
+      if(SQ_FAILED(sqstd_register_stringlib(vm)))
+        throw SquirrelError(vm, &quot;Couldn't register string lib&quot;);
 
-        // register print function
-        sq_setprintfunc(vm, printfunc);
+      // register print function
+      sq_setprintfunc(vm, printfunc);
   
-        // register windstille API
-        Scripting::register_windstille_wrapper(vm);
-        sq_pop(vm, 1);
-      }
-
-      // Create the empty &quot;objects&quot; table
-      sq_pushroottable(vm);
-      sq_pushstring(vm, OBJECTS_TABLE, -1);
-      sq_newtable(vm);
-      sq_newslot(vm, -3, SQFalse);
+      // register windstille API
+      Scripting::register_windstille_wrapper(vm);
       sq_pop(vm, 1);
     }
+
+    // Create the empty &quot;objects&quot; table
+    sq_pushroottable(vm);
+    sq_pushstring(vm, OBJECTS_TABLE, -1);
+    sq_newtable(vm);
+    sq_newslot(vm, -3, SQFalse);
+    sq_pop(vm, 1);
+  }
 }
 
 ScriptManager::~ScriptManager()
@@ -134,94 +134,94 @@
   std::ifstream in(filename.get_sys_path().c_str());
 
   if (global)
-    {
-      // Scripts run in the global namespace must not suspend
+  {
+    // Scripts run in the global namespace must not suspend
 
-      // Compile the script and push it on the stack
-      if (sq_compile(vm, squirrel_read_char, &amp;in, filename.get_sys_path().c_str(), true) &lt; 0)
-        throw SquirrelError(vm, &quot;Couldn't parse script&quot;);
+    // Compile the script and push it on the stack
+    if (sq_compile(vm, squirrel_read_char, &amp;in, filename.get_sys_path().c_str(), true) &lt; 0)
+      throw SquirrelError(vm, &quot;Couldn't parse script&quot;);
 
-      // Set 'this' environment
-      sq_pushroottable(vm);
+    // Set 'this' environment
+    sq_pushroottable(vm);
 
-      // Execute the script
-      if (SQ_FAILED(sq_call(vm, 1, false, true)))
-        {
-          std::ostringstream str;
-          str &lt;&lt; &quot;SquirrelThread::run(): &quot; &lt;&lt; filename &lt;&lt; &quot;: Couldn't start script&quot;;
-          throw SquirrelError(vm, str.str());
-        }
-      else
-        {
-          sq_pop(vm, 1);
+    // Execute the script
+    if (SQ_FAILED(sq_call(vm, 1, false, true)))
+    {
+      std::ostringstream str;
+      str &lt;&lt; &quot;SquirrelThread::run(): &quot; &lt;&lt; filename &lt;&lt; &quot;: Couldn't start script&quot;;
+      throw SquirrelError(vm, str.str());
+    }
+    else
+    {
+      sq_pop(vm, 1);
 
-          if (sq_getvmstate(vm) != SQ_VMSTATE_IDLE)
-            {
-              std::ostringstream str;
-              str &lt;&lt; &quot;ScriptManager::run_script(): '&quot; &lt;&lt; filename &lt;&lt; &quot;': global scripts must not suspend&quot;;
-              throw std::runtime_error(str.str());
-            }
+      if (sq_getvmstate(vm) != SQ_VMSTATE_IDLE)
+      {
+        std::ostringstream str;
+        str &lt;&lt; &quot;ScriptManager::run_script(): '&quot; &lt;&lt; filename &lt;&lt; &quot;': global scripts must not suspend&quot;;
+        throw std::runtime_error(str.str());
+      }
 
-          return boost::shared_ptr&lt;SquirrelThread&gt;();
-        }
+      return boost::shared_ptr&lt;SquirrelThread&gt;();
     }
+  }
   else
+  {
+    SquirrelThreads::iterator it = squirrel_vms.end();
+
+    // Look if the VM is associated with the source file
+    for(SquirrelThreads::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i)
     {
-      SquirrelThreads::iterator it = squirrel_vms.end();
-
-      // Look if the VM is associated with the source file
-      for(SquirrelThreads::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i)
-        {
-          if ((*i)-&gt;get_filename() == filename)
-            {
-              it = i;
-              break;
-            }
-        }
+      if ((*i)-&gt;get_filename() == filename)
+      {
+        it = i;
+        break;
+      }
+    }
       
-      if (it != squirrel_vms.end())
-        {
-          // Call the run method
-          if ((*it)-&gt;is_idle())
-            {
-              (*it)-&gt;call(&quot;run&quot;);
-              return *it;
-            }
-          else
-            {
-              std::ostringstream str;
-              str &lt;&lt; filename &lt;&lt; &quot;: ScriptManager::run_script(): Script must be idle to be 'run()'&quot;;
-              throw std::runtime_error(str.str());
-            }
-        }
+    if (it != squirrel_vms.end())
+    {
+      // Call the run method
+      if ((*it)-&gt;is_idle())
+      {
+        (*it)-&gt;call(&quot;run&quot;);
+        return *it;
+      }
       else
-        { // Add VM to the list of VMs
-          squirrel_vms.push_back(boost::shared_ptr&lt;SquirrelThread&gt;(new SquirrelThread(vm, true)));
-          squirrel_vms.back()-&gt;load(in, filename);
-          squirrel_vms.back()-&gt;call(&quot;init&quot;);
-          squirrel_vms.back()-&gt;call(&quot;run&quot;);
-          return squirrel_vms.back();
-        }
+      {
+        std::ostringstream str;
+        str &lt;&lt; filename &lt;&lt; &quot;: ScriptManager::run_script(): Script must be idle to be 'run()'&quot;;
+        throw std::runtime_error(str.str());
+      }
     }
+    else
+    { // Add VM to the list of VMs
+      squirrel_vms.push_back(boost::shared_ptr&lt;SquirrelThread&gt;(new SquirrelThread(vm, true)));
+      squirrel_vms.back()-&gt;load(in, filename);
+      squirrel_vms.back()-&gt;call(&quot;init&quot;);
+      squirrel_vms.back()-&gt;call(&quot;run&quot;);
+      return squirrel_vms.back();
+    }
+  }
 }
 
 void
 ScriptManager::update()
 {
   for(SquirrelThreads::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i)
-    {
-      (*i)-&gt;update();
-    }
+  {
+    (*i)-&gt;update();
+  }
 }
 
 boost::shared_ptr&lt;SquirrelThread&gt;
 ScriptManager::get_thread(HSQUIRRELVM v) const
 {
   for(SquirrelThreads::const_iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i) 
-    {
-      if ((*i)-&gt;get_thread() == v)
-        return *i;
-    }
+  {
+    if ((*i)-&gt;get_thread() == v)
+      return *i;
+  }
 
   return boost::shared_ptr&lt;SquirrelThread&gt;();
 }
@@ -232,9 +232,9 @@
   assert(event.type &gt;= 0 &amp;&amp; event.type &lt; MAX_WAKEUP_EVENT_COUNT);
 
   for(SquirrelThreads::iterator i = squirrel_vms.begin(); i != squirrel_vms.end(); ++i) 
-    {
-      (*i)-&gt;fire_wakeup_event(event);
-    }
+  {
+    (*i)-&gt;fire_wakeup_event(event);
+  }
 }
 
 void
@@ -251,11 +251,11 @@
   sq_pushroottable(v);
   sq_pushstring(v, OBJECTS_TABLE, -1);
   if(SQ_FAILED(sq_get(v, -2)))
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
-      throw SquirrelError(v, msg.str());
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
+    throw SquirrelError(v, msg.str());
+  }
 
   // remove object from table
   sq_pushstring(v, object-&gt;get_name().c_str(), object-&gt;get_name().size());
@@ -275,23 +275,23 @@
 static inline void create_squirrel_instance(HSQUIRRELVM v, boost::shared_ptr&lt;GameObject&gt; object)
 {
   if (dynamic_cast&lt;ScriptableObject*&gt;(object.get()))
-    {
-      create_squirrel_instance(v, new Scripting::ScriptableObject(object),
-                               true);
-      return;
-    }
+  {
+    create_squirrel_instance(v, new Scripting::ScriptableObject(object),
+                             true);
+    return;
+  }
   
   if (dynamic_cast&lt;TestObject*&gt;(object.get()))
-    {
-      create_squirrel_instance(v, new Scripting::TestObject(object), true);
-      return;
-    }                                                                             
+  {
+    create_squirrel_instance(v, new Scripting::TestObject(object), true);
+    return;
+  }                                                                             
 
   if (dynamic_cast&lt;Player*&gt;(object.get()))
-    {
-      create_squirrel_instance(v, new Scripting::Player(object), true);
-      return;
-    }
+  {
+    create_squirrel_instance(v, new Scripting::Player(object), true);
+    return;
+  }
 
   create_squirrel_instance(v, new Scripting::GameObject(object), true);
 }
@@ -304,21 +304,21 @@
   sq_pushroottable(v);
   sq_pushstring(v, OBJECTS_TABLE, -1);
   if(SQ_FAILED(sq_get(v, -2)))
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
-      throw SquirrelError(v, msg.str());
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't get objects table '&quot; &lt;&lt; OBJECTS_TABLE &lt;&lt; &quot;'&quot;;
+    throw SquirrelError(v, msg.str());
+  }
   
   // create squirrel instance and register in table
   sq_pushstring(v, object-&gt;get_name().c_str(), object-&gt;get_name().size());
   create_squirrel_instance(v, object);
   if(SQ_FAILED(sq_createslot(v, -3)))
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Couldn't register object in objects tab&#246;e&quot;;
-      throw SquirrelError(v, msg.str());
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Couldn't register object in objects tab&#246;e&quot;;
+    throw SquirrelError(v, msg.str());
+  }
 
   // pop roottable and objects table
   sq_pop(v, 2);

Modified: trunk/windstille/src/engine/script_manager.hpp
===================================================================
--- trunk/windstille/src/engine/script_manager.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/script_manager.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -47,17 +47,17 @@
 {
 public:
   enum WakeupEvent 
-    {
-      NO_EVENT,
-      TIME,
-      DIALOG_CLOSED,
-      CONVERSATION_CLOSED,
-      SPEECH_DONE,
-      FADE_DONE,
-      CAMERA_DONE,
-      GAMEOBJECT_DONE,
-      MAX_WAKEUP_EVENT_COUNT
-    };
+  {
+    NO_EVENT,
+    TIME,
+    DIALOG_CLOSED,
+    CONVERSATION_CLOSED,
+    SPEECH_DONE,
+    FADE_DONE,
+    CAMERA_DONE,
+    GAMEOBJECT_DONE,
+    MAX_WAKEUP_EVENT_COUNT
+  };
 
   struct WakeupData 
   {

Modified: trunk/windstille/src/engine/sector.cpp
===================================================================
--- trunk/windstille/src/engine/sector.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/sector.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -31,21 +31,21 @@
 #include &quot;sound/sound_manager.hpp&quot;
 #include &quot;tile/tile_map.hpp&quot;
 
-Sector::Sector(const Pathname&amp; arg_filename)
-  : collision_engine(new CollisionEngine()),
-    navigation_graph(new NavigationGraph()),
-    scene_graph(new SceneGraph()),
-    filename(arg_filename),
-    name(),
-    music(),
-    init_script(),
-    vm(),
-    objects(),
-    new_objects(),
-    ambient_light(),
-    interactive_tilemap(0),
-    interactivebackground_tilemap(0),
-    player()
+Sector::Sector(const Pathname&amp; arg_filename) :
+  collision_engine(new CollisionEngine()),
+  navigation_graph(new NavigationGraph()),
+  scene_graph(new SceneGraph()),
+  filename(arg_filename),
+  name(),
+  music(),
+  init_script(),
+  vm(),
+  objects(),
+  new_objects(),
+  ambient_light(),
+  interactive_tilemap(0),
+  interactivebackground_tilemap(0),
+  player()
 {
   SectorBuilder(arg_filename, *this);
 
@@ -94,10 +94,10 @@
   sc.light().fill_screen(ambient_light);
 
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i)
-    {
-      if ((*i)-&gt;is_active())
-        (*i)-&gt;draw(sc);
-    }
+  {
+    if ((*i)-&gt;is_active())
+      (*i)-&gt;draw(sc);
+  }
 }
 
 void Sector::commit_adds()
@@ -119,10 +119,10 @@
   collision_engine-&gt;update(delta);
 
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i) 
-    {
-      if ((*i)-&gt;is_active())
-        (*i)-&gt;update(delta);
-    }
+  {
+    if ((*i)-&gt;is_active())
+      (*i)-&gt;update(delta);
+  }
 
   commit_removes();
 }
@@ -132,22 +132,22 @@
 {
   // remove objects
   for(Objects::iterator i = objects.begin(); i != objects.end(); ) 
+  {
+    boost::shared_ptr&lt;GameObject&gt;&amp; object = *i;
+
+    if(object-&gt;is_removable()) 
     {
-      boost::shared_ptr&lt;GameObject&gt;&amp; object = *i;
+      if(object-&gt;get_name() != &quot;&quot;) 
+      {
+        ScriptManager::current()-&gt;remove_object_from_squirrel(object);
+      }
 
-      if(object-&gt;is_removable()) 
-        {
-          if(object-&gt;get_name() != &quot;&quot;) 
-            {
-              ScriptManager::current()-&gt;remove_object_from_squirrel(object);
-            }
+      i = objects.erase(i);
+      continue;
+    }
 
-          i = objects.erase(i);
-          continue;
-        }
-
-      ++i;
-    }
+    ++i;
+  }
 }
 
 void
@@ -156,21 +156,21 @@
   new_objects.push_back(obj);
 
   if(obj-&gt;get_name() != &quot;&quot;) 
-    {
-      ScriptManager::current()-&gt;expose_object_to_squirrel(new_objects.back());
-    }
+  {
+    ScriptManager::current()-&gt;expose_object_to_squirrel(new_objects.back());
+  }
 }
 
 GameObject*
 Sector::get_object(const std::string&amp; name_) const
 {
   for(Objects::const_iterator i = objects.begin(); i != objects.end(); ++i) 
+  {
+    if ((*i)-&gt;get_name() == name_)
     {
-      if ((*i)-&gt;get_name() == name_)
-        {
-          return i-&gt;get();
-        }
+      return i-&gt;get();
     }
+  }
 
   return 0;
 }
@@ -227,20 +227,20 @@
 Sector::call_script_function(const std::string&amp; name_)
 {
   if (!vm.get())
+  {
+    throw std::runtime_error(&quot;Sector::call_script_function(): Can't call function '&quot; + name_ + &quot;' without a init script&quot;);
+  }
+  else
+  {
+    if (!vm-&gt;is_idle())
     {
-      throw std::runtime_error(&quot;Sector::call_script_function(): Can't call function '&quot; + name_ + &quot;' without a init script&quot;);
+      throw std::runtime_error(&quot;Sector::call_script_function(): VM must be idle to call  '&quot; + name_ + &quot;'&quot;);
     }
-  else
+    else
     {
-      if (!vm-&gt;is_idle())
-        {
-          throw std::runtime_error(&quot;Sector::call_script_function(): VM must be idle to call  '&quot; + name_ + &quot;'&quot;);
-        }
-      else
-        {
-          vm-&gt;call(name_);
-        }
+      vm-&gt;call(name_);
     }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/engine/sector_builder.cpp
===================================================================
--- trunk/windstille/src/engine/sector_builder.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/sector_builder.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -32,11 +32,11 @@
 #include &quot;tile/tile_map.hpp&quot;
 #include &quot;util/file_reader.hpp&quot;
 
-SectorBuilder::SectorBuilder(const Pathname&amp; filename, Sector&amp; sector)
-  : m_filename(filename),
-    m_sector(sector),
-    id_table(),
-    parent_table()
+SectorBuilder::SectorBuilder(const Pathname&amp; filename, Sector&amp; sector) :
+  m_filename(filename),
+  m_sector(sector),
+  id_table(),
+  parent_table()
 {
   FileReader reader = FileReader::parse(m_filename);
   if(reader.get_name() != &quot;windstille-sector&quot;) 

Modified: trunk/windstille/src/engine/squirrel_thread.cpp
===================================================================
--- trunk/windstille/src/engine/squirrel_thread.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/engine/squirrel_thread.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -45,69 +45,69 @@
   thread = sq_newthread(parent_vm, 1024);  // create thread and store it on the stack
 
   if (thread == 0)
-    {
-      throw SquirrelError(thread, filename, &quot;Couldn't create new THREAD&quot;);
-    }
+  {
+    throw SquirrelError(thread, filename, &quot;Couldn't create new THREAD&quot;);
+  }
   else
-    { // Create a HSQOBJECT to hold a reference to the thread
+  { // Create a HSQOBJECT to hold a reference to the thread
 
-      sq_resetobject(&amp;thread_obj); // init the object
+    sq_resetobject(&amp;thread_obj); // init the object
 
-      // store thread created by sq_newthread into thread_obj
-      if (sq_getstackobj(parent_vm, -1, &amp;thread_obj) &lt; 0)
-        {
-          throw SquirrelError(parent_vm, filename, &quot;Couldn't get coroutine thread from stack&quot;);
-        }
-      else
-        {
-          sq_addref(parent_vm, &amp;thread_obj); // add reference
-          sq_pop(parent_vm, 1); // remove the thread from the stack
-        }
+    // store thread created by sq_newthread into thread_obj
+    if (sq_getstackobj(parent_vm, -1, &amp;thread_obj) &lt; 0)
+    {
+      throw SquirrelError(parent_vm, filename, &quot;Couldn't get coroutine thread from stack&quot;);
     }
+    else
+    {
+      sq_addref(parent_vm, &amp;thread_obj); // add reference
+      sq_pop(parent_vm, 1); // remove the thread from the stack
+    }
+  }
 }
 
-SquirrelThread::SquirrelThread(HSQUIRRELVM parent_vm_, bool isolated_)
-  : parent_vm(parent_vm_),
-    isolated(isolated_),
-    thread(0),
-    filename(&quot;&lt;unset&gt;&quot;),
-    oldtop(-1),
-    waiting_for_events(ScriptManager::NO_EVENT),
-    wakeup_time(0)
+SquirrelThread::SquirrelThread(HSQUIRRELVM parent_vm_, bool isolated_) :
+  parent_vm(parent_vm_),
+  isolated(isolated_),
+  thread(0),
+  filename(&quot;&lt;unset&gt;&quot;),
+  oldtop(-1),
+  waiting_for_events(ScriptManager::NO_EVENT),
+  wakeup_time(0)
 {
   create_thread();
 
   std::cout &lt;&lt; &quot;SquirrelThread: isolated = &quot; &lt;&lt; isolated &lt;&lt; std::endl;
   if (isolated)
-    { // create a local environment for the thread
-      HSQOBJECT env;
-      sq_resetobject(&amp;env);
+  { // create a local environment for the thread
+    HSQOBJECT env;
+    sq_resetobject(&amp;env);
 
-      sq_newtable(thread);
+    sq_newtable(thread);
 
-      // store the object in env
-      if(sq_getstackobj(thread, -1, &amp;env) &lt; 0) 
-        {
-          throw SquirrelError(parent_vm, filename, &quot;couldn't get table from stack&quot;);
-        }
-      else
-        {
-          sq_addref(thread, &amp;env); 
-          sq_pop(thread, 1); // remove env from stack
+    // store the object in env
+    if(sq_getstackobj(thread, -1, &amp;env) &lt; 0) 
+    {
+      throw SquirrelError(parent_vm, filename, &quot;couldn't get table from stack&quot;);
+    }
+    else
+    {
+      sq_addref(thread, &amp;env); 
+      sq_pop(thread, 1); // remove env from stack
     
-          // set old roottable as delegate on env
-          sq_pushobject(thread, env); // push env
-          sq_pushroottable(thread);   // [env, root]
-          sq_setdelegate(thread, -2); // env.set_delegate(root)
-          sq_pop(thread, 1);          // pop env
+      // set old roottable as delegate on env
+      sq_pushobject(thread, env); // push env
+      sq_pushroottable(thread);   // [env, root]
+      sq_setdelegate(thread, -2); // env.set_delegate(root)
+      sq_pop(thread, 1);          // pop env
 
-          // set env as new roottable
-          sq_pushobject(thread, env);
-          sq_setroottable(thread);
+      // set env as new roottable
+      sq_pushobject(thread, env);
+      sq_setroottable(thread);
 
-          sq_release(thread, &amp;env);
-        }
+      sq_release(thread, &amp;env);
     }
+  }
 }
 
 void
@@ -119,29 +119,29 @@
 
   // compile the script and push it on the stack
   if (SQ_FAILED(sq_compile(thread, squirrel_read_char, &amp;in, filename.get_sys_path().c_str(), SQTrue)))
+  {
+    throw SquirrelError(thread, filename, &quot;Couldn't parse script&quot;);
+  }
+  else
+  {
+    // start the script that was previously compiled
+    sq_pushroottable(thread);
+    if (SQ_FAILED(sq_call(thread, 1, SQFalse, SQTrue)))
     {
-      throw SquirrelError(thread, filename, &quot;Couldn't parse script&quot;);
+      sq_pop(thread, 1); // pop the compiled closure
+      throw SquirrelError(thread, filename, &quot;SquirrelThread::load(): Couldn't start script&quot;);
     }
-  else
+    else
     {
-      // start the script that was previously compiled
-      sq_pushroottable(thread);
-      if (SQ_FAILED(sq_call(thread, 1, SQFalse, SQTrue)))
-        {
-          sq_pop(thread, 1); // pop the compiled closure
-          throw SquirrelError(thread, filename, &quot;SquirrelThread::load(): Couldn't start script&quot;);
-        }
-      else
-        {
-          if (sq_getvmstate(thread) != SQ_VMSTATE_IDLE)
-            {
-              std::ostringstream str;
-              str &lt;&lt; &quot;SquirrelThread::load(): Script '&quot; &lt;&lt; filename &lt;&lt; &quot;' must not suspend outside of run call&quot;;
-              throw SquirrelError(thread, filename, str.str());
-            }
-          sq_pop(thread, 1); // pop the compiled closure
-        }
+      if (sq_getvmstate(thread) != SQ_VMSTATE_IDLE)
+      {
+        std::ostringstream str;
+        str &lt;&lt; &quot;SquirrelThread::load(): Script '&quot; &lt;&lt; filename &lt;&lt; &quot;' must not suspend outside of run call&quot;;
+        throw SquirrelError(thread, filename, str.str());
+      }
+      sq_pop(thread, 1); // pop the compiled closure
     }
+  }
 }
 
 void
@@ -155,19 +155,19 @@
   // Execute the function
   sq_pushroottable(thread);
   if (SQ_FAILED(sq_call(thread, 1, SQFalse, SQTrue)))
-    {
-      if(sq_getvmstate(thread) == SQ_VMSTATE_IDLE)
-        { // Cleanup stack
-          sq_settop(thread, oldtop);
-        }
+  {
+    if(sq_getvmstate(thread) == SQ_VMSTATE_IDLE)
+    { // Cleanup stack
+      sq_settop(thread, oldtop);
+    }
 
-      throw SquirrelError(thread, filename, &quot;SquirrelThread::run(): Couldn't start script&quot;);
-    }
+    throw SquirrelError(thread, filename, &quot;SquirrelThread::run(): Couldn't start script&quot;);
+  }
   else
-    {
-      if(sq_getvmstate(thread) == SQ_VMSTATE_IDLE)
-        sq_settop(thread, oldtop);
-    }
+  {
+    if(sq_getvmstate(thread) == SQ_VMSTATE_IDLE)
+      sq_settop(thread, oldtop);
+  }
 }
 
 SquirrelThread::~SquirrelThread()
@@ -187,13 +187,13 @@
   waiting_for_events = event;
 
   if (timeout &lt; 0) 
-    {
-      wakeup_time = -1;
-    } 
+  {
+    wakeup_time = -1;
+  } 
   else 
-    {
-      wakeup_time = game_time + timeout;
-    }
+  {
+    wakeup_time = game_time + timeout;
+  }
 }
 
 void
@@ -201,28 +201,28 @@
 { 
   if (waiting_for_events.type == event.type &amp;&amp; 
       waiting_for_events.type != ScriptManager::NO_EVENT)
+  {
+    switch (event.type)
     {
-      switch (event.type)
+      case ScriptManager::SPEECH_DONE:
+        if (waiting_for_events.id == event.id)
         {
-          case ScriptManager::SPEECH_DONE:
-            if (waiting_for_events.id == event.id)
-              {
-                wakeup_time = game_time;
-              }
-            break;
+          wakeup_time = game_time;
+        }
+        break;
 
-          case ScriptManager::GAMEOBJECT_DONE:
-            if (waiting_for_events.game_object == event.game_object)
-              {
-                wakeup_time = game_time;
-              }
-            break;
+      case ScriptManager::GAMEOBJECT_DONE:
+        if (waiting_for_events.game_object == event.game_object)
+        {
+          wakeup_time = game_time;
+        }
+        break;
 
-          default:
-            wakeup_time = game_time;
-            break;
-        }
+      default:
+        wakeup_time = game_time;
+        break;
     }
+  }
 }
 
 void
@@ -231,43 +231,43 @@
   int thread_state = sq_getvmstate(thread);
     
   switch(thread_state)
-    {
-      case SQ_VMSTATE_SUSPENDED:
-        if (wakeup_time &gt; 0 &amp;&amp; game_time &gt;= wakeup_time)
+  {
+    case SQ_VMSTATE_SUSPENDED:
+      if (wakeup_time &gt; 0 &amp;&amp; game_time &gt;= wakeup_time)
+      {
+        waiting_for_events = ScriptManager::WakeupData(ScriptManager::NO_EVENT);
+
+        try 
+        {
+          // Try to return a value
+          if (sq_wakeupvm(thread, SQFalse, SQFalse, SQTrue) &lt; 0)
           {
-            waiting_for_events = ScriptManager::WakeupData(ScriptManager::NO_EVENT);
-
-            try 
-              {
-                // Try to return a value
-                if (sq_wakeupvm(thread, SQFalse, SQFalse, SQTrue) &lt; 0)
-                  {
-                    throw SquirrelError(thread, filename, &quot;Couldn't resume script&quot;);
-                  }
-                else
-                  {
-                    if(sq_getvmstate(thread) == SQ_VMSTATE_IDLE) 
-                      { // Cleanup stack
-                        sq_settop(thread, oldtop);
-                      }
-                  }
-              }
-            catch(std::exception&amp; e) 
-              {
-                std::cerr &lt;&lt; &quot;Problem executing script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-              }
+            throw SquirrelError(thread, filename, &quot;Couldn't resume script&quot;);
           }
-        break;
+          else
+          {
+            if(sq_getvmstate(thread) == SQ_VMSTATE_IDLE) 
+            { // Cleanup stack
+              sq_settop(thread, oldtop);
+            }
+          }
+        }
+        catch(std::exception&amp; e) 
+        {
+          std::cerr &lt;&lt; &quot;Problem executing script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
+        }
+      }
+      break;
 
-      case SQ_VMSTATE_IDLE:
-        break;
+    case SQ_VMSTATE_IDLE:
+      break;
 
-      case SQ_VMSTATE_RUNNING: // FIXME: Can this happen without multithreading?
-        break;
+    case SQ_VMSTATE_RUNNING: // FIXME: Can this happen without multithreading?
+      break;
 
-      default: 
-        assert(!&quot;never reached&quot;);
-    }
+    default: 
+      assert(!&quot;never reached&quot;);
+  }
 }
 
 bool
@@ -288,15 +288,15 @@
 SquirrelThread::call(const std::string&amp; function)
 {
   if (0)
-    { // Debug stuff that prints the current roottable and its delegate
-      sq_pushroottable(thread);
-      std::cout &lt;&lt; &quot;.------------------------------------------&quot; &lt;&lt; std::endl;
-      std::cout &lt;&lt; &quot;################\nRootTable:\n{{{&quot; &lt;&lt; Scripting::squirrel2string(thread, -1) &lt;&lt; &quot;\n}}}&quot; &lt;&lt; std::endl;
-      sq_getdelegate(thread, -1);
-      std::cout &lt;&lt; &quot;################\nDelegate:\n{{{&quot; &lt;&lt; Scripting::squirrel2string(thread, -1) &lt;&lt; &quot;\n}}}&quot; &lt;&lt; std::endl;
-      sq_pop(thread, 2);
-      std::cout &lt;&lt; &quot;'------------------------------------------&quot; &lt;&lt; std::endl;
-    }
+  { // Debug stuff that prints the current roottable and its delegate
+    sq_pushroottable(thread);
+    std::cout &lt;&lt; &quot;.------------------------------------------&quot; &lt;&lt; std::endl;
+    std::cout &lt;&lt; &quot;################\nRootTable:\n{{{&quot; &lt;&lt; Scripting::squirrel2string(thread, -1) &lt;&lt; &quot;\n}}}&quot; &lt;&lt; std::endl;
+    sq_getdelegate(thread, -1);
+    std::cout &lt;&lt; &quot;################\nDelegate:\n{{{&quot; &lt;&lt; Scripting::squirrel2string(thread, -1) &lt;&lt; &quot;\n}}}&quot; &lt;&lt; std::endl;
+    sq_pop(thread, 2);
+    std::cout &lt;&lt; &quot;'------------------------------------------&quot; &lt;&lt; std::endl;
+  }
 
   //std::cout &lt;&lt; &quot;SquirrelThread::call(\&quot;&quot; &lt;&lt; function &lt;&lt; &quot;\&quot;)&quot; &lt;&lt; std::endl;
 
@@ -306,29 +306,29 @@
   sq_pushroottable(thread);
   sq_pushstring(thread, function.c_str(), -1);
   if (SQ_SUCCEEDED(sq_get(thread, -2)))
+  {
+    sq_pushroottable(thread);
+
+    if (SQ_FAILED(sq_call(thread, 1, SQFalse, SQTrue)))
     {
-      sq_pushroottable(thread);
-
-      if (SQ_FAILED(sq_call(thread, 1, SQFalse, SQTrue)))
-        {
-          sq_settop(thread, oldtop);
-          throw SquirrelError(thread, filename, &quot;SquirrelThread: couldn't call '&quot; + function + &quot;'&quot;);
-        }
-      else
-        {
-          if(sq_getvmstate(thread) != SQ_VMSTATE_SUSPENDED) 
-            {
-              sq_settop(thread, oldtop);
-            }
-        }
+      sq_settop(thread, oldtop);
+      throw SquirrelError(thread, filename, &quot;SquirrelThread: couldn't call '&quot; + function + &quot;'&quot;);
     }
+    else
+    {
+      if(sq_getvmstate(thread) != SQ_VMSTATE_SUSPENDED) 
+      {
+        sq_settop(thread, oldtop);
+      }
+    }
+  }
   else
-    {
-      sq_settop(thread, oldtop);
+  {
+    sq_settop(thread, oldtop);
 
-      if (0)
-        std::cout &lt;&lt; filename &lt;&lt; &quot;: Function '&quot; &lt;&lt; function &lt;&lt; &quot;' not found in roottable&quot; &lt;&lt; std::endl;
-    }
+    if (0)
+      std::cout &lt;&lt; filename &lt;&lt; &quot;: Function '&quot; &lt;&lt; function &lt;&lt; &quot;' not found in roottable&quot; &lt;&lt; std::endl;
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/font/border_font_effect.cpp
===================================================================
--- trunk/windstille/src/font/border_font_effect.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/border_font_effect.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,9 +21,9 @@
 #include &quot;display/software_surface.hpp&quot;
 #include &quot;font/border_font_effect.hpp&quot;
 
-BorderFontEffect::BorderFontEffect(int size_, bool outline_)
-  : size(size_),
-    outline(outline_)
+BorderFontEffect::BorderFontEffect(int size_, bool outline_) :
+  size(size_),
+  outline(outline_)
 {
 }
 
@@ -82,44 +82,44 @@
   uint8_t green = 0;
 
   if (!outline)
-    {
-      red = blue = green = 255;
-    }
+  {
+    red = blue = green = 255;
+  }
 
   // Draw the border
   for (int y = start_y; y &lt; end_y; ++y)
     for (int x = start_x; x &lt; end_x; ++x)
-      {
-        for(int by = -size; by &lt;= size; ++by)
-          for(int bx = -size+abs(by); bx &lt;= size-abs(by); ++bx)
-            {
-              int target_pos = (y + y_pos + by) * target_pitch + 4*(x + x_pos + bx);
-              int brush_pos  = y * brush.pitch + x;
+    {
+      for(int by = -size; by &lt;= size; ++by)
+        for(int bx = -size+abs(by); bx &lt;= size-abs(by); ++bx)
+        {
+          int target_pos = (y + y_pos + by) * target_pitch + 4*(x + x_pos + bx);
+          int brush_pos  = y * brush.pitch + x;
             
-              target_buf[target_pos + 0] = red;
-              target_buf[target_pos + 1] = blue;
-              target_buf[target_pos + 2] = green;
-              target_buf[target_pos + 3] = static_cast&lt;uint8_t&gt;(std::min(target_buf[target_pos + 3] + brush.buffer[brush_pos], 255));
-            }
-      }
+          target_buf[target_pos + 0] = red;
+          target_buf[target_pos + 1] = blue;
+          target_buf[target_pos + 2] = green;
+          target_buf[target_pos + 3] = static_cast&lt;uint8_t&gt;(std::min(target_buf[target_pos + 3] + brush.buffer[brush_pos], 255));
+        }
+    }
 
   if (outline)
-    {
-      // Draw the font itself
-      for (int y = start_y; y &lt; end_y; ++y)
-        for (int x = start_x; x &lt; end_x; ++x)
-          {
-            int target_pos = (y + y_pos) * target_pitch + 4*(x + x_pos);
-            int brush_pos  = y * brush.pitch + x;
+  {
+    // Draw the font itself
+    for (int y = start_y; y &lt; end_y; ++y)
+      for (int x = start_x; x &lt; end_x; ++x)
+      {
+        int target_pos = (y + y_pos) * target_pitch + 4*(x + x_pos);
+        int brush_pos  = y * brush.pitch + x;
         
-            int alpha = brush.buffer[brush_pos];
+        int alpha = brush.buffer[brush_pos];
 
-            target_buf[target_pos + 0] = static_cast&lt;uint8_t&gt;(std::min((target_buf[target_pos + 0] * (255 - alpha) + alpha * 255)/255, 255));
-            target_buf[target_pos + 1] = static_cast&lt;uint8_t&gt;(std::min((target_buf[target_pos + 1] * (255 - alpha) + alpha * 255)/255, 255));
-            target_buf[target_pos + 2] = static_cast&lt;uint8_t&gt;(std::min((target_buf[target_pos + 2] * (255 - alpha) + alpha * 255)/255, 255));
-            target_buf[target_pos + 3] = static_cast&lt;uint8_t&gt;(std::min(target_buf[target_pos + 3] + brush.buffer[brush_pos], 255));
-          }
-    }
+        target_buf[target_pos + 0] = static_cast&lt;uint8_t&gt;(std::min((target_buf[target_pos + 0] * (255 - alpha) + alpha * 255)/255, 255));
+        target_buf[target_pos + 1] = static_cast&lt;uint8_t&gt;(std::min((target_buf[target_pos + 1] * (255 - alpha) + alpha * 255)/255, 255));
+        target_buf[target_pos + 2] = static_cast&lt;uint8_t&gt;(std::min((target_buf[target_pos + 2] * (255 - alpha) + alpha * 255)/255, 255));
+        target_buf[target_pos + 3] = static_cast&lt;uint8_t&gt;(std::min(target_buf[target_pos + 3] + brush.buffer[brush_pos], 255));
+      }
+  }
 }  
 
 /* EOF */

Modified: trunk/windstille/src/font/border_font_effect.hpp
===================================================================
--- trunk/windstille/src/font/border_font_effect.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/border_font_effect.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -33,7 +33,7 @@
       
       @param size     Size of the border in pixel
       @param outline  If true add the border as an outline to the font, else add it to the font itself
-   */
+  */
   BorderFontEffect(int size, bool outline);
   ~BorderFontEffect();
   
@@ -48,9 +48,9 @@
   void blit(const SoftwareSurface&amp; target, const FT_Bitmap&amp; brush, int x_pos, int y_pos) const;
 
   /* disabled for g++-4.2 compatibilty
-  private:
-    BorderFontEffect (const BorderFontEffect&amp;);
-    BorderFontEffect&amp; operator= (const BorderFontEffect&amp;);
+     private:
+     BorderFontEffect (const BorderFontEffect&amp;);
+     BorderFontEffect&amp; operator= (const BorderFontEffect&amp;);
   */
 };
 

Modified: trunk/windstille/src/font/font_effect.hpp
===================================================================
--- trunk/windstille/src/font/font_effect.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/font_effect.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -49,9 +49,9 @@
   virtual void blit(const SoftwareSurface&amp; target, const FT_Bitmap&amp; brush, int x_pos, int y_pos) const =0;
 
   /* disabled for g++-4.2 compatibilty
-private:
-  FontEffect (const FontEffect&amp;);
-  FontEffect&amp; operator= (const FontEffect&amp;);
+     private:
+     FontEffect (const FontEffect&amp;);
+     FontEffect&amp; operator= (const FontEffect&amp;);
   */
 };
 

Modified: trunk/windstille/src/font/fonts.cpp
===================================================================
--- trunk/windstille/src/font/fonts.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/fonts.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,10 +19,10 @@
 #include &quot;font/border_font_effect.hpp&quot;
 #include &quot;font/fonts.hpp&quot;
 
-Fonts::Fonts()
-  : ttffont(new TTFFont(Pathname(&quot;fonts/VeraMono.ttf&quot;), 14, BorderFontEffect(1, true))),
-    vera12(new TTFFont(Pathname(&quot;fonts/Vera.ttf&quot;),     12, BorderFontEffect(2, true))),
-    vera20(new TTFFont(Pathname(&quot;fonts/Vera.ttf&quot;),     20, BorderFontEffect(2, true)))
+Fonts::Fonts() :
+  ttffont(new TTFFont(Pathname(&quot;fonts/VeraMono.ttf&quot;), 14, BorderFontEffect(1, true))),
+  vera12(new TTFFont(Pathname(&quot;fonts/Vera.ttf&quot;),     12, BorderFontEffect(2, true))),
+  vera20(new TTFFont(Pathname(&quot;fonts/Vera.ttf&quot;),     20, BorderFontEffect(2, true)))
 {
 }
 

Modified: trunk/windstille/src/font/no_font_effect.cpp
===================================================================
--- trunk/windstille/src/font/no_font_effect.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/no_font_effect.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -34,15 +34,15 @@
 
   for (int y = start_y; y &lt; end_y; ++y)
     for (int x = start_x; x &lt; end_x; ++x)
-      {
-        int target_pos = (y + y_pos) * target_pitch + 4*(x + x_pos);
-        int brush_pos  = y * brush.pitch + x;
+    {
+      int target_pos = (y + y_pos) * target_pitch + 4*(x + x_pos);
+      int brush_pos  = y * brush.pitch + x;
             
-        target_buf[target_pos + 0] = 255;
-        target_buf[target_pos + 1] = 255;
-        target_buf[target_pos + 2] = 255;
-        target_buf[target_pos + 3] = brush.buffer[brush_pos];
-      }
+      target_buf[target_pos + 0] = 255;
+      target_buf[target_pos + 1] = 255;
+      target_buf[target_pos + 2] = 255;
+      target_buf[target_pos + 3] = brush.buffer[brush_pos];
+    }
 }
 
 /* EOF */

Modified: trunk/windstille/src/font/no_font_effect.hpp
===================================================================
--- trunk/windstille/src/font/no_font_effect.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/no_font_effect.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -39,9 +39,9 @@
   void blit(const SoftwareSurface&amp; target, const FT_Bitmap&amp; brush, int x_pos, int y_pos) const;
   
   /* disabled for g++-4.2 compatibilty
-private:
-  NoFontEffect (const NoFontEffect&amp;);
-  NoFontEffect&amp; operator= (const NoFontEffect&amp;);
+     private:
+     NoFontEffect (const NoFontEffect&amp;);
+     NoFontEffect&amp; operator= (const NoFontEffect&amp;);
   */
 };
 

Modified: trunk/windstille/src/font/ttf_font.cpp
===================================================================
--- trunk/windstille/src/font/ttf_font.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/font/ttf_font.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -31,10 +31,10 @@
 
 TTFCharacter::TTFCharacter(const Rect&amp; pos_,
                            const Rectf&amp; uv_, 
-                           int advance_)
-  : pos(pos_),
-    uv(uv_), 
-    advance(advance_)
+                           int advance_) :
+  pos(pos_),
+  uv(uv_), 
+  advance(advance_)
 {
 }
 
@@ -63,8 +63,8 @@
 
 FT_Library TTFFontImpl::library;
 
-TTFFont::TTFFont(const Pathname&amp; filename, int size_, const FontEffect&amp; effect)
-  : impl(new TTFFontImpl())
+TTFFont::TTFFont(const Pathname&amp; filename, int size_, const FontEffect&amp; effect) :
+  impl(new TTFFontImpl())
 {
   assert(size_ &gt; 0);
 
@@ -78,11 +78,11 @@
   if (FT_New_Memory_Face(TTFFontImpl::library, 
                          reinterpret_cast&lt;FT_Byte*&gt;(&amp;*buffer.begin()), buffer.size(), 
                          0, &amp;face))
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;Couldn't load font: &quot; &lt;&lt; filename;
-      throw std::runtime_error(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;Couldn't load font: &quot; &lt;&lt; filename;
+    throw std::runtime_error(str.str());
+  }
   
   FT_Set_Pixel_Sizes(face, impl-&gt;size, impl-&gt;size);
 
@@ -108,45 +108,45 @@
 
   // We limit ourself to 256 characters for the momemnt
   for(std::vector&lt;uint32_t&gt;::iterator i = characters.begin(); i != characters.end(); ++i)
+  {
+    if (FT_Load_Char( face,  *i, FT_LOAD_RENDER))
     {
-      if (FT_Load_Char( face,  *i, FT_LOAD_RENDER))
-        {
-          // FIXME: What happens when character is not in font, should be handled more gentle
-          throw std::runtime_error(&quot;couldn't load char&quot;);
-        }
-      else
-        {      
-          effect.blit(pixelbuffer, face-&gt;glyph-&gt;bitmap, x_pos, y_pos);
+      // FIXME: What happens when character is not in font, should be handled more gentle
+      throw std::runtime_error(&quot;couldn't load char&quot;);
+    }
+    else
+    {      
+      effect.blit(pixelbuffer, face-&gt;glyph-&gt;bitmap, x_pos, y_pos);
 
-          int glyph_width  = effect.get_glyph_width(face-&gt;glyph-&gt;bitmap.width);
-          int glyph_height = effect.get_glyph_height(face-&gt;glyph-&gt;bitmap.rows);
+      int glyph_width  = effect.get_glyph_width(face-&gt;glyph-&gt;bitmap.width);
+      int glyph_height = effect.get_glyph_height(face-&gt;glyph-&gt;bitmap.rows);
 
-          generate_border(pixelbuffer, x_pos, y_pos, glyph_width, glyph_height);
+      generate_border(pixelbuffer, x_pos, y_pos, glyph_width, glyph_height);
 
-          Rect pos(Point(effect.get_x_offset(face-&gt;glyph-&gt;bitmap_left),
-                         effect.get_y_offset(-face-&gt;glyph-&gt;bitmap_top)),
-                   Size(glyph_width, glyph_height));
+      Rect pos(Point(effect.get_x_offset(face-&gt;glyph-&gt;bitmap_left),
+                     effect.get_y_offset(-face-&gt;glyph-&gt;bitmap_top)),
+               Size(glyph_width, glyph_height));
 
-          Rectf uv(static_cast&lt;float&gt;(x_pos) / static_cast&lt;float&gt;(pixelbuffer.get_width()),
-                   static_cast&lt;float&gt;(y_pos) / static_cast&lt;float&gt;(pixelbuffer.get_height()),
-                   static_cast&lt;float&gt;(x_pos + glyph_width)/static_cast&lt;float&gt;(pixelbuffer.get_width()),
-                   static_cast&lt;float&gt;(y_pos + glyph_height)/static_cast&lt;float&gt;(pixelbuffer.get_height()));
+      Rectf uv(static_cast&lt;float&gt;(x_pos) / static_cast&lt;float&gt;(pixelbuffer.get_width()),
+               static_cast&lt;float&gt;(y_pos) / static_cast&lt;float&gt;(pixelbuffer.get_height()),
+               static_cast&lt;float&gt;(x_pos + glyph_width)/static_cast&lt;float&gt;(pixelbuffer.get_width()),
+               static_cast&lt;float&gt;(y_pos + glyph_height)/static_cast&lt;float&gt;(pixelbuffer.get_height()));
       
-          impl-&gt;characters.push_back(TTFCharacter(pos, uv,
-                                                  face-&gt;glyph-&gt;advance.x &gt;&gt; 6));
+      impl-&gt;characters.push_back(TTFCharacter(pos, uv,
+                                              face-&gt;glyph-&gt;advance.x &gt;&gt; 6));
 
-          // we leave a one pixel border around the letters which we fill with generate_border
-          x_pos += glyph_width + 2;
-          if (x_pos + max_glyph_height + 2 &gt; pixelbuffer.get_width()) // FIXME: should use glyph_width of the next glyph instead of max_glyph_height
-            {
-              y_pos += max_glyph_height + 2;
-              x_pos = 1;
-            }
+      // we leave a one pixel border around the letters which we fill with generate_border
+      x_pos += glyph_width + 2;
+      if (x_pos + max_glyph_height + 2 &gt; pixelbuffer.get_width()) // FIXME: should use glyph_width of the next glyph instead of max_glyph_height
+      {
+        y_pos += max_glyph_height + 2;
+        x_pos = 1;
+      }
 
-          if (y_pos + max_glyph_height + 2 &gt; pixelbuffer.get_height())
-            throw std::runtime_error(&quot;Font Texture to small&quot;);
-        }
+      if (y_pos + max_glyph_height + 2 &gt; pixelbuffer.get_height())
+        throw std::runtime_error(&quot;Font Texture to small&quot;);
     }
+  }
   FT_Done_Face(face);
 
   impl-&gt;texture = Texture(pixelbuffer);
@@ -186,27 +186,27 @@
 
   glBegin(GL_QUADS);
   for(std::string::const_iterator i = str.begin(); i != str.end(); ++i)
-    {
-      const TTFCharacter&amp; character = impl-&gt;characters[*i];
+  {
+    const TTFCharacter&amp; character = impl-&gt;characters[*i];
       
-      glTexCoord2f(character.uv.left, character.uv.top);
-      glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.left),
-                 pos.y + static_cast&lt;float&gt;(character.pos.top));
+    glTexCoord2f(character.uv.left, character.uv.top);
+    glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.left),
+               pos.y + static_cast&lt;float&gt;(character.pos.top));
 
-      glTexCoord2f(character.uv.right, character.uv.top);
-      glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.right),
-                 pos.y + static_cast&lt;float&gt;(character.pos.top));
+    glTexCoord2f(character.uv.right, character.uv.top);
+    glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.right),
+               pos.y + static_cast&lt;float&gt;(character.pos.top));
 
-      glTexCoord2f(character.uv.right, character.uv.bottom);
-      glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.right),
-                 pos.y + static_cast&lt;float&gt;(character.pos.bottom));
+    glTexCoord2f(character.uv.right, character.uv.bottom);
+    glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.right),
+               pos.y + static_cast&lt;float&gt;(character.pos.bottom));
 
-      glTexCoord2f(character.uv.left, character.uv.bottom);
-      glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.left),
-                 pos.y + static_cast&lt;float&gt;(character.pos.bottom));
+    glTexCoord2f(character.uv.left, character.uv.bottom);
+    glVertex2f(pos.x + static_cast&lt;float&gt;(character.pos.left),
+               pos.y + static_cast&lt;float&gt;(character.pos.bottom));
 
-      pos.x += static_cast&lt;float&gt;(character.advance);
-    }
+    pos.x += static_cast&lt;float&gt;(character.advance);
+  }
   glEnd();
 }
 

Modified: trunk/windstille/src/gui/automap.cpp
===================================================================
--- trunk/windstille/src/gui/automap.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/automap.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -49,22 +49,22 @@
 
   for(int y = 0; y &lt; image.get_height(); ++y)
     for(int x = 0; x &lt; image.get_width(); ++x)
+    {
+      if (tilemap-&gt;get_pixel(x, y))
       {
-        if (tilemap-&gt;get_pixel(x, y))
-          {
-            buffer[image.get_pitch() * y + 4*x + 0] = 255;
-            buffer[image.get_pitch() * y + 4*x + 1] = 255;
-            buffer[image.get_pitch() * y + 4*x + 2] = 255;
-            buffer[image.get_pitch() * y + 4*x + 3] = 255;
-          }
-        else
-          {
-            buffer[image.get_pitch() * y + 4*x + 0] = 0;
-            buffer[image.get_pitch() * y + 4*x + 1] = 0;
-            buffer[image.get_pitch() * y + 4*x + 2] = 0;
-            buffer[image.get_pitch() * y + 4*x + 3] = 255;
-          }
+        buffer[image.get_pitch() * y + 4*x + 0] = 255;
+        buffer[image.get_pitch() * y + 4*x + 1] = 255;
+        buffer[image.get_pitch() * y + 4*x + 2] = 255;
+        buffer[image.get_pitch() * y + 4*x + 3] = 255;
       }
+      else
+      {
+        buffer[image.get_pitch() * y + 4*x + 0] = 0;
+        buffer[image.get_pitch() * y + 4*x + 1] = 0;
+        buffer[image.get_pitch() * y + 4*x + 2] = 0;
+        buffer[image.get_pitch() * y + 4*x + 3] = 255;
+      }
+    }
 
   surface = Surface(tilemap-&gt;get_width(), tilemap-&gt;get_height());
   surface.get_texture().set_filter(GL_NEAREST);
@@ -90,31 +90,31 @@
 Automap::update(float delta, const Controller&amp; controller)
 {
   if (controller.get_button_state(AIM_BUTTON))
-    {
-      if (controller.get_axis_state(Y_AXIS) &lt; 0)
-        zoom /= 1.0f + (0.5f * fabsf(controller.get_axis_state(Y_AXIS))) * delta;
-      else if (controller.get_axis_state(Y_AXIS) &gt; 0)
-        zoom *= 1.0f + (0.5f * controller.get_axis_state(Y_AXIS)) * delta;
-    }
+  {
+    if (controller.get_axis_state(Y_AXIS) &lt; 0)
+      zoom /= 1.0f + (0.5f * fabsf(controller.get_axis_state(Y_AXIS))) * delta;
+    else if (controller.get_axis_state(Y_AXIS) &gt; 0)
+      zoom *= 1.0f + (0.5f * controller.get_axis_state(Y_AXIS)) * delta;
+  }
   else
-    {
-      pos.x += controller.get_axis_state(X_AXIS) * delta * 100.0f;
-      pos.y += controller.get_axis_state(Y_AXIS) * delta * 100.0f;
-    }
+  {
+    pos.x += controller.get_axis_state(X_AXIS) * delta * 100.0f;
+    pos.y += controller.get_axis_state(Y_AXIS) * delta * 100.0f;
+  }
 
   for(InputEventLst::const_iterator i = controller.get_events().begin(); i != controller.get_events().end(); ++i) 
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
-        {
-          if (i-&gt;button.name == OK_BUTTON)
-            {
-            }
-          else if (i-&gt;button.name == CANCEL_BUTTON)
-            {
-              set_active(false);
-            }
-        }
+      if (i-&gt;button.name == OK_BUTTON)
+      {
+      }
+      else if (i-&gt;button.name == CANCEL_BUTTON)
+      {
+        set_active(false);
+      }
     }
+  }
 }
 
 } // namespace gui

Modified: trunk/windstille/src/gui/button.cpp
===================================================================
--- trunk/windstille/src/gui/button.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/button.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -58,18 +58,18 @@
   set_active(false);
 
   for(InputEventLst::const_iterator i = controller.get_events().begin(); i != controller.get_events().end(); ++i) 
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
-        {
-          if (i-&gt;button.name == OK_BUTTON)
-            {
-            }
-          else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
-            {            
-              set_active(false);
-            }
-        }
-    }  
+      if (i-&gt;button.name == OK_BUTTON)
+      {
+      }
+      else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
+      {            
+        set_active(false);
+      }
+    }
+  }  
 }
 
 } // namespace gui

Modified: trunk/windstille/src/gui/group_component.cpp
===================================================================
--- trunk/windstille/src/gui/group_component.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/group_component.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -41,16 +41,16 @@
   Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
 
   if (!title.empty())
-    {
-      TTFFont* font = Fonts::current()-&gt;vera20.get();
-      font-&gt;draw_center(Vector2f(rect.left + static_cast&lt;float&gt;(rect.get_width()) / 2.0f,
-                                 rect.top  + static_cast&lt;float&gt;(font-&gt;get_height()) + 5.0f),
-                        title, Color(1.0f, 1.0f, 1.0f));
+  {
+    TTFFont* font = Fonts::current()-&gt;vera20.get();
+    font-&gt;draw_center(Vector2f(rect.left + static_cast&lt;float&gt;(rect.get_width()) / 2.0f,
+                               rect.top  + static_cast&lt;float&gt;(font-&gt;get_height()) + 5.0f),
+                      title, Color(1.0f, 1.0f, 1.0f));
 
-      Display::fill_rect(Rectf(rect.left  + 8.0f, rect.top + static_cast&lt;float&gt;(font-&gt;get_height()) + 16.0f,
-                               rect.right - 8.0f, rect.top + static_cast&lt;float&gt;(font-&gt;get_height()) + 18.0f),
-                         Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
+    Display::fill_rect(Rectf(rect.left  + 8.0f, rect.top + static_cast&lt;float&gt;(font-&gt;get_height()) + 16.0f,
+                             rect.right - 8.0f, rect.top + static_cast&lt;float&gt;(font-&gt;get_height()) + 18.0f),
+                       Color(1.0f, 1.0f, 1.0f, 0.5f));
+  }
 
   if (child.get())
     child-&gt;draw();

Modified: trunk/windstille/src/gui/gui_manager.cpp
===================================================================
--- trunk/windstille/src/gui/gui_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/gui_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,7 +23,7 @@
 namespace gui {
 
 GUIManager::GUIManager()
- : root(new RootComponent(Rectf(0,0,800,600)))
+  : root(new RootComponent(Rectf(0,0,800,600)))
 {
 }
 
@@ -43,10 +43,10 @@
   root-&gt;update(delta, controller);
 
   if (!root-&gt;is_active())
-    {
-      //FIXME: This doesn't work when GUI isn't an overlay
-      ScreenManager::current()-&gt;pop_overlay();
-    }
+  {
+    //FIXME: This doesn't work when GUI isn't an overlay
+    ScreenManager::current()-&gt;pop_overlay();
+  }
 }
 
 RootComponent*

Modified: trunk/windstille/src/gui/list_view.cpp
===================================================================
--- trunk/windstille/src/gui/list_view.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/list_view.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -45,74 +45,74 @@
   float padding = 10;
 
   for(int i = 0; i &lt; int(columns.size()); ++i)
-    {
-      // FIXME: Poor mans outline effect
-      font-&gt;draw_center(Vector2f(x + columns[i].width/2 + 1, y - 1), columns[i].title);
-      font-&gt;draw_center(Vector2f(x + columns[i].width/2 - 1, y - 1), columns[i].title);
-      font-&gt;draw_center(Vector2f(x + columns[i].width/2 + 1, y + 1), columns[i].title);
-      font-&gt;draw_center(Vector2f(x + columns[i].width/2 - 1, y + 1), columns[i].title);
-      font-&gt;draw_center(Vector2f(x + columns[i].width/2, y), columns[i].title, Color(0.0f, 0.0f, 0.0f));
-      x += columns[i].width;
-    }
+  {
+    // FIXME: Poor mans outline effect
+    font-&gt;draw_center(Vector2f(x + columns[i].width/2 + 1, y - 1), columns[i].title);
+    font-&gt;draw_center(Vector2f(x + columns[i].width/2 - 1, y - 1), columns[i].title);
+    font-&gt;draw_center(Vector2f(x + columns[i].width/2 + 1, y + 1), columns[i].title);
+    font-&gt;draw_center(Vector2f(x + columns[i].width/2 - 1, y + 1), columns[i].title);
+    font-&gt;draw_center(Vector2f(x + columns[i].width/2, y), columns[i].title, Color(0.0f, 0.0f, 0.0f));
+    x += columns[i].width;
+  }
 
   for(int j = 0; j &lt; int(items.size()); ++j)
-    {
-      x = rect.left;
+  {
+    x = rect.left;
 
-      if (j == current_item)
-        Display::fill_rect(Rectf(x, y,
-                                 rect.right, y + static_cast&lt;float&gt;(font-&gt;get_height())), 
-                           is_active() ? Color(0.5f, 0.5f, 1.0f, 0.8f) : Color(0.5f, 0.5f, 1.0f, 0.3f));
+    if (j == current_item)
+      Display::fill_rect(Rectf(x, y,
+                               rect.right, y + static_cast&lt;float&gt;(font-&gt;get_height())), 
+                         is_active() ? Color(0.5f, 0.5f, 1.0f, 0.8f) : Color(0.5f, 0.5f, 1.0f, 0.3f));
 
-      y += static_cast&lt;float&gt;(font-&gt;get_height());
+    y += static_cast&lt;float&gt;(font-&gt;get_height());
           
-      for(int i = 0; i &lt; int(items[j].columns.size()) &amp;&amp; i &lt; int(columns.size()); ++i)
-        {
-          font-&gt;draw(Vector2f(x + padding, y), items[j].columns[i]);
+    for(int i = 0; i &lt; int(items[j].columns.size()) &amp;&amp; i &lt; int(columns.size()); ++i)
+    {
+      font-&gt;draw(Vector2f(x + padding, y), items[j].columns[i]);
             
-          x += columns[i].width;
-        }
+      x += columns[i].width;
     }
+  }
 }
 
 void
 ListView::update(float , const Controller&amp; controller)
 {
-   for(InputEventLst::const_iterator i = controller.get_events().begin(); 
-       i != controller.get_events().end(); ++i) 
+  for(InputEventLst::const_iterator i = controller.get_events().begin(); 
+      i != controller.get_events().end(); ++i) 
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
+      if (i-&gt;button.name == OK_BUTTON)
+      {
+        // do something with item (scripting callback)
+      }
+      else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
+      {
+        set_active(false);
+      }
+    }
+    else if (i-&gt;type == AXIS_EVENT)
+    {
+      if (i-&gt;axis.name == Y_AXIS)
+      {
+        if (i-&gt;axis.pos &gt; 0)
         {
-          if (i-&gt;button.name == OK_BUTTON)
-            {
-              // do something with item (scripting callback)
-            }
-          else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
-            {
-              set_active(false);
-            }
+          if (current_item == int(items.size()) - 1)
+            current_item = 0;
+          else
+            current_item += 1;
         }
-      else if (i-&gt;type == AXIS_EVENT)
+        else if (i-&gt;axis.pos &lt; 0)
         {
-          if (i-&gt;axis.name == Y_AXIS)
-            {
-              if (i-&gt;axis.pos &gt; 0)
-                {
-                  if (current_item == int(items.size()) - 1)
-                    current_item = 0;
-                  else
-                    current_item += 1;
-                }
-              else if (i-&gt;axis.pos &lt; 0)
-                {
-                  if (current_item == 0)
-                    current_item = items.size() - 1;
-                  else
-                    current_item -= 1;
-                }
-            }
+          if (current_item == 0)
+            current_item = items.size() - 1;
+          else
+            current_item -= 1;
         }
+      }
     }
+  }
 }
 
 void

Modified: trunk/windstille/src/gui/menu.cpp
===================================================================
--- trunk/windstille/src/gui/menu.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/menu.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -32,10 +32,10 @@
     menu()
 {
   if (!parent)
-    {
-      manager.reset(new GUIManager());
-      parent = manager-&gt;get_root();
-    }  
+  {
+    manager.reset(new GUIManager());
+    parent = manager-&gt;get_root();
+  }  
 
   group.reset(new GroupComponent(rect, name, parent));
   menu.reset(new MenuComponent(group-&gt;get_child_rect(), allow_cancel, group.get()));

Modified: trunk/windstille/src/gui/menu_component.cpp
===================================================================
--- trunk/windstille/src/gui/menu_component.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/menu_component.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -40,7 +40,7 @@
 MenuComponent::~MenuComponent()
 {
   for(Items::iterator i = items.begin(); i != items.end(); ++i)
-      delete *i;
+    delete *i;
   items.clear();
 }
 
@@ -50,11 +50,11 @@
   items.push_back(item);
   
   if (calc_height() &gt;= rect.get_height())
-    {
-      scroll_mode   = true;
-      scroll_offset = 0;
-      num_displayable_items = static_cast&lt;int&gt;(rect.get_height() / item_height());
-    }
+  {
+    scroll_mode   = true;
+    scroll_offset = 0;
+    num_displayable_items = static_cast&lt;int&gt;(rect.get_height() / item_height());
+  }
 }
 
 void
@@ -63,117 +63,117 @@
   float step = item_height();
 
   if (scroll_mode)
-    { // we can only display a subset of items and have to scroll
-      for(int i = 0; i &lt; num_displayable_items; ++i)
-        {
-          items[i+scroll_offset]-&gt;draw(Rectf(rect.left, rect.top + static_cast&lt;float&gt;(i) * step + 2.0f, 
-                                             rect.right - 32.0f, rect.top + static_cast&lt;float&gt;(i+1) * step - 2.0f), 
-                                       is_active() &amp;&amp; (int(i+scroll_offset) == current_item));
-        }
+  { // we can only display a subset of items and have to scroll
+    for(int i = 0; i &lt; num_displayable_items; ++i)
+    {
+      items[i+scroll_offset]-&gt;draw(Rectf(rect.left, rect.top + static_cast&lt;float&gt;(i) * step + 2.0f, 
+                                         rect.right - 32.0f, rect.top + static_cast&lt;float&gt;(i+1) * step - 2.0f), 
+                                   is_active() &amp;&amp; (int(i+scroll_offset) == current_item));
+    }
       
-      // draw scrollbar
-      float scrollbar_height = (rect.get_height() - 4.0f) * static_cast&lt;float&gt;(num_displayable_items) / static_cast&lt;float&gt;(items.size());
-      float scrollbar_incr   = (rect.get_height() - 4.0f) * static_cast&lt;float&gt;(scroll_offset) / static_cast&lt;float&gt;(items.size());
+    // draw scrollbar
+    float scrollbar_height = (rect.get_height() - 4.0f) * static_cast&lt;float&gt;(num_displayable_items) / static_cast&lt;float&gt;(items.size());
+    float scrollbar_incr   = (rect.get_height() - 4.0f) * static_cast&lt;float&gt;(scroll_offset) / static_cast&lt;float&gt;(items.size());
 
-      Display::fill_rounded_rect(Rectf(rect.right - 24, rect.top + 2.0f + scrollbar_incr,
-                                       rect.right - 2,  rect.top + 2.0f + scrollbar_incr + scrollbar_height),
-                                 5.0f,
-                                 Color(0.5f, 0.5f, 0.5f, 0.75f));
+    Display::fill_rounded_rect(Rectf(rect.right - 24, rect.top + 2.0f + scrollbar_incr,
+                                     rect.right - 2,  rect.top + 2.0f + scrollbar_incr + scrollbar_height),
+                               5.0f,
+                               Color(0.5f, 0.5f, 0.5f, 0.75f));
       
-      Display::draw_rounded_rect(Rectf(rect.right - 24, rect.top + 2.0f,
-                                       rect.right - 2,  rect.bottom - 2.0f),
-                                 5.0f,
-                                 Color(1.0f, 1.0f, 1.0f, 1.0f));
-    }
+    Display::draw_rounded_rect(Rectf(rect.right - 24, rect.top + 2.0f,
+                                     rect.right - 2,  rect.bottom - 2.0f),
+                               5.0f,
+                               Color(1.0f, 1.0f, 1.0f, 1.0f));
+  }
   else
-    { // all items fit on the screen
-      for(Items::size_type i = 0; i &lt; items.size(); ++i)
-        {
-          items[i]-&gt;draw(Rectf(rect.left, rect.top + static_cast&lt;float&gt;(i) * step + 2.0f, 
-                               rect.right, rect.top + static_cast&lt;float&gt;(i+1) * step - 2.0f), 
-                         is_active() &amp;&amp; (int(i) == current_item));
-        }
+  { // all items fit on the screen
+    for(Items::size_type i = 0; i &lt; items.size(); ++i)
+    {
+      items[i]-&gt;draw(Rectf(rect.left, rect.top + static_cast&lt;float&gt;(i) * step + 2.0f, 
+                           rect.right, rect.top + static_cast&lt;float&gt;(i+1) * step - 2.0f), 
+                     is_active() &amp;&amp; (int(i) == current_item));
     }
+  }
 }
 
 void
 MenuComponent::update(float delta, const Controller&amp; controller)
 {
   for(Items::size_type i = 0; i &lt; items.size(); ++i)
-    {
-      items[i]-&gt;update(delta);
-    }
+  {
+    items[i]-&gt;update(delta);
+  }
 
   for(InputEventLst::const_iterator i = controller.get_events().begin(); 
       i != controller.get_events().end(); 
       ++i)
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
+      if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
+      {
+        items[current_item]-&gt;click();
+      }
+      else if (i-&gt;button.name == CANCEL_BUTTON || 
+               i-&gt;button.name == ESCAPE_BUTTON ||
+               i-&gt;button.name == PAUSE_BUTTON)
+      {
+        if (allow_cancel) // FIXME: Could use a signal instead
         {
-          if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
-            {
-              items[current_item]-&gt;click();
-            }
-          else if (i-&gt;button.name == CANCEL_BUTTON || 
-                   i-&gt;button.name == ESCAPE_BUTTON ||
-                   i-&gt;button.name == PAUSE_BUTTON)
-            {
-              if (allow_cancel) // FIXME: Could use a signal instead
-                {
-                  SoundManager::current()-&gt;play(Pathname(&quot;sounds/menu_click.wav&quot;, Pathname::kDataPath));
-                  set_active(false);
-                }
-            }
-          else if (i-&gt;button.name == MENU_LEFT_BUTTON)
-            {
-              items[current_item]-&gt;incr();              
-            }
-          else if (i-&gt;button.name == MENU_RIGHT_BUTTON)
-            {
-              items[current_item]-&gt;decr();              
-            }          
-          else if (i-&gt;button.name == MENU_UP_BUTTON)
-            {
-              SoundManager::current()-&gt;play(Pathname(&quot;sounds/menu_change.wav&quot;, Pathname::kDataPath));
+          SoundManager::current()-&gt;play(Pathname(&quot;sounds/menu_click.wav&quot;, Pathname::kDataPath));
+          set_active(false);
+        }
+      }
+      else if (i-&gt;button.name == MENU_LEFT_BUTTON)
+      {
+        items[current_item]-&gt;incr();              
+      }
+      else if (i-&gt;button.name == MENU_RIGHT_BUTTON)
+      {
+        items[current_item]-&gt;decr();              
+      }          
+      else if (i-&gt;button.name == MENU_UP_BUTTON)
+      {
+        SoundManager::current()-&gt;play(Pathname(&quot;sounds/menu_change.wav&quot;, Pathname::kDataPath));
               
-              current_item = current_item - 1;
-              if (current_item &lt; 0)
-                {
-                  if (dynamic_cast&lt;TabComponent*&gt;(parent))
-                    {
-                      current_item = 0;
-                      set_active(false);
-                    }
-                  else
-                    { 
-                      current_item = static_cast&lt;int&gt;(items.size())-1; 
-                    }
-                }
+        current_item = current_item - 1;
+        if (current_item &lt; 0)
+        {
+          if (dynamic_cast&lt;TabComponent*&gt;(parent))
+          {
+            current_item = 0;
+            set_active(false);
+          }
+          else
+          { 
+            current_item = static_cast&lt;int&gt;(items.size())-1; 
+          }
+        }
                   
-              adjust_scroll_offset();
-            }
-          else if (i-&gt;button.name == MENU_DOWN_BUTTON)
-            {
-              SoundManager::current()-&gt;play(Pathname(&quot;sounds/menu_change.wav&quot;, Pathname::kDataPath));
+        adjust_scroll_offset();
+      }
+      else if (i-&gt;button.name == MENU_DOWN_BUTTON)
+      {
+        SoundManager::current()-&gt;play(Pathname(&quot;sounds/menu_change.wav&quot;, Pathname::kDataPath));
 
-              if (dynamic_cast&lt;TabComponent*&gt;(parent))
-                {
-                  current_item = math::mid(0, current_item + 1, static_cast&lt;int&gt;(items.size()-1)); 
-                }
-              else
-                {
-                  current_item += 1;
-                  if (current_item &gt;= static_cast&lt;int&gt;(items.size()))
-                    {
-                      current_item = 0;
-                    }
+        if (dynamic_cast&lt;TabComponent*&gt;(parent))
+        {
+          current_item = math::mid(0, current_item + 1, static_cast&lt;int&gt;(items.size()-1)); 
+        }
+        else
+        {
+          current_item += 1;
+          if (current_item &gt;= static_cast&lt;int&gt;(items.size()))
+          {
+            current_item = 0;
+          }
 
-                }
+        }
 
-              adjust_scroll_offset();
-            }
-        }
+        adjust_scroll_offset();
+      }
     }
+  }
 }
 
 void
@@ -223,16 +223,16 @@
 MenuComponent::adjust_scroll_offset()
 {
   if (scroll_mode)
-    {
-      if (current_item - scroll_offset &gt;= num_displayable_items)
-        { // scrolling down
-          scroll_offset = current_item - (num_displayable_items-1);
-        }
-      else if (current_item &lt; scroll_offset)
-        { // scrolling up
-          scroll_offset = current_item;
-        }
-    }  
+  {
+    if (current_item - scroll_offset &gt;= num_displayable_items)
+    { // scrolling down
+      scroll_offset = current_item - (num_displayable_items-1);
+    }
+    else if (current_item &lt; scroll_offset)
+    { // scrolling up
+      scroll_offset = current_item;
+    }
+  }  
 }
 
 void
@@ -241,15 +241,15 @@
   num_displayable_items = static_cast&lt;int&gt;(rect_.get_height() / item_height());  
 
   if (num_displayable_items &lt; int(items.size()))
-    {
-      scroll_mode   = true;
-      scroll_offset = 0;
-    }
+  {
+    scroll_mode   = true;
+    scroll_offset = 0;
+  }
   else
-    {
-      scroll_mode   = false;
-      scroll_offset = 0;
-    }
+  {
+    scroll_mode   = false;
+    scroll_offset = 0;
+  }
 
   
   Component::set_screen_rect(rect_);

Modified: trunk/windstille/src/gui/root_component.cpp
===================================================================
--- trunk/windstille/src/gui/root_component.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/root_component.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -43,21 +43,21 @@
 RootComponent::draw()
 {
   for(Children::iterator i = children.begin(); i != children.end(); ++i)
-    {
-      (*i)-&gt;draw();
-    }
+  {
+    (*i)-&gt;draw();
+  }
 }
 
 void
 RootComponent::update(float delta, const Controller&amp; controller)
 {
   for(Children::iterator i = children.begin(); i != children.end(); ++i)
-    {
-      if (*i == focus)
-        (*i)-&gt;update(delta, controller);
-      else
-        (*i)-&gt;update(delta, Controller());
-    }
+  {
+    if (*i == focus)
+      (*i)-&gt;update(delta, controller);
+    else
+      (*i)-&gt;update(delta, Controller());
+  }
 }
 
 bool
@@ -81,14 +81,14 @@
 {
   Children::iterator i = std::find(children.begin(), children.end(), child_);
   if (i != children.end())
-    {
-      focus = child_;
-      focus-&gt;set_active(true);
-    }
+  {
+    focus = child_;
+    focus-&gt;set_active(true);
+  }
   else
-    {
-      ConsoleLog &lt;&lt; &quot;Error: Need to add_child() first befor calling set_focus()&quot; &lt;&lt; std::endl;
-    }
+  {
+    ConsoleLog &lt;&lt; &quot;Error: Need to add_child() first befor calling set_focus()&quot; &lt;&lt; std::endl;
+  }
 }
 
 } // namespace gui

Modified: trunk/windstille/src/gui/slider.cpp
===================================================================
--- trunk/windstille/src/gui/slider.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/slider.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -73,51 +73,51 @@
                              rect.top + 2.0f),
                     Sizef(width, rect.get_height() - 4.0f));
   if (is_active())
-    {
-      Display::fill_rect(slider_rect, Color(1.0f, 1.0f, 1.0f, 0.5f));
-      Display::draw_rect(slider_rect, Color(1.0f, 1.0f, 1.0f, 1.0f));
-    }
+  {
+    Display::fill_rect(slider_rect, Color(1.0f, 1.0f, 1.0f, 0.5f));
+    Display::draw_rect(slider_rect, Color(1.0f, 1.0f, 1.0f, 1.0f));
+  }
   else
-    {
-      Display::draw_rect(slider_rect, Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
+  {
+    Display::draw_rect(slider_rect, Color(1.0f, 1.0f, 1.0f, 0.5f));
+  }
 }
 
 void
 Slider::update(float /*delta*/, const Controller&amp; controller)
 {
   for(InputEventLst::const_iterator i = controller.get_events().begin(); i != controller.get_events().end(); ++i) 
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
+      if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
+      {
+              
+      }
+      else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
+      {
+        set_active(false);
+      }
+    }
+    else if (i-&gt;type == AXIS_EVENT)
+    {
+      if (i-&gt;axis.name == X_AXIS)
+      {
+        if (i-&gt;axis.pos &lt; 0)
         {
-          if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
-            {
-              
-            }
-          else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
-            {
-              set_active(false);
-            }
+          pos -= step;
+          if (pos &lt; min) 
+            pos = min;
         }
-      else if (i-&gt;type == AXIS_EVENT)
+        else if (i-&gt;axis.pos &gt; 0)
         {
-          if (i-&gt;axis.name == X_AXIS)
-            {
-              if (i-&gt;axis.pos &lt; 0)
-                {
-                  pos -= step;
-                  if (pos &lt; min) 
-                    pos = min;
-                }
-              else if (i-&gt;axis.pos &gt; 0)
-                {
-                  pos += step;
-                  if (pos &gt; max) 
-                    pos = max;
-                }
-            }
+          pos += step;
+          if (pos &gt; max) 
+            pos = max;
         }
+      }
     }
+  }
 }
 
 int

Modified: trunk/windstille/src/gui/tab_component.cpp
===================================================================
--- trunk/windstille/src/gui/tab_component.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/tab_component.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -49,25 +49,25 @@
 
   float tab_width = rect.get_width() / static_cast&lt;float&gt;(tabs.size());
   for(int i = 0; i != int(tabs.size()); ++i)
-    {
-      Rectf tab_rect(Vector2f(rect.left + tab_width * static_cast&lt;float&gt;(i) + 10.0f,
-                              rect.top),
-                     Sizef(tab_width - 20.0f, static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height()) + 6.0f));
+  {
+    Rectf tab_rect(Vector2f(rect.left + tab_width * static_cast&lt;float&gt;(i) + 10.0f,
+                            rect.top),
+                   Sizef(tab_width - 20.0f, static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height()) + 6.0f));
 
-      if (i == current_tab)
-        Display::fill_rounded_rect(tab_rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-      else
-        Display::fill_rounded_rect(tab_rect, 5.0f, Color(0.0f, 0.0f, 0.0f, 0.5f));
+    if (i == current_tab)
+      Display::fill_rounded_rect(tab_rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+    else
+      Display::fill_rounded_rect(tab_rect, 5.0f, Color(0.0f, 0.0f, 0.0f, 0.5f));
 
-      Display::draw_rounded_rect(tab_rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+    Display::draw_rounded_rect(tab_rect, 5.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
 
-      Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(rect.left + tab_width * static_cast&lt;float&gt;(i) + tab_width/2,
-                                                     rect.top + static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height())),
-                                            tabs[i].label,
-                                            tabs[current_tab].component-&gt;is_active()
-                                            ? Color(1.0f, 1.0f, 1.0f, 0.5f) 
-                                            : Color(1.0f, 1.0f, 1.0f, 1.0f));
-    }
+    Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(rect.left + tab_width * static_cast&lt;float&gt;(i) + tab_width/2,
+                                                   rect.top + static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height())),
+                                          tabs[i].label,
+                                          tabs[current_tab].component-&gt;is_active()
+                                          ? Color(1.0f, 1.0f, 1.0f, 0.5f) 
+                                          : Color(1.0f, 1.0f, 1.0f, 1.0f));
+  }
 
   tabs[current_tab].component-&gt;draw();
 }
@@ -78,59 +78,59 @@
   if (tabs.empty()) return;
 
   if (tabs[current_tab].component-&gt;is_active())
-    {
-      tabs[current_tab].component-&gt;update(delta, controller);
-    }
+  {
+    tabs[current_tab].component-&gt;update(delta, controller);
+  }
   else
+  {
+    tabs[current_tab].component-&gt;update(delta, Controller());
+
+    for(InputEventLst::const_iterator i = controller.get_events().begin(); i != controller.get_events().end(); ++i) 
     {
-      tabs[current_tab].component-&gt;update(delta, Controller());
-
-      for(InputEventLst::const_iterator i = controller.get_events().begin(); i != controller.get_events().end(); ++i) 
+      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
+      {
+        if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
         {
-          if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
-            {
-              if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
-                {
-                  tabs[current_tab].component-&gt;set_active(true);
-                }
-              else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
-                {
-                  tabs[current_tab].component-&gt;set_active(false);
-                  set_active(false);
-                }
-            }
-          else if (i-&gt;type == AXIS_EVENT)
-            {
-              if (i-&gt;axis.name == X_AXIS)
-                {
-                  if (i-&gt;axis.pos &lt; 0)
-                    {
-                      if (current_tab == 0)
-                        current_tab = tabs.size() - 1;
-                      else
-                        current_tab -= 1;
-                    }
-                  else if (i-&gt;axis.pos &gt; 0)
-                    {
-                      if (current_tab == int(tabs.size()) - 1)
-                        current_tab = 0;
-                      else
-                        current_tab += 1;
-                    }
-                }
-              else if (i-&gt;axis.name == Y_AXIS)
-                {
-                  if (i-&gt;axis.pos &lt; 0)
-                    {
-                    }
-                  else if (i-&gt;axis.pos &gt; 0)
-                    {
-                      tabs[current_tab].component-&gt;set_active(true); 
-                    }
-                }
-            }
+          tabs[current_tab].component-&gt;set_active(true);
         }
+        else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
+        {
+          tabs[current_tab].component-&gt;set_active(false);
+          set_active(false);
+        }
+      }
+      else if (i-&gt;type == AXIS_EVENT)
+      {
+        if (i-&gt;axis.name == X_AXIS)
+        {
+          if (i-&gt;axis.pos &lt; 0)
+          {
+            if (current_tab == 0)
+              current_tab = tabs.size() - 1;
+            else
+              current_tab -= 1;
+          }
+          else if (i-&gt;axis.pos &gt; 0)
+          {
+            if (current_tab == int(tabs.size()) - 1)
+              current_tab = 0;
+            else
+              current_tab += 1;
+          }
+        }
+        else if (i-&gt;axis.name == Y_AXIS)
+        {
+          if (i-&gt;axis.pos &lt; 0)
+          {
+          }
+          else if (i-&gt;axis.pos &gt; 0)
+          {
+            tabs[current_tab].component-&gt;set_active(true); 
+          }
+        }
+      }
     }
+  }
 }
 
 void
@@ -143,7 +143,7 @@
                                    rect.top  + padding + static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height()) + 10.0f,
                                    rect.right  - padding,
                                    rect.bottom - padding
-                                   ));
+                               ));
 }
 
 } // namespace gui

Modified: trunk/windstille/src/gui/text_view.cpp
===================================================================
--- trunk/windstille/src/gui/text_view.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/gui/text_view.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -46,19 +46,19 @@
   text_area.set_scroll_offset(text_area.get_scroll_offset() + 500.0f * controller.get_axis_state(Y2_AXIS) * delta);
 
   for(InputEventLst::const_iterator i = controller.get_events().begin(); i != controller.get_events().end(); ++i) 
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.down)
-        {
-          if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
-            {
-              set_active(false);
-            }
-          else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
-            {            
-              set_active(false);
-            }
-        }
-    }  
+      if (i-&gt;button.name == OK_BUTTON || i-&gt;button.name == ENTER_BUTTON)
+      {
+        set_active(false);
+      }
+      else if (i-&gt;button.name == CANCEL_BUTTON || i-&gt;button.name == ESCAPE_BUTTON)
+      {            
+        set_active(false);
+      }
+    }
+  }  
 }
 
 void

Modified: trunk/windstille/src/hud/controller_help_window.cpp
===================================================================
--- trunk/windstille/src/hud/controller_help_window.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/hud/controller_help_window.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -30,15 +30,15 @@
 ControllerHelpWindow::draw_button(const Vector2f&amp; pos, bool pressed)
 {  
   if (pressed)
-    {
-      Display::fill_circle(pos, 12.0f, Color(0.8f, 0.0f, 0.0f));
-      //Display::draw_circle(pos, 12.0f, Color(1.0f, 0.0f, 0.0f));
-    }
+  {
+    Display::fill_circle(pos, 12.0f, Color(0.8f, 0.0f, 0.0f));
+    //Display::draw_circle(pos, 12.0f, Color(1.0f, 0.0f, 0.0f));
+  }
   else
-    {
-      Display::fill_circle(pos, 12.0f, Color(1.0f, 1.0f, 1.0f, 0.2f));
-      //Display::draw_circle(pos, 12.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
+  {
+    Display::fill_circle(pos, 12.0f, Color(1.0f, 1.0f, 1.0f, 0.2f));
+    //Display::draw_circle(pos, 12.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+  }
 }
 
 void
@@ -71,8 +71,8 @@
   
   if (value &gt; 0.0f)
     Display::fill_rect(Rectf(Vector2f(rect.left, rect.top),
-                                     Sizef(rect.get_width() * value,
-                                           rect.get_height())),
+                             Sizef(rect.get_width() * value,
+                                   rect.get_height())),
                        Color(1.0f, 0.0f, 0.0f));
 
   //Display::draw_rect(rect, Color(1.0f, 1.0f, 1.0f, 0.5f));

Modified: trunk/windstille/src/hud/conversation.cpp
===================================================================
--- trunk/windstille/src/hud/conversation.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/hud/conversation.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -36,22 +36,22 @@
 Conversation::add(const std::string&amp; text)
 {
   if (!active)
-    {
-      choices.push_back(Choice(text, &quot;&quot;));
-      if (selection &gt;= int(choices.size()))
-        selection = 0;
-    }
+  {
+    choices.push_back(Choice(text, &quot;&quot;));
+    if (selection &gt;= int(choices.size()))
+      selection = 0;
+  }
 }
 
 void
 Conversation::add(const std::string&amp; topic, const std::string&amp; text)
 {
   if (!active)
-    {
-      choices.push_back(Choice(topic, text));
-      if (selection &gt;= int(choices.size()))
-        selection = 0;
-    }
+  {
+    choices.push_back(Choice(topic, text));
+    if (selection &gt;= int(choices.size()))
+      selection = 0;
+  }
 }
 
 void
@@ -65,50 +65,50 @@
   float segment = 360.0f / static_cast&lt;float&gt;(choices.size());
 
   for(int i = 0; i &lt; static_cast&lt;int&gt;(choices.size()); ++i)
-    { // FIXME:
-      Vector2f offset(0.0f, 1.0f);
-      offset = offset.rotate(math::deg2rad(segment * static_cast&lt;float&gt;(i)) - math::pi/2.0f);
+  { // FIXME:
+    Vector2f offset(0.0f, 1.0f);
+    offset = offset.rotate(math::deg2rad(segment * static_cast&lt;float&gt;(i)) - math::pi/2.0f);
 
-      float start = -segment / 2.0f - 90.0f + segment * static_cast&lt;float&gt;(i);
-      float end   = -segment / 2.0f - 90.0f + segment * static_cast&lt;float&gt;(i+1);
+    float start = -segment / 2.0f - 90.0f + segment * static_cast&lt;float&gt;(i);
+    float end   = -segment / 2.0f - 90.0f + segment * static_cast&lt;float&gt;(i+1);
       
-      float distance = 160.0f;
+    float distance = 160.0f;
 
-      Vector2f textpos = pos + Vector2f(0, 16.0f);
-      // FIXME: Doesn't handle multi line text
-      Sizef size(static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_width(choices[i].topic)) + 40.0f,
-                 static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height()) + 25.0f);
-      Rectf  rect(textpos + distance * offset - Vector2f(size.width/2, size.height - 15), size);
+    Vector2f textpos = pos + Vector2f(0, 16.0f);
+    // FIXME: Doesn't handle multi line text
+    Sizef size(static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_width(choices[i].topic)) + 40.0f,
+               static_cast&lt;float&gt;(Fonts::current()-&gt;vera20-&gt;get_height()) + 25.0f);
+    Rectf  rect(textpos + distance * offset - Vector2f(size.width/2, size.height - 15), size);
 
-      if (i == selection)
-        {
-          rect = rect.grow(grow);
+    if (i == selection)
+    {
+      rect = rect.grow(grow);
           
-          Display::fill_arc(pos, 42.0f, start, end, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
-          Display::fill_rounded_rect(rect, 5.0f, Color(0.5f, 0.5f, 0.5f, 0.75f));
+      Display::fill_arc(pos, 42.0f, start, end, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
+      Display::fill_rounded_rect(rect, 5.0f, Color(0.5f, 0.5f, 0.5f, 0.75f));
 
-          Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(textpos.x + distance * offset.x,
-                                                         textpos.y + distance * offset.y), 
-                                                choices[i].topic, Color(1.0f, 1.0f, 0.0f));
+      Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(textpos.x + distance * offset.x,
+                                                     textpos.y + distance * offset.y), 
+                                            choices[i].topic, Color(1.0f, 1.0f, 0.0f));
           
-          Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(400.0f, static_cast&lt;float&gt;(Display::get_height()) - 32.0f),
-                                                choices[i].text, Color(1.0f, 1.0f, 1.0f));
-          Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 0.0f));
-        }
-      else
-        {
-          Display::fill_rounded_rect(rect, 5.0f, Color(0.25f, 0.25f, 0.25f, 0.75f));
-          Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(textpos.x + distance * offset.x,
-                                            textpos.y + distance * offset.y),
-                                     choices[i].topic, Color(0.8f, 0.8f, 0.8f));
-          Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 1.0f));
-        }
+      Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(400.0f, static_cast&lt;float&gt;(Display::get_height()) - 32.0f),
+                                            choices[i].text, Color(1.0f, 1.0f, 1.0f));
+      Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 0.0f));
+    }
+    else
+    {
+      Display::fill_rounded_rect(rect, 5.0f, Color(0.25f, 0.25f, 0.25f, 0.75f));
+      Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(textpos.x + distance * offset.x,
+                                                     textpos.y + distance * offset.y),
+                                            choices[i].topic, Color(0.8f, 0.8f, 0.8f));
+      Display::draw_rounded_rect(rect, 5.0f, Color(1.0f, 1.0f, 1.0f));
+    }
 
-      //Display::draw_arc(pos + 5.0f * offset, 32.0f,
-      //                  start, end,
-      //                  Color(1.0f, 1.0f, 1.0f, 1.0f), 24);
+    //Display::draw_arc(pos + 5.0f * offset, 32.0f,
+    //                  start, end,
+    //                  Color(1.0f, 1.0f, 1.0f, 1.0f), 24);
 
-    }
+  }
   Display::draw_circle(pos, 42.0f, Color(1.0f, 1.0f, 1.0f, 0.5f), 24);
 
   Display::fill_circle(pos + direction * 34.0f, 8.0f, Color(1.0f, 1.0f, 1.0f));
@@ -130,35 +130,35 @@
 
   if (fabs(controller.get_axis_state(X_AXIS)) &gt; 0.3f ||
       fabs(controller.get_axis_state(Y_AXIS)) &gt; 0.3f)
-    {
-      float segment = 360.0f / static_cast&lt;float&gt;(choices.size());
-      float angle = math::rad2deg(math::normalize_angle(atan2f(direction.y, direction.x) + math::pi/2.0f + math::deg2rad(segment/2.0f)));
+  {
+    float segment = 360.0f / static_cast&lt;float&gt;(choices.size());
+    float angle = math::rad2deg(math::normalize_angle(atan2f(direction.y, direction.x) + math::pi/2.0f + math::deg2rad(segment/2.0f)));
 
-      int new_selection = int(angle / segment);
-      new_selection = math::mid(0, new_selection, int(choices.size()));
+    int new_selection = int(angle / segment);
+    new_selection = math::mid(0, new_selection, int(choices.size()));
 
-      if (new_selection != selection) {
-        selection = new_selection;
-        // FIXME: Might be a good idea to do the woople-size per button, not globaly
-        grow = 0.0f;
-        time = 0;
-      }
+    if (new_selection != selection) {
+      selection = new_selection;
+      // FIXME: Might be a good idea to do the woople-size per button, not globaly
+      grow = 0.0f;
+      time = 0;
     }
+  }
   else
-    {
-      selection = -1;
-    }
+  {
+    selection = -1;
+  }
   
   if (controller.button_was_pressed(OK_BUTTON) &amp;&amp; selection != -1)
-    {
-      active = false;
-      GameSession::current()-&gt;get_pda().add_dialog(&quot;Jane&quot;,
-                                                   choices[selection].topic + &quot; - &quot; +
-                                                   choices[selection].text);
-      choices.clear();
-      GameSession::current()-&gt;set_control_state(GameSession::GAME);
-      ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::CONVERSATION_CLOSED);
-    }
+  {
+    active = false;
+    GameSession::current()-&gt;get_pda().add_dialog(&quot;Jane&quot;,
+                                                 choices[selection].topic + &quot; - &quot; +
+                                                 choices[selection].text);
+    choices.clear();
+    GameSession::current()-&gt;set_control_state(GameSession::GAME);
+    ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::CONVERSATION_CLOSED);
+  }
 }
 
 int

Modified: trunk/windstille/src/hud/dialog_manager.cpp
===================================================================
--- trunk/windstille/src/hud/dialog_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/hud/dialog_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -99,12 +99,12 @@
   text_area-&gt;draw();
 
   if (text_area-&gt;is_progress_complete())
-    {
-      const Vector2f&amp; pos_ = text_area-&gt;get_cursor_pos();
-      Rectf cursor(pos_.x + 8, pos_.y + 8, pos_.x + 24, pos_.y + 24);
-      Display::fill_rect(cursor, Color(1.0, 1.0, 1.0, 
-                                       fabsf(sinf(static_cast&lt;float&gt;(SDL_GetTicks()) / 1000.0f * math::pi * 3.0f))));
-    }
+  {
+    const Vector2f&amp; pos_ = text_area-&gt;get_cursor_pos();
+    Rectf cursor(pos_.x + 8, pos_.y + 8, pos_.x + 24, pos_.y + 24);
+    Display::fill_rect(cursor, Color(1.0, 1.0, 1.0, 
+                                     fabsf(sinf(static_cast&lt;float&gt;(SDL_GetTicks()) / 1000.0f * math::pi * 3.0f))));
+  }
 }
 
 void
@@ -115,23 +115,23 @@
   delay += delta;
 
   InputEventLst events = controller.get_events();
-	
+        
   for (InputEventLst::iterator i = events.begin(); i != events.end(); ++i)
+  {
+    if ((*i).type == BUTTON_EVENT)
     {
-      if ((*i).type == BUTTON_EVENT)
+      if ((*i).button.name == OK_BUTTON &amp;&amp; (*i).button.down == true)
+      {
+        if (text_area-&gt;is_progress_complete())
         {
-          if ((*i).button.name == OK_BUTTON &amp;&amp; (*i).button.down == true)
-            {
-              if (text_area-&gt;is_progress_complete())
-                {
-                  GameSession::current()-&gt;set_control_state(GameSession::GAME);
-                  ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::DIALOG_CLOSED);
-                }
-              else if (delay &gt; 0.2)
-                text_area-&gt;set_progress_complete();
-            } 
+          GameSession::current()-&gt;set_control_state(GameSession::GAME);
+          ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::DIALOG_CLOSED);
         }
+        else if (delay &gt; 0.2)
+          text_area-&gt;set_progress_complete();
+      } 
     }
+  }
 }
 
 void

Modified: trunk/windstille/src/hud/inventory.cpp
===================================================================
--- trunk/windstille/src/hud/inventory.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/hud/inventory.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -101,22 +101,22 @@
   float step_angle = (2.0f * math::pi) / static_cast&lt;float&gt;(num_items);
 
   for(int i = 0; i &lt; int(items.size()); ++i)
+  {
+    const InventoryItem&amp; item = items[(i+current_item) % items.size()];
+    Vector2f draw_pos = pos + Vector2f(128.0f, 0.0f).rotate(step_angle * static_cast&lt;float&gt;(i) - math::pi/2.0f + add_angle);
+
+    if (i == 0 &amp;&amp; moving == 0)
     {
-      const InventoryItem&amp; item = items[(i+current_item) % items.size()];
-      Vector2f draw_pos = pos + Vector2f(128.0f, 0.0f).rotate(step_angle * static_cast&lt;float&gt;(i) - math::pi/2.0f + add_angle);
+      slothighlight.draw(draw_pos);
+      Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(draw_pos.x, draw_pos.y - 64), item.name);
+    }
+    else
+    {
+      slot.draw(draw_pos);
+    }
 
-      if (i == 0 &amp;&amp; moving == 0)
-        {
-          slothighlight.draw(draw_pos);
-          Fonts::current()-&gt;vera20-&gt;draw_center(Vector2f(draw_pos.x, draw_pos.y - 64), item.name);
-        }
-      else
-        {
-          slot.draw(draw_pos);
-        }
-
-      item.sprite.draw(draw_pos - Vector2f(32,32));
-    }
+    item.sprite.draw(draw_pos - Vector2f(32,32));
+  }
 }
 
 void
@@ -136,55 +136,55 @@
 {
   float step_angle = (2.0f * math::pi) / static_cast&lt;float&gt;(items.size());
   if (fabsf(add_angle) &gt; step_angle)
-    {
-      if (moving == 1)
-        decr_current_item();
-      else if (moving == -1)
-        incr_current_item();
+  {
+    if (moving == 1)
+      decr_current_item();
+    else if (moving == -1)
+      incr_current_item();
 
-      moving = 0;
-      add_angle = 0;
-    }
+    moving = 0;
+    add_angle = 0;
+  }
 
   if (controller.get_axis_state(X_AXIS) &lt; -0.5f)
+  {
+    if (moving == 1)
     {
-      if (moving == 1)
-        {
-          add_angle = -step_angle + add_angle;
-          decr_current_item();
-        }
+      add_angle = -step_angle + add_angle;
+      decr_current_item();
+    }
 
-      moving = -1;
-    }
+    moving = -1;
+  }
   else if (controller.get_axis_state(X_AXIS) &gt; 0.5f)
+  {
+    if (moving == -1)
     {
-      if (moving == -1)
-        {
-          add_angle = step_angle + add_angle;
-          incr_current_item();
-        }
-
-      moving =  1;
+      add_angle = step_angle + add_angle;
+      incr_current_item();
     }
 
+    moving =  1;
+  }
+
   if (moving == -1)
-    {
-      add_angle -= 3 * delta;
-    }
+  {
+    add_angle -= 3 * delta;
+  }
   else if (moving == 1)
-    {
-      add_angle += 3 * delta;
-    }
+  {
+    add_angle += 3 * delta;
+  }
 
   if (moving == 0)
+  {
+    if (controller.button_was_pressed(OK_BUTTON) ||
+        controller.button_was_pressed(CANCEL_BUTTON) ||
+        controller.button_was_pressed(INVENTORY_BUTTON))
     {
-      if (controller.button_was_pressed(OK_BUTTON) ||
-          controller.button_was_pressed(CANCEL_BUTTON) ||
-          controller.button_was_pressed(INVENTORY_BUTTON))
-        {
-          GameSession::current()-&gt;set_control_state(GameSession::GAME);
-        }
+      GameSession::current()-&gt;set_control_state(GameSession::GAME);
     }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/hud/pda.cpp
===================================================================
--- trunk/windstille/src/hud/pda.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/hud/pda.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -85,47 +85,47 @@
   const InputEventLst&amp; events = controller.get_events();
 
   for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i) 
+  {
+    if (i-&gt;type == BUTTON_EVENT)
     {
-      if (i-&gt;type == BUTTON_EVENT)
-        {
-          if (i-&gt;axis.name == MENU_LEFT_BUTTON &amp;&amp; i-&gt;button.down) 
-            {
-              state = static_cast&lt;PDAState&gt;(state + 1);
-              if (state &gt; PDA_DIALOGS)
-                state = PDA_OBJECTIVES;
-            }
-          else if (i-&gt;axis.name == MENU_RIGHT_BUTTON &amp;&amp; i-&gt;button.down) 
-            {
-              state = static_cast&lt;PDAState&gt;(state - 1);
-              if (state &lt; PDA_OBJECTIVES)
-                state = PDA_DIALOGS;
-            }
-        }
+      if (i-&gt;axis.name == MENU_LEFT_BUTTON &amp;&amp; i-&gt;button.down) 
+      {
+        state = static_cast&lt;PDAState&gt;(state + 1);
+        if (state &gt; PDA_DIALOGS)
+          state = PDA_OBJECTIVES;
+      }
+      else if (i-&gt;axis.name == MENU_RIGHT_BUTTON &amp;&amp; i-&gt;button.down) 
+      {
+        state = static_cast&lt;PDAState&gt;(state - 1);
+        if (state &lt; PDA_OBJECTIVES)
+          state = PDA_DIALOGS;
+      }
     }
+  }
   
   if (text_area.get())
-    {
-      text_area-&gt;set_scroll_offset(text_area-&gt;get_scroll_offset() + 500.0f * controller.get_axis_state(Y2_AXIS) * delta);
-    }
+  {
+    text_area-&gt;set_scroll_offset(text_area-&gt;get_scroll_offset() + 500.0f * controller.get_axis_state(Y2_AXIS) * delta);
+  }
     
   if (old_state != state) 
+  {
+    old_state = state;
+
+    switch (state) 
     {
-      old_state = state;
+      case PDA_NONE:
+        break;
 
-      switch (state) 
-        {
-          case PDA_NONE:
-            break;
+      case PDA_OBJECTIVES:
+        generate_objectives();
+        break;
 
-          case PDA_OBJECTIVES:
-            generate_objectives();
-            break;
-
-          case PDA_DIALOGS:
-            generate_dialogs();
-            break;
-        }
+      case PDA_DIALOGS:
+        generate_dialogs();
+        break;
     }
+  }
   
   text_area-&gt;update(delta);
 }
@@ -156,21 +156,21 @@
   force_regeneration();
 
   for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) 
-    {
-      if (i-&gt;name == name)
-        i-&gt;complete = true;
-      return;
-    }
+  {
+    if (i-&gt;name == name)
+      i-&gt;complete = true;
+    return;
+  }
 }
 
 bool
 PDA::is_objective_given(const std::string&amp; name)
 {
   for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) 
-    {
-      if (i-&gt;name == name)
-        return true;
-    }
+  {
+    if (i-&gt;name == name)
+      return true;
+  }
   
   return false;
 }
@@ -179,10 +179,10 @@
 PDA::is_objective_complete(const std::string&amp; name)
 {
   for (std::vector&lt;ObjectiveEntry&gt;::iterator i = objectives.begin(); i != objectives.end(); ++i) 
-    {
-      if (i-&gt;name == name &amp;&amp; i-&gt;complete)
-        return true;
-    }
+  {
+    if (i-&gt;name == name &amp;&amp; i-&gt;complete)
+      return true;
+  }
   
   return false;
 }
@@ -195,16 +195,16 @@
   
   std::ostringstream out;
   for (std::vector&lt;ObjectiveEntry&gt;::reverse_iterator i = objectives.rbegin(); i != objectives.rend(); ++i) 
-    {
-      out &lt;&lt; i-&gt;name &lt;&lt; &quot;: &quot;;
+  {
+    out &lt;&lt; i-&gt;name &lt;&lt; &quot;: &quot;;
 
-      if (i-&gt;complete)
-        out &lt;&lt; &quot;complete\n&quot;;
-      else
-        out &lt;&lt; &quot;incomplete\n&quot;;
+    if (i-&gt;complete)
+      out &lt;&lt; &quot;complete\n&quot;;
+    else
+      out &lt;&lt; &quot;incomplete\n&quot;;
 
-      out &lt;&lt; i-&gt;text + &quot;\n\n&quot;;
-    }
+    out &lt;&lt; i-&gt;text + &quot;\n\n&quot;;
+  }
 
   text_area-&gt;set_text(out.str());
 }
@@ -217,12 +217,12 @@
   
   std::ostringstream out;
   for (std::vector&lt;DialogEntry&gt;::reverse_iterator i = dialogs.rbegin(); i != dialogs.rend(); ++i) 
-    {
-      if (i-&gt;character == &quot;Jane&quot;)
-        out &lt;&lt; &quot;&lt;i&gt;&quot; &lt;&lt; i-&gt;character &lt;&lt; &quot;:&lt;/i&gt; &quot; &lt;&lt; i-&gt;text &lt;&lt; '\n';
-      else
-        out &lt;&lt; &quot;&lt;b&gt;&quot; &lt;&lt; i-&gt;character &lt;&lt; &quot;:&lt;/b&gt; &quot; &lt;&lt; i-&gt;text &lt;&lt; '\n';
-    }
+  {
+    if (i-&gt;character == &quot;Jane&quot;)
+      out &lt;&lt; &quot;&lt;i&gt;&quot; &lt;&lt; i-&gt;character &lt;&lt; &quot;:&lt;/i&gt; &quot; &lt;&lt; i-&gt;text &lt;&lt; '\n';
+    else
+      out &lt;&lt; &quot;&lt;b&gt;&quot; &lt;&lt; i-&gt;character &lt;&lt; &quot;:&lt;/b&gt; &quot; &lt;&lt; i-&gt;text &lt;&lt; '\n';
+  }
   text_area-&gt;set_text(out.str());
 }
 

Modified: trunk/windstille/src/hud/speech_manager.cpp
===================================================================
--- trunk/windstille/src/hud/speech_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/hud/speech_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -106,34 +106,34 @@
 SpeechManager::draw()
 {
   for(Speeches::iterator i= speeches.begin(); i != speeches.end(); ++i)
-    {
-      if (*i)
-        (*i)-&gt;draw();
-    }  
+  {
+    if (*i)
+      (*i)-&gt;draw();
+  }  
 }
 
 void
 SpeechManager::update(float delta)
 {
   for(Speeches::iterator i= speeches.begin(); i != speeches.end(); ++i)
-    {
-      if (*i)
-        (*i)-&gt;update(delta);
-    }
+  {
+    if (*i)
+      (*i)-&gt;update(delta);
+  }
 
   for(Speeches::iterator i= speeches.begin(); i != speeches.end(); ++i)
-    {  
-      if ((*i)-&gt;is_done())
-        {
-          ScriptManager::WakeupData event;
-          event.type = ScriptManager::SPEECH_DONE;
-          event.id   = (*i)-&gt;id;
-          ScriptManager::current()-&gt;fire_wakeup_event(event);
+  {  
+    if ((*i)-&gt;is_done())
+    {
+      ScriptManager::WakeupData event;
+      event.type = ScriptManager::SPEECH_DONE;
+      event.id   = (*i)-&gt;id;
+      ScriptManager::current()-&gt;fire_wakeup_event(event);
 
-          delete *i;
-          *i = 0;
-        }
+      delete *i;
+      *i = 0;
     }
+  }
 
   speeches.erase(std::remove(speeches.begin(), speeches.end(), static_cast&lt;Speech*&gt;(0)),
                  speeches.end());

Modified: trunk/windstille/src/input/controller.cpp
===================================================================
--- trunk/windstille/src/input/controller.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/input/controller.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -33,17 +33,17 @@
 {
   float value = get_axis_state(name)/2.0f + 0.5f;
   if (value &lt; 0.001f)
-    {
-      return 0;
-    }
+  {
+    return 0;
+  }
   else if (value &gt; 0.999f)
-    {
-      return 1.0f;
-    }
+  {
+    return 1.0f;
+  }
   else
-    {
-      return value;
-    }
+  {
+    return value;
+  }
 }
 
 float
@@ -52,16 +52,16 @@
   assert(id &lt; int(states.size()));
 
   if (use_deadzone)
-    {
-      if (fabsf(states[id].axis) &gt; 0.25f) // FIXME: Hardcoded Deadzone
-        return states[id].axis;
-      else
-        return 0.0f;
-    }
+  {
+    if (fabsf(states[id].axis) &gt; 0.25f) // FIXME: Hardcoded Deadzone
+      return states[id].axis;
+    else
+      return 0.0f;
+  }
   else
-    {
-      return states[id].axis;
-    }
+  {
+    return states[id].axis;
+  }
 }      
 
 bool
@@ -125,12 +125,12 @@
 Controller::button_was_pressed(int name) const
 {
   for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i)
+  {
+    if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.name == name &amp;&amp; i-&gt;button.down)
     {
-      if (i-&gt;type == BUTTON_EVENT &amp;&amp; i-&gt;button.name == name &amp;&amp; i-&gt;button.down)
-        {
-          return true;
-        }
+      return true;
     }
+  }
   return false;
 }
 
@@ -138,12 +138,12 @@
 Controller::axis_was_pressed_up(int name) const
 {
   for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i)
+  {
+    if (i-&gt;type == AXIS_EVENT &amp;&amp; i-&gt;axis.name == name &amp;&amp; i-&gt;axis.pos &gt; 0.5f)
     {
-      if (i-&gt;type == AXIS_EVENT &amp;&amp; i-&gt;axis.name == name &amp;&amp; i-&gt;axis.pos &gt; 0.5f)
-        {
-          return true;
-        }
+      return true;
     }
+  }
   return false;  
 }
 
@@ -151,12 +151,12 @@
 Controller::axis_was_pressed_down(int name) const
 {
   for(InputEventLst::const_iterator i = events.begin(); i != events.end(); ++i)
+  {
+    if (i-&gt;type == AXIS_EVENT &amp;&amp; i-&gt;axis.name == name &amp;&amp; i-&gt;axis.pos &lt; -0.5f)
     {
-      if (i-&gt;type == AXIS_EVENT &amp;&amp; i-&gt;axis.name == name &amp;&amp; i-&gt;axis.pos &lt; -0.5f)
-        {
-          return true;
-        }
+      return true;
     }
+  }
   return false;
 }
 

Modified: trunk/windstille/src/input/input_configurator.cpp
===================================================================
--- trunk/windstille/src/input/input_configurator.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/input/input_configurator.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -97,22 +97,22 @@
 InputConfigurator::print_item()
 {
   if (!items.empty())
+  {
+    const ConfigureItem&amp; item = items.back();
+      
+    if (item.mode == ConfigureItem::CONFIGURE_AXIS)
     {
-      const ConfigureItem&amp; item = items.back();
-      
-      if (item.mode == ConfigureItem::CONFIGURE_AXIS)
-        {
-          out &lt;&lt; &quot;Configuring &quot; 
-              &lt;&lt; InputManagerSDL::current()-&gt;get_controller_description().get_definition(item.event_id).name
-              &lt;&lt; &quot;: &quot; &lt;&lt; std::endl;
-        }
-      else if (item.mode == ConfigureItem::CONFIGURE_BUTTON)
-        {
-          out &lt;&lt; &quot;Configuring &quot; 
-              &lt;&lt; InputManagerSDL::current()-&gt;get_controller_description().get_definition(item.event_id).name 
-              &lt;&lt; &quot;: &quot; &lt;&lt; std::endl;
-        }
+      out &lt;&lt; &quot;Configuring &quot; 
+          &lt;&lt; InputManagerSDL::current()-&gt;get_controller_description().get_definition(item.event_id).name
+          &lt;&lt; &quot;: &quot; &lt;&lt; std::endl;
     }
+    else if (item.mode == ConfigureItem::CONFIGURE_BUTTON)
+    {
+      out &lt;&lt; &quot;Configuring &quot; 
+          &lt;&lt; InputManagerSDL::current()-&gt;get_controller_description().get_definition(item.event_id).name 
+          &lt;&lt; &quot;: &quot; &lt;&lt; std::endl;
+    }
+  }
 
   area.set_text(out.str());
 }
@@ -124,9 +124,9 @@
   items.pop_back();
 
   if (items.empty())
-    {
-      out &lt;&lt; &quot;Controller configuration is done, pressy any key to continue&quot; &lt;&lt; std::endl;
-    }
+  {
+    out &lt;&lt; &quot;Controller configuration is done, pressy any key to continue&quot; &lt;&lt; std::endl;
+  }
 
   print_item();
 
@@ -137,29 +137,29 @@
 InputConfigurator::handle_event(const SDL_Event&amp; event)
 {
   if (items.empty())
-    {
-      std::cout &lt;&lt; &quot;InputConfigurator: done&quot; &lt;&lt; std::endl;
-      ScreenManager::current()-&gt;pop_overlay();
-      return; 
-    }
+  {
+    std::cout &lt;&lt; &quot;InputConfigurator: done&quot; &lt;&lt; std::endl;
+    ScreenManager::current()-&gt;pop_overlay();
+    return; 
+  }
   
 
   switch(event.type)
-    {        
+  {        
     case SDL_MOUSEMOTION:
       // event.motion:      
       break;
 
     case SDL_MOUSEBUTTONDOWN:
       if (items.back().mode == ConfigureItem::CONFIGURE_BUTTON)
-        {
-          InputManagerSDL::current()-&gt;bind_mouse_button(items.back().event_id,
-                                                        0, // SDL only supports one mouse
-                                                        event.button.button);
-          out &lt;&lt; &quot;(mouse-button (device &quot; &lt;&lt; 0 &lt;&lt; &quot;)\n&quot;
-              &lt;&lt; &quot;              (button &quot; &lt;&lt; int(event.button.button) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
-          next_item();
-        }
+      {
+        InputManagerSDL::current()-&gt;bind_mouse_button(items.back().event_id,
+                                                      0, // SDL only supports one mouse
+                                                      event.button.button);
+        out &lt;&lt; &quot;(mouse-button (device &quot; &lt;&lt; 0 &lt;&lt; &quot;)\n&quot;
+            &lt;&lt; &quot;              (button &quot; &lt;&lt; int(event.button.button) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+        next_item();
+      }
       break;
 
     case SDL_MOUSEBUTTONUP:
@@ -168,15 +168,15 @@
 
     case SDL_JOYAXISMOTION:
       if (items.back().mode == ConfigureItem::CONFIGURE_AXIS &amp;&amp; (event.jaxis.value &gt; 16384 || event.jaxis.value &lt; -16384))
-        { // FIXME: This doesn't work well with analog Axis!
-          InputManagerSDL::current()-&gt;bind_joystick_axis(items.back().event_id, event.jaxis.which, event.jaxis.axis, false);
-          out &lt;&lt; &quot;(joystick-axis (device &quot; &lt;&lt; int(event.jaxis.which) &lt;&lt; &quot;)\n&quot;
-              &lt;&lt; &quot;               (axis   &quot; &lt;&lt; int(event.jaxis.axis) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
-          next_item();
-        }
+      { // FIXME: This doesn't work well with analog Axis!
+        InputManagerSDL::current()-&gt;bind_joystick_axis(items.back().event_id, event.jaxis.which, event.jaxis.axis, false);
+        out &lt;&lt; &quot;(joystick-axis (device &quot; &lt;&lt; int(event.jaxis.which) &lt;&lt; &quot;)\n&quot;
+            &lt;&lt; &quot;               (axis   &quot; &lt;&lt; int(event.jaxis.axis) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+        next_item();
+      }
       else
-        {
-        }
+      {
+      }
       break;
 
     case SDL_JOYBALLMOTION:
@@ -192,31 +192,31 @@
 
     case SDL_JOYBUTTONDOWN:
       if (items.back().mode == ConfigureItem::CONFIGURE_BUTTON)
+      {
+        InputManagerSDL::current()-&gt;bind_joystick_button(items.back().event_id, event.jbutton.which, event.jbutton.button);
+        out &lt;&lt; &quot;(joystick-button (device &quot; &lt;&lt; int(event.jbutton.which) &lt;&lt; &quot;)\n&quot;
+            &lt;&lt; &quot;                 (button &quot; &lt;&lt; int(event.jbutton.button) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+        next_item();
+      }
+      else if (items.back().mode == ConfigureItem::CONFIGURE_AXIS)
+      {
+        if (wait_for_plus &amp;&amp; minus.type == SDL_JOYBUTTONDOWN)
         {
-          InputManagerSDL::current()-&gt;bind_joystick_button(items.back().event_id, event.jbutton.which, event.jbutton.button);
-          out &lt;&lt; &quot;(joystick-button (device &quot; &lt;&lt; int(event.jbutton.which) &lt;&lt; &quot;)\n&quot;
-              &lt;&lt; &quot;                 (button &quot; &lt;&lt; int(event.jbutton.button) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+          out &lt;&lt; &quot;(joystick-axis-button (minus &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(minus.key.keysym.sym) &lt;&lt; &quot;) &quot;
+              &lt;&lt; &quot;(plus  &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(event.key.keysym.sym) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+          InputManagerSDL::current()-&gt;bind_joystick_button_axis(items.back().event_id, event.jbutton.which, 
+                                                                minus.jbutton.button, event.jbutton.button);
           next_item();
+          wait_for_plus = false;
         }
-      else if (items.back().mode == ConfigureItem::CONFIGURE_AXIS)
+        else if (!wait_for_plus)
         {
-          if (wait_for_plus &amp;&amp; minus.type == SDL_JOYBUTTONDOWN)
-            {
-              out &lt;&lt; &quot;(joystick-axis-button (minus &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(minus.key.keysym.sym) &lt;&lt; &quot;) &quot;
-                  &lt;&lt; &quot;(plus  &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(event.key.keysym.sym) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
-              InputManagerSDL::current()-&gt;bind_joystick_button_axis(items.back().event_id, event.jbutton.which, 
-                                                                    minus.jbutton.button, event.jbutton.button);
-              next_item();
-              wait_for_plus = false;
-            }
-          else if (!wait_for_plus)
-            {
-              out &lt;&lt; &quot;Press key for other direction&quot; &lt;&lt; std::endl;
-              area.set_text(out.str());
-              minus = event;
-              wait_for_plus = true;
-            }
+          out &lt;&lt; &quot;Press key for other direction&quot; &lt;&lt; std::endl;
+          area.set_text(out.str());
+          minus = event;
+          wait_for_plus = true;
         }
+      }
       break;
 
     case SDL_KEYUP:
@@ -224,44 +224,44 @@
 
     case SDL_KEYDOWN:
       if (event.key.keysym.sym == SDLK_ESCAPE)
-        {
-          std::cout &lt;&lt; &quot;InputConfigurator: abort&quot; &lt;&lt; std::endl;
-          ScreenManager::current()-&gt;pop_overlay();
-          //next_item();
-        }
+      {
+        std::cout &lt;&lt; &quot;InputConfigurator: abort&quot; &lt;&lt; std::endl;
+        ScreenManager::current()-&gt;pop_overlay();
+        //next_item();
+      }
       else if (event.key.keysym.sym == SDLK_RETURN)
+      {
+        std::cout &lt;&lt; &quot;Binding the enter key is not allowed&quot; &lt;&lt; std::endl;
+      }
+      else
+      {
+        if (items.back().mode == ConfigureItem::CONFIGURE_BUTTON)
         {
-          std::cout &lt;&lt; &quot;Binding the enter key is not allowed&quot; &lt;&lt; std::endl;
+          InputManagerSDL::current()-&gt;bind_keyboard_button(items.back().event_id, event.key.keysym.sym);
+          out &lt;&lt; &quot;(keyboard-button (key &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(event.key.keysym.sym) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+          next_item();
         }
-      else
+        else if (items.back().mode == ConfigureItem::CONFIGURE_AXIS)
         {
-          if (items.back().mode == ConfigureItem::CONFIGURE_BUTTON)
-            {
-              InputManagerSDL::current()-&gt;bind_keyboard_button(items.back().event_id, event.key.keysym.sym);
-              out &lt;&lt; &quot;(keyboard-button (key &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(event.key.keysym.sym) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
-              next_item();
-            }
-          else if (items.back().mode == ConfigureItem::CONFIGURE_AXIS)
-            {
-              if (wait_for_plus &amp;&amp; minus.type == SDL_KEYDOWN)
-                {
-                  out &lt;&lt; &quot;(keyboard-axis (minus &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(minus.key.keysym.sym) &lt;&lt; &quot;) &quot;
-                      &lt;&lt; &quot;(plus  &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(event.key.keysym.sym) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
-                  InputManagerSDL::current()-&gt;bind_keyboard_axis(items.back().event_id, minus.key.keysym.sym, event.key.keysym.sym);
-                  next_item();
-                  wait_for_plus = false;
-                }
-              else if (!wait_for_plus)
-                {
-                  out &lt;&lt; &quot;Print key for other direction&quot; &lt;&lt; std::endl;
-                  area.set_text(out.str());
-                  minus = event;
-                  wait_for_plus = true;
-                }
-            }
+          if (wait_for_plus &amp;&amp; minus.type == SDL_KEYDOWN)
+          {
+            out &lt;&lt; &quot;(keyboard-axis (minus &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(minus.key.keysym.sym) &lt;&lt; &quot;) &quot;
+                &lt;&lt; &quot;(plus  &quot; &lt;&lt; InputManagerSDL::current()-&gt;keyid_to_string(event.key.keysym.sym) &lt;&lt; &quot;))&quot; &lt;&lt; std::endl;
+            InputManagerSDL::current()-&gt;bind_keyboard_axis(items.back().event_id, minus.key.keysym.sym, event.key.keysym.sym);
+            next_item();
+            wait_for_plus = false;
+          }
+          else if (!wait_for_plus)
+          {
+            out &lt;&lt; &quot;Print key for other direction&quot; &lt;&lt; std::endl;
+            area.set_text(out.str());
+            minus = event;
+            wait_for_plus = true;
+          }
         }
+      }
       break;
-    }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/input/input_manager_sdl.cpp
===================================================================
--- trunk/windstille/src/input/input_manager_sdl.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/input/input_manager_sdl.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -85,16 +85,16 @@
     impl-&gt;joysticks.resize(device + 1, 0);
 
   if (!impl-&gt;joysticks[device])
+  {
+    if (SDL_Joystick* joystick = SDL_JoystickOpen(device))
     {
-      if (SDL_Joystick* joystick = SDL_JoystickOpen(device))
-        {
-          impl-&gt;joysticks[device] = joystick;
-        }
-      else
-        {
-          std::cout &lt;&lt; &quot;InputManagerSDL: Couldn't open joystick device &quot; &lt;&lt; device &lt;&lt; std::endl;
-        }
+      impl-&gt;joysticks[device] = joystick;
     }
+    else
+    {
+      std::cout &lt;&lt; &quot;InputManagerSDL: Couldn't open joystick device &quot; &lt;&lt; device &lt;&lt; std::endl;
+    }
+  }
   
 }
 
@@ -120,110 +120,110 @@
   std::vector&lt;FileReader&gt; sections = reader.get_sections();
   
   for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
+  {
+    if (has_suffix(i-&gt;get_name(), &quot;-button&quot;))
     {
-      if (has_suffix(i-&gt;get_name(), &quot;-button&quot;))
+      std::vector&lt;FileReader&gt; dev_sections = i-&gt;get_sections();
+      for(std::vector&lt;FileReader&gt;::iterator j = dev_sections.begin(); j != dev_sections.end(); ++j)
+      {
+        if (j-&gt;get_name() == &quot;joystick-button&quot;)
         {
-          std::vector&lt;FileReader&gt; dev_sections = i-&gt;get_sections();
-          for(std::vector&lt;FileReader&gt;::iterator j = dev_sections.begin(); j != dev_sections.end(); ++j)
-            {
-              if (j-&gt;get_name() == &quot;joystick-button&quot;)
-                {
-                  int device = 0;
-                  int button = 0;
+          int device = 0;
+          int button = 0;
 
-                  j-&gt;get(&quot;device&quot;, device);
-                  j-&gt;get(&quot;button&quot;, button);
+          j-&gt;get(&quot;device&quot;, device);
+          j-&gt;get(&quot;button&quot;, button);
 
-                  bind_joystick_button(controller_description.get_definition(i-&gt;get_name()).id,
-                                       device, button);
-                }
-              else if (j-&gt;get_name() == &quot;joystick-axis-button&quot;)
-                {
-                  int  device;
-                  int  axis;
-                  bool up;
+          bind_joystick_button(controller_description.get_definition(i-&gt;get_name()).id,
+                               device, button);
+        }
+        else if (j-&gt;get_name() == &quot;joystick-axis-button&quot;)
+        {
+          int  device;
+          int  axis;
+          bool up;
 
-                  j-&gt;get(&quot;device&quot;, device);
-                  j-&gt;get(&quot;axis&quot;, axis);
-                  j-&gt;get(&quot;up&quot;, up);
+          j-&gt;get(&quot;device&quot;, device);
+          j-&gt;get(&quot;axis&quot;, axis);
+          j-&gt;get(&quot;up&quot;, up);
 
-                  bind_joystick_axis_button(controller_description.get_definition(i-&gt;get_name()).id,
-                                            device, axis, up);
-                }
-              else if (j-&gt;get_name() == &quot;wiimote-button&quot;)
-                {
-                  int device = 0;
-                  int button = 0;
+          bind_joystick_axis_button(controller_description.get_definition(i-&gt;get_name()).id,
+                                    device, axis, up);
+        }
+        else if (j-&gt;get_name() == &quot;wiimote-button&quot;)
+        {
+          int device = 0;
+          int button = 0;
 
-                  j-&gt;get(&quot;device&quot;, device);
-                  j-&gt;get(&quot;button&quot;, button);
+          j-&gt;get(&quot;device&quot;, device);
+          j-&gt;get(&quot;button&quot;, button);
 
-                  bind_wiimote_button(controller_description.get_definition(i-&gt;get_name()).id,
-                                      device, button);
-                }
-              else if (j-&gt;get_name() == &quot;keyboard-button&quot;)
-                {
-                  std::string key;
+          bind_wiimote_button(controller_description.get_definition(i-&gt;get_name()).id,
+                              device, button);
+        }
+        else if (j-&gt;get_name() == &quot;keyboard-button&quot;)
+        {
+          std::string key;
 
-                  j-&gt;get(&quot;key&quot;, key);
+          j-&gt;get(&quot;key&quot;, key);
 
-                  bind_keyboard_button(controller_description.get_definition(i-&gt;get_name()).id,
-                                       string_to_keyid(key));
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; j-&gt;get_name() &lt;&lt; std::endl;
-                }
-            }
+          bind_keyboard_button(controller_description.get_definition(i-&gt;get_name()).id,
+                               string_to_keyid(key));
         }
-      else if (has_suffix(i-&gt;get_name(), &quot;-axis&quot;))
+        else
         {
-          std::vector&lt;FileReader&gt; dev_sections = i-&gt;get_sections();
-          for(std::vector&lt;FileReader&gt;::iterator j = dev_sections.begin(); j != dev_sections.end(); ++j)
-            {
-              if (j-&gt;get_name() == &quot;joystick-axis&quot;)
-                {
-                  int  device = 0;
-                  int  axis   = 0;
-                  bool invert = false;
+          std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; j-&gt;get_name() &lt;&lt; std::endl;
+        }
+      }
+    }
+    else if (has_suffix(i-&gt;get_name(), &quot;-axis&quot;))
+    {
+      std::vector&lt;FileReader&gt; dev_sections = i-&gt;get_sections();
+      for(std::vector&lt;FileReader&gt;::iterator j = dev_sections.begin(); j != dev_sections.end(); ++j)
+      {
+        if (j-&gt;get_name() == &quot;joystick-axis&quot;)
+        {
+          int  device = 0;
+          int  axis   = 0;
+          bool invert = false;
 
-                  j-&gt;get(&quot;device&quot;, device);
-                  j-&gt;get(&quot;axis&quot;,   axis);
-                  j-&gt;get(&quot;invert&quot;, invert);
+          j-&gt;get(&quot;device&quot;, device);
+          j-&gt;get(&quot;axis&quot;,   axis);
+          j-&gt;get(&quot;invert&quot;, invert);
 
-                  bind_joystick_axis(controller_description.get_definition(i-&gt;get_name()).id,
-                                     device, axis, invert);
-                }
-              else if (j-&gt;get_name() == &quot;keyboard-axis&quot;)
-                {
-                  std::string minus;
-                  std::string plus;
+          bind_joystick_axis(controller_description.get_definition(i-&gt;get_name()).id,
+                             device, axis, invert);
+        }
+        else if (j-&gt;get_name() == &quot;keyboard-axis&quot;)
+        {
+          std::string minus;
+          std::string plus;
 
-                  j-&gt;get(&quot;minus&quot;, minus);
-                  j-&gt;get(&quot;plus&quot;,  plus);
+          j-&gt;get(&quot;minus&quot;, minus);
+          j-&gt;get(&quot;plus&quot;,  plus);
 
-                  bind_keyboard_axis(controller_description.get_definition(i-&gt;get_name()).id, 
-                                     string_to_keyid(minus), string_to_keyid(plus));
-                }
-              else if (j-&gt;get_name() == &quot;wiimote-axis&quot;)
-                {
-                  int  device = 0;
-                  int  axis   = 0;
+          bind_keyboard_axis(controller_description.get_definition(i-&gt;get_name()).id, 
+                             string_to_keyid(minus), string_to_keyid(plus));
+        }
+        else if (j-&gt;get_name() == &quot;wiimote-axis&quot;)
+        {
+          int  device = 0;
+          int  axis   = 0;
                   
-                  j-&gt;get(&quot;device&quot;, device);
-                  j-&gt;get(&quot;axis&quot;,   axis);
+          j-&gt;get(&quot;device&quot;, device);
+          j-&gt;get(&quot;axis&quot;,   axis);
                   
-                  bind_wiimote_axis(controller_description.get_definition(i-&gt;get_name()).id,
-                                    device, axis);
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; j-&gt;get_name() &lt;&lt; std::endl;
-                }
-            }
+          bind_wiimote_axis(controller_description.get_definition(i-&gt;get_name()).id,
+                            device, axis);
+        }
+        else
+        {
+          std::cout &lt;&lt; &quot;InputManagerSDL: Unknown tag: &quot; &lt;&lt; j-&gt;get_name() &lt;&lt; std::endl;
+        }
+      }
 
-        }
     }
+  }
 }
 
 InputManagerSDL::InputManagerSDL(const ControllerDescription&amp; controller_description_)
@@ -259,66 +259,66 @@
 {
   // Hardcoded defaults
   if (event.keysym.sym == SDLK_RETURN)
-    {
-      add_button_event(ENTER_BUTTON, event.state);
-    }
+  {
+    add_button_event(ENTER_BUTTON, event.state);
+  }
   else if (event.keysym.sym == SDLK_ESCAPE)
-    {
-      add_button_event(ESCAPE_BUTTON, event.state);
-    }
+  {
+    add_button_event(ESCAPE_BUTTON, event.state);
+  }
   else if (event.keysym.sym == SDLK_LEFT)
-    {
-      add_button_event(MENU_LEFT_BUTTON, event.state);
-    }
+  {
+    add_button_event(MENU_LEFT_BUTTON, event.state);
+  }
   else if (event.keysym.sym == SDLK_RIGHT)
-    {
-      add_button_event(MENU_RIGHT_BUTTON, event.state);
-    }
+  {
+    add_button_event(MENU_RIGHT_BUTTON, event.state);
+  }
   else if (event.keysym.sym == SDLK_UP)
-    {
-      add_button_event(MENU_UP_BUTTON, event.state);
-    }
+  {
+    add_button_event(MENU_UP_BUTTON, event.state);
+  }
   else if (event.keysym.sym == SDLK_DOWN)
-    {
-      add_button_event(MENU_DOWN_BUTTON, event.state);
-    }
+  {
+    add_button_event(MENU_DOWN_BUTTON, event.state);
+  }
 
   // Dynamic bindings
   for (std::vector&lt;KeyboardButtonBinding&gt;::const_iterator i = impl-&gt;keyboard_button_bindings.begin();
        i != impl-&gt;keyboard_button_bindings.end();
        ++i)
+  {
+    if (event.keysym.sym == i-&gt;key)
     {
-      if (event.keysym.sym == i-&gt;key)
-        {
-          add_button_event(i-&gt;event, event.state);
-        }
+      add_button_event(i-&gt;event, event.state);
     }
+  }
 
   Uint8* keystate = SDL_GetKeyState(0);
 
   for (std::vector&lt;KeyboardAxisBinding&gt;::const_iterator i = impl-&gt;keyboard_axis_bindings.begin();
        i != impl-&gt;keyboard_axis_bindings.end();
        ++i)
+  {
+    if (event.keysym.sym == i-&gt;minus)
     {
-      if (event.keysym.sym == i-&gt;minus)
-        {
-          if (event.state)
-            add_axis_event(i-&gt;event, -1.0f);
-          else if (!keystate[i-&gt;plus])
-            add_axis_event(i-&gt;event, 0.0f);
-        }
-      else if (event.keysym.sym == i-&gt;plus)
-        {
-          if (event.state)
-            {
-              add_axis_event(i-&gt;event, 1.0f);
-            }
-          else if (!keystate[i-&gt;minus])
-            {
-              add_axis_event(i-&gt;event, 0.0f);
-            }
-        }
+      if (event.state)
+        add_axis_event(i-&gt;event, -1.0f);
+      else if (!keystate[i-&gt;plus])
+        add_axis_event(i-&gt;event, 0.0f);
     }
+    else if (event.keysym.sym == i-&gt;plus)
+    {
+      if (event.state)
+      {
+        add_axis_event(i-&gt;event, 1.0f);
+      }
+      else if (!keystate[i-&gt;minus])
+      {
+        add_axis_event(i-&gt;event, 0.0f);
+      }
+    }
+  }
 }
 
 void
@@ -327,12 +327,12 @@
   for (std::vector&lt;MouseButtonBinding&gt;::const_iterator i = impl-&gt;mouse_button_bindings.begin();
        i != impl-&gt;mouse_button_bindings.end();
        ++i)
+  {
+    if (button.button == i-&gt;button)
     {
-      if (button.button == i-&gt;button)
-        {
-          add_button_event(i-&gt;event, button.state);
-        }
+      add_button_event(i-&gt;event, button.state);
     }
+  }
 }
 
 void
@@ -341,30 +341,30 @@
   for (std::vector&lt;JoystickButtonBinding&gt;::const_iterator i = impl-&gt;joystick_button_bindings.begin();
        i != impl-&gt;joystick_button_bindings.end();
        ++i)
+  {
+    if (button.which  == i-&gt;device &amp;&amp;
+        button.button == i-&gt;button)
     {
-      if (button.which  == i-&gt;device &amp;&amp;
-          button.button == i-&gt;button)
-        {
-          add_button_event(i-&gt;event, button.state);
-        }
+      add_button_event(i-&gt;event, button.state);
     }
+  }
 
   for (std::vector&lt;JoystickButtonAxisBinding&gt;::const_iterator i = impl-&gt;joystick_button_axis_bindings.begin();
        i != impl-&gt;joystick_button_axis_bindings.end();
        ++i)
+  {
+    if (button.which  == i-&gt;device)
     {
-      if (button.which  == i-&gt;device)
-        {
-          if (button.button == i-&gt;minus)
-            {
-              add_axis_event(i-&gt;event, button.state ? -1.0f : 0.0f);
-            }
-          else if (button.button == i-&gt;plus)
-            {
-              add_axis_event(i-&gt;event, button.state ?  1.0f : 0.0f);
-            }
-        }
+      if (button.button == i-&gt;minus)
+      {
+        add_axis_event(i-&gt;event, button.state ? -1.0f : 0.0f);
+      }
+      else if (button.button == i-&gt;plus)
+      {
+        add_axis_event(i-&gt;event, button.state ?  1.0f : 0.0f);
+      }
     }
+  }
 }
 
 void
@@ -373,69 +373,69 @@
   for (std::vector&lt;JoystickAxisBinding&gt;::const_iterator i = impl-&gt;joystick_axis_bindings.begin();
        i != impl-&gt;joystick_axis_bindings.end();
        ++i)
+  {
+    if (event.which  == i-&gt;device &amp;&amp;
+        event.axis   == i-&gt;axis)
     {
-      if (event.which  == i-&gt;device &amp;&amp;
-          event.axis   == i-&gt;axis)
-        {
-          if (abs(event.value) &gt; dead_zone)
-            {
-              add_axis_event(i-&gt;event, static_cast&lt;float&gt;(event.value) / (i-&gt;invert ? -32768.0f : 32768.0f));
-            }
-          else
-            {
-              add_axis_event(i-&gt;event, 0);
-            }
-        }
+      if (abs(event.value) &gt; dead_zone)
+      {
+        add_axis_event(i-&gt;event, static_cast&lt;float&gt;(event.value) / (i-&gt;invert ? -32768.0f : 32768.0f));
+      }
+      else
+      {
+        add_axis_event(i-&gt;event, 0);
+      }
     }
+  }
 
   for(std::vector&lt;JoystickAxisButtonBinding&gt;::const_iterator i = impl-&gt;joystick_axis_button_bindings.begin();
       i != impl-&gt;joystick_axis_button_bindings.end();
       ++i)
+  {
+    if (event.which == i-&gt;device &amp;&amp;
+        event.axis  == i-&gt;axis)
     {
-      if (event.which == i-&gt;device &amp;&amp;
-          event.axis  == i-&gt;axis)
-        {
-          if (i-&gt;up)
-            { // signal button press when axis is up
-              if (event.value &lt; -dead_zone)
-                add_button_event(i-&gt;event, true);
-              else 
-                add_button_event(i-&gt;event, false);
-            }
-          else
-            { // signal button press when axis is down
-              if (event.value &gt; dead_zone)
-                add_button_event(i-&gt;event, true);
-              else
-                add_button_event(i-&gt;event, false);
-            }
-        }
+      if (i-&gt;up)
+      { // signal button press when axis is up
+        if (event.value &lt; -dead_zone)
+          add_button_event(i-&gt;event, true);
+        else 
+          add_button_event(i-&gt;event, false);
+      }
+      else
+      { // signal button press when axis is down
+        if (event.value &gt; dead_zone)
+          add_button_event(i-&gt;event, true);
+        else
+          add_button_event(i-&gt;event, false);
+      }
     }
+  }
 }
 
 void
 InputManagerSDL::on_event(const SDL_Event&amp; event)
 {
   switch(event.type)
-    {        
+  {        
     case SDL_KEYUP:
     case SDL_KEYDOWN:
+    {
+      if (event.key.state)
       {
-        if (event.key.state)
-          {
-            if ((event.key.keysym.unicode &gt; 0 &amp;&amp; event.key.keysym.unicode &lt; 128)
-                &amp;&amp; (isgraph(event.key.keysym.unicode) || event.key.keysym.unicode == ' '))
-              {
-                add_keyboard_event(0, KeyboardEvent::LETTER, event.key.keysym.unicode);
-              }
-            else
-              {
-                add_keyboard_event(0, KeyboardEvent::SPECIAL, event.key.keysym.sym);
-              }
-          }
+        if ((event.key.keysym.unicode &gt; 0 &amp;&amp; event.key.keysym.unicode &lt; 128)
+            &amp;&amp; (isgraph(event.key.keysym.unicode) || event.key.keysym.unicode == ' '))
+        {
+          add_keyboard_event(0, KeyboardEvent::LETTER, event.key.keysym.unicode);
+        }
+        else
+        {
+          add_keyboard_event(0, KeyboardEvent::SPECIAL, event.key.keysym.sym);
+        }
       }
-      on_key_event(event.key);
-      break;
+    }
+    on_key_event(event.key);
+    break;
 
     case SDL_MOUSEMOTION:
       // event.motion
@@ -473,7 +473,7 @@
     default:
       std::cout &lt;&lt; &quot;InputManagerSDL: unknown event&quot; &lt;&lt; std::endl;
       break;
-    }
+  }
 }
 
 void
@@ -481,73 +481,73 @@
 {
 #ifdef HAVE_CWIID
   if (wiimote &amp;&amp; wiimote-&gt;is_connected())
+  {
+    // Check for new events from the Wiimote
+    std::vector&lt;WiimoteEvent&gt; events = wiimote-&gt;pop_events();
+    for(std::vector&lt;WiimoteEvent&gt;::iterator i = events.begin(); i != events.end(); ++i)
     {
-      // Check for new events from the Wiimote
-      std::vector&lt;WiimoteEvent&gt; events = wiimote-&gt;pop_events();
-      for(std::vector&lt;WiimoteEvent&gt;::iterator i = events.begin(); i != events.end(); ++i)
+      WiimoteEvent&amp; event = *i;
+      if (event.type == WiimoteEvent::WIIMOTE_BUTTON_EVENT)
+      {
+        //std::cout &lt;&lt; &quot;WiimoteButton: &quot; &lt;&lt; event.button.button &lt;&lt; &quot; &quot; &lt;&lt; event.button.down &lt;&lt; std::endl;
+
+        for (std::vector&lt;WiimoteButtonBinding&gt;::const_iterator j = impl-&gt;wiimote_button_bindings.begin();
+             j != impl-&gt;wiimote_button_bindings.end();
+             ++j)
         {
-          WiimoteEvent&amp; event = *i;
-          if (event.type == WiimoteEvent::WIIMOTE_BUTTON_EVENT)
-            {
-              //std::cout &lt;&lt; &quot;WiimoteButton: &quot; &lt;&lt; event.button.button &lt;&lt; &quot; &quot; &lt;&lt; event.button.down &lt;&lt; std::endl;
+          if (event.button.device == j-&gt;device &amp;&amp;
+              event.button.button == j-&gt;button)
+          {
+            add_button_event(j-&gt;event, event.button.down);
+          }
+        }
+      }
+      else if (event.type == WiimoteEvent::WIIMOTE_AXIS_EVENT)
+      {
+        //std::cout &lt;&lt; &quot;WiimoteAxis: &quot; &lt;&lt; event.axis.axis &lt;&lt; &quot; &quot; &lt;&lt; event.axis.pos &lt;&lt; std::endl;
 
-              for (std::vector&lt;WiimoteButtonBinding&gt;::const_iterator j = impl-&gt;wiimote_button_bindings.begin();
-                   j != impl-&gt;wiimote_button_bindings.end();
-                   ++j)
-                {
-                  if (event.button.device == j-&gt;device &amp;&amp;
-                      event.button.button == j-&gt;button)
-                    {
-                      add_button_event(j-&gt;event, event.button.down);
-                    }
-                }
-            }
-          else if (event.type == WiimoteEvent::WIIMOTE_AXIS_EVENT)
-            {
-              //std::cout &lt;&lt; &quot;WiimoteAxis: &quot; &lt;&lt; event.axis.axis &lt;&lt; &quot; &quot; &lt;&lt; event.axis.pos &lt;&lt; std::endl;
-
-              for (std::vector&lt;WiimoteAxisBinding&gt;::const_iterator j = impl-&gt;wiimote_axis_bindings.begin();
-                   j != impl-&gt;wiimote_axis_bindings.end();
-                   ++j)
-                {
-                  if (event.axis.device == j-&gt;device &amp;&amp;
-                      event.axis.axis == j-&gt;axis)
-                    {
-                      add_axis_event(j-&gt;event, event.axis.pos);
-                    }
-                }
-            }
-          else if (event.type == WiimoteEvent::WIIMOTE_ACC_EVENT)
-            {
-              if (event.acc.accelerometer == 0)
-                {
-                  if (0)
-                    printf(&quot;%d - %6.3f %6.3f %6.3f\n&quot;,  
-                           event.acc.accelerometer,
-                           event.acc.x,
-                           event.acc.y,
-                           event.acc.z);
+        for (std::vector&lt;WiimoteAxisBinding&gt;::const_iterator j = impl-&gt;wiimote_axis_bindings.begin();
+             j != impl-&gt;wiimote_axis_bindings.end();
+             ++j)
+        {
+          if (event.axis.device == j-&gt;device &amp;&amp;
+              event.axis.axis == j-&gt;axis)
+          {
+            add_axis_event(j-&gt;event, event.axis.pos);
+          }
+        }
+      }
+      else if (event.type == WiimoteEvent::WIIMOTE_ACC_EVENT)
+      {
+        if (event.acc.accelerometer == 0)
+        {
+          if (0)
+            printf(&quot;%d - %6.3f %6.3f %6.3f\n&quot;,  
+                   event.acc.accelerometer,
+                   event.acc.x,
+                   event.acc.y,
+                   event.acc.z);
                  
-                  float roll = atanf(static_cast&lt;float&gt;(event.acc.x / event.acc.z));
-                  if (event.acc.z &lt;= 0.0) {
-                    roll += math::pi * ((event.acc.x &gt; 0.0f) ? 1.0f : -1.0f);
-                  }
-                  roll *= -1;
+          float roll = atanf(static_cast&lt;float&gt;(event.acc.x / event.acc.z));
+          if (event.acc.z &lt;= 0.0) {
+            roll += math::pi * ((event.acc.x &gt; 0.0f) ? 1.0f : -1.0f);
+          }
+          roll *= -1;
 
-                  float pitch = atanf(event.acc.y / event.acc.z * cosf(roll));
+          float pitch = atanf(event.acc.y / event.acc.z * cosf(roll));
 
-                  add_axis_event(X2_AXIS, math::mid(-1.0f, -float(pitch / M_PI), 1.0f));
-                  add_axis_event(Y2_AXIS, math::mid(-1.0f, -float(roll  / M_PI), 1.0f));
+          add_axis_event(X2_AXIS, math::mid(-1.0f, -float(pitch / M_PI), 1.0f));
+          add_axis_event(Y2_AXIS, math::mid(-1.0f, -float(roll  / M_PI), 1.0f));
 
-                  std::cout &lt;&lt; boost::format(&quot;%|6.3f| %|6.3f|&quot;) % pitch % roll &lt;&lt; std::endl;
-                }
-            }
-          else
-            {
-              assert(!&quot;Never reached&quot;);
-            }
+          std::cout &lt;&lt; boost::format(&quot;%|6.3f| %|6.3f|&quot;) % pitch % roll &lt;&lt; std::endl;
         }
+      }
+      else
+      {
+        assert(!&quot;Never reached&quot;);
+      }
     }
+  }
 #endif
 }
 
@@ -703,53 +703,53 @@
   // FIXME: need state info
   float old_pos = controller.get_axis_state(name);
   if (name == X_AXIS)
+  {
+    if (controller.get_button_state(MENU_LEFT_BUTTON) == 0 &amp;&amp;
+        pos &lt; -click_threshold &amp;&amp; old_pos &gt; -click_threshold) 
     {
-      if (controller.get_button_state(MENU_LEFT_BUTTON) == 0 &amp;&amp;
-          pos &lt; -click_threshold &amp;&amp; old_pos &gt; -click_threshold) 
-        {
-          add_button_event(MENU_LEFT_BUTTON, 1);
-        } 
-      else if (controller.get_button_state(MENU_LEFT_BUTTON) == 1 &amp;&amp;
-               old_pos &lt; -release_threshold &amp;&amp; pos &gt; -release_threshold) 
-        {
-          add_button_event(MENU_LEFT_BUTTON, 0);
-        } 
+      add_button_event(MENU_LEFT_BUTTON, 1);
+    } 
+    else if (controller.get_button_state(MENU_LEFT_BUTTON) == 1 &amp;&amp;
+             old_pos &lt; -release_threshold &amp;&amp; pos &gt; -release_threshold) 
+    {
+      add_button_event(MENU_LEFT_BUTTON, 0);
+    } 
       
-      else if (controller.get_button_state(MENU_RIGHT_BUTTON) == 0 &amp;&amp;
-               pos &gt; click_threshold &amp;&amp; old_pos &lt; click_threshold) 
-        {
-          add_button_event(MENU_RIGHT_BUTTON, 1);
-        } 
-      else  if (controller.get_button_state(MENU_RIGHT_BUTTON) == 1 &amp;&amp;
-                old_pos &gt; release_threshold &amp;&amp; pos &lt; release_threshold) 
-        {
-          add_button_event(MENU_RIGHT_BUTTON, 0);
-        }
+    else if (controller.get_button_state(MENU_RIGHT_BUTTON) == 0 &amp;&amp;
+             pos &gt; click_threshold &amp;&amp; old_pos &lt; click_threshold) 
+    {
+      add_button_event(MENU_RIGHT_BUTTON, 1);
+    } 
+    else  if (controller.get_button_state(MENU_RIGHT_BUTTON) == 1 &amp;&amp;
+              old_pos &gt; release_threshold &amp;&amp; pos &lt; release_threshold) 
+    {
+      add_button_event(MENU_RIGHT_BUTTON, 0);
     }
+  }
   else if (name == Y_AXIS)
+  {
+    if (controller.get_button_state(MENU_UP_BUTTON) == 0 &amp;&amp;
+        pos &lt; -click_threshold &amp;&amp; old_pos &gt; -click_threshold) 
     {
-      if (controller.get_button_state(MENU_UP_BUTTON) == 0 &amp;&amp;
-          pos &lt; -click_threshold &amp;&amp; old_pos &gt; -click_threshold) 
-        {
-          add_button_event(MENU_UP_BUTTON, 1);
-        } 
-      else if (controller.get_button_state(MENU_UP_BUTTON) == 1 &amp;&amp;
-               old_pos &lt; -release_threshold &amp;&amp; pos &gt; -release_threshold) 
-        {
-          add_button_event(MENU_UP_BUTTON, 0);
-        }
+      add_button_event(MENU_UP_BUTTON, 1);
+    } 
+    else if (controller.get_button_state(MENU_UP_BUTTON) == 1 &amp;&amp;
+             old_pos &lt; -release_threshold &amp;&amp; pos &gt; -release_threshold) 
+    {
+      add_button_event(MENU_UP_BUTTON, 0);
+    }
 
-      else  if (controller.get_button_state(MENU_DOWN_BUTTON) == 0 &amp;&amp;
-                pos &gt; click_threshold &amp;&amp; old_pos &lt; click_threshold) 
-        {
-          add_button_event(MENU_DOWN_BUTTON, 1);
-        } 
-      else  if (controller.get_button_state(MENU_DOWN_BUTTON) == 1 &amp;&amp;
-                old_pos &gt; release_threshold &amp;&amp; pos &lt; release_threshold) 
-        {
-          add_button_event(MENU_DOWN_BUTTON, 0);
-        }
+    else  if (controller.get_button_state(MENU_DOWN_BUTTON) == 0 &amp;&amp;
+              pos &gt; click_threshold &amp;&amp; old_pos &lt; click_threshold) 
+    {
+      add_button_event(MENU_DOWN_BUTTON, 1);
+    } 
+    else  if (controller.get_button_state(MENU_DOWN_BUTTON) == 1 &amp;&amp;
+              old_pos &gt; release_threshold &amp;&amp; pos &lt; release_threshold) 
+    {
+      add_button_event(MENU_DOWN_BUTTON, 0);
     }
+  }
 
   InputManager::add_axis_event(name, pos);
 }

Modified: trunk/windstille/src/input/wiimote.cpp
===================================================================
--- trunk/windstille/src/input/wiimote.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/input/wiimote.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -82,100 +82,100 @@
   printf(&quot;Put Wiimote in discoverable mode now (press 1+2)...\n&quot;);
 
   if (!(m_wiimote = cwiid_connect(&amp;bdaddr, CWIID_FLAG_MESG_IFC))) 
+  {
+    fprintf(stderr, &quot;Unable to connect to wiimote\n&quot;);
+  }
+  else 
+  {
+    std::cout &lt;&lt; &quot;Wiimote connected: &quot; &lt;&lt; m_wiimote &lt;&lt; std::endl;
+    if (cwiid_set_mesg_callback(m_wiimote, &amp;Wiimote::mesg_callback)) {
+      std::cerr &lt;&lt; &quot;Unable to set message callback&quot; &lt;&lt; std::endl;
+    }
+
+    if (cwiid_command(m_wiimote, CWIID_CMD_RPT_MODE, 
+                      CWIID_RPT_STATUS  |
+                      CWIID_RPT_NUNCHUK |
+                      CWIID_RPT_ACC     |
+                      CWIID_RPT_BTN))
     {
-      fprintf(stderr, &quot;Unable to connect to wiimote\n&quot;);
+      std::cerr &lt;&lt; &quot;Wiimote: Error setting report mode&quot; &lt;&lt; std::endl;
     }
-  else 
-    {
-      std::cout &lt;&lt; &quot;Wiimote connected: &quot; &lt;&lt; m_wiimote &lt;&lt; std::endl;
-      if (cwiid_set_mesg_callback(m_wiimote, &amp;Wiimote::mesg_callback)) {
-        std::cerr &lt;&lt; &quot;Unable to set message callback&quot; &lt;&lt; std::endl;
-      }
 
-      if (cwiid_command(m_wiimote, CWIID_CMD_RPT_MODE, 
-                        CWIID_RPT_STATUS  |
-                        CWIID_RPT_NUNCHUK |
-                        CWIID_RPT_ACC     |
-                        CWIID_RPT_BTN))
-        {
-          std::cerr &lt;&lt; &quot;Wiimote: Error setting report mode&quot; &lt;&lt; std::endl;
-        }
+    { // read calibration data
+      uint8_t buf[7];
 
-      { // read calibration data
-	uint8_t buf[7];
+      if (cwiid_read(m_wiimote, CWIID_RW_EEPROM, 0x16, 7, buf))
+      {
+        std::cout &lt;&lt; &quot;Wiimote: Unable to retrieve accelerometer calibration&quot; &lt;&lt; std::endl;
+      }
+      else
+      {
+        wiimote_zero.x = buf[0];
+        wiimote_zero.y = buf[1];
+        wiimote_zero.z = buf[2];
 
-        if (cwiid_read(m_wiimote, CWIID_RW_EEPROM, 0x16, 7, buf))
-          {
-            std::cout &lt;&lt; &quot;Wiimote: Unable to retrieve accelerometer calibration&quot; &lt;&lt; std::endl;
-          }
-        else
-          {
-            wiimote_zero.x = buf[0];
-            wiimote_zero.y = buf[1];
-            wiimote_zero.z = buf[2];
+        wiimote_one.x  = buf[4];
+        wiimote_one.y  = buf[5];
+        wiimote_one.z  = buf[6];
+      }
 
-            wiimote_one.x  = buf[4];
-            wiimote_one.y  = buf[5];
-            wiimote_one.z  = buf[6];
-          }
-
-        if (cwiid_read(m_wiimote, CWIID_RW_REG | CWIID_RW_DECODE, 0xA40020, 7, buf))
-          {
-            std::cout &lt;&lt; &quot;Wiimote: Unable to retrieve wiimote accelerometer calibration&quot; &lt;&lt; std::endl;
-          }
-        else
-          {
-            nunchuk_zero.x = buf[0];
-            nunchuk_zero.y = buf[1];
-            nunchuk_zero.z = buf[2];
+      if (cwiid_read(m_wiimote, CWIID_RW_REG | CWIID_RW_DECODE, 0xA40020, 7, buf))
+      {
+        std::cout &lt;&lt; &quot;Wiimote: Unable to retrieve wiimote accelerometer calibration&quot; &lt;&lt; std::endl;
+      }
+      else
+      {
+        nunchuk_zero.x = buf[0];
+        nunchuk_zero.y = buf[1];
+        nunchuk_zero.z = buf[2];
             
-            nunchuk_one.x  = buf[4];
-            nunchuk_one.y  = buf[5];
-            nunchuk_one.z  = buf[6];
-          }
+        nunchuk_one.x  = buf[4];
+        nunchuk_one.y  = buf[5];
+        nunchuk_one.z  = buf[6];
+      }
 
-        std::cout &lt;&lt; &quot;Wiimote Calibration: &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(wiimote_zero.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(wiimote_zero.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(wiimote_zero.x) &lt;&lt; &quot; - &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(wiimote_one.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(wiimote_one.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(wiimote_one.x) &lt;&lt; std::endl;
+      std::cout &lt;&lt; &quot;Wiimote Calibration: &quot;
+                &lt;&lt; static_cast&lt;int&gt;(wiimote_zero.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(wiimote_zero.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(wiimote_zero.x) &lt;&lt; &quot; - &quot;
+                &lt;&lt; static_cast&lt;int&gt;(wiimote_one.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(wiimote_one.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(wiimote_one.x) &lt;&lt; std::endl;
 
-        std::cout &lt;&lt; &quot;Nunchuk Calibration: &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(nunchuk_zero.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(nunchuk_zero.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(nunchuk_zero.x) &lt;&lt; &quot; - &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(nunchuk_one.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(nunchuk_one.x) &lt;&lt; &quot;, &quot;
-                  &lt;&lt; static_cast&lt;int&gt;(nunchuk_one.x) &lt;&lt; std::endl;
+      std::cout &lt;&lt; &quot;Nunchuk Calibration: &quot;
+                &lt;&lt; static_cast&lt;int&gt;(nunchuk_zero.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(nunchuk_zero.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(nunchuk_zero.x) &lt;&lt; &quot; - &quot;
+                &lt;&lt; static_cast&lt;int&gt;(nunchuk_one.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(nunchuk_one.x) &lt;&lt; &quot;, &quot;
+                &lt;&lt; static_cast&lt;int&gt;(nunchuk_one.x) &lt;&lt; std::endl;
           
-      }
     }
+  }
 }
 
 void
 Wiimote::disconnect()
 {
   if (m_wiimote)
-    {
-      cwiid_disconnect(m_wiimote);
-      m_wiimote = 0;
-    }
+  {
+    cwiid_disconnect(m_wiimote);
+    m_wiimote = 0;
+  }
 }
 
 void
 Wiimote::set_led(unsigned char led_state)
 {
   if (m_led_state != led_state)
-    {
-      //std::cout &lt;&lt; &quot;Wiimote: &quot; &lt;&lt; static_cast&lt;int&gt;(m_led_state) &lt;&lt; std::endl;
-      m_led_state = led_state;
+  {
+    //std::cout &lt;&lt; &quot;Wiimote: &quot; &lt;&lt; static_cast&lt;int&gt;(m_led_state) &lt;&lt; std::endl;
+    m_led_state = led_state;
 
-      if (cwiid_command(m_wiimote, CWIID_CMD_LED, m_led_state)) {
-        fprintf(stderr, &quot;Error setting LEDs \n&quot;);
-      }
+    if (cwiid_command(m_wiimote, CWIID_CMD_LED, m_led_state)) {
+      fprintf(stderr, &quot;Error setting LEDs \n&quot;);
     }
+  }
 }
 
 void
@@ -196,13 +196,13 @@
 Wiimote::set_rumble(bool r)
 {
   if (r != m_rumble)
-    {
-      m_rumble = r;
+  {
+    m_rumble = r;
 
-      if (cwiid_command(m_wiimote, CWIID_CMD_RUMBLE, m_rumble)) {
-        std::cerr &lt;&lt; &quot;Error setting rumble&quot; &lt;&lt; std::endl;
-      }
+    if (cwiid_command(m_wiimote, CWIID_CMD_RUMBLE, m_rumble)) {
+      std::cerr &lt;&lt; &quot;Error setting rumble&quot; &lt;&lt; std::endl;
     }
+  }
 }
 
 void
@@ -255,7 +255,7 @@
 {
   printf(&quot;Status Report: battery=%d extension=&quot;, msg.battery);
   switch (msg.ext_type)
-    {
+  {
     case CWIID_EXT_NONE:
       printf(&quot;none&quot;);
       break;
@@ -271,7 +271,7 @@
     default:
       printf(&quot;Unknown Extension&quot;);
       break;
-    }
+  }
   printf(&quot;\n&quot;);
 }
 
@@ -281,13 +281,13 @@
   std::cout &lt;&lt; &quot;On Error&quot; &lt;&lt; std::endl;
 
   if (m_wiimote)
+  {
+    if (cwiid_disconnect(m_wiimote)) 
     {
-      if (cwiid_disconnect(m_wiimote)) 
-        {
-          fprintf(stderr, &quot;Error on wiimote disconnect\n&quot;);
-          m_wiimote = 0;
-        }
+      fprintf(stderr, &quot;Error on wiimote disconnect\n&quot;);
+      m_wiimote = 0;
     }
+  }
 }
 
 void
@@ -330,11 +330,11 @@
 {
   printf(&quot;IR Report: &quot;);
   for (int i = 0; i &lt; CWIID_IR_SRC_COUNT; ++i)
-    {
-      if (msg.src[i].valid) {
-        printf(&quot;(%d,%d) &quot;, msg.src[i].pos[0], msg.src[i].pos[1]);
-      }
+  {
+    if (msg.src[i].valid) {
+      printf(&quot;(%d,%d) &quot;, msg.src[i].pos[0], msg.src[i].pos[1]);
     }
+  }
 }
 
 /** Convert value to float while taking calibration data, left/center/right into account */
@@ -344,17 +344,17 @@
                       uint8_t value)
 {
   if (value &lt; center)
-    {
-      return math::mid(-1.0f, -static_cast&lt;float&gt;(center - value) / static_cast&lt;float&gt;(center - min), 1.0f);
-    }
+  {
+    return math::mid(-1.0f, -static_cast&lt;float&gt;(center - value) / static_cast&lt;float&gt;(center - min), 1.0f);
+  }
   else if (value &gt; center)
-    {
-      return math::mid(-1.0f, static_cast&lt;float&gt;(value - center) / static_cast&lt;float&gt;(max - center), 1.0f);
-    }
+  {
+    return math::mid(-1.0f, static_cast&lt;float&gt;(value - center) / static_cast&lt;float&gt;(max - center), 1.0f);
+  }
   else 
-    {
-      return 0.0f;
-    }
+  {
+    return 0.0f;
+  }
 }
 
 void
@@ -374,16 +374,16 @@
   float nunchuk_stick_y = -to_float(22, 119, 213, msg.stick[1]);
 
   if (m_nunchuk_stick_x != nunchuk_stick_x)
-    {
-      m_nunchuk_stick_x = nunchuk_stick_x;
-      add_axis_event(0, 0, m_nunchuk_stick_x);
-    } 
+  {
+    m_nunchuk_stick_x = nunchuk_stick_x;
+    add_axis_event(0, 0, m_nunchuk_stick_x);
+  } 
 
   if (m_nunchuk_stick_y != nunchuk_stick_y)
-    {
-      m_nunchuk_stick_y = nunchuk_stick_y;
-      add_axis_event(0, 1, m_nunchuk_stick_y);
-    }
+  {
+    m_nunchuk_stick_y = nunchuk_stick_y;
+    add_axis_event(0, 1, m_nunchuk_stick_y);
+  }
 
   add_acc_event(0, 1, 
                 static_cast&lt;float&gt;(msg.acc[0] - nunchuk_zero.x) / static_cast&lt;float&gt;(nunchuk_one.x - nunchuk_zero.x),
@@ -442,42 +442,42 @@
 
   //std::cout &lt;&lt; &quot;StatusCallback: &quot; &lt;&lt; w &lt;&lt; &quot; &quot; &lt;&lt; mesg_count &lt;&lt; std::endl;
   for (int i=0; i &lt; mesg_count; i++)
+  {
+    switch (msg[i].type) 
     {
-      switch (msg[i].type) 
-        {
-        case CWIID_MESG_STATUS:
-          wiimote-&gt;on_status(msg[i].status_mesg);
-          break;
+      case CWIID_MESG_STATUS:
+        wiimote-&gt;on_status(msg[i].status_mesg);
+        break;
 
-        case CWIID_MESG_BTN:
-          wiimote-&gt;on_button(msg[i].btn_mesg);
-          break;
+      case CWIID_MESG_BTN:
+        wiimote-&gt;on_button(msg[i].btn_mesg);
+        break;
 
-        case CWIID_MESG_ACC:
-          wiimote-&gt;on_acc(msg[i].acc_mesg);
-          break;
+      case CWIID_MESG_ACC:
+        wiimote-&gt;on_acc(msg[i].acc_mesg);
+        break;
 
-        case CWIID_MESG_IR:
-          wiimote-&gt;on_ir(msg[i].ir_mesg);
-          break;
+      case CWIID_MESG_IR:
+        wiimote-&gt;on_ir(msg[i].ir_mesg);
+        break;
 
-        case CWIID_MESG_NUNCHUK:
-          wiimote-&gt;on_nunchuck(msg[i].nunchuk_mesg);
-          break;
+      case CWIID_MESG_NUNCHUK:
+        wiimote-&gt;on_nunchuck(msg[i].nunchuk_mesg);
+        break;
 
-        case CWIID_MESG_CLASSIC:
-          wiimote-&gt;on_classic(msg[i].classic_mesg);
-          break;
+      case CWIID_MESG_CLASSIC:
+        wiimote-&gt;on_classic(msg[i].classic_mesg);
+        break;
 
-        case CWIID_MESG_ERROR:
-          wiimote-&gt;on_error(msg[i].error_mesg);
-          break;
+      case CWIID_MESG_ERROR:
+        wiimote-&gt;on_error(msg[i].error_mesg);
+        break;
 
-        default:
-          printf(&quot;Wiimote: Unknown Report&quot;);
-          break;
-        }
+      default:
+        printf(&quot;Wiimote: Unknown Report&quot;);
+        break;
     }
+  }
 
   pthread_mutex_unlock(&amp;mutex);
 }

Modified: trunk/windstille/src/lisp/lexer.cpp
===================================================================
--- trunk/windstille/src/lisp/lexer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/lisp/lexer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,8 +28,8 @@
 {
 };
 
-Lexer::Lexer(std::istream&amp; newstream)
-  : stream(newstream), eof(false), linenumber(0), bufend(0), c(0), token_length(0)
+Lexer::Lexer(std::istream&amp; newstream) :
+  stream(newstream), eof(false), linenumber(0), bufend(0), c(0), token_length(0)
 {
   try {
     // trigger a refill of the buffer
@@ -125,7 +125,7 @@
         } catch(EOFException&amp; ) {
           std::stringstream msg;
           msg &lt;&lt; &quot;Parse error in line &quot; &lt;&lt; startline &lt;&lt; &quot;: &quot;
-            &lt;&lt; &quot;EOF while parsing string.&quot;;
+              &lt;&lt; &quot;EOF while parsing string.&quot;;
           throw std::runtime_error(msg.str());
         }
         nextChar();
@@ -144,7 +144,7 @@
         } catch(EOFException&amp; ) {
           std::stringstream msg;
           msg &lt;&lt; &quot;Parse Error in line &quot; &lt;&lt; linenumber &lt;&lt; &quot;: &quot;
-            &lt;&lt; &quot;EOF while parsing constant.&quot;;
+              &lt;&lt; &quot;EOF while parsing constant.&quot;;
           throw std::runtime_error(msg.str());
         }
 
@@ -158,7 +158,7 @@
         {
           std::stringstream msg;
           msg &lt;&lt; &quot;Parse Error in line &quot; &lt;&lt; linenumber &lt;&lt; &quot;: &quot;
-            &lt;&lt; &quot;Unknown constant '&quot; &lt;&lt; token_string &lt;&lt; &quot;'.&quot;;
+              &lt;&lt; &quot;Unknown constant '&quot; &lt;&lt; token_string &lt;&lt; &quot;'.&quot;;
           throw std::runtime_error(msg.str());
         }
 

Modified: trunk/windstille/src/lisp/lisp.cpp
===================================================================
--- trunk/windstille/src/lisp/lisp.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/lisp/lisp.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,35 +23,35 @@
 namespace lisp
 {
     
-Lisp::Lisp(int val)
-  : v(),
-    type(TYPE_INT)    
+Lisp::Lisp(int val) :
+  v(),
+  type(TYPE_INT)    
 {
   v.int_ = val;
 }
 
-Lisp::Lisp(float val)
-  : type(TYPE_FLOAT)
+Lisp::Lisp(float val) :
+  type(TYPE_FLOAT)
 {
   v.float_ = val;
 }
 
-Lisp::Lisp(bool val)
-  : type(TYPE_BOOL)
+Lisp::Lisp(bool val) :
+  type(TYPE_BOOL)
 {
   v.bool_ = val;
 }
 
-Lisp::Lisp(LispType newtype, const std::string&amp; str)
-  : type(newtype)
+Lisp::Lisp(LispType newtype, const std::string&amp; str) :
+  type(newtype)
 {
   assert(newtype == TYPE_SYMBOL || type == TYPE_STRING);
   v.string = new char[str.size()+1];
   memcpy(v.string, str.c_str(), str.size()+1);
 }
 
-Lisp::Lisp(const std::vector&lt;Lisp*&gt;&amp; list_elements)
-  : type(TYPE_LIST)
+Lisp::Lisp(const std::vector&lt;Lisp*&gt;&amp; list_elements) :
+  type(TYPE_LIST)
 {
   v.list.size = list_elements.size();
   v.list.entries = new Lisp* [v.list.size];
@@ -82,11 +82,11 @@
       out &lt;&lt; &quot;(&quot;;
 
       for(size_t i = 0; i &lt; v.list.size; ++i)
-        {
-          v.list.entries[i]-&gt;print(out, indent);
-          if (i != v.list.size-1)
-            out &lt;&lt; ' ';
-        }
+      {
+        v.list.entries[i]-&gt;print(out, indent);
+        if (i != v.list.size-1)
+          out &lt;&lt; ' ';
+      }
 
       out &lt;&lt; &quot;)&quot;;
       break;

Modified: trunk/windstille/src/lisp/parser.cpp
===================================================================
--- trunk/windstille/src/lisp/parser.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/lisp/parser.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -37,7 +37,7 @@
   {
     std::ostringstream msg;
     msg &lt;&lt; &quot;Parse error in file '&quot; &lt;&lt; parser-&gt;filename &lt;&lt; &quot;' line &quot;
-      &lt;&lt; parser-&gt;lexer-&gt;getLineNumber() &lt;&lt; &quot;: &quot; &lt;&lt; message;
+        &lt;&lt; parser-&gt;lexer-&gt;getLineNumber() &lt;&lt; &quot;: &quot; &lt;&lt; message;
     string = msg.str();
   }
   ~ParseError() throw()
@@ -52,10 +52,10 @@
   std::string string;
 };
 
-Parser::Parser()
-  : filename(),
-    lexer(0),
-    token()
+Parser::Parser() :
+  filename(),
+  lexer(0),
+  token()
 {
 }
 
@@ -112,7 +112,7 @@
         
           // Handle (_ &quot;blup&quot;) strings that need to be translated
           if(token == Lexer::TOKEN_SYMBOL
-              &amp;&amp; strcmp(lexer-&gt;getString(), &quot;_&quot;) == 0) {
+             &amp;&amp; strcmp(lexer-&gt;getString(), &quot;_&quot;) == 0) {
             token = lexer-&gt;getNextToken();
             if(token != Lexer::TOKEN_STRING)
               throw ParseError(this, &quot;Expected string after '(_' sequence&quot;);

Modified: trunk/windstille/src/lisp/properties.cpp
===================================================================
--- trunk/windstille/src/lisp/properties.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/lisp/properties.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -7,26 +7,26 @@
 Properties::Properties(const Lisp* lisp)
 {
   if (lisp)
-    {
-      if(lisp-&gt;get_type() != Lisp::TYPE_LIST)
-        throw std::runtime_error(&quot;Lisp is not a list&quot;);
+  {
+    if(lisp-&gt;get_type() != Lisp::TYPE_LIST)
+      throw std::runtime_error(&quot;Lisp is not a list&quot;);
 
-      for(size_t i = 0; i &lt; lisp-&gt;get_list_size(); ++i) {
-        const Lisp* child = lisp-&gt;get_list_elem(i);
-        if(i == 0 &amp;&amp; child-&gt;get_type() == Lisp::TYPE_SYMBOL)
-          continue;
-        if(child-&gt;get_type() != Lisp::TYPE_LIST)
-          throw std::runtime_error(&quot;child of properties lisp is not a list&quot;);
-        if(child-&gt;get_list_size() &gt; 1)
-          {    
-            const Lisp* name = child-&gt;get_list_elem(0);
-            if(name-&gt;get_type() != Lisp::TYPE_SYMBOL)
-              throw std::runtime_error(&quot;property has no symbol as name&quot;);
-            properties.insert(std::make_pair(
-                                             std::string(name-&gt;get_symbol()), ListEntry(child)));
-          }
+    for(size_t i = 0; i &lt; lisp-&gt;get_list_size(); ++i) {
+      const Lisp* child = lisp-&gt;get_list_elem(i);
+      if(i == 0 &amp;&amp; child-&gt;get_type() == Lisp::TYPE_SYMBOL)
+        continue;
+      if(child-&gt;get_type() != Lisp::TYPE_LIST)
+        throw std::runtime_error(&quot;child of properties lisp is not a list&quot;);
+      if(child-&gt;get_list_size() &gt; 1)
+      {    
+        const Lisp* name = child-&gt;get_list_elem(0);
+        if(name-&gt;get_type() != Lisp::TYPE_SYMBOL)
+          throw std::runtime_error(&quot;property has no symbol as name&quot;);
+        properties.insert(std::make_pair(
+                            std::string(name-&gt;get_symbol()), ListEntry(child)));
       }
     }
+  }
 }
 
 Properties::~Properties()

Modified: trunk/windstille/src/lisp/writer.cpp
===================================================================
--- trunk/windstille/src/lisp/writer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/lisp/writer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -25,22 +25,22 @@
 namespace lisp
 {
 
-Writer::Writer(const Pathname&amp; filename)
-  : out(),
-    out_owned(),
-    indent_depth(),
-    lists()
+Writer::Writer(const Pathname&amp; filename) :
+  out(),
+  out_owned(),
+  indent_depth(),
+  lists()
 {
   out = new std::ofstream(filename.get_sys_path().c_str());
   out_owned = true;
   indent_depth = 0;
 }
   
-Writer::Writer(std::ostream* newout)
-  : out(),
-    out_owned(),
-    indent_depth(),
-    lists()
+Writer::Writer(std::ostream* newout) :
+  out(),
+  out_owned(),
+  indent_depth(),
+  lists()
 {
   out = newout;
   out_owned = false;
@@ -108,7 +108,7 @@
 
 void
 Writer::write_string(const std::string&amp; name, const std::string&amp; value,
-    bool translatable)
+                     bool translatable)
 {
   indent();
   *out &lt;&lt; '(' &lt;&lt; name;
@@ -128,7 +128,7 @@
 
 void
 Writer::write_int_vector(const std::string&amp; name,
-    const std::vector&lt;int&gt;&amp; value)
+                         const std::vector&lt;int&gt;&amp; value)
 {
   indent();
   *out &lt;&lt; '(' &lt;&lt; name;
@@ -139,7 +139,7 @@
 
 void
 Writer::write_int_vector(const std::string&amp; name,
-    const std::vector&lt;unsigned int&gt;&amp; value)
+                         const std::vector&lt;unsigned int&gt;&amp; value)
 {
   indent();
   *out &lt;&lt; '(' &lt;&lt; name;

Modified: trunk/windstille/src/math/line.cpp
===================================================================
--- trunk/windstille/src/math/line.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/line.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -55,17 +55,17 @@
   float quotient = ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
 
   if (quotient == 0.0f)
-    {
-      return false; // FIXME
-    }
+  {
+    return false; // FIXME
+  }
   else
-    {
-      ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / quotient;
-      ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / quotient;
+  {
+    ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / quotient;
+    ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / quotient;
 
-      return (ua &gt;= 0.0f &amp;&amp; ua &lt;= 1.0f &amp;&amp;
-              ub &gt;= 0.0f &amp;&amp; ub &lt;= 1.0f);
-    }
+    return (ua &gt;= 0.0f &amp;&amp; ua &lt;= 1.0f &amp;&amp;
+            ub &gt;= 0.0f &amp;&amp; ub &lt;= 1.0f);
+  }
 }
 
 bool
@@ -73,14 +73,14 @@
 {
   float ua, ub;
   if (intersect(line, ua, ub))
-    {
-      colpos = p1 + ((p2 - p1) * ua);
-      return true;
-    }
+  {
+    colpos = p1 + ((p2 - p1) * ua);
+    return true;
+  }
   else
-    {
-      return false;
-    }
+  {
+    return false;
+  }
 }
 
 float
@@ -100,20 +100,20 @@
     (length() * length());
   
   if (u &lt; 0.0f)
-    {
-      return (p1 - p3).length();
-    }
+  {
+    return (p1 - p3).length();
+  }
   else if (u &gt; 1.0f)
-    {
-      return (p2 - p3).length();
-    }
+  {
+    return (p2 - p3).length();
+  }
   else // (u &gt;= 0.0f &amp;&amp; u &lt;= 1.0f)
-    {
-      Vector2f p4(x1 + u * (x2 - x1),
+  {
+    Vector2f p4(x1 + u * (x2 - x1),
                 y1 + u * (y2 - y1));
 
-      return (p4 - p3).length();
-    }
+    return (p4 - p3).length();
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/math/matrix.cpp
===================================================================
--- trunk/windstille/src/math/matrix.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/matrix.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -51,7 +51,7 @@
   matrix.matrix[5]  = 1.0;
   matrix.matrix[10] = 1.0;
   matrix.matrix[15] = 1.0;
-	
+        
   return matrix;
 }
 
@@ -141,16 +141,16 @@
 {
   Matrix result;
   for (int x=0; x&lt;4; x++)
+  {
+    for (int y=0; y&lt;4; y++)
     {
-      for (int y=0; y&lt;4; y++)
-        {
-          result.matrix[x+y*4] =
-            matrix[x   ] * mult.matrix[y*4  ] +
-            matrix[x+ 4] * mult.matrix[y*4+1] +
-            matrix[x+ 8] * mult.matrix[y*4+2] +
-            matrix[x+12] * mult.matrix[y*4+3];
-        }
+      result.matrix[x+y*4] =
+        matrix[x   ] * mult.matrix[y*4  ] +
+        matrix[x+ 4] * mult.matrix[y*4+1] +
+        matrix[x+ 8] * mult.matrix[y*4+2] +
+        matrix[x+12] * mult.matrix[y*4+3];
     }
+  }
   return result;
 }
 
@@ -196,12 +196,12 @@
 {
   float len2 = x*x+y*y+z*z;
   if (len2 != 1.0)
-    {
-      float len = sqrtf(len2);
-      x /= len;
-      y /= len;
-      z /= len;
-    }
+  {
+    float len = sqrtf(len2);
+    x /= len;
+    y /= len;
+    z /= len;
+  }
 
   float c = cosf(angle * 3.14159265f / 180.0f);
   float s = sinf(angle * 3.14159265f / 180.0f);
@@ -229,38 +229,38 @@
 {
   float det = determinat();
   if (det != 0)
-    {
-      Matrix b;
+  {
+    Matrix b;
 #if 0
-      const Matrix&amp; m = *this;
+    const Matrix&amp; m = *this;
 
-      // FIXME: wrong start index, should be 0, is 1
-      b(0,0) = m(2,2)*m(3,3)*m(4,4) + m(2,3)*m(3,4)*m(4,2) + m(2,4)*m(3,2)*m(4,3) - m(2,2)*m(3,4)*m(4,3) - m(2,3)*m(3,2)*m(4,4) - m(2,4)*m(3,3)*m(4,2);
-      b(0,1) = m(1,2)*m(3,4)*m(4,3) + m(1,3)*m(3,2)*m(4,4) + m(1,4)*m(3,3)*m(4,2) - m(1,2)*m(3,3)*m(4,4) - m(1,3)*m(3,4)*m(4,2) - m(1,4)*m(3,2)*m(4,3);
-      b(0,2) = m(1,2)*m(2,3)*m(4,4) + m(1,3)*m(2,4)*m(4,2) + m(1,4)*m(2,2)*m(4,3) - m(1,2)*m(2,4)*m(4,3) - m(1,3)*m(2,2)*m(4,4) - m(1,4)*m(2,3)*m(4,2);
-      b(0,3) = m(1,2)*m(2,4)*m(3,3) + m(1,3)*m(2,2)*m(3,4) + m(1,4)*m(2,3)*m(3,2) - m(1,2)*m(2,3)*m(3,4) - m(1,3)*m(2,4)*m(3,2) - m(1,4)*m(2,2)*m(3,3);
+    // FIXME: wrong start index, should be 0, is 1
+    b(0,0) = m(2,2)*m(3,3)*m(4,4) + m(2,3)*m(3,4)*m(4,2) + m(2,4)*m(3,2)*m(4,3) - m(2,2)*m(3,4)*m(4,3) - m(2,3)*m(3,2)*m(4,4) - m(2,4)*m(3,3)*m(4,2);
+    b(0,1) = m(1,2)*m(3,4)*m(4,3) + m(1,3)*m(3,2)*m(4,4) + m(1,4)*m(3,3)*m(4,2) - m(1,2)*m(3,3)*m(4,4) - m(1,3)*m(3,4)*m(4,2) - m(1,4)*m(3,2)*m(4,3);
+    b(0,2) = m(1,2)*m(2,3)*m(4,4) + m(1,3)*m(2,4)*m(4,2) + m(1,4)*m(2,2)*m(4,3) - m(1,2)*m(2,4)*m(4,3) - m(1,3)*m(2,2)*m(4,4) - m(1,4)*m(2,3)*m(4,2);
+    b(0,3) = m(1,2)*m(2,4)*m(3,3) + m(1,3)*m(2,2)*m(3,4) + m(1,4)*m(2,3)*m(3,2) - m(1,2)*m(2,3)*m(3,4) - m(1,3)*m(2,4)*m(3,2) - m(1,4)*m(2,2)*m(3,3);
                                                                                                                                                               
-      b(1,0) = m(2,1)*m(3,4)*m(4,3) + m(2,3)*m(3,1)*m(4,4) + m(2,4)*m(3,3)*m(4,1) - m(2,1)*m(3,3)*m(4,4) - m(2,3)*m(3,4)*m(4,1) - m(2,4)*m(3,1)*m(4,3);
-      b(1,1) = m(1,1)*m(3,3)*m(4,4) + m(1,3)*m(3,4)*m(4,1) + m(1,4)*m(3,1)*m(4,3) - m(1,1)*m(3,4)*m(4,3) - m(1,3)*m(3,1)*m(4,4) - m(1,4)*m(3,3)*m(4,1);
-      b(1,2) = m(1,1)*m(2,4)*m(4,3) + m(1,3)*m(2,1)*m(4,4) + m(1,4)*m(2,3)*m(4,1) - m(1,1)*m(2,3)*m(4,4) - m(1,3)*m(2,4)*m(4,1) - m(1,4)*m(2,1)*m(4,3);
-      b(1,3) = m(1,1)*m(2,3)*m(3,4) + m(1,3)*m(2,4)*m(3,1) + m(1,4)*m(2,1)*m(3,3) - m(1,1)*m(2,4)*m(3,3) - m(1,3)*m(2,1)*m(3,4) - m(1,4)*m(2,3)*m(3,1);
+    b(1,0) = m(2,1)*m(3,4)*m(4,3) + m(2,3)*m(3,1)*m(4,4) + m(2,4)*m(3,3)*m(4,1) - m(2,1)*m(3,3)*m(4,4) - m(2,3)*m(3,4)*m(4,1) - m(2,4)*m(3,1)*m(4,3);
+    b(1,1) = m(1,1)*m(3,3)*m(4,4) + m(1,3)*m(3,4)*m(4,1) + m(1,4)*m(3,1)*m(4,3) - m(1,1)*m(3,4)*m(4,3) - m(1,3)*m(3,1)*m(4,4) - m(1,4)*m(3,3)*m(4,1);
+    b(1,2) = m(1,1)*m(2,4)*m(4,3) + m(1,3)*m(2,1)*m(4,4) + m(1,4)*m(2,3)*m(4,1) - m(1,1)*m(2,3)*m(4,4) - m(1,3)*m(2,4)*m(4,1) - m(1,4)*m(2,1)*m(4,3);
+    b(1,3) = m(1,1)*m(2,3)*m(3,4) + m(1,3)*m(2,4)*m(3,1) + m(1,4)*m(2,1)*m(3,3) - m(1,1)*m(2,4)*m(3,3) - m(1,3)*m(2,1)*m(3,4) - m(1,4)*m(2,3)*m(3,1);
                                                                                                                                                               
-      b(2,0) = m(2,1)*m(3,2)*m(4,4) + m(2,2)*m(3,4)*m(4,1) + m(2,4)*m(3,1)*m(4,2) - m(2,1)*m(3,4)*m(4,2) - m(2,2)*m(3,1)*m(4,1) - m(2,4)*m(3,2)*m(4,1);
-      b(2,1) = m(1,1)*m(3,4)*m(4,2) + m(1,2)*m(3,1)*m(4,4) + m(1,4)*m(3,2)*m(4,1) - m(1,1)*m(3,2)*m(4,4) - m(1,2)*m(3,4)*m(4,1) - m(1,4)*m(3,1)*m(4,2);
-      b(2,2) = m(1,1)*m(2,2)*m(4,4) + m(1,2)*m(2,4)*m(4,1) + m(1,4)*m(2,1)*m(4,2) - m(1,1)*m(2,4)*m(4,2) - m(1,2)*m(2,1)*m(4,4) - m(1,4)*m(2,2)*m(4,1);
-      b(2,3) = m(1,1)*m(2,4)*m(3,2) + m(1,2)*m(2,1)*m(3,4) + m(1,4)*m(2,2)*m(3,1) - m(1,1)*m(2,2)*m(3,4) - m(1,2)*m(2,4)*m(3,1) - m(1,4)*m(2,1)*m(3,2);
+    b(2,0) = m(2,1)*m(3,2)*m(4,4) + m(2,2)*m(3,4)*m(4,1) + m(2,4)*m(3,1)*m(4,2) - m(2,1)*m(3,4)*m(4,2) - m(2,2)*m(3,1)*m(4,1) - m(2,4)*m(3,2)*m(4,1);
+    b(2,1) = m(1,1)*m(3,4)*m(4,2) + m(1,2)*m(3,1)*m(4,4) + m(1,4)*m(3,2)*m(4,1) - m(1,1)*m(3,2)*m(4,4) - m(1,2)*m(3,4)*m(4,1) - m(1,4)*m(3,1)*m(4,2);
+    b(2,2) = m(1,1)*m(2,2)*m(4,4) + m(1,2)*m(2,4)*m(4,1) + m(1,4)*m(2,1)*m(4,2) - m(1,1)*m(2,4)*m(4,2) - m(1,2)*m(2,1)*m(4,4) - m(1,4)*m(2,2)*m(4,1);
+    b(2,3) = m(1,1)*m(2,4)*m(3,2) + m(1,2)*m(2,1)*m(3,4) + m(1,4)*m(2,2)*m(3,1) - m(1,1)*m(2,2)*m(3,4) - m(1,2)*m(2,4)*m(3,1) - m(1,4)*m(2,1)*m(3,2);
                                                                                                                                                               
-      b(3,0) = m(2,1)*m(3,3)*m(4,2) + m(2,2)*m(3,1)*m(4,3) + m(2,3)*m(3,2)*m(4,1) - m(2,1)*m(3,2)*m(4,3) - m(2,2)*m(3,3)*m(4,1) - m(2,3)*m(3,1)*m(4,2);
-      b(3,1) = m(1,1)*m(3,2)*m(4,3) + m(1,2)*m(3,3)*m(4,1) + m(1,3)*m(3,1)*m(4,2) - m(1,1)*m(3,3)*m(4,2) - m(1,2)*m(3,1)*m(4,3) - m(1,3)*m(3,2)*m(4,1);
-      b(3,2) = m(1,1)*m(2,3)*m(4,2) + m(1,2)*m(2,1)*m(4,3) + m(1,3)*m(2,2)*m(4,1) - m(1,1)*m(2,2)*m(4,3) - m(1,2)*m(2,3)*m(4,1) - m(1,3)*m(2,1)*m(4,2);
-      b(3,3) = m(1,1)*m(2,2)*m(3,3) + m(1,2)*m(2,3)*m(3,1) + m(1,3)*m(2,1)*m(3,2) - m(1,1)*m(2,3)*m(3,2) - m(1,2)*m(2,1)*m(3,3) - m(1,3)*m(2,2)*m(3,1);
+    b(3,0) = m(2,1)*m(3,3)*m(4,2) + m(2,2)*m(3,1)*m(4,3) + m(2,3)*m(3,2)*m(4,1) - m(2,1)*m(3,2)*m(4,3) - m(2,2)*m(3,3)*m(4,1) - m(2,3)*m(3,1)*m(4,2);
+    b(3,1) = m(1,1)*m(3,2)*m(4,3) + m(1,2)*m(3,3)*m(4,1) + m(1,3)*m(3,1)*m(4,2) - m(1,1)*m(3,3)*m(4,2) - m(1,2)*m(3,1)*m(4,3) - m(1,3)*m(3,2)*m(4,1);
+    b(3,2) = m(1,1)*m(2,3)*m(4,2) + m(1,2)*m(2,1)*m(4,3) + m(1,3)*m(2,2)*m(4,1) - m(1,1)*m(2,2)*m(4,3) - m(1,2)*m(2,3)*m(4,1) - m(1,3)*m(2,1)*m(4,2);
+    b(3,3) = m(1,1)*m(2,2)*m(3,3) + m(1,2)*m(2,3)*m(3,1) + m(1,3)*m(2,1)*m(3,2) - m(1,1)*m(2,3)*m(3,2) - m(1,2)*m(2,1)*m(3,3) - m(1,3)*m(2,2)*m(3,1);
 #endif
-      return b;
-    }
+    return b;
+  }
   else
-    {
-      assert(!&quot;Matrix can't be inverted&quot;);
-    }
+  {
+    assert(!&quot;Matrix can't be inverted&quot;);
+  }
 }
 
 float

Modified: trunk/windstille/src/math/origin.cpp
===================================================================
--- trunk/windstille/src/math/origin.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/origin.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -31,72 +31,72 @@
 
 Point calc_origin(Origin origin, const Size &amp;size)
 {
-	switch(origin)
-	{
-	case origin::top_left:
-	default:
-		return Point(0, 0);
-		break;
-	case origin::top_center:
-		return Point(size.width / 2, 0);
-		break;
-	case origin::top_right:
-		return Point(size.width, 0);
-		break;
-	case origin::center_left:
-		return Point(0, size.height / 2);
-		break;
-	case origin::center:
-		return Point(size.width / 2, size.height / 2);
-		break;
-	case origin::center_right:
-		return Point(size.width, size.height / 2);
-		break;
-	case origin::bottom_left:
-		return Point(0, size.height);
-		break;
-	case origin::bottom_center:
-		return Point(size.width / 2, size.height);
-		break;
-	case origin::bottom_right:
-		return Point(size.width, size.height);
-		break;
-	}
+  switch(origin)
+  {
+    case origin::top_left:
+    default:
+      return Point(0, 0);
+      break;
+    case origin::top_center:
+      return Point(size.width / 2, 0);
+      break;
+    case origin::top_right:
+      return Point(size.width, 0);
+      break;
+    case origin::center_left:
+      return Point(0, size.height / 2);
+      break;
+    case origin::center:
+      return Point(size.width / 2, size.height / 2);
+      break;
+    case origin::center_right:
+      return Point(size.width, size.height / 2);
+      break;
+    case origin::bottom_left:
+      return Point(0, size.height);
+      break;
+    case origin::bottom_center:
+      return Point(size.width / 2, size.height);
+      break;
+    case origin::bottom_right:
+      return Point(size.width, size.height);
+      break;
+  }
 }
 
 Vector2f calc_origin(Origin origin, const Sizef &amp;size)
 {
-	switch(origin)
-	{
-	case origin::top_left:
-	default:
-		return Vector2f(0, 0);
-		break;
-	case origin::top_center:
-		return Vector2f(size.width / 2, 0);
-		break;
-	case origin::top_right:
-		return Vector2f(size.width, 0);
-		break;
-	case origin::center_left:
-		return Vector2f(0, size.height / 2);
-		break;
-	case origin::center:
-		return Vector2f(size.width / 2, size.height / 2);
-		break;
-	case origin::center_right:
-		return Vector2f(size.width, size.height / 2);
-		break;
-	case origin::bottom_left:
-		return Vector2f(0, size.height);
-		break;
-	case origin::bottom_center:
-		return Vector2f(size.width / 2, size.height);
-		break;
-	case origin::bottom_right:
-		return Vector2f(size.width, size.height);
-		break;
-	}
+  switch(origin)
+  {
+    case origin::top_left:
+    default:
+      return Vector2f(0, 0);
+      break;
+    case origin::top_center:
+      return Vector2f(size.width / 2, 0);
+      break;
+    case origin::top_right:
+      return Vector2f(size.width, 0);
+      break;
+    case origin::center_left:
+      return Vector2f(0, size.height / 2);
+      break;
+    case origin::center:
+      return Vector2f(size.width / 2, size.height / 2);
+      break;
+    case origin::center_right:
+      return Vector2f(size.width, size.height / 2);
+      break;
+    case origin::bottom_left:
+      return Vector2f(0, size.height);
+      break;
+    case origin::bottom_center:
+      return Vector2f(size.width / 2, size.height);
+      break;
+    case origin::bottom_right:
+      return Vector2f(size.width, size.height);
+      break;
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/math/origin.hpp
===================================================================
--- trunk/windstille/src/math/origin.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/origin.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -43,15 +43,15 @@
 //- !header=core.h!
 enum Origin
 {
-	top_left,
-	top_center,
-	top_right,
-	center_left,
-	center,
-	center_right,
-	bottom_left,
-	bottom_center,
-	bottom_right
+  top_left,
+  top_center,
+  top_right,
+  center_left,
+  center,
+  center_right,
+  bottom_left,
+  bottom_center,
+  bottom_right
 };
 
 }

Modified: trunk/windstille/src/math/point.hpp
===================================================================
--- trunk/windstille/src/math/point.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/point.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -81,13 +81,13 @@
   {
     //Move the hotspot to 0,0
     Point r(x - hotspot.x, y - hotspot.y);
-		
+                
     //Do some Grumbel voodoo.
 
     // Because MSVC sucks ass wrt standards compliance, it gets it own special function calls
 #ifdef _MSC_VER
     const float c = static_cast&lt;float&gt;sqrt(static_cast&lt;float&gt;(r.x)*static_cast&lt;float&gt;(r.x) + 
-                                 static_cast&lt;float&gt;(r.y)*static_cast&lt;float&gt;(r.y));
+                                           static_cast&lt;float&gt;(r.y)*static_cast&lt;float&gt;(r.y));
     const float nw = static_cast&lt;float&gt;(atan2(static_cast&lt;float&gt;(r.y), static_cast&lt;float&gt;(r.x)) + ((angle + 180) * math::pi / 180));
     r.x = (int)((sin(1.5 * M_PI - nw) * c) + 0.5) + hotspot.x;
     r.y = -(int)((sin(nw) * c) + 0.5) + hotspot.y;
@@ -112,7 +112,7 @@
     return int(std::sqrt(double((x-p.x)*(x-p.x) + (y-p.y)*(y-p.y))) + 0.5f);
 #endif
   }
-	
+        
   //: Translate point.
   Point &amp;operator+=(const Point &amp;p)
   { x += p.x; y += p.y; return *this; }
@@ -120,7 +120,7 @@
   //: Translate point negatively.
   Point &amp;operator-=(const Point &amp;p)
   { x -= p.x; y -= p.y; return *this; }
-	
+        
   //: Point + Point operator.
   Point operator+(const Point &amp;p) const
   { return Point(x + p.x, y + p.y); }

Modified: trunk/windstille/src/math/random.cpp
===================================================================
--- trunk/windstille/src/math/random.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/random.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -140,9 +140,9 @@
 {
   Random random(5489UL);
   for(int i = 0; i &lt; 1000000; ++i)
-    {
-      std::cout &lt;&lt; random.drand(0, 5) &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; random.drand(0, 5) &lt;&lt; std::endl;
+  }
   return 0;
 }
 #endif

Modified: trunk/windstille/src/math/rect.cpp
===================================================================
--- trunk/windstille/src/math/rect.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/rect.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -34,27 +34,27 @@
 
 Rect Rect::get_rot_bounds(const Point &amp;hotspot, float angle) const
 {
-	//Find the rotated positions of each corner
-	Rect retVal(*this);
-	Point ul = Point(retVal.left, retVal.top).rotate(hotspot, angle);
-	Point ur = Point(retVal.right, retVal.top).rotate(hotspot, angle);
-	Point ll = Point(retVal.left, retVal.bottom).rotate(hotspot, angle);
-	Point lr = Point(retVal.right, retVal.bottom).rotate(hotspot, angle);
-	
-	//Use the sidemost corners as the bounds of the new rectangle
-	retVal.left = cl_min(cl_min(ul.x, ur.x), cl_min(ll.x, lr.x));
-	retVal.right = cl_max(cl_max(ul.x, ur.x), cl_max(ll.x, lr.x));
-	retVal.top = cl_min(cl_min(ul.y, ur.y), cl_min(ll.y, lr.y));
-	retVal.bottom = cl_max(cl_max(ul.y, ur.y), cl_max(ll.y, lr.y));
-	
-	return retVal;
+  //Find the rotated positions of each corner
+  Rect retVal(*this);
+  Point ul = Point(retVal.left, retVal.top).rotate(hotspot, angle);
+  Point ur = Point(retVal.right, retVal.top).rotate(hotspot, angle);
+  Point ll = Point(retVal.left, retVal.bottom).rotate(hotspot, angle);
+  Point lr = Point(retVal.right, retVal.bottom).rotate(hotspot, angle);
+        
+  //Use the sidemost corners as the bounds of the new rectangle
+  retVal.left = cl_min(cl_min(ul.x, ur.x), cl_min(ll.x, lr.x));
+  retVal.right = cl_max(cl_max(ul.x, ur.x), cl_max(ll.x, lr.x));
+  retVal.top = cl_min(cl_min(ul.y, ur.y), cl_min(ll.y, lr.y));
+  retVal.bottom = cl_max(cl_max(ul.y, ur.y), cl_max(ll.y, lr.y));
+        
+  return retVal;
 }
 
 Rect Rect::get_rot_bounds(Origin origin, int x, int y, float angle) const
 {
-	return get_rot_bounds(
-		Point(left, top) + calc_origin(origin, get_size()) + Point(x, y),
-		angle);
+  return get_rot_bounds(
+    Point(left, top) + calc_origin(origin, get_size()) + Point(x, y),
+    angle);
 }
 
 std::ostream&amp; operator&lt;&lt;(std::ostream&amp; s, const Rect&amp; rect)

Modified: trunk/windstille/src/math/rect.hpp
===================================================================
--- trunk/windstille/src/math/rect.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/rect.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -87,7 +87,7 @@
   //: Rect -= Rect operator.
   Rect &amp;operator-=(const Rect &amp;r)
   { left -= r.left; top -= r.top; right -= r.right; bottom -= r.bottom; return *this; }
-	
+        
   //: Rect += Point operator.
   Rect &amp;operator+=(const Point &amp;p)
   { left += p.x; top += p.y; right += p.x; bottom += p.y; return *this; }
@@ -124,25 +124,25 @@
 public:
   //: X1-coordinate.
   int left;
-	
+        
   //: Y1-coordinate.
   int top;
-	
+        
   //: X2-coordinate.
   int right;
-	
+        
   //: Y2-coordinate.
   int bottom;
-	
+        
   //: Returns the width of the rectangle.
   int get_width() const { return right - left; }
-	
+        
   //: Returns the height of the rectangle.
   int get_height() const { return bottom - top; }
 
   //: Returns the size of the rectangle.
   Size get_size() const { return Size(right - left, bottom - top); }
-	
+        
   //: Returns true if point is inside the rectangle.
   bool is_inside(const Point &amp;p) const { return (p.x &gt;= left &amp;&amp; p.y &gt;= top &amp;&amp; p.x &lt;= right &amp;&amp; p.y &lt;= bottom); }
 
@@ -151,7 +151,7 @@
   {
     return (r.left &lt; right &amp;&amp; r.right &gt; left &amp;&amp; r.top &lt; bottom &amp;&amp; r.bottom &gt; top);
   }
-	
+        
   //: Returns another Rect containing a rotated version of this one.
   //param hotspot: Point to rotate around.
   //param origin: Determines the hotspot point within the rectangle
@@ -159,7 +159,7 @@
   //param angle: Angle to rotate in degrees.
   Rect get_rot_bounds(const Point &amp;hotspot, float angle) const;
   Rect get_rot_bounds(Origin origin, int x, int y, float angle) const;
-	
+        
   //! Operations:
 public:
   //: Sets the size of the rectangle, maintaining top/left position.
@@ -184,20 +184,20 @@
   void normalize()
   {
     if (left &gt; right)
-      {
-        int temp = right;
-        right = left;
-        left = temp;
-      }
+    {
+      int temp = right;
+      right = left;
+      left = temp;
+    }
 
     if (top &gt; bottom)
-      {
-        int temp = bottom;
-        bottom = top;
-        top = temp;
-      }
+    {
+      int temp = bottom;
+      bottom = top;
+      top = temp;
+    }
   }
-	
+        
   //: Applies an origin and offset pair to this rectangle
   //param origin: The new origin to adjust to from default upper-left position
   //param x, y: Offsets applied negatively to each corner of the rectangle
@@ -206,7 +206,7 @@
     Point offset = calc_origin(origin, get_size());
     offset.x -= x;
     offset.y -= y;
-		
+                
     left += offset.x;
     top += offset.y;
     right += offset.x;
@@ -276,7 +276,7 @@
   //: Rect -= Rect operator.
   Rectf &amp;operator-=(const Rectf &amp;r)
   { left -= r.left; top -= r.top; right -= r.right; bottom -= r.bottom; return *this; }
-	
+        
   //: Rect += Point operator.
   Rectf &amp;operator+=(const Vector2f &amp;p)
   { left += p.x; top += p.y; right += p.x; bottom += p.y; return *this; }
@@ -313,28 +313,28 @@
 public:
   //: X1-coordinate.
   float left;
-	
+        
   //: Y1-coordinate.
   float top;
-	
+        
   //: X2-coordinate.
   float right;
-	
+        
   //: Y2-coordinate.
   float bottom;
-	
+        
   //: Returns the width of the rectangle.
   float get_width() const { return right - left; }
-	
+        
   //: Returns the height of the rectangle.
   float get_height() const { return bottom - top; }
 
   //: Returns the size of the rectangle.
   Sizef get_size() const { return Sizef(right - left, bottom - top); }
-	
+        
   //: Returns true if point is inside the rectangle.
   bool is_inside(const Vector2f &amp;p) const { return (p.x &gt;= left &amp;&amp; p.y &gt;= top &amp;&amp; p.x &lt;= right &amp;&amp; p.y &lt;= bottom); }
-	
+        
   //: Returns true if rectangle passed is overlapping or inside this rectangle.
   bool is_overlapped(const Rectf &amp;r) const 
   {
@@ -346,7 +346,7 @@
     return rect.left &gt;= left &amp;&amp; rect.right &lt;= right &amp;&amp;
       rect.top &gt;= top &amp;&amp; rect.bottom &lt;= bottom;
   }
-	
+        
   //! Operations:
 public:
   //: Sets the size of the rectangle, maintaining top/left position.
@@ -371,20 +371,20 @@
   void normalize()
   {
     if (left &gt; right)
-      {
-        float temp = right;
-        right = left;
-        left = temp;
-      }
+    {
+      float temp = right;
+      right = left;
+      left = temp;
+    }
 
     if (top &gt; bottom)
-      {
-        float temp = bottom;
-        bottom = top;
-        top = temp;
-      }
+    {
+      float temp = bottom;
+      bottom = top;
+      top = temp;
+    }
   }
-	
+        
   //: Applies an origin and offset pair to this rectangle
   //param origin: The new origin to adjust to from default upper-left position
   //param x, y: Offsets applied negatively to each corner of the rectangle
@@ -393,7 +393,7 @@
     Vector2f offset = calc_origin(origin, get_size());
     offset.x -= x;
     offset.y -= y;
-		
+                
     left += offset.x;
     top += offset.y;
     right += offset.x;

Modified: trunk/windstille/src/math/size.hpp
===================================================================
--- trunk/windstille/src/math/size.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/math/size.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -84,7 +84,7 @@
   //: Size -= Size operator.
   Size &amp;operator-=(const Size &amp;s)
   { width -= s.width; height -= s.height; return *this; }
-	
+        
   //: Size + Size operator.
   Size operator+(const Size &amp;s) const
   { return Size(width + s.width, height + s.height); }
@@ -148,7 +148,7 @@
   //: Size -= Size operator.
   Sizef &amp;operator-=(const Sizef &amp;s)
   { width -= s.width; height -= s.height; return *this; }
-	
+        
   //: Size + Size operator.
   Sizef operator+(const Sizef &amp;s) const
   { return Sizef(width + s.width, height + s.height); }

Modified: trunk/windstille/src/navigation/edge.cpp
===================================================================
--- trunk/windstille/src/navigation/edge.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/navigation/edge.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,10 +22,10 @@
 
 #include &quot;navigation/node.hpp&quot;
 
-Edge::Edge(Node* node1_, Node* node2_, Properties props_)
-  : node1(node1_), 
-    node2(node2_),
-    properties(props_)
+Edge::Edge(Node* node1_, Node* node2_, Properties props_) :
+  node1(node1_), 
+  node2(node2_),
+  properties(props_)
 {
   node1-&gt;add_edge(EdgePosition(this, 0.0f));
   node2-&gt;add_edge(EdgePosition(this, 1.0f));

Modified: trunk/windstille/src/navigation/edge_position.cpp
===================================================================
--- trunk/windstille/src/navigation/edge_position.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/navigation/edge_position.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,15 +24,15 @@
 #include &quot;navigation/node.hpp&quot;
 #include &quot;display/display.hpp&quot;
 
-EdgePosition::EdgePosition()
-  : edge(0),
-    pos(0.0f)
+EdgePosition::EdgePosition() :
+  edge(0),
+  pos(0.0f)
 {
 }
 
-EdgePosition::EdgePosition(Edge* edge_, float pos_)
-  : edge(edge_),
-    pos(pos_)
+EdgePosition::EdgePosition(Edge* edge_, float pos_) :
+  edge(edge_),
+  pos(pos_)
 {  
 }
 
@@ -55,27 +55,27 @@
   float adv_01 = adv / length;
 
   if (adv_01 &gt; 0)
-    {
-      pos += adv_01;
-      if (pos &gt; 1.0f) {
-        adv = (pos - 1.0f) * length;
-        pos = 1.0f;
-        next_node = edge-&gt;get_node2();
-      } else {
-        adv = 0;
-      }
+  {
+    pos += adv_01;
+    if (pos &gt; 1.0f) {
+      adv = (pos - 1.0f) * length;
+      pos = 1.0f;
+      next_node = edge-&gt;get_node2();
+    } else {
+      adv = 0;
     }
+  }
   else
-    {
-      pos += adv_01;
-      if (pos &lt; 0.0f) {
-        adv = pos * length;
-        pos = 0;
-        next_node = edge-&gt;get_node1();
-      } else {
-        adv = 0;
-      }
+  {
+    pos += adv_01;
+    if (pos &lt; 0.0f) {
+      adv = pos * length;
+      pos = 0;
+      next_node = edge-&gt;get_node1();
+    } else {
+      adv = 0;
     }
+  }
 }
 
 void

Modified: trunk/windstille/src/navigation/navigation_graph.cpp
===================================================================
--- trunk/windstille/src/navigation/navigation_graph.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/navigation/navigation_graph.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,9 +28,9 @@
 
 #include &quot;navigation/navigation_graph.hpp&quot;
 
-NavigationGraph::NavigationGraph()
-  : nodes(),
-    edges()
+NavigationGraph::NavigationGraph() :
+  nodes(),
+  edges()
 {  
 }
 
@@ -59,10 +59,10 @@
   // FIXME: Slow
   Edges::iterator i = std::find(edges.begin(), edges.end(), edge.get());
   if (i != edges.end())
-    {
-      edges.erase(i);
-      delete edge.get();
-    }
+  {
+    edges.erase(i);
+    delete edge.get();
+  }
 
   // FIXME: Throw exception here
 }
@@ -74,43 +74,43 @@
 
   // Remove all edges that would get invalid by removing the node
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)
+  {
+    if ((*i)-&gt;get_node1() == node.get() ||
+        (*i)-&gt;get_node2() == node.get())
     {
-      if ((*i)-&gt;get_node1() == node.get() ||
-          (*i)-&gt;get_node2() == node.get())
-        {
-          delete *i;
-          *i = 0;
-        }
+      delete *i;
+      *i = 0;
     }
+  }
 
   Edges::iterator new_end = std::remove(edges.begin(), edges.end(), static_cast&lt;Edge*&gt;(0));
   if (new_end != edges.end())
-    { 
-      edges.erase(new_end, edges.end());
-    }
+  { 
+    edges.erase(new_end, edges.end());
+  }
   
   // Remove the node itself 
   Nodes::iterator j = std::find(nodes.begin(), nodes.end(), node.get());
   if (j != nodes.end())
-    {
-      nodes.erase(j);
-      delete node.get();
-    }  
+  {
+    nodes.erase(j);
+    delete node.get();
+  }  
 }
 
 EdgeHandle
 NavigationGraph::add_edge(NodeHandle node1, NodeHandle node2)
 {
   if (node1.get() != node2.get()) // node links to themself are forbidden
-    { // FIXME: Find a way to figure out if the given edge already exists
-      Edge* edge = new Edge(node1.get(), node2.get());
-      edges.push_back(edge);
-      return EdgeHandle(edge);
-    }
+  { // FIXME: Find a way to figure out if the given edge already exists
+    Edge* edge = new Edge(node1.get(), node2.get());
+    edges.push_back(edge);
+    return EdgeHandle(edge);
+  }
   else
-    {
-      return EdgeHandle();
-    }
+  {
+    return EdgeHandle();
+  }
 }
 
 void
@@ -133,16 +133,16 @@
   std::vector&lt;EdgePosition&gt; ret;
  
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)
+  {
+    Line seg_line((*i)-&gt;get_node1()-&gt;get_pos(),
+                  (*i)-&gt;get_node2()-&gt;get_pos());
+      
+    float ua, ub;
+    if (line.intersect(seg_line, ua, ub))
     {
-      Line seg_line((*i)-&gt;get_node1()-&gt;get_pos(),
-                    (*i)-&gt;get_node2()-&gt;get_pos());
-      
-      float ua, ub;
-      if (line.intersect(seg_line, ua, ub))
-        {
-          ret.push_back(EdgePosition(*i, ub));
-        }
+      ret.push_back(EdgePosition(*i, ub));
     }
+  }
 
   return ret;
 }
@@ -154,13 +154,13 @@
   std::vector&lt;NodeHandle&gt; ret;
 
   for(Nodes::iterator i = nodes.begin(); i != nodes.end(); ++i)
+  {
+    float distance = (pos - (*i)-&gt;get_pos()).length();
+    if (distance &lt; radius)
     {
-      float distance = (pos - (*i)-&gt;get_pos()).length();
-      if (distance &lt; radius)
-        {
-          ret.push_back(NodeHandle(*i));
-        }
+      ret.push_back(NodeHandle(*i));
     }
+  }
   
   return ret;
 }
@@ -171,12 +171,12 @@
   std::vector&lt;NodeHandle&gt; ret;
 
   for(Nodes::iterator i = nodes.begin(); i != nodes.end(); ++i)
-    {  
-      if (rect.is_inside((*i)-&gt;get_pos()))
-        {
-          ret.push_back(NodeHandle(*i));
-        }
+  {  
+    if (rect.is_inside((*i)-&gt;get_pos()))
+    {
+      ret.push_back(NodeHandle(*i));
     }
+  }
 
   return ret;
 }
@@ -187,14 +187,14 @@
   std::vector&lt;EdgeHandle&gt; ret;
  
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)
+  {
+    float distance = Line((*i)-&gt;get_node1()-&gt;get_pos(),
+                          (*i)-&gt;get_node2()-&gt;get_pos()).distance(pos);
+    if (distance &lt; radius)
     {
-      float distance = Line((*i)-&gt;get_node1()-&gt;get_pos(),
-                            (*i)-&gt;get_node2()-&gt;get_pos()).distance(pos);
-      if (distance &lt; radius)
-        {
-          ret.push_back(EdgeHandle(*i));
-        }
+      ret.push_back(EdgeHandle(*i));
     }
+  }
 
   return ret;
 }
@@ -207,14 +207,14 @@
   float min_distance = radius;
 
   for(Nodes::iterator i = nodes.begin(); i != nodes.end(); ++i)
+  {
+    float current_distance = (pos - (*i)-&gt;get_pos()).length();
+    if (current_distance &lt; min_distance)
     {
-      float current_distance = (pos - (*i)-&gt;get_pos()).length();
-      if (current_distance &lt; min_distance)
-        {
-          min_distance = current_distance;
-          node = *i;
-        }
+      min_distance = current_distance;
+      node = *i;
     }
+  }
   
   return NodeHandle(node);
 }
@@ -226,15 +226,15 @@
   float min_distance = radius;
 
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)
+  {
+    float current_distance = Line((*i)-&gt;get_node1()-&gt;get_pos(),
+                                  (*i)-&gt;get_node2()-&gt;get_pos()).distance(pos);
+    if (current_distance &lt; min_distance)
     {
-      float current_distance = Line((*i)-&gt;get_node1()-&gt;get_pos(),
-                                    (*i)-&gt;get_node2()-&gt;get_pos()).distance(pos);
-      if (current_distance &lt; min_distance)
-        {
-          min_distance = current_distance;
-          edge = *i;
-        }
+      min_distance = current_distance;
+      edge = *i;
     }
+  }
 
   return EdgeHandle(edge);
 }
@@ -243,17 +243,17 @@
 NavigationGraph::draw()
 {
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)
-    {
-      Display::draw_line_with_normal(Line((*i)-&gt;get_node1()-&gt;get_pos(),
-                                          (*i)-&gt;get_node2()-&gt;get_pos()),
-                                     Color(1.0f, 0.0f, 0.0f));
-    }
+  {
+    Display::draw_line_with_normal(Line((*i)-&gt;get_node1()-&gt;get_pos(),
+                                        (*i)-&gt;get_node2()-&gt;get_pos()),
+                                   Color(1.0f, 0.0f, 0.0f));
+  }
 
   for(Nodes::iterator i = nodes.begin(); i != nodes.end(); ++i)
-    {
-      Display::fill_rect(Rectf((*i)-&gt;get_pos() - Vector2f(4,4), Sizef(9, 9)),
-                         Color(1.0f, 1.0f, 0.0f));
-    }
+  {
+    Display::fill_rect(Rectf((*i)-&gt;get_pos() - Vector2f(4,4), Sizef(9, 9)),
+                       Color(1.0f, 1.0f, 0.0f));
+  }
 }
 
 void
@@ -267,72 +267,72 @@
 
   FileReader nodes_group_reader;
   if (reader.get(&quot;nodes&quot;, nodes_group_reader))
+  {
+    std::vector&lt;FileReader&gt; nodes_reader = nodes_group_reader.get_sections();
+    for(std::vector&lt;FileReader&gt;::iterator i = nodes_reader.begin(); i != nodes_reader.end(); ++i)
     {
-      std::vector&lt;FileReader&gt; nodes_reader = nodes_group_reader.get_sections();
-      for(std::vector&lt;FileReader&gt;::iterator i = nodes_reader.begin(); i != nodes_reader.end(); ++i)
+      if (i-&gt;get_name() == &quot;node&quot;)
+      {
+        Vector2f pos;
+        if (i-&gt;get(&quot;pos&quot;, pos))
         {
-          if (i-&gt;get_name() == &quot;node&quot;)
-            {
-              Vector2f pos;
-              if (i-&gt;get(&quot;pos&quot;, pos))
-                {
-                  Node* node = new Node(pos);
-                  id2ptr[id_count++] = node;
-                  nodes.push_back(node);
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;NavigationGraph:load: nodes: node: Couldn't read pos attribute&quot; &lt;&lt; std::endl;
-                }
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;NavigationGraph:load: nodes: Unknown tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
-            }
+          Node* node = new Node(pos);
+          id2ptr[id_count++] = node;
+          nodes.push_back(node);
         }
+        else
+        {
+          std::cout &lt;&lt; &quot;NavigationGraph:load: nodes: node: Couldn't read pos attribute&quot; &lt;&lt; std::endl;
+        }
+      }
+      else
+      {
+        std::cout &lt;&lt; &quot;NavigationGraph:load: nodes: Unknown tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
+      }
     }
+  }
   
   FileReader edges_group_reader;
   if (reader.get(&quot;edges&quot;, edges_group_reader))
+  {
+    std::vector&lt;FileReader&gt; edges_reader = edges_group_reader.get_sections();
+    for(std::vector&lt;FileReader&gt;::iterator i = edges_reader.begin(); i != edges_reader.end(); ++i)
     {
-      std::vector&lt;FileReader&gt; edges_reader = edges_group_reader.get_sections();
-      for(std::vector&lt;FileReader&gt;::iterator i = edges_reader.begin(); i != edges_reader.end(); ++i)
+      if (i-&gt;get_name() == &quot;edge&quot;)
+      {
+        int node_left;
+        int node_right;
+        int properties;
+
+        if (i-&gt;get(&quot;node1&quot;, node_left) &amp;&amp;
+            i-&gt;get(&quot;node2&quot;, node_right) &amp;&amp;
+            i-&gt;get(&quot;properties&quot;, properties)) // FIXME: we might want to read a unsigned int instead
         {
-          if (i-&gt;get_name() == &quot;edge&quot;)
-            {
-              int node_left;
-              int node_right;
-              int properties;
+          std::map&lt;int, Node*&gt;::iterator node_left_ptr  = id2ptr.find(node_left);
+          std::map&lt;int, Node*&gt;::iterator node_right_ptr = id2ptr.find(node_right);
 
-              if (i-&gt;get(&quot;node1&quot;, node_left) &amp;&amp;
-                  i-&gt;get(&quot;node2&quot;, node_right) &amp;&amp;
-                  i-&gt;get(&quot;properties&quot;, properties)) // FIXME: we might want to read a unsigned int instead
-                {
-                  std::map&lt;int, Node*&gt;::iterator node_left_ptr  = id2ptr.find(node_left);
-                  std::map&lt;int, Node*&gt;::iterator node_right_ptr = id2ptr.find(node_right);
-
-                  if (node_left_ptr != id2ptr.end() &amp;&amp; node_right_ptr != id2ptr.end())
-                    {
-                      Edge* edge = new Edge(node_left_ptr-&gt;second, node_right_ptr-&gt;second, properties);
-                      edges.push_back(edge);
-                    }
-                  else
-                    {
-                      std::cout &lt;&lt; &quot;NavigationGraph: edge: Couldn't lookup ids: &quot;
-                                &lt;&lt; node_left &lt;&lt; &quot; &quot; &lt;&lt; node_right &lt;&lt; std::endl;
-                    }
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;NavigationGraph:load: edges: edge: parse error&quot; &lt;&lt; std::endl;
-                }
-            }
+          if (node_left_ptr != id2ptr.end() &amp;&amp; node_right_ptr != id2ptr.end())
+          {
+            Edge* edge = new Edge(node_left_ptr-&gt;second, node_right_ptr-&gt;second, properties);
+            edges.push_back(edge);
+          }
           else
-            {
-              std::cout &lt;&lt; &quot;NavigationGraph:load: edges: Unknown tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
-            }
-        }      
-    }
+          {
+            std::cout &lt;&lt; &quot;NavigationGraph: edge: Couldn't lookup ids: &quot;
+                      &lt;&lt; node_left &lt;&lt; &quot; &quot; &lt;&lt; node_right &lt;&lt; std::endl;
+          }
+        }
+        else
+        {
+          std::cout &lt;&lt; &quot;NavigationGraph:load: edges: edge: parse error&quot; &lt;&lt; std::endl;
+        }
+      }
+      else
+      {
+        std::cout &lt;&lt; &quot;NavigationGraph:load: edges: Unknown tag: &quot; &lt;&lt; i-&gt;get_name() &lt;&lt; std::endl;
+      }
+    }      
+  }
 }
 
 void
@@ -378,23 +378,23 @@
 
   writer.start_section(&quot;nodes&quot;);
   for(Nodes::iterator i = nodes.begin(); i != nodes.end(); ++i)
-    {
-      writer.start_section(&quot;node&quot;);
-      writer.write(&quot;id&quot;, ptr2id[*i]);
-      writer.write(&quot;pos&quot;, (*i)-&gt;get_pos());
-      writer.end_section();
-    }
+  {
+    writer.start_section(&quot;node&quot;);
+    writer.write(&quot;id&quot;, ptr2id[*i]);
+    writer.write(&quot;pos&quot;, (*i)-&gt;get_pos());
+    writer.end_section();
+  }
   writer.end_section();
 
   writer.start_section(&quot;edges&quot;);
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)  
-    {
-      writer.start_section(&quot;edge&quot;);
-      writer.write(&quot;node1&quot;, ptr2id[(*i)-&gt;get_node1()]);
-      writer.write(&quot;node2&quot;, ptr2id[(*i)-&gt;get_node2()]);
-      writer.write(&quot;properties&quot;, static_cast&lt;int&gt;((*i)-&gt;get_properties()));
-      writer.end_section();
-    }
+  {
+    writer.start_section(&quot;edge&quot;);
+    writer.write(&quot;node1&quot;, ptr2id[(*i)-&gt;get_node1()]);
+    writer.write(&quot;node2&quot;, ptr2id[(*i)-&gt;get_node2()]);
+    writer.write(&quot;properties&quot;, static_cast&lt;int&gt;((*i)-&gt;get_properties()));
+    writer.end_section();
+  }
   writer.end_section();
 }
 

Modified: trunk/windstille/src/navigation/node.cpp
===================================================================
--- trunk/windstille/src/navigation/node.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/navigation/node.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,10 +18,10 @@
 
 #include &quot;navigation/node.hpp&quot;
 
-Node::Node(const Vector2f&amp; pos_)
-  : pos(pos_),
-    edges()
-    // FIXME: Do something with id
+Node::Node(const Vector2f&amp; pos_) :
+  pos(pos_),
+  edges()
+  // FIXME: Do something with id
 {
 }
 
@@ -39,13 +39,13 @@
 Node::remove_edge(Edge* edge)
 {
   for(Edges::iterator i = edges.begin(); i != edges.end(); ++i)
+  {
+    if (i-&gt;edge == edge)
     {
-      if (i-&gt;edge == edge)
-        {
-          edges.erase(i);
-          return;
-        }
+      edges.erase(i);
+      return;
     }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/objects/background_gradient.cpp
===================================================================
--- trunk/windstille/src/objects/background_gradient.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/background_gradient.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,8 +23,8 @@
 #include &quot;scenegraph/vertex_array_drawable.hpp&quot;
 #include &quot;scenegraph/gradient_drawable.hpp&quot;
 
-BackgroundGradient::BackgroundGradient(const FileReader&amp; props)
-  : drawable()
+BackgroundGradient::BackgroundGradient(const FileReader&amp; props) :
+  drawable()
 {
   std::vector&lt;float&gt; colors;
 
@@ -32,21 +32,21 @@
   props.get(&quot;colors&quot;, colors);
 
   if (colors.size() % (3 + 4 + 4 + 2) != 0)
-    {
-      std::cout &lt;&lt; &quot;BackgroundGradient: specified color gradient is invalid&quot; &lt;&lt; std::endl;
-      /** Color gradients are in the format:
+  {
+    std::cout &lt;&lt; &quot;BackgroundGradient: specified color gradient is invalid&quot; &lt;&lt; std::endl;
+    /** Color gradients are in the format:
           
-      (colors start midpoint end R1 G1 B1 A1 R2 G2 B2 A2 I I
-              start midpoint end R1 G1 B1 A1 R2 G2 B2 A2 I I
-              ...)
+        (colors start midpoint end R1 G1 B1 A1 R2 G2 B2 A2 I I
+        start midpoint end R1 G1 B1 A1 R2 G2 B2 A2 I I
+        ...)
 
-              I is ignored
+        I is ignored
 
-          all specified in float, this is similar to Gimps gradients
-          so you can easily copy&amp;paste
-       */
-      colors.clear();
-    }
+        all specified in float, this is similar to Gimps gradients
+        so you can easily copy&amp;paste
+    */
+    colors.clear();
+  }
 
   drawable.reset(new GradientDrawable(colors));
   Sector::current()-&gt;get_scene_graph().add_drawable(drawable);

Modified: trunk/windstille/src/objects/bomb.cpp
===================================================================
--- trunk/windstille/src/objects/bomb.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/bomb.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,16 +19,16 @@
 #include &quot;app/globals.hpp&quot;
 #include &quot;objects/bomb.hpp&quot;
 
-Bomb::Bomb(int x, int y)
-  : sprite(Pathname(&quot;images/bomb.sprite&quot;)),
-    explo(Pathname(&quot;images/explo.sprite&quot;)),
-    light(Pathname(&quot;images/bomblight.sprite&quot;)),
-    highlight(Pathname(&quot;images/bombhighlight.sprite&quot;)),
-    explolight(Pathname(&quot;images/explolight.sprite&quot;)),
-    pos(static_cast&lt;float&gt;(x), static_cast&lt;float&gt;((y / TILE_SIZE + 1) * TILE_SIZE)),
-    count(2.0f),
-    state(COUNTDOWN),
-    exploded(false)
+Bomb::Bomb(int x, int y) :
+  sprite(Pathname(&quot;images/bomb.sprite&quot;)),
+  explo(Pathname(&quot;images/explo.sprite&quot;)),
+  light(Pathname(&quot;images/bomblight.sprite&quot;)),
+  highlight(Pathname(&quot;images/bombhighlight.sprite&quot;)),
+  explolight(Pathname(&quot;images/explolight.sprite&quot;)),
+  pos(static_cast&lt;float&gt;(x), static_cast&lt;float&gt;((y / TILE_SIZE + 1) * TILE_SIZE)),
+  count(2.0f),
+  state(COUNTDOWN),
+  exploded(false)
 {
 }
 
@@ -50,42 +50,42 @@
   count -= delta;
 
   if (count &lt; 0 &amp;&amp; state != EXPLODE)
+  {
+    state = EXPLODE;
+    count = 0;
+    if (!exploded)
     {
-      state = EXPLODE;
-      count = 0;
-      if (!exploded)
-        {
-          exploded = true;
-          explode();
-        }
+      exploded = true;
+      explode();
+    }
 
-    }
+  }
 }
 
 void
 Bomb::draw(SceneContext&amp; sc)
 {
   if (state == EXPLODE)
-    {
-      sc.color().draw(explo, pos);
-      sc.light().draw(explolight, pos, 0);
+  {
+    sc.color().draw(explo, pos);
+    sc.light().draw(explolight, pos, 0);
 
-      explolight.set_alpha(0.5);
-      explolight.set_scale(0.5);
+    explolight.set_alpha(0.5);
+    explolight.set_scale(0.5);
 
-      sc.highlight().draw(explolight, pos, 0);
+    sc.highlight().draw(explolight, pos, 0);
 
-      explolight.set_alpha(1.0);
-      explolight.set_scale(1.0);
-    }
+    explolight.set_alpha(1.0);
+    explolight.set_scale(1.0);
+  }
   else
-    {
-      sc.color().draw(sprite, pos);
-      if (sprite.is_finished()) {
-        sc.light().draw(light, pos, 0);
-        sc.highlight().draw(highlight, pos, 0);
-      }
+  {
+    sc.color().draw(sprite, pos);
+    if (sprite.is_finished()) {
+      sc.light().draw(light, pos, 0);
+      sc.highlight().draw(highlight, pos, 0);
     }
+  }
 }
 
 void 

Modified: trunk/windstille/src/objects/box.cpp
===================================================================
--- trunk/windstille/src/objects/box.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/box.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,10 +22,10 @@
 
 #include &quot;collision/collision_engine.hpp&quot;
 
-Box::Box(const FileReader&amp; props)
-  : sprite(),
-    colobj(0),
-    gravity()
+Box::Box(const FileReader&amp; props) :
+  sprite(),
+  colobj(0),
+  gravity()
 {
   gravity = 0.0f;
   float width  = 64.0f;
@@ -66,22 +66,22 @@
   //std::cout &lt;&lt; this &lt;&lt; &quot;: Collision Event&quot; &lt;&lt; std::endl;
   if ((data.direction.x &gt; 0 &amp;&amp; colobj-&gt;get_velocity().x &lt; 0) ||
       (data.direction.x &lt; 0 &amp;&amp; colobj-&gt;get_velocity().x &gt; 0))
-    {
-      colobj-&gt;set_velocity(Vector2f(-colobj-&gt;get_velocity().x, colobj-&gt;get_velocity().y));
-    }
+  {
+    colobj-&gt;set_velocity(Vector2f(-colobj-&gt;get_velocity().x, colobj-&gt;get_velocity().y));
+  }
   
   if ((data.direction.y &gt; 0 &amp;&amp; colobj-&gt;get_velocity().y &lt; 0) ||
       (data.direction.y &lt; 0 &amp;&amp; colobj-&gt;get_velocity().y &gt; 0))
-    {
-      colobj-&gt;set_velocity(Vector2f(colobj-&gt;get_velocity().x, -colobj-&gt;get_velocity().y));
-    }
+  {
+    colobj-&gt;set_velocity(Vector2f(colobj-&gt;get_velocity().x, -colobj-&gt;get_velocity().y));
+  }
 }
 
 void 
 Box::update(float delta)
 {
   colobj-&gt;set_velocity(Vector2f(colobj-&gt;get_velocity().x, 
-                              colobj-&gt;get_velocity().y + gravity * delta));
+                                colobj-&gt;get_velocity().y + gravity * delta));
 
   sprite.update(delta);
   pos = colobj-&gt;get_pos();

Modified: trunk/windstille/src/objects/character.cpp
===================================================================
--- trunk/windstille/src/objects/character.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/character.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,9 +22,9 @@
 #include &quot;engine/script_manager.hpp&quot;
 #include &quot;app/console.hpp&quot;
 
-Character::Character(const FileReader&amp; props)
-  : sprite(),
-    z_pos(100.0f)
+Character::Character(const FileReader&amp; props) :
+  sprite(),
+  z_pos(100.0f)
 {
   set_useable(true);
   use_verb = &quot;Talk&quot;;

Modified: trunk/windstille/src/objects/decal.cpp
===================================================================
--- trunk/windstille/src/objects/decal.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/decal.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,9 +24,9 @@
 #include &quot;display/surface_drawing_parameters.hpp&quot;
 #include &quot;display/scene_context.hpp&quot;
 
-Decal::Decal(const FileReader&amp; reader)
-  : drawable(),
-    pos()
+Decal::Decal(const FileReader&amp; reader) :
+  drawable(),
+  pos()
 {
   std::string path;
   Vector2f scale(1.0f, 1.0f);
@@ -64,14 +64,14 @@
   center_offset.y *= scale.y;
 
   drawable.reset(new SurfaceDrawable(surface,
-                                           params
-                                           .set_pos(pos + center_offset)
-                                           .set_angle(angle)
-                                           .set_hflip(hflip)
-                                           .set_vflip(vflip)
-                                           .set_scale(scale),
-                                           0, 
-                                           Matrix::identity()));
+                                     params
+                                     .set_pos(pos + center_offset)
+                                     .set_angle(angle)
+                                     .set_hflip(hflip)
+                                     .set_vflip(vflip)
+                                     .set_scale(scale),
+                                     0, 
+                                     Matrix::identity()));
 
   switch(map_type)
   {

Modified: trunk/windstille/src/objects/doll.cpp
===================================================================
--- trunk/windstille/src/objects/doll.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/doll.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,13 +28,13 @@
 
 #include &quot;objects/doll.hpp&quot;
 
-Doll::Doll()
-  : m_drawable(),
-    m_velocity(),
-    m_pos(200, 600),
-    m_last_pos(m_pos),
-    m_edge_position(),
-    m_state(kNoState)
+Doll::Doll() :
+  m_drawable(),
+  m_velocity(),
+  m_pos(200, 600),
+  m_last_pos(m_pos),
+  m_edge_position(),
+  m_state(kNoState)
 {
   Sprite3D sprite(Pathname(&quot;models/characters/jane/jane.wsprite&quot;));
   m_drawable.reset(new Sprite3DDrawable(sprite, m_pos, 100.0f, Matrix::identity()));

Modified: trunk/windstille/src/objects/elevator.cpp
===================================================================
--- trunk/windstille/src/objects/elevator.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/elevator.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -20,10 +20,10 @@
 #include &quot;engine/sector.hpp&quot;
 #include &quot;collision/collision_engine.hpp&quot;
 
-Elevator::Elevator(const FileReader&amp; props)
-  : size(),
-    colobject(),
-    sprite()
+Elevator::Elevator(const FileReader&amp; props) :
+  size(),
+  colobject(),
+  sprite()
 {
   std::string spritename;
 

Modified: trunk/windstille/src/objects/grenade.cpp
===================================================================
--- trunk/windstille/src/objects/grenade.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/grenade.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -20,10 +20,10 @@
 #include &quot;collision/collision_engine.hpp&quot;
 #include &quot;objects/grenade.hpp&quot;
 
-Grenade::Grenade()
-  : sprite(Pathname(&quot;models/objects/grenade/grenade.wsprite&quot;)), 
-    physics(this),
-    c_object(new CollisionObject(this, Rectf(0, 0, 32, 32)))
+Grenade::Grenade() :
+  sprite(Pathname(&quot;models/objects/grenade/grenade.wsprite&quot;)), 
+  physics(this),
+  c_object(new CollisionObject(this, Rectf(0, 0, 32, 32)))
 {
   physics.register_collobj(*c_object);
 

Modified: trunk/windstille/src/objects/hedgehog.cpp
===================================================================
--- trunk/windstille/src/objects/hedgehog.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/hedgehog.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,13 +19,13 @@
 #include &quot;objects/player.hpp&quot;
 #include &quot;objects/hedgehog.hpp&quot;
 
-Hedgehog::Hedgehog(const FileReader&amp; props)
-  : sprite(Pathname(&quot;images/hedgehog.sprite&quot;)),
-    die_sprite(Pathname(&quot;images/hedgehog_die1.sprite&quot;)),
-    light(Pathname(&quot;images/hedgehog_light.sprite&quot;)),
-    highlight(Pathname(&quot;images/hedgehog_highlight.sprite&quot;)),
-    direction_left(false),
-    state(WALKING)
+Hedgehog::Hedgehog(const FileReader&amp; props) :
+  sprite(Pathname(&quot;images/hedgehog.sprite&quot;)),
+  die_sprite(Pathname(&quot;images/hedgehog_die1.sprite&quot;)),
+  light(Pathname(&quot;images/hedgehog_light.sprite&quot;)),
+  highlight(Pathname(&quot;images/hedgehog_highlight.sprite&quot;)),
+  direction_left(false),
+  state(WALKING)
 {
   props.get(&quot;name&quot;, name);
   props.get(&quot;pos&quot;,  pos);
@@ -63,51 +63,51 @@
 Hedgehog::update(float delta)
 {      
   if (state == DYING)
+  {
+    if (die_sprite.is_finished())
+      remove();
+    die_sprite.update(delta);
+  }
+  else
+  {
+    sprite.update(delta);
+    bool was_on_ground = false;
+      
+    if (on_ground())
     {
-      if (die_sprite.is_finished())
-        remove();
-      die_sprite.update(delta);
+      was_on_ground = true;
+      if (velocity.y &gt; 0.0f)
+      {
+        velocity.y = 0.0f;
+        pos.y = truncf(pos.y / static_cast&lt;float&gt;(TILE_SIZE)) * static_cast&lt;float&gt;(TILE_SIZE) + static_cast&lt;float&gt;(TILE_SIZE) - 1.0f;
+      }
+      if (direction_left)
+        velocity.x = -32.0f;
+      else
+        velocity.x = 32.0f;
     }
-  else
+    else
     {
-      sprite.update(delta);
-      bool was_on_ground = false;
+      velocity.y += GRAVITY * delta;
+    }
       
-      if (on_ground())
-        {
-          was_on_ground = true;
-          if (velocity.y &gt; 0.0f)
-            {
-              velocity.y = 0.0f;
-              pos.y = truncf(pos.y / static_cast&lt;float&gt;(TILE_SIZE)) * static_cast&lt;float&gt;(TILE_SIZE) + static_cast&lt;float&gt;(TILE_SIZE) - 1.0f;
-            }
-          if (direction_left)
-            velocity.x = -32.0f;
-          else
-            velocity.x = 32.0f;
-        }
-      else
-        {
-          velocity.y += GRAVITY * delta;
-        }
+    Vector2f old_pos = pos;
+    pos += velocity * delta;
       
-      Vector2f old_pos = pos;
-      pos += velocity * delta;
-      
-      if ((was_on_ground &amp;&amp; !on_ground()) || in_wall())
-        {
-          direction_left = !direction_left;
-          pos = old_pos;
-        }
+    if ((was_on_ground &amp;&amp; !on_ground()) || in_wall())
+    {
+      direction_left = !direction_left;
+      pos = old_pos;
     }
+  }
     
   // Check if the player got hit
   // FIXME: Insert pixel perfect collision detection here
   Vector2f player_pos = Player::current()-&gt;get_pos();
   if (pos.x - 20 &lt; player_pos.x
-        &amp;&amp; pos.x + 20 &gt; player_pos.x
-        &amp;&amp; pos.y - 20 &lt; player_pos.y
-        &amp;&amp; pos.y + 5  &gt; player_pos.y)
+      &amp;&amp; pos.x + 20 &gt; player_pos.x
+      &amp;&amp; pos.y - 20 &lt; player_pos.y
+      &amp;&amp; pos.y + 5  &gt; player_pos.y)
     Player::current()-&gt;hit(5);
 }
 

Modified: trunk/windstille/src/objects/laser_pointer.cpp
===================================================================
--- trunk/windstille/src/objects/laser_pointer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/laser_pointer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,12 +22,12 @@
 #include &quot;tile/tile_map.hpp&quot;
 #include &quot;objects/laser_pointer.hpp&quot;
 
-LaserPointer::LaserPointer()
- : noise(),
-   laserpointer(),
-   laserpointer_light(),
-   progress(),
-   angle()
+LaserPointer::LaserPointer() :
+  noise(),
+  laserpointer(),
+  laserpointer_light(),
+  progress(),
+  angle()
 {
   noise = Texture(Pathname(&quot;images/noise2.png&quot;));
   laserpointer = Sprite(Pathname(&quot;images/laserpointer.sprite&quot;));
@@ -47,17 +47,17 @@
 static float find_max(float pos, float v)
 {
   if (v == 0)
-    { 
-      return 0;
-    }
+  { 
+    return 0;
+  }
   else if (v &lt; 0)
-    {
-      return fmodf(fmodf(pos, static_cast&lt;float&gt;(TILE_SIZE)) + static_cast&lt;float&gt;(TILE_SIZE), static_cast&lt;float&gt;(TILE_SIZE))/fabsf(v);
-    }
+  {
+    return fmodf(fmodf(pos, static_cast&lt;float&gt;(TILE_SIZE)) + static_cast&lt;float&gt;(TILE_SIZE), static_cast&lt;float&gt;(TILE_SIZE))/fabsf(v);
+  }
   else // if (v &gt; 0)
-    {
-      return fmodf(fmodf(-pos, static_cast&lt;float&gt;(TILE_SIZE)) + static_cast&lt;float&gt;(TILE_SIZE), static_cast&lt;float&gt;(TILE_SIZE))/v;
-    }
+  {
+    return fmodf(fmodf(-pos, static_cast&lt;float&gt;(TILE_SIZE)) + static_cast&lt;float&gt;(TILE_SIZE), static_cast&lt;float&gt;(TILE_SIZE))/v;
+  }
 }
 
 void
@@ -120,7 +120,7 @@
     Vector2f ray = target - pos;
 
     VertexArrayDrawable* array = new VertexArrayDrawable(Vector2f(0,0), 10000,
-                                                                     sc.highlight().get_modelview());
+                                                         sc.highlight().get_modelview());
     array-&gt;set_mode(GL_LINES);
     array-&gt;set_texture(noise);
     array-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);

Modified: trunk/windstille/src/objects/layer.cpp
===================================================================
--- trunk/windstille/src/objects/layer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/layer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,9 +23,9 @@
 #include &quot;engine/sector.hpp&quot;
 #include &quot;engine/script_manager.hpp&quot;
 
-Layer::Layer(const FileReader&amp; reader)
-  : objects(),
-    new_objects()
+Layer::Layer(const FileReader&amp; reader) :
+  objects(),
+  new_objects()
 {
 #if 0
   FileReader objects_reader;
@@ -96,10 +96,10 @@
   commit_adds();
 
   for(Objects::iterator i = objects.begin(); i != objects.end(); ++i) 
-    {
-      if ((*i)-&gt;is_active())
-        (*i)-&gt;update(delta);
-    }
+  {
+    if ((*i)-&gt;is_active())
+      (*i)-&gt;update(delta);
+  }
 
   commit_removes();
 }

Modified: trunk/windstille/src/objects/liquid.cpp
===================================================================
--- trunk/windstille/src/objects/liquid.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/liquid.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,15 +24,15 @@
 
 #define SAMPLES 5
 
-Liquid::Liquid(const FileReader&amp; props)
-  : texture(),
-    t(),
-    heightfield_store1(),
-    heightfield_store2(),
-    heightfield1(),
-    heightfield2(),
-    m_water_top(),
-    m_water_body()
+Liquid::Liquid(const FileReader&amp; props) :
+  texture(),
+  t(),
+  heightfield_store1(),
+  heightfield_store2(),
+  heightfield1(),
+  heightfield2(),
+  m_water_top(),
+  m_water_body()
 {
   int width = 10;
   t = 0;
@@ -47,11 +47,11 @@
   heightfield2-&gt;resize(width * SAMPLES, 0);
   
   for(std::vector&lt;float&gt;::size_type i = 2; i &lt; heightfield1-&gt;size()-2; ++i)
-    {
-      (*heightfield1)[i] = sinf(static_cast&lt;float&gt;(i) / static_cast&lt;float&gt;(heightfield1-&gt;size()) * 10.0f) * 0.5f
-        + sinf(static_cast&lt;float&gt;(i) / static_cast&lt;float&gt;(heightfield1-&gt;size()) * 5.0f) * .5f;
-      (*heightfield2)[i] = (*heightfield1)[i];
-    }
+  {
+    (*heightfield1)[i] = sinf(static_cast&lt;float&gt;(i) / static_cast&lt;float&gt;(heightfield1-&gt;size()) * 10.0f) * 0.5f
+      + sinf(static_cast&lt;float&gt;(i) / static_cast&lt;float&gt;(heightfield1-&gt;size()) * 5.0f) * .5f;
+    (*heightfield2)[i] = (*heightfield1)[i];
+  }
 
   for(int i = 50; i &lt; 70 &amp;&amp; i &lt; int(heightfield1-&gt;size()); ++i)
     (*heightfield1)[i] += 0.0025f;

Modified: trunk/windstille/src/objects/nightvision.cpp
===================================================================
--- trunk/windstille/src/objects/nightvision.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/nightvision.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,9 +22,9 @@
 #include &quot;scenegraph/vertex_array_drawable.hpp&quot;
 #include &quot;math/random.hpp&quot;
 
-Nightvision::Nightvision(const FileReader&amp; props)
-  : nightvision(Pathname(&quot;images/nightvision.sprite&quot;)),
-    noise(Pathname(&quot;images/noise.png&quot;))
+Nightvision::Nightvision(const FileReader&amp; props) :
+  nightvision(Pathname(&quot;images/nightvision.sprite&quot;)),
+  noise(Pathname(&quot;images/noise.png&quot;))
 {
   name = &quot;nightvision&quot;;
   noise.set_wrap(GL_REPEAT);
@@ -44,81 +44,81 @@
 
   // try to stay above everything else with large z value
   if (1)
-    {
-      nightvision.set_alpha(1.0f);
-      nightvision.set_blend_func(GL_ONE, GL_ZERO);
-      sc.light().draw(nightvision, Vector2f(0, 0), 10000);
-    }
+  {
+    nightvision.set_alpha(1.0f);
+    nightvision.set_blend_func(GL_ONE, GL_ZERO);
+    sc.light().draw(nightvision, Vector2f(0, 0), 10000);
+  }
 
   if (1)
-    {
-      VertexArrayDrawable* array = new VertexArrayDrawable(Vector2f(0, 0), 10000,
-                                                                       sc.light().get_modelview());
-      array-&gt;set_mode(GL_QUADS);
-      array-&gt;set_texture(noise);
-      array-&gt;set_blend_func(GL_DST_COLOR, GL_ZERO);
+  {
+    VertexArrayDrawable* array = new VertexArrayDrawable(Vector2f(0, 0), 10000,
+                                                         sc.light().get_modelview());
+    array-&gt;set_mode(GL_QUADS);
+    array-&gt;set_texture(noise);
+    array-&gt;set_blend_func(GL_DST_COLOR, GL_ZERO);
 
-      float u = rnd.frand() / 0.5f;
-      float v = rnd.frand() / 0.5f;
-      float w = 4.0f / 6.0f;
-      float h = 3.0f / 6.0f;
+    float u = rnd.frand() / 0.5f;
+    float v = rnd.frand() / 0.5f;
+    float w = 4.0f / 6.0f;
+    float h = 3.0f / 6.0f;
 
-      array-&gt;texcoord(u, v);
-      array-&gt;vertex(0, 0);
+    array-&gt;texcoord(u, v);
+    array-&gt;vertex(0, 0);
 
-      array-&gt;texcoord(u + w, v);
-      array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), 0);
+    array-&gt;texcoord(u + w, v);
+    array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), 0);
 
-      array-&gt;texcoord(u + w, v + h);
-      array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), static_cast&lt;float&gt;(Display::get_height()));
+    array-&gt;texcoord(u + w, v + h);
+    array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), static_cast&lt;float&gt;(Display::get_height()));
 
-      array-&gt;texcoord(u, v + h);
-      array-&gt;vertex(0, static_cast&lt;float&gt;(Display::get_height()));
+    array-&gt;texcoord(u, v + h);
+    array-&gt;vertex(0, static_cast&lt;float&gt;(Display::get_height()));
       
-      if (0) // second noise level
-        {
-          u = rnd.frand();
-          v = rnd.frand();
-          float size = 4.0f;
+    if (0) // second noise level
+    {
+      u = rnd.frand();
+      v = rnd.frand();
+      float size = 4.0f;
 
-          array-&gt;texcoord(u, v);
-          array-&gt;vertex(0, 0, 1.0f);
+      array-&gt;texcoord(u, v);
+      array-&gt;vertex(0, 0, 1.0f);
 
-          array-&gt;texcoord(u + size, v);
-          array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), 0.0f, 1.0f);
+      array-&gt;texcoord(u + size, v);
+      array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), 0.0f, 1.0f);
 
-          array-&gt;texcoord(u + size, v + size);
-          array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), static_cast&lt;float&gt;(Display::get_height()), 1.0f);
+      array-&gt;texcoord(u + size, v + size);
+      array-&gt;vertex(static_cast&lt;float&gt;(Display::get_width()), static_cast&lt;float&gt;(Display::get_height()), 1.0f);
 
-          array-&gt;texcoord(u, v + size);
-          array-&gt;vertex(0.0f, static_cast&lt;float&gt;(Display::get_height()), 1.0f);
-        }
+      array-&gt;texcoord(u, v + size);
+      array-&gt;vertex(0.0f, static_cast&lt;float&gt;(Display::get_height()), 1.0f);
+    }
 
-      sc.light().draw(array);
-    }
+    sc.light().draw(array);
+  }
   sc.light().pop_modelview();
 
   if (1)
-    {
-      // FIXME: might be better to copy the highlight over to the
-      // color layer, however that would require some changes to the
-      // DrawingContext structure
-      sc.highlight().clear();
+  {
+    // FIXME: might be better to copy the highlight over to the
+    // color layer, however that would require some changes to the
+    // DrawingContext structure
+    sc.highlight().clear();
 
-      sc.highlight().push_modelview();
-      sc.highlight().set_modelview(Matrix::identity());
+    sc.highlight().push_modelview();
+    sc.highlight().set_modelview(Matrix::identity());
 
-      nightvision.set_alpha(0.5f);
-      nightvision.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-      nightvision.set_scale(std::max(float(Display::get_width())  / nightvision.get_width(),
-                                     float(Display::get_height()) / nightvision.get_height()));
+    nightvision.set_alpha(0.5f);
+    nightvision.set_blend_func(GL_SRC_ALPHA, GL_ONE);
+    nightvision.set_scale(std::max(float(Display::get_width())  / nightvision.get_width(),
+                                   float(Display::get_height()) / nightvision.get_height()));
 
-      sc.highlight().draw(nightvision, 
-                          Vector2f(static_cast&lt;float&gt;(Display::get_width()) / 2.0f - (nightvision.get_width()  * nightvision.get_scale() / 2.0f),
-                                   static_cast&lt;float&gt;(Display::get_height())/ 2.0f - (nightvision.get_height() * nightvision.get_scale() / 2.0f)),
-                          10000);
-      sc.highlight().pop_modelview();
-    }
+    sc.highlight().draw(nightvision, 
+                        Vector2f(static_cast&lt;float&gt;(Display::get_width()) / 2.0f - (nightvision.get_width()  * nightvision.get_scale() / 2.0f),
+                                 static_cast&lt;float&gt;(Display::get_height())/ 2.0f - (nightvision.get_height() * nightvision.get_scale() / 2.0f)),
+                        10000);
+    sc.highlight().pop_modelview();
+  }
 }
 
 void

Modified: trunk/windstille/src/objects/particle_systems.cpp
===================================================================
--- trunk/windstille/src/objects/particle_systems.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/particle_systems.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -26,9 +26,9 @@
 #include &quot;scenegraph/scene_graph.hpp&quot;
 #include &quot;scenegraph/particle_system_drawable.hpp&quot;
 
-ParticleSystems::ParticleSystems(const FileReader&amp; reader)
-  : m_systems(),
-    m_drawables()
+ParticleSystems::ParticleSystems(const FileReader&amp; reader) :
+  m_systems(),
+  m_drawables()
 {
   std::string filename;
   Vector2f    pos;

Modified: trunk/windstille/src/objects/pistol.cpp
===================================================================
--- trunk/windstille/src/objects/pistol.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/pistol.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,9 +19,9 @@
 #include &quot;objects/laser_pointer.hpp&quot;
 #include &quot;objects/pistol.hpp&quot;
 
-Pistol::Pistol()
-  : sprite(Pathname(&quot;models/objects/pistol/pistol.wsprite&quot;)),
-    laser_pointer(new LaserPointer())
+Pistol::Pistol() :
+  sprite(Pathname(&quot;models/objects/pistol/pistol.wsprite&quot;)),
+  laser_pointer(new LaserPointer())
 {
 }
 

Modified: trunk/windstille/src/objects/player.cpp
===================================================================
--- trunk/windstille/src/objects/player.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/player.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -36,20 +36,20 @@
 static const float WALK_SPEED = 100.0;
 static const float RUN_SPEED = 256.0;
 
-Player::Player () 
-  : m_drawable(),
-    jumping(),
-    bomb_placed(),
-    hit_count(),
-    energy(),
-    c_object(),
-    laser_pointer(),
-    contact(),
-    weapon(),
-    state(STAND),
-    jump_foot(),
-    reload_time(),
-    z_pos()
+Player::Player () :
+  m_drawable(),
+  jumping(),
+  bomb_placed(),
+  hit_count(),
+  energy(),
+  c_object(),
+  laser_pointer(),
+  contact(),
+  weapon(),
+  state(STAND),
+  jump_foot(),
+  reload_time(),
+  z_pos()
 {
   Sprite3D sprite(Pathname(&quot;models/characters/jane/jane.wsprite&quot;));
   pos.x = 320;
@@ -90,21 +90,21 @@
 Player::draw (SceneContext&amp; sc)
 {
   if (1)
-    { // draw the 'stand-on' tile
-      sc.highlight().fill_rect(Rect(Point(int(pos.x)/32 * 32, (int(pos.y)/32 + 1) * 32),
-                                    Size(32, 32)),
-                               Color(1.0f, 0.0f, 0.0f, 0.5f), 10000.0f);
-    }
+  { // draw the 'stand-on' tile
+    sc.highlight().fill_rect(Rect(Point(int(pos.x)/32 * 32, (int(pos.y)/32 + 1) * 32),
+                                  Size(32, 32)),
+                             Color(1.0f, 0.0f, 0.0f, 0.5f), 10000.0f);
+  }
 
   //m_drawable-&gt;get_sprite().draw(sc.color(), pos + Vector2f(0.0f, 1.0f), z_pos);
 
   Entity* obj = find_useable_entity();
   if (obj)
-    {
-      // FIXME: Highlight layer is the wrong place for this
-      std::string use_str = &quot;[&quot; + obj-&gt;get_use_verb() + &quot;]&quot;;
-      sc.highlight().draw(use_str, obj-&gt;get_pos().x, obj-&gt;get_pos().y - 150, 1000);
-    }
+  {
+    // FIXME: Highlight layer is the wrong place for this
+    std::string use_str = &quot;[&quot; + obj-&gt;get_use_verb() + &quot;]&quot;;
+    sc.highlight().draw(use_str, obj-&gt;get_pos().x, obj-&gt;get_pos().y - 150, 1000);
+  }
   
   // Draw weapon at the 'Weapon' attachment point
   Sprite3D::PointID id = m_drawable-&gt;get_sprite().get_attachment_point_id(&quot;Weapon&quot;);
@@ -115,12 +115,12 @@
   sc.pop_modelview();
 
   if (laser_pointer-&gt;is_active())
-    {
-      sc.push_modelview();
-      sc.translate(pos.x, pos.y - 80);
-      laser_pointer-&gt;draw(sc);
-      sc.pop_modelview();
-    }
+  {
+    sc.push_modelview();
+    sc.translate(pos.x, pos.y - 80);
+    laser_pointer-&gt;draw(sc);
+    sc.pop_modelview();
+  }
 }
 
 void
@@ -259,55 +259,55 @@
 Player::update_walk_stand(const Controller&amp; controller)
 {
   if (controller.get_axis_state(Y_AXIS) &gt; 0.5f)
+  {
+    TileMap* tilemap = Sector::current()-&gt;get_tilemap2();
+    if (tilemap)
     {
-      TileMap* tilemap = Sector::current()-&gt;get_tilemap2();
-      if (tilemap)
-        {
-          Point p(int(pos.x)/32, (int(pos.y)/32 + 1));
-          unsigned int col = tilemap-&gt;get_pixel(p.x, p.y);
+      Point p(int(pos.x)/32, (int(pos.y)/32 + 1));
+      unsigned int col = tilemap-&gt;get_pixel(p.x, p.y);
 
-          if ((col &amp; TILE_STAIRS) &amp;&amp; ((get_direction() == WEST &amp;&amp; (col &amp; TILE_LEFT)) ||
-                                      (get_direction() == EAST &amp;&amp; (col &amp; TILE_RIGHT))))
-            {
-              delete contact;
-              contact = new StairContact(tilemap, p);
+      if ((col &amp; TILE_STAIRS) &amp;&amp; ((get_direction() == WEST &amp;&amp; (col &amp; TILE_LEFT)) ||
+                                  (get_direction() == EAST &amp;&amp; (col &amp; TILE_RIGHT))))
+      {
+        delete contact;
+        contact = new StairContact(tilemap, p);
 
-              std::cout &lt;&lt; &quot;Stair mode&quot; &lt;&lt; std::endl;
-              state = STAIRS_DOWN;
-              //c_object-&gt;get_check_domains() &amp; (~CollisionObject::DOMAIN_TILEMAP));
-              Sector::current()-&gt;get_collision_engine()-&gt;remove(c_object);
-              z_pos = -10.0f;
-              return;
-            }
-          else
-            {
-              set_ducking();
-              return;
-            }
-        }
+        std::cout &lt;&lt; &quot;Stair mode&quot; &lt;&lt; std::endl;
+        state = STAIRS_DOWN;
+        //c_object-&gt;get_check_domains() &amp; (~CollisionObject::DOMAIN_TILEMAP));
+        Sector::current()-&gt;get_collision_engine()-&gt;remove(c_object);
+        z_pos = -10.0f;
+        return;
+      }
+      else
+      {
+        set_ducking();
+        return;
+      }
     }
+  }
   else if (controller.get_axis_state(Y_AXIS) &lt; -0.5f)
+  {
+    TileMap* tilemap = Sector::current()-&gt;get_tilemap2();
+    if (tilemap)
     {
-      TileMap* tilemap = Sector::current()-&gt;get_tilemap2();
-      if (tilemap)
-        {
-          Point p(int(pos.x)/32 + ((get_direction() == WEST) ? -1 : +1), (int(pos.y)/32));
-          unsigned int col = tilemap-&gt;get_pixel(p.x, p.y);
+      Point p(int(pos.x)/32 + ((get_direction() == WEST) ? -1 : +1), (int(pos.y)/32));
+      unsigned int col = tilemap-&gt;get_pixel(p.x, p.y);
 
-          if ((col &amp; TILE_STAIRS) &amp;&amp; ((get_direction() == EAST &amp;&amp; (col &amp; TILE_LEFT)) ||
-                                      (get_direction() == WEST &amp;&amp; (col &amp; TILE_RIGHT))))
-            {
-              delete contact;
-              contact = new StairContact(tilemap, p);
+      if ((col &amp; TILE_STAIRS) &amp;&amp; ((get_direction() == EAST &amp;&amp; (col &amp; TILE_LEFT)) ||
+                                  (get_direction() == WEST &amp;&amp; (col &amp; TILE_RIGHT))))
+      {
+        delete contact;
+        contact = new StairContact(tilemap, p);
 
-              state = STAIRS_UP;
-              //c_object-&gt;get_check_domains() &amp; (~CollisionObject::DOMAIN_TILEMAP));
-              Sector::current()-&gt;get_collision_engine()-&gt;remove(c_object);
-              z_pos = -10.0f;
-              return;
-            }
-        }    
-    }
+        state = STAIRS_UP;
+        //c_object-&gt;get_check_domains() &amp; (~CollisionObject::DOMAIN_TILEMAP));
+        Sector::current()-&gt;get_collision_engine()-&gt;remove(c_object);
+        z_pos = -10.0f;
+        return;
+      }
+    }    
+  }
 
   if (state == STAND)
     update_stand(controller);
@@ -322,23 +322,23 @@
 
   if (controller.get_axis_state(X_AXIS) &lt; -0.5f ||
       controller.get_axis_state(Y_AXIS) &gt; 0.5f)
-    {
-      contact-&gt;advance(-WALK_SPEED * delta * 0.7f);
-    }
+  {
+    contact-&gt;advance(-WALK_SPEED * delta * 0.7f);
+  }
   else if (controller.get_axis_state(X_AXIS) &gt; 0.5f ||
            controller.get_axis_state(Y_AXIS) &lt; -0.5f)
-    {
-      contact-&gt;advance(WALK_SPEED * delta * 0.7f);
-    }
+  {
+    contact-&gt;advance(WALK_SPEED * delta * 0.7f);
+  }
 
   velocity = Vector2f(0, 0);
   c_object-&gt;set_pos(contact-&gt;get_pos());
 
   if (!contact-&gt;is_active())
-    {
-      Sector::current()-&gt;get_collision_engine()-&gt;add(c_object);
-      state = STAND;
-    }
+  {
+    Sector::current()-&gt;get_collision_engine()-&gt;add(c_object);
+    state = STAND;
+  }
 }
 
 Entity*
@@ -347,19 +347,19 @@
   const std::vector&lt;boost::shared_ptr&lt;GameObject&gt; &gt;&amp; objects = Sector::current()-&gt;get_objects();
 
   for (std::vector&lt;boost::shared_ptr&lt;GameObject&gt; &gt;::const_iterator i = objects.begin(); i != objects.end(); ++i)
+  {
+    Entity* object = dynamic_cast&lt;Entity*&gt;(i-&gt;get());
+
+    if (object &amp;&amp; object != this &amp;&amp; object-&gt;is_useable())
     {
-      Entity* object = dynamic_cast&lt;Entity*&gt;(i-&gt;get());
-
-      if (object &amp;&amp; object != this &amp;&amp; object-&gt;is_useable())
-        {
-          //FIXME use proper collision detection
-          if (object-&gt;get_pos().x &gt; pos.x - 32 &amp;&amp; object-&gt;get_pos().x &lt; pos.x + 32 &amp;&amp;
-              object-&gt;get_pos().y &gt; pos.y - 256 &amp;&amp; object-&gt;get_pos().y &lt; pos.y + 256)
-            {
-              return object;
-            }
-        }
+      //FIXME use proper collision detection
+      if (object-&gt;get_pos().x &gt; pos.x - 32 &amp;&amp; object-&gt;get_pos().x &lt; pos.x + 32 &amp;&amp;
+          object-&gt;get_pos().y &gt; pos.y - 256 &amp;&amp; object-&gt;get_pos().y &lt; pos.y + 256)
+      {
+        return object;
+      }
     }
+  }
   return 0;  
 }
 
@@ -367,48 +367,48 @@
 Player::update_stand(const Controller&amp; controller)
 { 
   if (controller.button_was_pressed(USE_BUTTON))
-    {
-      Entity* obj = find_useable_entity();
-      if (obj)
-        obj-&gt;use();
-      return;
-    }
+  {
+    Entity* obj = find_useable_entity();
+    if (obj)
+      obj-&gt;use();
+    return;
+  }
     
   if (controller.button_was_pressed(JUMP_BUTTON)
       &amp;&amp; controller.get_axis_state(Y_AXIS) &gt; 0.5f) 
-    {
-      set_jump_up_begin();
-    } 
+  {
+    set_jump_up_begin();
+  } 
   else if (controller.button_was_pressed(AIM_BUTTON))
+  {
+    if (0)
     {
-      if (0)
-        {
-          // TODO remove me later, just here for testing
-          boost::shared_ptr&lt;Grenade&gt; grenade(new Grenade());
-          grenade-&gt;set_pos(get_pos() + Vector2f(50, -300));
-          grenade-&gt;set_velocity(Vector2f(20, -10));
-          Sector::current()-&gt;add(grenade);
-        }
-      else
-        {
-          m_drawable-&gt;get_sprite().set_action(&quot;PullGun&quot;);
-          state = PULL_GUN;
-        }
+      // TODO remove me later, just here for testing
+      boost::shared_ptr&lt;Grenade&gt; grenade(new Grenade());
+      grenade-&gt;set_pos(get_pos() + Vector2f(50, -300));
+      grenade-&gt;set_velocity(Vector2f(20, -10));
+      Sector::current()-&gt;add(grenade);
     }
-  else if (controller.get_axis_state(X_AXIS) &lt; -0.5f) 
+    else
     {
-      if (get_direction() == WEST)
-        set_walk(WEST);
-      else
-        set_turnaround();
+      m_drawable-&gt;get_sprite().set_action(&quot;PullGun&quot;);
+      state = PULL_GUN;
     }
+  }
+  else if (controller.get_axis_state(X_AXIS) &lt; -0.5f) 
+  {
+    if (get_direction() == WEST)
+      set_walk(WEST);
+    else
+      set_turnaround();
+  }
   else if (controller.get_axis_state(X_AXIS) &gt; 0.5f) 
-    {
-      if (get_direction() == EAST)
-        set_walk(EAST);
-      else
-        set_turnaround();
-    }
+  {
+    if (get_direction() == EAST)
+      set_walk(EAST);
+    else
+      set_turnaround();
+  }
 }
 
 void
@@ -432,26 +432,26 @@
 Player::update_walk(const Controller&amp; controller)
 {
   if (fabsf(controller.get_axis_state(X_AXIS)) &lt; 0.5f) // Hardcoded DEAD_ZONE, somewhat evil 
-    {
-      leave_walk();
-      set_stand();
-      return;
-    }
+  {
+    leave_walk();
+    set_stand();
+    return;
+  }
 
   if ((get_direction() == WEST &amp;&amp; controller.get_axis_state(X_AXIS) &gt; 0.5f) ||
       (get_direction() == EAST &amp;&amp; controller.get_axis_state(X_AXIS) &lt; -0.5f))
-    {
-      leave_walk();
-      set_turnaround();
-      return;
-    }
+  {
+    leave_walk();
+    set_turnaround();
+    return;
+  }
   
   if (controller.get_button_state(RUN_BUTTON))
-    {
-      leave_walk();
-      set_run();
-      return;
-    }
+  {
+    leave_walk();
+    set_run();
+    return;
+  }
 }
 
 void
@@ -475,25 +475,25 @@
 {
   // ducking
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      if (m_drawable-&gt;get_sprite().get_action() == &quot;Ducking&quot;)
-        set_ducked();
-      else
-        set_stand();
-      return;
-    }
+  {
+    if (m_drawable-&gt;get_sprite().get_action() == &quot;Ducking&quot;)
+      set_ducked();
+    else
+      set_stand();
+    return;
+  }
   
   if (!(controller.get_axis_state(Y_AXIS) &gt; 0.5f) &amp;&amp; m_drawable-&gt;get_sprite().get_speed() &gt; 0) 
-    {
-      m_drawable-&gt;get_sprite().set_speed(-1.0);
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);
-      state = STAND;
-    } 
+  {
+    m_drawable-&gt;get_sprite().set_speed(-1.0);
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);
+    state = STAND;
+  } 
   else if (controller.get_axis_state(Y_AXIS) &gt; 0.5f &amp;&amp; m_drawable-&gt;get_sprite().get_speed() &lt; 0) 
-    {
-      m_drawable-&gt;get_sprite().set_speed(1.0);
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Ducking&quot;);
-    }
+  {
+    m_drawable-&gt;get_sprite().set_speed(1.0);
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Ducking&quot;);
+  }
 }
 
 void
@@ -507,11 +507,11 @@
 Player::update_ducked(const Controller&amp; controller)
 {
   if (!(controller.get_axis_state(Y_AXIS) &gt; 0.5f))
-    {
-      state = DUCKING;
-      m_drawable-&gt;get_sprite().set_action(&quot;StandToDuck&quot;, -1.0);
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);
-    }  
+  {
+    state = DUCKING;
+    m_drawable-&gt;get_sprite().set_action(&quot;StandToDuck&quot;, -1.0);
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);
+  }  
 }
 
 void
@@ -528,22 +528,22 @@
 Player::update_turnaround(const Controller&amp; controller)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
+  {
+    if (m_drawable-&gt;get_sprite().get_rot())
     {
-      if (m_drawable-&gt;get_sprite().get_rot())
-        {
-          set_walk(EAST);
-        }
-      else {
-        set_walk(WEST);
-      }
-    } 
+      set_walk(EAST);
+    }
+    else {
+      set_walk(WEST);
+    }
+  } 
   if ((m_drawable-&gt;get_sprite().get_rot() &amp;&amp; controller.get_axis_state(X_AXIS) &gt; 0.5f) ||
       (!m_drawable-&gt;get_sprite().get_rot() &amp;&amp; controller.get_axis_state(X_AXIS) &lt; -0.5f)) 
-    {
-      m_drawable-&gt;get_sprite().set_speed(-1.0);
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Walk&quot;);
-      state = WALK;
-    }
+  {
+    m_drawable-&gt;get_sprite().set_speed(-1.0);
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Walk&quot;);
+    state = WALK;
+  }
 }
 
 void
@@ -551,14 +551,14 @@
 {
   try_set_action(&quot;StandtoListen&quot;, backwards ? -1.0f : 1.0f);
   if (!backwards) 
-    {
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Listen&quot;);
-      velocity = Vector2f(0, 0);
-    } 
+  {
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Listen&quot;);
+    velocity = Vector2f(0, 0);
+  } 
   else
-    {
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);
-    }
+  {
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);
+  }
   state = STAND_TO_LISTEN;
 }
 
@@ -566,12 +566,12 @@
 Player::update_stand_to_listen(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      if (m_drawable-&gt;get_sprite().get_action() == &quot;Stand&quot;)
-        set_stand();
-      else
-        set_listen();
-    }
+  {
+    if (m_drawable-&gt;get_sprite().get_action() == &quot;Stand&quot;)
+      set_stand();
+    else
+      set_listen();
+  }
 }
 
 void
@@ -607,17 +607,17 @@
 Player::update_run(const Controller&amp; controller)
 {
   if (!controller.get_button_state(RUN_BUTTON)) 
-    {
-      leave_run();
-      set_walk(get_direction());
-      return;
-    }
+  {
+    leave_run();
+    set_walk(get_direction());
+    return;
+  }
   if (controller.get_button_state(JUMP_BUTTON)) 
-    {
-      leave_run();
-      set_jump_begin();
-      return;
-    }
+  {
+    leave_run();
+    set_jump_begin();
+    return;
+  }
 }
 
 void
@@ -630,23 +630,23 @@
 Player::set_jump_begin()
 {
   if (m_drawable-&gt;get_sprite().before_marker(&quot;RightFoot&quot;)) 
-    {
-      m_drawable-&gt;get_sprite().set_next_action(&quot;JumpRightFoot&quot;);
-      m_drawable-&gt;get_sprite().abort_at_marker(&quot;RightFoot&quot;);
-      jump_foot = LEFT_FOOT;
-    } 
+  {
+    m_drawable-&gt;get_sprite().set_next_action(&quot;JumpRightFoot&quot;);
+    m_drawable-&gt;get_sprite().abort_at_marker(&quot;RightFoot&quot;);
+    jump_foot = LEFT_FOOT;
+  } 
   else if (m_drawable-&gt;get_sprite().before_marker(&quot;LeftFoot&quot;)) 
-    {
-      m_drawable-&gt;get_sprite().set_next_action(&quot;JumpLeftFoot&quot;);
-      m_drawable-&gt;get_sprite().abort_at_marker(&quot;LeftFoot&quot;);
-      jump_foot = RIGHT_FOOT;
-    } 
+  {
+    m_drawable-&gt;get_sprite().set_next_action(&quot;JumpLeftFoot&quot;);
+    m_drawable-&gt;get_sprite().abort_at_marker(&quot;LeftFoot&quot;);
+    jump_foot = RIGHT_FOOT;
+  } 
   else 
-    {
-      m_drawable-&gt;get_sprite().set_next_action(&quot;JumpRightFoot&quot;);
-      m_drawable-&gt;get_sprite().abort_at_marker(&quot;RightFoot&quot;);
-      jump_foot = LEFT_FOOT;
-    }
+  {
+    m_drawable-&gt;get_sprite().set_next_action(&quot;JumpRightFoot&quot;);
+    m_drawable-&gt;get_sprite().abort_at_marker(&quot;RightFoot&quot;);
+    jump_foot = LEFT_FOOT;
+  }
   state = JUMP_BEGIN;
 }
 
@@ -654,21 +654,21 @@
 Player::update_jump_begin(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
+  {
+    if (m_drawable-&gt;get_sprite().get_action() == &quot;JumpLeftFoot&quot;) 
     {
-      if (m_drawable-&gt;get_sprite().get_action() == &quot;JumpLeftFoot&quot;) 
-        {
-          m_drawable-&gt;get_sprite().set_next_action(&quot;JumpLeftFootAir&quot;);
-        } 
-      else if (m_drawable-&gt;get_sprite().get_action() == &quot;JumpRightFoot&quot;) 
-        {
-          m_drawable-&gt;get_sprite().set_next_action(&quot;JumpRightFootAir&quot;);
-        } 
-      else
-        {
-          set_jump_air();
-          return;
-        }
+      m_drawable-&gt;get_sprite().set_next_action(&quot;JumpLeftFootAir&quot;);
+    } 
+    else if (m_drawable-&gt;get_sprite().get_action() == &quot;JumpRightFoot&quot;) 
+    {
+      m_drawable-&gt;get_sprite().set_next_action(&quot;JumpRightFootAir&quot;);
+    } 
+    else
+    {
+      set_jump_air();
+      return;
     }
+  }
 }
 
 void
@@ -683,10 +683,10 @@
 Player::update_jump_air(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      set_jump_land();
-      return;
-    }
+  {
+    set_jump_land();
+    return;
+  }
 }
 
 void
@@ -700,10 +700,10 @@
 Player::update_jump_land(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      set_run();
-      return;
-    }
+  {
+    set_run();
+    return;
+  }
 }
 
 void
@@ -717,10 +717,10 @@
 Player::update_jump_up_begin(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      set_jump_up_air();
-      return;
-    }
+  {
+    set_jump_up_air();
+    return;
+  }
 }
 
 void
@@ -735,10 +735,10 @@
 Player::update_jump_up_air(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      set_jump_up_land();
-      return;
-    }
+  {
+    set_jump_up_land();
+    return;
+  }
 }
 
 void
@@ -752,20 +752,20 @@
 Player::update_jump_up_land(const Controller&amp; /*controller*/)
 {
   if (m_drawable-&gt;get_sprite().switched_actions()) 
-    {
-      set_stand();
-      return;
-    }
+  {
+    set_stand();
+    return;
+  }
 }
 
 void
 Player::update_pull_gun(const Controller&amp; controller)
 {
   if (!controller.get_button_state(AIM_BUTTON))
-    {
-      m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);      
-      state = STAND;
-    }
+  {
+    m_drawable-&gt;get_sprite().set_next_action(&quot;Stand&quot;);      
+    state = STAND;
+  }
 }
 
 Player::Direction
@@ -797,16 +797,16 @@
 Player::hit(int points)
 {
   if (energy &gt; 0 &amp;&amp; hit_count &lt;= 0)
+  {
+    energy -= points;
+    //hit_count = 1.0f;
+
+    if (energy &lt;= 0)
     {
-      energy -= points;
-      //hit_count = 1.0f;
-
-      if (energy &lt;= 0)
-        {
-          //switch_movement_state(KILLED);
-          hit_count = 0;
-        }
+      //switch_movement_state(KILLED);
+      hit_count = 0;
     }
+  }
 }
 
 void
@@ -816,15 +816,15 @@
   // cur_vel is the velocity in the current delta-frame
   Vector2f cur_vel = c_object-&gt;get_velocity(); 
   if (data.direction.y != 0)
-    {
-      cur_vel.y = 0;
-      velocity.y = 0; // also reset vertical velocity
-    }
+  {
+    cur_vel.y = 0;
+    velocity.y = 0; // also reset vertical velocity
+  }
   else
-    {
-      // do not reset horizontal velocity, as it's only set, when starting to go/run
-      cur_vel.x = 0;
-    }
+  {
+    // do not reset horizontal velocity, as it's only set, when starting to go/run
+    cur_vel.x = 0;
+  }
   c_object-&gt;set_velocity (cur_vel);
 }
 

Modified: trunk/windstille/src/objects/scriptable_object.cpp
===================================================================
--- trunk/windstille/src/objects/scriptable_object.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/scriptable_object.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,11 +22,11 @@
 #include &quot;app/globals.hpp&quot;
 #include &quot;objects/scriptable_object.hpp&quot;
 
-ScriptableObject::ScriptableObject(const FileReader&amp; props)
-  : z_pos(50),
-    target_speed(0),
-    acceleration(0),
-    flash_speed(0)
+ScriptableObject::ScriptableObject(const FileReader&amp; props) :
+  z_pos(50),
+  target_speed(0),
+  acceleration(0),
+  flash_speed(0)
 { 
   std::string spritename;
   std::string highlightname;
@@ -50,16 +50,16 @@
     sprite = Sprite(Pathname(spritename));
   
   if (highlightname != &quot;&quot;)
-    {
-      highlight = Sprite(Pathname(highlightname));
-      highlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-    }
+  {
+    highlight = Sprite(Pathname(highlightname));
+    highlight.set_blend_func(GL_SRC_ALPHA, GL_ONE);
+  }
 
   if (lightname != &quot;&quot;)
-    {
-      light = Sprite(Pathname(lightname));
-      light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
-    }
+  {
+    light = Sprite(Pathname(lightname));
+    light.set_blend_func(GL_SRC_ALPHA, GL_ONE);
+  }
     
   flash_delta = game_time;
   target_x = pos.x;
@@ -88,9 +88,9 @@
     sc.highlight().draw(highlight, tmp_pos, z_pos);
 
   if (light) 
-    {
-      sc.light().draw(light, tmp_pos, z_pos);
-    }
+  {
+    sc.light().draw(light, tmp_pos, z_pos);
+  }
 }
 
 void
@@ -113,18 +113,18 @@
 ScriptableObject::use()
 {
   if (!script_file.empty())
+  {
+    try 
     {
-      try 
-        {
-          Pathname path = Sector::current()-&gt;get_directory();
-          path.append_path(name).append_text(&quot;.nut&quot;);
-          ScriptManager::current()-&gt;run_script_file(path);
-        }
-      catch (std::exception&amp; e) 
-        {
-          ConsoleLog &lt;&lt; e.what() &lt;&lt; std::endl;
-        }
+      Pathname path = Sector::current()-&gt;get_directory();
+      path.append_path(name).append_text(&quot;.nut&quot;);
+      ScriptManager::current()-&gt;run_script_file(path);
     }
+    catch (std::exception&amp; e) 
+    {
+      ConsoleLog &lt;&lt; e.what() &lt;&lt; std::endl;
+    }
+  }
 }
 
 void

Modified: trunk/windstille/src/objects/scriptable_object.hpp
===================================================================
--- trunk/windstille/src/objects/scriptable_object.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/scriptable_object.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -25,12 +25,12 @@
 #include &quot;sprite2d/sprite.hpp&quot;
 
 /** Can represent any generic object that the player may see or interact with that
-does not require collision physics or specialized C++ code. For example doors, trains,
-signs, objects you can pick up, and animations.
+    does not require collision physics or specialized C++ code. For example doors, trains,
+    signs, objects you can pick up, and animations.
 
-TODO: should this provide optional collision detection such that you can use it to make
-crates etc? Or perhaps another object should derive from this which adds collision
-detection?
+    TODO: should this provide optional collision detection such that you can use it to make
+    crates etc? Or perhaps another object should derive from this which adds collision
+    detection?
 */
 class ScriptableObject : public Entity
 {

Modified: trunk/windstille/src/objects/shockwave.cpp
===================================================================
--- trunk/windstille/src/objects/shockwave.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/shockwave.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,11 +22,11 @@
 #include &quot;display/shader_object.hpp&quot;
 #include &quot;scenegraph/shockwave_drawable.hpp&quot;
 
-Shockwave::Shockwave(const FileReader&amp; props)
-  : pos(),
-    noise(Pathname(&quot;images/noise3.png&quot;)),
-    shader_program(),
-    radius()
+Shockwave::Shockwave(const FileReader&amp; props) :
+  pos(),
+  noise(Pathname(&quot;images/noise3.png&quot;)),
+  shader_program(),
+  radius()
 {
   props.get(&quot;pos&quot;, pos);
   
@@ -47,10 +47,10 @@
 Shockwave::draw (SceneContext&amp; sc)
 {
   sc.highlight().draw(new ShockwaveDrawable(pos,
-                                                   noise,
-                                                   shader_program,
-                                                   radius,
-                                                   sc.color().get_modelview()));
+                                            noise,
+                                            shader_program,
+                                            radius,
+                                            sc.color().get_modelview()));
 }
 
 void

Modified: trunk/windstille/src/objects/spider_mine.cpp
===================================================================
--- trunk/windstille/src/objects/spider_mine.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/spider_mine.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,15 +19,15 @@
 #include &quot;objects/spider_mine.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 
-SpiderMine::SpiderMine(const FileReader&amp; props)
-  : sprite(),
-    explode(Pathname(&quot;images/explosion.sprite&quot;)),
-    explode_light(Pathname(&quot;images/explolight.sprite&quot;)),
-    initial_position(),
-    walk_speed(160),
-    jump_time(0.0),
-    state(WAIT),
-    exploded(false)
+SpiderMine::SpiderMine(const FileReader&amp; props) :
+  sprite(),
+  explode(Pathname(&quot;images/explosion.sprite&quot;)),
+  explode_light(Pathname(&quot;images/explolight.sprite&quot;)),
+  initial_position(),
+  walk_speed(160),
+  jump_time(0.0),
+  state(WAIT),
+  exploded(false)
 {
   props.get(&quot;name&quot;, name);
   props.get(&quot;pos&quot;,  pos);
@@ -108,15 +108,15 @@
     velocity.y = 0;
     // if close enough to the player hit them
     if ((fabs(player_pos.x - pos.x) &lt; 15) &amp;&amp;
-      ((pos.y - 32 - 15 &lt; player_pos.y) &amp;&amp;
-      (pos.y &gt; player_pos.y - 135 + 15))) {
-        player-&gt;hit(1);
+        ((pos.y - 32 - 15 &lt; player_pos.y) &amp;&amp;
+         (pos.y &gt; player_pos.y - 135 + 15))) {
+      player-&gt;hit(1);
     }
   }
   // check to see if we should jump
   else if (state != JUMP &amp;&amp; (fabs(player_pos.x - pos.x) &lt;= 45)
-            &amp;&amp; ((pos.y - 32 &lt; player_pos.y) &amp;&amp; (pos.y &gt; player_pos.y - 135))
-            &amp;&amp; on_ground()) {
+           &amp;&amp; ((pos.y - 32 &lt; player_pos.y) &amp;&amp; (pos.y &gt; player_pos.y - 135))
+           &amp;&amp; on_ground()) {
     state = JUMP;
     velocity.y = -400;
     jump_time = 0.0;
@@ -135,8 +135,8 @@
   }
   // check to see if we should go back to starting position (ignores y)
   else if (state != JUMP &amp;&amp;
-       fabs(player_pos.x - pos.x) &gt;= 200
-       &amp;&amp; fabs(pos.x - initial_position.x) &gt; 15) {
+           fabs(player_pos.x - pos.x) &gt;= 200
+           &amp;&amp; fabs(pos.x - initial_position.x) &gt; 15) {
     state = RETURN;
     if (on_ground()) {
       if (initial_position.x &lt; pos.x)
@@ -144,7 +144,7 @@
       else
         velocity.x = walk_speed;
     }
-  // else wait
+    // else wait
   } else if (state != JUMP) {
     state = WAIT;
     velocity.x = 0;

Modified: trunk/windstille/src/objects/swarm.cpp
===================================================================
--- trunk/windstille/src/objects/swarm.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/swarm.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,10 +23,10 @@
 
 #include &quot;objects/swarm.hpp&quot;
 
-Swarm::Swarm(const FileReader&amp; props)
-  : agents(),
-    target(),
-    turn_speed()
+Swarm::Swarm(const FileReader&amp; props) :
+  agents(),
+  target(),
+  turn_speed()
 {
   int count = 100;
   turn_speed = 7.0f;
@@ -39,26 +39,26 @@
   agents.resize(count);
 
   for(Agents::iterator i = agents.begin(); i != agents.end(); ++i)
-    {
-      i-&gt;pos.x = pos.x + rnd.frand(-100, 100);
-      i-&gt;pos.y = pos.y + rnd.frand(-100, 100);
+  {
+    i-&gt;pos.x = pos.x + rnd.frand(-100, 100);
+    i-&gt;pos.y = pos.y + rnd.frand(-100, 100);
 
-      i-&gt;angle = rnd.frand(-math::pi, math::pi);
-      i-&gt;speed = rnd.frand(50.0f, 200.0f);
+    i-&gt;angle = rnd.frand(-math::pi, math::pi);
+    i-&gt;speed = rnd.frand(50.0f, 200.0f);
 
-      i-&gt;max_speed = rnd.frand(100.0f, 200.0f);
+    i-&gt;max_speed = rnd.frand(100.0f, 200.0f);
 
-      i-&gt;turn_speed = i-&gt;max_speed/30.0f;
+    i-&gt;turn_speed = i-&gt;max_speed/30.0f;
 
-      i-&gt;last_pos = i-&gt;pos;
-    }
+    i-&gt;last_pos = i-&gt;pos;
+  }
 }
 
 void
 Swarm::draw(SceneContext&amp; sc)
 {
   VertexArrayDrawable* array = new VertexArrayDrawable(Vector2f(0, 0), 
-                                                                   1000.0f, sc.highlight().get_modelview());
+                                                       1000.0f, sc.highlight().get_modelview());
 
   array-&gt;set_mode(GL_QUADS);
   array-&gt;set_blend_func(GL_ONE, GL_ZERO);
@@ -67,19 +67,19 @@
   Color bottom_color(0.0f, 0.0f, 0.0f);
 
   for(Agents::const_iterator i = agents.begin(); i != agents.end(); ++i)
-    {
-      array-&gt;color(color);
-      array-&gt;vertex(i-&gt;pos.x - 1, i-&gt;pos.y - 1);
+  {
+    array-&gt;color(color);
+    array-&gt;vertex(i-&gt;pos.x - 1, i-&gt;pos.y - 1);
 
-      array-&gt;color(color);
-      array-&gt;vertex(i-&gt;pos.x + 2, i-&gt;pos.y - 1);
+    array-&gt;color(color);
+    array-&gt;vertex(i-&gt;pos.x + 2, i-&gt;pos.y - 1);
 
-      array-&gt;color(bottom_color);
-      array-&gt;vertex(i-&gt;pos.x + 2, i-&gt;pos.y + 2);
+    array-&gt;color(bottom_color);
+    array-&gt;vertex(i-&gt;pos.x + 2, i-&gt;pos.y + 2);
 
-      array-&gt;color(bottom_color);
-      array-&gt;vertex(i-&gt;pos.x - 1, i-&gt;pos.y + 2);
-    }
+    array-&gt;color(bottom_color);
+    array-&gt;vertex(i-&gt;pos.x - 1, i-&gt;pos.y + 2);
+  }
 
   sc.highlight().draw(array);
 }
@@ -93,41 +93,41 @@
   target = GameSession::current()-&gt;get_view()-&gt;screen_to_world(Vector2f(static_cast&lt;float&gt;(x), static_cast&lt;float&gt;(y)));
 
   for(Agents::iterator i = agents.begin(); i != agents.end(); ++i)
-    {
-      i-&gt;last_pos = i-&gt;pos;
+  {
+    i-&gt;last_pos = i-&gt;pos;
 
-      float dx = target.x - i-&gt;pos.x;
-      float dy = target.y - i-&gt;pos.y;
+    float dx = target.x - i-&gt;pos.x;
+    float dy = target.y - i-&gt;pos.y;
 
-      float target_angle   = atan2f(dy, dx);
-      float relative_angle = math::normalize_angle(target_angle - i-&gt;angle);
+    float target_angle   = atan2f(dy, dx);
+    float relative_angle = math::normalize_angle(target_angle - i-&gt;angle);
       
-      if (sqrt(dx*dx + (dy*dy)*2.0f) &gt; 50.0f) // swarm range
-        {
-          if (fabs(relative_angle) &lt; 0.3f)
-            {
-              //i-&gt;angle += rnd.frand(-1.0f, 1.0f) * delta;
-              if (i-&gt;speed &lt; i-&gt;max_speed) 
-                i-&gt;speed += 100.0f * delta;
-            }
-          else
-            {
-              if (relative_angle &lt;= M_PI)
-                i-&gt;angle += i-&gt;turn_speed * delta;
-              else
-                i-&gt;angle -= i-&gt;turn_speed * delta;
-            }
-        }
+    if (sqrt(dx*dx + (dy*dy)*2.0f) &gt; 50.0f) // swarm range
+    {
+      if (fabs(relative_angle) &lt; 0.3f)
+      {
+        //i-&gt;angle += rnd.frand(-1.0f, 1.0f) * delta;
+        if (i-&gt;speed &lt; i-&gt;max_speed) 
+          i-&gt;speed += 100.0f * delta;
+      }
       else
-        {
-          i-&gt;angle += rnd.frand(-15.0f, 15.0f) * delta;
-          //i-&gt;speed += 150.0f - fabs(i-&gt;angle);
-          i-&gt;speed = rnd.frand(50.0f, 100.0f);
-        }
+      {
+        if (relative_angle &lt;= M_PI)
+          i-&gt;angle += i-&gt;turn_speed * delta;
+        else
+          i-&gt;angle -= i-&gt;turn_speed * delta;
+      }
+    }
+    else
+    {
+      i-&gt;angle += rnd.frand(-15.0f, 15.0f) * delta;
+      //i-&gt;speed += 150.0f - fabs(i-&gt;angle);
+      i-&gt;speed = rnd.frand(50.0f, 100.0f);
+    }
 
-      i-&gt;pos.x += i-&gt;speed * cosf(i-&gt;angle) * delta;
-      i-&gt;pos.y += i-&gt;speed * sinf(i-&gt;angle) * delta;
-    }
+    i-&gt;pos.x += i-&gt;speed * cosf(i-&gt;angle) * delta;
+    i-&gt;pos.y += i-&gt;speed * sinf(i-&gt;angle) * delta;
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/objects/test_object.cpp
===================================================================
--- trunk/windstille/src/objects/test_object.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/test_object.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -20,10 +20,10 @@
 
 #include &quot;objects/test_object.hpp&quot;
 
-TestObject::TestObject(const FileReader&amp; props)
-  : sprite(),
-    attached_sprites(),
-    pos()
+TestObject::TestObject(const FileReader&amp; props) :
+  sprite(),
+  attached_sprites(),
+  pos()
 {
   pos = Vector2f(0, 0);
   std::string spritename;

Modified: trunk/windstille/src/objects/test_object.hpp
===================================================================
--- trunk/windstille/src/objects/test_object.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/test_object.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -39,7 +39,7 @@
   void set_vflip(bool vflip);
   void set_pos(const Vector2f&amp; pos);
   void attach(const std::string&amp; spritename,
-		      const std::string&amp; attachement_point);
+              const std::string&amp; attachement_point);
 
 private:
   Sprite3D sprite;

Modified: trunk/windstille/src/objects/trigger.cpp
===================================================================
--- trunk/windstille/src/objects/trigger.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/trigger.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,12 +21,12 @@
 #include &quot;engine/sector.hpp&quot;
 #include &quot;objects/player.hpp&quot;
 
-Trigger::Trigger(const FileReader&amp; props)
-  : area(),
-    callback(),
-    triggered(false), 
-    last_trigger(),
-    one_time_trigger(false)
+Trigger::Trigger(const FileReader&amp; props) :
+  area(),
+  callback(),
+  triggered(false), 
+  last_trigger(),
+  one_time_trigger(false)
 {
   float x = -1;
   float y = -1;
@@ -64,26 +64,26 @@
   //FIXME use proper collision detection
   Player* player = Player::current();
   if(!area.is_inside(player-&gt;get_pos())) 
-    {
-      last_trigger = false;
-      return;
-    }
+  {
+    last_trigger = false;
+    return;
+  }
   
   if(triggered &amp;&amp; one_time_trigger)
     return;
 
   if(last_trigger == false) 
+  {
+    triggered = true;
+    try 
     {
-      triggered = true;
-      try 
-        {
-          Sector::current()-&gt;call_script_function(callback);
-        }
-      catch(std::exception&amp; e) 
-        {
-          std::cerr &lt;&lt; &quot;Couldn't run trigger-script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
-        }
+      Sector::current()-&gt;call_script_function(callback);
     }
+    catch(std::exception&amp; e) 
+    {
+      std::cerr &lt;&lt; &quot;Couldn't run trigger-script: &quot; &lt;&lt; e.what() &lt;&lt; &quot;\n&quot;;
+    }
+  }
   last_trigger = true;
 }
 

Modified: trunk/windstille/src/objects/vrdummy.cpp
===================================================================
--- trunk/windstille/src/objects/vrdummy.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/objects/vrdummy.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -19,11 +19,11 @@
 #include &quot;math/random.hpp&quot;
 #include &quot;objects/vrdummy.hpp&quot;
 
-VRDummy::VRDummy(const FileReader&amp; props)
-  : sprite(),
-    highlight(),
-    rotation(),
-    jump_time()
+VRDummy::VRDummy(const FileReader&amp; props) :
+  sprite(),
+  highlight(),
+  rotation(),
+  jump_time()
 {
   props.get(&quot;name&quot;, name);
   props.get(&quot;pos&quot;,  pos);
@@ -62,17 +62,17 @@
   jump_time += delta;
   
   if (jump_time &gt;= 1.0f &amp;&amp; velocity == Vector2f(0, 0)) 
-    {
-      velocity = Vector2f(rnd.frand(-300.0f, 300.0f),
-                          rnd.frand(-300.0f, 300.0f));
-    }
+  {
+    velocity = Vector2f(rnd.frand(-300.0f, 300.0f),
+                        rnd.frand(-300.0f, 300.0f));
+  }
 
   if (jump_time &gt;= 1.5f)
-    {
-      jump_time = 0.0f;
+  {
+    jump_time = 0.0f;
       
-      velocity = Vector2f(0, 0);
-    }
+    velocity = Vector2f(0, 0);
+  }
 
   pos += velocity * delta;
 }

Modified: trunk/windstille/src/particles/deform_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/deform_drawer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/particles/deform_drawer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -96,45 +96,45 @@
 
     glBegin(GL_QUADS);
     for(ParticleSystem::Particles::iterator i = psys.begin(); i != psys.end(); ++i)
+    {
+      if (i-&gt;t != -1.0f)
       {
-        if (i-&gt;t != -1.0f)
-          {
-            float p = 1.0f - psys.get_progress(i-&gt;t);
-            Color color(psys.get_color_start().r * p + psys.get_color_stop().r * (1.0f - p),
-                        psys.get_color_start().g * p + psys.get_color_stop().g * (1.0f - p),
-                        psys.get_color_start().b * p + psys.get_color_stop().b * (1.0f - p),
-                        psys.get_color_start().a * p + psys.get_color_stop().a * (1.0f - p));
+        float p = 1.0f - psys.get_progress(i-&gt;t);
+        Color color(psys.get_color_start().r * p + psys.get_color_stop().r * (1.0f - p),
+                    psys.get_color_start().g * p + psys.get_color_stop().g * (1.0f - p),
+                    psys.get_color_start().b * p + psys.get_color_stop().b * (1.0f - p),
+                    psys.get_color_start().a * p + psys.get_color_stop().a * (1.0f - p));
 
-            // scale
-            float scale  = psys.get_size_start() + 
-              psys.get_progress(i-&gt;t) * (psys.get_size_stop() - psys.get_size_start());
+        // scale
+        float scale  = psys.get_size_start() + 
+          psys.get_progress(i-&gt;t) * (psys.get_size_stop() - psys.get_size_start());
           
-            float width  = surface.get_width()  * scale;
-            float height = surface.get_height() * scale;
+        float width  = surface.get_width()  * scale;
+        float height = surface.get_height() * scale;
               
-            // rotate
-            float x_rot = width/2;
-            float y_rot = height/2; 
+        // rotate
+        float x_rot = width/2;
+        float y_rot = height/2; 
 
-            if (i-&gt;angle != 0)
-              {
-                float s = sinf(math::pi * i-&gt;angle/180.0f);
-                float c = cosf(math::pi * i-&gt;angle/180.0f);
-                x_rot = (width/2) * c - (height/2) * s;
-                y_rot = (width/2) * s + (height/2) * c;
-              }
+        if (i-&gt;angle != 0)
+        {
+          float s = sinf(math::pi * i-&gt;angle/180.0f);
+          float c = cosf(math::pi * i-&gt;angle/180.0f);
+          x_rot = (width/2) * c - (height/2) * s;
+          y_rot = (width/2) * s + (height/2) * c;
+        }
 
-            glColor4f(color.r, color.g, color.b, color.a);
-            glTexCoord2f(0, 0);
-            glVertex2f(i-&gt;x - x_rot, i-&gt;y - y_rot);
-            glTexCoord2f(1, 0);
-            glVertex2f(i-&gt;x + y_rot, i-&gt;y - x_rot);
-            glTexCoord2f(1, 1);
-            glVertex2f(i-&gt;x + x_rot, i-&gt;y + y_rot);
-            glTexCoord2f(0, 1);
-            glVertex2f(i-&gt;x - y_rot, i-&gt;y + x_rot);
-          }
+        glColor4f(color.r, color.g, color.b, color.a);
+        glTexCoord2f(0, 0);
+        glVertex2f(i-&gt;x - x_rot, i-&gt;y - y_rot);
+        glTexCoord2f(1, 0);
+        glVertex2f(i-&gt;x + y_rot, i-&gt;y - x_rot);
+        glTexCoord2f(1, 1);
+        glVertex2f(i-&gt;x + x_rot, i-&gt;y + y_rot);
+        glTexCoord2f(0, 1);
+        glVertex2f(i-&gt;x - y_rot, i-&gt;y + x_rot);
       }
+    }
     glEnd();
 
     glPopMatrix();

Modified: trunk/windstille/src/particles/particle_system.cpp
===================================================================
--- trunk/windstille/src/particles/particle_system.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/particles/particle_system.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -93,93 +93,93 @@
   {
     std::string layer_str;
     if (props.get(&quot;layer&quot;, layer_str))
-      {
-        if (layer_str == &quot;highlight&quot;)
-          layer = SceneContext::HIGHLIGHTMAP;
-        else if (layer_str == &quot;light&quot;)
-          layer = SceneContext::LIGHTMAP;
-        else if (layer_str == &quot;color&quot;)
-          layer = SceneContext::COLORMAP;
-        else
-          std::cout &lt;&lt; &quot;ParticleSystem: Unknown layer type: '&quot; &lt;&lt; layer_str &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-      }
+    {
+      if (layer_str == &quot;highlight&quot;)
+        layer = SceneContext::HIGHLIGHTMAP;
+      else if (layer_str == &quot;light&quot;)
+        layer = SceneContext::LIGHTMAP;
+      else if (layer_str == &quot;color&quot;)
+        layer = SceneContext::COLORMAP;
+      else
+        std::cout &lt;&lt; &quot;ParticleSystem: Unknown layer type: '&quot; &lt;&lt; layer_str &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
+    }
   }
 
   {
     FileReader drawer_reader;
     if (props.get(&quot;drawer&quot;, drawer_reader))
-      {
-        std::vector&lt;FileReader&gt; sections = drawer_reader.get_sections();
+    {
+      std::vector&lt;FileReader&gt; sections = drawer_reader.get_sections();
 
-        if (sections.size() &gt; 1)
-          std::cout &lt;&lt; &quot;ParticleSystem: Only one drawer allowed&quot; &lt;&lt; std::endl;
+      if (sections.size() &gt; 1)
+        std::cout &lt;&lt; &quot;ParticleSystem: Only one drawer allowed&quot; &lt;&lt; std::endl;
         
-        if (sections.size() == 0)
-          std::cout &lt;&lt; &quot;ParticleSystem: You must specify a drawer&quot; &lt;&lt; std::endl;
+      if (sections.size() == 0)
+        std::cout &lt;&lt; &quot;ParticleSystem: You must specify a drawer&quot; &lt;&lt; std::endl;
 
-        if (sections.size() &gt;= 1)
-          {
-            FileReader&amp; reader  = sections.front();
-            if (reader.get_name() == &quot;surface-drawer&quot;) 
-              {
-                set_drawer(new SurfaceDrawer(reader));
-              } 
-            else if (reader.get_name() == &quot;spark-drawer&quot;) 
-              {
-                set_drawer(new SparkDrawer(reader));
-              } 
-            else if (reader.get_name() == &quot;deform-drawer&quot;)
-              {
-                set_drawer(new DeformDrawer(reader));
-              }
-            else 
-              {
-                std::cout &lt;&lt; &quot;Unknown drawer: &quot; &lt;&lt; reader.get_name() &lt;&lt; std::endl;
-              }
-          }
+      if (sections.size() &gt;= 1)
+      {
+        FileReader&amp; reader  = sections.front();
+        if (reader.get_name() == &quot;surface-drawer&quot;) 
+        {
+          set_drawer(new SurfaceDrawer(reader));
+        } 
+        else if (reader.get_name() == &quot;spark-drawer&quot;) 
+        {
+          set_drawer(new SparkDrawer(reader));
+        } 
+        else if (reader.get_name() == &quot;deform-drawer&quot;)
+        {
+          set_drawer(new DeformDrawer(reader));
+        }
+        else 
+        {
+          std::cout &lt;&lt; &quot;Unknown drawer: &quot; &lt;&lt; reader.get_name() &lt;&lt; std::endl;
+        }
       }
+    }
   }
 
   {
     FileReader distribution_reader;
     if (props.get(&quot;distribution&quot;, distribution_reader))
-      {
-        std::vector&lt;FileReader&gt; sections = distribution_reader.get_sections();
+    {
+      std::vector&lt;FileReader&gt; sections = distribution_reader.get_sections();
 
-        if (sections.size() &gt; 1)
-          std::cout &lt;&lt; &quot;ParticleSystem: Only one distribution allowed&quot; &lt;&lt; std::endl;
+      if (sections.size() &gt; 1)
+        std::cout &lt;&lt; &quot;ParticleSystem: Only one distribution allowed&quot; &lt;&lt; std::endl;
         
-        if (sections.size() == 0)
-          std::cout &lt;&lt; &quot;ParticleSystem: You must specify a distribution&quot; &lt;&lt; std::endl;
+      if (sections.size() == 0)
+        std::cout &lt;&lt; &quot;ParticleSystem: You must specify a distribution&quot; &lt;&lt; std::endl;
 
-        if (sections.size() &gt;= 1)
-          {
-            FileReader&amp; reader  = sections.front();
+      if (sections.size() &gt;= 1)
+      {
+        FileReader&amp; reader  = sections.front();
 
-            if (reader.get_name() == &quot;point-distribution&quot;) {
-              set_point_distribution();
-            } else if (reader.get_name() == &quot;line-distribution&quot;) {
-              float x1, y1, x2, y2;
-              reader.get(&quot;x1&quot;, x1);
-              reader.get(&quot;y1&quot;, y1);
-              reader.get(&quot;x2&quot;, x2);
-              reader.get(&quot;y2&quot;, y2);
+        if (reader.get_name() == &quot;point-distribution&quot;) {
+          set_point_distribution();
+        } else if (reader.get_name() == &quot;line-distribution&quot;) {
+          float x1, y1, x2, y2;
+          reader.get(&quot;x1&quot;, x1);
+          reader.get(&quot;y1&quot;, y1);
+          reader.get(&quot;x2&quot;, x2);
+          reader.get(&quot;y2&quot;, y2);
           
-              set_line_distribution(x1, y1, x2, y2);
-            } else if (reader.get_name() == &quot;rect-distribution&quot;) {
-              Rectf rect;
-              reader.get(&quot;x1&quot;, rect.left);
-              reader.get(&quot;y1&quot;, rect.top);
-              reader.get(&quot;x2&quot;, rect.right);
-              reader.get(&quot;y2&quot;, rect.bottom);
+          set_line_distribution(x1, y1, x2, y2);
+        } else if (reader.get_name() == &quot;rect-distribution&quot;) {
+          Rectf rect;
+          reader.get(&quot;x1&quot;, rect.left);
+          reader.get(&quot;y1&quot;, rect.top);
+          reader.get(&quot;x2&quot;, rect.right);
+          reader.get(&quot;y2&quot;, rect.bottom);
           
-              set_rect_distribution(rect);
+          set_rect_distribution(rect);
 
-            } else {
-              std::cout &lt;&lt; &quot;Unknown distribution: &quot; &lt;&lt; reader.get_name() &lt;&lt; std::endl;
-            }
-          }
+        } else {
+          std::cout &lt;&lt; &quot;Unknown distribution: &quot; &lt;&lt; reader.get_name() &lt;&lt; std::endl;
+        }
       }
+    }
   }
   
   int p_count = 70;
@@ -232,13 +232,13 @@
 ParticleSystem::draw() const
 {
   if (drawer.get())
-    {
-      drawer-&gt;draw(*this);
-    }
+  {
+    drawer-&gt;draw(*this);
+  }
   else
-    {
-      std::cout &lt;&lt; &quot;ParticleSystem: No drawer set&quot; &lt;&lt; std::endl;
-    } 
+  {
+    std::cout &lt;&lt; &quot;ParticleSystem: No drawer set&quot; &lt;&lt; std::endl;
+  } 
 }
 
 void
@@ -266,22 +266,22 @@
 ParticleSystem::update(float delta)
 {
   for(Particles::iterator i = particles.begin(); i != particles.end(); ++i)
+  {
+    if (i-&gt;t &gt; life_time)
     {
-      if (i-&gt;t &gt; life_time)
-        {
-          spawn(*i);
-        }
-      else
-        {
-          i-&gt;t += delta;
+      spawn(*i);
+    }
+    else
+    {
+      i-&gt;t += delta;
           
-          i-&gt;x += i-&gt;v_x * delta;
-          i-&gt;y += i-&gt;v_y * delta;
+      i-&gt;x += i-&gt;v_x * delta;
+      i-&gt;y += i-&gt;v_y * delta;
 
-          i-&gt;v_x += gravity_x;
-          i-&gt;v_y += gravity_y;
-        }
+      i-&gt;v_x += gravity_x;
+      i-&gt;v_y += gravity_y;
     }
+  }
 }
 
 int
@@ -295,15 +295,15 @@
 {
   int old_size = particles.size();
   if (old_size != num)
+  {
+    particles.resize(num);
+
+    for(Particles::size_type i = old_size; i &lt; particles.size(); ++i)
     {
-      particles.resize(num);
-
-      for(Particles::size_type i = old_size; i &lt; particles.size(); ++i)
-        {
-          spawn(particles[i]);
-          particles[i].t = life_time * bunching * static_cast&lt;float&gt;(i) / static_cast&lt;float&gt;(particles.size());
-        }
+      spawn(particles[i]);
+      particles[i].t = life_time * bunching * static_cast&lt;float&gt;(i) / static_cast&lt;float&gt;(particles.size());
     }
+  }
 }
   
 void

Modified: trunk/windstille/src/particles/spark_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/spark_drawer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/particles/spark_drawer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -40,47 +40,47 @@
   buffer-&gt;set_pos(Vector2f(psys.get_x_pos(), psys.get_y_pos()));
 
   if (width == 1.0f)
+  {
+    buffer-&gt;set_mode(GL_LINES);
+    buffer-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);
+    for(ParticleSystem::const_iterator i = psys.begin(); i != psys.end(); ++i)
     {
-      buffer-&gt;set_mode(GL_LINES);
-      buffer-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);
-      for(ParticleSystem::const_iterator i = psys.begin(); i != psys.end(); ++i)
-        {
-          buffer-&gt;color(Color(color.r, color.g, color.b, color.a - (color.a * psys.get_progress(i-&gt;t))));
-          buffer-&gt;vertex(i-&gt;x + i-&gt;v_x/10.0f, i-&gt;y + i-&gt;v_y/10.0f); 
+      buffer-&gt;color(Color(color.r, color.g, color.b, color.a - (color.a * psys.get_progress(i-&gt;t))));
+      buffer-&gt;vertex(i-&gt;x + i-&gt;v_x/10.0f, i-&gt;y + i-&gt;v_y/10.0f); 
 
-          buffer-&gt;color(Color(0, 0, 0, 0));
-          buffer-&gt;vertex(i-&gt;x, i-&gt;y);
-        }
+      buffer-&gt;color(Color(0, 0, 0, 0));
+      buffer-&gt;vertex(i-&gt;x, i-&gt;y);
     }
+  }
   else
+  {
+    buffer-&gt;set_mode(GL_QUADS);
+    buffer-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);
+    for(ParticleSystem::const_iterator i = psys.begin(); i != psys.end(); ++i)
     {
-      buffer-&gt;set_mode(GL_QUADS);
-      buffer-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE);
-      for(ParticleSystem::const_iterator i = psys.begin(); i != psys.end(); ++i)
-        {
-          const float len = sqrtf(i-&gt;v_x * i-&gt;v_x  +  i-&gt;v_y * i-&gt;v_y);
+      const float len = sqrtf(i-&gt;v_x * i-&gt;v_x  +  i-&gt;v_y * i-&gt;v_y);
 
-          const float o_x = i-&gt;v_y/len * width;
-          const float o_y = i-&gt;v_x/len * width;
+      const float o_x = i-&gt;v_y/len * width;
+      const float o_y = i-&gt;v_x/len * width;
 
-          const float x1 = i-&gt;x;
-          const float y1 = i-&gt;y;
-          const float x2 = i-&gt;x + i-&gt;v_x/10.0f;
-          const float y2 = i-&gt;y + i-&gt;v_y/10.0f;
+      const float x1 = i-&gt;x;
+      const float y1 = i-&gt;y;
+      const float x2 = i-&gt;x + i-&gt;v_x/10.0f;
+      const float y2 = i-&gt;y + i-&gt;v_y/10.0f;
 
-          buffer-&gt;color(Color(0, 0, 0, 0));
-          buffer-&gt;vertex(x1 + o_x, y1 - o_y);
+      buffer-&gt;color(Color(0, 0, 0, 0));
+      buffer-&gt;vertex(x1 + o_x, y1 - o_y);
 
-          buffer-&gt;color(Color(0, 0, 0, 0));
-          buffer-&gt;vertex(x1 - o_x, y1 + o_y);
+      buffer-&gt;color(Color(0, 0, 0, 0));
+      buffer-&gt;vertex(x1 - o_x, y1 + o_y);
 
-          buffer-&gt;color(Color(color.r, color.g, color.b, color.a - (color.a * psys.get_progress(i-&gt;t))));
-          buffer-&gt;vertex(x2 - o_x, y2 + o_y); 
+      buffer-&gt;color(Color(color.r, color.g, color.b, color.a - (color.a * psys.get_progress(i-&gt;t))));
+      buffer-&gt;vertex(x2 - o_x, y2 + o_y); 
 
-          buffer-&gt;color(Color(color.r, color.g, color.b, color.a - (color.a * psys.get_progress(i-&gt;t))));
-          buffer-&gt;vertex(x2 + o_x, y2 - o_y); 
-        }
+      buffer-&gt;color(Color(color.r, color.g, color.b, color.a - (color.a * psys.get_progress(i-&gt;t))));
+      buffer-&gt;vertex(x2 + o_x, y2 - o_y); 
     }
+  }
 
   buffer-&gt;render(~0u);
 }

Modified: trunk/windstille/src/particles/surface_drawer.cpp
===================================================================
--- trunk/windstille/src/particles/surface_drawer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/particles/surface_drawer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -116,49 +116,49 @@
   buffer-&gt;set_blend_func(blendfunc_src, blendfunc_dest);
 
   for(ParticleSystem::const_iterator i = psys.begin(); i != psys.end(); ++i)
+  {
+    if (i-&gt;t != -1.0f)
     {
-      if (i-&gt;t != -1.0f)
-        {
-          float p = 1.0f - psys.get_progress(i-&gt;t);
-          Color color(psys.get_color_start().r * p + psys.get_color_stop().r * (1.0f - p),
-                      psys.get_color_start().g * p + psys.get_color_stop().g * (1.0f - p),
-                      psys.get_color_start().b * p + psys.get_color_stop().b * (1.0f - p),
-                      psys.get_color_start().a * p + psys.get_color_stop().a * (1.0f - p));
+      float p = 1.0f - psys.get_progress(i-&gt;t);
+      Color color(psys.get_color_start().r * p + psys.get_color_stop().r * (1.0f - p),
+                  psys.get_color_start().g * p + psys.get_color_stop().g * (1.0f - p),
+                  psys.get_color_start().b * p + psys.get_color_stop().b * (1.0f - p),
+                  psys.get_color_start().a * p + psys.get_color_stop().a * (1.0f - p));
 
-          // scale
-          float scale  = psys.get_size_start() + 
-            psys.get_progress(i-&gt;t) * (psys.get_size_stop() - psys.get_size_start());
+      // scale
+      float scale  = psys.get_size_start() + 
+        psys.get_progress(i-&gt;t) * (psys.get_size_stop() - psys.get_size_start());
           
-          float width  = surface.get_width()  * scale;
-          float height = surface.get_height() * scale;
+      float width  = surface.get_width()  * scale;
+      float height = surface.get_height() * scale;
               
-          // rotate
-          float x_rot = width/2;
-          float y_rot = height/2; 
+      // rotate
+      float x_rot = width/2;
+      float y_rot = height/2; 
 
-          if (i-&gt;angle != 0)
-            {
-              float s = sinf(math::pi * i-&gt;angle/180.0f);
-              float c = cosf(math::pi * i-&gt;angle/180.0f);
-              x_rot = (width/2) * c - (height/2) * s;
-              y_rot = (width/2) * s + (height/2) * c;
-            }
+      if (i-&gt;angle != 0)
+      {
+        float s = sinf(math::pi * i-&gt;angle/180.0f);
+        float c = cosf(math::pi * i-&gt;angle/180.0f);
+        x_rot = (width/2) * c - (height/2) * s;
+        y_rot = (width/2) * s + (height/2) * c;
+      }
 
-          buffer-&gt;add_texcoords(surface.get_uv());
+      buffer-&gt;add_texcoords(surface.get_uv());
 
-          buffer-&gt;color(color);
-          buffer-&gt;vertex(i-&gt;x - x_rot, i-&gt;y - y_rot);
+      buffer-&gt;color(color);
+      buffer-&gt;vertex(i-&gt;x - x_rot, i-&gt;y - y_rot);
 
-          buffer-&gt;color(color);
-          buffer-&gt;vertex(i-&gt;x + y_rot, i-&gt;y - x_rot);
+      buffer-&gt;color(color);
+      buffer-&gt;vertex(i-&gt;x + y_rot, i-&gt;y - x_rot);
 
-          buffer-&gt;color(color);
-          buffer-&gt;vertex(i-&gt;x + x_rot, i-&gt;y + y_rot);
+      buffer-&gt;color(color);
+      buffer-&gt;vertex(i-&gt;x + x_rot, i-&gt;y + y_rot);
 
-          buffer-&gt;color(color);
-          buffer-&gt;vertex(i-&gt;x - y_rot, i-&gt;y + x_rot);
-        }
+      buffer-&gt;color(color);
+      buffer-&gt;vertex(i-&gt;x - y_rot, i-&gt;y + x_rot);
     }
+  }
 
   buffer-&gt;render(~0u);
 }

Modified: trunk/windstille/src/properties/properties.cpp
===================================================================
--- trunk/windstille/src/properties/properties.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/properties/properties.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,9 +22,9 @@
 #include &quot;properties/property_set.hpp&quot;
 #include &quot;properties/properties.hpp&quot;
 
-Properties::Properties(PropertySet* pset_, void* object_)
-  : pset(pset_),
-    object(object_)
+Properties::Properties(PropertySet* pset_, void* object_) :
+  pset(pset_),
+  object(object_)
 {
 }
 
@@ -33,15 +33,15 @@
 {
   Property* prop = pset-&gt;get(name);
   if (!prop)
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;Properties: &quot; &lt;&lt; pset-&gt;get_name() &lt;&lt; &quot;: property &quot; &lt;&lt; name &lt;&lt; &quot; not found&quot;;
-      throw std::runtime_error(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;Properties: &quot; &lt;&lt; pset-&gt;get_name() &lt;&lt; &quot;: property &quot; &lt;&lt; name &lt;&lt; &quot; not found&quot;;
+    throw std::runtime_error(str.str());
+  }
   else
-    {
-      return *prop;
-    }
+  {
+    return *prop;
+  }
 }
 
 int

Modified: trunk/windstille/src/properties/property_set.cpp
===================================================================
--- trunk/windstille/src/properties/property_set.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/properties/property_set.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,19 +21,19 @@
 
 #include &quot;properties/property_set.hpp&quot;
 
-PropertySet::PropertySet(const std::string&amp; name_, PropertySet* parent_)
-  : parent(parent_),
-    name(name_),
-    properties()
+PropertySet::PropertySet(const std::string&amp; name_, PropertySet* parent_) :
+  parent(parent_),
+  name(name_),
+  properties()
 {  
 }
 
 PropertySet::~PropertySet()
 {
   for(std::map&lt;std::string, Property*&gt;::iterator i = properties.begin(); i != properties.end(); ++i)
-    {
-      delete i-&gt;second;
-    }
+  {
+    delete i-&gt;second;
+  }
 }
   
 void
@@ -41,15 +41,15 @@
 {
   Property*&amp; i = properties[name_];
   if (i)
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;PropertySet::add: Name conflict: '&quot; &lt;&lt; name_ &lt;&lt; &quot;' already used&quot;;
-      throw std::runtime_error(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;PropertySet::add: Name conflict: '&quot; &lt;&lt; name_ &lt;&lt; &quot;' already used&quot;;
+    throw std::runtime_error(str.str());
+  }
   else
-    {
-      i = property;
-    }
+  {
+    i = property;
+  }
 }
 
 Property*
@@ -57,16 +57,16 @@
 {
   std::map&lt;std::string, Property*&gt;::const_iterator i = properties.find(name_);
   if (i == properties.end())
-    {
-      if (parent)
-        return parent-&gt;get(name_);
-      else
-        return 0;
-    }
+  {
+    if (parent)
+      return parent-&gt;get(name_);
+    else
+      return 0;
+  }
   else
-    {
-      return i-&gt;second;
-    }
+  {
+    return i-&gt;second;
+  }
 }
 
 void
@@ -76,9 +76,9 @@
     parent-&gt;get_properties(lst);
   
   for(std::map&lt;std::string, Property*&gt;::const_iterator i = properties.begin(); i != properties.end(); ++i)
-    {
-      lst.push_back(i-&gt;first);
-    }
+  {
+    lst.push_back(i-&gt;first);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/scenegraph/control_drawable.hpp
===================================================================
--- trunk/windstille/src/scenegraph/control_drawable.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/scenegraph/control_drawable.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -27,7 +27,7 @@
 
 public:
   ControlDrawable(Surface surface_, const Vector2f&amp; pos_, float angle_, float z_pos_,
-                        const Matrix&amp; modelview_)
+                  const Matrix&amp; modelview_)
     : Drawable(pos_, z_pos_, modelview_), 
       surface(surface_), 
       angle(angle_)

Modified: trunk/windstille/src/scenegraph/shockwave_drawable.hpp
===================================================================
--- trunk/windstille/src/scenegraph/shockwave_drawable.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/scenegraph/shockwave_drawable.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -29,10 +29,10 @@
   float radius;
 
   ShockwaveDrawable(const Vector2f&amp; pos_, 
-                          const Texture&amp;       noise_,
-                          const ShaderProgram&amp; shader_program_,
-                          float r,
-                          const Matrix&amp; modelview_) 
+                    const Texture&amp;       noise_,
+                    const ShaderProgram&amp; shader_program_,
+                    float r,
+                    const Matrix&amp; modelview_) 
     : Drawable(pos_, 500.0f, modelview_),
       noise(noise_),
       shader_program(shader_program_),
@@ -85,32 +85,32 @@
   
     glBegin(GL_QUADS);
     for (int i = 0; i &lt; segments; ++i)
-      {
-        float angel = 2.0f * math::pi / static_cast&lt;float&gt;(segments);
+    {
+      float angel = 2.0f * math::pi / static_cast&lt;float&gt;(segments);
 
-        float x1 =  sinf(angel*static_cast&lt;float&gt;(i))*rad;
-        float y1 = -cosf(angel*static_cast&lt;float&gt;(i))*rad;
+      float x1 =  sinf(angel*static_cast&lt;float&gt;(i))*rad;
+      float y1 = -cosf(angel*static_cast&lt;float&gt;(i))*rad;
 
-        float x2 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
-        float y2 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
+      float x2 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
+      float y2 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
 
-        glTexCoord2f(x1+256, (y1+256));
-        glVertex3f(x1+256, y1+256, 0);
+      glTexCoord2f(x1+256, (y1+256));
+      glVertex3f(x1+256, y1+256, 0);
 
-        glTexCoord2f(x2+256, (y2+256));
-        glVertex3f(x2+256, y2+256, 0);
+      glTexCoord2f(x2+256, (y2+256));
+      glVertex3f(x2+256, y2+256, 0);
 
-        float x3 =  sinf(angel*static_cast&lt;float&gt;(i))*minradius;
-        float y3 = -cosf(angel*static_cast&lt;float&gt;(i))*minradius;
+      float x3 =  sinf(angel*static_cast&lt;float&gt;(i))*minradius;
+      float y3 = -cosf(angel*static_cast&lt;float&gt;(i))*minradius;
 
-        float x4 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
-        float y4 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
+      float x4 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
+      float y4 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
 
-        glTexCoord2f(x4+256, (y4+256));
-        glVertex3f(x4+256, y4+256, 0);
-        glTexCoord2f(x3+256, (y3+256));
-        glVertex3f(x3+256, y3+256, 0);
-      }
+      glTexCoord2f(x4+256, (y4+256));
+      glVertex3f(x4+256, y4+256, 0);
+      glTexCoord2f(x3+256, (y3+256));
+      glVertex3f(x3+256, y3+256, 0);
+    }
     glEnd();
 
     glMatrixMode(GL_TEXTURE);
@@ -128,45 +128,45 @@
     glMultMatrixf(modelview.matrix);
     glTranslatef(pos.x, pos.y, 0);
     if (0)
-      {
-        Rectf rect(0, 0, 800, 600);
-        // Render the screen framebuffer to the actual screen 
-        OpenGLState state;
-        state.bind_texture(tmp_texture, 0);
-        state.activate();
+    {
+      Rectf rect(0, 0, 800, 600);
+      // Render the screen framebuffer to the actual screen 
+      OpenGLState state;
+      state.bind_texture(tmp_texture, 0);
+      state.activate();
 
-        glBegin(GL_QUADS);
+      glBegin(GL_QUADS);
     
-        glTexCoord2f(rect.left, rect.bottom);
-        glVertex2f(rect.left/2.0f, rect.bottom/2.0f);
+      glTexCoord2f(rect.left, rect.bottom);
+      glVertex2f(rect.left/2.0f, rect.bottom/2.0f);
 
-        glTexCoord2f(rect.right, rect.bottom);
-        glVertex2f(rect.right/2.0f, rect.bottom/2.0f);
+      glTexCoord2f(rect.right, rect.bottom);
+      glVertex2f(rect.right/2.0f, rect.bottom/2.0f);
 
-        glTexCoord2f(rect.right, rect.top);
-        glVertex2f(rect.right/2.0f, rect.top/2.0f);
+      glTexCoord2f(rect.right, rect.top);
+      glVertex2f(rect.right/2.0f, rect.top/2.0f);
 
-        glTexCoord2f(rect.left, rect.top);
-        glVertex2f(rect.left/2.0f, rect.top/2.0f);
+      glTexCoord2f(rect.left, rect.top);
+      glVertex2f(rect.left/2.0f, rect.top/2.0f);
     
-        glEnd();
-      }
+      glEnd();
+    }
     else
-      {
-        OpenGLState state;
-        state.bind_texture(tmp_texture, 0);
-        state.bind_texture(noise, 1);
-        state.enable(GL_BLEND);
-        state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-        state.activate();
+    {
+      OpenGLState state;
+      state.bind_texture(tmp_texture, 0);
+      state.bind_texture(noise, 1);
+      state.enable(GL_BLEND);
+      state.set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+      state.activate();
 
-        glUseProgram(shader_program.get_handle());    
-        shader_program.set_uniform1f(&quot;radius&quot;,   radius/512.0f*2.0f);
-        shader_program.set_uniform1i(&quot;background_tex&quot;, 0);
-        shader_program.set_uniform1i(&quot;noise_tex&quot;,   1);
-        draw_disc(int(radius));
-        glUseProgram(0);
-      }
+      glUseProgram(shader_program.get_handle());    
+      shader_program.set_uniform1f(&quot;radius&quot;,   radius/512.0f*2.0f);
+      shader_program.set_uniform1i(&quot;background_tex&quot;, 0);
+      shader_program.set_uniform1i(&quot;noise_tex&quot;,   1);
+      draw_disc(int(radius));
+      glUseProgram(0);
+    }
     glPopMatrix();
 #endif
   }
@@ -182,34 +182,34 @@
   
     glBegin(GL_QUADS);
     for (int i = 0; i &lt; segments; ++i)
-      {
-        float angel = 2.0f * math::pi / static_cast&lt;float&gt;(segments);
+    {
+      float angel = 2.0f * math::pi / static_cast&lt;float&gt;(segments);
 
-        float x1 =  sinf(angel*static_cast&lt;float&gt;(i))*rad;
-        float y1 = -cosf(angel*static_cast&lt;float&gt;(i))*rad;
+      float x1 =  sinf(angel*static_cast&lt;float&gt;(i))*rad;
+      float y1 = -cosf(angel*static_cast&lt;float&gt;(i))*rad;
 
-        float x2 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
-        float y2 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
+      float x2 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
+      float y2 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*rad;
 
-        glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
-        glTexCoord2f(x1/512.0f+0.5f, y1/512.0f+0.5f);
-        glVertex3f(x1+256, y1+256, 0);
+      glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
+      glTexCoord2f(x1/512.0f+0.5f, y1/512.0f+0.5f);
+      glVertex3f(x1+256, y1+256, 0);
 
-        glTexCoord2f(x2/512.0f+0.5f, y2/512.0f+0.5f);
-        glVertex3f(x2+256, y2+256, 0);
+      glTexCoord2f(x2/512.0f+0.5f, y2/512.0f+0.5f);
+      glVertex3f(x2+256, y2+256, 0);
 
-        float x3 =  sinf(angel*static_cast&lt;float&gt;(i))*minradius;
-        float y3 = -cosf(angel*static_cast&lt;float&gt;(i))*minradius;
+      float x3 =  sinf(angel*static_cast&lt;float&gt;(i))*minradius;
+      float y3 = -cosf(angel*static_cast&lt;float&gt;(i))*minradius;
 
-        float x4 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
-        float y4 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
+      float x4 =  sinf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
+      float y4 = -cosf(angel*(static_cast&lt;float&gt;(i)+1))*minradius;
 
-        glColor4f(1.0f, 1.0f, 1.0f, 0.0f);
-        glTexCoord2f(x4/512.0f+0.5f, y4/512.0f+0.5f);
-        glVertex3f(x4+256, y4+256, 0);
-        glTexCoord2f(x3/512.0f+0.5f, y3/512.0f+0.5f);
-        glVertex3f(x3+256, y3+256, 0);
-      }
+      glColor4f(1.0f, 1.0f, 1.0f, 0.0f);
+      glTexCoord2f(x4/512.0f+0.5f, y4/512.0f+0.5f);
+      glVertex3f(x4+256, y4+256, 0);
+      glTexCoord2f(x3/512.0f+0.5f, y3/512.0f+0.5f);
+      glVertex3f(x3+256, y3+256, 0);
+    }
     glEnd();
   }
 };

Modified: trunk/windstille/src/screen/armature_test.cpp
===================================================================
--- trunk/windstille/src/screen/armature_test.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/armature_test.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -107,38 +107,38 @@
 
   if (controller.button_was_pressed(ESCAPE_BUTTON) ||
       controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      ScreenManager::current()-&gt;pop_screen();
-    }
+  {
+    ScreenManager::current()-&gt;pop_screen();
+  }
 
   if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      xrot = 90;
-      yrot = 0;
-      zrot = 0;
-    }
+  {
+    xrot = 90;
+    yrot = 0;
+    zrot = 0;
+  }
   else if (controller.button_was_pressed(SECONDARY_BUTTON))
-      {
-      xrot = 0;
-      yrot = 90;
-      zrot = 0;
-      }
+  {
+    xrot = 0;
+    yrot = 90;
+    zrot = 0;
+  }
   else if (controller.button_was_pressed(TERTIARY_BUTTON))
-    {
-      xrot = 0;
-      yrot = 0;
-      zrot = 90;
-    }
+  {
+    xrot = 0;
+    yrot = 0;
+    zrot = 90;
+  }
   else
-    { 
-      yrot += controller.get_axis_state(X_AXIS) * 90 * delta;
-      xrot += controller.get_axis_state(Y_AXIS) * 90 * delta;
-      zrot += controller.get_axis_state(X2_AXIS) * 90 * delta;
-    }
+  { 
+    yrot += controller.get_axis_state(X_AXIS) * 90 * delta;
+    xrot += controller.get_axis_state(Y_AXIS) * 90 * delta;
+    zrot += controller.get_axis_state(X2_AXIS) * 90 * delta;
+  }
 
   if (controller.button_was_pressed(AIM_BUTTON))
-    {
-    }
+  {
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/screen/game_session.cpp
===================================================================
--- trunk/windstille/src/screen/game_session.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/game_session.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -148,33 +148,33 @@
   compositor.render(sc, &amp;sector-&gt;get_scene_graph(), view.get_gc_state());
 
   if (cutscene_mode || cutscene_value &gt; 0.0f)
-    {
-      int border_size = static_cast&lt;int&gt;(75 * cutscene_value);
-      Display::fill_rect(Rect(Point(0, 0), Size(Display::get_width(), border_size)), 
-                         Color(0.0f, 0.0f, 0.0f, cutscene_value));
-      Display::fill_rect(Rect(Point(0, Display::get_height() - border_size), Size(Display::get_width(), border_size)), 
-                         Color(0.0f, 0.0f, 0.0f, cutscene_value));
-    }
+  {
+    int border_size = static_cast&lt;int&gt;(75 * cutscene_value);
+    Display::fill_rect(Rect(Point(0, 0), Size(Display::get_width(), border_size)), 
+                       Color(0.0f, 0.0f, 0.0f, cutscene_value));
+    Display::fill_rect(Rect(Point(0, Display::get_height() - border_size), Size(Display::get_width(), border_size)), 
+                       Color(0.0f, 0.0f, 0.0f, cutscene_value));
+  }
 
   if (current_gui)
     current_gui-&gt;draw();
 
   if (fade_state == FADEOUT || fade_state == FADEIN)
-    {
-      Display::fill_rect(Rect(0, 0, 
-                              Display::get_width(), Display::get_height()),
-                         Color(fade_color.r, fade_color.g, fade_color.b, fadeout_value));
-    }
+  {
+    Display::fill_rect(Rect(0, 0, 
+                            Display::get_width(), Display::get_height()),
+                       Color(fade_color.r, fade_color.g, fade_color.b, fadeout_value));
+  }
 
   speech_manager.draw();
 
   if (pause)
-    {
-      if ((SDL_GetTicks() / 1000) % 2)
-        Fonts::current()-&gt;vera20-&gt;draw(Vector2f(static_cast&lt;float&gt;(Display::get_width())  / 2.0f,
-                                                static_cast&lt;float&gt;(Display::get_height()) / 2.0f), 
-                                       &quot;Pause&quot;);
-    }
+  {
+    if ((SDL_GetTicks() / 1000) % 2)
+      Fonts::current()-&gt;vera20-&gt;draw(Vector2f(static_cast&lt;float&gt;(Display::get_width())  / 2.0f,
+                                              static_cast&lt;float&gt;(Display::get_height()) / 2.0f), 
+                                     &quot;Pause&quot;);
+  }
 }
 
 void
@@ -220,49 +220,49 @@
   speech_manager.update(delta);
   
   switch (fade_state)
-    {
-      case FADEIN:
-        if (fadeout_value &lt;= 0.0f)
-          {
-            fade_state = RUNNING;
-            fadeout_value = 0.0f;
-            ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
-          }
-        else
-          {
-            fadeout_value -= delta * fade_time;
-          }
-        break;
+  {
+    case FADEIN:
+      if (fadeout_value &lt;= 0.0f)
+      {
+        fade_state = RUNNING;
+        fadeout_value = 0.0f;
+        ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
+      }
+      else
+      {
+        fadeout_value -= delta * fade_time;
+      }
+      break;
 
-      case FADEOUT:
-        if (fadeout_value &gt;= 1.0f)
-          { 
-            fadeout_value = 1.0f;
-            ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
+    case FADEOUT:
+      if (fadeout_value &gt;= 1.0f)
+      { 
+        fadeout_value = 1.0f;
+        ScriptManager::current()-&gt;fire_wakeup_event(ScriptManager::FADE_DONE);
 
-            switch(next_action)
-              {
-                case CHANGE_SECTOR_ACTION:
-                  GameSession::current()-&gt;set_sector(filename);
-                  break;
+        switch(next_action)
+        {
+          case CHANGE_SECTOR_ACTION:
+            GameSession::current()-&gt;set_sector(filename);
+            break;
 
-                case QUIT_ACTION:
-                  ScreenManager::current()-&gt;quit();
-                  break;
+          case QUIT_ACTION:
+            ScreenManager::current()-&gt;quit();
+            break;
 
-                default:
-                  break;
-              }
-          }
-        else
-          {
-            fadeout_value += delta * fade_time;
-          }
-        break;
+          default:
+            break;
+        }
+      }
+      else
+      {
+        fadeout_value += delta * fade_time;
+      }
+      break;
 
-      case RUNNING:
-        break;
-    }
+    case RUNNING:
+      break;
+  }
 }
 
 void
@@ -270,43 +270,43 @@
 { 
   // Handle key presses
   if (controller.button_was_pressed(PDA_BUTTON))
-    {
-      if (current_gui == &amp;pda)
-        current_gui = 0;
-      else
-        current_gui = &pda;
-    }
+  {
+    if (current_gui == &amp;pda)
+      current_gui = 0;
+    else
+      current_gui = &pda;
+  }
   else if (controller.button_was_pressed(INVENTORY_BUTTON))
-    {
-      if (current_gui == &amp;inventory)
-        current_gui = 0;
-      else
-        current_gui = &inventory;
-    }
+  {
+    if (current_gui == &amp;inventory)
+      current_gui = 0;
+    else
+      current_gui = &inventory;
+  }
   else if (controller.button_was_pressed(ESCAPE_BUTTON) ||
            controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      MenuManager::display_pause_menu();
-    }
+  {
+    MenuManager::display_pause_menu();
+  }
   else
+  {
+    if (!current_gui)
     {
-      if (!current_gui)
-      {
-        if (Player::current())
-          Player::current()-&gt;update(controller, delta);
-        else if (Doll::current())
-          Doll::current()-&gt;update(controller, delta);
-      }
+      if (Player::current())
+        Player::current()-&gt;update(controller, delta);
+      else if (Doll::current())
+        Doll::current()-&gt;update(controller, delta);
     }
+  }
 
   if (current_gui)
-    {
-      current_gui-&gt;update(delta, controller);
-    }
+  {
+    current_gui-&gt;update(delta, controller);
+  }
   else
-    {
-      // FIXME: route controller to player
-    }
+  {
+    // FIXME: route controller to player
+  }
 }
 
 void
@@ -318,9 +318,9 @@
 
   // Update the game
   if (!pause)
-    {
-      update_game(delta);
-    }
+  {
+    update_game(delta);
+  }
   
   update_controller(delta, controller);
 }
@@ -333,15 +333,15 @@
   SoundManager::current()-&gt;stop_music();
 
   if (impl-&gt;fade_state == GameSessionImpl::FADEOUT)
-    {
-      GameSession::current()-&gt;set_sector(impl-&gt;filename);
-    }
+  {
+    GameSession::current()-&gt;set_sector(impl-&gt;filename);
+  }
   else
-    {
-      impl-&gt;fade_time     = 1.0f;
-      impl-&gt;fade_state    = GameSessionImpl::FADEOUT;
-      impl-&gt;next_action   = GameSessionImpl::CHANGE_SECTOR_ACTION;
-    }
+  {
+    impl-&gt;fade_time     = 1.0f;
+    impl-&gt;fade_state    = GameSessionImpl::FADEOUT;
+    impl-&gt;next_action   = GameSessionImpl::CHANGE_SECTOR_ACTION;
+  }
 }
 
 void
@@ -356,72 +356,72 @@
 GameSessionImpl::handle_event(const SDL_Event&amp; event)
 {
   switch(event.type)
-    {
-      case SDL_KEYDOWN:
-      case SDL_KEYUP:
-        if (event.key.state)
-          {    
-            switch (event.key.keysym.sym)
-              {
-                case SDLK_1:
-                  sc.set_render_mask(sc.get_render_mask() ^ SceneContext::COLORMAP);
-                  ConsoleLog &lt;&lt; &quot;Toggled COLORMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::COLORMAP) &gt; 0) &lt;&lt; std::endl;
-                  break;
+  {
+    case SDL_KEYDOWN:
+    case SDL_KEYUP:
+      if (event.key.state)
+      {    
+        switch (event.key.keysym.sym)
+        {
+          case SDLK_1:
+            sc.set_render_mask(sc.get_render_mask() ^ SceneContext::COLORMAP);
+            ConsoleLog &lt;&lt; &quot;Toggled COLORMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::COLORMAP) &gt; 0) &lt;&lt; std::endl;
+            break;
 
-                case SDLK_2:
-                  sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAP);
-                  ConsoleLog &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAP) &gt; 0) &lt;&lt; std::endl;
-                  break;
+          case SDLK_2:
+            sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAP);
+            ConsoleLog &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAP) &gt; 0) &lt;&lt; std::endl;
+            break;
       
-                case SDLK_3:
-                  sc.set_render_mask(sc.get_render_mask() ^ SceneContext::HIGHLIGHTMAP);
-                  ConsoleLog &lt;&lt; &quot;Toggled HIGHLIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::HIGHLIGHTMAP) &gt; 0) &lt;&lt; std::endl;
-                  break;      
+          case SDLK_3:
+            sc.set_render_mask(sc.get_render_mask() ^ SceneContext::HIGHLIGHTMAP);
+            ConsoleLog &lt;&lt; &quot;Toggled HIGHLIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::HIGHLIGHTMAP) &gt; 0) &lt;&lt; std::endl;
+            break;      
 
-                case SDLK_4:
-                  sc.set_render_mask(sc.get_render_mask() ^ SceneContext::CONTROLMAP);
-                  ConsoleLog &lt;&lt; &quot;Toggled CONTROLMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::CONTROLMAP) &gt; 0) &lt;&lt; std::endl;
-                  break;
+          case SDLK_4:
+            sc.set_render_mask(sc.get_render_mask() ^ SceneContext::CONTROLMAP);
+            ConsoleLog &lt;&lt; &quot;Toggled CONTROLMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::CONTROLMAP) &gt; 0) &lt;&lt; std::endl;
+            break;
   
-                case SDLK_5:
-                  sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAPSCREEN);
-                  ConsoleLog &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAPSCREEN) &gt; 0) &lt;&lt; std::endl;
-                  break;
+          case SDLK_5:
+            sc.set_render_mask(sc.get_render_mask() ^ SceneContext::LIGHTMAPSCREEN);
+            ConsoleLog &lt;&lt; &quot;Toggled LIGHTMAP: &quot; &lt;&lt; ((sc.get_render_mask() &amp; SceneContext::LIGHTMAPSCREEN) &gt; 0) &lt;&lt; std::endl;
+            break;
 
-                case SDLK_c:
-                  collision_debug = !collision_debug;
-                  ConsoleLog &lt;&lt; &quot;Collision Debugging &quot; &lt;&lt; (collision_debug ? &quot;enabled&quot; : &quot;disabled&quot;) &lt;&lt; std::endl;
-                  break;
+          case SDLK_c:
+            collision_debug = !collision_debug;
+            ConsoleLog &lt;&lt; &quot;Collision Debugging &quot; &lt;&lt; (collision_debug ? &quot;enabled&quot; : &quot;disabled&quot;) &lt;&lt; std::endl;
+            break;
 
-                case SDLK_F2:
-                  MenuManager::display_debug_menu();
-                  break;
+          case SDLK_F2:
+            MenuManager::display_debug_menu();
+            break;
         
-                default:
-                  break;
-              }
-          }
-        break;
+          default:
+            break;
+        }
+      }
+      break;
         
-      case SDL_MOUSEBUTTONDOWN:
-        {
-          Vector2f real_pos = view.screen_to_world(Vector2f(event.button.x, event.button.y));
-          ConsoleLog &lt;&lt; &quot;Click at: &quot; &lt;&lt; int(real_pos.x) &lt;&lt; &quot;, &quot; &lt;&lt; int(real_pos.y) &lt;&lt; std::endl;
-        }
-        break;
+    case SDL_MOUSEBUTTONDOWN:
+    {
+      Vector2f real_pos = view.screen_to_world(Vector2f(event.button.x, event.button.y));
+      ConsoleLog &lt;&lt; &quot;Click at: &quot; &lt;&lt; int(real_pos.x) &lt;&lt; &quot;, &quot; &lt;&lt; int(real_pos.y) &lt;&lt; std::endl;
     }
+    break;
+  }
 }
 
 void
 GameSession::quit()
 {
   if (impl-&gt;fade_state != GameSessionImpl::FADEOUT)
-    {
-      SoundManager::current()-&gt;stop_music();
-      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
-      impl-&gt;fade_time   = 1.0f;
-      impl-&gt;next_action = GameSessionImpl::QUIT_ACTION;
-    }
+  {
+    SoundManager::current()-&gt;stop_music();
+    impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
+    impl-&gt;fade_time   = 1.0f;
+    impl-&gt;next_action = GameSessionImpl::QUIT_ACTION;
+  }
 }
 
 PDA&amp;
@@ -458,19 +458,19 @@
 GameSession::set_control_state(ControlState state) 
 {
   switch(state)
-    {
-      case DIALOG:
-        impl-&gt;current_gui = &amp;impl-&gt;dialog_manager;
-        break;
+  {
+    case DIALOG:
+      impl-&gt;current_gui = &amp;impl-&gt;dialog_manager;
+      break;
 
-      case CONVERSATION:
-        impl-&gt;current_gui = &amp;impl-&gt;conversation;
-        break;
+    case CONVERSATION:
+      impl-&gt;current_gui = &amp;impl-&gt;conversation;
+      break;
 
-      case GAME:
-        impl-&gt;current_gui = 0;
-        break;
-    }
+    case GAME:
+      impl-&gt;current_gui = 0;
+      break;
+  }
 }
 
 bool
@@ -483,28 +483,28 @@
 GameSession::set_cutscene_mode(bool t)
 {
   if (t != impl-&gt;cutscene_mode)
-    {
-      impl-&gt;cutscene_mode  = t;
-    }
+  {
+    impl-&gt;cutscene_mode  = t;
+  }
 }
 
 void
 GameSession::fadeout(float time, const Color&amp; color)
 {
   if (time == 0.0)
-    { // directly go to a state of solid color, no fading
-      impl-&gt;fadeout_value  = 1.0f;
-      impl-&gt;fade_color  = color;
-      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
-      impl-&gt;next_action = GameSessionImpl::NO_ACTION;
-    }
+  { // directly go to a state of solid color, no fading
+    impl-&gt;fadeout_value  = 1.0f;
+    impl-&gt;fade_color  = color;
+    impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
+    impl-&gt;next_action = GameSessionImpl::NO_ACTION;
+  }
   else
-    {
-      impl-&gt;fade_time   = 1.0f/time;
-      impl-&gt;fade_color  = color;
-      impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
-      impl-&gt;next_action = GameSessionImpl::NO_ACTION;
-    }
+  {
+    impl-&gt;fade_time   = 1.0f/time;
+    impl-&gt;fade_color  = color;
+    impl-&gt;fade_state  = GameSessionImpl::FADEOUT;
+    impl-&gt;next_action = GameSessionImpl::NO_ACTION;
+  }
 }
 
 void

Modified: trunk/windstille/src/screen/geometry_test.cpp
===================================================================
--- trunk/windstille/src/screen/geometry_test.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/geometry_test.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -72,9 +72,9 @@
 {
   if (controller.button_was_pressed(ESCAPE_BUTTON) ||
       controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      MenuManager::display_pause_menu();
-    }
+  {
+    MenuManager::display_pause_menu();
+  }
 
   cursor.x += controller.get_axis_state(X_AXIS) * 500.0f * delta;
   cursor.y += controller.get_axis_state(Y_AXIS) * 500.0f * delta;
@@ -83,44 +83,44 @@
   cursor2.y += controller.get_axis_state(Y2_AXIS) * 500.0f * delta;
 
   if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      if (point_count == 0) {
-        cursor  = line2.p1;
-        cursor2 = line2.p2;
-      } else {
-        cursor  = line1.p1;
-        cursor2 = line1.p2;
-      }
-
-      point_count += 1;
-      if (point_count &gt; 1)
-        point_count = 0;
+  {
+    if (point_count == 0) {
+      cursor  = line2.p1;
+      cursor2 = line2.p2;
+    } else {
+      cursor  = line1.p1;
+      cursor2 = line1.p2;
     }
 
+    point_count += 1;
+    if (point_count &gt; 1)
+      point_count = 0;
+  }
+
   if (point_count == 0)
-    {
-      line1.p1 = cursor;
-      line1.p2 = cursor2;
-    }
+  {
+    line1.p1 = cursor;
+    line1.p2 = cursor2;
+  }
   else if (point_count == 1)
-    {
-      line2.p1 = cursor;
-      line2.p2 = cursor2;
-    }
+  {
+    line2.p1 = cursor;
+    line2.p2 = cursor2;
+  }
 
   if (line1.intersect(line2, collision_point))
-    {
-      if (!had_prev_collision)
-        ConsoleLog &lt;&lt; &quot;Collision&quot; &lt;&lt; std::endl;
-      had_prev_collision = true;
-    }
+  {
+    if (!had_prev_collision)
+      ConsoleLog &lt;&lt; &quot;Collision&quot; &lt;&lt; std::endl;
+    had_prev_collision = true;
+  }
   else
-    {
-      if (had_prev_collision)
-        ConsoleLog &lt;&lt; &quot;No Collision&quot; &lt;&lt; std::endl;
-      had_prev_collision = false;
-      collision_point = Vector2f(32, 32);
-    }
+  {
+    if (had_prev_collision)
+      ConsoleLog &lt;&lt; &quot;No Collision&quot; &lt;&lt; std::endl;
+    had_prev_collision = false;
+    collision_point = Vector2f(32, 32);
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/screen/navigation_test.cpp
===================================================================
--- trunk/windstille/src/screen/navigation_test.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/navigation_test.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -71,16 +71,16 @@
 
   std::vector&lt;NodeHandle&gt; nodes = graph-&gt;find_nodes(cursor, 128.0f);
   for(std::vector&lt;NodeHandle&gt;::iterator i = nodes.begin(); i != nodes.end(); ++i)
-    {
-      Display::draw_circle((*i)-&gt;get_pos(), 12.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
+  {
+    Display::draw_circle((*i)-&gt;get_pos(), 12.0f, Color(1.0f, 1.0f, 1.0f, 0.5f));
+  }
 
   if (node_to_connect)
-    {
-      Display::fill_rect(Rectf(node_to_connect-&gt;get_pos() - Vector2f(2,2), Sizef(5,5)),  
-                         Color(1.0f, 1.0f, 1.0f));
-      Display::draw_line(node_to_connect-&gt;get_pos(), cursor, Color(1.0f, 1.0f, 1.0f, 0.5f));
-    }
+  {
+    Display::fill_rect(Rectf(node_to_connect-&gt;get_pos() - Vector2f(2,2), Sizef(5,5)),  
+                       Color(1.0f, 1.0f, 1.0f));
+    Display::draw_line(node_to_connect-&gt;get_pos(), cursor, Color(1.0f, 1.0f, 1.0f, 0.5f));
+  }
 
   if (selected_node)
     Display::draw_circle(selected_node-&gt;get_pos(), 12.0f, Color(1.0f, 1.0f, 1.0f, 1.0f));
@@ -91,13 +91,13 @@
   Display::fill_circle(player, 12.0f, Color(0.0f, 0.0f, 1.0f, 1.0f));
 
   if (connection.get())
-    {
-      Display::fill_circle(connection-&gt;get_pos(), 16.0f, Color(0.0f, 0.0f, 1.0f, 0.5f));
-      Display::fill_circle(connection-&gt;get_pos(), 8.0f, Color(0.0f, 1.0f, 1.0f));
+  {
+    Display::fill_circle(connection-&gt;get_pos(), 16.0f, Color(0.0f, 0.0f, 1.0f, 0.5f));
+    Display::fill_circle(connection-&gt;get_pos(), 8.0f, Color(0.0f, 1.0f, 1.0f));
      
-      Display::draw_line(connection-&gt;get_pos(), connection-&gt;get_pos() + 100.0f*stick,
-                         Color(1.0f, 1.0f, 1.0f, 1.0f));
-    }
+    Display::draw_line(connection-&gt;get_pos(), connection-&gt;get_pos() + 100.0f*stick,
+                       Color(1.0f, 1.0f, 1.0f, 1.0f));
+  }
 }
 
 void
@@ -105,9 +105,9 @@
 {
   if (controller.button_was_pressed(ESCAPE_BUTTON) ||
       controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      MenuManager::display_pause_menu();
-    }
+  {
+    MenuManager::display_pause_menu();
+  }
 
   cursor += Vector2f(controller.get_axis_state(X_AXIS) * 500.0f * delta,
                      controller.get_axis_state(Y_AXIS) * 500.0f * delta);
@@ -116,137 +116,137 @@
                    controller.get_axis_state(Y2_AXIS));
 
   if (controller.button_was_pressed(PRIMARY_BUTTON))
+  {
+    if (node_to_connect)
     {
-      if (node_to_connect)
-        {
-          if (selected_node)
-            graph-&gt;add_edge(node_to_connect, selected_node);
+      if (selected_node)
+        graph-&gt;add_edge(node_to_connect, selected_node);
           
-          node_to_connect = 0;
-        }
-      else if (selected_node)
-        {
-          node_to_connect = selected_node;
-        }
-      else if (selected_edge)
-        {
-          graph-&gt;split_edge(selected_edge);
-          selected_edge = 0;
-        }
-      else
-        {
-          graph-&gt;add_node(cursor);
-        }
+      node_to_connect = 0;
     }
+    else if (selected_node)
+    {
+      node_to_connect = selected_node;
+    }
+    else if (selected_edge)
+    {
+      graph-&gt;split_edge(selected_edge);
+      selected_edge = 0;
+    }
+    else
+    {
+      graph-&gt;add_node(cursor);
+    }
+  }
 
   if (controller.get_button_state(TERTIARY_BUTTON))
-    { // Move node
-      if (selected_node)
-        {
-          selected_node-&gt;set_pos(cursor);
-        }
+  { // Move node
+    if (selected_node)
+    {
+      selected_node-&gt;set_pos(cursor);
     }
+  }
 
   if (controller.button_was_pressed(SECONDARY_BUTTON))
-    { // Set player
-      player = old_player = cursor;
-    }
+  { // Set player
+    player = old_player = cursor;
+  }
 
   if (connection.get())
-    { 
-      // Handle the movement of the connection
-      Node* next_node;
-      //float advance = 512.0f * controller.get_axis_state(X2_AXIS) * delta;
+  { 
+    // Handle the movement of the connection
+    Node* next_node;
+    //float advance = 512.0f * controller.get_axis_state(X2_AXIS) * delta;
       
-      Vector2f advance = delta * 512.0f * stick;
-      connection-&gt;advance(advance, next_node);
+    Vector2f advance = delta * 512.0f * stick;
+    connection-&gt;advance(advance, next_node);
 
-      player = connection-&gt;get_pos();
+    player = connection-&gt;get_pos();
       
-      if (!advance.is_null())
-        { // Not all advancement got used up, which means we have hit
-          // the end of a edge
+    if (!advance.is_null())
+    { // Not all advancement got used up, which means we have hit
+      // the end of a edge
 
-          // FIXME: This should be a while loop, currently we are just
-          // discarding the rest movement
+      // FIXME: This should be a while loop, currently we are just
+      // discarding the rest movement
 
-          EdgePosition next_edge;
-          float length = 0;
-          for(Node::Edges::iterator i = next_node-&gt;edges.begin(); i != next_node-&gt;edges.end(); ++i)
-            {
-              if (connection-&gt;get_edge() != i-&gt;edge)
-                { // Find out into the direction of which edge the stick is pointing
-                  Vector2f proj = stick.project(i-&gt;edge-&gt;get_vector());
+      EdgePosition next_edge;
+      float length = 0;
+      for(Node::Edges::iterator i = next_node-&gt;edges.begin(); i != next_node-&gt;edges.end(); ++i)
+      {
+        if (connection-&gt;get_edge() != i-&gt;edge)
+        { // Find out into the direction of which edge the stick is pointing
+          Vector2f proj = stick.project(i-&gt;edge-&gt;get_vector());
                   
-                  if (proj.length() &gt; length)
-                    {
-                      next_edge = *i;
-                      length       = proj.length();
-                    }
-                }
-            }
+          if (proj.length() &gt; length)
+          {
+            next_edge = *i;
+            length       = proj.length();
+          }
+        }
+      }
               
-          if (!next_edge.edge)
-            {
-              std::cout &lt;&lt; &quot;Dead End&quot; &lt;&lt; std::endl;
-              connection.reset();
+      if (!next_edge.edge)
+      {
+        std::cout &lt;&lt; &quot;Dead End&quot; &lt;&lt; std::endl;
+        connection.reset();
 
-              // FIXME: Voodoo to fix connection/deadend cicles
-              player += stick;
-              old_player = player;
-            }
-          else
-            {
-              std::cout &lt;&lt; &quot;transition&quot; &lt;&lt; std::endl;
-              *connection = next_edge;
-            }
-        }
+        // FIXME: Voodoo to fix connection/deadend cicles
+        player += stick;
+        old_player = player;
+      }
+      else
+      {
+        std::cout &lt;&lt; &quot;transition&quot; &lt;&lt; std::endl;
+        *connection = next_edge;
+      }
+    }
 
-      if (controller.get_button_state(AIM_BUTTON))
-        {         
-          connection.reset();
+    if (controller.get_button_state(AIM_BUTTON))
+    {         
+      connection.reset();
 
-          // FIXME: Voodoo to fix connection/dedaend cicles
-          player += stick;
-          old_player = player;
-        }
+      // FIXME: Voodoo to fix connection/dedaend cicles
+      player += stick;
+      old_player = player;
     }
+  }
   else
-    { // handle non connection based movement
-      player += Vector2f(0.0f, 100.0f) * delta;
+  { // handle non connection based movement
+    player += Vector2f(0.0f, 100.0f) * delta;
       
-      player.x += 512.0f * stick.x * delta;
+    player.x += 512.0f * stick.x * delta;
 
-      if (controller.get_button_state(AIM_BUTTON))
-        {
-          player.y -= 0.5f * 512.0f * delta;
-        }
+    if (controller.get_button_state(AIM_BUTTON))
+    {
+      player.y -= 0.5f * 512.0f * delta;
+    }
 
-      std::vector&lt;EdgePosition&gt; positions = graph-&gt;find_intersections(Line(old_player, player));
-      if (!positions.empty()) 
-        {
-          std::cout &lt;&lt; &quot;Doing connection&quot; &lt;&lt; std::endl;
-          connection.reset(new EdgePosition(positions.front()));
-        }
+    std::vector&lt;EdgePosition&gt; positions = graph-&gt;find_intersections(Line(old_player, player));
+    if (!positions.empty()) 
+    {
+      std::cout &lt;&lt; &quot;Doing connection&quot; &lt;&lt; std::endl;
+      connection.reset(new EdgePosition(positions.front()));
     }
+  }
   
   if (controller.button_was_pressed(SELECT_BUTTON))
-    {
-      graph-&gt;save(std::cout);
-    }
+  {
+    graph-&gt;save(std::cout);
+  }
 
   if (controller.button_was_pressed(QUATERNARY_BUTTON))
-    {
-      if (selected_node) {
-        graph-&gt;remove_node(selected_node);
-        selected_node = 0;
-      } 
+  {
+    if (selected_node) {
+      graph-&gt;remove_node(selected_node);
+      selected_node = 0;
+    } 
       
-      if (selected_edge) {
-        graph-&gt;remove_edge(selected_edge);
-        selected_edge = 0;
-      }      
-    }
+    if (selected_edge) {
+      graph-&gt;remove_edge(selected_edge);
+      selected_edge = 0;
+    }      
+  }
 
   selected_node = graph-&gt;find_closest_node(cursor, 32.0f);
   if (!selected_node)
@@ -255,9 +255,9 @@
     selected_edge = 0;
 
   if (connection.get() &amp;&amp; !graph-&gt;valid(connection-&gt;get_edge()))
-    {
-      connection.reset();
-    }
+  {
+    connection.reset();
+  }
 
   old_player = player;
 }

Modified: trunk/windstille/src/screen/particle_viewer.cpp
===================================================================
--- trunk/windstille/src/screen/particle_viewer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/particle_viewer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -116,9 +116,9 @@
 
   if (controller.button_was_pressed(PAUSE_BUTTON) ||
       controller.button_was_pressed(ESCAPE_BUTTON))
-    {
-      MenuManager::display_pause_menu();
-    }
+  {
+    MenuManager::display_pause_menu();
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/screen/screen_manager.cpp
===================================================================
--- trunk/windstille/src/screen/screen_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/screen_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -120,7 +120,7 @@
     overlay_screens.back()-&gt;draw();
 
   if (show_controller_help_window)
-     controller_help_window-&gt;draw();
+    controller_help_window-&gt;draw();
 
   Console::current()-&gt;draw();
 
@@ -192,141 +192,141 @@
 {
   SDL_Event event;
   while(SDL_PollEvent(&amp;event))
+  {
+    switch(event.type)
     {
-      switch(event.type)
-        {
-          case SDL_QUIT:
-            // FIXME: This should be a bit more gentle, but will do for now
-            std::cout &lt;&lt; &quot;Ctrl-c or Window-close pressed, game is going to quit&quot; &lt;&lt; std::endl;
-            quit();
-            break;
+      case SDL_QUIT:
+        // FIXME: This should be a bit more gentle, but will do for now
+        std::cout &lt;&lt; &quot;Ctrl-c or Window-close pressed, game is going to quit&quot; &lt;&lt; std::endl;
+        quit();
+        break;
           
-          case SDL_ACTIVEEVENT:
-            // event.active
-            break;
+      case SDL_ACTIVEEVENT:
+        // event.active
+        break;
           
-          case SDL_VIDEORESIZE:
-            // event.resize
-            break;
+      case SDL_VIDEORESIZE:
+        // event.resize
+        break;
               
-          case SDL_VIDEOEXPOSE:
-            // event.expose
-            break;
+      case SDL_VIDEOEXPOSE:
+        // event.expose
+        break;
                 
-          case SDL_USEREVENT:
-            // event.user
-            break;
+      case SDL_USEREVENT:
+        // event.user
+        break;
                     
-          case SDL_SYSWMEVENT:
-            // event.syswm
-            break;
+      case SDL_SYSWMEVENT:
+        // event.syswm
+        break;
 
-          case SDL_KEYDOWN:
-          case SDL_KEYUP:
-            if (event.key.state)
-              {    
-                switch (event.key.keysym.sym)
-                  {
-                    case SDLK_F6:
-                      SDL_ShowCursor(SDL_ENABLE);   // SDL_ENABLE to show the mouse cursor (default)
-                      SDL_WM_GrabInput(SDL_GRAB_OFF); // SDL_GRAB_OFF to not grab input (default)
-                      break;
+      case SDL_KEYDOWN:
+      case SDL_KEYUP:
+        if (event.key.state)
+        {    
+          switch (event.key.keysym.sym)
+          {
+            case SDLK_F6:
+              SDL_ShowCursor(SDL_ENABLE);   // SDL_ENABLE to show the mouse cursor (default)
+              SDL_WM_GrabInput(SDL_GRAB_OFF); // SDL_GRAB_OFF to not grab input (default)
+              break;
 
-                    case SDLK_F7:
-                      SDL_ShowCursor(SDL_DISABLE);   // SDL_ENABLE to show the mouse cursor (default)
-                      SDL_WM_GrabInput(SDL_GRAB_ON); // SDL_GRAB_OFF to not grab input (default)
-                      break;
+            case SDLK_F7:
+              SDL_ShowCursor(SDL_DISABLE);   // SDL_ENABLE to show the mouse cursor (default)
+              SDL_WM_GrabInput(SDL_GRAB_ON); // SDL_GRAB_OFF to not grab input (default)
+              break;
                   
-                    case SDLK_F8:
-                      show_controller_help_window = !show_controller_help_window;
-                      break;
+            case SDLK_F8:
+              show_controller_help_window = !show_controller_help_window;
+              break;
 
-                    case SDLK_F9:
-                      push_overlay(new InputConfigurator());
-                      break;
+            case SDLK_F9:
+              push_overlay(new InputConfigurator());
+              break;
 
-                    case SDLK_F10:
-                      config.set_bool(&quot;show-fps&quot;, !config.get_bool(&quot;show-fps&quot;));
-                      break;
+            case SDLK_F10:
+              config.set_bool(&quot;show-fps&quot;, !config.get_bool(&quot;show-fps&quot;));
+              break;
               
-                    case SDLK_F11:
-                      config.set_bool(&quot;fullscreen&quot;, !config.get_bool(&quot;fullscreen&quot;));
-                      OpenGLWindow::current()-&gt;set_fullscreen(config.get_bool(&quot;fullscreen&quot;));
-                      break;
+            case SDLK_F11:
+              config.set_bool(&quot;fullscreen&quot;, !config.get_bool(&quot;fullscreen&quot;));
+              OpenGLWindow::current()-&gt;set_fullscreen(config.get_bool(&quot;fullscreen&quot;));
+              break;
               
-                    case SDLK_F12:
-                      {
-                        // FIXME: Replace this with Physfs stuff
-                        int count = 0;
-                        Pathname filename;
-                        do {
-                          filename = Pathname((boost::format(&quot;screenshots/windstille%04d.png&quot;) % count).str(), Pathname::kUserPath);
-                          count += 1;
-                        } while(filename.exists());
+            case SDLK_F12:
+            {
+              // FIXME: Replace this with Physfs stuff
+              int count = 0;
+              Pathname filename;
+              do {
+                filename = Pathname((boost::format(&quot;screenshots/windstille%04d.png&quot;) % count).str(), Pathname::kUserPath);
+                count += 1;
+              } while(filename.exists());
 
-                        Display::save_screenshot(filename);
-                        ConsoleLog &lt;&lt; &quot;Writing screenshot to: '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
-                      }
-                      break;
+              Display::save_screenshot(filename);
+              ConsoleLog &lt;&lt; &quot;Writing screenshot to: '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot; &lt;&lt; std::endl;
+            }
+            break;
               
-                    default:
-                      if (!Console::current()-&gt;is_active())
-                        {
-                          if (!overlay_screens.empty())
-                            overlay_screens.back()-&gt;handle_event(event);
-                          else if (!screens.empty())
-                            screens.back()-&gt;handle_event(event);
-                        }
-                      break;
-                  }
+            default:
+              if (!Console::current()-&gt;is_active())
+              {
+                if (!overlay_screens.empty())
+                  overlay_screens.back()-&gt;handle_event(event);
+                else if (!screens.empty())
+                  screens.back()-&gt;handle_event(event);
               }
+              break;
+          }
+        }
               
-            if (!Console::current()-&gt;is_active() &amp;&amp; event.key.state &amp;&amp; event.key.keysym.sym == SDLK_F1)
-              {
-                Console::current()-&gt;activate();
-              }
-            else
-              {
-                if (InputManagerSDL::current())
-                  InputManagerSDL::current()-&gt;on_event(event);
-              }
-            break;
+        if (!Console::current()-&gt;is_active() &amp;&amp; event.key.state &amp;&amp; event.key.keysym.sym == SDLK_F1)
+        {
+          Console::current()-&gt;activate();
+        }
+        else
+        {
+          if (InputManagerSDL::current())
+            InputManagerSDL::current()-&gt;on_event(event);
+        }
+        break;
 
-          case SDL_MOUSEBUTTONUP:
-          case SDL_MOUSEBUTTONDOWN:
-          case SDL_MOUSEMOTION:
-          case SDL_JOYAXISMOTION:
-          case SDL_JOYBALLMOTION:
-          case SDL_JOYHATMOTION:
-          case SDL_JOYBUTTONUP:
-          case SDL_JOYBUTTONDOWN:
-            if (InputManagerSDL::current())
-              InputManagerSDL::current()-&gt;on_event(event);
+      case SDL_MOUSEBUTTONUP:
+      case SDL_MOUSEBUTTONDOWN:
+      case SDL_MOUSEMOTION:
+      case SDL_JOYAXISMOTION:
+      case SDL_JOYBALLMOTION:
+      case SDL_JOYHATMOTION:
+      case SDL_JOYBUTTONUP:
+      case SDL_JOYBUTTONDOWN:
+        if (InputManagerSDL::current())
+          InputManagerSDL::current()-&gt;on_event(event);
 
-            if (!overlay_screens.empty())
-              overlay_screens.back()-&gt;handle_event(event);
-            break;
+        if (!overlay_screens.empty())
+          overlay_screens.back()-&gt;handle_event(event);
+        break;
         
-          default:
-            if (!overlay_screens.empty())
-              overlay_screens.back()-&gt;handle_event(event);
-            else if (!screens.empty())
-              screens.back()-&gt;handle_event(event);
-            break;
-        }
+      default:
+        if (!overlay_screens.empty())
+          overlay_screens.back()-&gt;handle_event(event);
+        else if (!screens.empty())
+          screens.back()-&gt;handle_event(event);
+        break;
     }
+  }
 }
 
 void 
 ScreenManager::draw_fps()
 {
   if(time_counter &gt; 1) 
-    {
-      last_fps = int(static_cast&lt;float&gt;(frame_counter) / time_counter);
+  {
+    last_fps = int(static_cast&lt;float&gt;(frame_counter) / time_counter);
 
-      time_counter  = fmodf(static_cast&lt;float&gt;(time_counter), 1.0f);
-      frame_counter = 0;
-    }
+    time_counter  = fmodf(static_cast&lt;float&gt;(time_counter), 1.0f);
+    frame_counter = 0;
+  }
   
   std::ostringstream out;
   out &lt;&lt; &quot;FPS: &quot; &lt;&lt; last_fps;

Modified: trunk/windstille/src/screen/sprite2dview.cpp
===================================================================
--- trunk/windstille/src/screen/sprite2dview.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/sprite2dview.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -120,122 +120,122 @@
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
 
   switch(mode)
-    {
+  {
     case SLIDESHOW:
       if (aspect &gt; 4.0/3.0)
-        {
-          sprite.draw(Vector2f(-offset, 0));
-        }
+      {
+        sprite.draw(Vector2f(-offset, 0));
+      }
       else
-        {
-          sprite.draw(Vector2f(0, -offset));
-        }
+      {
+        sprite.draw(Vector2f(0, -offset));
+      }
 
       if (new_sprite)
-        {
-          new_sprite.draw(Vector2f(0,0));
-        }
+      {
+        new_sprite.draw(Vector2f(0,0));
+      }
 
       if (show_thumbnail)
+      {
+        Sprite small = sprite;
+        small.set_alpha(1.0f);
+        float w  = small.get_width();
+        float h = small.get_height();
+        float s;
+        if (w &gt; h)
         {
-          Sprite small = sprite;
-          small.set_alpha(1.0f);
-          float w  = small.get_width();
-          float h = small.get_height();
-          float s;
-          if (w &gt; h)
-            {
-              s = 125.0f / w;
+          s = 125.0f / w;
 
-              w  *= s;
-              h *= s;
-              small.set_scale(s);
+          w  *= s;
+          h *= s;
+          small.set_scale(s);
 
-              small.draw(Vector2f(DISPLAY_W - w,
-                                  DISPLAY_H - h));
-            }
-          else
-            {
-              s = 125.0f / h;
+          small.draw(Vector2f(DISPLAY_W - w,
+                              DISPLAY_H - h));
+        }
+        else
+        {
+          s = 125.0f / h;
 
-              w  *= s;
-              h *= s;
-              small.set_scale(s);
+          w  *= s;
+          h *= s;
+          small.set_scale(s);
 
-              small.draw(Vector2f(DISPLAY_W - w,
-                                DISPLAY_H - h));
-            }
-        }        
+          small.draw(Vector2f(DISPLAY_W - w,
+                              DISPLAY_H - h));
+        }
+      }        
       break;
       
     case MANUAL:
       sprite.set_scale(zoom);
       sprite.draw(pos);
       break;
-    }
+  }
 }
 
 void
 Sprite2DView::update_slideshow(float delta, const Controller&amp; controller)
 {
   if (!new_sprite)
-    {
-      width  = sprite.get_width();
-      height = sprite.get_height();
-      aspect = width/height;
+  {
+    width  = sprite.get_width();
+    height = sprite.get_height();
+    aspect = width/height;
 
-      if (aspect &gt; 4.0/3.0)
-        { // expand vertical
-          float s = DISPLAY_H/height;
-          width  *= s;
-          height *= s;
-          sprite.set_scale(s);
+    if (aspect &gt; 4.0/3.0)
+    { // expand vertical
+      float s = DISPLAY_H/height;
+      width  *= s;
+      height *= s;
+      sprite.set_scale(s);
 
-          if (offset - (width - DISPLAY_W) &gt; 0)
-            {
-              offset = (width - DISPLAY_W);
+      if (offset - (width - DISPLAY_W) &gt; 0)
+      {
+        offset = (width - DISPLAY_W);
 
-              if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
-                next_image();
-            }
-          else
-            {
-              offset += delta * 50.0f + controller.get_axis_state(X_AXIS) * 200.0f * delta;
-            }
-
-          offset +=  controller.get_ball_state(MOUSE_MOTION_Y);
-        }
+        if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
+          next_image();
+      }
       else
-        { // expand horizontal
-          float s = 800.0f/width;
-          width  *= s;
-          height *= s;
-          sprite.set_scale(s);
+      {
+        offset += delta * 50.0f + controller.get_axis_state(X_AXIS) * 200.0f * delta;
+      }
 
-          if (offset - (height - DISPLAY_H) &gt; 0)
-            {
-              offset = (width - DISPLAY_H);
+      offset +=  controller.get_ball_state(MOUSE_MOTION_Y);
+    }
+    else
+    { // expand horizontal
+      float s = 800.0f/width;
+      width  *= s;
+      height *= s;
+      sprite.set_scale(s);
 
-              if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
-                next_image();
-            }
-          else
-            {
-              offset += delta * 50.0f +   controller.get_axis_state(X_AXIS) * 200.0f * delta;
-            }
+      if (offset - (height - DISPLAY_H) &gt; 0)
+      {
+        offset = (width - DISPLAY_H);
 
-          offset += controller.get_ball_state(MOUSE_MOTION_Y);
-        }
+        if (auto_scroll &amp;&amp; display_time &gt; 3.0f)
+          next_image();
+      }
+      else
+      {
+        offset += delta * 50.0f +   controller.get_axis_state(X_AXIS) * 200.0f * delta;
+      }
+
+      offset += controller.get_ball_state(MOUSE_MOTION_Y);
     }
+  }
 
   if (controller.button_was_pressed(PRIMARY_BUTTON))
-    {
-      next_image();
-    }
+  {
+    next_image();
+  }
   else if (controller.button_was_pressed(SECONDARY_BUTTON))
-    {
-      prev_image();
-    }
+  {
+    prev_image();
+  }
 }
 
 void
@@ -300,19 +300,19 @@
   float a = w/h;
 
   if (a &gt; 4.0/3.0)
-    { // expand vertical
-      float s = DISPLAY_H/h;
-      w *= s;
-      h *= s;
-      sprite_.set_scale(s);
-    }
+  { // expand vertical
+    float s = DISPLAY_H/h;
+    w *= s;
+    h *= s;
+    sprite_.set_scale(s);
+  }
   else
-    { // expand horizontal
-      float s = DISPLAY_W/w;
-      w *= s;
-      h *= s;
-      sprite_.set_scale(s);
-    }  
+  { // expand horizontal
+    float s = DISPLAY_W/w;
+    w *= s;
+    h *= s;
+    sprite_.set_scale(s);
+  }  
 }
 
 void
@@ -334,47 +334,47 @@
 Sprite2DView::update(float delta, const Controller&amp; controller)
 {  
   if (ignore_delta)
-    {
-      ignore_delta = false;
-      delta = 0.0f;
-    }
+  {
+    ignore_delta = false;
+    delta = 0.0f;
+  }
   
   display_time += delta * 0.5f;
 
   switch(mode) {
-  case SLIDESHOW:
-    update_slideshow(delta, controller);
-    break;
-  case MANUAL:
-    update_manual(delta, controller);
-    break;
+    case SLIDESHOW:
+      update_slideshow(delta, controller);
+      break;
+    case MANUAL:
+      update_manual(delta, controller);
+      break;
   }
 
   if (controller.button_was_pressed(PDA_BUTTON))
+  {
+    if (shuffle)
     {
-      if (shuffle)
-        {
-          std::vector&lt;Pathname&gt;::iterator i = std::find(directory.begin(), directory.end(),
-                                                        shuffle_directory[index]);
-          if (i != directory.end())
-            {
-              index = i - directory.begin() ;
-            }
-        }
-      else
-        {
-          std::vector&lt;Pathname&gt;::iterator i = std::find(shuffle_directory.begin(), shuffle_directory.end(),
-                                                           directory[index]);
-          if (i != shuffle_directory.end())
-            {
-              index = i - shuffle_directory.begin();
-            }
-        }
+      std::vector&lt;Pathname&gt;::iterator i = std::find(directory.begin(), directory.end(),
+                                                    shuffle_directory[index]);
+      if (i != directory.end())
+      {
+        index = i - directory.begin() ;
+      }
+    }
+    else
+    {
+      std::vector&lt;Pathname&gt;::iterator i = std::find(shuffle_directory.begin(), shuffle_directory.end(),
+                                                    directory[index]);
+      if (i != shuffle_directory.end())
+      {
+        index = i - shuffle_directory.begin();
+      }
+    }
 
-      shuffle = !shuffle;
+    shuffle = !shuffle;
 
-      std::cout &lt;&lt; shuffle &lt;&lt; &quot; &quot; &lt;&lt; index &lt;&lt; std::endl;
-    }
+    std::cout &lt;&lt; shuffle &lt;&lt; &quot; &quot; &lt;&lt; index &lt;&lt; std::endl;
+  }
 
   //  if (controller.button_was_pressed(INVENTORY_BUTTON))
   //std::random_shuffle(shuffle_directory.begin(), shuffle_directory.end());
@@ -383,28 +383,28 @@
     show_thumbnail = !show_thumbnail;
 
   if (controller.button_was_pressed(AIM_BUTTON))
-    {
-      if (mode == SLIDESHOW) mode = MANUAL; 
-      else if (mode == MANUAL) mode = SLIDESHOW; 
-    }
+  {
+    if (mode == SLIDESHOW) mode = MANUAL; 
+    else if (mode == MANUAL) mode = SLIDESHOW; 
+  }
 
   if (new_sprite)
+  {
+    fadein += delta;
+
+    if (fadein &gt; 1.0f)
     {
-      fadein += delta;
-
-      if (fadein &gt; 1.0f)
-        {
-          sprite = new_sprite;
-          sprite.set_alpha(1.0f);
-          new_sprite = Sprite();
-          offset = 0;
-          display_time = 0;
-        }
-      else
-        {
-          new_sprite.set_alpha(fadein);
-        }
+      sprite = new_sprite;
+      sprite.set_alpha(1.0f);
+      new_sprite = Sprite();
+      offset = 0;
+      display_time = 0;
     }
+    else
+    {
+      new_sprite.set_alpha(fadein);
+    }
+  }
 }
 
 void

Modified: trunk/windstille/src/screen/sprite3dview.cpp
===================================================================
--- trunk/windstille/src/screen/sprite3dview.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/sprite3dview.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -90,21 +90,21 @@
   int line_height = Fonts::current()-&gt;vera12-&gt;get_height()+5;
 
   for(int i = 0; i &lt; int(actions.size()); ++i)
+  {
+    if (i == current_action)
+      Fonts::current()-&gt;vera12-&gt;draw(Vector2f(x, y),
+                                     actions[i], Color(1.0f, 1.0f, 1.0f));
+    else
+      Fonts::current()-&gt;vera12-&gt;draw(Vector2f(x, y),
+                                     actions[i], Color(0.7f, 0.7f, 0.7f));
+
+    y += static_cast&lt;float&gt;(line_height);
+    if (y &gt; 580.0f)
     {
-      if (i == current_action)
-        Fonts::current()-&gt;vera12-&gt;draw(Vector2f(x, y),
-                            actions[i], Color(1.0f, 1.0f, 1.0f));
-      else
-        Fonts::current()-&gt;vera12-&gt;draw(Vector2f(x, y),
-                            actions[i], Color(0.7f, 0.7f, 0.7f));
-
-      y += static_cast&lt;float&gt;(line_height);
-      if (y &gt; 580.0f)
-        {
-          x += 200.0f;
-          y =  static_cast&lt;float&gt;(Fonts::current()-&gt;vera12-&gt;get_height()) + 5.0f;
-        }
+      x += 200.0f;
+      y =  static_cast&lt;float&gt;(Fonts::current()-&gt;vera12-&gt;get_height()) + 5.0f;
     }
+  }
 }
 
 void
@@ -115,33 +115,33 @@
 
   int last_action = current_action;
   if (controller.button_was_pressed(MENU_DOWN_BUTTON))
-    {
-      if (current_action == int(actions.size())-1)
-        current_action = 0;
-      else
-        current_action += 1;
-    }
+  {
+    if (current_action == int(actions.size())-1)
+      current_action = 0;
+    else
+      current_action += 1;
+  }
   else if (controller.button_was_pressed(MENU_UP_BUTTON))
-    {
-      if (current_action == 0)
-        current_action = actions.size()-1;
-      else
-        current_action -= 1;
-    }
+  {
+    if (current_action == 0)
+      current_action = actions.size()-1;
+    else
+      current_action -= 1;
+  }
 
   if (controller.get_button_state(RIGHT_SHOULDER_BUTTON))
-    {
-      scale *= 1.0f + 0.6f * delta;
-    }
+  {
+    scale *= 1.0f + 0.6f * delta;
+  }
   else if (controller.get_button_state(LEFT_SHOULDER_BUTTON))
-    {
-      scale /= 1.0f + 0.6f * delta;
-    }
+  {
+    scale /= 1.0f + 0.6f * delta;
+  }
   
   if (last_action != current_action &amp;&amp; !actions.empty())
-    {
-      sprite.set_action(actions[current_action]);
-    }
+  {
+    sprite.set_action(actions[current_action]);
+  }
 
   rotation = Quaternion(Vector3(0.0f, 1.0f, 0.0f),
                         -controller.get_axis_state(X2_AXIS) * delta * 4.0f) * rotation;
@@ -151,15 +151,15 @@
                         controller.get_axis_state(X_AXIS) * delta * 4.0f) * rotation;
 
   if (controller.get_button_state(VIEW_CENTER_BUTTON))
-    {
-      rotation = Quaternion::identity();
-    }
+  {
+    rotation = Quaternion::identity();
+  }
 
   if (controller.button_was_pressed(ESCAPE_BUTTON) ||
       controller.button_was_pressed(PAUSE_BUTTON))
-    {
-      MenuManager::display_pause_menu();
-    }
+  {
+    MenuManager::display_pause_menu();
+  }
 }
 
 void

Modified: trunk/windstille/src/screen/view.cpp
===================================================================
--- trunk/windstille/src/screen/view.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/screen/view.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -65,16 +65,16 @@
   const Controller&amp; controller = InputManagerSDL::current()-&gt;get_controller();
 
   if (controller.get_button_state(DEBUG_BUTTON))
+  {
+    if (controller.get_button_state(VIEW_CENTER_BUTTON)) 
     {
-      if (controller.get_button_state(VIEW_CENTER_BUTTON)) 
-        {
-          m_debug_transform = Vector2f(0, 0);
-          m_debug_zoom = 1.0;
-        }
+      m_debug_transform = Vector2f(0, 0);
+      m_debug_zoom = 1.0;
+    }
 
-      m_debug_transform.x += 1000.0f * controller.get_axis_state(X2_AXIS) * delta / m_debug_zoom;
-      m_debug_transform.y += 1000.0f * controller.get_axis_state(Y2_AXIS) * delta / m_debug_zoom;
-    }
+    m_debug_transform.x += 1000.0f * controller.get_axis_state(X2_AXIS) * delta / m_debug_zoom;
+    m_debug_transform.y += 1000.0f * controller.get_axis_state(Y2_AXIS) * delta / m_debug_zoom;
+  }
 }
 
 Rectf

Modified: trunk/windstille/src/scripting/game_objects.cpp
===================================================================
--- trunk/windstille/src/scripting/game_objects.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/scripting/game_objects.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -51,12 +51,12 @@
 GameObject::set_parent(const std::string&amp; name)
 {
   if (::Entity* entity = dynamic_cast&lt;Entity*&gt;(object.lock().get()))
+  {
+    if (::GameObject* obj = Sector::current()-&gt;get_object(name))
     {
-      if (::GameObject* obj = Sector::current()-&gt;get_object(name))
-        {
-          entity-&gt;set_parent(dynamic_cast&lt;Entity*&gt;(obj));
-        }
+      entity-&gt;set_parent(dynamic_cast&lt;Entity*&gt;(obj));
     }
+  }
 }
 
 void
@@ -85,7 +85,7 @@
 
 void
 TestObject::attach(const std::string&amp; spritename,
-		           const std::string&amp; attachement_point)
+                   const std::string&amp; attachement_point)
 {
   obj()-&gt;attach(spritename, attachement_point);
 }

Modified: trunk/windstille/src/scripting/game_objects.hpp
===================================================================
--- trunk/windstille/src/scripting/game_objects.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/scripting/game_objects.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -73,7 +73,7 @@
   void set_pos(float x, float y);
   void set_vflip(bool vflip);
   void attach(const std::string&amp; spritename,
-		      const std::string&amp; attachement_point);
+              const std::string&amp; attachement_point);
 };
 
 class Player : public GameObject

Modified: trunk/windstille/src/scripting/squirrel_error.cpp
===================================================================
--- trunk/windstille/src/scripting/squirrel_error.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/scripting/squirrel_error.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,8 +24,8 @@
 
 namespace Scripting {
 
-SquirrelError::SquirrelError(HSQUIRRELVM v, const Pathname&amp; path, const std::string&amp; message_) throw()
-  : message()
+SquirrelError::SquirrelError(HSQUIRRELVM v, const Pathname&amp; path, const std::string&amp; message_) throw() :
+  message()
 {
   std::ostringstream msg;
   msg &lt;&lt; &quot;Squirrel error: &quot; &lt;&lt; path &lt;&lt; &quot;: &quot; &lt;&lt; message_ &lt;&lt; &quot; (&quot;;
@@ -44,8 +44,8 @@
   message = msg.str();
 }
 
-SquirrelError::SquirrelError(HSQUIRRELVM v, const std::string&amp; context, const std::string&amp; message_) throw()
-  : message()
+SquirrelError::SquirrelError(HSQUIRRELVM v, const std::string&amp; context, const std::string&amp; message_) throw() :
+  message()
 {
   std::ostringstream msg;
   msg &lt;&lt; &quot;Squirrel error: &quot; &lt;&lt; context &lt;&lt; &quot;: &quot; &lt;&lt; message_ &lt;&lt; &quot; (&quot;;
@@ -64,8 +64,8 @@
   message = msg.str();
 }
 
-SquirrelError::SquirrelError(HSQUIRRELVM v, const std::string&amp; message_) throw()
-  : message()
+SquirrelError::SquirrelError(HSQUIRRELVM v, const std::string&amp; message_) throw() :
+  message()
 {
   std::ostringstream msg;
   msg &lt;&lt; &quot;Squirrel error: &quot; &lt;&lt; message_ &lt;&lt; &quot; (&quot;;

Modified: trunk/windstille/src/scripting/util.cpp
===================================================================
--- trunk/windstille/src/scripting/util.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/scripting/util.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -33,10 +33,10 @@
 std::string sq_to_lisp_string(std::string sq_str)
 {
   for (unsigned i = 0; i != sq_str.size(); ++i)
-    {
-      if (sq_str[i] == '_')
-        sq_str[i] = '-';
-    }
+  {
+    if (sq_str[i] == '_')
+      sq_str[i] = '-';
+  }
   
   return sq_str;
 }
@@ -44,40 +44,40 @@
 void sq_to_lisp(HSQUIRRELVM v, std::vector&lt;lisp::Lisp*&gt;&amp; entries)
 {
   switch(sq_gettype(v, -1))
-    {
-      case OT_INTEGER: {
-        SQInteger val;
-        sq_getinteger(v, -1, &amp;val);
-        entries.push_back(new lisp::Lisp(static_cast&lt;int&gt;(val)));
-        break;
-      }
-      case OT_FLOAT: {
-        float val;
-        sq_getfloat(v, -1, &amp;val);
-        entries.push_back(new lisp::Lisp(val));
-        break;
-      }
-      case OT_STRING: {
-        const char* str;
-        sq_getstring(v, -1, &amp;str);      
-        entries.push_back(new lisp::Lisp(lisp::Lisp::TYPE_STRING, str));
-        break;
-      }                                                    
-      case OT_BOOL: {
-        SQBool boolean;
-        sq_getbool(v, -1, &amp;boolean);
-        entries.push_back(new lisp::Lisp(static_cast&lt;bool&gt;(boolean)));
-        break;
-      }
-      case OT_ARRAY:
-      case OT_TABLE: {
-        table_to_lisp(v, -1, entries);
-        break;
-      }
-      default:
-        std::cerr &lt;&lt; &quot;Unsupported value type in table\n&quot;;
-        break;
+  {
+    case OT_INTEGER: {
+      SQInteger val;
+      sq_getinteger(v, -1, &amp;val);
+      entries.push_back(new lisp::Lisp(static_cast&lt;int&gt;(val)));
+      break;
     }
+    case OT_FLOAT: {
+      float val;
+      sq_getfloat(v, -1, &amp;val);
+      entries.push_back(new lisp::Lisp(val));
+      break;
+    }
+    case OT_STRING: {
+      const char* str;
+      sq_getstring(v, -1, &amp;str);      
+      entries.push_back(new lisp::Lisp(lisp::Lisp::TYPE_STRING, str));
+      break;
+    }                                                    
+    case OT_BOOL: {
+      SQBool boolean;
+      sq_getbool(v, -1, &amp;boolean);
+      entries.push_back(new lisp::Lisp(static_cast&lt;bool&gt;(boolean)));
+      break;
+    }
+    case OT_ARRAY:
+    case OT_TABLE: {
+      table_to_lisp(v, -1, entries);
+      break;
+    }
+    default:
+      std::cerr &lt;&lt; &quot;Unsupported value type in table\n&quot;;
+      break;
+  }
 }
 
 void table_to_lisp(HSQUIRRELVM v, int idx, std::vector&lt;lisp::Lisp*&gt;&amp; entries)
@@ -85,231 +85,231 @@
   SQObjectType type = sq_gettype(v, idx);
 
   if (type != OT_TABLE &amp;&amp; type != OT_ARRAY)
-    {
-      print_squirrel_stack(v, &quot;table_to_lisp&quot;);
-      throw std::runtime_error(&quot;table_to_lisp: no table or array at the given index&quot;);
-    }
+  {
+    print_squirrel_stack(v, &quot;table_to_lisp&quot;);
+    throw std::runtime_error(&quot;table_to_lisp: no table or array at the given index&quot;);
+  }
   else
+  {
+    sq_push(v, idx);
+
+    // iterate table
+    sq_pushnull(v);
+    while (SQ_SUCCEEDED(sq_next(v, -2)))
     {
-      sq_push(v, idx);
-
-      // iterate table
-      sq_pushnull(v);
-      while (SQ_SUCCEEDED(sq_next(v, -2)))
+      if (type == OT_ARRAY)
+      {
+        sq_to_lisp(v, entries);
+      }
+      else if (type == OT_TABLE)
+      {
+        // table/array is -3, key is -2, value -1 now
+        if (sq_gettype(v, -2) != OT_STRING)
         {
-          if (type == OT_ARRAY)
-            {
-              sq_to_lisp(v, entries);
-            }
-          else if (type == OT_TABLE)
-            {
-              // table/array is -3, key is -2, value -1 now
-              if (sq_gettype(v, -2) != OT_STRING)
-                {
-                  std::cerr &lt;&lt; &quot;Table contains a non string key\n&quot;;
-                }
-              else
-                {
-                  const char* key = 0;
-                  sq_getstring(v, -2, &amp;key);
-                  std::string lisp_key = sq_to_lisp_string(key);
+          std::cerr &lt;&lt; &quot;Table contains a non string key\n&quot;;
+        }
+        else
+        {
+          const char* key = 0;
+          sq_getstring(v, -2, &amp;key);
+          std::string lisp_key = sq_to_lisp_string(key);
 
-                  std::vector&lt;lisp::Lisp*&gt; childs;
-                  childs.push_back(new lisp::Lisp(lisp::Lisp::TYPE_SYMBOL, lisp_key));
-                  sq_to_lisp(v, childs);
-                  entries.push_back(new lisp::Lisp(childs));
-                }
-            }
+          std::vector&lt;lisp::Lisp*&gt; childs;
+          childs.push_back(new lisp::Lisp(lisp::Lisp::TYPE_SYMBOL, lisp_key));
+          sq_to_lisp(v, childs);
+          entries.push_back(new lisp::Lisp(childs));
+        }
+      }
     
-          // pop key and value
-          sq_pop(v, 2);
-        }
-
-      // pop iterator and table
+      // pop key and value
       sq_pop(v, 2);
     }
+
+    // pop iterator and table
+    sq_pop(v, 2);
+  }
 }
 
 std::string squirrel2string(HSQUIRRELVM v, int i)
 {
   std::ostringstream os;
   switch(sq_gettype(v, i))
+  {
+    case OT_NULL:
+      os &lt;&lt; &quot;&lt;null&gt;&quot;;        
+      break;
+    case OT_BOOL: {
+      SQBool p;
+      sq_getbool(v, i, &amp;p);
+      if (p) 
+        os &lt;&lt; &quot;true&quot;;
+      else
+        os &lt;&lt; &quot;false&quot;;
+      break;
+    }
+    case OT_INTEGER: {
+      SQInteger val;
+      sq_getinteger(v, i, &amp;val);
+      os &lt;&lt; val;
+      break;
+    }
+    case OT_FLOAT: {
+      float val;
+      sq_getfloat(v, i, &amp;val);
+      os &lt;&lt; val;
+      break;
+    }
+    case OT_STRING: {
+      const char* val;
+      sq_getstring(v, i, &amp;val);
+      os &lt;&lt; &quot;\&quot;&quot; &lt;&lt; val &lt;&lt; &quot;\&quot;&quot;;
+      break;    
+    }
+    case OT_TABLE: {
+      bool first = true;
+      os &lt;&lt; &quot;{&quot;;
+      sq_pushnull(v);  //null iterator
+      while(SQ_SUCCEEDED(sq_next(v,i-1)))
+      {
+        if (!first)
+        {
+          os &lt;&lt; &quot;, \n&quot;;
+        }
+        first = false;
+
+        //here -1 is the value and -2 is the key
+        os &lt;&lt; squirrel2string(v, -2) &lt;&lt; &quot; =&gt; &quot; 
+           &lt;&lt; squirrel2string(v, -1);
+                              
+        sq_pop(v,2); //pops key and val before the nex iteration
+      }
+      sq_pop(v, 1);
+      os &lt;&lt; &quot;}&quot;;
+      break;
+    }
+    case OT_ARRAY: {
+      bool first = true;
+      os &lt;&lt; &quot;[&quot;;
+      sq_pushnull(v);  //null iterator
+      while(SQ_SUCCEEDED(sq_next(v,i-1)))
+      {
+        if (!first)
+        {
+          os &lt;&lt; &quot;, &quot;;
+        }
+        first = false;
+
+        //here -1 is the value and -2 is the key
+        // we ignore the key, since that is just the index in an array
+        os &lt;&lt; squirrel2string(v, -1);
+                              
+        sq_pop(v,2); //pops key and val before the nex iteration
+      }
+      sq_pop(v, 1);
+      os &lt;&lt; &quot;]&quot;;
+      break;
+    }
+    case OT_USERDATA:
+      os &lt;&lt; &quot;&lt;userdata&gt;&quot;;
+      break;
+    case OT_CLOSURE:        
+      os &lt;&lt; &quot;&lt;closure (function)&gt;&quot;;
+      break;
+    case OT_NATIVECLOSURE:
+      os &lt;&lt; &quot;&lt;native closure (C function)&gt;&quot;;
+      break;
+    case OT_GENERATOR:
+      os &lt;&lt; &quot;&lt;generator&gt;&quot;;
+      break;
+    case OT_USERPOINTER:
+      os &lt;&lt; &quot;userpointer&quot;;
+      break;
+    case OT_THREAD:
+      os &lt;&lt; &quot;&lt;thread&gt;&quot;;
+      break;
+    case OT_CLASS:
+      os &lt;&lt; &quot;&lt;class&gt;&quot;;
+      break;
+    case OT_INSTANCE:
+      os &lt;&lt; &quot;&lt;instance&gt;&quot;;
+      break;
+    default:
+      os &lt;&lt; &quot;&lt;unknown&gt;&quot;;
+      break;
+  }
+  return os.str();
+}
+
+void print_squirrel_stack(HSQUIRRELVM v, const std::string&amp; context)
+{
+  if (context.empty())
+    printf(&quot;,-------------------------------------------------------------\n&quot;);
+  else
+    printf(&quot;,-------------[ %s ]---------------------------------------\n&quot;, context.c_str());
+
+  int count = sq_gettop(v);
+  for(int i = 1; i &lt;= count; ++i) 
+  {
+    printf(&quot;| %d: &quot;,i);
+    switch(sq_gettype(v, i))
     {
       case OT_NULL:
-        os &lt;&lt; &quot;&lt;null&gt;&quot;;        
+        printf(&quot;null&quot;);        
         break;
-      case OT_BOOL: {
-        SQBool p;
-        sq_getbool(v, i, &amp;p);
-        if (p) 
-          os &lt;&lt; &quot;true&quot;;
-        else
-          os &lt;&lt; &quot;false&quot;;
-        break;
-      }
       case OT_INTEGER: {
         SQInteger val;
         sq_getinteger(v, i, &amp;val);
-        os &lt;&lt; val;
+        printf(&quot;integer (%d)&quot;, static_cast&lt;int&gt;(val));
         break;
       }
       case OT_FLOAT: {
         float val;
         sq_getfloat(v, i, &amp;val);
-        os &lt;&lt; val;
+        printf(&quot;float (%f)&quot;, val);
         break;
       }
       case OT_STRING: {
         const char* val;
         sq_getstring(v, i, &amp;val);
-        os &lt;&lt; &quot;\&quot;&quot; &lt;&lt; val &lt;&lt; &quot;\&quot;&quot;;
+        printf(&quot;string (%s)&quot;, val);
         break;    
       }
-      case OT_TABLE: {
-        bool first = true;
-        os &lt;&lt; &quot;{&quot;;
-        sq_pushnull(v);  //null iterator
-        while(SQ_SUCCEEDED(sq_next(v,i-1)))
-          {
-            if (!first)
-              {
-                os &lt;&lt; &quot;, \n&quot;;
-              }
-            first = false;
-
-            //here -1 is the value and -2 is the key
-            os &lt;&lt; squirrel2string(v, -2) &lt;&lt; &quot; =&gt; &quot; 
-               &lt;&lt; squirrel2string(v, -1);
-                              
-            sq_pop(v,2); //pops key and val before the nex iteration
-          }
-        sq_pop(v, 1);
-        os &lt;&lt; &quot;}&quot;;
+      case OT_TABLE:
+        printf(&quot;table&quot;);
         break;
-      }
-      case OT_ARRAY: {
-        bool first = true;
-        os &lt;&lt; &quot;[&quot;;
-        sq_pushnull(v);  //null iterator
-        while(SQ_SUCCEEDED(sq_next(v,i-1)))
-          {
-            if (!first)
-              {
-                os &lt;&lt; &quot;, &quot;;
-              }
-            first = false;
-
-            //here -1 is the value and -2 is the key
-            // we ignore the key, since that is just the index in an array
-            os &lt;&lt; squirrel2string(v, -1);
-                              
-            sq_pop(v,2); //pops key and val before the nex iteration
-          }
-        sq_pop(v, 1);
-        os &lt;&lt; &quot;]&quot;;
+      case OT_ARRAY:
+        printf(&quot;array&quot;);
         break;
-      }
       case OT_USERDATA:
-        os &lt;&lt; &quot;&lt;userdata&gt;&quot;;
+        printf(&quot;userdata&quot;);
         break;
       case OT_CLOSURE:        
-        os &lt;&lt; &quot;&lt;closure (function)&gt;&quot;;
+        printf(&quot;closure(function)&quot;);    
         break;
       case OT_NATIVECLOSURE:
-        os &lt;&lt; &quot;&lt;native closure (C function)&gt;&quot;;
+        printf(&quot;native closure(C function)&quot;);
         break;
       case OT_GENERATOR:
-        os &lt;&lt; &quot;&lt;generator&gt;&quot;;
+        printf(&quot;generator&quot;);
         break;
       case OT_USERPOINTER:
-        os &lt;&lt; &quot;userpointer&quot;;
+        printf(&quot;userpointer&quot;);
         break;
       case OT_THREAD:
-        os &lt;&lt; &quot;&lt;thread&gt;&quot;;
+        printf(&quot;thread&quot;);
         break;
       case OT_CLASS:
-        os &lt;&lt; &quot;&lt;class&gt;&quot;;
+        printf(&quot;class&quot;);
         break;
       case OT_INSTANCE:
-        os &lt;&lt; &quot;&lt;instance&gt;&quot;;
+        printf(&quot;instance&quot;);
         break;
       default:
-        os &lt;&lt; &quot;&lt;unknown&gt;&quot;;
+        printf(&quot;unknown?!?&quot;);
         break;
     }
-  return os.str();
-}
-
-void print_squirrel_stack(HSQUIRRELVM v, const std::string&amp; context)
-{
-  if (context.empty())
-    printf(&quot;,-------------------------------------------------------------\n&quot;);
-  else
-    printf(&quot;,-------------[ %s ]---------------------------------------\n&quot;, context.c_str());
-
-  int count = sq_gettop(v);
-  for(int i = 1; i &lt;= count; ++i) 
-    {
-      printf(&quot;| %d: &quot;,i);
-      switch(sq_gettype(v, i))
-        {
-          case OT_NULL:
-            printf(&quot;null&quot;);        
-            break;
-          case OT_INTEGER: {
-            SQInteger val;
-            sq_getinteger(v, i, &amp;val);
-            printf(&quot;integer (%d)&quot;, static_cast&lt;int&gt;(val));
-            break;
-          }
-          case OT_FLOAT: {
-            float val;
-            sq_getfloat(v, i, &amp;val);
-            printf(&quot;float (%f)&quot;, val);
-            break;
-          }
-          case OT_STRING: {
-            const char* val;
-            sq_getstring(v, i, &amp;val);
-            printf(&quot;string (%s)&quot;, val);
-            break;    
-          }
-          case OT_TABLE:
-            printf(&quot;table&quot;);
-            break;
-          case OT_ARRAY:
-            printf(&quot;array&quot;);
-            break;
-          case OT_USERDATA:
-            printf(&quot;userdata&quot;);
-            break;
-          case OT_CLOSURE:        
-            printf(&quot;closure(function)&quot;);    
-            break;
-          case OT_NATIVECLOSURE:
-            printf(&quot;native closure(C function)&quot;);
-            break;
-          case OT_GENERATOR:
-            printf(&quot;generator&quot;);
-            break;
-          case OT_USERPOINTER:
-            printf(&quot;userpointer&quot;);
-            break;
-          case OT_THREAD:
-            printf(&quot;thread&quot;);
-            break;
-          case OT_CLASS:
-            printf(&quot;class&quot;);
-            break;
-          case OT_INSTANCE:
-            printf(&quot;instance&quot;);
-            break;
-          default:
-            printf(&quot;unknown?!?&quot;);
-            break;
-        }
-      printf(&quot;\n&quot;);
-    }
+    printf(&quot;\n&quot;);
+  }
   printf(&quot;'-------------------------------------------------------------\n&quot;);
 }
 
@@ -320,41 +320,41 @@
   Properties props(lisp);
   PropertyIterator&lt;const lisp::Lisp*&gt; iter = props.get_iter();
   while(iter.next())
+  {
+    sq_pushstring(v, iter.item().c_str(), iter.item().size());
+    switch((*iter)-&gt;get_type())
     {
-      sq_pushstring(v, iter.item().c_str(), iter.item().size());
-      switch((*iter)-&gt;get_type())
-        {
-          case lisp::Lisp::TYPE_LIST:
-            sq_newtable(v);
-            load_squirrel_table(v, sq_gettop(v), *iter);
-            break;
-          case lisp::Lisp::TYPE_INT:
-            sq_pushinteger(v, (*iter)-&gt;get_int());
-            break;
-          case lisp::Lisp::TYPE_FLOAT:
-            sq_pushfloat(v, (*iter)-&gt;get_float());
-            break;
-          case lisp::Lisp::TYPE_STRING:
-            sq_pushstring(v, (*iter)-&gt;get_string(), -1);
-            break;
-          case lisp::Lisp::TYPE_BOOL:
-            sq_pushbool(v, (*iter)-&gt;get_bool());
-            break;
-          case lisp::Lisp::TYPE_SYMBOL:
-            std::cerr &lt;&lt; &quot;Unexpected symbol in lisp file...&quot;;
-            sq_pushnull(v);
-            break;
-          default:
-            assert(false);
-            break;
-        }
-      if (table_idx &lt; 0)
-        {
-          sq_createslot(v, table_idx - 2);
-        } else {
-        sq_createslot(v, table_idx);
-      }
+      case lisp::Lisp::TYPE_LIST:
+        sq_newtable(v);
+        load_squirrel_table(v, sq_gettop(v), *iter);
+        break;
+      case lisp::Lisp::TYPE_INT:
+        sq_pushinteger(v, (*iter)-&gt;get_int());
+        break;
+      case lisp::Lisp::TYPE_FLOAT:
+        sq_pushfloat(v, (*iter)-&gt;get_float());
+        break;
+      case lisp::Lisp::TYPE_STRING:
+        sq_pushstring(v, (*iter)-&gt;get_string(), -1);
+        break;
+      case lisp::Lisp::TYPE_BOOL:
+        sq_pushbool(v, (*iter)-&gt;get_bool());
+        break;
+      case lisp::Lisp::TYPE_SYMBOL:
+        std::cerr &lt;&lt; &quot;Unexpected symbol in lisp file...&quot;;
+        sq_pushnull(v);
+        break;
+      default:
+        assert(false);
+        break;
     }
+    if (table_idx &lt; 0)
+    {
+      sq_createslot(v, table_idx - 2);
+    } else {
+      sq_createslot(v, table_idx);
+    }
+  }
 }
 
 void load_squirrel_table(HSQUIRRELVM v, int table_idx, const std::string&amp; file)
@@ -379,57 +379,57 @@
   //iterator table
   sq_pushnull(v);
   while(SQ_SUCCEEDED(sq_next(v, table_idx)))
+  {
+    if (sq_gettype(v, -2) != OT_STRING)
     {
-      if (sq_gettype(v, -2) != OT_STRING)
-        {
-          std::cerr &lt;&lt; &quot;Table contains non-string key\n&quot;;
-          continue;
-        }
-      const char* key;
-      sq_getstring(v, -2, &amp;key);
+      std::cerr &lt;&lt; &quot;Table contains non-string key\n&quot;;
+      continue;
+    }
+    const char* key;
+    sq_getstring(v, -2, &amp;key);
 
-      switch(sq_gettype(v, -1))
-        {
-          case OT_INTEGER: {
-            SQInteger val;
-            sq_getinteger(v, -1, &amp;val);
-            writer.write_int(key, val);
-            break;
-          }
-          case OT_FLOAT: {
-            float val;
-            sq_getfloat(v, -1, &amp;val);
-            writer.write_float(key, val);
-            break;
-          }
-          case OT_BOOL: {
-            SQBool val;
-            sq_getbool(v, -1, &amp;val);
-            writer.write_bool(key, val);
-            break;
-          }
-          case OT_STRING: {
-            const char* str;
-            sq_getstring(v, -1, &amp;str);
-            writer.write_string(key, str);
-            break;
-          }
-          case OT_TABLE: {
-            writer.start_list(key);
-            save_squirrel_table(v, -1, writer);
-            writer.end_list(key);
-            break;
-          }
-          case OT_CLOSURE:
-            break; // ignore
-          case OT_NATIVECLOSURE:
-            break;
-          default:
-            std::cerr &lt;&lt; &quot;Can't serialize key '&quot; &lt;&lt; key &lt;&lt; &quot;' in table.\n&quot;;
-            break;
-        }
-      sq_pop(v, 2);
+    switch(sq_gettype(v, -1))
+    {
+      case OT_INTEGER: {
+        SQInteger val;
+        sq_getinteger(v, -1, &amp;val);
+        writer.write_int(key, val);
+        break;
+      }
+      case OT_FLOAT: {
+        float val;
+        sq_getfloat(v, -1, &amp;val);
+        writer.write_float(key, val);
+        break;
+      }
+      case OT_BOOL: {
+        SQBool val;
+        sq_getbool(v, -1, &amp;val);
+        writer.write_bool(key, val);
+        break;
+      }
+      case OT_STRING: {
+        const char* str;
+        sq_getstring(v, -1, &amp;str);
+        writer.write_string(key, str);
+        break;
+      }
+      case OT_TABLE: {
+        writer.start_list(key);
+        save_squirrel_table(v, -1, writer);
+        writer.end_list(key);
+        break;
+      }
+      case OT_CLOSURE:
+        break; // ignore
+      case OT_NATIVECLOSURE:
+        break;
+      default:
+        std::cerr &lt;&lt; &quot;Can't serialize key '&quot; &lt;&lt; key &lt;&lt; &quot;' in table.\n&quot;;
+        break;
     }
+    sq_pop(v, 2);
+  }
   sq_pop(v, 1);
 }
 

Modified: trunk/windstille/src/sound/sound_channel.cpp
===================================================================
--- trunk/windstille/src/sound/sound_channel.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sound/sound_channel.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -50,13 +50,13 @@
   switch(type)
   {
     case kStreamSoundSource:
-      {
-        SoundSourcePtr source(new StreamSoundSource(*this, sound_file));
-        source-&gt;update_gain();
-        m_sound_sources.push_back(SoundSourcePtr(source));
-        return source;
-      }
-      break;
+    {
+      SoundSourcePtr source(new StreamSoundSource(*this, sound_file));
+      source-&gt;update_gain();
+      m_sound_sources.push_back(SoundSourcePtr(source));
+      return source;
+    }
+    break;
 
     case kStaticSoundSource:
       // FIXME: not implemented

Modified: trunk/windstille/src/sound/sound_manager.cpp
===================================================================
--- trunk/windstille/src/sound/sound_manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sound/sound_manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -143,31 +143,31 @@
     switch(type)
     {
       case kStaticSoundSource:
+      {
+        ALuint buffer;
+  
+        // reuse an existing static sound buffer            
+        SoundBuffers::iterator i = m_buffers.find(filename);
+        if (i != m_buffers.end()) 
         {
-          ALuint buffer;
-  
-          // reuse an existing static sound buffer            
-          SoundBuffers::iterator i = m_buffers.find(filename);
-          if (i != m_buffers.end()) 
-          {
-            buffer = i-&gt;second;
-          } 
-          else 
-          {
-            buffer = load_file_into_buffer(filename);
-            m_buffers.insert(std::make_pair(filename, buffer));
-          }
-
-          return SoundSourcePtr(new StaticSoundSource(channel, buffer));
+          buffer = i-&gt;second;
+        } 
+        else 
+        {
+          buffer = load_file_into_buffer(filename);
+          m_buffers.insert(std::make_pair(filename, buffer));
         }
-        break;
 
+        return SoundSourcePtr(new StaticSoundSource(channel, buffer));
+      }
+      break;
+
       case kStreamSoundSource:
-        {
-          std::auto_ptr&lt;SoundFile&gt; sound_file = SoundFile::load(filename);
-          return SoundSourcePtr(new StreamSoundSource(channel, sound_file));
-        }
-        break;
+      {
+        std::auto_ptr&lt;SoundFile&gt; sound_file = SoundFile::load(filename);
+        return SoundSourcePtr(new StreamSoundSource(channel, sound_file));
+      }
+      break;
 
       default:
         assert(!&quot;never reached&quot;);

Modified: trunk/windstille/src/sprite2d/data.cpp
===================================================================
--- trunk/windstille/src/sprite2d/data.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sprite2d/data.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -23,8 +23,8 @@
 
 #include &quot;display/surface_manager.hpp&quot;
 
-SpriteData::SpriteData(const Pathname&amp; pathname)
-  : actions()
+SpriteData::SpriteData(const Pathname&amp; pathname) :
+  actions()
 {
   if (pathname.exists())
   {
@@ -123,43 +123,43 @@
   FileReader grid_reader;
   std::vector&lt;std::string&gt; image_files;
   if(reader.get(&quot;images&quot;, image_files))
+  {
+    //parse_images(action.get(), dir, images);
+
+    for(std::vector&lt;std::string&gt;::iterator file = image_files.begin(); file != image_files.end(); ++file)
     {
-      //parse_images(action.get(), dir, images);
-
-      for(std::vector&lt;std::string&gt;::iterator file = image_files.begin(); file != image_files.end(); ++file)
-        {
-          Pathname path = dir;
-          path.append_path(*file);
-          action-&gt;surfaces.push_back(SurfaceManager::current()-&gt;get(path));
-        }
+      Pathname path = dir;
+      path.append_path(*file);
+      action-&gt;surfaces.push_back(SurfaceManager::current()-&gt;get(path));
     }
+  }
   else if(reader.get(&quot;image-grid&quot;, grid_reader)) 
-    {
-      std::string filename;
-      int x_size = -1;
-      int y_size = -1;
+  {
+    std::string filename;
+    int x_size = -1;
+    int y_size = -1;
       
-      grid_reader.get(&quot;file&quot;, filename);
-      grid_reader.get(&quot;x-size&quot;, x_size);
-      grid_reader.get(&quot;y-size&quot;, y_size);
+    grid_reader.get(&quot;file&quot;, filename);
+    grid_reader.get(&quot;x-size&quot;, x_size);
+    grid_reader.get(&quot;y-size&quot;, y_size);
 
-      if(filename.empty() || x_size &lt;= 0 || y_size &lt;= 0)
-        throw std::runtime_error(&quot;Invalid or too few data in image-grid&quot;);
+    if(filename.empty() || x_size &lt;= 0 || y_size &lt;= 0)
+      throw std::runtime_error(&quot;Invalid or too few data in image-grid&quot;);
       
-      Pathname path = dir;
-      path.append_path(filename);
-      SurfaceManager::current()-&gt;load_grid(path, action-&gt;surfaces, x_size, y_size);
-    }
+    Pathname path = dir;
+    path.append_path(filename);
+    SurfaceManager::current()-&gt;load_grid(path, action-&gt;surfaces, x_size, y_size);
+  }
     
   if(action-&gt;name == &quot;&quot;)
     throw std::runtime_error(&quot;No Name defined for action&quot;);
 
   if(action-&gt;surfaces.size() == 0) 
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;Action '&quot; &lt;&lt; action-&gt;name &lt;&lt; &quot;' contains no images&quot;;
-      throw std::runtime_error(msg.str());
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;Action '&quot; &lt;&lt; action-&gt;name &lt;&lt; &quot;' contains no images&quot;;
+    throw std::runtime_error(msg.str());
+  }
   return action.release();
 }
  

Modified: trunk/windstille/src/sprite2d/manager.cpp
===================================================================
--- trunk/windstille/src/sprite2d/manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sprite2d/manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -21,8 +21,8 @@
 
 #include &quot;sprite2d/data.hpp&quot;
 
-SpriteManager::SpriteManager()
-  : datas()
+SpriteManager::SpriteManager() :
+  datas()
 {
 }
 
@@ -35,27 +35,27 @@
 {
   Datas::iterator i = datas.find(filename);
   if(i != datas.end())
-    {
-      return i-&gt;second;
-    }
+  {
+    return i-&gt;second;
+  }
   else
-    {  
-      SpriteDataPtr data(new SpriteData(filename));
-      datas.insert(std::make_pair(filename, data));
-      return data;
-    }
+  {  
+    SpriteDataPtr data(new SpriteData(filename));
+    datas.insert(std::make_pair(filename, data));
+    return data;
+  }
 }
 
 void
 SpriteManager::cleanup()
 {
   for(Datas::iterator i = datas.begin(); i != datas.end(); ++i)
+  {
+    if (i-&gt;second.use_count() == 1)
     {
-      if (i-&gt;second.use_count() == 1)
-        {
-          datas.erase(i);
-        }
+      datas.erase(i);
     }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/sprite2d/sprite.cpp
===================================================================
--- trunk/windstille/src/sprite2d/sprite.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sprite2d/sprite.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,33 +24,33 @@
 #include &quot;sprite2d/data.hpp&quot;
 #include &quot;display/surface_drawing_parameters.hpp&quot;
 
-Sprite::Sprite()
-  : data(),
-    current_action(0),
-    frame(0),
-    speed(0),
-    pingpong(),
-    reverse(),
-    vflip(),
-    blend_sfactor(),
-    blend_dfactor(),
-    scale(),
-    color()
+Sprite::Sprite() :
+  data(),
+  current_action(0),
+  frame(0),
+  speed(0),
+  pingpong(),
+  reverse(),
+  vflip(),
+  blend_sfactor(),
+  blend_dfactor(),
+  scale(),
+  color()
 {
 }
 
-Sprite::Sprite(const Pathname&amp; filename)
-  : data(),
-    current_action(0),
-    frame(0),
-    speed(0),
-    pingpong(),
-    reverse(),
-    vflip(),
-    blend_sfactor(),
-    blend_dfactor(),
-    scale(),
-    color()
+Sprite::Sprite(const Pathname&amp; filename) :
+  data(),
+  current_action(0),
+  frame(0),
+  speed(0),
+  pingpong(),
+  reverse(),
+  vflip(),
+  blend_sfactor(),
+  blend_dfactor(),
+  scale(),
+  color()
 {
   data = SpriteManager::current()-&gt;create_data(filename);
 
@@ -66,18 +66,18 @@
   blend_dfactor = GL_ONE_MINUS_SRC_ALPHA;
 }
 
-Sprite::Sprite(const SpriteDataPtr data_)
-  : data(data_),
-    current_action(0),
-    frame(0),
-    speed(0),
-    pingpong(),
-    reverse(),
-    vflip(),
-    blend_sfactor(),
-    blend_dfactor(),
-    scale(),
-    color()
+Sprite::Sprite(const SpriteDataPtr data_) :
+  data(data_),
+  current_action(0),
+  frame(0),
+  speed(0),
+  pingpong(),
+  reverse(),
+  vflip(),
+  blend_sfactor(),
+  blend_dfactor(),
+  scale(),
+  color()
 {
   current_action = data-&gt;actions[0];
   vflip = false;
@@ -91,18 +91,18 @@
   blend_dfactor = GL_ONE_MINUS_SRC_ALPHA;
 }
 
-Sprite::Sprite(const Sprite&amp; rhs)
-  : data(rhs.data),
-    current_action(rhs.current_action),
-    frame(rhs.frame),
-    speed(rhs.speed),
-    pingpong(rhs.pingpong),
-    reverse(rhs.reverse),
-    vflip(rhs.vflip),
-    blend_sfactor(rhs.blend_sfactor),
-    blend_dfactor(rhs.blend_dfactor),
-    scale(rhs.scale),
-    color(rhs.color)
+Sprite::Sprite(const Sprite&amp; rhs) :
+  data(rhs.data),
+  current_action(rhs.current_action),
+  frame(rhs.frame),
+  speed(rhs.speed),
+  pingpong(rhs.pingpong),
+  reverse(rhs.reverse),
+  vflip(rhs.vflip),
+  blend_sfactor(rhs.blend_sfactor),
+  blend_dfactor(rhs.blend_dfactor),
+  scale(rhs.scale),
+  color(rhs.color)
 {
 }
 
@@ -146,24 +146,24 @@
 {
   for(SpriteData::Actions::const_iterator i = data-&gt;actions.begin();
       i != data-&gt;actions.end(); ++i) 
+  {
+    const SpriteAction* action = *i;
+    if(action-&gt;name == name) 
     {
-      const SpriteAction* action = *i;
-      if(action-&gt;name == name) 
-        {
-          // FIXME: This should be per-action and not get reset, shouldn't they?
-          current_action = action;
-          pingpong = false;
-          reverse  = false;
-          speed    = 1.0;
-          frame    = 0;
-          vflip    = false;
-          scale    = current_action-&gt;scale;
-          color    = Color(1.0f, 1.0f, 1.0f);
-          blend_sfactor = GL_SRC_ALPHA;
-          blend_dfactor = GL_ONE_MINUS_SRC_ALPHA;
-          return;
-        }
+      // FIXME: This should be per-action and not get reset, shouldn't they?
+      current_action = action;
+      pingpong = false;
+      reverse  = false;
+      speed    = 1.0;
+      frame    = 0;
+      vflip    = false;
+      scale    = current_action-&gt;scale;
+      color    = Color(1.0f, 1.0f, 1.0f);
+      blend_sfactor = GL_SRC_ALPHA;
+      blend_dfactor = GL_ONE_MINUS_SRC_ALPHA;
+      return;
     }
+  }
 
   std::ostringstream msg;
   msg &lt;&lt; &quot;No action '&quot; &lt;&lt; name &lt;&lt; &quot;' defined&quot;;

Modified: trunk/windstille/src/sprite3d/manager.cpp
===================================================================
--- trunk/windstille/src/sprite3d/manager.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sprite3d/manager.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -22,8 +22,8 @@
 
 namespace sprite3d {
 
-Manager::Manager()
-  : datas()
+Manager::Manager() :
+  datas()
 {
 }
 

Modified: trunk/windstille/src/sprite3d/sprite3d.cpp
===================================================================
--- trunk/windstille/src/sprite3d/sprite3d.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/sprite3d/sprite3d.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -27,31 +27,31 @@
 
 using namespace sprite3d;
 
-Sprite3D::Sprite3D()
-  : data(0), 
-    actions_switched(false),
-    frame1(),
-    frame2(),
-    blend_time(0.0f),
-    next_frame(),
-    next_action(),
-    abort_at_frame(),
-    blend_sfactor(GL_ONE),
-    blend_dfactor(GL_ZERO)
+Sprite3D::Sprite3D() :
+  data(0), 
+  actions_switched(false),
+  frame1(),
+  frame2(),
+  blend_time(0.0f),
+  next_frame(),
+  next_action(),
+  abort_at_frame(),
+  blend_sfactor(GL_ONE),
+  blend_dfactor(GL_ZERO)
 {
 }
 
-Sprite3D::Sprite3D(const Pathname&amp; filename)
-  : data(sprite3d::Manager::current()-&gt;create_data(filename)),
-    actions_switched(false),
-    frame1(),
-    frame2(),
-    blend_time(0.0f),
-    next_frame(),
-    next_action(),
-    abort_at_frame(),
-    blend_sfactor(GL_ONE),
-    blend_dfactor(GL_ZERO)
+Sprite3D::Sprite3D(const Pathname&amp; filename) :
+  data(sprite3d::Manager::current()-&gt;create_data(filename)),
+  actions_switched(false),
+  frame1(),
+  frame2(),
+  blend_time(0.0f),
+  next_frame(),
+  next_action(),
+  abort_at_frame(),
+  blend_sfactor(GL_ONE),
+  blend_dfactor(GL_ZERO)
 {
   frame1.action         = &amp;data-&gt;actions[0];
   frame1.frame          = 0;
@@ -63,17 +63,17 @@
   next_action.action    = 0;
 }
 
-Sprite3D::Sprite3D(const Sprite3D&amp; rhs)
-  : data(rhs.data),
-    actions_switched(rhs.actions_switched),
-    frame1(rhs.frame1),
-    frame2(rhs.frame2),
-    blend_time(rhs.blend_time),
-    next_frame(rhs.next_frame),
-    next_action(rhs.next_action),
-    abort_at_frame(rhs.abort_at_frame),
-    blend_sfactor(rhs.blend_sfactor),
-    blend_dfactor(rhs.blend_dfactor)
+Sprite3D::Sprite3D(const Sprite3D&amp; rhs) :
+  data(rhs.data),
+  actions_switched(rhs.actions_switched),
+  frame1(rhs.frame1),
+  frame2(rhs.frame2),
+  blend_time(rhs.blend_time),
+  next_frame(rhs.next_frame),
+  next_action(rhs.next_action),
+  abort_at_frame(rhs.abort_at_frame),
+  blend_sfactor(rhs.blend_sfactor),
+  blend_dfactor(rhs.blend_dfactor)
 {
 }
 
@@ -134,9 +134,9 @@
   for(std::vector&lt;Action&gt;::const_iterator i = data-&gt;actions.begin(); 
       i != data-&gt;actions.end(); 
       ++i)
-    {
-      actions.push_back(i-&gt;name);
-    }
+  {
+    actions.push_back(i-&gt;name);
+  }
   return actions;
 }
 
@@ -207,10 +207,10 @@
 {
   if ((speed &lt;  0.0f &amp;&amp; frame1.speed &gt;= 0.0f) ||
       (speed &gt;= 0.0f &amp;&amp; frame1.speed &lt;  0.0f)) 
-    {
-      blend_time = 1.0f - blend_time;
-      std::swap(frame1, frame2);
-    }
+  {
+    blend_time = 1.0f - blend_time;
+    std::swap(frame1, frame2);
+  }
 
   frame1.speed = speed;
   frame2.speed = speed;
@@ -247,9 +247,9 @@
 Sprite3D::get_attachment_point_matrix(PointID id) const
 {
   const AttachmentPointPosition&amp; point1 
-	  = frame1.action-&gt;frames[frame1.frame].attachment_points[id];
+    = frame1.action-&gt;frames[frame1.frame].attachment_points[id];
   const AttachmentPointPosition&amp; point2 
-	  = frame2.action-&gt;frames[frame2.frame].attachment_points[id];
+    = frame2.action-&gt;frames[frame2.frame].attachment_points[id];
 
   Quaternion rotquat = Quaternion(0, 0, 1, 0);
   Quaternion quat1 = point1.quat;

Modified: trunk/windstille/src/tile/tile.cpp
===================================================================
--- trunk/windstille/src/tile/tile.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/tile/tile.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -18,13 +18,13 @@
 
 #include &quot;tile/tile.hpp&quot;
 
-Tile::Tile(unsigned int arg_colmap)
-  : id(),
-    packer(-1),
-    uv(),
-    texture(),
-    colmap(arg_colmap),
-    desc(0)
+Tile::Tile(unsigned int arg_colmap) :
+  id(),
+  packer(-1),
+  uv(),
+  texture(),
+  colmap(arg_colmap),
+  desc(0)
 {
 }
 

Modified: trunk/windstille/src/tile/tile_description.cpp
===================================================================
--- trunk/windstille/src/tile/tile_description.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/tile/tile_description.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -24,12 +24,12 @@
 #include &quot;math/rect.hpp&quot;
 #include &quot;tile/tile_factory.hpp&quot;
 
-TileDescription::TileDescription(FileReader&amp; props)
- : ids(),
-   colmap(),
-   filename(),
-   width(0), 
-   height(0)
+TileDescription::TileDescription(FileReader&amp; props) :
+  ids(),
+  colmap(),
+  filename(),
+  width(0), 
+  height(0)
 {
   props.get(&quot;ids&quot;,    ids);
   props.get(&quot;image&quot;,  filename);
@@ -49,35 +49,35 @@
 
   int num_tiles = width * height; //(image-&gt;w/TILE_RESOLUTION) * (image-&gt;h/TILE_RESOLUTION);
   if (int(colmap.size()) != num_tiles)
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;'colmap' information and num_tiles mismatch (&quot; 
-          &lt;&lt; colmap.size() &lt;&lt; &quot; != &quot; &lt;&lt; num_tiles &lt;&lt; &quot;) for image '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot;;
-      throw std::runtime_error(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;'colmap' information and num_tiles mismatch (&quot; 
+        &lt;&lt; colmap.size() &lt;&lt; &quot; != &quot; &lt;&lt; num_tiles &lt;&lt; &quot;) for image '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot;;
+    throw std::runtime_error(str.str());
+  }
 
   if (int(ids.size()) != num_tiles)
-    {
-      std::ostringstream str;
-      str &lt;&lt; &quot;'ids' information and num_tiles mismatch (&quot; 
-          &lt;&lt; ids.size() &lt;&lt; &quot; != &quot; &lt;&lt; num_tiles &lt;&lt; &quot;) for image '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot;;
-      throw std::runtime_error(str.str());
-    }
+  {
+    std::ostringstream str;
+    str &lt;&lt; &quot;'ids' information and num_tiles mismatch (&quot; 
+        &lt;&lt; ids.size() &lt;&lt; &quot; != &quot; &lt;&lt; num_tiles &lt;&lt; &quot;) for image '&quot; &lt;&lt; filename &lt;&lt; &quot;'&quot;;
+    throw std::runtime_error(str.str());
+  }
     
   int i = 0;
   for (int y = 0; y &lt; height*TILE_RESOLUTION; y += TILE_RESOLUTION)
+  {
+    for (int x = 0; x &lt; width*TILE_RESOLUTION; x += TILE_RESOLUTION)
     {
-      for (int x = 0; x &lt; width*TILE_RESOLUTION; x += TILE_RESOLUTION)
-        {
-          if(ids[i] != -1)
-            {
-              factory-&gt;pack(ids[i], colmap[i], image,
-                            Rect(x, y, x+TILE_RESOLUTION, y+TILE_RESOLUTION));
-            }
+      if(ids[i] != -1)
+      {
+        factory-&gt;pack(ids[i], colmap[i], image,
+                      Rect(x, y, x+TILE_RESOLUTION, y+TILE_RESOLUTION));
+      }
 
-          i += 1; 
-        }
+      i += 1; 
     }
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/tile/tile_factory.cpp
===================================================================
--- trunk/windstille/src/tile/tile_factory.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/tile/tile_factory.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -33,21 +33,21 @@
   
   for(int y = sy; y &lt; sy + h; ++y)
     for(int x = sx; x &lt; sx + w; ++x)
-      {
-        if (data[y * image.get_pitch() + 4*x + 3] != 0)
-          { 
-            return false;
-          }
+    {
+      if (data[y * image.get_pitch() + 4*x + 3] != 0)
+      { 
+        return false;
       }
+    }
 
   return true;
 }
 
-TileFactory::TileFactory(const Pathname&amp; filename)
-  : tiles(),
-    packers(),
-    color_packer(),
-    descriptions()
+TileFactory::TileFactory(const Pathname&amp; filename) :
+  tiles(),
+  packers(),
+  color_packer(),
+  descriptions()
 {
   packers.push_back(new TilePacker(1024, 1024));
   packers.push_back(new TilePacker(1024, 1024));
@@ -55,21 +55,21 @@
 
   FileReader reader = FileReader::parse(filename);
   if(reader.get_name() != &quot;windstille-tiles&quot;)
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille tiles file&quot;;
-      throw std::runtime_error(msg.str());
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;' is not a windstille tiles file&quot;;
+    throw std::runtime_error(msg.str());
+  }
   
   std::vector&lt;FileReader&gt; sections = reader.get_sections();
   for(std::vector&lt;FileReader&gt;::iterator i = sections.begin(); i != sections.end(); ++i)
-    {
-      if (i-&gt;get_name() == &quot;tiles&quot;) {
-        parse_tiles(*i);
-      } else if (i-&gt;get_name() == &quot;tilegroup&quot;) {
-        // ignore
-      }
+  {
+    if (i-&gt;get_name() == &quot;tiles&quot;) {
+      parse_tiles(*i);
+    } else if (i-&gt;get_name() == &quot;tilegroup&quot;) {
+      // ignore
     }
+  }
 }
 
 TileFactory::~TileFactory()
@@ -95,25 +95,25 @@
   TileDescription&amp; desc = *descriptions.back();
   
   if (0)
-    { // Load all on startup
-      desc.load(this);
-    }
+  { // Load all on startup
+    desc.load(this);
+  }
   else
-    { // Load on demand
-      for(std::vector&lt;int&gt;::size_type i = 0; i &lt; desc.ids.size(); ++i)
-        { 
-          int&amp; id = desc.ids[i];
-          if (id != 0)
-            {
-              if (id &gt;= int(tiles.size()))
-                tiles.resize(id + 1, 0);
+  { // Load on demand
+    for(std::vector&lt;int&gt;::size_type i = 0; i &lt; desc.ids.size(); ++i)
+    { 
+      int&amp; id = desc.ids[i];
+      if (id != 0)
+      {
+        if (id &gt;= int(tiles.size()))
+          tiles.resize(id + 1, 0);
     
-              delete tiles[id];
-              tiles[id] = new Tile(desc.colmap[i]);
-              tiles[id]-&gt;desc = &desc;
-            }
-        }
+        delete tiles[id];
+        tiles[id] = new Tile(desc.colmap[i]);
+        tiles[id]-&gt;desc = &desc;
+      }
     }
+  }
 }
 
 void
@@ -122,51 +122,51 @@
   if(id &lt; int(tiles.size())
      &amp;&amp; tiles[id] != 0
      &amp;&amp; tiles[id]-&gt;desc == 0)
-    {
-      std::cout &lt;&lt; &quot;Warning: Duplicate tile id '&quot; &lt;&lt; id &lt;&lt; &quot;' ignoring&quot; &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;Warning: Duplicate tile id '&quot; &lt;&lt; id &lt;&lt; &quot;' ignoring&quot; &lt;&lt; std::endl;
+  }
   else
-    {      
-      if (id &gt;= int(tiles.size()))
-        tiles.resize(id + 1, 0);
+  {      
+    if (id &gt;= int(tiles.size()))
+      tiles.resize(id + 1, 0);
 
-      delete tiles[id];
-      tiles[id]  = new Tile(colmap);
-      tiles[id]-&gt;desc  = 0;
-      tiles[id]-&gt;id    = id;
+    delete tiles[id];
+    tiles[id]  = new Tile(colmap);
+    tiles[id]-&gt;desc  = 0;
+    tiles[id]-&gt;id    = id;
 
-      if (!surface_empty(image, rect.left, rect.top, rect.get_width(), rect.get_height()))
-        {
-          if(packers[color_packer]-&gt;is_full())
-            {
-              packers.push_back(new TilePacker(1024, 1024));
-              color_packer = packers.size() - 1;
-            }
+    if (!surface_empty(image, rect.left, rect.top, rect.get_width(), rect.get_height()))
+    {
+      if(packers[color_packer]-&gt;is_full())
+      {
+        packers.push_back(new TilePacker(1024, 1024));
+        color_packer = packers.size() - 1;
+      }
           
-          Rectf uv = packers[color_packer]-&gt;pack(image, 
-                                                 rect.left, rect.top,
-                                                 rect.get_width(), rect.get_height());
-          tiles[id]-&gt;uv      = uv;
-          tiles[id]-&gt;packer  = color_packer;
-          tiles[id]-&gt;texture = packers[color_packer]-&gt;get_texture();
-        }
+      Rectf uv = packers[color_packer]-&gt;pack(image, 
+                                             rect.left, rect.top,
+                                             rect.get_width(), rect.get_height());
+      tiles[id]-&gt;uv      = uv;
+      tiles[id]-&gt;packer  = color_packer;
+      tiles[id]-&gt;texture = packers[color_packer]-&gt;get_texture();
     }
+  }
 }
 
 Tile*
 TileFactory::create(int id)
 {
   if(id &lt; 0 || id &gt;= static_cast&lt;int&gt;(tiles.size()))
-    {
-      return 0;
-    }
+  {
+    return 0;
+  }
   else
-    {
-      if (tiles[id] &amp;&amp; tiles[id]-&gt;desc)
-        tiles[id]-&gt;desc-&gt;load(this);
+  {
+    if (tiles[id] &amp;&amp; tiles[id]-&gt;desc)
+      tiles[id]-&gt;desc-&gt;load(this);
 
-      return tiles[id];
-    }
+    return tiles[id];
+  }
 }
 
 /* EOF */

Modified: trunk/windstille/src/tile/tile_map.cpp
===================================================================
--- trunk/windstille/src/tile/tile_map.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/tile/tile_map.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -28,10 +28,10 @@
 #include &quot;screen/view.hpp&quot;
 #include &quot;scenegraph/vertex_array_drawable.hpp&quot;
 
-TileMap::TileMap(const FileReader&amp; props)
-  : field(),
-    z_pos(),
-    total_time()
+TileMap::TileMap(const FileReader&amp; props) :
+  field(),
+  z_pos(),
+  total_time()
 {
   int width = -1;
   int height = -1;
@@ -44,16 +44,16 @@
   props.get(&quot;height&quot;, height);
 
   if(width &lt;= 0 || height &lt;= 0) 
-    {
-      throw std::runtime_error(&quot;Invalid width or height defined or &quot;
-                               &quot;data defined before width and height&quot;);  
-    }
+  {
+    throw std::runtime_error(&quot;Invalid width or height defined or &quot;
+                             &quot;data defined before width and height&quot;);  
+  }
  
   if(width &lt;= 0 || height &lt;= 0) 
-    {
-      throw std::runtime_error(&quot;Invalid width or height defined or &quot;
-                               &quot;data defined before width and height&quot;);
-    }
+  {
+    throw std::runtime_error(&quot;Invalid width or height defined or &quot;
+                             &quot;data defined before width and height&quot;);
+  }
 
   Field&lt;int&gt; tmpfield(width, height);
   
@@ -95,45 +95,45 @@
   std::vector&lt;VertexArrayDrawable*&gt; requests;
   for (int y = rect.top;   y &lt; rect.bottom; ++y)
     for (int x = rect.left; x &lt; rect.right; ++x)
+    {
+      Tile* tile = field(x, y);
+
+      if (!(tile == 0 || tile-&gt;packer &lt; 0))
       {
-        Tile* tile = field(x, y);
+        int packer = tile-&gt;packer; 
 
-        if (!(tile == 0 || tile-&gt;packer &lt; 0))
-          {
-            int packer = tile-&gt;packer; 
+        if(packer &gt;= int(requests.size()))
+          requests.resize(packer+1);
 
-            if(packer &gt;= int(requests.size()))
-              requests.resize(packer+1);
-
-            VertexArrayDrawable*&amp; request = requests[packer];
-            if (!request)
-              {
-                request = new VertexArrayDrawable(Vector2f(0, 0), z_pos,
-                                                        sc.color().get_modelview());
-                request-&gt;set_mode(GL_QUADS);
-                request-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-                request-&gt;set_texture(tile-&gt;texture);
-              }
+        VertexArrayDrawable*&amp; request = requests[packer];
+        if (!request)
+        {
+          request = new VertexArrayDrawable(Vector2f(0, 0), z_pos,
+                                            sc.color().get_modelview());
+          request-&gt;set_mode(GL_QUADS);
+          request-&gt;set_blend_func(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+          request-&gt;set_texture(tile-&gt;texture);
+        }
             
-            request-&gt;texcoord(tile-&gt;uv.left, tile-&gt;uv.top);
-            request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE));
+        request-&gt;texcoord(tile-&gt;uv.left, tile-&gt;uv.top);
+        request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE));
 
-            request-&gt;texcoord(tile-&gt;uv.right, tile-&gt;uv.top);
-            request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE + TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE));
+        request-&gt;texcoord(tile-&gt;uv.right, tile-&gt;uv.top);
+        request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE + TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE));
             
-            request-&gt;texcoord(tile-&gt;uv.right, tile-&gt;uv.bottom);
-            request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE + TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE + TILE_SIZE));
+        request-&gt;texcoord(tile-&gt;uv.right, tile-&gt;uv.bottom);
+        request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE + TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE + TILE_SIZE));
             
-            request-&gt;texcoord(tile-&gt;uv.left, tile-&gt;uv.bottom);
-            request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE + TILE_SIZE)); 
-          }
+        request-&gt;texcoord(tile-&gt;uv.left, tile-&gt;uv.bottom);
+        request-&gt;vertex(static_cast&lt;float&gt;(x * TILE_SIZE), static_cast&lt;float&gt;(y * TILE_SIZE + TILE_SIZE)); 
       }
+    }
 
   for(std::vector&lt;VertexArrayDrawable*&gt;::iterator i = requests.begin(); i != requests.end(); ++i)
-    {
-      if (*i)
-        sc.color().draw(*i);
-    }
+  {
+    if (*i)
+      sc.color().draw(*i);
+  }
 }
 
 unsigned int
@@ -142,19 +142,19 @@
   if (x &lt; 0 || y &lt; 0 
       || x &gt;= int(field.get_width())
       || y &gt;= int(field.get_height()))
-    {
-      //std::cout &lt;&lt; &quot;Out of bounce: &quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; std::endl;
-      return 0;
-    }
+  {
+    //std::cout &lt;&lt; &quot;Out of bounce: &quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; std::endl;
+    return 0;
+  }
   else
-    {
-      Tile* tile = field(x, y);
+  {
+    Tile* tile = field(x, y);
       
-      if (tile)
-        return tile-&gt;get_colmap();
-      else
-        return 0;     
-    }
+    if (tile)
+      return tile-&gt;get_colmap();
+    else
+      return 0;     
+  }
 }
 
 bool
@@ -164,14 +164,14 @@
   int y_pos = int(y) / TILE_SIZE;
 
   if (x &lt; 0 || x_pos &gt;= field.get_width())
-    {
-      //std::cout &lt;&lt; &quot;TileMap::is_ground (): Out of range: &quot; &lt;&lt; x_pos &lt;&lt; &quot; &quot; &lt;&lt; y_pos &lt;&lt; std::endl;
-      return 1;
-    }
+  {
+    //std::cout &lt;&lt; &quot;TileMap::is_ground (): Out of range: &quot; &lt;&lt; x_pos &lt;&lt; &quot; &quot; &lt;&lt; y_pos &lt;&lt; std::endl;
+    return 1;
+  }
   else if (y &lt; 0 || y_pos &gt;= field.get_height())
-    {
-      return 0;
-    }
+  {
+    return 0;
+  }
 
   if (field(x_pos, y_pos))
     return field(x_pos, y_pos)-&gt;get_colmap() != 0;
@@ -222,27 +222,27 @@
 
   while(x &gt;= 0 &amp;&amp; x &lt; get_width() &amp;&amp;
         y &gt;= 0 &amp;&amp; y &lt; get_height())
+  {
+    Tile* tile = field(x, y);  
+    if (tile &amp;&amp; tile-&gt;colmap)
     {
-      Tile* tile = field(x, y);  
-      if (tile &amp;&amp; tile-&gt;colmap)
-        {
-          return pos + Vector2f(t * direction.x, t * direction.y);
-        }
+      return pos + Vector2f(t * direction.x, t * direction.y);
+    }
 
-      // move one tile
-      if (tMaxX &lt; tMaxY)
-        {
-          t = tMaxX;
-          tMaxX += tDeltaX;
-          x = x + step_x;
-        }
-      else 
-        {
-          t = tMaxY;
-          tMaxY += tDeltaY;
-          y = y + step_y;
-        }
+    // move one tile
+    if (tMaxX &lt; tMaxY)
+    {
+      t = tMaxX;
+      tMaxX += tDeltaX;
+      x = x + step_x;
     }
+    else 
+    {
+      t = tMaxY;
+      tMaxY += tDeltaY;
+      y = y + step_y;
+    }
+  }
 
   // Ray got out of the map
   return pos + Vector2f(t * direction.x, t * direction.y);

Modified: trunk/windstille/src/tile/tile_packer.cpp
===================================================================
--- trunk/windstille/src/tile/tile_packer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/tile/tile_packer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -46,8 +46,8 @@
   {}
 };
 
-TilePacker::TilePacker(int width, int height)
-  : impl(new TilePackerImpl())
+TilePacker::TilePacker(int width, int height) :
+  impl(new TilePackerImpl())
 {
   impl-&gt;x_pos = 0;
   impl-&gt;y_pos = 0;
@@ -103,10 +103,10 @@
   // when blending
   impl-&gt;x_pos += TILE_RESOLUTION + 2; 
   if (impl-&gt;x_pos + TILE_RESOLUTION &gt; impl-&gt;width)
-    {
-      impl-&gt;x_pos = 0;
-      impl-&gt;y_pos += TILE_RESOLUTION + 2;
-    }
+  {
+    impl-&gt;x_pos = 0;
+    impl-&gt;y_pos += TILE_RESOLUTION + 2;
+  }
 
   return rect;
 }

Modified: trunk/windstille/src/util/baby_xml.cpp
===================================================================
--- trunk/windstille/src/util/baby_xml.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/baby_xml.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -40,29 +40,29 @@
     std::string content;
     
     while(!eof())
+    {
+      char c = look_ahead();
+      switch(c)
       {
-        char c = look_ahead();
-        switch(c)
+        case '&lt;':
+          if (!content.empty())
           {
-          case '&lt;':
-            if (!content.empty())
-              {
-                xml-&gt;add_node(BabyXML::Node(BabyXML::Node::TEXT, content));
-                content = &quot;&quot;;
-              }
-            read_element();
-            break;
+            xml-&gt;add_node(BabyXML::Node(BabyXML::Node::TEXT, content));
+            content = &quot;&quot;;
+          }
+          read_element();
+          break;
 
-          case '&amp;':
-            content += read_entity();
-            break;
+        case '&amp;':
+          content += read_entity();
+          break;
 
-          default:
-            content += c;
-            incr_cursor();
-            break;
-          }
+        default:
+          content += c;
+          incr_cursor();
+          break;
       }
+    }
 
     if (!content.empty())
       xml-&gt;add_node(BabyXML::Node(BabyXML::Node::TEXT, content));
@@ -71,30 +71,30 @@
   void skip_space()
   {
     while(true) 
-      {
-        char c = look_ahead();
-        if (c != ' ' &amp;&amp; c != '\t') {
-          break;
-        } else {
-          incr_cursor();
-        }
+    {
+      char c = look_ahead();
+      if (c != ' ' &amp;&amp; c != '\t') {
+        break;
+      } else {
+        incr_cursor();
       }
+    }
   }
 
   void read_char(char expect)
   {
     char c = look_ahead();
     if (c != expect)
-      {
-        std::ostringstream str;
-        str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no 
-            &lt;&lt; &quot;: Syntax error: read_char(): expected '&quot; &lt;&lt; expect &lt;&lt; &quot;' got '&quot; &lt;&lt; c &lt;&lt; &quot;'&quot;;
-        throw std::runtime_error(str.str());
-      }
+    {
+      std::ostringstream str;
+      str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no 
+          &lt;&lt; &quot;: Syntax error: read_char(): expected '&quot; &lt;&lt; expect &lt;&lt; &quot;' got '&quot; &lt;&lt; c &lt;&lt; &quot;'&quot;;
+      throw std::runtime_error(str.str());
+    }
     else
-      {
-        incr_cursor();
-      }
+    {
+      incr_cursor();
+    }
   }
 
   void read_element()
@@ -103,17 +103,17 @@
 
     read_char('&lt;');
     if (look_ahead() == '/') 
-      {
-        node.type = BabyXML::Node::END_TAG;
-        incr_cursor();
-        node.content = read_identifer();
-      }
+    {
+      node.type = BabyXML::Node::END_TAG;
+      incr_cursor();
+      node.content = read_identifer();
+    }
     else
-      {
-        node.type = BabyXML::Node::START_TAG;
-        node.content    = read_identifer();
-        node.attributes = read_attributes();
-      }
+    {
+      node.type = BabyXML::Node::START_TAG;
+      node.content    = read_identifer();
+      node.attributes = read_attributes();
+    }
     
     skip_space();
     read_char('&gt;');
@@ -126,40 +126,40 @@
   {
     char start = look_ahead();
     if (start != '\'' &amp;&amp; start != '&quot;')
-      {
-        std::ostringstream str;
-        str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no 
-            &lt;&lt; &quot;: Syntax error: read_string(): expected ' or \&quot; got '&quot; &lt;&lt; start &lt;&lt; &quot;'&quot;;
-        throw std::runtime_error(str.str());
-      }
+    {
+      std::ostringstream str;
+      str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no 
+          &lt;&lt; &quot;: Syntax error: read_string(): expected ' or \&quot; got '&quot; &lt;&lt; start &lt;&lt; &quot;'&quot;;
+      throw std::runtime_error(str.str());
+    }
     incr_cursor();
     
     std::string content;
     while(true)
+    {
+      char c = look_ahead();
+      if (c == '&quot;' || c == '\'') 
       {
-        char c = look_ahead();
-        if (c == '&quot;' || c == '\'') 
-          {
-            if (c != start)
-              {
-                std::ostringstream str;
-                str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no 
-                    &lt;&lt; &quot;: Syntax error: read_string(): quote mismatch&quot;;
-                throw std::runtime_error(str.str());
-              }
-            incr_cursor();
-            break;
-          } 
-        else if (c == '&amp;') 
-          {
-            content += read_entity();
-          }
-        else 
-          {
-            incr_cursor();
-            content += c;
-          }
+        if (c != start)
+        {
+          std::ostringstream str;
+          str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no 
+              &lt;&lt; &quot;: Syntax error: read_string(): quote mismatch&quot;;
+          throw std::runtime_error(str.str());
+        }
+        incr_cursor();
+        break;
+      } 
+      else if (c == '&amp;') 
+      {
+        content += read_entity();
       }
+      else 
+      {
+        incr_cursor();
+        content += c;
+      }
+    }
     return content;
   }
 
@@ -176,32 +176,32 @@
     else if (identifer == &quot;lt&quot;)
       return '&lt;';
     else
-      {
-        std::ostringstream str;
-        str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no &lt;&lt; &quot;: Unknown entity: '&amp;&quot; + identifer + &quot;;'&quot;;
-        throw std::runtime_error(str.str());
-      }
+    {
+      std::ostringstream str;
+      str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no &lt;&lt; &quot;: Unknown entity: '&amp;&quot; + identifer + &quot;;'&quot;;
+      throw std::runtime_error(str.str());
+    }
   }
   
   std::vector&lt;BabyXML::Attribute&gt; read_attributes()
   {
     std::vector&lt;BabyXML::Attribute&gt; attributes;
     while(true) 
+    {
+      skip_space();
+
+      char c = look_ahead();
+      if (c == '&gt;' || c == '&amp;' || c == '&lt;' || c == ';')
       {
-        skip_space();
+        break;
+      }
 
-        char c = look_ahead();
-        if (c == '&gt;' || c == '&amp;' || c == '&lt;' || c == ';')
-          {
-            break;
-          }
+      attributes.push_back(BabyXML::Attribute());
 
-        attributes.push_back(BabyXML::Attribute());
-
-        attributes.back().name = read_identifer();
-        read_char('=');
-        attributes.back().value = read_string();
-      }
+      attributes.back().name = read_identifer();
+      read_char('=');
+      attributes.back().value = read_string();
+    }
     return attributes;
   }
 
@@ -209,22 +209,22 @@
   {
     std::string identifer;
     while(true) 
-      {
-        char c = look_ahead();
-        if (c == '&lt;' || c == '&gt;' || c == '&amp;' || c == ';' || c == ' ' || c == '\t' || c == '=') {
-          break;
-        } else {
-          identifer += c;
-          incr_cursor();
-        }
+    {
+      char c = look_ahead();
+      if (c == '&lt;' || c == '&gt;' || c == '&amp;' || c == ';' || c == ' ' || c == '\t' || c == '=') {
+        break;
+      } else {
+        identifer += c;
+        incr_cursor();
       }
+    }
 
     if (identifer.empty())
-      {
-        std::ostringstream str;
-        str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no &lt;&lt; &quot;: Identifer is empty&quot;;
-        throw std::runtime_error(str.str());
-      }
+    {
+      std::ostringstream str;
+      str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no &lt;&lt; &quot;: Identifer is empty&quot;;
+      throw std::runtime_error(str.str());
+    }
 
     return identifer;
   }
@@ -237,11 +237,11 @@
   char look_ahead()
   {
     if (cursor &gt;= int(text.size()))
-      {
-        std::ostringstream str;
-        str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no &lt;&lt; &quot;: Premature end of text&quot;;
-        throw std::runtime_error(str.str());
-      }
+    {
+      std::ostringstream str;
+      str &lt;&lt; &quot;Syntax Error:&quot; &lt;&lt; line_no &lt;&lt; &quot;:&quot; &lt;&lt; column_no &lt;&lt; &quot;: Premature end of text&quot;;
+      throw std::runtime_error(str.str());
+    }
 
     return text[cursor];
   }
@@ -250,14 +250,14 @@
   {
     cursor += 1;
     if (text[cursor] == '\n')
-      {
-        line_no += 1;
-        column_no = 0;
-      }
+    {
+      line_no += 1;
+      column_no = 0;
+    }
     else
-      {
-        column_no += 1;
-      }
+    {
+      column_no += 1;
+    }
   }
 
 private:
@@ -288,33 +288,33 @@
 int main(int argc, char** argv)
 {
   if (argc != 2)
-    {
-      std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; STRING&quot; &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; STRING&quot; &lt;&lt; std::endl;
+  }
   else
+  {
+    // BabyXML xml(&quot;&lt;strong size='10'&gt;Hello &lt; World&gt; &lt;b&gt;&quot;blabla&quot;&lt;/b&gt; Blablub&lt;/strong&gt;&quot;);
+    BabyXML xml(argv[1]);
+
+    for(BabyXML::iterator i = xml.begin(); i != xml.end(); ++i)
     {
-      // BabyXML xml(&quot;&lt;strong size='10'&gt;Hello &lt; World&gt; &lt;b&gt;&quot;blabla&quot;&lt;/b&gt; Blablub&lt;/strong&gt;&quot;);
-      BabyXML xml(argv[1]);
+      if (i-&gt;type == BabyXML::Node::START_TAG)
+        std::cout &lt;&lt; &quot;STARTTAG: &quot;;
+      else if (i-&gt;type == BabyXML::Node::END_TAG)
+        std::cout &lt;&lt; &quot;ENDTAG: &quot;;
+      else if (i-&gt;type == BabyXML::Node::TEXT)
+        std::cout &lt;&lt; &quot;TEXT: &quot;;
 
-      for(BabyXML::iterator i = xml.begin(); i != xml.end(); ++i)
-        {
-          if (i-&gt;type == BabyXML::Node::START_TAG)
-            std::cout &lt;&lt; &quot;STARTTAG: &quot;;
-          else if (i-&gt;type == BabyXML::Node::END_TAG)
-            std::cout &lt;&lt; &quot;ENDTAG: &quot;;
-          else if (i-&gt;type == BabyXML::Node::TEXT)
-            std::cout &lt;&lt; &quot;TEXT: &quot;;
+      std::cout &lt;&lt; &quot;'&quot; &lt;&lt; i-&gt;content &lt;&lt; &quot;'&quot;;
 
-          std::cout &lt;&lt; &quot;'&quot; &lt;&lt; i-&gt;content &lt;&lt; &quot;'&quot;;
+      for(std::vector&lt;BabyXML::Attribute&gt;::iterator j = i-&gt;attributes.begin(); j != i-&gt;attributes.end(); ++j)
+      {
+        std::cout &lt;&lt; &quot; &quot; &lt;&lt; j-&gt;name &lt;&lt; &quot;='&quot; &lt;&lt; j-&gt;value &lt;&lt; &quot;'&quot;;
+      }
 
-          for(std::vector&lt;BabyXML::Attribute&gt;::iterator j = i-&gt;attributes.begin(); j != i-&gt;attributes.end(); ++j)
-            {
-              std::cout &lt;&lt; &quot; &quot; &lt;&lt; j-&gt;name &lt;&lt; &quot;='&quot; &lt;&lt; j-&gt;value &lt;&lt; &quot;'&quot;;
-            }
-
-          std::cout &lt;&lt; std::endl;
-        }
+      std::cout &lt;&lt; std::endl;
     }
+  }
 }
 #endif
 

Modified: trunk/windstille/src/util/command_line.cpp
===================================================================
--- trunk/windstille/src/util/command_line.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/command_line.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -36,60 +36,60 @@
 
 CommandLine::~CommandLine()
 {
-	delete impl;
+  delete impl;
 }
 
 void CommandLine::parse_args(int argc, char** argv)
 {
-	impl-&gt;parse_args(argc, argv);
+  impl-&gt;parse_args(argc, argv);
 }
 
 void CommandLine::print_help()
 {
-	impl-&gt;print_help();
+  impl-&gt;print_help();
 }
 
 void CommandLine::set_help_indent(int i)
 {
-	impl-&gt;set_help_indent(i);
+  impl-&gt;set_help_indent(i);
 }
 
 void CommandLine::add_usage(const std::string&amp; usage)
 {
-	impl-&gt;add_usage(usage);
+  impl-&gt;add_usage(usage);
 }
 
 void CommandLine::add_doc(const std::string&amp; doc)
 {
-	impl-&gt;add_doc(doc);
+  impl-&gt;add_doc(doc);
 }
 
 void CommandLine::add_group(const std::string&amp; grouptopic)
 {
-	impl-&gt;add_group(grouptopic);
+  impl-&gt;add_group(grouptopic);
 }
 
 void CommandLine::add_option(
-	int key, 
-	const std::string&amp; long_option, 
-	const std::string&amp; argument,
-	const std::string&amp; help,
-	bool visible)
+  int key, 
+  const std::string&amp; long_option, 
+  const std::string&amp; argument,
+  const std::string&amp; help,
+  bool visible)
 {
-	impl-&gt;add_option(key, long_option, argument, help, visible);
+  impl-&gt;add_option(key, long_option, argument, help, visible);
 }
 
 bool CommandLine::next()
 {
-	return impl-&gt;next();
+  return impl-&gt;next();
 }
 
 int CommandLine::get_key()
 {
-	return impl-&gt;get_key();
+  return impl-&gt;get_key();
 }
 
 std::string CommandLine::get_argument()
 {
-	return impl-&gt;get_argument();
+  return impl-&gt;get_argument();
 }

Modified: trunk/windstille/src/util/command_line.hpp
===================================================================
--- trunk/windstille/src/util/command_line.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/command_line.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -81,77 +81,77 @@
 //- (aka filenames in most programs).&lt;/p&gt;
 class CommandLine
 {
-//! Construction:
+  //! Construction:
 public:
-	CommandLine();
+  CommandLine();
 
-	~CommandLine();
+  ~CommandLine();
 
-//! Attributes:
+  //! Attributes:
 public:
-	enum
-	{
-		REST_ARG  = -2
-	};
+  enum
+  {
+    REST_ARG  = -2
+  };
 
-	//: Return the key of the current option
-	int get_key();
+  //: Return the key of the current option
+  int get_key();
 
-	//: Return the argument to the current option
-	std::string get_argument();
+  //: Return the argument to the current option
+  std::string get_argument();
 
-//! Operations:
+  //! Operations:
 public:
-	//: Change the indention used for the help message, default is 18
-	void set_help_indent(int i);
+  //: Change the indention used for the help message, default is 18
+  void set_help_indent(int i);
 
-	//: Add a usage line to the help output, usage is for example
-	//: &quot;[OPTIONS]... FILE&quot;, the program name will get appended
-	//: automatically
-	void add_usage(const std::string&amp; usage);
+  //: Add a usage line to the help output, usage is for example
+  //: &quot;[OPTIONS]... FILE&quot;, the program name will get appended
+  //: automatically
+  void add_usage(const std::string&amp; usage);
 
-	//: Adds extra documentation to the help output, should only be
-	//: used at the beginning or at the end, to
-	void add_doc(const std::string&amp; doc);
-	
-	//: Starts a new group of options, the grouptopic gets printed
-	//: above the group of options in the print_help() output
-	void add_group(const std::string&amp; grouptopic);
+  //: Adds extra documentation to the help output, should only be
+  //: used at the beginning or at the end, to
+  void add_doc(const std::string&amp; doc);
+        
+  //: Starts a new group of options, the grouptopic gets printed
+  //: above the group of options in the print_help() output
+  void add_group(const std::string&amp; grouptopic);
   
-	//: Adds a option to the parser
-	//param key: a letter for a short-option or a numeric value
-	//param key: larger than 255 that identifies the option
-	//param long_option: the long name of this option or &quot;&quot; if non
-	//param long_option: should be used for this option
-	//param argument: the type of the argument that this option
-	//param argument: requires (i.e. FILE, SIZE, WIDTH, etc.) or &quot;&quot; if no argument is
-	//param argument: required
-	//param help: the help string for this option
-	//param visible: true if the option should be listed in the help
-	//param visible: output, false will not list it in the help output which might
-	//param visible: be usefull for cheat-options or backward-compability options
-	//param visible: than would only clutter the help output
-	void add_option(
-		int key,
-		const std::string&amp; long_option, 
-		const std::string&amp; argument,
-		const std::string&amp; help,
-		bool visible = true);
-	
-	//: Parse the options arcording to the options added with
-	//: add_option(), result of the parsing is accessible via
-	//: next() and get_key()/get_argument()
-	void parse_args(int argc, char** argv);
+  //: Adds a option to the parser
+  //param key: a letter for a short-option or a numeric value
+  //param key: larger than 255 that identifies the option
+  //param long_option: the long name of this option or &quot;&quot; if non
+  //param long_option: should be used for this option
+  //param argument: the type of the argument that this option
+  //param argument: requires (i.e. FILE, SIZE, WIDTH, etc.) or &quot;&quot; if no argument is
+  //param argument: required
+  //param help: the help string for this option
+  //param visible: true if the option should be listed in the help
+  //param visible: output, false will not list it in the help output which might
+  //param visible: be usefull for cheat-options or backward-compability options
+  //param visible: than would only clutter the help output
+  void add_option(
+    int key,
+    const std::string&amp; long_option, 
+    const std::string&amp; argument,
+    const std::string&amp; help,
+    bool visible = true);
+        
+  //: Parse the options arcording to the options added with
+  //: add_option(), result of the parsing is accessible via
+  //: next() and get_key()/get_argument()
+  void parse_args(int argc, char** argv);
 
-	//: Print the help output, normaly done via a --help option
-	void print_help();
+  //: Print the help output, normaly done via a --help option
+  void print_help();
 
-	//: Goto the next option
-	bool next();
+  //: Goto the next option
+  bool next();
 
-//! Implementation:
+  //! Implementation:
 private:
-	CommandLine_Generic* impl;
+  CommandLine_Generic* impl;
 
 private:
   CommandLine(const CommandLine&amp;);

Modified: trunk/windstille/src/util/command_line_generic.cpp
===================================================================
--- trunk/windstille/src/util/command_line_generic.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/command_line_generic.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -53,124 +53,124 @@
   programm = argv[0];
 
   for(int i = 1; i &lt; argc; ++i) 
+  {
+    if (argv[i][0] == '-') 
     {
-      if (argv[i][0] == '-') 
+      if (argv[i][1] == '-') 
+      {
+        // We got a long option
+        if (argv[i][2] == '\0') { 
+          // Got a '--', so we stop evaluating arguments
+          ++i;
+          while(i &lt; argc) 
+          {
+            read_option(CommandLine::REST_ARG, argv[i]);
+            ++i;
+          }
+        } 
+        else
         {
-          if (argv[i][1] == '-') 
-            {
-              // We got a long option
-              if (argv[i][2] == '\0') { 
-                // Got a '--', so we stop evaluating arguments
-                ++i;
-                while(i &lt; argc) 
-                  {
-                    read_option(CommandLine::REST_ARG, argv[i]);
-                    ++i;
-                  }
-              } 
-              else
-                {
-                  std::string opt = argv[i] + 2;
-                  std::string long_opt;
-                  std::string long_opt_arg;
+          std::string opt = argv[i] + 2;
+          std::string long_opt;
+          std::string long_opt_arg;
 
-                  std::string::size_type pos = opt.find('=');
+          std::string::size_type pos = opt.find('=');
 
-                  if (pos != std::string::npos) 
-                    {
-                      long_opt = opt.substr(0, pos);
-                      long_opt_arg = opt.substr(pos+1);
-                    }
-                  else 
-                    {
-                      long_opt = opt;
-                    }
+          if (pos != std::string::npos) 
+          {
+            long_opt = opt.substr(0, pos);
+            long_opt_arg = opt.substr(pos+1);
+          }
+          else 
+          {
+            long_opt = opt;
+          }
 
-                  // Long Option
-                  Option* option = lookup_long_option(long_opt);
+          // Long Option
+          Option* option = lookup_long_option(long_opt);
 
-                  if (option) 
-                    {
-                      if (option-&gt;argument.empty()) 
-                        {
-                          read_option(option-&gt;key, &quot;&quot;);
-                        } 
-                      else
-                        {
-                          if (pos != std::string::npos) 
-                            {
-                              read_option(option-&gt;key, long_opt_arg);
-                            }
-                          else
-                            {            
-                              if (i == argc - 1) 
-                                {
-                                  throw std::runtime_error(&quot;option '&quot; + std::string(argv[i]) + &quot;' requires an argument&quot;);
-                                }
-                              else 
-                                {
-                                  read_option(option-&gt;key, argv[i + 1]);
-                                  ++i;
-                                }
-                            }
-                        }
-                    }
-                  else
-                    {
-                      throw std::runtime_error(&quot;unrecognized option '&quot; + std::string(argv[i]) + &quot;'&quot;);
-                    }
-                }
+          if (option) 
+          {
+            if (option-&gt;argument.empty()) 
+            {
+              read_option(option-&gt;key, &quot;&quot;);
             } 
-          else 
+            else
             {
-              // We got a short option
-              char* p = argv[i] + 1;
+              if (pos != std::string::npos) 
+              {
+                read_option(option-&gt;key, long_opt_arg);
+              }
+              else
+              {            
+                if (i == argc - 1) 
+                {
+                  throw std::runtime_error(&quot;option '&quot; + std::string(argv[i]) + &quot;' requires an argument&quot;);
+                }
+                else 
+                {
+                  read_option(option-&gt;key, argv[i + 1]);
+                  ++i;
+                }
+              }
+            }
+          }
+          else
+          {
+            throw std::runtime_error(&quot;unrecognized option '&quot; + std::string(argv[i]) + &quot;'&quot;);
+          }
+        }
+      } 
+      else 
+      {
+        // We got a short option
+        char* p = argv[i] + 1;
           
-              if (*p != '\0') {
-                // Handle option chains
-                while (*p) 
-                  {
-                    // Short option(s)
-                    Option* option = lookup_short_option(*p);
+        if (*p != '\0') {
+          // Handle option chains
+          while (*p) 
+          {
+            // Short option(s)
+            Option* option = lookup_short_option(*p);
 
-                    if (option) 
-                      {
-                        if (option-&gt;argument.empty()) 
-                          {
-                            read_option(option-&gt;key, &quot;&quot;);
-                          } 
-                        else 
-                          {
-                            if (i == argc - 1 || *(p+1) != '\0') 
-                              {
-                                // No more arguments
-                                throw std::runtime_error(&quot;option requires an argument -- &quot; + std::string(1, *p));
-                              }
-                            else
-                              {
-                                read_option(option-&gt;key, argv[i + 1]);
-                                ++i;
-                              }
-                          }
-                      } 
-                    else 
-                      {
-                        throw std::runtime_error(&quot;invalid option -- &quot; + std::string(1, *p));
-                      }
-                    ++p; 
-                  }
+            if (option) 
+            {
+              if (option-&gt;argument.empty()) 
+              {
+                read_option(option-&gt;key, &quot;&quot;);
               } 
-              else
+              else 
+              {
+                if (i == argc - 1 || *(p+1) != '\0') 
                 {
-                  read_option(CommandLine::REST_ARG, &quot;-&quot;);
-                } 
+                  // No more arguments
+                  throw std::runtime_error(&quot;option requires an argument -- &quot; + std::string(1, *p));
+                }
+                else
+                {
+                  read_option(option-&gt;key, argv[i + 1]);
+                  ++i;
+                }
+              }
+            } 
+            else 
+            {
+              throw std::runtime_error(&quot;invalid option -- &quot; + std::string(1, *p));
             }
+            ++p; 
+          }
         } 
-      else
+        else
         {
-          read_option(CommandLine::REST_ARG, argv[i]);
-        }
+          read_option(CommandLine::REST_ARG, &quot;-&quot;);
+        } 
+      }
+    } 
+    else
+    {
+      read_option(CommandLine::REST_ARG, argv[i]);
     }
+  }
 
   current_option = parsed_options.end();
 }
@@ -178,20 +178,20 @@
 CommandLine_Generic::Option *CommandLine_Generic::lookup_short_option(char short_option)
 {
   for(Options::iterator i = options.begin(); i != options.end(); ++i)
-    {
-      if (i-&gt;key == short_option)
-        return &amp;(*i);
-    }
+  {
+    if (i-&gt;key == short_option)
+      return &amp;(*i);
+  }
   return 0;
 }
 
 CommandLine_Generic::Option *CommandLine_Generic::lookup_long_option(const std::string&amp; long_option)
 {
   for(Options::iterator i = options.begin(); i != options.end(); ++i)
-    {
-      if (i-&gt;long_option == long_option)
-        return &amp;*i;
-    }
+  {
+    if (i-&gt;long_option == long_option)
+      return &amp;*i;
+  }
   return 0;
 }
 
@@ -209,60 +209,60 @@
 {
   bool first_usage = true;
   for(Options::iterator i = options.begin(); i != options.end(); ++i)
+  {
+    if (i-&gt;visible)
     {
-      if (i-&gt;visible)
+      if (i-&gt;key == USAGE) 
+      {
+        if (first_usage) 
         {
-          if (i-&gt;key == USAGE) 
-            {
-              if (first_usage) 
-                {
-                  std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; programm &lt;&lt; &quot; &quot; &lt;&lt;  i-&gt;help &lt;&lt; std::endl; 
-                  first_usage = false;
-                }
-              else
-                {
-                  std::cout &lt;&lt; &quot;or:    &quot; &lt;&lt; programm &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;help &lt;&lt; std::endl; 
-                }
-            } 
-          else if (i-&gt;key == GROUP) 
-            {
-              if (i != options.begin())
-                std::cout &lt;&lt; std::endl;
-              std::cout &lt;&lt; i-&gt;help &lt;&lt; std::endl;
-            }
-          else if (i-&gt;key == DOC) 
-            {
-              if (i != options.begin())
-                std::cout &lt;&lt; std::endl;
-              std::cout &lt;&lt; i-&gt;help &lt;&lt; std::endl;
-            }
-          else 
-            {
-              char option[256]   = { 0 };
-              char argument[256] = { 0 };
+          std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; programm &lt;&lt; &quot; &quot; &lt;&lt;  i-&gt;help &lt;&lt; std::endl; 
+          first_usage = false;
+        }
+        else
+        {
+          std::cout &lt;&lt; &quot;or:    &quot; &lt;&lt; programm &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;help &lt;&lt; std::endl; 
+        }
+      } 
+      else if (i-&gt;key == GROUP) 
+      {
+        if (i != options.begin())
+          std::cout &lt;&lt; std::endl;
+        std::cout &lt;&lt; i-&gt;help &lt;&lt; std::endl;
+      }
+      else if (i-&gt;key == DOC) 
+      {
+        if (i != options.begin())
+          std::cout &lt;&lt; std::endl;
+        std::cout &lt;&lt; i-&gt;help &lt;&lt; std::endl;
+      }
+      else 
+      {
+        char option[256]   = { 0 };
+        char argument[256] = { 0 };
 
-              if (i-&gt;key &gt; 255 || i-&gt;key &lt; 0)
-                snprintf(option, 256, &quot;--%s&quot;, i-&gt;long_option.c_str());
-              else if (i-&gt;long_option.empty())
-                snprintf(option, 256, &quot;-%c&quot;, char(i-&gt;key));
-              else
-                snprintf(option, 256, &quot;-%c, --%s&quot;, char(i-&gt;key), i-&gt;long_option.c_str());
+        if (i-&gt;key &gt; 255 || i-&gt;key &lt; 0)
+          snprintf(option, 256, &quot;--%s&quot;, i-&gt;long_option.c_str());
+        else if (i-&gt;long_option.empty())
+          snprintf(option, 256, &quot;-%c&quot;, char(i-&gt;key));
+        else
+          snprintf(option, 256, &quot;-%c, --%s&quot;, char(i-&gt;key), i-&gt;long_option.c_str());
 
-              if (!i-&gt;argument.empty())
-                {
-                  if (i-&gt;long_option.empty())
-                    snprintf(argument, 256, &quot; %s&quot;, i-&gt;argument.c_str());
-                  else
-                    snprintf(argument, 256, &quot;=%s&quot;, i-&gt;argument.c_str());
-                }
+        if (!i-&gt;argument.empty())
+        {
+          if (i-&gt;long_option.empty())
+            snprintf(argument, 256, &quot; %s&quot;, i-&gt;argument.c_str());
+          else
+            snprintf(argument, 256, &quot;=%s&quot;, i-&gt;argument.c_str());
+        }
 
-              std::cout &lt;&lt; &quot;  &quot; 
-                        &lt;&lt; std::setiosflags(std::ios::left) &lt;&lt; std::setw(help_indent)
-                        &lt;&lt; (std::string(option) + std::string(argument)) &lt;&lt; std::setw(0)
-                        &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;help &lt;&lt; std::endl;
-            }
-        }
+        std::cout &lt;&lt; &quot;  &quot; 
+                  &lt;&lt; std::setiosflags(std::ios::left) &lt;&lt; std::setw(help_indent)
+                  &lt;&lt; (std::string(option) + std::string(argument)) &lt;&lt; std::setw(0)
+                  &lt;&lt; &quot; &quot; &lt;&lt; i-&gt;help &lt;&lt; std::endl;
+      }
     }
+  }
   std::cout &lt;&lt; std::endl;
 }
 
@@ -300,10 +300,10 @@
 }
 
 void CommandLine_Generic::add_option(int key, 
-                                        const std::string&amp; long_option, 
-                                        const std::string&amp; argument,
-                                        const std::string&amp; help,
-                                        bool visible)
+                                     const std::string&amp; long_option, 
+                                     const std::string&amp; argument,
+                                     const std::string&amp; help,
+                                     bool visible)
 {
   Option option;
 
@@ -319,14 +319,14 @@
 bool CommandLine_Generic::next()
 {
   if (current_option == parsed_options.end()) 
-    {
-      (current_option = parsed_options.begin());
-      return current_option != parsed_options.end();
-    }
+  {
+    (current_option = parsed_options.begin());
+    return current_option != parsed_options.end();
+  }
   else
-    {
-      return (++current_option) != parsed_options.end();
-    }
+  {
+    return (++current_option) != parsed_options.end();
+  }
 }
 
 int CommandLine_Generic::get_key()

Modified: trunk/windstille/src/util/command_line_generic.hpp
===================================================================
--- trunk/windstille/src/util/command_line_generic.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/command_line_generic.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -39,82 +39,82 @@
 class CommandLine_Generic
 {
 private:
-	int help_indent;
+  int help_indent;
 
-	std::string programm;
+  std::string programm;
 
-	struct Option 
-	{
-		int key;
-		std::string help;
-		std::string long_option;
-		std::string argument;
-		bool visible;
+  struct Option 
+  {
+    int key;
+    std::string help;
+    std::string long_option;
+    std::string argument;
+    bool visible;
 
-          Option()
-            : key(),
-              help(),
-              long_option(),
-              argument(),
-              visible()
-          {}
-	};
+    Option()
+      : key(),
+        help(),
+        long_option(),
+        argument(),
+        visible()
+    {}
+  };
   
-	typedef std::vector&lt;Option&gt; Options;
-	Options options;
+  typedef std::vector&lt;Option&gt; Options;
+  Options options;
 
-	struct ParsedOption
-	{
-		int key;
-		std::string argument;
+  struct ParsedOption
+  {
+    int key;
+    std::string argument;
 
-          ParsedOption()
-            : key(),
-              argument()
-          {}
-	};
+    ParsedOption()
+      : key(),
+        argument()
+    {}
+  };
 
-	typedef std::vector&lt;ParsedOption&gt; ParsedOptions;
-	ParsedOptions parsed_options;
-	ParsedOptions::iterator current_option;
+  typedef std::vector&lt;ParsedOption&gt; ParsedOptions;
+  ParsedOptions parsed_options;
+  ParsedOptions::iterator current_option;
 
-	enum
-	{
-		GROUP     = -3,
-		DOC       = -4,
-		USAGE     = -5
-	};
+  enum
+  {
+    GROUP     = -3,
+    DOC       = -4,
+    USAGE     = -5
+  };
 
 public:  
-	CommandLine_Generic();
+  CommandLine_Generic();
 
-	void set_help_indent(int i) { help_indent = i; }
+  void set_help_indent(int i) { help_indent = i; }
 
-	void add_usage(const std::string&amp; usage);
-	void add_doc(const std::string&amp; doc);
-	void add_group(const std::string&amp; grouptopic);
+  void add_usage(const std::string&amp; usage);
+  void add_doc(const std::string&amp; doc);
+  void add_group(const std::string&amp; grouptopic);
   
-	void add_option(int key,
-						 const std::string&amp; long_option, 
-						 const std::string&amp; argument,
-						 const std::string&amp; help,
-						 bool visible = true);
+  void add_option(int key,
+                  const std::string&amp; long_option, 
+                  const std::string&amp; argument,
+                  const std::string&amp; help,
+                  bool visible = true);
 
-	void parse_args(int argc, char** argv);
-	void print_help();
+  void parse_args(int argc, char** argv);
+  void print_help();
   
-	bool next();
-	int get_key();
-	std::string get_argument();
+  bool next();
+  int get_key();
+  std::string get_argument();
 
 private:
-	void read_option(int id, const std::string&amp; argument);
+  void read_option(int id, const std::string&amp; argument);
 
-	/** Find the Option structure that matches \a short_option */
-	Option* lookup_short_option(char short_option);
+  /** Find the Option structure that matches \a short_option */
+  Option* lookup_short_option(char short_option);
 
-	/** Find the Option structure that matches \a long_option */
-	Option* lookup_long_option (const std::string&amp; long_option);
+  /** Find the Option structure that matches \a long_option */
+  Option* lookup_long_option (const std::string&amp; long_option);
 };
 
 #endif

Modified: trunk/windstille/src/util/file_reader.cpp
===================================================================
--- trunk/windstille/src/util/file_reader.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/file_reader.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -48,21 +48,21 @@
 {
   lisp::Lisp* root = lisp::Parser::parse(stream, filename);
   if (!root)
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;': file not found&quot;;
-      throw std::runtime_error(msg.str());
-    }
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;': file not found&quot;;
+    throw std::runtime_error(msg.str());
+  }
   else if (root &amp;&amp; root-&gt;get_type() == lisp::Lisp::TYPE_LIST &amp;&amp; root-&gt;get_list_size() &gt;= 1)
-    {
-      return SExprFileReader(root, root-&gt;get_list_elem(0));
-    }
+  {
+    return SExprFileReader(root, root-&gt;get_list_elem(0));
+  }
   else
-    {
-      std::ostringstream msg;
-      msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;': not a valid sexpr file&quot;;
-      throw std::runtime_error(msg.str());
-    }  
+  {
+    std::ostringstream msg;
+    msg &lt;&lt; &quot;'&quot; &lt;&lt; filename &lt;&lt; &quot;': not a valid sexpr file&quot;;
+    throw std::runtime_error(msg.str());
+  }  
 }
 
 FileReader::FileReader(boost::shared_ptr&lt;FileReaderImpl&gt; impl_)

Modified: trunk/windstille/src/util/file_reader.hpp
===================================================================
--- trunk/windstille/src/util/file_reader.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/file_reader.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -58,10 +58,10 @@
   {
     std::string str;
     if (get(name, str))
-      {
-        value = enum2string(str);
-        return true;
-      }
+    {
+      value = enum2string(str);
+      return true;
+    }
 
     return false;
   }

Modified: trunk/windstille/src/util/file_writer.cpp
===================================================================
--- trunk/windstille/src/util/file_writer.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/file_writer.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -93,14 +93,14 @@
 {
   std::ostringstream str;
   for(std::string::const_iterator i = in.begin(); i != in.end(); ++i)
-    {
-      if (*i == '&quot;')
-        str &lt;&lt; &quot;\\\&quot;&quot;;
-      else if (*i == '\\')
-        str &lt;&lt; &quot;\\\\&quot;;
-      else
-        str &lt;&lt; *i;
-    }
+  {
+    if (*i == '&quot;')
+      str &lt;&lt; &quot;\\\&quot;&quot;;
+    else if (*i == '\\')
+      str &lt;&lt; &quot;\\\\&quot;;
+    else
+      str &lt;&lt; *i;
+  }
   return str.str();
 }
 

Modified: trunk/windstille/src/util/getter.cpp
===================================================================
--- trunk/windstille/src/util/getter.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/getter.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -92,25 +92,25 @@
   std::vector&lt;float&gt; floats;
   if (reader.get(name, floats)) {
     if (floats.size() == 3)
-      {
-        value.r = floats[0];
-        value.g = floats[1];
-        value.b = floats[2];
-        value.a = 1.0f;
-        return true;
-      }
+    {
+      value.r = floats[0];
+      value.g = floats[1];
+      value.b = floats[2];
+      value.a = 1.0f;
+      return true;
+    }
     else if (floats.size() == 4)
-      {
-        value.r = floats[0];
-        value.g = floats[1];
-        value.b = floats[2];
-        value.a = floats[3];
-        return true;
-      }
+    {
+      value.r = floats[0];
+      value.g = floats[1];
+      value.b = floats[2];
+      value.a = floats[3];
+      return true;
+    }
     else
-      {
-        return false;
-      }
+    {
+      return false;
+    }
   } else {
     return false;
   } 

Modified: trunk/windstille/src/util/handle.hpp
===================================================================
--- trunk/windstille/src/util/handle.hpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/handle.hpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -34,8 +34,8 @@
 
 public:
   Handle(HandleManager&lt;Data&gt;* manager_, 
-             unsigned int index_,
-             unsigned int magic_)
+         unsigned int index_,
+         unsigned int magic_)
     : manager(manager_),
       index(index_),
       magic(magic_)
@@ -77,37 +77,37 @@
   Handle&lt;Data&gt; aquire(const Data&amp; data)
   {
     if (free_list.empty()) 
-      {
-        data_lst.push_back(data);
-        magic_lst.push_back(next_magic);
+    {
+      data_lst.push_back(data);
+      magic_lst.push_back(next_magic);
 
-        return Handle&lt;Data&gt;(this, next_magic++);
-      }
+      return Handle&lt;Data&gt;(this, next_magic++);
+    }
     else
-      {
-        unsigned int index = free_list.back();
-        free_list.pop_back();
+    {
+      unsigned int index = free_list.back();
+      free_list.pop_back();
 
-        data_lst[index]  = data;
-        magic_lst[index] = next_magic;
+      data_lst[index]  = data;
+      magic_lst[index] = next_magic;
 
-        return Handle&lt;Data&gt;(this, next_magic++);
-      }
+      return Handle&lt;Data&gt;(this, next_magic++);
+    }
   }
 
   void release(const Handle&lt;Data&gt;&amp; handle)
   {
     if (valid(handle))
-      {
-        delete data_lst[handle.index];
-        data_lst[handle.index] = 0;
+    {
+      delete data_lst[handle.index];
+      data_lst[handle.index] = 0;
 
-        free_list.push_back(handle.index);
-      }
+      free_list.push_back(handle.index);
+    }
     else
-      {
-        // invalid handle
-      }
+    {
+      // invalid handle
+    }
   }
   
   bool valid(const Handle&lt;Data&gt;&amp; handle)
@@ -119,13 +119,13 @@
   Data&amp; dereference(const Handle&lt;Data&gt;&amp; handle)
   {
     if (valid)
-      {
-        return data_lst[handle.index];
-      }
+    {
+      return data_lst[handle.index];
+    }
     else
-      {
-        // invalid handle
-      }
+    {
+      // invalid handle
+    }
   }
 };
 

Modified: trunk/windstille/src/util/pathname.cpp
===================================================================
--- trunk/windstille/src/util/pathname.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/pathname.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -32,7 +32,7 @@
 }
 
 static void add_overrides(const boost::filesystem::path&amp; path, const boost::filesystem::path&amp; base, 
-                         Pathname::Overrides* overrides)
+                          Pathname::Overrides* overrides)
 {
   boost::filesystem::directory_iterator end_i; // default construction yields past-the-end
 

Modified: trunk/windstille/src/util/response_curve.cpp
===================================================================
--- trunk/windstille/src/util/response_curve.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/response_curve.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -36,22 +36,22 @@
 ResponseCurve::get(float v)
 {
   if (samples.size() == 1)
-    {
-      return samples[0];
-    }
+  {
+    return samples[0];
+  }
   else
-    {
-      v = math::mid(i_min, v, i_max);
+  {
+    v = math::mid(i_min, v, i_max);
 
-      int   bucket_count = samples.size() - 1;
-      float bucket_size  = (i_max - i_min) / static_cast&lt;float&gt;(bucket_count);
+    int   bucket_count = samples.size() - 1;
+    float bucket_size  = (i_max - i_min) / static_cast&lt;float&gt;(bucket_count);
       
-      int bucket_index = int((v - i_min) / bucket_size);
+    int bucket_index = int((v - i_min) / bucket_size);
 
-      float t = ((v - i_min) - (static_cast&lt;float&gt;(bucket_index) * bucket_size)) / bucket_size;
+    float t = ((v - i_min) - (static_cast&lt;float&gt;(bucket_index) * bucket_size)) / bucket_size;
       
-      return ((1.0f - t) * samples[bucket_index]) + (t * samples[bucket_index + 1]);
-    }
+    return ((1.0f - t) * samples[bucket_index]) + (t * samples[bucket_index + 1]);
+  }
 }
 
 #ifdef __TEST__
@@ -61,20 +61,20 @@
 int main(int argc, char** argv)
 {
   if (argc != 2)
-    {
-      std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; FLOAT&quot; &lt;&lt; std::endl;
-    }
+  {
+    std::cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; FLOAT&quot; &lt;&lt; std::endl;
+  }
   else
-    {
-      float samples[] = { 0.0f, 0.25f, 0.75f, 1.0f };
-      std::vector&lt;float&gt; samples_vec(samples, samples+4);
+  {
+    float samples[] = { 0.0f, 0.25f, 0.75f, 1.0f };
+    std::vector&lt;float&gt; samples_vec(samples, samples+4);
 
-      std::cout &lt;&lt; &quot;Samples: &quot; &lt;&lt; samples_vec.size() &lt;&lt; std::endl;
+    std::cout &lt;&lt; &quot;Samples: &quot; &lt;&lt; samples_vec.size() &lt;&lt; std::endl;
 
-      ResponseCurve curve(0.0f, 1.0f, samples_vec);
+    ResponseCurve curve(0.0f, 1.0f, samples_vec);
 
-      std::cout &lt;&lt; curve.get(static_cast&lt;float&gt;(atof(argv[1]))) &lt;&lt; std::endl;
-    }
+    std::cout &lt;&lt; curve.get(static_cast&lt;float&gt;(atof(argv[1]))) &lt;&lt; std::endl;
+  }
   return 0;
 }
 #endif

Modified: trunk/windstille/src/util/sexpr_file_reader.cpp
===================================================================
--- trunk/windstille/src/util/sexpr_file_reader.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/sexpr_file_reader.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -70,10 +70,10 @@
   {
     lisp::Lisp* item = get_subsection_item(name);
     if (item &amp;&amp; item-&gt;get_type() == lisp::Lisp::TYPE_INT)
-      {
-        v = item-&gt;get_int();
-        return true;
-      }
+    {
+      v = item-&gt;get_int();
+      return true;
+    }
     return false;
   }
 
@@ -81,11 +81,11 @@
   {
     lisp::Lisp* item = get_subsection_item(name);
     if (item &amp;&amp; item-&gt;get_type() == lisp::Lisp::TYPE_INT)
-      {
-        // FIXME: Not good: overflow
-        v = item-&gt;get_int();
-        return true;
-      }
+    {
+      // FIXME: Not good: overflow
+      v = item-&gt;get_int();
+      return true;
+    }
     return false;
   }
 
@@ -93,22 +93,22 @@
   {
     lisp::Lisp* item = get_subsection_item(name);
     if (item)
+    {
+      if (item-&gt;get_type() == lisp::Lisp::TYPE_FLOAT)
       {
-        if (item-&gt;get_type() == lisp::Lisp::TYPE_FLOAT)
-          {
-            v = item-&gt;get_float();
-            return true;
-          }
-        else if (item-&gt;get_type() == lisp::Lisp::TYPE_INT)
-          {
-            v = static_cast&lt;float&gt;(item-&gt;get_int());
-            return true;
-          }
-        else
-          {
-            return false;
-          }
+        v = item-&gt;get_float();
+        return true;
       }
+      else if (item-&gt;get_type() == lisp::Lisp::TYPE_INT)
+      {
+        v = static_cast&lt;float&gt;(item-&gt;get_int());
+        return true;
+      }
+      else
+      {
+        return false;
+      }
+    }
     return false;
   }
 
@@ -116,10 +116,10 @@
   {
     lisp::Lisp* item = get_subsection_item(name);
     if (item &amp;&amp; item-&gt;get_type() == lisp::Lisp::TYPE_BOOL)
-      {
-        v = item-&gt;get_bool();
-        return true;
-      }
+    {
+      v = item-&gt;get_bool();
+      return true;
+    }
     return false;
   }
 
@@ -127,22 +127,22 @@
   {
     lisp::Lisp* sub = get_subsection(name);
     if (sub)
+    {
+      v = &quot;&quot;;
+      for(size_t i = 1; i &lt; sub-&gt;get_list_size(); ++i)
       {
-        v = &quot;&quot;;
-        for(size_t i = 1; i &lt; sub-&gt;get_list_size(); ++i)
-          {
-            lisp::Lisp* item = sub-&gt;get_list_elem(i);
-            if (item-&gt;get_type() == lisp::Lisp::TYPE_STRING)
-              {
-                v += item-&gt;get_string();
-              }
-            else if (item-&gt;get_type() == lisp::Lisp::TYPE_SYMBOL)
-              {
-                v += item-&gt;get_symbol();
-              }
-          }
-        return true;
+        lisp::Lisp* item = sub-&gt;get_list_elem(i);
+        if (item-&gt;get_type() == lisp::Lisp::TYPE_STRING)
+        {
+          v += item-&gt;get_string();
+        }
+        else if (item-&gt;get_type() == lisp::Lisp::TYPE_SYMBOL)
+        {
+          v += item-&gt;get_symbol();
+        }
       }
+      return true;
+    }
     return false;
   }
 
@@ -186,10 +186,10 @@
   {
     lisp::Lisp* cur = get_subsection(name);
     if (cur)
-      {
-        v = SExprFileReader(cur);
-        return true;
-      }
+    {
+      v = SExprFileReader(cur);
+      return true;
+    }
     return false;
   }
 
@@ -197,9 +197,9 @@
   {
     std::vector&lt;FileReader&gt; lst;
     for(size_t i = 1; i &lt; sexpr-&gt;get_list_size(); ++i)
-      { // iterate over subsections
-        lst.push_back(SExprFileReader(sexpr-&gt;get_list_elem(i)));
-      }
+    { // iterate over subsections
+      lst.push_back(SExprFileReader(sexpr-&gt;get_list_elem(i)));
+    }
     return lst;
   }
 
@@ -208,10 +208,10 @@
     std::vector&lt;std::string&gt; lst;
 
     for(size_t i = 1; i &lt; sexpr-&gt;get_list_size(); ++i)
-      { // iterate over subsections
-        lisp::Lisp* sub = sexpr-&gt;get_list_elem(i);
-        lst.push_back(sub-&gt;get_list_elem(0)-&gt;get_symbol());
-      }
+    { // iterate over subsections
+      lisp::Lisp* sub = sexpr-&gt;get_list_elem(i);
+      lst.push_back(sub-&gt;get_list_elem(0)-&gt;get_symbol());
+    }
 
     return lst;
   }
@@ -221,20 +221,20 @@
   {
     lisp::Lisp* sub = get_subsection(name);
     if (sub &amp;&amp; sub-&gt;get_list_size() == 2)
-      {
-        return sub-&gt;get_list_elem(1);
-      }
+    {
+      return sub-&gt;get_list_elem(1);
+    }
     return 0;
   }
 
   lisp::Lisp* get_subsection(const char* name) const
   {
     for(size_t i = 1; i &lt; sexpr-&gt;get_list_size(); ++i)
-      { // iterate over subsections
-        lisp::Lisp* sub = sexpr-&gt;get_list_elem(i);
-        if (strcmp(sub-&gt;get_list_elem(0)-&gt;get_symbol(), name) == 0)
-          return sub;
-      }
+    { // iterate over subsections
+      lisp::Lisp* sub = sexpr-&gt;get_list_elem(i);
+      if (strcmp(sub-&gt;get_list_elem(0)-&gt;get_symbol(), name) == 0)
+        return sub;
+    }
     return 0;
   } 
 

Modified: trunk/windstille/src/util/system.cpp
===================================================================
--- trunk/windstille/src/util/system.cpp	2010-07-25 03:01:28 UTC (rev 3336)
+++ trunk/windstille/src/util/system.cpp	2010-07-25 03:20:18 UTC (rev 3337)
@@ -79,9 +79,9 @@
   char* xdg_config_home = getenv(&quot;XDG_CONFIG_HOME&quot;);
   if (xdg_config_home)
   {
-      std::ostringstream out;
-      out &lt;&lt; xdg_config_home &lt;&lt; &quot;/windstille/&quot;;
-      return out.str();   
+    std::ostringstream out;
+    out &lt;&lt; xdg_config_home &lt;&lt; &quot;/windstille/&quot;;
+    return out.str();   
   }
   else
   {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002333.html">[Windstille-commit] r3336 - trunk/windstille/src/sound
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2334">[ date ]</a>
              <a href="thread.html#2334">[ thread ]</a>
              <a href="subject.html#2334">[ subject ]</a>
              <a href="author.html#2334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/windstille-commit">More information about the Windstille-commit
mailing list</a><br>
</body></html>
